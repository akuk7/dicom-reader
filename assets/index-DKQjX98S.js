(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();var Lc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $s(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function SV(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function r(){var i=!1;try{i=this instanceof r}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var zm={exports:{}},pg={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _7;function wV(){if(_7)return pg;_7=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,a){var o=null;if(a!==void 0&&(o=""+a),i.key!==void 0&&(o=""+i.key),"key"in i){a={};for(var s in i)s!=="key"&&(a[s]=i[s])}else a=i;return i=a.ref,{$$typeof:t,type:r,key:o,ref:i!==void 0?i:null,props:a}}return pg.Fragment=e,pg.jsx=n,pg.jsxs=n,pg}var b7;function xV(){return b7||(b7=1,zm.exports=wV()),zm.exports}var dn=xV(),Hm={exports:{}},$t={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M7;function EV(){if(M7)return $t;M7=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),o=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),g=Symbol.iterator;function h(W){return W===null||typeof W!="object"?null:(W=g&&W[g]||W["@@iterator"],typeof W=="function"?W:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,v={};function C(W,ae,fe){this.props=W,this.context=ae,this.refs=v,this.updater=fe||m}C.prototype.isReactComponent={},C.prototype.setState=function(W,ae){if(typeof W!="object"&&typeof W!="function"&&W!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,W,ae,"setState")},C.prototype.forceUpdate=function(W){this.updater.enqueueForceUpdate(this,W,"forceUpdate")};function S(){}S.prototype=C.prototype;function w(W,ae,fe){this.props=W,this.context=ae,this.refs=v,this.updater=fe||m}var x=w.prototype=new S;x.constructor=w,y(x,C.prototype),x.isPureReactComponent=!0;var R=Array.isArray,O={H:null,A:null,T:null,S:null,V:null},b=Object.prototype.hasOwnProperty;function I(W,ae,fe,ue,qe,et){return fe=et.ref,{$$typeof:t,type:W,key:ae,ref:fe!==void 0?fe:null,props:et}}function G(W,ae){return I(W.type,ae,void 0,void 0,void 0,W.props)}function j(W){return typeof W=="object"&&W!==null&&W.$$typeof===t}function F(W){var ae={"=":"=0",":":"=2"};return"$"+W.replace(/[=:]/g,function(fe){return ae[fe]})}var $=/\/+/g;function z(W,ae){return typeof W=="object"&&W!==null&&W.key!=null?F(""+W.key):ae.toString(36)}function oe(){}function Q(W){switch(W.status){case"fulfilled":return W.value;case"rejected":throw W.reason;default:switch(typeof W.status=="string"?W.then(oe,oe):(W.status="pending",W.then(function(ae){W.status==="pending"&&(W.status="fulfilled",W.value=ae)},function(ae){W.status==="pending"&&(W.status="rejected",W.reason=ae)})),W.status){case"fulfilled":return W.value;case"rejected":throw W.reason}}throw W}function le(W,ae,fe,ue,qe){var et=typeof W;(et==="undefined"||et==="boolean")&&(W=null);var Ze=!1;if(W===null)Ze=!0;else switch(et){case"bigint":case"string":case"number":Ze=!0;break;case"object":switch(W.$$typeof){case t:case e:Ze=!0;break;case d:return Ze=W._init,le(Ze(W._payload),ae,fe,ue,qe)}}if(Ze)return qe=qe(W),Ze=ue===""?"."+z(W,0):ue,R(qe)?(fe="",Ze!=null&&(fe=Ze.replace($,"$&/")+"/"),le(qe,ae,fe,"",function(st){return st})):qe!=null&&(j(qe)&&(qe=G(qe,fe+(qe.key==null||W&&W.key===qe.key?"":(""+qe.key).replace($,"$&/")+"/")+Ze)),ae.push(qe)),1;Ze=0;var yt=ue===""?".":ue+":";if(R(W))for(var tt=0;tt<W.length;tt++)ue=W[tt],et=yt+z(ue,tt),Ze+=le(ue,ae,fe,et,qe);else if(tt=h(W),typeof tt=="function")for(W=tt.call(W),tt=0;!(ue=W.next()).done;)ue=ue.value,et=yt+z(ue,tt++),Ze+=le(ue,ae,fe,et,qe);else if(et==="object"){if(typeof W.then=="function")return le(Q(W),ae,fe,ue,qe);throw ae=String(W),Error("Objects are not valid as a React child (found: "+(ae==="[object Object]"?"object with keys {"+Object.keys(W).join(", ")+"}":ae)+"). If you meant to render a collection of children, use an array instead.")}return Ze}function X(W,ae,fe){if(W==null)return W;var ue=[],qe=0;return le(W,ue,"","",function(et){return ae.call(fe,et,qe++)}),ue}function ie(W){if(W._status===-1){var ae=W._result;ae=ae(),ae.then(function(fe){(W._status===0||W._status===-1)&&(W._status=1,W._result=fe)},function(fe){(W._status===0||W._status===-1)&&(W._status=2,W._result=fe)}),W._status===-1&&(W._status=0,W._result=ae)}if(W._status===1)return W._result.default;throw W._result}var ye=typeof reportError=="function"?reportError:function(W){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ae=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof W=="object"&&W!==null&&typeof W.message=="string"?String(W.message):String(W),error:W});if(!window.dispatchEvent(ae))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",W);return}console.error(W)};function ge(){}return $t.Children={map:X,forEach:function(W,ae,fe){X(W,function(){ae.apply(this,arguments)},fe)},count:function(W){var ae=0;return X(W,function(){ae++}),ae},toArray:function(W){return X(W,function(ae){return ae})||[]},only:function(W){if(!j(W))throw Error("React.Children.only expected to receive a single React element child.");return W}},$t.Component=C,$t.Fragment=n,$t.Profiler=i,$t.PureComponent=w,$t.StrictMode=r,$t.Suspense=c,$t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,$t.__COMPILER_RUNTIME={__proto__:null,c:function(W){return O.H.useMemoCache(W)}},$t.cache=function(W){return function(){return W.apply(null,arguments)}},$t.cloneElement=function(W,ae,fe){if(W==null)throw Error("The argument must be a React element, but you passed "+W+".");var ue=y({},W.props),qe=W.key,et=void 0;if(ae!=null)for(Ze in ae.ref!==void 0&&(et=void 0),ae.key!==void 0&&(qe=""+ae.key),ae)!b.call(ae,Ze)||Ze==="key"||Ze==="__self"||Ze==="__source"||Ze==="ref"&&ae.ref===void 0||(ue[Ze]=ae[Ze]);var Ze=arguments.length-2;if(Ze===1)ue.children=fe;else if(1<Ze){for(var yt=Array(Ze),tt=0;tt<Ze;tt++)yt[tt]=arguments[tt+2];ue.children=yt}return I(W.type,qe,void 0,void 0,et,ue)},$t.createContext=function(W){return W={$$typeof:o,_currentValue:W,_currentValue2:W,_threadCount:0,Provider:null,Consumer:null},W.Provider=W,W.Consumer={$$typeof:a,_context:W},W},$t.createElement=function(W,ae,fe){var ue,qe={},et=null;if(ae!=null)for(ue in ae.key!==void 0&&(et=""+ae.key),ae)b.call(ae,ue)&&ue!=="key"&&ue!=="__self"&&ue!=="__source"&&(qe[ue]=ae[ue]);var Ze=arguments.length-2;if(Ze===1)qe.children=fe;else if(1<Ze){for(var yt=Array(Ze),tt=0;tt<Ze;tt++)yt[tt]=arguments[tt+2];qe.children=yt}if(W&&W.defaultProps)for(ue in Ze=W.defaultProps,Ze)qe[ue]===void 0&&(qe[ue]=Ze[ue]);return I(W,et,void 0,void 0,null,qe)},$t.createRef=function(){return{current:null}},$t.forwardRef=function(W){return{$$typeof:s,render:W}},$t.isValidElement=j,$t.lazy=function(W){return{$$typeof:d,_payload:{_status:-1,_result:W},_init:ie}},$t.memo=function(W,ae){return{$$typeof:u,type:W,compare:ae===void 0?null:ae}},$t.startTransition=function(W){var ae=O.T,fe={};O.T=fe;try{var ue=W(),qe=O.S;qe!==null&&qe(fe,ue),typeof ue=="object"&&ue!==null&&typeof ue.then=="function"&&ue.then(ge,ye)}catch(et){ye(et)}finally{O.T=ae}},$t.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},$t.use=function(W){return O.H.use(W)},$t.useActionState=function(W,ae,fe){return O.H.useActionState(W,ae,fe)},$t.useCallback=function(W,ae){return O.H.useCallback(W,ae)},$t.useContext=function(W){return O.H.useContext(W)},$t.useDebugValue=function(){},$t.useDeferredValue=function(W,ae){return O.H.useDeferredValue(W,ae)},$t.useEffect=function(W,ae,fe){var ue=O.H;if(typeof fe=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ue.useEffect(W,ae)},$t.useId=function(){return O.H.useId()},$t.useImperativeHandle=function(W,ae,fe){return O.H.useImperativeHandle(W,ae,fe)},$t.useInsertionEffect=function(W,ae){return O.H.useInsertionEffect(W,ae)},$t.useLayoutEffect=function(W,ae){return O.H.useLayoutEffect(W,ae)},$t.useMemo=function(W,ae){return O.H.useMemo(W,ae)},$t.useOptimistic=function(W,ae){return O.H.useOptimistic(W,ae)},$t.useReducer=function(W,ae,fe){return O.H.useReducer(W,ae,fe)},$t.useRef=function(W){return O.H.useRef(W)},$t.useState=function(W){return O.H.useState(W)},$t.useSyncExternalStore=function(W,ae,fe){return O.H.useSyncExternalStore(W,ae,fe)},$t.useTransition=function(){return O.H.useTransition()},$t.version="19.1.1",$t}var L7;function dv(){return L7||(L7=1,Hm.exports=EV()),Hm.exports}var Ae=dv(),jm={exports:{}},mg={},qm={exports:{}},Km={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V7;function RV(){return V7||(V7=1,function(t){function e(X,ie){var ye=X.length;X.push(ie);e:for(;0<ye;){var ge=ye-1>>>1,W=X[ge];if(0<i(W,ie))X[ge]=ie,X[ye]=W,ye=ge;else break e}}function n(X){return X.length===0?null:X[0]}function r(X){if(X.length===0)return null;var ie=X[0],ye=X.pop();if(ye!==ie){X[0]=ye;e:for(var ge=0,W=X.length,ae=W>>>1;ge<ae;){var fe=2*(ge+1)-1,ue=X[fe],qe=fe+1,et=X[qe];if(0>i(ue,ye))qe<W&&0>i(et,ue)?(X[ge]=et,X[qe]=ye,ge=qe):(X[ge]=ue,X[fe]=ye,ge=fe);else if(qe<W&&0>i(et,ye))X[ge]=et,X[qe]=ye,ge=qe;else break e}}return ie}function i(X,ie){var ye=X.sortIndex-ie.sortIndex;return ye!==0?ye:X.id-ie.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();t.unstable_now=function(){return o.now()-s}}var c=[],u=[],d=1,g=null,h=3,m=!1,y=!1,v=!1,C=!1,S=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;function R(X){for(var ie=n(u);ie!==null;){if(ie.callback===null)r(u);else if(ie.startTime<=X)r(u),ie.sortIndex=ie.expirationTime,e(c,ie);else break;ie=n(u)}}function O(X){if(v=!1,R(X),!y)if(n(c)!==null)y=!0,b||(b=!0,z());else{var ie=n(u);ie!==null&&le(O,ie.startTime-X)}}var b=!1,I=-1,G=5,j=-1;function F(){return C?!0:!(t.unstable_now()-j<G)}function $(){if(C=!1,b){var X=t.unstable_now();j=X;var ie=!0;try{e:{y=!1,v&&(v=!1,w(I),I=-1),m=!0;var ye=h;try{t:{for(R(X),g=n(c);g!==null&&!(g.expirationTime>X&&F());){var ge=g.callback;if(typeof ge=="function"){g.callback=null,h=g.priorityLevel;var W=ge(g.expirationTime<=X);if(X=t.unstable_now(),typeof W=="function"){g.callback=W,R(X),ie=!0;break t}g===n(c)&&r(c),R(X)}else r(c);g=n(c)}if(g!==null)ie=!0;else{var ae=n(u);ae!==null&&le(O,ae.startTime-X),ie=!1}}break e}finally{g=null,h=ye,m=!1}ie=void 0}}finally{ie?z():b=!1}}}var z;if(typeof x=="function")z=function(){x($)};else if(typeof MessageChannel<"u"){var oe=new MessageChannel,Q=oe.port2;oe.port1.onmessage=$,z=function(){Q.postMessage(null)}}else z=function(){S($,0)};function le(X,ie){I=S(function(){X(t.unstable_now())},ie)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(X){X.callback=null},t.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<X?Math.floor(1e3/X):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_next=function(X){switch(h){case 1:case 2:case 3:var ie=3;break;default:ie=h}var ye=h;h=ie;try{return X()}finally{h=ye}},t.unstable_requestPaint=function(){C=!0},t.unstable_runWithPriority=function(X,ie){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var ye=h;h=X;try{return ie()}finally{h=ye}},t.unstable_scheduleCallback=function(X,ie,ye){var ge=t.unstable_now();switch(typeof ye=="object"&&ye!==null?(ye=ye.delay,ye=typeof ye=="number"&&0<ye?ge+ye:ge):ye=ge,X){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=ye+W,X={id:d++,callback:ie,priorityLevel:X,startTime:ye,expirationTime:W,sortIndex:-1},ye>ge?(X.sortIndex=ye,e(u,X),n(c)===null&&X===n(u)&&(v?(w(I),I=-1):v=!0,le(O,ye-ge))):(X.sortIndex=W,e(c,X),y||m||(y=!0,b||(b=!0,z()))),X},t.unstable_shouldYield=F,t.unstable_wrapCallback=function(X){var ie=h;return function(){var ye=h;h=ie;try{return X.apply(this,arguments)}finally{h=ye}}}}(Km)),Km}var I7;function OV(){return I7||(I7=1,qm.exports=RV()),qm.exports}var Ym={exports:{}},zi={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A7;function DV(){if(A7)return zi;A7=1;var t=dv();function e(c){var u="https://react.dev/errors/"+c;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)u+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+c+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function a(c,u,d){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:c,containerInfo:u,implementation:d}}var o=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(c,u){if(c==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return zi.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,zi.createPortal=function(c,u){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return a(c,u,null,d)},zi.flushSync=function(c){var u=o.T,d=r.p;try{if(o.T=null,r.p=2,c)return c()}finally{o.T=u,r.p=d,r.d.f()}},zi.preconnect=function(c,u){typeof c=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,r.d.C(c,u))},zi.prefetchDNS=function(c){typeof c=="string"&&r.d.D(c)},zi.preinit=function(c,u){if(typeof c=="string"&&u&&typeof u.as=="string"){var d=u.as,g=s(d,u.crossOrigin),h=typeof u.integrity=="string"?u.integrity:void 0,m=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;d==="style"?r.d.S(c,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:g,integrity:h,fetchPriority:m}):d==="script"&&r.d.X(c,{crossOrigin:g,integrity:h,fetchPriority:m,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},zi.preinitModule=function(c,u){if(typeof c=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var d=s(u.as,u.crossOrigin);r.d.M(c,{crossOrigin:d,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&r.d.M(c)},zi.preload=function(c,u){if(typeof c=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var d=u.as,g=s(d,u.crossOrigin);r.d.L(c,d,{crossOrigin:g,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},zi.preloadModule=function(c,u){if(typeof c=="string")if(u){var d=s(u.as,u.crossOrigin);r.d.m(c,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:d,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else r.d.m(c)},zi.requestFormReset=function(c){r.d.r(c)},zi.unstable_batchedUpdates=function(c,u){return c(u)},zi.useFormState=function(c,u,d){return o.H.useFormState(c,u,d)},zi.useFormStatus=function(){return o.H.useHostTransitionStatus()},zi.version="19.1.1",zi}var N7;function _V(){if(N7)return Ym.exports;N7=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Ym.exports=DV(),Ym.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P7;function bV(){if(P7)return mg;P7=1;var t=OV(),e=dv(),n=_V();function r(l){var f="https://react.dev/errors/"+l;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)f+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+l+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function a(l){var f=l,p=l;if(l.alternate)for(;f.return;)f=f.return;else{l=f;do f=l,(f.flags&4098)!==0&&(p=f.return),l=f.return;while(l)}return f.tag===3?p:null}function o(l){if(l.tag===13){var f=l.memoizedState;if(f===null&&(l=l.alternate,l!==null&&(f=l.memoizedState)),f!==null)return f.dehydrated}return null}function s(l){if(a(l)!==l)throw Error(r(188))}function c(l){var f=l.alternate;if(!f){if(f=a(l),f===null)throw Error(r(188));return f!==l?null:l}for(var p=l,T=f;;){var E=p.return;if(E===null)break;var D=E.alternate;if(D===null){if(T=E.return,T!==null){p=T;continue}break}if(E.child===D.child){for(D=E.child;D;){if(D===p)return s(E),l;if(D===T)return s(E),f;D=D.sibling}throw Error(r(188))}if(p.return!==T.return)p=E,T=D;else{for(var U=!1,q=E.child;q;){if(q===p){U=!0,p=E,T=D;break}if(q===T){U=!0,T=E,p=D;break}q=q.sibling}if(!U){for(q=D.child;q;){if(q===p){U=!0,p=D,T=E;break}if(q===T){U=!0,T=D,p=E;break}q=q.sibling}if(!U)throw Error(r(189))}}if(p.alternate!==T)throw Error(r(190))}if(p.tag!==3)throw Error(r(188));return p.stateNode.current===p?l:f}function u(l){var f=l.tag;if(f===5||f===26||f===27||f===6)return l;for(l=l.child;l!==null;){if(f=u(l),f!==null)return f;l=l.sibling}return null}var d=Object.assign,g=Symbol.for("react.element"),h=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),w=Symbol.for("react.consumer"),x=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),b=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),j=Symbol.for("react.activity"),F=Symbol.for("react.memo_cache_sentinel"),$=Symbol.iterator;function z(l){return l===null||typeof l!="object"?null:(l=$&&l[$]||l["@@iterator"],typeof l=="function"?l:null)}var oe=Symbol.for("react.client.reference");function Q(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===oe?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case y:return"Fragment";case C:return"Profiler";case v:return"StrictMode";case O:return"Suspense";case b:return"SuspenseList";case j:return"Activity"}if(typeof l=="object")switch(l.$$typeof){case m:return"Portal";case x:return(l.displayName||"Context")+".Provider";case w:return(l._context.displayName||"Context")+".Consumer";case R:var f=l.render;return l=l.displayName,l||(l=f.displayName||f.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case I:return f=l.displayName||null,f!==null?f:Q(l.type)||"Memo";case G:f=l._payload,l=l._init;try{return Q(l(f))}catch{}}return null}var le=Array.isArray,X=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ie=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ye={pending:!1,data:null,method:null,action:null},ge=[],W=-1;function ae(l){return{current:l}}function fe(l){0>W||(l.current=ge[W],ge[W]=null,W--)}function ue(l,f){W++,ge[W]=l.current,l.current=f}var qe=ae(null),et=ae(null),Ze=ae(null),yt=ae(null);function tt(l,f){switch(ue(Ze,f),ue(et,l),ue(qe,null),f.nodeType){case 9:case 11:l=(l=f.documentElement)&&(l=l.namespaceURI)?n7(l):0;break;default:if(l=f.tagName,f=f.namespaceURI)f=n7(f),l=r7(f,l);else switch(l){case"svg":l=1;break;case"math":l=2;break;default:l=0}}fe(qe),ue(qe,l)}function st(){fe(qe),fe(et),fe(Ze)}function Bt(l){l.memoizedState!==null&&ue(yt,l);var f=qe.current,p=r7(f,l.type);f!==p&&(ue(et,l),ue(qe,p))}function pr(l){et.current===l&&(fe(qe),fe(et)),yt.current===l&&(fe(yt),ug._currentValue=ye)}var Lr=Object.prototype.hasOwnProperty,bn=t.unstable_scheduleCallback,Gn=t.unstable_cancelCallback,Mn=t.unstable_shouldYield,Nn=t.unstable_requestPaint,un=t.unstable_now,Bn=t.unstable_getCurrentPriorityLevel,nr=t.unstable_ImmediatePriority,Vr=t.unstable_UserBlockingPriority,Y=t.unstable_NormalPriority,J=t.unstable_LowPriority,he=t.unstable_IdlePriority,Z=t.log,ve=t.unstable_setDisableYieldValue,Pe=null,Je=null;function Ct(l){if(typeof Z=="function"&&ve(l),Je&&typeof Je.setStrictMode=="function")try{Je.setStrictMode(Pe,l)}catch{}}var xt=Math.clz32?Math.clz32:mr,wn=Math.log,sn=Math.LN2;function mr(l){return l>>>=0,l===0?32:31-(wn(l)/sn|0)|0}var Ut=256,Yt=4194304;function Ht(l){var f=l&42;if(f!==0)return f;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function Ee(l,f,p){var T=l.pendingLanes;if(T===0)return 0;var E=0,D=l.suspendedLanes,U=l.pingedLanes;l=l.warmLanes;var q=T&134217727;return q!==0?(T=q&~D,T!==0?E=Ht(T):(U&=q,U!==0?E=Ht(U):p||(p=q&~l,p!==0&&(E=Ht(p))))):(q=T&~D,q!==0?E=Ht(q):U!==0?E=Ht(U):p||(p=T&~l,p!==0&&(E=Ht(p)))),E===0?0:f!==0&&f!==E&&(f&D)===0&&(D=E&-E,p=f&-f,D>=p||D===32&&(p&4194048)!==0)?f:E}function ze(l,f){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&f)===0}function ut(l,f){switch(l){case 1:case 2:case 4:case 8:case 64:return f+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qt(){var l=Ut;return Ut<<=1,(Ut&4194048)===0&&(Ut=256),l}function Wr(){var l=Yt;return Yt<<=1,(Yt&62914560)===0&&(Yt=4194304),l}function vr(l){for(var f=[],p=0;31>p;p++)f.push(l);return f}function rr(l,f){l.pendingLanes|=f,f!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function Ir(l,f,p,T,E,D){var U=l.pendingLanes;l.pendingLanes=p,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=p,l.entangledLanes&=p,l.errorRecoveryDisabledLanes&=p,l.shellSuspendCounter=0;var q=l.entanglements,ce=l.expirationTimes,Re=l.hiddenUpdates;for(p=U&~p;0<p;){var Ge=31-xt(p),He=1<<Ge;q[Ge]=0,ce[Ge]=-1;var De=Re[Ge];if(De!==null)for(Re[Ge]=null,Ge=0;Ge<De.length;Ge++){var be=De[Ge];be!==null&&(be.lane&=-536870913)}p&=~He}T!==0&&Ji(l,T,0),D!==0&&E===0&&l.tag!==0&&(l.suspendedLanes|=D&~(U&~f))}function Ji(l,f,p){l.pendingLanes|=f,l.suspendedLanes&=~f;var T=31-xt(f);l.entangledLanes|=f,l.entanglements[T]=l.entanglements[T]|1073741824|p&4194090}function yr(l,f){var p=l.entangledLanes|=f;for(l=l.entanglements;p;){var T=31-xt(p),E=1<<T;E&f|l[T]&f&&(l[T]|=f),p&=~E}}function ir(l){switch(l){case 2:l=1;break;case 8:l=4;break;case 32:l=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:l=128;break;case 268435456:l=134217728;break;default:l=0}return l}function Ei(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function Fi(){var l=ie.p;return l!==0?l:(l=window.event,l===void 0?32:w7(l.type))}function $n(l,f){var p=ie.p;try{return ie.p=l,f()}finally{ie.p=p}}var Tr=Math.random().toString(36).slice(2),ot="__reactFiber$"+Tr,Ot="__reactProps$"+Tr,Et="__reactContainer$"+Tr,Dt="__reactEvents$"+Tr,zr="__reactListeners$"+Tr,Ri="__reactHandles$"+Tr,io="__reactResources$"+Tr,ki="__reactMarker$"+Tr;function Oi(l){delete l[ot],delete l[Ot],delete l[Dt],delete l[zr],delete l[Ri]}function gi(l){var f=l[ot];if(f)return f;for(var p=l.parentNode;p;){if(f=p[Et]||p[ot]){if(p=f.alternate,f.child!==null||p!==null&&p.child!==null)for(l=s7(l);l!==null;){if(p=l[ot])return p;l=s7(l)}return f}l=p,p=l.parentNode}return null}function Di(l){if(l=l[ot]||l[Et]){var f=l.tag;if(f===5||f===6||f===13||f===26||f===27||f===3)return l}return null}function Rn(l){var f=l.tag;if(f===5||f===26||f===27||f===6)return l.stateNode;throw Error(r(33))}function Ar(l){var f=l[io];return f||(f=l[io]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function vt(l){l[ki]=!0}var ar=new Set,ao={};function or(l,f){Hr(l,f),Hr(l+"Capture",f)}function Hr(l,f){for(ao[l]=f,l=0;l<f.length;l++)ar.add(f[l])}var _i=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),jr={},No={};function Ua(l){return Lr.call(No,l)?!0:Lr.call(jr,l)?!1:_i.test(l)?No[l]=!0:(jr[l]=!0,!1)}function qr(l,f,p){if(Ua(f))if(p===null)l.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":l.removeAttribute(f);return;case"boolean":var T=f.toLowerCase().slice(0,5);if(T!=="data-"&&T!=="aria-"){l.removeAttribute(f);return}}l.setAttribute(f,""+p)}}function Fa(l,f,p){if(p===null)l.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(f);return}l.setAttribute(f,""+p)}}function Xn(l,f,p,T){if(T===null)l.removeAttribute(p);else{switch(typeof T){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(p);return}l.setAttributeNS(f,p,""+T)}}var ma,va;function Cr(l){if(ma===void 0)try{throw Error()}catch(p){var f=p.stack.trim().match(/\n( *(at )?)/);ma=f&&f[1]||"",va=-1<p.stack.indexOf(`
    at`)?" (<anonymous>)":-1<p.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ma+l+va}var ka=!1;function ea(l,f){if(!l||ka)return"";ka=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var T={DetermineComponentFrameRoot:function(){try{if(f){var He=function(){throw Error()};if(Object.defineProperty(He.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(He,[])}catch(be){var De=be}Reflect.construct(l,[],He)}else{try{He.call()}catch(be){De=be}l.call(He.prototype)}}else{try{throw Error()}catch(be){De=be}(He=l())&&typeof He.catch=="function"&&He.catch(function(){})}}catch(be){if(be&&De&&typeof be.stack=="string")return[be.stack,De.stack]}return[null,null]}};T.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var E=Object.getOwnPropertyDescriptor(T.DetermineComponentFrameRoot,"name");E&&E.configurable&&Object.defineProperty(T.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var D=T.DetermineComponentFrameRoot(),U=D[0],q=D[1];if(U&&q){var ce=U.split(`
`),Re=q.split(`
`);for(E=T=0;T<ce.length&&!ce[T].includes("DetermineComponentFrameRoot");)T++;for(;E<Re.length&&!Re[E].includes("DetermineComponentFrameRoot");)E++;if(T===ce.length||E===Re.length)for(T=ce.length-1,E=Re.length-1;1<=T&&0<=E&&ce[T]!==Re[E];)E--;for(;1<=T&&0<=E;T--,E--)if(ce[T]!==Re[E]){if(T!==1||E!==1)do if(T--,E--,0>E||ce[T]!==Re[E]){var Ge=`
`+ce[T].replace(" at new "," at ");return l.displayName&&Ge.includes("<anonymous>")&&(Ge=Ge.replace("<anonymous>",l.displayName)),Ge}while(1<=T&&0<=E);break}}}finally{ka=!1,Error.prepareStackTrace=p}return(p=l?l.displayName||l.name:"")?Cr(p):""}function Gi(l){switch(l.tag){case 26:case 27:case 5:return Cr(l.type);case 16:return Cr("Lazy");case 13:return Cr("Suspense");case 19:return Cr("SuspenseList");case 0:case 15:return ea(l.type,!1);case 11:return ea(l.type.render,!1);case 1:return ea(l.type,!0);case 31:return Cr("Activity");default:return""}}function Po(l){try{var f="";do f+=Gi(l),l=l.return;while(l);return f}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}function pn(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function di(l){var f=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function oo(l){var f=di(l)?"checked":"value",p=Object.getOwnPropertyDescriptor(l.constructor.prototype,f),T=""+l[f];if(!l.hasOwnProperty(f)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var E=p.get,D=p.set;return Object.defineProperty(l,f,{configurable:!0,get:function(){return E.call(this)},set:function(U){T=""+U,D.call(this,U)}}),Object.defineProperty(l,f,{enumerable:p.enumerable}),{getValue:function(){return T},setValue:function(U){T=""+U},stopTracking:function(){l._valueTracker=null,delete l[f]}}}}function ta(l){l._valueTracker||(l._valueTracker=oo(l))}function so(l){if(!l)return!1;var f=l._valueTracker;if(!f)return!0;var p=f.getValue(),T="";return l&&(T=di(l)?l.checked?"true":"false":l.value),l=T,l!==p?(f.setValue(l),!0):!1}function hi(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var Xs=/[\n"\\]/g;function Kr(l){return l.replace(Xs,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function Uo(l,f,p,T,E,D,U,q){l.name="",U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"?l.type=U:l.removeAttribute("type"),f!=null?U==="number"?(f===0&&l.value===""||l.value!=f)&&(l.value=""+pn(f)):l.value!==""+pn(f)&&(l.value=""+pn(f)):U!=="submit"&&U!=="reset"||l.removeAttribute("value"),f!=null?ii(l,U,pn(f)):p!=null?ii(l,U,pn(p)):T!=null&&l.removeAttribute("value"),E==null&&D!=null&&(l.defaultChecked=!!D),E!=null&&(l.checked=E&&typeof E!="function"&&typeof E!="symbol"),q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"?l.name=""+pn(q):l.removeAttribute("name")}function as(l,f,p,T,E,D,U,q){if(D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"&&(l.type=D),f!=null||p!=null){if(!(D!=="submit"&&D!=="reset"||f!=null))return;p=p!=null?""+pn(p):"",f=f!=null?""+pn(f):p,q||f===l.value||(l.value=f),l.defaultValue=f}T=T??E,T=typeof T!="function"&&typeof T!="symbol"&&!!T,l.checked=q?l.checked:!!T,l.defaultChecked=!!T,U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"&&(l.name=U)}function ii(l,f,p){f==="number"&&hi(l.ownerDocument)===l||l.defaultValue===""+p||(l.defaultValue=""+p)}function Sr(l,f,p,T){if(l=l.options,f){f={};for(var E=0;E<p.length;E++)f["$"+p[E]]=!0;for(p=0;p<l.length;p++)E=f.hasOwnProperty("$"+l[p].value),l[p].selected!==E&&(l[p].selected=E),E&&T&&(l[p].defaultSelected=!0)}else{for(p=""+pn(p),f=null,E=0;E<l.length;E++){if(l[E].value===p){l[E].selected=!0,T&&(l[E].defaultSelected=!0);return}f!==null||l[E].disabled||(f=l[E])}f!==null&&(f.selected=!0)}}function ai(l,f,p){if(f!=null&&(f=""+pn(f),f!==l.value&&(l.value=f),p==null)){l.defaultValue!==f&&(l.defaultValue=f);return}l.defaultValue=p!=null?""+pn(p):""}function wr(l,f,p,T){if(f==null){if(T!=null){if(p!=null)throw Error(r(92));if(le(T)){if(1<T.length)throw Error(r(93));T=T[0]}p=T}p==null&&(p=""),f=p}p=pn(f),l.defaultValue=p,T=l.textContent,T===p&&T!==""&&T!==null&&(l.value=T)}function na(l,f){if(f){var p=l.firstChild;if(p&&p===l.lastChild&&p.nodeType===3){p.nodeValue=f;return}}l.textContent=f}var ya=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ta(l,f,p){var T=f.indexOf("--")===0;p==null||typeof p=="boolean"||p===""?T?l.setProperty(f,""):f==="float"?l.cssFloat="":l[f]="":T?l.setProperty(f,p):typeof p!="number"||p===0||ya.has(f)?f==="float"?l.cssFloat=p:l[f]=(""+p).trim():l[f]=p+"px"}function Wn(l,f,p){if(f!=null&&typeof f!="object")throw Error(r(62));if(l=l.style,p!=null){for(var T in p)!p.hasOwnProperty(T)||f!=null&&f.hasOwnProperty(T)||(T.indexOf("--")===0?l.setProperty(T,""):T==="float"?l.cssFloat="":l[T]="");for(var E in f)T=f[E],f.hasOwnProperty(E)&&p[E]!==T&&Ta(l,E,T)}else for(var D in f)f.hasOwnProperty(D)&&Ta(l,D,f[D])}function co(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var oi=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),xr=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ca(l){return xr.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}var Bi=null;function Nr(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var pi=null,ra=null;function Fo(l){var f=Di(l);if(f&&(l=f.stateNode)){var p=l[Ot]||null;e:switch(l=f.stateNode,f.type){case"input":if(Uo(l,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name),f=p.name,p.type==="radio"&&f!=null){for(p=l;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll('input[name="'+Kr(""+f)+'"][type="radio"]'),f=0;f<p.length;f++){var T=p[f];if(T!==l&&T.form===l.form){var E=T[Ot]||null;if(!E)throw Error(r(90));Uo(T,E.value,E.defaultValue,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name)}}for(f=0;f<p.length;f++)T=p[f],T.form===l.form&&so(T)}break e;case"textarea":ai(l,p.value,p.defaultValue);break e;case"select":f=p.value,f!=null&&Sr(l,!!p.multiple,f,!1)}}}var Sa=!1;function xn(l,f,p){if(Sa)return l(f,p);Sa=!0;try{var T=l(f);return T}finally{if(Sa=!1,(pi!==null||ra!==null)&&(Ld(),pi&&(f=pi,l=ra,ra=pi=null,Fo(f),l)))for(f=0;f<l.length;f++)Fo(l[f])}}function bi(l,f){var p=l.stateNode;if(p===null)return null;var T=p[Ot]||null;if(T===null)return null;p=T[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(T=!T.disabled)||(l=l.type,T=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!T;break e;default:l=!1}if(l)return null;if(p&&typeof p!="function")throw Error(r(231,f,typeof p));return p}var En=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Zn=!1;if(En)try{var wa={};Object.defineProperty(wa,"passive",{get:function(){Zn=!0}}),window.addEventListener("test",wa,wa),window.removeEventListener("test",wa,wa)}catch{Zn=!1}var Qn=null,ko=null,sr=null;function Mi(){if(sr)return sr;var l,f=ko,p=f.length,T,E="value"in Qn?Qn.value:Qn.textContent,D=E.length;for(l=0;l<p&&f[l]===E[l];l++);var U=p-l;for(T=1;T<=U&&f[p-T]===E[D-T];T++);return sr=E.slice(l,1<T?1-T:void 0)}function xa(l){var f=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&f===13&&(l=13)):l=f,l===10&&(l=13),32<=l||l===13?l:0}function $i(){return!0}function Yr(){return!1}function cr(l){function f(p,T,E,D,U){this._reactName=p,this._targetInst=E,this.type=T,this.nativeEvent=D,this.target=U,this.currentTarget=null;for(var q in l)l.hasOwnProperty(q)&&(p=l[q],this[q]=p?p(D):D[q]);return this.isDefaultPrevented=(D.defaultPrevented!=null?D.defaultPrevented:D.returnValue===!1)?$i:Yr,this.isPropagationStopped=Yr,this}return d(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=$i)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=$i)},persist:function(){},isPersistent:$i}),f}var ia={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lo=cr(ia),Ea=d({},ia,{view:0,detail:0}),Ga=cr(Ea),uo,Ba,$a,fo=d({},Ea,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ho,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==$a&&($a&&l.type==="mousemove"?(uo=l.screenX-$a.screenX,Ba=l.screenY-$a.screenY):Ba=uo=0,$a=l),uo)},movementY:function(l){return"movementY"in l?l.movementY:Ba}}),os=cr(fo),Zs=d({},fo,{dataTransfer:0}),Qs=cr(Zs),Js=d({},Ea,{relatedTarget:0}),Go=cr(Js),ss=d({},ia,{animationName:0,elapsedTime:0,pseudoElement:0}),ec=cr(ss),cs=d({},ia,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),ls=cr(cs),tc=d({},ia,{data:0}),go=cr(tc),us={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fs={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Bo={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function nc(l){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(l):(l=Bo[l])?!!f[l]:!1}function ho(){return nc}var rc=d({},Ea,{key:function(l){if(l.key){var f=us[l.key]||l.key;if(f!=="Unidentified")return f}return l.type==="keypress"?(l=xa(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?fs[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ho,charCode:function(l){return l.type==="keypress"?xa(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?xa(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),gs=cr(rc),ic=d({},fo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ds=cr(ic),ac=d({},Ea,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ho}),oc=cr(ac),$o=d({},ia,{propertyName:0,elapsedTime:0,pseudoElement:0}),Wo=cr($o),aa=d({},fo,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),Ra=cr(aa),Li=d({},ia,{newState:0,oldState:0}),hs=cr(Li),ps=[9,13,27,32],Wa=En&&"CompositionEvent"in window,Oa=null;En&&"documentMode"in document&&(Oa=document.documentMode);var po=En&&"TextEvent"in window&&!Oa,zo=En&&(!Wa||Oa&&8<Oa&&11>=Oa),k=" ",B=!1;function ne(l,f){switch(l){case"keyup":return ps.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Se(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var _e=!1;function Ue(l,f){switch(l){case"compositionend":return Se(f);case"keypress":return f.which!==32?null:(B=!0,k);case"textInput":return l=f.data,l===k&&B?null:l;default:return null}}function Fe(l,f){if(_e)return l==="compositionend"||!Wa&&ne(l,f)?(l=Mi(),sr=ko=Qn=null,_e=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return zo&&f.locale!=="ko"?null:f.data;default:return null}}var Me={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ke(l){var f=l&&l.nodeName&&l.nodeName.toLowerCase();return f==="input"?!!Me[l.type]:f==="textarea"}function Qe(l,f,p,T){pi?ra?ra.push(T):ra=[T]:pi=T,f=Ud(f,"onChange"),0<f.length&&(p=new lo("onChange","change",null,p,T),l.push({event:p,listeners:f}))}var ct=null,dt=null;function St(l){Z9(l,0)}function P(l){var f=Rn(l);if(so(f))return l}function N(l,f){if(l==="change")return f}var ee=!1;if(En){var pe;if(En){var Oe="oninput"in document;if(!Oe){var Be=document.createElement("div");Be.setAttribute("oninput","return;"),Oe=typeof Be.oninput=="function"}pe=Oe}else pe=!1;ee=pe&&(!document.documentMode||9<document.documentMode)}function Ne(){ct&&(ct.detachEvent("onpropertychange",Ve),dt=ct=null)}function Ve(l){if(l.propertyName==="value"&&P(dt)){var f=[];Qe(f,dt,l,Nr(l)),xn(St,f)}}function L(l,f,p){l==="focusin"?(Ne(),ct=f,dt=p,ct.attachEvent("onpropertychange",Ve)):l==="focusout"&&Ne()}function V(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return P(dt)}function _(l,f){if(l==="click")return P(f)}function M(l,f){if(l==="input"||l==="change")return P(f)}function A(l,f){return l===f&&(l!==0||1/l===1/f)||l!==l&&f!==f}var K=typeof Object.is=="function"?Object.is:A;function te(l,f){if(K(l,f))return!0;if(typeof l!="object"||l===null||typeof f!="object"||f===null)return!1;var p=Object.keys(l),T=Object.keys(f);if(p.length!==T.length)return!1;for(T=0;T<p.length;T++){var E=p[T];if(!Lr.call(f,E)||!K(l[E],f[E]))return!1}return!0}function re(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function se(l,f){var p=re(l);l=0;for(var T;p;){if(p.nodeType===3){if(T=l+p.textContent.length,l<=f&&T>=f)return{node:p,offset:f-l};l=T}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=re(p)}}function de(l,f){return l&&f?l===f?!0:l&&l.nodeType===3?!1:f&&f.nodeType===3?de(l,f.parentNode):"contains"in l?l.contains(f):l.compareDocumentPosition?!!(l.compareDocumentPosition(f)&16):!1:!1}function we(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var f=hi(l.document);f instanceof l.HTMLIFrameElement;){try{var p=typeof f.contentWindow.location.href=="string"}catch{p=!1}if(p)l=f.contentWindow;else break;f=hi(l.document)}return f}function Ie(l){var f=l&&l.nodeName&&l.nodeName.toLowerCase();return f&&(f==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||f==="textarea"||l.contentEditable==="true")}var Xe=En&&"documentMode"in document&&11>=document.documentMode,at=null,nt=null,Rt=null,_t=!1;function Jt(l,f,p){var T=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;_t||at==null||at!==hi(T)||(T=at,"selectionStart"in T&&Ie(T)?T={start:T.selectionStart,end:T.selectionEnd}:(T=(T.ownerDocument&&T.ownerDocument.defaultView||window).getSelection(),T={anchorNode:T.anchorNode,anchorOffset:T.anchorOffset,focusNode:T.focusNode,focusOffset:T.focusOffset}),Rt&&te(Rt,T)||(Rt=T,T=Ud(nt,"onSelect"),0<T.length&&(f=new lo("onSelect","select",null,f,p),l.push({event:f,listeners:T}),f.target=at)))}function On(l,f){var p={};return p[l.toLowerCase()]=f.toLowerCase(),p["Webkit"+l]="webkit"+f,p["Moz"+l]="moz"+f,p}var Pn={animationend:On("Animation","AnimationEnd"),animationiteration:On("Animation","AnimationIteration"),animationstart:On("Animation","AnimationStart"),transitionrun:On("Transition","TransitionRun"),transitionstart:On("Transition","TransitionStart"),transitioncancel:On("Transition","TransitionCancel"),transitionend:On("Transition","TransitionEnd")},Ho={},oa={};En&&(oa=document.createElement("div").style,"AnimationEvent"in window||(delete Pn.animationend.animation,delete Pn.animationiteration.animation,delete Pn.animationstart.animation),"TransitionEvent"in window||delete Pn.transitionend.transition);function mo(l){if(Ho[l])return Ho[l];if(!Pn[l])return l;var f=Pn[l],p;for(p in f)if(f.hasOwnProperty(p)&&p in oa)return Ho[l]=f[p];return l}var Jc=mo("animationend"),Mf=mo("animationiteration"),Lf=mo("animationstart"),rL=mo("transitionrun"),iL=mo("transitionstart"),aL=mo("transitioncancel"),Vy=mo("transitionend"),Iy=new Map,o5="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");o5.push("scrollEnd");function jo(l,f){Iy.set(l,f),or(f,[l])}var Ay=new WeakMap;function vo(l,f){if(typeof l=="object"&&l!==null){var p=Ay.get(l);return p!==void 0?p:(f={value:l,source:f,stack:Po(f)},Ay.set(l,f),f)}return{value:l,source:f,stack:Po(f)}}var yo=[],Jl=0,s5=0;function J1(){for(var l=Jl,f=s5=Jl=0;f<l;){var p=yo[f];yo[f++]=null;var T=yo[f];yo[f++]=null;var E=yo[f];yo[f++]=null;var D=yo[f];if(yo[f++]=null,T!==null&&E!==null){var U=T.pending;U===null?E.next=E:(E.next=U.next,U.next=E),T.pending=E}D!==0&&Ny(p,E,D)}}function ed(l,f,p,T){yo[Jl++]=l,yo[Jl++]=f,yo[Jl++]=p,yo[Jl++]=T,s5|=T,l.lanes|=T,l=l.alternate,l!==null&&(l.lanes|=T)}function c5(l,f,p,T){return ed(l,f,p,T),td(l)}function eu(l,f){return ed(l,null,null,f),td(l)}function Ny(l,f,p){l.lanes|=p;var T=l.alternate;T!==null&&(T.lanes|=p);for(var E=!1,D=l.return;D!==null;)D.childLanes|=p,T=D.alternate,T!==null&&(T.childLanes|=p),D.tag===22&&(l=D.stateNode,l===null||l._visibility&1||(E=!0)),l=D,D=D.return;return l.tag===3?(D=l.stateNode,E&&f!==null&&(E=31-xt(p),l=D.hiddenUpdates,T=l[E],T===null?l[E]=[f]:T.push(f),f.lane=p|536870912),D):null}function td(l){if(50<ng)throw ng=0,hm=null,Error(r(185));for(var f=l.return;f!==null;)l=f,f=l.return;return l.tag===3?l.stateNode:null}var tu={};function oL(l,f,p,T){this.tag=l,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=T,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function za(l,f,p,T){return new oL(l,f,p,T)}function l5(l){return l=l.prototype,!(!l||!l.isReactComponent)}function sc(l,f){var p=l.alternate;return p===null?(p=za(l.tag,f,l.key,l.mode),p.elementType=l.elementType,p.type=l.type,p.stateNode=l.stateNode,p.alternate=l,l.alternate=p):(p.pendingProps=f,p.type=l.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=l.flags&65011712,p.childLanes=l.childLanes,p.lanes=l.lanes,p.child=l.child,p.memoizedProps=l.memoizedProps,p.memoizedState=l.memoizedState,p.updateQueue=l.updateQueue,f=l.dependencies,p.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},p.sibling=l.sibling,p.index=l.index,p.ref=l.ref,p.refCleanup=l.refCleanup,p}function Py(l,f){l.flags&=65011714;var p=l.alternate;return p===null?(l.childLanes=0,l.lanes=f,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=p.childLanes,l.lanes=p.lanes,l.child=p.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=p.memoizedProps,l.memoizedState=p.memoizedState,l.updateQueue=p.updateQueue,l.type=p.type,f=p.dependencies,l.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),l}function nd(l,f,p,T,E,D){var U=0;if(T=l,typeof l=="function")l5(l)&&(U=1);else if(typeof l=="string")U=cV(l,p,qe.current)?26:l==="html"||l==="head"||l==="body"?27:5;else e:switch(l){case j:return l=za(31,p,f,E),l.elementType=j,l.lanes=D,l;case y:return X0(p.children,E,D,f);case v:U=8,E|=24;break;case C:return l=za(12,p,f,E|2),l.elementType=C,l.lanes=D,l;case O:return l=za(13,p,f,E),l.elementType=O,l.lanes=D,l;case b:return l=za(19,p,f,E),l.elementType=b,l.lanes=D,l;default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case S:case x:U=10;break e;case w:U=9;break e;case R:U=11;break e;case I:U=14;break e;case G:U=16,T=null;break e}U=29,p=Error(r(130,l===null?"null":typeof l,"")),T=null}return f=za(U,p,f,E),f.elementType=l,f.type=T,f.lanes=D,f}function X0(l,f,p,T){return l=za(7,l,T,f),l.lanes=p,l}function u5(l,f,p){return l=za(6,l,null,f),l.lanes=p,l}function f5(l,f,p){return f=za(4,l.children!==null?l.children:[],l.key,f),f.lanes=p,f.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},f}var nu=[],ru=0,rd=null,id=0,To=[],Co=0,Z0=null,cc=1,lc="";function Q0(l,f){nu[ru++]=id,nu[ru++]=rd,rd=l,id=f}function Uy(l,f,p){To[Co++]=cc,To[Co++]=lc,To[Co++]=Z0,Z0=l;var T=cc;l=lc;var E=32-xt(T)-1;T&=~(1<<E),p+=1;var D=32-xt(f)+E;if(30<D){var U=E-E%5;D=(T&(1<<U)-1).toString(32),T>>=U,E-=U,cc=1<<32-xt(f)+E|p<<E|T,lc=D+l}else cc=1<<D|p<<E|T,lc=l}function g5(l){l.return!==null&&(Q0(l,1),Uy(l,1,0))}function d5(l){for(;l===rd;)rd=nu[--ru],nu[ru]=null,id=nu[--ru],nu[ru]=null;for(;l===Z0;)Z0=To[--Co],To[Co]=null,lc=To[--Co],To[Co]=null,cc=To[--Co],To[Co]=null}var sa=null,Er=null,vn=!1,J0=null,ms=!1,h5=Error(r(519));function el(l){var f=Error(r(418,""));throw Af(vo(f,l)),h5}function Fy(l){var f=l.stateNode,p=l.type,T=l.memoizedProps;switch(f[ot]=l,f[Ot]=T,p){case"dialog":Zt("cancel",f),Zt("close",f);break;case"iframe":case"object":case"embed":Zt("load",f);break;case"video":case"audio":for(p=0;p<ig.length;p++)Zt(ig[p],f);break;case"source":Zt("error",f);break;case"img":case"image":case"link":Zt("error",f),Zt("load",f);break;case"details":Zt("toggle",f);break;case"input":Zt("invalid",f),as(f,T.value,T.defaultValue,T.checked,T.defaultChecked,T.type,T.name,!0),ta(f);break;case"select":Zt("invalid",f);break;case"textarea":Zt("invalid",f),wr(f,T.value,T.defaultValue,T.children),ta(f)}p=T.children,typeof p!="string"&&typeof p!="number"&&typeof p!="bigint"||f.textContent===""+p||T.suppressHydrationWarning===!0||t7(f.textContent,p)?(T.popover!=null&&(Zt("beforetoggle",f),Zt("toggle",f)),T.onScroll!=null&&Zt("scroll",f),T.onScrollEnd!=null&&Zt("scrollend",f),T.onClick!=null&&(f.onclick=Fd),f=!0):f=!1,f||el(l)}function ky(l){for(sa=l.return;sa;)switch(sa.tag){case 5:case 13:ms=!1;return;case 27:case 3:ms=!0;return;default:sa=sa.return}}function Vf(l){if(l!==sa)return!1;if(!vn)return ky(l),vn=!0,!1;var f=l.tag,p;if((p=f!==3&&f!==27)&&((p=f===5)&&(p=l.type,p=!(p!=="form"&&p!=="button")||Mm(l.type,l.memoizedProps)),p=!p),p&&Er&&el(l),ky(l),f===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(r(317));e:{for(l=l.nextSibling,f=0;l;){if(l.nodeType===8)if(p=l.data,p==="/$"){if(f===0){Er=Ko(l.nextSibling);break e}f--}else p!=="$"&&p!=="$!"&&p!=="$?"||f++;l=l.nextSibling}Er=null}}else f===27?(f=Er,p0(l.type)?(l=Am,Am=null,Er=l):Er=f):Er=sa?Ko(l.stateNode.nextSibling):null;return!0}function If(){Er=sa=null,vn=!1}function Gy(){var l=J0;return l!==null&&(ba===null?ba=l:ba.push.apply(ba,l),J0=null),l}function Af(l){J0===null?J0=[l]:J0.push(l)}var p5=ae(null),tl=null,uc=null;function e0(l,f,p){ue(p5,f._currentValue),f._currentValue=p}function fc(l){l._currentValue=p5.current,fe(p5)}function m5(l,f,p){for(;l!==null;){var T=l.alternate;if((l.childLanes&f)!==f?(l.childLanes|=f,T!==null&&(T.childLanes|=f)):T!==null&&(T.childLanes&f)!==f&&(T.childLanes|=f),l===p)break;l=l.return}}function v5(l,f,p,T){var E=l.child;for(E!==null&&(E.return=l);E!==null;){var D=E.dependencies;if(D!==null){var U=E.child;D=D.firstContext;e:for(;D!==null;){var q=D;D=E;for(var ce=0;ce<f.length;ce++)if(q.context===f[ce]){D.lanes|=p,q=D.alternate,q!==null&&(q.lanes|=p),m5(D.return,p,l),T||(U=null);break e}D=q.next}}else if(E.tag===18){if(U=E.return,U===null)throw Error(r(341));U.lanes|=p,D=U.alternate,D!==null&&(D.lanes|=p),m5(U,p,l),U=null}else U=E.child;if(U!==null)U.return=E;else for(U=E;U!==null;){if(U===l){U=null;break}if(E=U.sibling,E!==null){E.return=U.return,U=E;break}U=U.return}E=U}}function Nf(l,f,p,T){l=null;for(var E=f,D=!1;E!==null;){if(!D){if((E.flags&524288)!==0)D=!0;else if((E.flags&262144)!==0)break}if(E.tag===10){var U=E.alternate;if(U===null)throw Error(r(387));if(U=U.memoizedProps,U!==null){var q=E.type;K(E.pendingProps.value,U.value)||(l!==null?l.push(q):l=[q])}}else if(E===yt.current){if(U=E.alternate,U===null)throw Error(r(387));U.memoizedState.memoizedState!==E.memoizedState.memoizedState&&(l!==null?l.push(ug):l=[ug])}E=E.return}l!==null&&v5(f,l,p,T),f.flags|=262144}function ad(l){for(l=l.firstContext;l!==null;){if(!K(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function nl(l){tl=l,uc=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function Wi(l){return By(tl,l)}function od(l,f){return tl===null&&nl(l),By(l,f)}function By(l,f){var p=f._currentValue;if(f={context:f,memoizedValue:p,next:null},uc===null){if(l===null)throw Error(r(308));uc=f,l.dependencies={lanes:0,firstContext:f},l.flags|=524288}else uc=uc.next=f;return p}var sL=typeof AbortController<"u"?AbortController:function(){var l=[],f=this.signal={aborted:!1,addEventListener:function(p,T){l.push(T)}};this.abort=function(){f.aborted=!0,l.forEach(function(p){return p()})}},cL=t.unstable_scheduleCallback,lL=t.unstable_NormalPriority,si={$$typeof:x,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function y5(){return{controller:new sL,data:new Map,refCount:0}}function Pf(l){l.refCount--,l.refCount===0&&cL(lL,function(){l.controller.abort()})}var Uf=null,T5=0,iu=0,au=null;function uL(l,f){if(Uf===null){var p=Uf=[];T5=0,iu=Sm(),au={status:"pending",value:void 0,then:function(T){p.push(T)}}}return T5++,f.then($y,$y),f}function $y(){if(--T5===0&&Uf!==null){au!==null&&(au.status="fulfilled");var l=Uf;Uf=null,iu=0,au=null;for(var f=0;f<l.length;f++)(0,l[f])()}}function fL(l,f){var p=[],T={status:"pending",value:null,reason:null,then:function(E){p.push(E)}};return l.then(function(){T.status="fulfilled",T.value=f;for(var E=0;E<p.length;E++)(0,p[E])(f)},function(E){for(T.status="rejected",T.reason=E,E=0;E<p.length;E++)(0,p[E])(void 0)}),T}var Wy=X.S;X.S=function(l,f){typeof f=="object"&&f!==null&&typeof f.then=="function"&&uL(l,f),Wy!==null&&Wy(l,f)};var rl=ae(null);function C5(){var l=rl.current;return l!==null?l:zn.pooledCache}function sd(l,f){f===null?ue(rl,rl.current):ue(rl,f.pool)}function zy(){var l=C5();return l===null?null:{parent:si._currentValue,pool:l}}var Ff=Error(r(460)),Hy=Error(r(474)),cd=Error(r(542)),S5={then:function(){}};function jy(l){return l=l.status,l==="fulfilled"||l==="rejected"}function ld(){}function qy(l,f,p){switch(p=l[p],p===void 0?l.push(f):p!==f&&(f.then(ld,ld),f=p),f.status){case"fulfilled":return f.value;case"rejected":throw l=f.reason,Yy(l),l;default:if(typeof f.status=="string")f.then(ld,ld);else{if(l=zn,l!==null&&100<l.shellSuspendCounter)throw Error(r(482));l=f,l.status="pending",l.then(function(T){if(f.status==="pending"){var E=f;E.status="fulfilled",E.value=T}},function(T){if(f.status==="pending"){var E=f;E.status="rejected",E.reason=T}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw l=f.reason,Yy(l),l}throw kf=f,Ff}}var kf=null;function Ky(){if(kf===null)throw Error(r(459));var l=kf;return kf=null,l}function Yy(l){if(l===Ff||l===cd)throw Error(r(483))}var t0=!1;function w5(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function x5(l,f){l=l.updateQueue,f.updateQueue===l&&(f.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function n0(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function r0(l,f,p){var T=l.updateQueue;if(T===null)return null;if(T=T.shared,(Dn&2)!==0){var E=T.pending;return E===null?f.next=f:(f.next=E.next,E.next=f),T.pending=f,f=td(l),Ny(l,null,p),f}return ed(l,T,f,p),td(l)}function Gf(l,f,p){if(f=f.updateQueue,f!==null&&(f=f.shared,(p&4194048)!==0)){var T=f.lanes;T&=l.pendingLanes,p|=T,f.lanes=p,yr(l,p)}}function E5(l,f){var p=l.updateQueue,T=l.alternate;if(T!==null&&(T=T.updateQueue,p===T)){var E=null,D=null;if(p=p.firstBaseUpdate,p!==null){do{var U={lane:p.lane,tag:p.tag,payload:p.payload,callback:null,next:null};D===null?E=D=U:D=D.next=U,p=p.next}while(p!==null);D===null?E=D=f:D=D.next=f}else E=D=f;p={baseState:T.baseState,firstBaseUpdate:E,lastBaseUpdate:D,shared:T.shared,callbacks:T.callbacks},l.updateQueue=p;return}l=p.lastBaseUpdate,l===null?p.firstBaseUpdate=f:l.next=f,p.lastBaseUpdate=f}var R5=!1;function Bf(){if(R5){var l=au;if(l!==null)throw l}}function $f(l,f,p,T){R5=!1;var E=l.updateQueue;t0=!1;var D=E.firstBaseUpdate,U=E.lastBaseUpdate,q=E.shared.pending;if(q!==null){E.shared.pending=null;var ce=q,Re=ce.next;ce.next=null,U===null?D=Re:U.next=Re,U=ce;var Ge=l.alternate;Ge!==null&&(Ge=Ge.updateQueue,q=Ge.lastBaseUpdate,q!==U&&(q===null?Ge.firstBaseUpdate=Re:q.next=Re,Ge.lastBaseUpdate=ce))}if(D!==null){var He=E.baseState;U=0,Ge=Re=ce=null,q=D;do{var De=q.lane&-536870913,be=De!==q.lane;if(be?(ln&De)===De:(T&De)===De){De!==0&&De===iu&&(R5=!0),Ge!==null&&(Ge=Ge.next={lane:0,tag:q.tag,payload:q.payload,callback:null,next:null});e:{var Vt=l,bt=q;De=f;var In=p;switch(bt.tag){case 1:if(Vt=bt.payload,typeof Vt=="function"){He=Vt.call(In,He,De);break e}He=Vt;break e;case 3:Vt.flags=Vt.flags&-65537|128;case 0:if(Vt=bt.payload,De=typeof Vt=="function"?Vt.call(In,He,De):Vt,De==null)break e;He=d({},He,De);break e;case 2:t0=!0}}De=q.callback,De!==null&&(l.flags|=64,be&&(l.flags|=8192),be=E.callbacks,be===null?E.callbacks=[De]:be.push(De))}else be={lane:De,tag:q.tag,payload:q.payload,callback:q.callback,next:null},Ge===null?(Re=Ge=be,ce=He):Ge=Ge.next=be,U|=De;if(q=q.next,q===null){if(q=E.shared.pending,q===null)break;be=q,q=be.next,be.next=null,E.lastBaseUpdate=be,E.shared.pending=null}}while(!0);Ge===null&&(ce=He),E.baseState=ce,E.firstBaseUpdate=Re,E.lastBaseUpdate=Ge,D===null&&(E.shared.lanes=0),f0|=U,l.lanes=U,l.memoizedState=He}}function Xy(l,f){if(typeof l!="function")throw Error(r(191,l));l.call(f)}function Zy(l,f){var p=l.callbacks;if(p!==null)for(l.callbacks=null,l=0;l<p.length;l++)Xy(p[l],f)}var ou=ae(null),ud=ae(0);function Qy(l,f){l=yc,ue(ud,l),ue(ou,f),yc=l|f.baseLanes}function O5(){ue(ud,yc),ue(ou,ou.current)}function D5(){yc=ud.current,fe(ou),fe(ud)}var i0=0,jt=null,Ln=null,Xr=null,fd=!1,su=!1,il=!1,gd=0,Wf=0,cu=null,gL=0;function Pr(){throw Error(r(321))}function _5(l,f){if(f===null)return!1;for(var p=0;p<f.length&&p<l.length;p++)if(!K(l[p],f[p]))return!1;return!0}function b5(l,f,p,T,E,D){return i0=D,jt=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,X.H=l===null||l.memoizedState===null?N6:P6,il=!1,D=p(T,E),il=!1,su&&(D=e6(f,p,T,E)),Jy(l),D}function Jy(l){X.H=yd;var f=Ln!==null&&Ln.next!==null;if(i0=0,Xr=Ln=jt=null,fd=!1,Wf=0,cu=null,f)throw Error(r(300));l===null||mi||(l=l.dependencies,l!==null&&ad(l)&&(mi=!0))}function e6(l,f,p,T){jt=l;var E=0;do{if(su&&(cu=null),Wf=0,su=!1,25<=E)throw Error(r(301));if(E+=1,Xr=Ln=null,l.updateQueue!=null){var D=l.updateQueue;D.lastEffect=null,D.events=null,D.stores=null,D.memoCache!=null&&(D.memoCache.index=0)}X.H=TL,D=f(p,T)}while(su);return D}function dL(){var l=X.H,f=l.useState()[0];return f=typeof f.then=="function"?zf(f):f,l=l.useState()[0],(Ln!==null?Ln.memoizedState:null)!==l&&(jt.flags|=1024),f}function M5(){var l=gd!==0;return gd=0,l}function L5(l,f,p){f.updateQueue=l.updateQueue,f.flags&=-2053,l.lanes&=~p}function V5(l){if(fd){for(l=l.memoizedState;l!==null;){var f=l.queue;f!==null&&(f.pending=null),l=l.next}fd=!1}i0=0,Xr=Ln=jt=null,su=!1,Wf=gd=0,cu=null}function Da(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xr===null?jt.memoizedState=Xr=l:Xr=Xr.next=l,Xr}function Zr(){if(Ln===null){var l=jt.alternate;l=l!==null?l.memoizedState:null}else l=Ln.next;var f=Xr===null?jt.memoizedState:Xr.next;if(f!==null)Xr=f,Ln=l;else{if(l===null)throw jt.alternate===null?Error(r(467)):Error(r(310));Ln=l,l={memoizedState:Ln.memoizedState,baseState:Ln.baseState,baseQueue:Ln.baseQueue,queue:Ln.queue,next:null},Xr===null?jt.memoizedState=Xr=l:Xr=Xr.next=l}return Xr}function I5(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function zf(l){var f=Wf;return Wf+=1,cu===null&&(cu=[]),l=qy(cu,l,f),f=jt,(Xr===null?f.memoizedState:Xr.next)===null&&(f=f.alternate,X.H=f===null||f.memoizedState===null?N6:P6),l}function dd(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return zf(l);if(l.$$typeof===x)return Wi(l)}throw Error(r(438,String(l)))}function A5(l){var f=null,p=jt.updateQueue;if(p!==null&&(f=p.memoCache),f==null){var T=jt.alternate;T!==null&&(T=T.updateQueue,T!==null&&(T=T.memoCache,T!=null&&(f={data:T.data.map(function(E){return E.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),p===null&&(p=I5(),jt.updateQueue=p),p.memoCache=f,p=f.data[f.index],p===void 0)for(p=f.data[f.index]=Array(l),T=0;T<l;T++)p[T]=F;return f.index++,p}function gc(l,f){return typeof f=="function"?f(l):f}function hd(l){var f=Zr();return N5(f,Ln,l)}function N5(l,f,p){var T=l.queue;if(T===null)throw Error(r(311));T.lastRenderedReducer=p;var E=l.baseQueue,D=T.pending;if(D!==null){if(E!==null){var U=E.next;E.next=D.next,D.next=U}f.baseQueue=E=D,T.pending=null}if(D=l.baseState,E===null)l.memoizedState=D;else{f=E.next;var q=U=null,ce=null,Re=f,Ge=!1;do{var He=Re.lane&-536870913;if(He!==Re.lane?(ln&He)===He:(i0&He)===He){var De=Re.revertLane;if(De===0)ce!==null&&(ce=ce.next={lane:0,revertLane:0,action:Re.action,hasEagerState:Re.hasEagerState,eagerState:Re.eagerState,next:null}),He===iu&&(Ge=!0);else if((i0&De)===De){Re=Re.next,De===iu&&(Ge=!0);continue}else He={lane:0,revertLane:Re.revertLane,action:Re.action,hasEagerState:Re.hasEagerState,eagerState:Re.eagerState,next:null},ce===null?(q=ce=He,U=D):ce=ce.next=He,jt.lanes|=De,f0|=De;He=Re.action,il&&p(D,He),D=Re.hasEagerState?Re.eagerState:p(D,He)}else De={lane:He,revertLane:Re.revertLane,action:Re.action,hasEagerState:Re.hasEagerState,eagerState:Re.eagerState,next:null},ce===null?(q=ce=De,U=D):ce=ce.next=De,jt.lanes|=He,f0|=He;Re=Re.next}while(Re!==null&&Re!==f);if(ce===null?U=D:ce.next=q,!K(D,l.memoizedState)&&(mi=!0,Ge&&(p=au,p!==null)))throw p;l.memoizedState=D,l.baseState=U,l.baseQueue=ce,T.lastRenderedState=D}return E===null&&(T.lanes=0),[l.memoizedState,T.dispatch]}function P5(l){var f=Zr(),p=f.queue;if(p===null)throw Error(r(311));p.lastRenderedReducer=l;var T=p.dispatch,E=p.pending,D=f.memoizedState;if(E!==null){p.pending=null;var U=E=E.next;do D=l(D,U.action),U=U.next;while(U!==E);K(D,f.memoizedState)||(mi=!0),f.memoizedState=D,f.baseQueue===null&&(f.baseState=D),p.lastRenderedState=D}return[D,T]}function t6(l,f,p){var T=jt,E=Zr(),D=vn;if(D){if(p===void 0)throw Error(r(407));p=p()}else p=f();var U=!K((Ln||E).memoizedState,p);U&&(E.memoizedState=p,mi=!0),E=E.queue;var q=i6.bind(null,T,E,l);if(Hf(2048,8,q,[l]),E.getSnapshot!==f||U||Xr!==null&&Xr.memoizedState.tag&1){if(T.flags|=2048,lu(9,pd(),r6.bind(null,T,E,p,f),null),zn===null)throw Error(r(349));D||(i0&124)!==0||n6(T,f,p)}return p}function n6(l,f,p){l.flags|=16384,l={getSnapshot:f,value:p},f=jt.updateQueue,f===null?(f=I5(),jt.updateQueue=f,f.stores=[l]):(p=f.stores,p===null?f.stores=[l]:p.push(l))}function r6(l,f,p,T){f.value=p,f.getSnapshot=T,a6(f)&&o6(l)}function i6(l,f,p){return p(function(){a6(f)&&o6(l)})}function a6(l){var f=l.getSnapshot;l=l.value;try{var p=f();return!K(l,p)}catch{return!0}}function o6(l){var f=eu(l,2);f!==null&&Ya(f,l,2)}function U5(l){var f=Da();if(typeof l=="function"){var p=l;if(l=p(),il){Ct(!0);try{p()}finally{Ct(!1)}}}return f.memoizedState=f.baseState=l,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gc,lastRenderedState:l},f}function s6(l,f,p,T){return l.baseState=p,N5(l,Ln,typeof T=="function"?T:gc)}function hL(l,f,p,T,E){if(vd(l))throw Error(r(485));if(l=f.action,l!==null){var D={payload:E,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(U){D.listeners.push(U)}};X.T!==null?p(!0):D.isTransition=!1,T(D),p=f.pending,p===null?(D.next=f.pending=D,c6(f,D)):(D.next=p.next,f.pending=p.next=D)}}function c6(l,f){var p=f.action,T=f.payload,E=l.state;if(f.isTransition){var D=X.T,U={};X.T=U;try{var q=p(E,T),ce=X.S;ce!==null&&ce(U,q),l6(l,f,q)}catch(Re){F5(l,f,Re)}finally{X.T=D}}else try{D=p(E,T),l6(l,f,D)}catch(Re){F5(l,f,Re)}}function l6(l,f,p){p!==null&&typeof p=="object"&&typeof p.then=="function"?p.then(function(T){u6(l,f,T)},function(T){return F5(l,f,T)}):u6(l,f,p)}function u6(l,f,p){f.status="fulfilled",f.value=p,f6(f),l.state=p,f=l.pending,f!==null&&(p=f.next,p===f?l.pending=null:(p=p.next,f.next=p,c6(l,p)))}function F5(l,f,p){var T=l.pending;if(l.pending=null,T!==null){T=T.next;do f.status="rejected",f.reason=p,f6(f),f=f.next;while(f!==T)}l.action=null}function f6(l){l=l.listeners;for(var f=0;f<l.length;f++)(0,l[f])()}function g6(l,f){return f}function d6(l,f){if(vn){var p=zn.formState;if(p!==null){e:{var T=jt;if(vn){if(Er){t:{for(var E=Er,D=ms;E.nodeType!==8;){if(!D){E=null;break t}if(E=Ko(E.nextSibling),E===null){E=null;break t}}D=E.data,E=D==="F!"||D==="F"?E:null}if(E){Er=Ko(E.nextSibling),T=E.data==="F!";break e}}el(T)}T=!1}T&&(f=p[0])}}return p=Da(),p.memoizedState=p.baseState=f,T={pending:null,lanes:0,dispatch:null,lastRenderedReducer:g6,lastRenderedState:f},p.queue=T,p=V6.bind(null,jt,T),T.dispatch=p,T=U5(!1),D=W5.bind(null,jt,!1,T.queue),T=Da(),E={state:f,dispatch:null,action:l,pending:null},T.queue=E,p=hL.bind(null,jt,E,D,p),E.dispatch=p,T.memoizedState=l,[f,p,!1]}function h6(l){var f=Zr();return p6(f,Ln,l)}function p6(l,f,p){if(f=N5(l,f,g6)[0],l=hd(gc)[0],typeof f=="object"&&f!==null&&typeof f.then=="function")try{var T=zf(f)}catch(U){throw U===Ff?cd:U}else T=f;f=Zr();var E=f.queue,D=E.dispatch;return p!==f.memoizedState&&(jt.flags|=2048,lu(9,pd(),pL.bind(null,E,p),null)),[T,D,l]}function pL(l,f){l.action=f}function m6(l){var f=Zr(),p=Ln;if(p!==null)return p6(f,p,l);Zr(),f=f.memoizedState,p=Zr();var T=p.queue.dispatch;return p.memoizedState=l,[f,T,!1]}function lu(l,f,p,T){return l={tag:l,create:p,deps:T,inst:f,next:null},f=jt.updateQueue,f===null&&(f=I5(),jt.updateQueue=f),p=f.lastEffect,p===null?f.lastEffect=l.next=l:(T=p.next,p.next=l,l.next=T,f.lastEffect=l),l}function pd(){return{destroy:void 0,resource:void 0}}function v6(){return Zr().memoizedState}function md(l,f,p,T){var E=Da();T=T===void 0?null:T,jt.flags|=l,E.memoizedState=lu(1|f,pd(),p,T)}function Hf(l,f,p,T){var E=Zr();T=T===void 0?null:T;var D=E.memoizedState.inst;Ln!==null&&T!==null&&_5(T,Ln.memoizedState.deps)?E.memoizedState=lu(f,D,p,T):(jt.flags|=l,E.memoizedState=lu(1|f,D,p,T))}function y6(l,f){md(8390656,8,l,f)}function T6(l,f){Hf(2048,8,l,f)}function C6(l,f){return Hf(4,2,l,f)}function S6(l,f){return Hf(4,4,l,f)}function w6(l,f){if(typeof f=="function"){l=l();var p=f(l);return function(){typeof p=="function"?p():f(null)}}if(f!=null)return l=l(),f.current=l,function(){f.current=null}}function x6(l,f,p){p=p!=null?p.concat([l]):null,Hf(4,4,w6.bind(null,f,l),p)}function k5(){}function E6(l,f){var p=Zr();f=f===void 0?null:f;var T=p.memoizedState;return f!==null&&_5(f,T[1])?T[0]:(p.memoizedState=[l,f],l)}function R6(l,f){var p=Zr();f=f===void 0?null:f;var T=p.memoizedState;if(f!==null&&_5(f,T[1]))return T[0];if(T=l(),il){Ct(!0);try{l()}finally{Ct(!1)}}return p.memoizedState=[T,f],T}function G5(l,f,p){return p===void 0||(i0&1073741824)!==0?l.memoizedState=f:(l.memoizedState=p,l=_9(),jt.lanes|=l,f0|=l,p)}function O6(l,f,p,T){return K(p,f)?p:ou.current!==null?(l=G5(l,p,T),K(l,f)||(mi=!0),l):(i0&42)===0?(mi=!0,l.memoizedState=p):(l=_9(),jt.lanes|=l,f0|=l,f)}function D6(l,f,p,T,E){var D=ie.p;ie.p=D!==0&&8>D?D:8;var U=X.T,q={};X.T=q,W5(l,!1,f,p);try{var ce=E(),Re=X.S;if(Re!==null&&Re(q,ce),ce!==null&&typeof ce=="object"&&typeof ce.then=="function"){var Ge=fL(ce,T);jf(l,f,Ge,Ka(l))}else jf(l,f,T,Ka(l))}catch(He){jf(l,f,{then:function(){},status:"rejected",reason:He},Ka())}finally{ie.p=D,X.T=U}}function mL(){}function B5(l,f,p,T){if(l.tag!==5)throw Error(r(476));var E=_6(l).queue;D6(l,E,f,ye,p===null?mL:function(){return b6(l),p(T)})}function _6(l){var f=l.memoizedState;if(f!==null)return f;f={memoizedState:ye,baseState:ye,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gc,lastRenderedState:ye},next:null};var p={};return f.next={memoizedState:p,baseState:p,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gc,lastRenderedState:p},next:null},l.memoizedState=f,l=l.alternate,l!==null&&(l.memoizedState=f),f}function b6(l){var f=_6(l).next.queue;jf(l,f,{},Ka())}function $5(){return Wi(ug)}function M6(){return Zr().memoizedState}function L6(){return Zr().memoizedState}function vL(l){for(var f=l.return;f!==null;){switch(f.tag){case 24:case 3:var p=Ka();l=n0(p);var T=r0(f,l,p);T!==null&&(Ya(T,f,p),Gf(T,f,p)),f={cache:y5()},l.payload=f;return}f=f.return}}function yL(l,f,p){var T=Ka();p={lane:T,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null},vd(l)?I6(f,p):(p=c5(l,f,p,T),p!==null&&(Ya(p,l,T),A6(p,f,T)))}function V6(l,f,p){var T=Ka();jf(l,f,p,T)}function jf(l,f,p,T){var E={lane:T,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null};if(vd(l))I6(f,E);else{var D=l.alternate;if(l.lanes===0&&(D===null||D.lanes===0)&&(D=f.lastRenderedReducer,D!==null))try{var U=f.lastRenderedState,q=D(U,p);if(E.hasEagerState=!0,E.eagerState=q,K(q,U))return ed(l,f,E,0),zn===null&&J1(),!1}catch{}finally{}if(p=c5(l,f,E,T),p!==null)return Ya(p,l,T),A6(p,f,T),!0}return!1}function W5(l,f,p,T){if(T={lane:2,revertLane:Sm(),action:T,hasEagerState:!1,eagerState:null,next:null},vd(l)){if(f)throw Error(r(479))}else f=c5(l,p,T,2),f!==null&&Ya(f,l,2)}function vd(l){var f=l.alternate;return l===jt||f!==null&&f===jt}function I6(l,f){su=fd=!0;var p=l.pending;p===null?f.next=f:(f.next=p.next,p.next=f),l.pending=f}function A6(l,f,p){if((p&4194048)!==0){var T=f.lanes;T&=l.pendingLanes,p|=T,f.lanes=p,yr(l,p)}}var yd={readContext:Wi,use:dd,useCallback:Pr,useContext:Pr,useEffect:Pr,useImperativeHandle:Pr,useLayoutEffect:Pr,useInsertionEffect:Pr,useMemo:Pr,useReducer:Pr,useRef:Pr,useState:Pr,useDebugValue:Pr,useDeferredValue:Pr,useTransition:Pr,useSyncExternalStore:Pr,useId:Pr,useHostTransitionStatus:Pr,useFormState:Pr,useActionState:Pr,useOptimistic:Pr,useMemoCache:Pr,useCacheRefresh:Pr},N6={readContext:Wi,use:dd,useCallback:function(l,f){return Da().memoizedState=[l,f===void 0?null:f],l},useContext:Wi,useEffect:y6,useImperativeHandle:function(l,f,p){p=p!=null?p.concat([l]):null,md(4194308,4,w6.bind(null,f,l),p)},useLayoutEffect:function(l,f){return md(4194308,4,l,f)},useInsertionEffect:function(l,f){md(4,2,l,f)},useMemo:function(l,f){var p=Da();f=f===void 0?null:f;var T=l();if(il){Ct(!0);try{l()}finally{Ct(!1)}}return p.memoizedState=[T,f],T},useReducer:function(l,f,p){var T=Da();if(p!==void 0){var E=p(f);if(il){Ct(!0);try{p(f)}finally{Ct(!1)}}}else E=f;return T.memoizedState=T.baseState=E,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:E},T.queue=l,l=l.dispatch=yL.bind(null,jt,l),[T.memoizedState,l]},useRef:function(l){var f=Da();return l={current:l},f.memoizedState=l},useState:function(l){l=U5(l);var f=l.queue,p=V6.bind(null,jt,f);return f.dispatch=p,[l.memoizedState,p]},useDebugValue:k5,useDeferredValue:function(l,f){var p=Da();return G5(p,l,f)},useTransition:function(){var l=U5(!1);return l=D6.bind(null,jt,l.queue,!0,!1),Da().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,f,p){var T=jt,E=Da();if(vn){if(p===void 0)throw Error(r(407));p=p()}else{if(p=f(),zn===null)throw Error(r(349));(ln&124)!==0||n6(T,f,p)}E.memoizedState=p;var D={value:p,getSnapshot:f};return E.queue=D,y6(i6.bind(null,T,D,l),[l]),T.flags|=2048,lu(9,pd(),r6.bind(null,T,D,p,f),null),p},useId:function(){var l=Da(),f=zn.identifierPrefix;if(vn){var p=lc,T=cc;p=(T&~(1<<32-xt(T)-1)).toString(32)+p,f="«"+f+"R"+p,p=gd++,0<p&&(f+="H"+p.toString(32)),f+="»"}else p=gL++,f="«"+f+"r"+p.toString(32)+"»";return l.memoizedState=f},useHostTransitionStatus:$5,useFormState:d6,useActionState:d6,useOptimistic:function(l){var f=Da();f.memoizedState=f.baseState=l;var p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=p,f=W5.bind(null,jt,!0,p),p.dispatch=f,[l,f]},useMemoCache:A5,useCacheRefresh:function(){return Da().memoizedState=vL.bind(null,jt)}},P6={readContext:Wi,use:dd,useCallback:E6,useContext:Wi,useEffect:T6,useImperativeHandle:x6,useInsertionEffect:C6,useLayoutEffect:S6,useMemo:R6,useReducer:hd,useRef:v6,useState:function(){return hd(gc)},useDebugValue:k5,useDeferredValue:function(l,f){var p=Zr();return O6(p,Ln.memoizedState,l,f)},useTransition:function(){var l=hd(gc)[0],f=Zr().memoizedState;return[typeof l=="boolean"?l:zf(l),f]},useSyncExternalStore:t6,useId:M6,useHostTransitionStatus:$5,useFormState:h6,useActionState:h6,useOptimistic:function(l,f){var p=Zr();return s6(p,Ln,l,f)},useMemoCache:A5,useCacheRefresh:L6},TL={readContext:Wi,use:dd,useCallback:E6,useContext:Wi,useEffect:T6,useImperativeHandle:x6,useInsertionEffect:C6,useLayoutEffect:S6,useMemo:R6,useReducer:P5,useRef:v6,useState:function(){return P5(gc)},useDebugValue:k5,useDeferredValue:function(l,f){var p=Zr();return Ln===null?G5(p,l,f):O6(p,Ln.memoizedState,l,f)},useTransition:function(){var l=P5(gc)[0],f=Zr().memoizedState;return[typeof l=="boolean"?l:zf(l),f]},useSyncExternalStore:t6,useId:M6,useHostTransitionStatus:$5,useFormState:m6,useActionState:m6,useOptimistic:function(l,f){var p=Zr();return Ln!==null?s6(p,Ln,l,f):(p.baseState=l,[l,p.queue.dispatch])},useMemoCache:A5,useCacheRefresh:L6},uu=null,qf=0;function Td(l){var f=qf;return qf+=1,uu===null&&(uu=[]),qy(uu,l,f)}function Kf(l,f){f=f.props.ref,l.ref=f!==void 0?f:null}function Cd(l,f){throw f.$$typeof===g?Error(r(525)):(l=Object.prototype.toString.call(f),Error(r(31,l==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":l)))}function U6(l){var f=l._init;return f(l._payload)}function F6(l){function f(Ce,me){if(l){var xe=Ce.deletions;xe===null?(Ce.deletions=[me],Ce.flags|=16):xe.push(me)}}function p(Ce,me){if(!l)return null;for(;me!==null;)f(Ce,me),me=me.sibling;return null}function T(Ce){for(var me=new Map;Ce!==null;)Ce.key!==null?me.set(Ce.key,Ce):me.set(Ce.index,Ce),Ce=Ce.sibling;return me}function E(Ce,me){return Ce=sc(Ce,me),Ce.index=0,Ce.sibling=null,Ce}function D(Ce,me,xe){return Ce.index=xe,l?(xe=Ce.alternate,xe!==null?(xe=xe.index,xe<me?(Ce.flags|=67108866,me):xe):(Ce.flags|=67108866,me)):(Ce.flags|=1048576,me)}function U(Ce){return l&&Ce.alternate===null&&(Ce.flags|=67108866),Ce}function q(Ce,me,xe,$e){return me===null||me.tag!==6?(me=u5(xe,Ce.mode,$e),me.return=Ce,me):(me=E(me,xe),me.return=Ce,me)}function ce(Ce,me,xe,$e){var gt=xe.type;return gt===y?Ge(Ce,me,xe.props.children,$e,xe.key):me!==null&&(me.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===G&&U6(gt)===me.type)?(me=E(me,xe.props),Kf(me,xe),me.return=Ce,me):(me=nd(xe.type,xe.key,xe.props,null,Ce.mode,$e),Kf(me,xe),me.return=Ce,me)}function Re(Ce,me,xe,$e){return me===null||me.tag!==4||me.stateNode.containerInfo!==xe.containerInfo||me.stateNode.implementation!==xe.implementation?(me=f5(xe,Ce.mode,$e),me.return=Ce,me):(me=E(me,xe.children||[]),me.return=Ce,me)}function Ge(Ce,me,xe,$e,gt){return me===null||me.tag!==7?(me=X0(xe,Ce.mode,$e,gt),me.return=Ce,me):(me=E(me,xe),me.return=Ce,me)}function He(Ce,me,xe){if(typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint")return me=u5(""+me,Ce.mode,xe),me.return=Ce,me;if(typeof me=="object"&&me!==null){switch(me.$$typeof){case h:return xe=nd(me.type,me.key,me.props,null,Ce.mode,xe),Kf(xe,me),xe.return=Ce,xe;case m:return me=f5(me,Ce.mode,xe),me.return=Ce,me;case G:var $e=me._init;return me=$e(me._payload),He(Ce,me,xe)}if(le(me)||z(me))return me=X0(me,Ce.mode,xe,null),me.return=Ce,me;if(typeof me.then=="function")return He(Ce,Td(me),xe);if(me.$$typeof===x)return He(Ce,od(Ce,me),xe);Cd(Ce,me)}return null}function De(Ce,me,xe,$e){var gt=me!==null?me.key:null;if(typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint")return gt!==null?null:q(Ce,me,""+xe,$e);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case h:return xe.key===gt?ce(Ce,me,xe,$e):null;case m:return xe.key===gt?Re(Ce,me,xe,$e):null;case G:return gt=xe._init,xe=gt(xe._payload),De(Ce,me,xe,$e)}if(le(xe)||z(xe))return gt!==null?null:Ge(Ce,me,xe,$e,null);if(typeof xe.then=="function")return De(Ce,me,Td(xe),$e);if(xe.$$typeof===x)return De(Ce,me,od(Ce,xe),$e);Cd(Ce,xe)}return null}function be(Ce,me,xe,$e,gt){if(typeof $e=="string"&&$e!==""||typeof $e=="number"||typeof $e=="bigint")return Ce=Ce.get(xe)||null,q(me,Ce,""+$e,gt);if(typeof $e=="object"&&$e!==null){switch($e.$$typeof){case h:return Ce=Ce.get($e.key===null?xe:$e.key)||null,ce(me,Ce,$e,gt);case m:return Ce=Ce.get($e.key===null?xe:$e.key)||null,Re(me,Ce,$e,gt);case G:var Kt=$e._init;return $e=Kt($e._payload),be(Ce,me,xe,$e,gt)}if(le($e)||z($e))return Ce=Ce.get(xe)||null,Ge(me,Ce,$e,gt,null);if(typeof $e.then=="function")return be(Ce,me,xe,Td($e),gt);if($e.$$typeof===x)return be(Ce,me,xe,od(me,$e),gt);Cd(me,$e)}return null}function Vt(Ce,me,xe,$e){for(var gt=null,Kt=null,Tt=me,Lt=me=0,yi=null;Tt!==null&&Lt<xe.length;Lt++){Tt.index>Lt?(yi=Tt,Tt=null):yi=Tt.sibling;var mn=De(Ce,Tt,xe[Lt],$e);if(mn===null){Tt===null&&(Tt=yi);break}l&&Tt&&mn.alternate===null&&f(Ce,Tt),me=D(mn,me,Lt),Kt===null?gt=mn:Kt.sibling=mn,Kt=mn,Tt=yi}if(Lt===xe.length)return p(Ce,Tt),vn&&Q0(Ce,Lt),gt;if(Tt===null){for(;Lt<xe.length;Lt++)Tt=He(Ce,xe[Lt],$e),Tt!==null&&(me=D(Tt,me,Lt),Kt===null?gt=Tt:Kt.sibling=Tt,Kt=Tt);return vn&&Q0(Ce,Lt),gt}for(Tt=T(Tt);Lt<xe.length;Lt++)yi=be(Tt,Ce,Lt,xe[Lt],$e),yi!==null&&(l&&yi.alternate!==null&&Tt.delete(yi.key===null?Lt:yi.key),me=D(yi,me,Lt),Kt===null?gt=yi:Kt.sibling=yi,Kt=yi);return l&&Tt.forEach(function(C0){return f(Ce,C0)}),vn&&Q0(Ce,Lt),gt}function bt(Ce,me,xe,$e){if(xe==null)throw Error(r(151));for(var gt=null,Kt=null,Tt=me,Lt=me=0,yi=null,mn=xe.next();Tt!==null&&!mn.done;Lt++,mn=xe.next()){Tt.index>Lt?(yi=Tt,Tt=null):yi=Tt.sibling;var C0=De(Ce,Tt,mn.value,$e);if(C0===null){Tt===null&&(Tt=yi);break}l&&Tt&&C0.alternate===null&&f(Ce,Tt),me=D(C0,me,Lt),Kt===null?gt=C0:Kt.sibling=C0,Kt=C0,Tt=yi}if(mn.done)return p(Ce,Tt),vn&&Q0(Ce,Lt),gt;if(Tt===null){for(;!mn.done;Lt++,mn=xe.next())mn=He(Ce,mn.value,$e),mn!==null&&(me=D(mn,me,Lt),Kt===null?gt=mn:Kt.sibling=mn,Kt=mn);return vn&&Q0(Ce,Lt),gt}for(Tt=T(Tt);!mn.done;Lt++,mn=xe.next())mn=be(Tt,Ce,Lt,mn.value,$e),mn!==null&&(l&&mn.alternate!==null&&Tt.delete(mn.key===null?Lt:mn.key),me=D(mn,me,Lt),Kt===null?gt=mn:Kt.sibling=mn,Kt=mn);return l&&Tt.forEach(function(CV){return f(Ce,CV)}),vn&&Q0(Ce,Lt),gt}function In(Ce,me,xe,$e){if(typeof xe=="object"&&xe!==null&&xe.type===y&&xe.key===null&&(xe=xe.props.children),typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case h:e:{for(var gt=xe.key;me!==null;){if(me.key===gt){if(gt=xe.type,gt===y){if(me.tag===7){p(Ce,me.sibling),$e=E(me,xe.props.children),$e.return=Ce,Ce=$e;break e}}else if(me.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===G&&U6(gt)===me.type){p(Ce,me.sibling),$e=E(me,xe.props),Kf($e,xe),$e.return=Ce,Ce=$e;break e}p(Ce,me);break}else f(Ce,me);me=me.sibling}xe.type===y?($e=X0(xe.props.children,Ce.mode,$e,xe.key),$e.return=Ce,Ce=$e):($e=nd(xe.type,xe.key,xe.props,null,Ce.mode,$e),Kf($e,xe),$e.return=Ce,Ce=$e)}return U(Ce);case m:e:{for(gt=xe.key;me!==null;){if(me.key===gt)if(me.tag===4&&me.stateNode.containerInfo===xe.containerInfo&&me.stateNode.implementation===xe.implementation){p(Ce,me.sibling),$e=E(me,xe.children||[]),$e.return=Ce,Ce=$e;break e}else{p(Ce,me);break}else f(Ce,me);me=me.sibling}$e=f5(xe,Ce.mode,$e),$e.return=Ce,Ce=$e}return U(Ce);case G:return gt=xe._init,xe=gt(xe._payload),In(Ce,me,xe,$e)}if(le(xe))return Vt(Ce,me,xe,$e);if(z(xe)){if(gt=z(xe),typeof gt!="function")throw Error(r(150));return xe=gt.call(xe),bt(Ce,me,xe,$e)}if(typeof xe.then=="function")return In(Ce,me,Td(xe),$e);if(xe.$$typeof===x)return In(Ce,me,od(Ce,xe),$e);Cd(Ce,xe)}return typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint"?(xe=""+xe,me!==null&&me.tag===6?(p(Ce,me.sibling),$e=E(me,xe),$e.return=Ce,Ce=$e):(p(Ce,me),$e=u5(xe,Ce.mode,$e),$e.return=Ce,Ce=$e),U(Ce)):p(Ce,me)}return function(Ce,me,xe,$e){try{qf=0;var gt=In(Ce,me,xe,$e);return uu=null,gt}catch(Tt){if(Tt===Ff||Tt===cd)throw Tt;var Kt=za(29,Tt,null,Ce.mode);return Kt.lanes=$e,Kt.return=Ce,Kt}finally{}}}var fu=F6(!0),k6=F6(!1),So=ae(null),vs=null;function a0(l){var f=l.alternate;ue(ci,ci.current&1),ue(So,l),vs===null&&(f===null||ou.current!==null||f.memoizedState!==null)&&(vs=l)}function G6(l){if(l.tag===22){if(ue(ci,ci.current),ue(So,l),vs===null){var f=l.alternate;f!==null&&f.memoizedState!==null&&(vs=l)}}else o0()}function o0(){ue(ci,ci.current),ue(So,So.current)}function dc(l){fe(So),vs===l&&(vs=null),fe(ci)}var ci=ae(0);function Sd(l){for(var f=l;f!==null;){if(f.tag===13){var p=f.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||p.data==="$?"||Im(p)))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}function z5(l,f,p,T){f=l.memoizedState,p=p(T,f),p=p==null?f:d({},f,p),l.memoizedState=p,l.lanes===0&&(l.updateQueue.baseState=p)}var H5={enqueueSetState:function(l,f,p){l=l._reactInternals;var T=Ka(),E=n0(T);E.payload=f,p!=null&&(E.callback=p),f=r0(l,E,T),f!==null&&(Ya(f,l,T),Gf(f,l,T))},enqueueReplaceState:function(l,f,p){l=l._reactInternals;var T=Ka(),E=n0(T);E.tag=1,E.payload=f,p!=null&&(E.callback=p),f=r0(l,E,T),f!==null&&(Ya(f,l,T),Gf(f,l,T))},enqueueForceUpdate:function(l,f){l=l._reactInternals;var p=Ka(),T=n0(p);T.tag=2,f!=null&&(T.callback=f),f=r0(l,T,p),f!==null&&(Ya(f,l,p),Gf(f,l,p))}};function B6(l,f,p,T,E,D,U){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(T,D,U):f.prototype&&f.prototype.isPureReactComponent?!te(p,T)||!te(E,D):!0}function $6(l,f,p,T){l=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(p,T),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(p,T),f.state!==l&&H5.enqueueReplaceState(f,f.state,null)}function al(l,f){var p=f;if("ref"in f){p={};for(var T in f)T!=="ref"&&(p[T]=f[T])}if(l=l.defaultProps){p===f&&(p=d({},p));for(var E in l)p[E]===void 0&&(p[E]=l[E])}return p}var wd=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",l);return}console.error(l)};function W6(l){wd(l)}function z6(l){console.error(l)}function H6(l){wd(l)}function xd(l,f){try{var p=l.onUncaughtError;p(f.value,{componentStack:f.stack})}catch(T){setTimeout(function(){throw T})}}function j6(l,f,p){try{var T=l.onCaughtError;T(p.value,{componentStack:p.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(E){setTimeout(function(){throw E})}}function j5(l,f,p){return p=n0(p),p.tag=3,p.payload={element:null},p.callback=function(){xd(l,f)},p}function q6(l){return l=n0(l),l.tag=3,l}function K6(l,f,p,T){var E=p.type.getDerivedStateFromError;if(typeof E=="function"){var D=T.value;l.payload=function(){return E(D)},l.callback=function(){j6(f,p,T)}}var U=p.stateNode;U!==null&&typeof U.componentDidCatch=="function"&&(l.callback=function(){j6(f,p,T),typeof E!="function"&&(g0===null?g0=new Set([this]):g0.add(this));var q=T.stack;this.componentDidCatch(T.value,{componentStack:q!==null?q:""})})}function CL(l,f,p,T,E){if(p.flags|=32768,T!==null&&typeof T=="object"&&typeof T.then=="function"){if(f=p.alternate,f!==null&&Nf(f,p,E,!0),p=So.current,p!==null){switch(p.tag){case 13:return vs===null?mm():p.alternate===null&&Rr===0&&(Rr=3),p.flags&=-257,p.flags|=65536,p.lanes=E,T===S5?p.flags|=16384:(f=p.updateQueue,f===null?p.updateQueue=new Set([T]):f.add(T),ym(l,T,E)),!1;case 22:return p.flags|=65536,T===S5?p.flags|=16384:(f=p.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([T])},p.updateQueue=f):(p=f.retryQueue,p===null?f.retryQueue=new Set([T]):p.add(T)),ym(l,T,E)),!1}throw Error(r(435,p.tag))}return ym(l,T,E),mm(),!1}if(vn)return f=So.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=E,T!==h5&&(l=Error(r(422),{cause:T}),Af(vo(l,p)))):(T!==h5&&(f=Error(r(423),{cause:T}),Af(vo(f,p))),l=l.current.alternate,l.flags|=65536,E&=-E,l.lanes|=E,T=vo(T,p),E=j5(l.stateNode,T,E),E5(l,E),Rr!==4&&(Rr=2)),!1;var D=Error(r(520),{cause:T});if(D=vo(D,p),tg===null?tg=[D]:tg.push(D),Rr!==4&&(Rr=2),f===null)return!0;T=vo(T,p),p=f;do{switch(p.tag){case 3:return p.flags|=65536,l=E&-E,p.lanes|=l,l=j5(p.stateNode,T,l),E5(p,l),!1;case 1:if(f=p.type,D=p.stateNode,(p.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||D!==null&&typeof D.componentDidCatch=="function"&&(g0===null||!g0.has(D))))return p.flags|=65536,E&=-E,p.lanes|=E,E=q6(E),K6(E,l,p,T),E5(p,E),!1}p=p.return}while(p!==null);return!1}var Y6=Error(r(461)),mi=!1;function Vi(l,f,p,T){f.child=l===null?k6(f,null,p,T):fu(f,l.child,p,T)}function X6(l,f,p,T,E){p=p.render;var D=f.ref;if("ref"in T){var U={};for(var q in T)q!=="ref"&&(U[q]=T[q])}else U=T;return nl(f),T=b5(l,f,p,U,D,E),q=M5(),l!==null&&!mi?(L5(l,f,E),hc(l,f,E)):(vn&&q&&g5(f),f.flags|=1,Vi(l,f,T,E),f.child)}function Z6(l,f,p,T,E){if(l===null){var D=p.type;return typeof D=="function"&&!l5(D)&&D.defaultProps===void 0&&p.compare===null?(f.tag=15,f.type=D,Q6(l,f,D,T,E)):(l=nd(p.type,null,T,f,f.mode,E),l.ref=f.ref,l.return=f,f.child=l)}if(D=l.child,!em(l,E)){var U=D.memoizedProps;if(p=p.compare,p=p!==null?p:te,p(U,T)&&l.ref===f.ref)return hc(l,f,E)}return f.flags|=1,l=sc(D,T),l.ref=f.ref,l.return=f,f.child=l}function Q6(l,f,p,T,E){if(l!==null){var D=l.memoizedProps;if(te(D,T)&&l.ref===f.ref)if(mi=!1,f.pendingProps=T=D,em(l,E))(l.flags&131072)!==0&&(mi=!0);else return f.lanes=l.lanes,hc(l,f,E)}return q5(l,f,p,T,E)}function J6(l,f,p){var T=f.pendingProps,E=T.children,D=l!==null?l.memoizedState:null;if(T.mode==="hidden"){if((f.flags&128)!==0){if(T=D!==null?D.baseLanes|p:p,l!==null){for(E=f.child=l.child,D=0;E!==null;)D=D|E.lanes|E.childLanes,E=E.sibling;f.childLanes=D&~T}else f.childLanes=0,f.child=null;return e9(l,f,T,p)}if((p&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},l!==null&&sd(f,D!==null?D.cachePool:null),D!==null?Qy(f,D):O5(),G6(f);else return f.lanes=f.childLanes=536870912,e9(l,f,D!==null?D.baseLanes|p:p,p)}else D!==null?(sd(f,D.cachePool),Qy(f,D),o0(),f.memoizedState=null):(l!==null&&sd(f,null),O5(),o0());return Vi(l,f,E,p),f.child}function e9(l,f,p,T){var E=C5();return E=E===null?null:{parent:si._currentValue,pool:E},f.memoizedState={baseLanes:p,cachePool:E},l!==null&&sd(f,null),O5(),G6(f),l!==null&&Nf(l,f,T,!0),null}function Ed(l,f){var p=f.ref;if(p===null)l!==null&&l.ref!==null&&(f.flags|=4194816);else{if(typeof p!="function"&&typeof p!="object")throw Error(r(284));(l===null||l.ref!==p)&&(f.flags|=4194816)}}function q5(l,f,p,T,E){return nl(f),p=b5(l,f,p,T,void 0,E),T=M5(),l!==null&&!mi?(L5(l,f,E),hc(l,f,E)):(vn&&T&&g5(f),f.flags|=1,Vi(l,f,p,E),f.child)}function t9(l,f,p,T,E,D){return nl(f),f.updateQueue=null,p=e6(f,T,p,E),Jy(l),T=M5(),l!==null&&!mi?(L5(l,f,D),hc(l,f,D)):(vn&&T&&g5(f),f.flags|=1,Vi(l,f,p,D),f.child)}function n9(l,f,p,T,E){if(nl(f),f.stateNode===null){var D=tu,U=p.contextType;typeof U=="object"&&U!==null&&(D=Wi(U)),D=new p(T,D),f.memoizedState=D.state!==null&&D.state!==void 0?D.state:null,D.updater=H5,f.stateNode=D,D._reactInternals=f,D=f.stateNode,D.props=T,D.state=f.memoizedState,D.refs={},w5(f),U=p.contextType,D.context=typeof U=="object"&&U!==null?Wi(U):tu,D.state=f.memoizedState,U=p.getDerivedStateFromProps,typeof U=="function"&&(z5(f,p,U,T),D.state=f.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof D.getSnapshotBeforeUpdate=="function"||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(U=D.state,typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount(),U!==D.state&&H5.enqueueReplaceState(D,D.state,null),$f(f,T,D,E),Bf(),D.state=f.memoizedState),typeof D.componentDidMount=="function"&&(f.flags|=4194308),T=!0}else if(l===null){D=f.stateNode;var q=f.memoizedProps,ce=al(p,q);D.props=ce;var Re=D.context,Ge=p.contextType;U=tu,typeof Ge=="object"&&Ge!==null&&(U=Wi(Ge));var He=p.getDerivedStateFromProps;Ge=typeof He=="function"||typeof D.getSnapshotBeforeUpdate=="function",q=f.pendingProps!==q,Ge||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(q||Re!==U)&&$6(f,D,T,U),t0=!1;var De=f.memoizedState;D.state=De,$f(f,T,D,E),Bf(),Re=f.memoizedState,q||De!==Re||t0?(typeof He=="function"&&(z5(f,p,He,T),Re=f.memoizedState),(ce=t0||B6(f,p,ce,T,De,Re,U))?(Ge||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount()),typeof D.componentDidMount=="function"&&(f.flags|=4194308)):(typeof D.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=T,f.memoizedState=Re),D.props=T,D.state=Re,D.context=U,T=ce):(typeof D.componentDidMount=="function"&&(f.flags|=4194308),T=!1)}else{D=f.stateNode,x5(l,f),U=f.memoizedProps,Ge=al(p,U),D.props=Ge,He=f.pendingProps,De=D.context,Re=p.contextType,ce=tu,typeof Re=="object"&&Re!==null&&(ce=Wi(Re)),q=p.getDerivedStateFromProps,(Re=typeof q=="function"||typeof D.getSnapshotBeforeUpdate=="function")||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(U!==He||De!==ce)&&$6(f,D,T,ce),t0=!1,De=f.memoizedState,D.state=De,$f(f,T,D,E),Bf();var be=f.memoizedState;U!==He||De!==be||t0||l!==null&&l.dependencies!==null&&ad(l.dependencies)?(typeof q=="function"&&(z5(f,p,q,T),be=f.memoizedState),(Ge=t0||B6(f,p,Ge,T,De,be,ce)||l!==null&&l.dependencies!==null&&ad(l.dependencies))?(Re||typeof D.UNSAFE_componentWillUpdate!="function"&&typeof D.componentWillUpdate!="function"||(typeof D.componentWillUpdate=="function"&&D.componentWillUpdate(T,be,ce),typeof D.UNSAFE_componentWillUpdate=="function"&&D.UNSAFE_componentWillUpdate(T,be,ce)),typeof D.componentDidUpdate=="function"&&(f.flags|=4),typeof D.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof D.componentDidUpdate!="function"||U===l.memoizedProps&&De===l.memoizedState||(f.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||U===l.memoizedProps&&De===l.memoizedState||(f.flags|=1024),f.memoizedProps=T,f.memoizedState=be),D.props=T,D.state=be,D.context=ce,T=Ge):(typeof D.componentDidUpdate!="function"||U===l.memoizedProps&&De===l.memoizedState||(f.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||U===l.memoizedProps&&De===l.memoizedState||(f.flags|=1024),T=!1)}return D=T,Ed(l,f),T=(f.flags&128)!==0,D||T?(D=f.stateNode,p=T&&typeof p.getDerivedStateFromError!="function"?null:D.render(),f.flags|=1,l!==null&&T?(f.child=fu(f,l.child,null,E),f.child=fu(f,null,p,E)):Vi(l,f,p,E),f.memoizedState=D.state,l=f.child):l=hc(l,f,E),l}function r9(l,f,p,T){return If(),f.flags|=256,Vi(l,f,p,T),f.child}var K5={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Y5(l){return{baseLanes:l,cachePool:zy()}}function X5(l,f,p){return l=l!==null?l.childLanes&~p:0,f&&(l|=wo),l}function i9(l,f,p){var T=f.pendingProps,E=!1,D=(f.flags&128)!==0,U;if((U=D)||(U=l!==null&&l.memoizedState===null?!1:(ci.current&2)!==0),U&&(E=!0,f.flags&=-129),U=(f.flags&32)!==0,f.flags&=-33,l===null){if(vn){if(E?a0(f):o0(),vn){var q=Er,ce;if(ce=q){e:{for(ce=q,q=ms;ce.nodeType!==8;){if(!q){q=null;break e}if(ce=Ko(ce.nextSibling),ce===null){q=null;break e}}q=ce}q!==null?(f.memoizedState={dehydrated:q,treeContext:Z0!==null?{id:cc,overflow:lc}:null,retryLane:536870912,hydrationErrors:null},ce=za(18,null,null,0),ce.stateNode=q,ce.return=f,f.child=ce,sa=f,Er=null,ce=!0):ce=!1}ce||el(f)}if(q=f.memoizedState,q!==null&&(q=q.dehydrated,q!==null))return Im(q)?f.lanes=32:f.lanes=536870912,null;dc(f)}return q=T.children,T=T.fallback,E?(o0(),E=f.mode,q=Rd({mode:"hidden",children:q},E),T=X0(T,E,p,null),q.return=f,T.return=f,q.sibling=T,f.child=q,E=f.child,E.memoizedState=Y5(p),E.childLanes=X5(l,U,p),f.memoizedState=K5,T):(a0(f),Z5(f,q))}if(ce=l.memoizedState,ce!==null&&(q=ce.dehydrated,q!==null)){if(D)f.flags&256?(a0(f),f.flags&=-257,f=Q5(l,f,p)):f.memoizedState!==null?(o0(),f.child=l.child,f.flags|=128,f=null):(o0(),E=T.fallback,q=f.mode,T=Rd({mode:"visible",children:T.children},q),E=X0(E,q,p,null),E.flags|=2,T.return=f,E.return=f,T.sibling=E,f.child=T,fu(f,l.child,null,p),T=f.child,T.memoizedState=Y5(p),T.childLanes=X5(l,U,p),f.memoizedState=K5,f=E);else if(a0(f),Im(q)){if(U=q.nextSibling&&q.nextSibling.dataset,U)var Re=U.dgst;U=Re,T=Error(r(419)),T.stack="",T.digest=U,Af({value:T,source:null,stack:null}),f=Q5(l,f,p)}else if(mi||Nf(l,f,p,!1),U=(p&l.childLanes)!==0,mi||U){if(U=zn,U!==null&&(T=p&-p,T=(T&42)!==0?1:ir(T),T=(T&(U.suspendedLanes|p))!==0?0:T,T!==0&&T!==ce.retryLane))throw ce.retryLane=T,eu(l,T),Ya(U,l,T),Y6;q.data==="$?"||mm(),f=Q5(l,f,p)}else q.data==="$?"?(f.flags|=192,f.child=l.child,f=null):(l=ce.treeContext,Er=Ko(q.nextSibling),sa=f,vn=!0,J0=null,ms=!1,l!==null&&(To[Co++]=cc,To[Co++]=lc,To[Co++]=Z0,cc=l.id,lc=l.overflow,Z0=f),f=Z5(f,T.children),f.flags|=4096);return f}return E?(o0(),E=T.fallback,q=f.mode,ce=l.child,Re=ce.sibling,T=sc(ce,{mode:"hidden",children:T.children}),T.subtreeFlags=ce.subtreeFlags&65011712,Re!==null?E=sc(Re,E):(E=X0(E,q,p,null),E.flags|=2),E.return=f,T.return=f,T.sibling=E,f.child=T,T=E,E=f.child,q=l.child.memoizedState,q===null?q=Y5(p):(ce=q.cachePool,ce!==null?(Re=si._currentValue,ce=ce.parent!==Re?{parent:Re,pool:Re}:ce):ce=zy(),q={baseLanes:q.baseLanes|p,cachePool:ce}),E.memoizedState=q,E.childLanes=X5(l,U,p),f.memoizedState=K5,T):(a0(f),p=l.child,l=p.sibling,p=sc(p,{mode:"visible",children:T.children}),p.return=f,p.sibling=null,l!==null&&(U=f.deletions,U===null?(f.deletions=[l],f.flags|=16):U.push(l)),f.child=p,f.memoizedState=null,p)}function Z5(l,f){return f=Rd({mode:"visible",children:f},l.mode),f.return=l,l.child=f}function Rd(l,f){return l=za(22,l,null,f),l.lanes=0,l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},l}function Q5(l,f,p){return fu(f,l.child,null,p),l=Z5(f,f.pendingProps.children),l.flags|=2,f.memoizedState=null,l}function a9(l,f,p){l.lanes|=f;var T=l.alternate;T!==null&&(T.lanes|=f),m5(l.return,f,p)}function J5(l,f,p,T,E){var D=l.memoizedState;D===null?l.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:T,tail:p,tailMode:E}:(D.isBackwards=f,D.rendering=null,D.renderingStartTime=0,D.last=T,D.tail=p,D.tailMode=E)}function o9(l,f,p){var T=f.pendingProps,E=T.revealOrder,D=T.tail;if(Vi(l,f,T.children,p),T=ci.current,(T&2)!==0)T=T&1|2,f.flags|=128;else{if(l!==null&&(l.flags&128)!==0)e:for(l=f.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&a9(l,p,f);else if(l.tag===19)a9(l,p,f);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===f)break e;for(;l.sibling===null;){if(l.return===null||l.return===f)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}T&=1}switch(ue(ci,T),E){case"forwards":for(p=f.child,E=null;p!==null;)l=p.alternate,l!==null&&Sd(l)===null&&(E=p),p=p.sibling;p=E,p===null?(E=f.child,f.child=null):(E=p.sibling,p.sibling=null),J5(f,!1,E,p,D);break;case"backwards":for(p=null,E=f.child,f.child=null;E!==null;){if(l=E.alternate,l!==null&&Sd(l)===null){f.child=E;break}l=E.sibling,E.sibling=p,p=E,E=l}J5(f,!0,p,null,D);break;case"together":J5(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function hc(l,f,p){if(l!==null&&(f.dependencies=l.dependencies),f0|=f.lanes,(p&f.childLanes)===0)if(l!==null){if(Nf(l,f,p,!1),(p&f.childLanes)===0)return null}else return null;if(l!==null&&f.child!==l.child)throw Error(r(153));if(f.child!==null){for(l=f.child,p=sc(l,l.pendingProps),f.child=p,p.return=f;l.sibling!==null;)l=l.sibling,p=p.sibling=sc(l,l.pendingProps),p.return=f;p.sibling=null}return f.child}function em(l,f){return(l.lanes&f)!==0?!0:(l=l.dependencies,!!(l!==null&&ad(l)))}function SL(l,f,p){switch(f.tag){case 3:tt(f,f.stateNode.containerInfo),e0(f,si,l.memoizedState.cache),If();break;case 27:case 5:Bt(f);break;case 4:tt(f,f.stateNode.containerInfo);break;case 10:e0(f,f.type,f.memoizedProps.value);break;case 13:var T=f.memoizedState;if(T!==null)return T.dehydrated!==null?(a0(f),f.flags|=128,null):(p&f.child.childLanes)!==0?i9(l,f,p):(a0(f),l=hc(l,f,p),l!==null?l.sibling:null);a0(f);break;case 19:var E=(l.flags&128)!==0;if(T=(p&f.childLanes)!==0,T||(Nf(l,f,p,!1),T=(p&f.childLanes)!==0),E){if(T)return o9(l,f,p);f.flags|=128}if(E=f.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),ue(ci,ci.current),T)break;return null;case 22:case 23:return f.lanes=0,J6(l,f,p);case 24:e0(f,si,l.memoizedState.cache)}return hc(l,f,p)}function s9(l,f,p){if(l!==null)if(l.memoizedProps!==f.pendingProps)mi=!0;else{if(!em(l,p)&&(f.flags&128)===0)return mi=!1,SL(l,f,p);mi=(l.flags&131072)!==0}else mi=!1,vn&&(f.flags&1048576)!==0&&Uy(f,id,f.index);switch(f.lanes=0,f.tag){case 16:e:{l=f.pendingProps;var T=f.elementType,E=T._init;if(T=E(T._payload),f.type=T,typeof T=="function")l5(T)?(l=al(T,l),f.tag=1,f=n9(null,f,T,l,p)):(f.tag=0,f=q5(null,f,T,l,p));else{if(T!=null){if(E=T.$$typeof,E===R){f.tag=11,f=X6(null,f,T,l,p);break e}else if(E===I){f.tag=14,f=Z6(null,f,T,l,p);break e}}throw f=Q(T)||T,Error(r(306,f,""))}}return f;case 0:return q5(l,f,f.type,f.pendingProps,p);case 1:return T=f.type,E=al(T,f.pendingProps),n9(l,f,T,E,p);case 3:e:{if(tt(f,f.stateNode.containerInfo),l===null)throw Error(r(387));T=f.pendingProps;var D=f.memoizedState;E=D.element,x5(l,f),$f(f,T,null,p);var U=f.memoizedState;if(T=U.cache,e0(f,si,T),T!==D.cache&&v5(f,[si],p,!0),Bf(),T=U.element,D.isDehydrated)if(D={element:T,isDehydrated:!1,cache:U.cache},f.updateQueue.baseState=D,f.memoizedState=D,f.flags&256){f=r9(l,f,T,p);break e}else if(T!==E){E=vo(Error(r(424)),f),Af(E),f=r9(l,f,T,p);break e}else{switch(l=f.stateNode.containerInfo,l.nodeType){case 9:l=l.body;break;default:l=l.nodeName==="HTML"?l.ownerDocument.body:l}for(Er=Ko(l.firstChild),sa=f,vn=!0,J0=null,ms=!0,p=k6(f,null,T,p),f.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling}else{if(If(),T===E){f=hc(l,f,p);break e}Vi(l,f,T,p)}f=f.child}return f;case 26:return Ed(l,f),l===null?(p=f7(f.type,null,f.pendingProps,null))?f.memoizedState=p:vn||(p=f.type,l=f.pendingProps,T=kd(Ze.current).createElement(p),T[ot]=f,T[Ot]=l,Ai(T,p,l),vt(T),f.stateNode=T):f.memoizedState=f7(f.type,l.memoizedProps,f.pendingProps,l.memoizedState),null;case 27:return Bt(f),l===null&&vn&&(T=f.stateNode=c7(f.type,f.pendingProps,Ze.current),sa=f,ms=!0,E=Er,p0(f.type)?(Am=E,Er=Ko(T.firstChild)):Er=E),Vi(l,f,f.pendingProps.children,p),Ed(l,f),l===null&&(f.flags|=4194304),f.child;case 5:return l===null&&vn&&((E=T=Er)&&(T=YL(T,f.type,f.pendingProps,ms),T!==null?(f.stateNode=T,sa=f,Er=Ko(T.firstChild),ms=!1,E=!0):E=!1),E||el(f)),Bt(f),E=f.type,D=f.pendingProps,U=l!==null?l.memoizedProps:null,T=D.children,Mm(E,D)?T=null:U!==null&&Mm(E,U)&&(f.flags|=32),f.memoizedState!==null&&(E=b5(l,f,dL,null,null,p),ug._currentValue=E),Ed(l,f),Vi(l,f,T,p),f.child;case 6:return l===null&&vn&&((l=p=Er)&&(p=XL(p,f.pendingProps,ms),p!==null?(f.stateNode=p,sa=f,Er=null,l=!0):l=!1),l||el(f)),null;case 13:return i9(l,f,p);case 4:return tt(f,f.stateNode.containerInfo),T=f.pendingProps,l===null?f.child=fu(f,null,T,p):Vi(l,f,T,p),f.child;case 11:return X6(l,f,f.type,f.pendingProps,p);case 7:return Vi(l,f,f.pendingProps,p),f.child;case 8:return Vi(l,f,f.pendingProps.children,p),f.child;case 12:return Vi(l,f,f.pendingProps.children,p),f.child;case 10:return T=f.pendingProps,e0(f,f.type,T.value),Vi(l,f,T.children,p),f.child;case 9:return E=f.type._context,T=f.pendingProps.children,nl(f),E=Wi(E),T=T(E),f.flags|=1,Vi(l,f,T,p),f.child;case 14:return Z6(l,f,f.type,f.pendingProps,p);case 15:return Q6(l,f,f.type,f.pendingProps,p);case 19:return o9(l,f,p);case 31:return T=f.pendingProps,p=f.mode,T={mode:T.mode,children:T.children},l===null?(p=Rd(T,p),p.ref=f.ref,f.child=p,p.return=f,f=p):(p=sc(l.child,T),p.ref=f.ref,f.child=p,p.return=f,f=p),f;case 22:return J6(l,f,p);case 24:return nl(f),T=Wi(si),l===null?(E=C5(),E===null&&(E=zn,D=y5(),E.pooledCache=D,D.refCount++,D!==null&&(E.pooledCacheLanes|=p),E=D),f.memoizedState={parent:T,cache:E},w5(f),e0(f,si,E)):((l.lanes&p)!==0&&(x5(l,f),$f(f,null,null,p),Bf()),E=l.memoizedState,D=f.memoizedState,E.parent!==T?(E={parent:T,cache:T},f.memoizedState=E,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=E),e0(f,si,T)):(T=D.cache,e0(f,si,T),T!==E.cache&&v5(f,[si],p,!0))),Vi(l,f,f.pendingProps.children,p),f.child;case 29:throw f.pendingProps}throw Error(r(156,f.tag))}function pc(l){l.flags|=4}function c9(l,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!m7(f)){if(f=So.current,f!==null&&((ln&4194048)===ln?vs!==null:(ln&62914560)!==ln&&(ln&536870912)===0||f!==vs))throw kf=S5,Hy;l.flags|=8192}}function Od(l,f){f!==null&&(l.flags|=4),l.flags&16384&&(f=l.tag!==22?Wr():536870912,l.lanes|=f,pu|=f)}function Yf(l,f){if(!vn)switch(l.tailMode){case"hidden":f=l.tail;for(var p=null;f!==null;)f.alternate!==null&&(p=f),f=f.sibling;p===null?l.tail=null:p.sibling=null;break;case"collapsed":p=l.tail;for(var T=null;p!==null;)p.alternate!==null&&(T=p),p=p.sibling;T===null?f||l.tail===null?l.tail=null:l.tail.sibling=null:T.sibling=null}}function lr(l){var f=l.alternate!==null&&l.alternate.child===l.child,p=0,T=0;if(f)for(var E=l.child;E!==null;)p|=E.lanes|E.childLanes,T|=E.subtreeFlags&65011712,T|=E.flags&65011712,E.return=l,E=E.sibling;else for(E=l.child;E!==null;)p|=E.lanes|E.childLanes,T|=E.subtreeFlags,T|=E.flags,E.return=l,E=E.sibling;return l.subtreeFlags|=T,l.childLanes=p,f}function wL(l,f,p){var T=f.pendingProps;switch(d5(f),f.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return lr(f),null;case 1:return lr(f),null;case 3:return p=f.stateNode,T=null,l!==null&&(T=l.memoizedState.cache),f.memoizedState.cache!==T&&(f.flags|=2048),fc(si),st(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(l===null||l.child===null)&&(Vf(f)?pc(f):l===null||l.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,Gy())),lr(f),null;case 26:return p=f.memoizedState,l===null?(pc(f),p!==null?(lr(f),c9(f,p)):(lr(f),f.flags&=-16777217)):p?p!==l.memoizedState?(pc(f),lr(f),c9(f,p)):(lr(f),f.flags&=-16777217):(l.memoizedProps!==T&&pc(f),lr(f),f.flags&=-16777217),null;case 27:pr(f),p=Ze.current;var E=f.type;if(l!==null&&f.stateNode!=null)l.memoizedProps!==T&&pc(f);else{if(!T){if(f.stateNode===null)throw Error(r(166));return lr(f),null}l=qe.current,Vf(f)?Fy(f):(l=c7(E,T,p),f.stateNode=l,pc(f))}return lr(f),null;case 5:if(pr(f),p=f.type,l!==null&&f.stateNode!=null)l.memoizedProps!==T&&pc(f);else{if(!T){if(f.stateNode===null)throw Error(r(166));return lr(f),null}if(l=qe.current,Vf(f))Fy(f);else{switch(E=kd(Ze.current),l){case 1:l=E.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:l=E.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":l=E.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":l=E.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":l=E.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild);break;case"select":l=typeof T.is=="string"?E.createElement("select",{is:T.is}):E.createElement("select"),T.multiple?l.multiple=!0:T.size&&(l.size=T.size);break;default:l=typeof T.is=="string"?E.createElement(p,{is:T.is}):E.createElement(p)}}l[ot]=f,l[Ot]=T;e:for(E=f.child;E!==null;){if(E.tag===5||E.tag===6)l.appendChild(E.stateNode);else if(E.tag!==4&&E.tag!==27&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===f)break e;for(;E.sibling===null;){if(E.return===null||E.return===f)break e;E=E.return}E.sibling.return=E.return,E=E.sibling}f.stateNode=l;e:switch(Ai(l,p,T),p){case"button":case"input":case"select":case"textarea":l=!!T.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&pc(f)}}return lr(f),f.flags&=-16777217,null;case 6:if(l&&f.stateNode!=null)l.memoizedProps!==T&&pc(f);else{if(typeof T!="string"&&f.stateNode===null)throw Error(r(166));if(l=Ze.current,Vf(f)){if(l=f.stateNode,p=f.memoizedProps,T=null,E=sa,E!==null)switch(E.tag){case 27:case 5:T=E.memoizedProps}l[ot]=f,l=!!(l.nodeValue===p||T!==null&&T.suppressHydrationWarning===!0||t7(l.nodeValue,p)),l||el(f)}else l=kd(l).createTextNode(T),l[ot]=f,f.stateNode=l}return lr(f),null;case 13:if(T=f.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(E=Vf(f),T!==null&&T.dehydrated!==null){if(l===null){if(!E)throw Error(r(318));if(E=f.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(r(317));E[ot]=f}else If(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;lr(f),E=!1}else E=Gy(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=E),E=!0;if(!E)return f.flags&256?(dc(f),f):(dc(f),null)}if(dc(f),(f.flags&128)!==0)return f.lanes=p,f;if(p=T!==null,l=l!==null&&l.memoizedState!==null,p){T=f.child,E=null,T.alternate!==null&&T.alternate.memoizedState!==null&&T.alternate.memoizedState.cachePool!==null&&(E=T.alternate.memoizedState.cachePool.pool);var D=null;T.memoizedState!==null&&T.memoizedState.cachePool!==null&&(D=T.memoizedState.cachePool.pool),D!==E&&(T.flags|=2048)}return p!==l&&p&&(f.child.flags|=8192),Od(f,f.updateQueue),lr(f),null;case 4:return st(),l===null&&Rm(f.stateNode.containerInfo),lr(f),null;case 10:return fc(f.type),lr(f),null;case 19:if(fe(ci),E=f.memoizedState,E===null)return lr(f),null;if(T=(f.flags&128)!==0,D=E.rendering,D===null)if(T)Yf(E,!1);else{if(Rr!==0||l!==null&&(l.flags&128)!==0)for(l=f.child;l!==null;){if(D=Sd(l),D!==null){for(f.flags|=128,Yf(E,!1),l=D.updateQueue,f.updateQueue=l,Od(f,l),f.subtreeFlags=0,l=p,p=f.child;p!==null;)Py(p,l),p=p.sibling;return ue(ci,ci.current&1|2),f.child}l=l.sibling}E.tail!==null&&un()>bd&&(f.flags|=128,T=!0,Yf(E,!1),f.lanes=4194304)}else{if(!T)if(l=Sd(D),l!==null){if(f.flags|=128,T=!0,l=l.updateQueue,f.updateQueue=l,Od(f,l),Yf(E,!0),E.tail===null&&E.tailMode==="hidden"&&!D.alternate&&!vn)return lr(f),null}else 2*un()-E.renderingStartTime>bd&&p!==536870912&&(f.flags|=128,T=!0,Yf(E,!1),f.lanes=4194304);E.isBackwards?(D.sibling=f.child,f.child=D):(l=E.last,l!==null?l.sibling=D:f.child=D,E.last=D)}return E.tail!==null?(f=E.tail,E.rendering=f,E.tail=f.sibling,E.renderingStartTime=un(),f.sibling=null,l=ci.current,ue(ci,T?l&1|2:l&1),f):(lr(f),null);case 22:case 23:return dc(f),D5(),T=f.memoizedState!==null,l!==null?l.memoizedState!==null!==T&&(f.flags|=8192):T&&(f.flags|=8192),T?(p&536870912)!==0&&(f.flags&128)===0&&(lr(f),f.subtreeFlags&6&&(f.flags|=8192)):lr(f),p=f.updateQueue,p!==null&&Od(f,p.retryQueue),p=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),T=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(T=f.memoizedState.cachePool.pool),T!==p&&(f.flags|=2048),l!==null&&fe(rl),null;case 24:return p=null,l!==null&&(p=l.memoizedState.cache),f.memoizedState.cache!==p&&(f.flags|=2048),fc(si),lr(f),null;case 25:return null;case 30:return null}throw Error(r(156,f.tag))}function xL(l,f){switch(d5(f),f.tag){case 1:return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 3:return fc(si),st(),l=f.flags,(l&65536)!==0&&(l&128)===0?(f.flags=l&-65537|128,f):null;case 26:case 27:case 5:return pr(f),null;case 13:if(dc(f),l=f.memoizedState,l!==null&&l.dehydrated!==null){if(f.alternate===null)throw Error(r(340));If()}return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 19:return fe(ci),null;case 4:return st(),null;case 10:return fc(f.type),null;case 22:case 23:return dc(f),D5(),l!==null&&fe(rl),l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 24:return fc(si),null;case 25:return null;default:return null}}function l9(l,f){switch(d5(f),f.tag){case 3:fc(si),st();break;case 26:case 27:case 5:pr(f);break;case 4:st();break;case 13:dc(f);break;case 19:fe(ci);break;case 10:fc(f.type);break;case 22:case 23:dc(f),D5(),l!==null&&fe(rl);break;case 24:fc(si)}}function Xf(l,f){try{var p=f.updateQueue,T=p!==null?p.lastEffect:null;if(T!==null){var E=T.next;p=E;do{if((p.tag&l)===l){T=void 0;var D=p.create,U=p.inst;T=D(),U.destroy=T}p=p.next}while(p!==E)}}catch(q){Un(f,f.return,q)}}function s0(l,f,p){try{var T=f.updateQueue,E=T!==null?T.lastEffect:null;if(E!==null){var D=E.next;T=D;do{if((T.tag&l)===l){var U=T.inst,q=U.destroy;if(q!==void 0){U.destroy=void 0,E=f;var ce=p,Re=q;try{Re()}catch(Ge){Un(E,ce,Ge)}}}T=T.next}while(T!==D)}}catch(Ge){Un(f,f.return,Ge)}}function u9(l){var f=l.updateQueue;if(f!==null){var p=l.stateNode;try{Zy(f,p)}catch(T){Un(l,l.return,T)}}}function f9(l,f,p){p.props=al(l.type,l.memoizedProps),p.state=l.memoizedState;try{p.componentWillUnmount()}catch(T){Un(l,f,T)}}function Zf(l,f){try{var p=l.ref;if(p!==null){switch(l.tag){case 26:case 27:case 5:var T=l.stateNode;break;case 30:T=l.stateNode;break;default:T=l.stateNode}typeof p=="function"?l.refCleanup=p(T):p.current=T}}catch(E){Un(l,f,E)}}function ys(l,f){var p=l.ref,T=l.refCleanup;if(p!==null)if(typeof T=="function")try{T()}catch(E){Un(l,f,E)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof p=="function")try{p(null)}catch(E){Un(l,f,E)}else p.current=null}function g9(l){var f=l.type,p=l.memoizedProps,T=l.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":p.autoFocus&&T.focus();break e;case"img":p.src?T.src=p.src:p.srcSet&&(T.srcset=p.srcSet)}}catch(E){Un(l,l.return,E)}}function tm(l,f,p){try{var T=l.stateNode;zL(T,l.type,p,f),T[Ot]=f}catch(E){Un(l,l.return,E)}}function d9(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27&&p0(l.type)||l.tag===4}function nm(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||d9(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.tag===27&&p0(l.type)||l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function rm(l,f,p){var T=l.tag;if(T===5||T===6)l=l.stateNode,f?(p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p).insertBefore(l,f):(f=p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p,f.appendChild(l),p=p._reactRootContainer,p!=null||f.onclick!==null||(f.onclick=Fd));else if(T!==4&&(T===27&&p0(l.type)&&(p=l.stateNode,f=null),l=l.child,l!==null))for(rm(l,f,p),l=l.sibling;l!==null;)rm(l,f,p),l=l.sibling}function Dd(l,f,p){var T=l.tag;if(T===5||T===6)l=l.stateNode,f?p.insertBefore(l,f):p.appendChild(l);else if(T!==4&&(T===27&&p0(l.type)&&(p=l.stateNode),l=l.child,l!==null))for(Dd(l,f,p),l=l.sibling;l!==null;)Dd(l,f,p),l=l.sibling}function h9(l){var f=l.stateNode,p=l.memoizedProps;try{for(var T=l.type,E=f.attributes;E.length;)f.removeAttributeNode(E[0]);Ai(f,T,p),f[ot]=l,f[Ot]=p}catch(D){Un(l,l.return,D)}}var mc=!1,Ur=!1,im=!1,p9=typeof WeakSet=="function"?WeakSet:Set,vi=null;function EL(l,f){if(l=l.containerInfo,_m=Hd,l=we(l),Ie(l)){if("selectionStart"in l)var p={start:l.selectionStart,end:l.selectionEnd};else e:{p=(p=l.ownerDocument)&&p.defaultView||window;var T=p.getSelection&&p.getSelection();if(T&&T.rangeCount!==0){p=T.anchorNode;var E=T.anchorOffset,D=T.focusNode;T=T.focusOffset;try{p.nodeType,D.nodeType}catch{p=null;break e}var U=0,q=-1,ce=-1,Re=0,Ge=0,He=l,De=null;t:for(;;){for(var be;He!==p||E!==0&&He.nodeType!==3||(q=U+E),He!==D||T!==0&&He.nodeType!==3||(ce=U+T),He.nodeType===3&&(U+=He.nodeValue.length),(be=He.firstChild)!==null;)De=He,He=be;for(;;){if(He===l)break t;if(De===p&&++Re===E&&(q=U),De===D&&++Ge===T&&(ce=U),(be=He.nextSibling)!==null)break;He=De,De=He.parentNode}He=be}p=q===-1||ce===-1?null:{start:q,end:ce}}else p=null}p=p||{start:0,end:0}}else p=null;for(bm={focusedElem:l,selectionRange:p},Hd=!1,vi=f;vi!==null;)if(f=vi,l=f.child,(f.subtreeFlags&1024)!==0&&l!==null)l.return=f,vi=l;else for(;vi!==null;){switch(f=vi,D=f.alternate,l=f.flags,f.tag){case 0:break;case 11:case 15:break;case 1:if((l&1024)!==0&&D!==null){l=void 0,p=f,E=D.memoizedProps,D=D.memoizedState,T=p.stateNode;try{var Vt=al(p.type,E,p.elementType===p.type);l=T.getSnapshotBeforeUpdate(Vt,D),T.__reactInternalSnapshotBeforeUpdate=l}catch(bt){Un(p,p.return,bt)}}break;case 3:if((l&1024)!==0){if(l=f.stateNode.containerInfo,p=l.nodeType,p===9)Vm(l);else if(p===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":Vm(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(r(163))}if(l=f.sibling,l!==null){l.return=f.return,vi=l;break}vi=f.return}}function m9(l,f,p){var T=p.flags;switch(p.tag){case 0:case 11:case 15:c0(l,p),T&4&&Xf(5,p);break;case 1:if(c0(l,p),T&4)if(l=p.stateNode,f===null)try{l.componentDidMount()}catch(U){Un(p,p.return,U)}else{var E=al(p.type,f.memoizedProps);f=f.memoizedState;try{l.componentDidUpdate(E,f,l.__reactInternalSnapshotBeforeUpdate)}catch(U){Un(p,p.return,U)}}T&64&&u9(p),T&512&&Zf(p,p.return);break;case 3:if(c0(l,p),T&64&&(l=p.updateQueue,l!==null)){if(f=null,p.child!==null)switch(p.child.tag){case 27:case 5:f=p.child.stateNode;break;case 1:f=p.child.stateNode}try{Zy(l,f)}catch(U){Un(p,p.return,U)}}break;case 27:f===null&&T&4&&h9(p);case 26:case 5:c0(l,p),f===null&&T&4&&g9(p),T&512&&Zf(p,p.return);break;case 12:c0(l,p);break;case 13:c0(l,p),T&4&&T9(l,p),T&64&&(l=p.memoizedState,l!==null&&(l=l.dehydrated,l!==null&&(p=IL.bind(null,p),ZL(l,p))));break;case 22:if(T=p.memoizedState!==null||mc,!T){f=f!==null&&f.memoizedState!==null||Ur,E=mc;var D=Ur;mc=T,(Ur=f)&&!D?l0(l,p,(p.subtreeFlags&8772)!==0):c0(l,p),mc=E,Ur=D}break;case 30:break;default:c0(l,p)}}function v9(l){var f=l.alternate;f!==null&&(l.alternate=null,v9(f)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(f=l.stateNode,f!==null&&Oi(f)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var er=null,_a=!1;function vc(l,f,p){for(p=p.child;p!==null;)y9(l,f,p),p=p.sibling}function y9(l,f,p){if(Je&&typeof Je.onCommitFiberUnmount=="function")try{Je.onCommitFiberUnmount(Pe,p)}catch{}switch(p.tag){case 26:Ur||ys(p,f),vc(l,f,p),p.memoizedState?p.memoizedState.count--:p.stateNode&&(p=p.stateNode,p.parentNode.removeChild(p));break;case 27:Ur||ys(p,f);var T=er,E=_a;p0(p.type)&&(er=p.stateNode,_a=!1),vc(l,f,p),og(p.stateNode),er=T,_a=E;break;case 5:Ur||ys(p,f);case 6:if(T=er,E=_a,er=null,vc(l,f,p),er=T,_a=E,er!==null)if(_a)try{(er.nodeType===9?er.body:er.nodeName==="HTML"?er.ownerDocument.body:er).removeChild(p.stateNode)}catch(D){Un(p,f,D)}else try{er.removeChild(p.stateNode)}catch(D){Un(p,f,D)}break;case 18:er!==null&&(_a?(l=er,o7(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,p.stateNode),hg(l)):o7(er,p.stateNode));break;case 4:T=er,E=_a,er=p.stateNode.containerInfo,_a=!0,vc(l,f,p),er=T,_a=E;break;case 0:case 11:case 14:case 15:Ur||s0(2,p,f),Ur||s0(4,p,f),vc(l,f,p);break;case 1:Ur||(ys(p,f),T=p.stateNode,typeof T.componentWillUnmount=="function"&&f9(p,f,T)),vc(l,f,p);break;case 21:vc(l,f,p);break;case 22:Ur=(T=Ur)||p.memoizedState!==null,vc(l,f,p),Ur=T;break;default:vc(l,f,p)}}function T9(l,f){if(f.memoizedState===null&&(l=f.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{hg(l)}catch(p){Un(f,f.return,p)}}function RL(l){switch(l.tag){case 13:case 19:var f=l.stateNode;return f===null&&(f=l.stateNode=new p9),f;case 22:return l=l.stateNode,f=l._retryCache,f===null&&(f=l._retryCache=new p9),f;default:throw Error(r(435,l.tag))}}function am(l,f){var p=RL(l);f.forEach(function(T){var E=AL.bind(null,l,T);p.has(T)||(p.add(T),T.then(E,E))})}function Ha(l,f){var p=f.deletions;if(p!==null)for(var T=0;T<p.length;T++){var E=p[T],D=l,U=f,q=U;e:for(;q!==null;){switch(q.tag){case 27:if(p0(q.type)){er=q.stateNode,_a=!1;break e}break;case 5:er=q.stateNode,_a=!1;break e;case 3:case 4:er=q.stateNode.containerInfo,_a=!0;break e}q=q.return}if(er===null)throw Error(r(160));y9(D,U,E),er=null,_a=!1,D=E.alternate,D!==null&&(D.return=null),E.return=null}if(f.subtreeFlags&13878)for(f=f.child;f!==null;)C9(f,l),f=f.sibling}var qo=null;function C9(l,f){var p=l.alternate,T=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:Ha(f,l),ja(l),T&4&&(s0(3,l,l.return),Xf(3,l),s0(5,l,l.return));break;case 1:Ha(f,l),ja(l),T&512&&(Ur||p===null||ys(p,p.return)),T&64&&mc&&(l=l.updateQueue,l!==null&&(T=l.callbacks,T!==null&&(p=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=p===null?T:p.concat(T))));break;case 26:var E=qo;if(Ha(f,l),ja(l),T&512&&(Ur||p===null||ys(p,p.return)),T&4){var D=p!==null?p.memoizedState:null;if(T=l.memoizedState,p===null)if(T===null)if(l.stateNode===null){e:{T=l.type,p=l.memoizedProps,E=E.ownerDocument||E;t:switch(T){case"title":D=E.getElementsByTagName("title")[0],(!D||D[ki]||D[ot]||D.namespaceURI==="http://www.w3.org/2000/svg"||D.hasAttribute("itemprop"))&&(D=E.createElement(T),E.head.insertBefore(D,E.querySelector("head > title"))),Ai(D,T,p),D[ot]=l,vt(D),T=D;break e;case"link":var U=h7("link","href",E).get(T+(p.href||""));if(U){for(var q=0;q<U.length;q++)if(D=U[q],D.getAttribute("href")===(p.href==null||p.href===""?null:p.href)&&D.getAttribute("rel")===(p.rel==null?null:p.rel)&&D.getAttribute("title")===(p.title==null?null:p.title)&&D.getAttribute("crossorigin")===(p.crossOrigin==null?null:p.crossOrigin)){U.splice(q,1);break t}}D=E.createElement(T),Ai(D,T,p),E.head.appendChild(D);break;case"meta":if(U=h7("meta","content",E).get(T+(p.content||""))){for(q=0;q<U.length;q++)if(D=U[q],D.getAttribute("content")===(p.content==null?null:""+p.content)&&D.getAttribute("name")===(p.name==null?null:p.name)&&D.getAttribute("property")===(p.property==null?null:p.property)&&D.getAttribute("http-equiv")===(p.httpEquiv==null?null:p.httpEquiv)&&D.getAttribute("charset")===(p.charSet==null?null:p.charSet)){U.splice(q,1);break t}}D=E.createElement(T),Ai(D,T,p),E.head.appendChild(D);break;default:throw Error(r(468,T))}D[ot]=l,vt(D),T=D}l.stateNode=T}else p7(E,l.type,l.stateNode);else l.stateNode=d7(E,T,l.memoizedProps);else D!==T?(D===null?p.stateNode!==null&&(p=p.stateNode,p.parentNode.removeChild(p)):D.count--,T===null?p7(E,l.type,l.stateNode):d7(E,T,l.memoizedProps)):T===null&&l.stateNode!==null&&tm(l,l.memoizedProps,p.memoizedProps)}break;case 27:Ha(f,l),ja(l),T&512&&(Ur||p===null||ys(p,p.return)),p!==null&&T&4&&tm(l,l.memoizedProps,p.memoizedProps);break;case 5:if(Ha(f,l),ja(l),T&512&&(Ur||p===null||ys(p,p.return)),l.flags&32){E=l.stateNode;try{na(E,"")}catch(be){Un(l,l.return,be)}}T&4&&l.stateNode!=null&&(E=l.memoizedProps,tm(l,E,p!==null?p.memoizedProps:E)),T&1024&&(im=!0);break;case 6:if(Ha(f,l),ja(l),T&4){if(l.stateNode===null)throw Error(r(162));T=l.memoizedProps,p=l.stateNode;try{p.nodeValue=T}catch(be){Un(l,l.return,be)}}break;case 3:if($d=null,E=qo,qo=Gd(f.containerInfo),Ha(f,l),qo=E,ja(l),T&4&&p!==null&&p.memoizedState.isDehydrated)try{hg(f.containerInfo)}catch(be){Un(l,l.return,be)}im&&(im=!1,S9(l));break;case 4:T=qo,qo=Gd(l.stateNode.containerInfo),Ha(f,l),ja(l),qo=T;break;case 12:Ha(f,l),ja(l);break;case 13:Ha(f,l),ja(l),l.child.flags&8192&&l.memoizedState!==null!=(p!==null&&p.memoizedState!==null)&&(fm=un()),T&4&&(T=l.updateQueue,T!==null&&(l.updateQueue=null,am(l,T)));break;case 22:E=l.memoizedState!==null;var ce=p!==null&&p.memoizedState!==null,Re=mc,Ge=Ur;if(mc=Re||E,Ur=Ge||ce,Ha(f,l),Ur=Ge,mc=Re,ja(l),T&8192)e:for(f=l.stateNode,f._visibility=E?f._visibility&-2:f._visibility|1,E&&(p===null||ce||mc||Ur||ol(l)),p=null,f=l;;){if(f.tag===5||f.tag===26){if(p===null){ce=p=f;try{if(D=ce.stateNode,E)U=D.style,typeof U.setProperty=="function"?U.setProperty("display","none","important"):U.display="none";else{q=ce.stateNode;var He=ce.memoizedProps.style,De=He!=null&&He.hasOwnProperty("display")?He.display:null;q.style.display=De==null||typeof De=="boolean"?"":(""+De).trim()}}catch(be){Un(ce,ce.return,be)}}}else if(f.tag===6){if(p===null){ce=f;try{ce.stateNode.nodeValue=E?"":ce.memoizedProps}catch(be){Un(ce,ce.return,be)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===l)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break e;for(;f.sibling===null;){if(f.return===null||f.return===l)break e;p===f&&(p=null),f=f.return}p===f&&(p=null),f.sibling.return=f.return,f=f.sibling}T&4&&(T=l.updateQueue,T!==null&&(p=T.retryQueue,p!==null&&(T.retryQueue=null,am(l,p))));break;case 19:Ha(f,l),ja(l),T&4&&(T=l.updateQueue,T!==null&&(l.updateQueue=null,am(l,T)));break;case 30:break;case 21:break;default:Ha(f,l),ja(l)}}function ja(l){var f=l.flags;if(f&2){try{for(var p,T=l.return;T!==null;){if(d9(T)){p=T;break}T=T.return}if(p==null)throw Error(r(160));switch(p.tag){case 27:var E=p.stateNode,D=nm(l);Dd(l,D,E);break;case 5:var U=p.stateNode;p.flags&32&&(na(U,""),p.flags&=-33);var q=nm(l);Dd(l,q,U);break;case 3:case 4:var ce=p.stateNode.containerInfo,Re=nm(l);rm(l,Re,ce);break;default:throw Error(r(161))}}catch(Ge){Un(l,l.return,Ge)}l.flags&=-3}f&4096&&(l.flags&=-4097)}function S9(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var f=l;S9(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),l=l.sibling}}function c0(l,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)m9(l,f.alternate,f),f=f.sibling}function ol(l){for(l=l.child;l!==null;){var f=l;switch(f.tag){case 0:case 11:case 14:case 15:s0(4,f,f.return),ol(f);break;case 1:ys(f,f.return);var p=f.stateNode;typeof p.componentWillUnmount=="function"&&f9(f,f.return,p),ol(f);break;case 27:og(f.stateNode);case 26:case 5:ys(f,f.return),ol(f);break;case 22:f.memoizedState===null&&ol(f);break;case 30:ol(f);break;default:ol(f)}l=l.sibling}}function l0(l,f,p){for(p=p&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var T=f.alternate,E=l,D=f,U=D.flags;switch(D.tag){case 0:case 11:case 15:l0(E,D,p),Xf(4,D);break;case 1:if(l0(E,D,p),T=D,E=T.stateNode,typeof E.componentDidMount=="function")try{E.componentDidMount()}catch(Re){Un(T,T.return,Re)}if(T=D,E=T.updateQueue,E!==null){var q=T.stateNode;try{var ce=E.shared.hiddenCallbacks;if(ce!==null)for(E.shared.hiddenCallbacks=null,E=0;E<ce.length;E++)Xy(ce[E],q)}catch(Re){Un(T,T.return,Re)}}p&&U&64&&u9(D),Zf(D,D.return);break;case 27:h9(D);case 26:case 5:l0(E,D,p),p&&T===null&&U&4&&g9(D),Zf(D,D.return);break;case 12:l0(E,D,p);break;case 13:l0(E,D,p),p&&U&4&&T9(E,D);break;case 22:D.memoizedState===null&&l0(E,D,p),Zf(D,D.return);break;case 30:break;default:l0(E,D,p)}f=f.sibling}}function om(l,f){var p=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),l=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(l=f.memoizedState.cachePool.pool),l!==p&&(l!=null&&l.refCount++,p!=null&&Pf(p))}function sm(l,f){l=null,f.alternate!==null&&(l=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==l&&(f.refCount++,l!=null&&Pf(l))}function Ts(l,f,p,T){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)w9(l,f,p,T),f=f.sibling}function w9(l,f,p,T){var E=f.flags;switch(f.tag){case 0:case 11:case 15:Ts(l,f,p,T),E&2048&&Xf(9,f);break;case 1:Ts(l,f,p,T);break;case 3:Ts(l,f,p,T),E&2048&&(l=null,f.alternate!==null&&(l=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==l&&(f.refCount++,l!=null&&Pf(l)));break;case 12:if(E&2048){Ts(l,f,p,T),l=f.stateNode;try{var D=f.memoizedProps,U=D.id,q=D.onPostCommit;typeof q=="function"&&q(U,f.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(ce){Un(f,f.return,ce)}}else Ts(l,f,p,T);break;case 13:Ts(l,f,p,T);break;case 23:break;case 22:D=f.stateNode,U=f.alternate,f.memoizedState!==null?D._visibility&2?Ts(l,f,p,T):Qf(l,f):D._visibility&2?Ts(l,f,p,T):(D._visibility|=2,gu(l,f,p,T,(f.subtreeFlags&10256)!==0)),E&2048&&om(U,f);break;case 24:Ts(l,f,p,T),E&2048&&sm(f.alternate,f);break;default:Ts(l,f,p,T)}}function gu(l,f,p,T,E){for(E=E&&(f.subtreeFlags&10256)!==0,f=f.child;f!==null;){var D=l,U=f,q=p,ce=T,Re=U.flags;switch(U.tag){case 0:case 11:case 15:gu(D,U,q,ce,E),Xf(8,U);break;case 23:break;case 22:var Ge=U.stateNode;U.memoizedState!==null?Ge._visibility&2?gu(D,U,q,ce,E):Qf(D,U):(Ge._visibility|=2,gu(D,U,q,ce,E)),E&&Re&2048&&om(U.alternate,U);break;case 24:gu(D,U,q,ce,E),E&&Re&2048&&sm(U.alternate,U);break;default:gu(D,U,q,ce,E)}f=f.sibling}}function Qf(l,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var p=l,T=f,E=T.flags;switch(T.tag){case 22:Qf(p,T),E&2048&&om(T.alternate,T);break;case 24:Qf(p,T),E&2048&&sm(T.alternate,T);break;default:Qf(p,T)}f=f.sibling}}var Jf=8192;function du(l){if(l.subtreeFlags&Jf)for(l=l.child;l!==null;)x9(l),l=l.sibling}function x9(l){switch(l.tag){case 26:du(l),l.flags&Jf&&l.memoizedState!==null&&uV(qo,l.memoizedState,l.memoizedProps);break;case 5:du(l);break;case 3:case 4:var f=qo;qo=Gd(l.stateNode.containerInfo),du(l),qo=f;break;case 22:l.memoizedState===null&&(f=l.alternate,f!==null&&f.memoizedState!==null?(f=Jf,Jf=16777216,du(l),Jf=f):du(l));break;default:du(l)}}function E9(l){var f=l.alternate;if(f!==null&&(l=f.child,l!==null)){f.child=null;do f=l.sibling,l.sibling=null,l=f;while(l!==null)}}function eg(l){var f=l.deletions;if((l.flags&16)!==0){if(f!==null)for(var p=0;p<f.length;p++){var T=f[p];vi=T,O9(T,l)}E9(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)R9(l),l=l.sibling}function R9(l){switch(l.tag){case 0:case 11:case 15:eg(l),l.flags&2048&&s0(9,l,l.return);break;case 3:eg(l);break;case 12:eg(l);break;case 22:var f=l.stateNode;l.memoizedState!==null&&f._visibility&2&&(l.return===null||l.return.tag!==13)?(f._visibility&=-3,_d(l)):eg(l);break;default:eg(l)}}function _d(l){var f=l.deletions;if((l.flags&16)!==0){if(f!==null)for(var p=0;p<f.length;p++){var T=f[p];vi=T,O9(T,l)}E9(l)}for(l=l.child;l!==null;){switch(f=l,f.tag){case 0:case 11:case 15:s0(8,f,f.return),_d(f);break;case 22:p=f.stateNode,p._visibility&2&&(p._visibility&=-3,_d(f));break;default:_d(f)}l=l.sibling}}function O9(l,f){for(;vi!==null;){var p=vi;switch(p.tag){case 0:case 11:case 15:s0(8,p,f);break;case 23:case 22:if(p.memoizedState!==null&&p.memoizedState.cachePool!==null){var T=p.memoizedState.cachePool.pool;T!=null&&T.refCount++}break;case 24:Pf(p.memoizedState.cache)}if(T=p.child,T!==null)T.return=p,vi=T;else e:for(p=l;vi!==null;){T=vi;var E=T.sibling,D=T.return;if(v9(T),T===p){vi=null;break e}if(E!==null){E.return=D,vi=E;break e}vi=D}}}var OL={getCacheForType:function(l){var f=Wi(si),p=f.data.get(l);return p===void 0&&(p=l(),f.data.set(l,p)),p}},DL=typeof WeakMap=="function"?WeakMap:Map,Dn=0,zn=null,Xt=null,ln=0,_n=0,qa=null,u0=!1,hu=!1,cm=!1,yc=0,Rr=0,f0=0,sl=0,lm=0,wo=0,pu=0,tg=null,ba=null,um=!1,fm=0,bd=1/0,Md=null,g0=null,Ii=0,d0=null,mu=null,vu=0,gm=0,dm=null,D9=null,ng=0,hm=null;function Ka(){if((Dn&2)!==0&&ln!==0)return ln&-ln;if(X.T!==null){var l=iu;return l!==0?l:Sm()}return Fi()}function _9(){wo===0&&(wo=(ln&536870912)===0||vn?qt():536870912);var l=So.current;return l!==null&&(l.flags|=32),wo}function Ya(l,f,p){(l===zn&&(_n===2||_n===9)||l.cancelPendingCommit!==null)&&(yu(l,0),h0(l,ln,wo,!1)),rr(l,p),((Dn&2)===0||l!==zn)&&(l===zn&&((Dn&2)===0&&(sl|=p),Rr===4&&h0(l,ln,wo,!1)),Cs(l))}function b9(l,f,p){if((Dn&6)!==0)throw Error(r(327));var T=!p&&(f&124)===0&&(f&l.expiredLanes)===0||ze(l,f),E=T?ML(l,f):vm(l,f,!0),D=T;do{if(E===0){hu&&!T&&h0(l,f,0,!1);break}else{if(p=l.current.alternate,D&&!_L(p)){E=vm(l,f,!1),D=!1;continue}if(E===2){if(D=f,l.errorRecoveryDisabledLanes&D)var U=0;else U=l.pendingLanes&-536870913,U=U!==0?U:U&536870912?536870912:0;if(U!==0){f=U;e:{var q=l;E=tg;var ce=q.current.memoizedState.isDehydrated;if(ce&&(yu(q,U).flags|=256),U=vm(q,U,!1),U!==2){if(cm&&!ce){q.errorRecoveryDisabledLanes|=D,sl|=D,E=4;break e}D=ba,ba=E,D!==null&&(ba===null?ba=D:ba.push.apply(ba,D))}E=U}if(D=!1,E!==2)continue}}if(E===1){yu(l,0),h0(l,f,0,!0);break}e:{switch(T=l,D=E,D){case 0:case 1:throw Error(r(345));case 4:if((f&4194048)!==f)break;case 6:h0(T,f,wo,!u0);break e;case 2:ba=null;break;case 3:case 5:break;default:throw Error(r(329))}if((f&62914560)===f&&(E=fm+300-un(),10<E)){if(h0(T,f,wo,!u0),Ee(T,0,!0)!==0)break e;T.timeoutHandle=i7(M9.bind(null,T,p,ba,Md,um,f,wo,sl,pu,u0,D,2,-0,0),E);break e}M9(T,p,ba,Md,um,f,wo,sl,pu,u0,D,0,-0,0)}}break}while(!0);Cs(l)}function M9(l,f,p,T,E,D,U,q,ce,Re,Ge,He,De,be){if(l.timeoutHandle=-1,He=f.subtreeFlags,(He&8192||(He&16785408)===16785408)&&(lg={stylesheets:null,count:0,unsuspend:lV},x9(f),He=fV(),He!==null)){l.cancelPendingCommit=He(U9.bind(null,l,f,D,p,T,E,U,q,ce,Ge,1,De,be)),h0(l,D,U,!Re);return}U9(l,f,D,p,T,E,U,q,ce)}function _L(l){for(var f=l;;){var p=f.tag;if((p===0||p===11||p===15)&&f.flags&16384&&(p=f.updateQueue,p!==null&&(p=p.stores,p!==null)))for(var T=0;T<p.length;T++){var E=p[T],D=E.getSnapshot;E=E.value;try{if(!K(D(),E))return!1}catch{return!1}}if(p=f.child,f.subtreeFlags&16384&&p!==null)p.return=f,f=p;else{if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function h0(l,f,p,T){f&=~lm,f&=~sl,l.suspendedLanes|=f,l.pingedLanes&=~f,T&&(l.warmLanes|=f),T=l.expirationTimes;for(var E=f;0<E;){var D=31-xt(E),U=1<<D;T[D]=-1,E&=~U}p!==0&&Ji(l,p,f)}function Ld(){return(Dn&6)===0?(rg(0),!1):!0}function pm(){if(Xt!==null){if(_n===0)var l=Xt.return;else l=Xt,uc=tl=null,V5(l),uu=null,qf=0,l=Xt;for(;l!==null;)l9(l.alternate,l),l=l.return;Xt=null}}function yu(l,f){var p=l.timeoutHandle;p!==-1&&(l.timeoutHandle=-1,jL(p)),p=l.cancelPendingCommit,p!==null&&(l.cancelPendingCommit=null,p()),pm(),zn=l,Xt=p=sc(l.current,null),ln=f,_n=0,qa=null,u0=!1,hu=ze(l,f),cm=!1,pu=wo=lm=sl=f0=Rr=0,ba=tg=null,um=!1,(f&8)!==0&&(f|=f&32);var T=l.entangledLanes;if(T!==0)for(l=l.entanglements,T&=f;0<T;){var E=31-xt(T),D=1<<E;f|=l[E],T&=~D}return yc=f,J1(),p}function L9(l,f){jt=null,X.H=yd,f===Ff||f===cd?(f=Ky(),_n=3):f===Hy?(f=Ky(),_n=4):_n=f===Y6?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,qa=f,Xt===null&&(Rr=1,xd(l,vo(f,l.current)))}function V9(){var l=X.H;return X.H=yd,l===null?yd:l}function I9(){var l=X.A;return X.A=OL,l}function mm(){Rr=4,u0||(ln&4194048)!==ln&&So.current!==null||(hu=!0),(f0&134217727)===0&&(sl&134217727)===0||zn===null||h0(zn,ln,wo,!1)}function vm(l,f,p){var T=Dn;Dn|=2;var E=V9(),D=I9();(zn!==l||ln!==f)&&(Md=null,yu(l,f)),f=!1;var U=Rr;e:do try{if(_n!==0&&Xt!==null){var q=Xt,ce=qa;switch(_n){case 8:pm(),U=6;break e;case 3:case 2:case 9:case 6:So.current===null&&(f=!0);var Re=_n;if(_n=0,qa=null,Tu(l,q,ce,Re),p&&hu){U=0;break e}break;default:Re=_n,_n=0,qa=null,Tu(l,q,ce,Re)}}bL(),U=Rr;break}catch(Ge){L9(l,Ge)}while(!0);return f&&l.shellSuspendCounter++,uc=tl=null,Dn=T,X.H=E,X.A=D,Xt===null&&(zn=null,ln=0,J1()),U}function bL(){for(;Xt!==null;)A9(Xt)}function ML(l,f){var p=Dn;Dn|=2;var T=V9(),E=I9();zn!==l||ln!==f?(Md=null,bd=un()+500,yu(l,f)):hu=ze(l,f);e:do try{if(_n!==0&&Xt!==null){f=Xt;var D=qa;t:switch(_n){case 1:_n=0,qa=null,Tu(l,f,D,1);break;case 2:case 9:if(jy(D)){_n=0,qa=null,N9(f);break}f=function(){_n!==2&&_n!==9||zn!==l||(_n=7),Cs(l)},D.then(f,f);break e;case 3:_n=7;break e;case 4:_n=5;break e;case 7:jy(D)?(_n=0,qa=null,N9(f)):(_n=0,qa=null,Tu(l,f,D,7));break;case 5:var U=null;switch(Xt.tag){case 26:U=Xt.memoizedState;case 5:case 27:var q=Xt;if(!U||m7(U)){_n=0,qa=null;var ce=q.sibling;if(ce!==null)Xt=ce;else{var Re=q.return;Re!==null?(Xt=Re,Vd(Re)):Xt=null}break t}}_n=0,qa=null,Tu(l,f,D,5);break;case 6:_n=0,qa=null,Tu(l,f,D,6);break;case 8:pm(),Rr=6;break e;default:throw Error(r(462))}}LL();break}catch(Ge){L9(l,Ge)}while(!0);return uc=tl=null,X.H=T,X.A=E,Dn=p,Xt!==null?0:(zn=null,ln=0,J1(),Rr)}function LL(){for(;Xt!==null&&!Mn();)A9(Xt)}function A9(l){var f=s9(l.alternate,l,yc);l.memoizedProps=l.pendingProps,f===null?Vd(l):Xt=f}function N9(l){var f=l,p=f.alternate;switch(f.tag){case 15:case 0:f=t9(p,f,f.pendingProps,f.type,void 0,ln);break;case 11:f=t9(p,f,f.pendingProps,f.type.render,f.ref,ln);break;case 5:V5(f);default:l9(p,f),f=Xt=Py(f,yc),f=s9(p,f,yc)}l.memoizedProps=l.pendingProps,f===null?Vd(l):Xt=f}function Tu(l,f,p,T){uc=tl=null,V5(f),uu=null,qf=0;var E=f.return;try{if(CL(l,E,f,p,ln)){Rr=1,xd(l,vo(p,l.current)),Xt=null;return}}catch(D){if(E!==null)throw Xt=E,D;Rr=1,xd(l,vo(p,l.current)),Xt=null;return}f.flags&32768?(vn||T===1?l=!0:hu||(ln&536870912)!==0?l=!1:(u0=l=!0,(T===2||T===9||T===3||T===6)&&(T=So.current,T!==null&&T.tag===13&&(T.flags|=16384))),P9(f,l)):Vd(f)}function Vd(l){var f=l;do{if((f.flags&32768)!==0){P9(f,u0);return}l=f.return;var p=wL(f.alternate,f,yc);if(p!==null){Xt=p;return}if(f=f.sibling,f!==null){Xt=f;return}Xt=f=l}while(f!==null);Rr===0&&(Rr=5)}function P9(l,f){do{var p=xL(l.alternate,l);if(p!==null){p.flags&=32767,Xt=p;return}if(p=l.return,p!==null&&(p.flags|=32768,p.subtreeFlags=0,p.deletions=null),!f&&(l=l.sibling,l!==null)){Xt=l;return}Xt=l=p}while(l!==null);Rr=6,Xt=null}function U9(l,f,p,T,E,D,U,q,ce){l.cancelPendingCommit=null;do Id();while(Ii!==0);if((Dn&6)!==0)throw Error(r(327));if(f!==null){if(f===l.current)throw Error(r(177));if(D=f.lanes|f.childLanes,D|=s5,Ir(l,p,D,U,q,ce),l===zn&&(Xt=zn=null,ln=0),mu=f,d0=l,vu=p,gm=D,dm=E,D9=T,(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?(l.callbackNode=null,l.callbackPriority=0,NL(Y,function(){return $9(),null})):(l.callbackNode=null,l.callbackPriority=0),T=(f.flags&13878)!==0,(f.subtreeFlags&13878)!==0||T){T=X.T,X.T=null,E=ie.p,ie.p=2,U=Dn,Dn|=4;try{EL(l,f,p)}finally{Dn=U,ie.p=E,X.T=T}}Ii=1,F9(),k9(),G9()}}function F9(){if(Ii===1){Ii=0;var l=d0,f=mu,p=(f.flags&13878)!==0;if((f.subtreeFlags&13878)!==0||p){p=X.T,X.T=null;var T=ie.p;ie.p=2;var E=Dn;Dn|=4;try{C9(f,l);var D=bm,U=we(l.containerInfo),q=D.focusedElem,ce=D.selectionRange;if(U!==q&&q&&q.ownerDocument&&de(q.ownerDocument.documentElement,q)){if(ce!==null&&Ie(q)){var Re=ce.start,Ge=ce.end;if(Ge===void 0&&(Ge=Re),"selectionStart"in q)q.selectionStart=Re,q.selectionEnd=Math.min(Ge,q.value.length);else{var He=q.ownerDocument||document,De=He&&He.defaultView||window;if(De.getSelection){var be=De.getSelection(),Vt=q.textContent.length,bt=Math.min(ce.start,Vt),In=ce.end===void 0?bt:Math.min(ce.end,Vt);!be.extend&&bt>In&&(U=In,In=bt,bt=U);var Ce=se(q,bt),me=se(q,In);if(Ce&&me&&(be.rangeCount!==1||be.anchorNode!==Ce.node||be.anchorOffset!==Ce.offset||be.focusNode!==me.node||be.focusOffset!==me.offset)){var xe=He.createRange();xe.setStart(Ce.node,Ce.offset),be.removeAllRanges(),bt>In?(be.addRange(xe),be.extend(me.node,me.offset)):(xe.setEnd(me.node,me.offset),be.addRange(xe))}}}}for(He=[],be=q;be=be.parentNode;)be.nodeType===1&&He.push({element:be,left:be.scrollLeft,top:be.scrollTop});for(typeof q.focus=="function"&&q.focus(),q=0;q<He.length;q++){var $e=He[q];$e.element.scrollLeft=$e.left,$e.element.scrollTop=$e.top}}Hd=!!_m,bm=_m=null}finally{Dn=E,ie.p=T,X.T=p}}l.current=f,Ii=2}}function k9(){if(Ii===2){Ii=0;var l=d0,f=mu,p=(f.flags&8772)!==0;if((f.subtreeFlags&8772)!==0||p){p=X.T,X.T=null;var T=ie.p;ie.p=2;var E=Dn;Dn|=4;try{m9(l,f.alternate,f)}finally{Dn=E,ie.p=T,X.T=p}}Ii=3}}function G9(){if(Ii===4||Ii===3){Ii=0,Nn();var l=d0,f=mu,p=vu,T=D9;(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?Ii=5:(Ii=0,mu=d0=null,B9(l,l.pendingLanes));var E=l.pendingLanes;if(E===0&&(g0=null),Ei(p),f=f.stateNode,Je&&typeof Je.onCommitFiberRoot=="function")try{Je.onCommitFiberRoot(Pe,f,void 0,(f.current.flags&128)===128)}catch{}if(T!==null){f=X.T,E=ie.p,ie.p=2,X.T=null;try{for(var D=l.onRecoverableError,U=0;U<T.length;U++){var q=T[U];D(q.value,{componentStack:q.stack})}}finally{X.T=f,ie.p=E}}(vu&3)!==0&&Id(),Cs(l),E=l.pendingLanes,(p&4194090)!==0&&(E&42)!==0?l===hm?ng++:(ng=0,hm=l):ng=0,rg(0)}}function B9(l,f){(l.pooledCacheLanes&=f)===0&&(f=l.pooledCache,f!=null&&(l.pooledCache=null,Pf(f)))}function Id(l){return F9(),k9(),G9(),$9()}function $9(){if(Ii!==5)return!1;var l=d0,f=gm;gm=0;var p=Ei(vu),T=X.T,E=ie.p;try{ie.p=32>p?32:p,X.T=null,p=dm,dm=null;var D=d0,U=vu;if(Ii=0,mu=d0=null,vu=0,(Dn&6)!==0)throw Error(r(331));var q=Dn;if(Dn|=4,R9(D.current),w9(D,D.current,U,p),Dn=q,rg(0,!1),Je&&typeof Je.onPostCommitFiberRoot=="function")try{Je.onPostCommitFiberRoot(Pe,D)}catch{}return!0}finally{ie.p=E,X.T=T,B9(l,f)}}function W9(l,f,p){f=vo(p,f),f=j5(l.stateNode,f,2),l=r0(l,f,2),l!==null&&(rr(l,2),Cs(l))}function Un(l,f,p){if(l.tag===3)W9(l,l,p);else for(;f!==null;){if(f.tag===3){W9(f,l,p);break}else if(f.tag===1){var T=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof T.componentDidCatch=="function"&&(g0===null||!g0.has(T))){l=vo(p,l),p=q6(2),T=r0(f,p,2),T!==null&&(K6(p,T,f,l),rr(T,2),Cs(T));break}}f=f.return}}function ym(l,f,p){var T=l.pingCache;if(T===null){T=l.pingCache=new DL;var E=new Set;T.set(f,E)}else E=T.get(f),E===void 0&&(E=new Set,T.set(f,E));E.has(p)||(cm=!0,E.add(p),l=VL.bind(null,l,f,p),f.then(l,l))}function VL(l,f,p){var T=l.pingCache;T!==null&&T.delete(f),l.pingedLanes|=l.suspendedLanes&p,l.warmLanes&=~p,zn===l&&(ln&p)===p&&(Rr===4||Rr===3&&(ln&62914560)===ln&&300>un()-fm?(Dn&2)===0&&yu(l,0):lm|=p,pu===ln&&(pu=0)),Cs(l)}function z9(l,f){f===0&&(f=Wr()),l=eu(l,f),l!==null&&(rr(l,f),Cs(l))}function IL(l){var f=l.memoizedState,p=0;f!==null&&(p=f.retryLane),z9(l,p)}function AL(l,f){var p=0;switch(l.tag){case 13:var T=l.stateNode,E=l.memoizedState;E!==null&&(p=E.retryLane);break;case 19:T=l.stateNode;break;case 22:T=l.stateNode._retryCache;break;default:throw Error(r(314))}T!==null&&T.delete(f),z9(l,p)}function NL(l,f){return bn(l,f)}var Ad=null,Cu=null,Tm=!1,Nd=!1,Cm=!1,cl=0;function Cs(l){l!==Cu&&l.next===null&&(Cu===null?Ad=Cu=l:Cu=Cu.next=l),Nd=!0,Tm||(Tm=!0,UL())}function rg(l,f){if(!Cm&&Nd){Cm=!0;do for(var p=!1,T=Ad;T!==null;){if(l!==0){var E=T.pendingLanes;if(E===0)var D=0;else{var U=T.suspendedLanes,q=T.pingedLanes;D=(1<<31-xt(42|l)+1)-1,D&=E&~(U&~q),D=D&201326741?D&201326741|1:D?D|2:0}D!==0&&(p=!0,K9(T,D))}else D=ln,D=Ee(T,T===zn?D:0,T.cancelPendingCommit!==null||T.timeoutHandle!==-1),(D&3)===0||ze(T,D)||(p=!0,K9(T,D));T=T.next}while(p);Cm=!1}}function PL(){H9()}function H9(){Nd=Tm=!1;var l=0;cl!==0&&(HL()&&(l=cl),cl=0);for(var f=un(),p=null,T=Ad;T!==null;){var E=T.next,D=j9(T,f);D===0?(T.next=null,p===null?Ad=E:p.next=E,E===null&&(Cu=p)):(p=T,(l!==0||(D&3)!==0)&&(Nd=!0)),T=E}rg(l)}function j9(l,f){for(var p=l.suspendedLanes,T=l.pingedLanes,E=l.expirationTimes,D=l.pendingLanes&-62914561;0<D;){var U=31-xt(D),q=1<<U,ce=E[U];ce===-1?((q&p)===0||(q&T)!==0)&&(E[U]=ut(q,f)):ce<=f&&(l.expiredLanes|=q),D&=~q}if(f=zn,p=ln,p=Ee(l,l===f?p:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),T=l.callbackNode,p===0||l===f&&(_n===2||_n===9)||l.cancelPendingCommit!==null)return T!==null&&T!==null&&Gn(T),l.callbackNode=null,l.callbackPriority=0;if((p&3)===0||ze(l,p)){if(f=p&-p,f===l.callbackPriority)return f;switch(T!==null&&Gn(T),Ei(p)){case 2:case 8:p=Vr;break;case 32:p=Y;break;case 268435456:p=he;break;default:p=Y}return T=q9.bind(null,l),p=bn(p,T),l.callbackPriority=f,l.callbackNode=p,f}return T!==null&&T!==null&&Gn(T),l.callbackPriority=2,l.callbackNode=null,2}function q9(l,f){if(Ii!==0&&Ii!==5)return l.callbackNode=null,l.callbackPriority=0,null;var p=l.callbackNode;if(Id()&&l.callbackNode!==p)return null;var T=ln;return T=Ee(l,l===zn?T:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),T===0?null:(b9(l,T,f),j9(l,un()),l.callbackNode!=null&&l.callbackNode===p?q9.bind(null,l):null)}function K9(l,f){if(Id())return null;b9(l,f,!0)}function UL(){qL(function(){(Dn&6)!==0?bn(nr,PL):H9()})}function Sm(){return cl===0&&(cl=qt()),cl}function Y9(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:Ca(""+l)}function X9(l,f){var p=f.ownerDocument.createElement("input");return p.name=f.name,p.value=f.value,l.id&&p.setAttribute("form",l.id),f.parentNode.insertBefore(p,f),l=new FormData(l),p.parentNode.removeChild(p),l}function FL(l,f,p,T,E){if(f==="submit"&&p&&p.stateNode===E){var D=Y9((E[Ot]||null).action),U=T.submitter;U&&(f=(f=U[Ot]||null)?Y9(f.formAction):U.getAttribute("formAction"),f!==null&&(D=f,U=null));var q=new lo("action","action",null,T,E);l.push({event:q,listeners:[{instance:null,listener:function(){if(T.defaultPrevented){if(cl!==0){var ce=U?X9(E,U):new FormData(E);B5(p,{pending:!0,data:ce,method:E.method,action:D},null,ce)}}else typeof D=="function"&&(q.preventDefault(),ce=U?X9(E,U):new FormData(E),B5(p,{pending:!0,data:ce,method:E.method,action:D},D,ce))},currentTarget:E}]})}}for(var wm=0;wm<o5.length;wm++){var xm=o5[wm],kL=xm.toLowerCase(),GL=xm[0].toUpperCase()+xm.slice(1);jo(kL,"on"+GL)}jo(Jc,"onAnimationEnd"),jo(Mf,"onAnimationIteration"),jo(Lf,"onAnimationStart"),jo("dblclick","onDoubleClick"),jo("focusin","onFocus"),jo("focusout","onBlur"),jo(rL,"onTransitionRun"),jo(iL,"onTransitionStart"),jo(aL,"onTransitionCancel"),jo(Vy,"onTransitionEnd"),Hr("onMouseEnter",["mouseout","mouseover"]),Hr("onMouseLeave",["mouseout","mouseover"]),Hr("onPointerEnter",["pointerout","pointerover"]),Hr("onPointerLeave",["pointerout","pointerover"]),or("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),or("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),or("onBeforeInput",["compositionend","keypress","textInput","paste"]),or("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),or("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),or("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ig="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),BL=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ig));function Z9(l,f){f=(f&4)!==0;for(var p=0;p<l.length;p++){var T=l[p],E=T.event;T=T.listeners;e:{var D=void 0;if(f)for(var U=T.length-1;0<=U;U--){var q=T[U],ce=q.instance,Re=q.currentTarget;if(q=q.listener,ce!==D&&E.isPropagationStopped())break e;D=q,E.currentTarget=Re;try{D(E)}catch(Ge){wd(Ge)}E.currentTarget=null,D=ce}else for(U=0;U<T.length;U++){if(q=T[U],ce=q.instance,Re=q.currentTarget,q=q.listener,ce!==D&&E.isPropagationStopped())break e;D=q,E.currentTarget=Re;try{D(E)}catch(Ge){wd(Ge)}E.currentTarget=null,D=ce}}}}function Zt(l,f){var p=f[Dt];p===void 0&&(p=f[Dt]=new Set);var T=l+"__bubble";p.has(T)||(Q9(f,l,2,!1),p.add(T))}function Em(l,f,p){var T=0;f&&(T|=4),Q9(p,l,T,f)}var Pd="_reactListening"+Math.random().toString(36).slice(2);function Rm(l){if(!l[Pd]){l[Pd]=!0,ar.forEach(function(p){p!=="selectionchange"&&(BL.has(p)||Em(p,!1,l),Em(p,!0,l))});var f=l.nodeType===9?l:l.ownerDocument;f===null||f[Pd]||(f[Pd]=!0,Em("selectionchange",!1,f))}}function Q9(l,f,p,T){switch(w7(f)){case 2:var E=hV;break;case 8:E=pV;break;default:E=km}p=E.bind(null,f,p,l),E=void 0,!Zn||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(E=!0),T?E!==void 0?l.addEventListener(f,p,{capture:!0,passive:E}):l.addEventListener(f,p,!0):E!==void 0?l.addEventListener(f,p,{passive:E}):l.addEventListener(f,p,!1)}function Om(l,f,p,T,E){var D=T;if((f&1)===0&&(f&2)===0&&T!==null)e:for(;;){if(T===null)return;var U=T.tag;if(U===3||U===4){var q=T.stateNode.containerInfo;if(q===E)break;if(U===4)for(U=T.return;U!==null;){var ce=U.tag;if((ce===3||ce===4)&&U.stateNode.containerInfo===E)return;U=U.return}for(;q!==null;){if(U=gi(q),U===null)return;if(ce=U.tag,ce===5||ce===6||ce===26||ce===27){T=D=U;continue e}q=q.parentNode}}T=T.return}xn(function(){var Re=D,Ge=Nr(p),He=[];e:{var De=Iy.get(l);if(De!==void 0){var be=lo,Vt=l;switch(l){case"keypress":if(xa(p)===0)break e;case"keydown":case"keyup":be=gs;break;case"focusin":Vt="focus",be=Go;break;case"focusout":Vt="blur",be=Go;break;case"beforeblur":case"afterblur":be=Go;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":be=os;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":be=Qs;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":be=oc;break;case Jc:case Mf:case Lf:be=ec;break;case Vy:be=Wo;break;case"scroll":case"scrollend":be=Ga;break;case"wheel":be=Ra;break;case"copy":case"cut":case"paste":be=ls;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":be=ds;break;case"toggle":case"beforetoggle":be=hs}var bt=(f&4)!==0,In=!bt&&(l==="scroll"||l==="scrollend"),Ce=bt?De!==null?De+"Capture":null:De;bt=[];for(var me=Re,xe;me!==null;){var $e=me;if(xe=$e.stateNode,$e=$e.tag,$e!==5&&$e!==26&&$e!==27||xe===null||Ce===null||($e=bi(me,Ce),$e!=null&&bt.push(ag(me,$e,xe))),In)break;me=me.return}0<bt.length&&(De=new be(De,Vt,null,p,Ge),He.push({event:De,listeners:bt}))}}if((f&7)===0){e:{if(De=l==="mouseover"||l==="pointerover",be=l==="mouseout"||l==="pointerout",De&&p!==Bi&&(Vt=p.relatedTarget||p.fromElement)&&(gi(Vt)||Vt[Et]))break e;if((be||De)&&(De=Ge.window===Ge?Ge:(De=Ge.ownerDocument)?De.defaultView||De.parentWindow:window,be?(Vt=p.relatedTarget||p.toElement,be=Re,Vt=Vt?gi(Vt):null,Vt!==null&&(In=a(Vt),bt=Vt.tag,Vt!==In||bt!==5&&bt!==27&&bt!==6)&&(Vt=null)):(be=null,Vt=Re),be!==Vt)){if(bt=os,$e="onMouseLeave",Ce="onMouseEnter",me="mouse",(l==="pointerout"||l==="pointerover")&&(bt=ds,$e="onPointerLeave",Ce="onPointerEnter",me="pointer"),In=be==null?De:Rn(be),xe=Vt==null?De:Rn(Vt),De=new bt($e,me+"leave",be,p,Ge),De.target=In,De.relatedTarget=xe,$e=null,gi(Ge)===Re&&(bt=new bt(Ce,me+"enter",Vt,p,Ge),bt.target=xe,bt.relatedTarget=In,$e=bt),In=$e,be&&Vt)t:{for(bt=be,Ce=Vt,me=0,xe=bt;xe;xe=Su(xe))me++;for(xe=0,$e=Ce;$e;$e=Su($e))xe++;for(;0<me-xe;)bt=Su(bt),me--;for(;0<xe-me;)Ce=Su(Ce),xe--;for(;me--;){if(bt===Ce||Ce!==null&&bt===Ce.alternate)break t;bt=Su(bt),Ce=Su(Ce)}bt=null}else bt=null;be!==null&&J9(He,De,be,bt,!1),Vt!==null&&In!==null&&J9(He,In,Vt,bt,!0)}}e:{if(De=Re?Rn(Re):window,be=De.nodeName&&De.nodeName.toLowerCase(),be==="select"||be==="input"&&De.type==="file")var gt=N;else if(ke(De))if(ee)gt=M;else{gt=V;var Kt=L}else be=De.nodeName,!be||be.toLowerCase()!=="input"||De.type!=="checkbox"&&De.type!=="radio"?Re&&co(Re.elementType)&&(gt=N):gt=_;if(gt&&(gt=gt(l,Re))){Qe(He,gt,p,Ge);break e}Kt&&Kt(l,De,Re),l==="focusout"&&Re&&De.type==="number"&&Re.memoizedProps.value!=null&&ii(De,"number",De.value)}switch(Kt=Re?Rn(Re):window,l){case"focusin":(ke(Kt)||Kt.contentEditable==="true")&&(at=Kt,nt=Re,Rt=null);break;case"focusout":Rt=nt=at=null;break;case"mousedown":_t=!0;break;case"contextmenu":case"mouseup":case"dragend":_t=!1,Jt(He,p,Ge);break;case"selectionchange":if(Xe)break;case"keydown":case"keyup":Jt(He,p,Ge)}var Tt;if(Wa)e:{switch(l){case"compositionstart":var Lt="onCompositionStart";break e;case"compositionend":Lt="onCompositionEnd";break e;case"compositionupdate":Lt="onCompositionUpdate";break e}Lt=void 0}else _e?ne(l,p)&&(Lt="onCompositionEnd"):l==="keydown"&&p.keyCode===229&&(Lt="onCompositionStart");Lt&&(zo&&p.locale!=="ko"&&(_e||Lt!=="onCompositionStart"?Lt==="onCompositionEnd"&&_e&&(Tt=Mi()):(Qn=Ge,ko="value"in Qn?Qn.value:Qn.textContent,_e=!0)),Kt=Ud(Re,Lt),0<Kt.length&&(Lt=new go(Lt,l,null,p,Ge),He.push({event:Lt,listeners:Kt}),Tt?Lt.data=Tt:(Tt=Se(p),Tt!==null&&(Lt.data=Tt)))),(Tt=po?Ue(l,p):Fe(l,p))&&(Lt=Ud(Re,"onBeforeInput"),0<Lt.length&&(Kt=new go("onBeforeInput","beforeinput",null,p,Ge),He.push({event:Kt,listeners:Lt}),Kt.data=Tt)),FL(He,l,Re,p,Ge)}Z9(He,f)})}function ag(l,f,p){return{instance:l,listener:f,currentTarget:p}}function Ud(l,f){for(var p=f+"Capture",T=[];l!==null;){var E=l,D=E.stateNode;if(E=E.tag,E!==5&&E!==26&&E!==27||D===null||(E=bi(l,p),E!=null&&T.unshift(ag(l,E,D)),E=bi(l,f),E!=null&&T.push(ag(l,E,D))),l.tag===3)return T;l=l.return}return[]}function Su(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function J9(l,f,p,T,E){for(var D=f._reactName,U=[];p!==null&&p!==T;){var q=p,ce=q.alternate,Re=q.stateNode;if(q=q.tag,ce!==null&&ce===T)break;q!==5&&q!==26&&q!==27||Re===null||(ce=Re,E?(Re=bi(p,D),Re!=null&&U.unshift(ag(p,Re,ce))):E||(Re=bi(p,D),Re!=null&&U.push(ag(p,Re,ce)))),p=p.return}U.length!==0&&l.push({event:f,listeners:U})}var $L=/\r\n?/g,WL=/\u0000|\uFFFD/g;function e7(l){return(typeof l=="string"?l:""+l).replace($L,`
`).replace(WL,"")}function t7(l,f){return f=e7(f),e7(l)===f}function Fd(){}function Vn(l,f,p,T,E,D){switch(p){case"children":typeof T=="string"?f==="body"||f==="textarea"&&T===""||na(l,T):(typeof T=="number"||typeof T=="bigint")&&f!=="body"&&na(l,""+T);break;case"className":Fa(l,"class",T);break;case"tabIndex":Fa(l,"tabindex",T);break;case"dir":case"role":case"viewBox":case"width":case"height":Fa(l,p,T);break;case"style":Wn(l,T,D);break;case"data":if(f!=="object"){Fa(l,"data",T);break}case"src":case"href":if(T===""&&(f!=="a"||p!=="href")){l.removeAttribute(p);break}if(T==null||typeof T=="function"||typeof T=="symbol"||typeof T=="boolean"){l.removeAttribute(p);break}T=Ca(""+T),l.setAttribute(p,T);break;case"action":case"formAction":if(typeof T=="function"){l.setAttribute(p,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof D=="function"&&(p==="formAction"?(f!=="input"&&Vn(l,f,"name",E.name,E,null),Vn(l,f,"formEncType",E.formEncType,E,null),Vn(l,f,"formMethod",E.formMethod,E,null),Vn(l,f,"formTarget",E.formTarget,E,null)):(Vn(l,f,"encType",E.encType,E,null),Vn(l,f,"method",E.method,E,null),Vn(l,f,"target",E.target,E,null)));if(T==null||typeof T=="symbol"||typeof T=="boolean"){l.removeAttribute(p);break}T=Ca(""+T),l.setAttribute(p,T);break;case"onClick":T!=null&&(l.onclick=Fd);break;case"onScroll":T!=null&&Zt("scroll",l);break;case"onScrollEnd":T!=null&&Zt("scrollend",l);break;case"dangerouslySetInnerHTML":if(T!=null){if(typeof T!="object"||!("__html"in T))throw Error(r(61));if(p=T.__html,p!=null){if(E.children!=null)throw Error(r(60));l.innerHTML=p}}break;case"multiple":l.multiple=T&&typeof T!="function"&&typeof T!="symbol";break;case"muted":l.muted=T&&typeof T!="function"&&typeof T!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(T==null||typeof T=="function"||typeof T=="boolean"||typeof T=="symbol"){l.removeAttribute("xlink:href");break}p=Ca(""+T),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",p);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":T!=null&&typeof T!="function"&&typeof T!="symbol"?l.setAttribute(p,""+T):l.removeAttribute(p);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":T&&typeof T!="function"&&typeof T!="symbol"?l.setAttribute(p,""):l.removeAttribute(p);break;case"capture":case"download":T===!0?l.setAttribute(p,""):T!==!1&&T!=null&&typeof T!="function"&&typeof T!="symbol"?l.setAttribute(p,T):l.removeAttribute(p);break;case"cols":case"rows":case"size":case"span":T!=null&&typeof T!="function"&&typeof T!="symbol"&&!isNaN(T)&&1<=T?l.setAttribute(p,T):l.removeAttribute(p);break;case"rowSpan":case"start":T==null||typeof T=="function"||typeof T=="symbol"||isNaN(T)?l.removeAttribute(p):l.setAttribute(p,T);break;case"popover":Zt("beforetoggle",l),Zt("toggle",l),qr(l,"popover",T);break;case"xlinkActuate":Xn(l,"http://www.w3.org/1999/xlink","xlink:actuate",T);break;case"xlinkArcrole":Xn(l,"http://www.w3.org/1999/xlink","xlink:arcrole",T);break;case"xlinkRole":Xn(l,"http://www.w3.org/1999/xlink","xlink:role",T);break;case"xlinkShow":Xn(l,"http://www.w3.org/1999/xlink","xlink:show",T);break;case"xlinkTitle":Xn(l,"http://www.w3.org/1999/xlink","xlink:title",T);break;case"xlinkType":Xn(l,"http://www.w3.org/1999/xlink","xlink:type",T);break;case"xmlBase":Xn(l,"http://www.w3.org/XML/1998/namespace","xml:base",T);break;case"xmlLang":Xn(l,"http://www.w3.org/XML/1998/namespace","xml:lang",T);break;case"xmlSpace":Xn(l,"http://www.w3.org/XML/1998/namespace","xml:space",T);break;case"is":qr(l,"is",T);break;case"innerText":case"textContent":break;default:(!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(p=oi.get(p)||p,qr(l,p,T))}}function Dm(l,f,p,T,E,D){switch(p){case"style":Wn(l,T,D);break;case"dangerouslySetInnerHTML":if(T!=null){if(typeof T!="object"||!("__html"in T))throw Error(r(61));if(p=T.__html,p!=null){if(E.children!=null)throw Error(r(60));l.innerHTML=p}}break;case"children":typeof T=="string"?na(l,T):(typeof T=="number"||typeof T=="bigint")&&na(l,""+T);break;case"onScroll":T!=null&&Zt("scroll",l);break;case"onScrollEnd":T!=null&&Zt("scrollend",l);break;case"onClick":T!=null&&(l.onclick=Fd);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ao.hasOwnProperty(p))e:{if(p[0]==="o"&&p[1]==="n"&&(E=p.endsWith("Capture"),f=p.slice(2,E?p.length-7:void 0),D=l[Ot]||null,D=D!=null?D[p]:null,typeof D=="function"&&l.removeEventListener(f,D,E),typeof T=="function")){typeof D!="function"&&D!==null&&(p in l?l[p]=null:l.hasAttribute(p)&&l.removeAttribute(p)),l.addEventListener(f,T,E);break e}p in l?l[p]=T:T===!0?l.setAttribute(p,""):qr(l,p,T)}}}function Ai(l,f,p){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Zt("error",l),Zt("load",l);var T=!1,E=!1,D;for(D in p)if(p.hasOwnProperty(D)){var U=p[D];if(U!=null)switch(D){case"src":T=!0;break;case"srcSet":E=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,f));default:Vn(l,f,D,U,p,null)}}E&&Vn(l,f,"srcSet",p.srcSet,p,null),T&&Vn(l,f,"src",p.src,p,null);return;case"input":Zt("invalid",l);var q=D=U=E=null,ce=null,Re=null;for(T in p)if(p.hasOwnProperty(T)){var Ge=p[T];if(Ge!=null)switch(T){case"name":E=Ge;break;case"type":U=Ge;break;case"checked":ce=Ge;break;case"defaultChecked":Re=Ge;break;case"value":D=Ge;break;case"defaultValue":q=Ge;break;case"children":case"dangerouslySetInnerHTML":if(Ge!=null)throw Error(r(137,f));break;default:Vn(l,f,T,Ge,p,null)}}as(l,D,q,ce,Re,U,E,!1),ta(l);return;case"select":Zt("invalid",l),T=U=D=null;for(E in p)if(p.hasOwnProperty(E)&&(q=p[E],q!=null))switch(E){case"value":D=q;break;case"defaultValue":U=q;break;case"multiple":T=q;default:Vn(l,f,E,q,p,null)}f=D,p=U,l.multiple=!!T,f!=null?Sr(l,!!T,f,!1):p!=null&&Sr(l,!!T,p,!0);return;case"textarea":Zt("invalid",l),D=E=T=null;for(U in p)if(p.hasOwnProperty(U)&&(q=p[U],q!=null))switch(U){case"value":T=q;break;case"defaultValue":E=q;break;case"children":D=q;break;case"dangerouslySetInnerHTML":if(q!=null)throw Error(r(91));break;default:Vn(l,f,U,q,p,null)}wr(l,T,E,D),ta(l);return;case"option":for(ce in p)if(p.hasOwnProperty(ce)&&(T=p[ce],T!=null))switch(ce){case"selected":l.selected=T&&typeof T!="function"&&typeof T!="symbol";break;default:Vn(l,f,ce,T,p,null)}return;case"dialog":Zt("beforetoggle",l),Zt("toggle",l),Zt("cancel",l),Zt("close",l);break;case"iframe":case"object":Zt("load",l);break;case"video":case"audio":for(T=0;T<ig.length;T++)Zt(ig[T],l);break;case"image":Zt("error",l),Zt("load",l);break;case"details":Zt("toggle",l);break;case"embed":case"source":case"link":Zt("error",l),Zt("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Re in p)if(p.hasOwnProperty(Re)&&(T=p[Re],T!=null))switch(Re){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,f));default:Vn(l,f,Re,T,p,null)}return;default:if(co(f)){for(Ge in p)p.hasOwnProperty(Ge)&&(T=p[Ge],T!==void 0&&Dm(l,f,Ge,T,p,void 0));return}}for(q in p)p.hasOwnProperty(q)&&(T=p[q],T!=null&&Vn(l,f,q,T,p,null))}function zL(l,f,p,T){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var E=null,D=null,U=null,q=null,ce=null,Re=null,Ge=null;for(be in p){var He=p[be];if(p.hasOwnProperty(be)&&He!=null)switch(be){case"checked":break;case"value":break;case"defaultValue":ce=He;default:T.hasOwnProperty(be)||Vn(l,f,be,null,T,He)}}for(var De in T){var be=T[De];if(He=p[De],T.hasOwnProperty(De)&&(be!=null||He!=null))switch(De){case"type":D=be;break;case"name":E=be;break;case"checked":Re=be;break;case"defaultChecked":Ge=be;break;case"value":U=be;break;case"defaultValue":q=be;break;case"children":case"dangerouslySetInnerHTML":if(be!=null)throw Error(r(137,f));break;default:be!==He&&Vn(l,f,De,be,T,He)}}Uo(l,U,q,ce,Re,Ge,D,E);return;case"select":be=U=q=De=null;for(D in p)if(ce=p[D],p.hasOwnProperty(D)&&ce!=null)switch(D){case"value":break;case"multiple":be=ce;default:T.hasOwnProperty(D)||Vn(l,f,D,null,T,ce)}for(E in T)if(D=T[E],ce=p[E],T.hasOwnProperty(E)&&(D!=null||ce!=null))switch(E){case"value":De=D;break;case"defaultValue":q=D;break;case"multiple":U=D;default:D!==ce&&Vn(l,f,E,D,T,ce)}f=q,p=U,T=be,De!=null?Sr(l,!!p,De,!1):!!T!=!!p&&(f!=null?Sr(l,!!p,f,!0):Sr(l,!!p,p?[]:"",!1));return;case"textarea":be=De=null;for(q in p)if(E=p[q],p.hasOwnProperty(q)&&E!=null&&!T.hasOwnProperty(q))switch(q){case"value":break;case"children":break;default:Vn(l,f,q,null,T,E)}for(U in T)if(E=T[U],D=p[U],T.hasOwnProperty(U)&&(E!=null||D!=null))switch(U){case"value":De=E;break;case"defaultValue":be=E;break;case"children":break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(r(91));break;default:E!==D&&Vn(l,f,U,E,T,D)}ai(l,De,be);return;case"option":for(var Vt in p)if(De=p[Vt],p.hasOwnProperty(Vt)&&De!=null&&!T.hasOwnProperty(Vt))switch(Vt){case"selected":l.selected=!1;break;default:Vn(l,f,Vt,null,T,De)}for(ce in T)if(De=T[ce],be=p[ce],T.hasOwnProperty(ce)&&De!==be&&(De!=null||be!=null))switch(ce){case"selected":l.selected=De&&typeof De!="function"&&typeof De!="symbol";break;default:Vn(l,f,ce,De,T,be)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var bt in p)De=p[bt],p.hasOwnProperty(bt)&&De!=null&&!T.hasOwnProperty(bt)&&Vn(l,f,bt,null,T,De);for(Re in T)if(De=T[Re],be=p[Re],T.hasOwnProperty(Re)&&De!==be&&(De!=null||be!=null))switch(Re){case"children":case"dangerouslySetInnerHTML":if(De!=null)throw Error(r(137,f));break;default:Vn(l,f,Re,De,T,be)}return;default:if(co(f)){for(var In in p)De=p[In],p.hasOwnProperty(In)&&De!==void 0&&!T.hasOwnProperty(In)&&Dm(l,f,In,void 0,T,De);for(Ge in T)De=T[Ge],be=p[Ge],!T.hasOwnProperty(Ge)||De===be||De===void 0&&be===void 0||Dm(l,f,Ge,De,T,be);return}}for(var Ce in p)De=p[Ce],p.hasOwnProperty(Ce)&&De!=null&&!T.hasOwnProperty(Ce)&&Vn(l,f,Ce,null,T,De);for(He in T)De=T[He],be=p[He],!T.hasOwnProperty(He)||De===be||De==null&&be==null||Vn(l,f,He,De,T,be)}var _m=null,bm=null;function kd(l){return l.nodeType===9?l:l.ownerDocument}function n7(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function r7(l,f){if(l===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&f==="foreignObject"?0:l}function Mm(l,f){return l==="textarea"||l==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var Lm=null;function HL(){var l=window.event;return l&&l.type==="popstate"?l===Lm?!1:(Lm=l,!0):(Lm=null,!1)}var i7=typeof setTimeout=="function"?setTimeout:void 0,jL=typeof clearTimeout=="function"?clearTimeout:void 0,a7=typeof Promise=="function"?Promise:void 0,qL=typeof queueMicrotask=="function"?queueMicrotask:typeof a7<"u"?function(l){return a7.resolve(null).then(l).catch(KL)}:i7;function KL(l){setTimeout(function(){throw l})}function p0(l){return l==="head"}function o7(l,f){var p=f,T=0,E=0;do{var D=p.nextSibling;if(l.removeChild(p),D&&D.nodeType===8)if(p=D.data,p==="/$"){if(0<T&&8>T){p=T;var U=l.ownerDocument;if(p&1&&og(U.documentElement),p&2&&og(U.body),p&4)for(p=U.head,og(p),U=p.firstChild;U;){var q=U.nextSibling,ce=U.nodeName;U[ki]||ce==="SCRIPT"||ce==="STYLE"||ce==="LINK"&&U.rel.toLowerCase()==="stylesheet"||p.removeChild(U),U=q}}if(E===0){l.removeChild(D),hg(f);return}E--}else p==="$"||p==="$?"||p==="$!"?E++:T=p.charCodeAt(0)-48;else T=0;p=D}while(p);hg(f)}function Vm(l){var f=l.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var p=f;switch(f=f.nextSibling,p.nodeName){case"HTML":case"HEAD":case"BODY":Vm(p),Oi(p);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(p.rel.toLowerCase()==="stylesheet")continue}l.removeChild(p)}}function YL(l,f,p,T){for(;l.nodeType===1;){var E=p;if(l.nodeName.toLowerCase()!==f.toLowerCase()){if(!T&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(T){if(!l[ki])switch(f){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(D=l.getAttribute("rel"),D==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(D!==E.rel||l.getAttribute("href")!==(E.href==null||E.href===""?null:E.href)||l.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin)||l.getAttribute("title")!==(E.title==null?null:E.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(D=l.getAttribute("src"),(D!==(E.src==null?null:E.src)||l.getAttribute("type")!==(E.type==null?null:E.type)||l.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin))&&D&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(f==="input"&&l.type==="hidden"){var D=E.name==null?null:""+E.name;if(E.type==="hidden"&&l.getAttribute("name")===D)return l}else return l;if(l=Ko(l.nextSibling),l===null)break}return null}function XL(l,f,p){if(f==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!p||(l=Ko(l.nextSibling),l===null))return null;return l}function Im(l){return l.data==="$!"||l.data==="$?"&&l.ownerDocument.readyState==="complete"}function ZL(l,f){var p=l.ownerDocument;if(l.data!=="$?"||p.readyState==="complete")f();else{var T=function(){f(),p.removeEventListener("DOMContentLoaded",T)};p.addEventListener("DOMContentLoaded",T),l._reactRetry=T}}function Ko(l){for(;l!=null;l=l.nextSibling){var f=l.nodeType;if(f===1||f===3)break;if(f===8){if(f=l.data,f==="$"||f==="$!"||f==="$?"||f==="F!"||f==="F")break;if(f==="/$")return null}}return l}var Am=null;function s7(l){l=l.previousSibling;for(var f=0;l;){if(l.nodeType===8){var p=l.data;if(p==="$"||p==="$!"||p==="$?"){if(f===0)return l;f--}else p==="/$"&&f++}l=l.previousSibling}return null}function c7(l,f,p){switch(f=kd(p),l){case"html":if(l=f.documentElement,!l)throw Error(r(452));return l;case"head":if(l=f.head,!l)throw Error(r(453));return l;case"body":if(l=f.body,!l)throw Error(r(454));return l;default:throw Error(r(451))}}function og(l){for(var f=l.attributes;f.length;)l.removeAttributeNode(f[0]);Oi(l)}var xo=new Map,l7=new Set;function Gd(l){return typeof l.getRootNode=="function"?l.getRootNode():l.nodeType===9?l:l.ownerDocument}var Tc=ie.d;ie.d={f:QL,r:JL,D:eV,C:tV,L:nV,m:rV,X:aV,S:iV,M:oV};function QL(){var l=Tc.f(),f=Ld();return l||f}function JL(l){var f=Di(l);f!==null&&f.tag===5&&f.type==="form"?b6(f):Tc.r(l)}var wu=typeof document>"u"?null:document;function u7(l,f,p){var T=wu;if(T&&typeof f=="string"&&f){var E=Kr(f);E='link[rel="'+l+'"][href="'+E+'"]',typeof p=="string"&&(E+='[crossorigin="'+p+'"]'),l7.has(E)||(l7.add(E),l={rel:l,crossOrigin:p,href:f},T.querySelector(E)===null&&(f=T.createElement("link"),Ai(f,"link",l),vt(f),T.head.appendChild(f)))}}function eV(l){Tc.D(l),u7("dns-prefetch",l,null)}function tV(l,f){Tc.C(l,f),u7("preconnect",l,f)}function nV(l,f,p){Tc.L(l,f,p);var T=wu;if(T&&l&&f){var E='link[rel="preload"][as="'+Kr(f)+'"]';f==="image"&&p&&p.imageSrcSet?(E+='[imagesrcset="'+Kr(p.imageSrcSet)+'"]',typeof p.imageSizes=="string"&&(E+='[imagesizes="'+Kr(p.imageSizes)+'"]')):E+='[href="'+Kr(l)+'"]';var D=E;switch(f){case"style":D=xu(l);break;case"script":D=Eu(l)}xo.has(D)||(l=d({rel:"preload",href:f==="image"&&p&&p.imageSrcSet?void 0:l,as:f},p),xo.set(D,l),T.querySelector(E)!==null||f==="style"&&T.querySelector(sg(D))||f==="script"&&T.querySelector(cg(D))||(f=T.createElement("link"),Ai(f,"link",l),vt(f),T.head.appendChild(f)))}}function rV(l,f){Tc.m(l,f);var p=wu;if(p&&l){var T=f&&typeof f.as=="string"?f.as:"script",E='link[rel="modulepreload"][as="'+Kr(T)+'"][href="'+Kr(l)+'"]',D=E;switch(T){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":D=Eu(l)}if(!xo.has(D)&&(l=d({rel:"modulepreload",href:l},f),xo.set(D,l),p.querySelector(E)===null)){switch(T){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(p.querySelector(cg(D)))return}T=p.createElement("link"),Ai(T,"link",l),vt(T),p.head.appendChild(T)}}}function iV(l,f,p){Tc.S(l,f,p);var T=wu;if(T&&l){var E=Ar(T).hoistableStyles,D=xu(l);f=f||"default";var U=E.get(D);if(!U){var q={loading:0,preload:null};if(U=T.querySelector(sg(D)))q.loading=5;else{l=d({rel:"stylesheet",href:l,"data-precedence":f},p),(p=xo.get(D))&&Nm(l,p);var ce=U=T.createElement("link");vt(ce),Ai(ce,"link",l),ce._p=new Promise(function(Re,Ge){ce.onload=Re,ce.onerror=Ge}),ce.addEventListener("load",function(){q.loading|=1}),ce.addEventListener("error",function(){q.loading|=2}),q.loading|=4,Bd(U,f,T)}U={type:"stylesheet",instance:U,count:1,state:q},E.set(D,U)}}}function aV(l,f){Tc.X(l,f);var p=wu;if(p&&l){var T=Ar(p).hoistableScripts,E=Eu(l),D=T.get(E);D||(D=p.querySelector(cg(E)),D||(l=d({src:l,async:!0},f),(f=xo.get(E))&&Pm(l,f),D=p.createElement("script"),vt(D),Ai(D,"link",l),p.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},T.set(E,D))}}function oV(l,f){Tc.M(l,f);var p=wu;if(p&&l){var T=Ar(p).hoistableScripts,E=Eu(l),D=T.get(E);D||(D=p.querySelector(cg(E)),D||(l=d({src:l,async:!0,type:"module"},f),(f=xo.get(E))&&Pm(l,f),D=p.createElement("script"),vt(D),Ai(D,"link",l),p.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},T.set(E,D))}}function f7(l,f,p,T){var E=(E=Ze.current)?Gd(E):null;if(!E)throw Error(r(446));switch(l){case"meta":case"title":return null;case"style":return typeof p.precedence=="string"&&typeof p.href=="string"?(f=xu(p.href),p=Ar(E).hoistableStyles,T=p.get(f),T||(T={type:"style",instance:null,count:0,state:null},p.set(f,T)),T):{type:"void",instance:null,count:0,state:null};case"link":if(p.rel==="stylesheet"&&typeof p.href=="string"&&typeof p.precedence=="string"){l=xu(p.href);var D=Ar(E).hoistableStyles,U=D.get(l);if(U||(E=E.ownerDocument||E,U={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},D.set(l,U),(D=E.querySelector(sg(l)))&&!D._p&&(U.instance=D,U.state.loading=5),xo.has(l)||(p={rel:"preload",as:"style",href:p.href,crossOrigin:p.crossOrigin,integrity:p.integrity,media:p.media,hrefLang:p.hrefLang,referrerPolicy:p.referrerPolicy},xo.set(l,p),D||sV(E,l,p,U.state))),f&&T===null)throw Error(r(528,""));return U}if(f&&T!==null)throw Error(r(529,""));return null;case"script":return f=p.async,p=p.src,typeof p=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=Eu(p),p=Ar(E).hoistableScripts,T=p.get(f),T||(T={type:"script",instance:null,count:0,state:null},p.set(f,T)),T):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,l))}}function xu(l){return'href="'+Kr(l)+'"'}function sg(l){return'link[rel="stylesheet"]['+l+"]"}function g7(l){return d({},l,{"data-precedence":l.precedence,precedence:null})}function sV(l,f,p,T){l.querySelector('link[rel="preload"][as="style"]['+f+"]")?T.loading=1:(f=l.createElement("link"),T.preload=f,f.addEventListener("load",function(){return T.loading|=1}),f.addEventListener("error",function(){return T.loading|=2}),Ai(f,"link",p),vt(f),l.head.appendChild(f))}function Eu(l){return'[src="'+Kr(l)+'"]'}function cg(l){return"script[async]"+l}function d7(l,f,p){if(f.count++,f.instance===null)switch(f.type){case"style":var T=l.querySelector('style[data-href~="'+Kr(p.href)+'"]');if(T)return f.instance=T,vt(T),T;var E=d({},p,{"data-href":p.href,"data-precedence":p.precedence,href:null,precedence:null});return T=(l.ownerDocument||l).createElement("style"),vt(T),Ai(T,"style",E),Bd(T,p.precedence,l),f.instance=T;case"stylesheet":E=xu(p.href);var D=l.querySelector(sg(E));if(D)return f.state.loading|=4,f.instance=D,vt(D),D;T=g7(p),(E=xo.get(E))&&Nm(T,E),D=(l.ownerDocument||l).createElement("link"),vt(D);var U=D;return U._p=new Promise(function(q,ce){U.onload=q,U.onerror=ce}),Ai(D,"link",T),f.state.loading|=4,Bd(D,p.precedence,l),f.instance=D;case"script":return D=Eu(p.src),(E=l.querySelector(cg(D)))?(f.instance=E,vt(E),E):(T=p,(E=xo.get(D))&&(T=d({},p),Pm(T,E)),l=l.ownerDocument||l,E=l.createElement("script"),vt(E),Ai(E,"link",T),l.head.appendChild(E),f.instance=E);case"void":return null;default:throw Error(r(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(T=f.instance,f.state.loading|=4,Bd(T,p.precedence,l));return f.instance}function Bd(l,f,p){for(var T=p.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),E=T.length?T[T.length-1]:null,D=E,U=0;U<T.length;U++){var q=T[U];if(q.dataset.precedence===f)D=q;else if(D!==E)break}D?D.parentNode.insertBefore(l,D.nextSibling):(f=p.nodeType===9?p.head:p,f.insertBefore(l,f.firstChild))}function Nm(l,f){l.crossOrigin==null&&(l.crossOrigin=f.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=f.referrerPolicy),l.title==null&&(l.title=f.title)}function Pm(l,f){l.crossOrigin==null&&(l.crossOrigin=f.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=f.referrerPolicy),l.integrity==null&&(l.integrity=f.integrity)}var $d=null;function h7(l,f,p){if($d===null){var T=new Map,E=$d=new Map;E.set(p,T)}else E=$d,T=E.get(p),T||(T=new Map,E.set(p,T));if(T.has(l))return T;for(T.set(l,null),p=p.getElementsByTagName(l),E=0;E<p.length;E++){var D=p[E];if(!(D[ki]||D[ot]||l==="link"&&D.getAttribute("rel")==="stylesheet")&&D.namespaceURI!=="http://www.w3.org/2000/svg"){var U=D.getAttribute(f)||"";U=l+U;var q=T.get(U);q?q.push(D):T.set(U,[D])}}return T}function p7(l,f,p){l=l.ownerDocument||l,l.head.insertBefore(p,f==="title"?l.querySelector("head > title"):null)}function cV(l,f,p){if(p===1||f.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;switch(f.rel){case"stylesheet":return l=f.disabled,typeof f.precedence=="string"&&l==null;default:return!0}case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function m7(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}var lg=null;function lV(){}function uV(l,f,p){if(lg===null)throw Error(r(475));var T=lg;if(f.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var E=xu(p.href),D=l.querySelector(sg(E));if(D){l=D._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(T.count++,T=Wd.bind(T),l.then(T,T)),f.state.loading|=4,f.instance=D,vt(D);return}D=l.ownerDocument||l,p=g7(p),(E=xo.get(E))&&Nm(p,E),D=D.createElement("link"),vt(D);var U=D;U._p=new Promise(function(q,ce){U.onload=q,U.onerror=ce}),Ai(D,"link",p),f.instance=D}T.stylesheets===null&&(T.stylesheets=new Map),T.stylesheets.set(f,l),(l=f.state.preload)&&(f.state.loading&3)===0&&(T.count++,f=Wd.bind(T),l.addEventListener("load",f),l.addEventListener("error",f))}}function fV(){if(lg===null)throw Error(r(475));var l=lg;return l.stylesheets&&l.count===0&&Um(l,l.stylesheets),0<l.count?function(f){var p=setTimeout(function(){if(l.stylesheets&&Um(l,l.stylesheets),l.unsuspend){var T=l.unsuspend;l.unsuspend=null,T()}},6e4);return l.unsuspend=f,function(){l.unsuspend=null,clearTimeout(p)}}:null}function Wd(){if(this.count--,this.count===0){if(this.stylesheets)Um(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var zd=null;function Um(l,f){l.stylesheets=null,l.unsuspend!==null&&(l.count++,zd=new Map,f.forEach(gV,l),zd=null,Wd.call(l))}function gV(l,f){if(!(f.state.loading&4)){var p=zd.get(l);if(p)var T=p.get(null);else{p=new Map,zd.set(l,p);for(var E=l.querySelectorAll("link[data-precedence],style[data-precedence]"),D=0;D<E.length;D++){var U=E[D];(U.nodeName==="LINK"||U.getAttribute("media")!=="not all")&&(p.set(U.dataset.precedence,U),T=U)}T&&p.set(null,T)}E=f.instance,U=E.getAttribute("data-precedence"),D=p.get(U)||T,D===T&&p.set(null,E),p.set(U,E),this.count++,T=Wd.bind(this),E.addEventListener("load",T),E.addEventListener("error",T),D?D.parentNode.insertBefore(E,D.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(E,l.firstChild)),f.state.loading|=4}}var ug={$$typeof:x,Provider:null,Consumer:null,_currentValue:ye,_currentValue2:ye,_threadCount:0};function dV(l,f,p,T,E,D,U,q){this.tag=1,this.containerInfo=l,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=vr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vr(0),this.hiddenUpdates=vr(null),this.identifierPrefix=T,this.onUncaughtError=E,this.onCaughtError=D,this.onRecoverableError=U,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=q,this.incompleteTransitions=new Map}function v7(l,f,p,T,E,D,U,q,ce,Re,Ge,He){return l=new dV(l,f,p,U,q,ce,Re,He),f=1,D===!0&&(f|=24),D=za(3,null,null,f),l.current=D,D.stateNode=l,f=y5(),f.refCount++,l.pooledCache=f,f.refCount++,D.memoizedState={element:T,isDehydrated:p,cache:f},w5(D),l}function y7(l){return l?(l=tu,l):tu}function T7(l,f,p,T,E,D){E=y7(E),T.context===null?T.context=E:T.pendingContext=E,T=n0(f),T.payload={element:p},D=D===void 0?null:D,D!==null&&(T.callback=D),p=r0(l,T,f),p!==null&&(Ya(p,l,f),Gf(p,l,f))}function C7(l,f){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var p=l.retryLane;l.retryLane=p!==0&&p<f?p:f}}function Fm(l,f){C7(l,f),(l=l.alternate)&&C7(l,f)}function S7(l){if(l.tag===13){var f=eu(l,67108864);f!==null&&Ya(f,l,67108864),Fm(l,67108864)}}var Hd=!0;function hV(l,f,p,T){var E=X.T;X.T=null;var D=ie.p;try{ie.p=2,km(l,f,p,T)}finally{ie.p=D,X.T=E}}function pV(l,f,p,T){var E=X.T;X.T=null;var D=ie.p;try{ie.p=8,km(l,f,p,T)}finally{ie.p=D,X.T=E}}function km(l,f,p,T){if(Hd){var E=Gm(T);if(E===null)Om(l,f,T,jd,p),x7(l,T);else if(vV(E,l,f,p,T))T.stopPropagation();else if(x7(l,T),f&4&&-1<mV.indexOf(l)){for(;E!==null;){var D=Di(E);if(D!==null)switch(D.tag){case 3:if(D=D.stateNode,D.current.memoizedState.isDehydrated){var U=Ht(D.pendingLanes);if(U!==0){var q=D;for(q.pendingLanes|=2,q.entangledLanes|=2;U;){var ce=1<<31-xt(U);q.entanglements[1]|=ce,U&=~ce}Cs(D),(Dn&6)===0&&(bd=un()+500,rg(0))}}break;case 13:q=eu(D,2),q!==null&&Ya(q,D,2),Ld(),Fm(D,2)}if(D=Gm(T),D===null&&Om(l,f,T,jd,p),D===E)break;E=D}E!==null&&T.stopPropagation()}else Om(l,f,T,null,p)}}function Gm(l){return l=Nr(l),Bm(l)}var jd=null;function Bm(l){if(jd=null,l=gi(l),l!==null){var f=a(l);if(f===null)l=null;else{var p=f.tag;if(p===13){if(l=o(f),l!==null)return l;l=null}else if(p===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;l=null}else f!==l&&(l=null)}}return jd=l,null}function w7(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Bn()){case nr:return 2;case Vr:return 8;case Y:case J:return 32;case he:return 268435456;default:return 32}default:return 32}}var $m=!1,m0=null,v0=null,y0=null,fg=new Map,gg=new Map,T0=[],mV="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function x7(l,f){switch(l){case"focusin":case"focusout":m0=null;break;case"dragenter":case"dragleave":v0=null;break;case"mouseover":case"mouseout":y0=null;break;case"pointerover":case"pointerout":fg.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":gg.delete(f.pointerId)}}function dg(l,f,p,T,E,D){return l===null||l.nativeEvent!==D?(l={blockedOn:f,domEventName:p,eventSystemFlags:T,nativeEvent:D,targetContainers:[E]},f!==null&&(f=Di(f),f!==null&&S7(f)),l):(l.eventSystemFlags|=T,f=l.targetContainers,E!==null&&f.indexOf(E)===-1&&f.push(E),l)}function vV(l,f,p,T,E){switch(f){case"focusin":return m0=dg(m0,l,f,p,T,E),!0;case"dragenter":return v0=dg(v0,l,f,p,T,E),!0;case"mouseover":return y0=dg(y0,l,f,p,T,E),!0;case"pointerover":var D=E.pointerId;return fg.set(D,dg(fg.get(D)||null,l,f,p,T,E)),!0;case"gotpointercapture":return D=E.pointerId,gg.set(D,dg(gg.get(D)||null,l,f,p,T,E)),!0}return!1}function E7(l){var f=gi(l.target);if(f!==null){var p=a(f);if(p!==null){if(f=p.tag,f===13){if(f=o(p),f!==null){l.blockedOn=f,$n(l.priority,function(){if(p.tag===13){var T=Ka();T=ir(T);var E=eu(p,T);E!==null&&Ya(E,p,T),Fm(p,T)}});return}}else if(f===3&&p.stateNode.current.memoizedState.isDehydrated){l.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}l.blockedOn=null}function qd(l){if(l.blockedOn!==null)return!1;for(var f=l.targetContainers;0<f.length;){var p=Gm(l.nativeEvent);if(p===null){p=l.nativeEvent;var T=new p.constructor(p.type,p);Bi=T,p.target.dispatchEvent(T),Bi=null}else return f=Di(p),f!==null&&S7(f),l.blockedOn=p,!1;f.shift()}return!0}function R7(l,f,p){qd(l)&&p.delete(f)}function yV(){$m=!1,m0!==null&&qd(m0)&&(m0=null),v0!==null&&qd(v0)&&(v0=null),y0!==null&&qd(y0)&&(y0=null),fg.forEach(R7),gg.forEach(R7)}function Kd(l,f){l.blockedOn===f&&(l.blockedOn=null,$m||($m=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,yV)))}var Yd=null;function O7(l){Yd!==l&&(Yd=l,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Yd===l&&(Yd=null);for(var f=0;f<l.length;f+=3){var p=l[f],T=l[f+1],E=l[f+2];if(typeof T!="function"){if(Bm(T||p)===null)continue;break}var D=Di(p);D!==null&&(l.splice(f,3),f-=3,B5(D,{pending:!0,data:E,method:p.method,action:T},T,E))}}))}function hg(l){function f(ce){return Kd(ce,l)}m0!==null&&Kd(m0,l),v0!==null&&Kd(v0,l),y0!==null&&Kd(y0,l),fg.forEach(f),gg.forEach(f);for(var p=0;p<T0.length;p++){var T=T0[p];T.blockedOn===l&&(T.blockedOn=null)}for(;0<T0.length&&(p=T0[0],p.blockedOn===null);)E7(p),p.blockedOn===null&&T0.shift();if(p=(l.ownerDocument||l).$$reactFormReplay,p!=null)for(T=0;T<p.length;T+=3){var E=p[T],D=p[T+1],U=E[Ot]||null;if(typeof D=="function")U||O7(p);else if(U){var q=null;if(D&&D.hasAttribute("formAction")){if(E=D,U=D[Ot]||null)q=U.formAction;else if(Bm(E)!==null)continue}else q=U.action;typeof q=="function"?p[T+1]=q:(p.splice(T,3),T-=3),O7(p)}}}function Wm(l){this._internalRoot=l}Xd.prototype.render=Wm.prototype.render=function(l){var f=this._internalRoot;if(f===null)throw Error(r(409));var p=f.current,T=Ka();T7(p,T,l,f,null,null)},Xd.prototype.unmount=Wm.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var f=l.containerInfo;T7(l.current,2,null,l,null,null),Ld(),f[Et]=null}};function Xd(l){this._internalRoot=l}Xd.prototype.unstable_scheduleHydration=function(l){if(l){var f=Fi();l={blockedOn:null,target:l,priority:f};for(var p=0;p<T0.length&&f!==0&&f<T0[p].priority;p++);T0.splice(p,0,l),p===0&&E7(l)}};var D7=e.version;if(D7!=="19.1.1")throw Error(r(527,D7,"19.1.1"));ie.findDOMNode=function(l){var f=l._reactInternals;if(f===void 0)throw typeof l.render=="function"?Error(r(188)):(l=Object.keys(l).join(","),Error(r(268,l)));return l=c(f),l=l!==null?u(l):null,l=l===null?null:l.stateNode,l};var TV={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:X,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zd.isDisabled&&Zd.supportsFiber)try{Pe=Zd.inject(TV),Je=Zd}catch{}}return mg.createRoot=function(l,f){if(!i(l))throw Error(r(299));var p=!1,T="",E=W6,D=z6,U=H6,q=null;return f!=null&&(f.unstable_strictMode===!0&&(p=!0),f.identifierPrefix!==void 0&&(T=f.identifierPrefix),f.onUncaughtError!==void 0&&(E=f.onUncaughtError),f.onCaughtError!==void 0&&(D=f.onCaughtError),f.onRecoverableError!==void 0&&(U=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(q=f.unstable_transitionCallbacks)),f=v7(l,1,!1,null,null,p,T,E,D,U,q,null),l[Et]=f.current,Rm(l),new Wm(f)},mg.hydrateRoot=function(l,f,p){if(!i(l))throw Error(r(299));var T=!1,E="",D=W6,U=z6,q=H6,ce=null,Re=null;return p!=null&&(p.unstable_strictMode===!0&&(T=!0),p.identifierPrefix!==void 0&&(E=p.identifierPrefix),p.onUncaughtError!==void 0&&(D=p.onUncaughtError),p.onCaughtError!==void 0&&(U=p.onCaughtError),p.onRecoverableError!==void 0&&(q=p.onRecoverableError),p.unstable_transitionCallbacks!==void 0&&(ce=p.unstable_transitionCallbacks),p.formState!==void 0&&(Re=p.formState)),f=v7(l,1,!0,f,p??null,T,E,D,U,q,ce,Re),f.context=y7(null),p=f.current,T=Ka(),T=ir(T),E=n0(T),E.callback=null,r0(p,E,T),p=T,f.current.lanes=p,rr(f,p),Cs(f),l[Et]=f.current,Rm(l),new Xd(f)},mg.version="19.1.1",mg}var U7;function MV(){if(U7)return jm.exports;U7=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),jm.exports=bV(),jm.exports}var LV=MV();/**
 * react-router v7.8.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var F7="popstate";function VV(t={}){function e(r,i){let{pathname:a,search:o,hash:s}=r.location;return u4("",{pathname:a,search:o,hash:s},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:d1(i)}return AV(e,n,null,t)}function hr(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Is(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function IV(){return Math.random().toString(36).substring(2,10)}function k7(t,e){return{usr:t.state,key:t.key,idx:e}}function u4(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?mf(e):e,state:n,key:e&&e.key||r||IV()}}function d1({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function mf(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function AV(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:a=!1}=r,o=i.history,s="POP",c=null,u=d();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function d(){return(o.state||{idx:null}).idx}function g(){s="POP";let C=d(),S=C==null?null:C-u;u=C,c&&c({action:s,location:v.location,delta:S})}function h(C,S){s="PUSH";let w=u4(v.location,C,S);u=d()+1;let x=k7(w,u),R=v.createHref(w);try{o.pushState(x,"",R)}catch(O){if(O instanceof DOMException&&O.name==="DataCloneError")throw O;i.location.assign(R)}a&&c&&c({action:s,location:v.location,delta:1})}function m(C,S){s="REPLACE";let w=u4(v.location,C,S);u=d();let x=k7(w,u),R=v.createHref(w);o.replaceState(x,"",R),a&&c&&c({action:s,location:v.location,delta:0})}function y(C){return NV(C)}let v={get action(){return s},get location(){return t(i,o)},listen(C){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(F7,g),c=C,()=>{i.removeEventListener(F7,g),c=null}},createHref(C){return e(i,C)},createURL:y,encodeLocation(C){let S=y(C);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:h,replace:m,go(C){return o.go(C)}};return v}function NV(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),hr(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:d1(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function Mw(t,e,n="/"){return PV(t,e,n,!1)}function PV(t,e,n,r){let i=typeof e=="string"?mf(e):e,a=Kc(i.pathname||"/",n);if(a==null)return null;let o=Lw(t);UV(o);let s=null;for(let c=0;s==null&&c<o.length;++c){let u=KV(a);s=jV(o[c],u,r)}return s}function Lw(t,e=[],n=[],r=""){let i=(a,o,s)=>{let c={relativePath:s===void 0?a.path||"":s,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};c.relativePath.startsWith("/")&&(hr(c.relativePath.startsWith(r),`Absolute route path "${c.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(r.length));let u=Fc([r,c.relativePath]),d=n.concat(c);a.children&&a.children.length>0&&(hr(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${u}".`),Lw(a.children,e,d,u)),!(a.path==null&&!a.index)&&e.push({path:u,score:zV(u,a.index),routesMeta:d})};return t.forEach((a,o)=>{if(a.path===""||!a.path?.includes("?"))i(a,o);else for(let s of Vw(a.path))i(a,o,s)}),e}function Vw(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),a=n.replace(/\?$/,"");if(r.length===0)return i?[a,""]:[a];let o=Vw(r.join("/")),s=[];return s.push(...o.map(c=>c===""?a:[a,c].join("/"))),i&&s.push(...o),s.map(c=>t.startsWith("/")&&c===""?"/":c)}function UV(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:HV(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var FV=/^:[\w-]+$/,kV=3,GV=2,BV=1,$V=10,WV=-2,G7=t=>t==="*";function zV(t,e){let n=t.split("/"),r=n.length;return n.some(G7)&&(r+=WV),e&&(r+=GV),n.filter(i=>!G7(i)).reduce((i,a)=>i+(FV.test(a)?kV:a===""?BV:$V),r)}function HV(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function jV(t,e,n=!1){let{routesMeta:r}=t,i={},a="/",o=[];for(let s=0;s<r.length;++s){let c=r[s],u=s===r.length-1,d=a==="/"?e:e.slice(a.length)||"/",g=v2({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},d),h=c.route;if(!g&&u&&n&&!r[r.length-1].route.index&&(g=v2({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},d)),!g)return null;Object.assign(i,g.params),o.push({params:i,pathname:Fc([a,g.pathname]),pathnameBase:QV(Fc([a,g.pathnameBase])),route:h}),g.pathnameBase!=="/"&&(a=Fc([a,g.pathnameBase]))}return o}function v2(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=qV(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),s=i.slice(1);return{params:r.reduce((u,{paramName:d,isOptional:g},h)=>{if(d==="*"){let y=s[h]||"";o=a.slice(0,a.length-y.length).replace(/(.)\/+$/,"$1")}const m=s[h];return g&&!m?u[d]=void 0:u[d]=(m||"").replace(/%2F/g,"/"),u},{}),pathname:a,pathnameBase:o,pattern:t}}function qV(t,e=!1,n=!0){Is(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,s,c)=>(r.push({paramName:s,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function KV(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Is(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Kc(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function YV(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?mf(t):t;return{pathname:n?n.startsWith("/")?n:XV(n,e):e,search:JV(r),hash:eI(i)}}function XV(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Xm(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function ZV(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Iw(t){let e=ZV(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Aw(t,e,n,r=!1){let i;typeof t=="string"?i=mf(t):(i={...t},hr(!i.pathname||!i.pathname.includes("?"),Xm("?","pathname","search",i)),hr(!i.pathname||!i.pathname.includes("#"),Xm("#","pathname","hash",i)),hr(!i.search||!i.search.includes("#"),Xm("#","search","hash",i)));let a=t===""||i.pathname==="",o=a?"/":i.pathname,s;if(o==null)s=n;else{let g=e.length-1;if(!r&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),g-=1;i.pathname=h.join("/")}s=g>=0?e[g]:"/"}let c=YV(i,s),u=o&&o!=="/"&&o.endsWith("/"),d=(a||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(u||d)&&(c.pathname+="/"),c}var Fc=t=>t.join("/").replace(/\/\/+/g,"/"),QV=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),JV=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,eI=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function tI(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var Nw=["POST","PUT","PATCH","DELETE"];new Set(Nw);var nI=["GET",...Nw];new Set(nI);var vf=Ae.createContext(null);vf.displayName="DataRouter";var fp=Ae.createContext(null);fp.displayName="DataRouterState";Ae.createContext(!1);var Pw=Ae.createContext({isTransitioning:!1});Pw.displayName="ViewTransition";var rI=Ae.createContext(new Map);rI.displayName="Fetchers";var iI=Ae.createContext(null);iI.displayName="Await";var Ws=Ae.createContext(null);Ws.displayName="Navigation";var b1=Ae.createContext(null);b1.displayName="Location";var Qc=Ae.createContext({outlet:null,matches:[],isDataRoute:!1});Qc.displayName="Route";var hv=Ae.createContext(null);hv.displayName="RouteError";function aI(t,{relative:e}={}){hr(M1(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=Ae.useContext(Ws),{hash:i,pathname:a,search:o}=L1(t,{relative:e}),s=a;return n!=="/"&&(s=a==="/"?n:Fc([n,a])),r.createHref({pathname:s,search:o,hash:i})}function M1(){return Ae.useContext(b1)!=null}function Yl(){return hr(M1(),"useLocation() may be used only in the context of a <Router> component."),Ae.useContext(b1).location}var Uw="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Fw(t){Ae.useContext(Ws).static||Ae.useLayoutEffect(t)}function oI(){let{isDataRoute:t}=Ae.useContext(Qc);return t?TI():sI()}function sI(){hr(M1(),"useNavigate() may be used only in the context of a <Router> component.");let t=Ae.useContext(vf),{basename:e,navigator:n}=Ae.useContext(Ws),{matches:r}=Ae.useContext(Qc),{pathname:i}=Yl(),a=JSON.stringify(Iw(r)),o=Ae.useRef(!1);return Fw(()=>{o.current=!0}),Ae.useCallback((c,u={})=>{if(Is(o.current,Uw),!o.current)return;if(typeof c=="number"){n.go(c);return}let d=Aw(c,JSON.parse(a),i,u.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Fc([e,d.pathname])),(u.replace?n.replace:n.push)(d,u.state,u)},[e,n,a,i,t])}Ae.createContext(null);function L1(t,{relative:e}={}){let{matches:n}=Ae.useContext(Qc),{pathname:r}=Yl(),i=JSON.stringify(Iw(n));return Ae.useMemo(()=>Aw(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function cI(t,e){return kw(t,e)}function kw(t,e,n,r){hr(M1(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=Ae.useContext(Ws),{matches:a}=Ae.useContext(Qc),o=a[a.length-1],s=o?o.params:{},c=o?o.pathname:"/",u=o?o.pathnameBase:"/",d=o&&o.route;{let S=d&&d.path||"";Gw(c,!d||S.endsWith("*")||S.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${S}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${S}"> to <Route path="${S==="/"?"*":`${S}/*`}">.`)}let g=Yl(),h;if(e){let S=typeof e=="string"?mf(e):e;hr(u==="/"||S.pathname?.startsWith(u),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${S.pathname}" was given in the \`location\` prop.`),h=S}else h=g;let m=h.pathname||"/",y=m;if(u!=="/"){let S=u.replace(/^\//,"").split("/");y="/"+m.replace(/^\//,"").split("/").slice(S.length).join("/")}let v=Mw(t,{pathname:y});Is(d||v!=null,`No routes matched location "${h.pathname}${h.search}${h.hash}" `),Is(v==null||v[v.length-1].route.element!==void 0||v[v.length-1].route.Component!==void 0||v[v.length-1].route.lazy!==void 0,`Matched leaf route at location "${h.pathname}${h.search}${h.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let C=dI(v&&v.map(S=>Object.assign({},S,{params:Object.assign({},s,S.params),pathname:Fc([u,i.encodeLocation?i.encodeLocation(S.pathname).pathname:S.pathname]),pathnameBase:S.pathnameBase==="/"?u:Fc([u,i.encodeLocation?i.encodeLocation(S.pathnameBase).pathname:S.pathnameBase])})),a,n,r);return e&&C?Ae.createElement(b1.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...h},navigationType:"POP"}},C):C}function lI(){let t=yI(),e=tI(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},a={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=Ae.createElement(Ae.Fragment,null,Ae.createElement("p",null,"💿 Hey developer 👋"),Ae.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Ae.createElement("code",{style:a},"ErrorBoundary")," or"," ",Ae.createElement("code",{style:a},"errorElement")," prop on your route.")),Ae.createElement(Ae.Fragment,null,Ae.createElement("h2",null,"Unexpected Application Error!"),Ae.createElement("h3",{style:{fontStyle:"italic"}},e),n?Ae.createElement("pre",{style:i},n):null,o)}var uI=Ae.createElement(lI,null),fI=class extends Ae.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return this.state.error!==void 0?Ae.createElement(Qc.Provider,{value:this.props.routeContext},Ae.createElement(hv.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function gI({routeContext:t,match:e,children:n}){let r=Ae.useContext(vf);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),Ae.createElement(Qc.Provider,{value:t},n)}function dI(t,e=[],n=null,r=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,a=n?.errors;if(a!=null){let c=i.findIndex(u=>u.route.id&&a?.[u.route.id]!==void 0);hr(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),i=i.slice(0,Math.min(i.length,c+1))}let o=!1,s=-1;if(n)for(let c=0;c<i.length;c++){let u=i[c];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(s=c),u.route.id){let{loaderData:d,errors:g}=n,h=u.route.loader&&!d.hasOwnProperty(u.route.id)&&(!g||g[u.route.id]===void 0);if(u.route.lazy||h){o=!0,s>=0?i=i.slice(0,s+1):i=[i[0]];break}}}return i.reduceRight((c,u,d)=>{let g,h=!1,m=null,y=null;n&&(g=a&&u.route.id?a[u.route.id]:void 0,m=u.route.errorElement||uI,o&&(s<0&&d===0?(Gw("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),h=!0,y=null):s===d&&(h=!0,y=u.route.hydrateFallbackElement||null)));let v=e.concat(i.slice(0,d+1)),C=()=>{let S;return g?S=m:h?S=y:u.route.Component?S=Ae.createElement(u.route.Component,null):u.route.element?S=u.route.element:S=c,Ae.createElement(gI,{match:u,routeContext:{outlet:c,matches:v,isDataRoute:n!=null},children:S})};return n&&(u.route.ErrorBoundary||u.route.errorElement||d===0)?Ae.createElement(fI,{location:n.location,revalidation:n.revalidation,component:m,error:g,children:C(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):C()},null)}function pv(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function hI(t){let e=Ae.useContext(vf);return hr(e,pv(t)),e}function pI(t){let e=Ae.useContext(fp);return hr(e,pv(t)),e}function mI(t){let e=Ae.useContext(Qc);return hr(e,pv(t)),e}function mv(t){let e=mI(t),n=e.matches[e.matches.length-1];return hr(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function vI(){return mv("useRouteId")}function yI(){let t=Ae.useContext(hv),e=pI("useRouteError"),n=mv("useRouteError");return t!==void 0?t:e.errors?.[n]}function TI(){let{router:t}=hI("useNavigate"),e=mv("useNavigate"),n=Ae.useRef(!1);return Fw(()=>{n.current=!0}),Ae.useCallback(async(i,a={})=>{Is(n.current,Uw),n.current&&(typeof i=="number"?t.navigate(i):await t.navigate(i,{fromRouteId:e,...a}))},[t,e])}var B7={};function Gw(t,e,n){!e&&!B7[t]&&(B7[t]=!0,Is(!1,n))}Ae.memo(CI);function CI({routes:t,future:e,state:n}){return kw(t,void 0,n,e)}function Bw(t){hr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function SI({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:a=!1}){hr(!M1(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=t.replace(/^\/*/,"/"),s=Ae.useMemo(()=>({basename:o,navigator:i,static:a,future:{}}),[o,i,a]);typeof n=="string"&&(n=mf(n));let{pathname:c="/",search:u="",hash:d="",state:g=null,key:h="default"}=n,m=Ae.useMemo(()=>{let y=Kc(c,o);return y==null?null:{location:{pathname:y,search:u,hash:d,state:g,key:h},navigationType:r}},[o,c,u,d,g,h,r]);return Is(m!=null,`<Router basename="${o}"> is not able to match the URL "${c}${u}${d}" because it does not start with the basename, so the <Router> won't render anything.`),m==null?null:Ae.createElement(Ws.Provider,{value:s},Ae.createElement(b1.Provider,{children:e,value:m}))}function wI({children:t,location:e}){return cI(f4(t),e)}function f4(t,e=[]){let n=[];return Ae.Children.forEach(t,(r,i)=>{if(!Ae.isValidElement(r))return;let a=[...e,i];if(r.type===Ae.Fragment){n.push.apply(n,f4(r.props.children,a));return}hr(r.type===Bw,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),hr(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||a.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=f4(r.props.children,a)),n.push(o)}),n}var Ah="get",Nh="application/x-www-form-urlencoded";function gp(t){return t!=null&&typeof t.tagName=="string"}function xI(t){return gp(t)&&t.tagName.toLowerCase()==="button"}function EI(t){return gp(t)&&t.tagName.toLowerCase()==="form"}function RI(t){return gp(t)&&t.tagName.toLowerCase()==="input"}function OI(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function DI(t,e){return t.button===0&&(!e||e==="_self")&&!OI(t)}var Qd=null;function _I(){if(Qd===null)try{new FormData(document.createElement("form"),0),Qd=!1}catch{Qd=!0}return Qd}var bI=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Zm(t){return t!=null&&!bI.has(t)?(Is(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Nh}"`),null):t}function MI(t,e){let n,r,i,a,o;if(EI(t)){let s=t.getAttribute("action");r=s?Kc(s,e):null,n=t.getAttribute("method")||Ah,i=Zm(t.getAttribute("enctype"))||Nh,a=new FormData(t)}else if(xI(t)||RI(t)&&(t.type==="submit"||t.type==="image")){let s=t.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=t.getAttribute("formaction")||s.getAttribute("action");if(r=c?Kc(c,e):null,n=t.getAttribute("formmethod")||s.getAttribute("method")||Ah,i=Zm(t.getAttribute("formenctype"))||Zm(s.getAttribute("enctype"))||Nh,a=new FormData(s,t),!_I()){let{name:u,type:d,value:g}=t;if(d==="image"){let h=u?`${u}.`:"";a.append(`${h}x`,"0"),a.append(`${h}y`,"0")}else u&&a.append(u,g)}}else{if(gp(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Ah,r=null,i=Nh,o=t}return a&&i==="text/plain"&&(o=a,a=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:a,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function vv(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function LI(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&Kc(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function VI(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function II(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function AI(t,e,n){let r=await Promise.all(t.map(async i=>{let a=e.routes[i.route.id];if(a){let o=await VI(a,n);return o.links?o.links():[]}return[]}));return FI(r.flat(1).filter(II).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function $7(t,e,n,r,i,a){let o=(c,u)=>n[u]?c.route.id!==n[u].route.id:!0,s=(c,u)=>n[u].pathname!==c.pathname||n[u].route.path?.endsWith("*")&&n[u].params["*"]!==c.params["*"];return a==="assets"?e.filter((c,u)=>o(c,u)||s(c,u)):a==="data"?e.filter((c,u)=>{let d=r.routes[c.route.id];if(!d||!d.hasLoader)return!1;if(o(c,u)||s(c,u))return!0;if(c.route.shouldRevalidate){let g=c.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function NI(t,e,{includeHydrateFallback:n}={}){return PI(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let a=[i.module];return i.clientActionModule&&(a=a.concat(i.clientActionModule)),i.clientLoaderModule&&(a=a.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(a=a.concat(i.hydrateFallbackModule)),i.imports&&(a=a.concat(i.imports)),a}).flat(1))}function PI(t){return[...new Set(t)]}function UI(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function FI(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let a=JSON.stringify(UI(i));return n.has(a)||(n.add(a),r.push({key:a,link:i})),r},[])}function $w(){let t=Ae.useContext(vf);return vv(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function kI(){let t=Ae.useContext(fp);return vv(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var yv=Ae.createContext(void 0);yv.displayName="FrameworkContext";function Ww(){let t=Ae.useContext(yv);return vv(t,"You must render this element inside a <HydratedRouter> element"),t}function GI(t,e){let n=Ae.useContext(yv),[r,i]=Ae.useState(!1),[a,o]=Ae.useState(!1),{onFocus:s,onBlur:c,onMouseEnter:u,onMouseLeave:d,onTouchStart:g}=e,h=Ae.useRef(null);Ae.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let v=S=>{S.forEach(w=>{o(w.isIntersecting)})},C=new IntersectionObserver(v,{threshold:.5});return h.current&&C.observe(h.current),()=>{C.disconnect()}}},[t]),Ae.useEffect(()=>{if(r){let v=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(v)}}},[r]);let m=()=>{i(!0)},y=()=>{i(!1),o(!1)};return n?t!=="intent"?[a,h,{}]:[a,h,{onFocus:vg(s,m),onBlur:vg(c,y),onMouseEnter:vg(u,m),onMouseLeave:vg(d,y),onTouchStart:vg(g,m)}]:[!1,h,{}]}function vg(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function BI({page:t,...e}){let{router:n}=$w(),r=Ae.useMemo(()=>Mw(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?Ae.createElement(WI,{page:t,matches:r,...e}):null}function $I(t){let{manifest:e,routeModules:n}=Ww(),[r,i]=Ae.useState([]);return Ae.useEffect(()=>{let a=!1;return AI(t,e,n).then(o=>{a||i(o)}),()=>{a=!0}},[t,e,n]),r}function WI({page:t,matches:e,...n}){let r=Yl(),{manifest:i,routeModules:a}=Ww(),{basename:o}=$w(),{loaderData:s,matches:c}=kI(),u=Ae.useMemo(()=>$7(t,e,c,i,r,"data"),[t,e,c,i,r]),d=Ae.useMemo(()=>$7(t,e,c,i,r,"assets"),[t,e,c,i,r]),g=Ae.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let y=new Set,v=!1;if(e.forEach(S=>{let w=i.routes[S.route.id];!w||!w.hasLoader||(!u.some(x=>x.route.id===S.route.id)&&S.route.id in s&&a[S.route.id]?.shouldRevalidate||w.hasClientLoader?v=!0:y.add(S.route.id))}),y.size===0)return[];let C=LI(t,o,"data");return v&&y.size>0&&C.searchParams.set("_routes",e.filter(S=>y.has(S.route.id)).map(S=>S.route.id).join(",")),[C.pathname+C.search]},[o,s,r,i,u,e,t,a]),h=Ae.useMemo(()=>NI(d,i),[d,i]),m=$I(d);return Ae.createElement(Ae.Fragment,null,g.map(y=>Ae.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...n})),h.map(y=>Ae.createElement("link",{key:y,rel:"modulepreload",href:y,...n})),m.map(({key:y,link:v})=>Ae.createElement("link",{key:y,nonce:n.nonce,...v})))}function zI(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var zw=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{zw&&(window.__reactRouterVersion="7.8.0")}catch{}function HI({basename:t,children:e,window:n}){let r=Ae.useRef();r.current==null&&(r.current=VV({window:n,v5Compat:!0}));let i=r.current,[a,o]=Ae.useState({action:i.action,location:i.location}),s=Ae.useCallback(c=>{Ae.startTransition(()=>o(c))},[o]);return Ae.useLayoutEffect(()=>i.listen(s),[i,s]),Ae.createElement(SI,{basename:t,children:e,location:a.location,navigationType:a.action,navigator:i})}var Hw=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,jw=Ae.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:a,replace:o,state:s,target:c,to:u,preventScrollReset:d,viewTransition:g,...h},m){let{basename:y}=Ae.useContext(Ws),v=typeof u=="string"&&Hw.test(u),C,S=!1;if(typeof u=="string"&&v&&(C=u,zw))try{let j=new URL(window.location.href),F=u.startsWith("//")?new URL(j.protocol+u):new URL(u),$=Kc(F.pathname,y);F.origin===j.origin&&$!=null?u=$+F.search+F.hash:S=!0}catch{Is(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let w=aI(u,{relative:i}),[x,R,O]=GI(r,h),b=YI(u,{replace:o,state:s,target:c,preventScrollReset:d,relative:i,viewTransition:g});function I(j){e&&e(j),j.defaultPrevented||b(j)}let G=Ae.createElement("a",{...h,...O,href:C||w,onClick:S||a?e:I,ref:zI(m,R),target:c,"data-discover":!v&&n==="render"?"true":void 0});return x&&!v?Ae.createElement(Ae.Fragment,null,G,Ae.createElement(BI,{page:w})):G});jw.displayName="Link";var jI=Ae.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:a,to:o,viewTransition:s,children:c,...u},d){let g=L1(o,{relative:u.relative}),h=Yl(),m=Ae.useContext(fp),{navigator:y,basename:v}=Ae.useContext(Ws),C=m!=null&&eA(g)&&s===!0,S=y.encodeLocation?y.encodeLocation(g).pathname:g.pathname,w=h.pathname,x=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;n||(w=w.toLowerCase(),x=x?x.toLowerCase():null,S=S.toLowerCase()),x&&v&&(x=Kc(x,v)||x);const R=S!=="/"&&S.endsWith("/")?S.length-1:S.length;let O=w===S||!i&&w.startsWith(S)&&w.charAt(R)==="/",b=x!=null&&(x===S||!i&&x.startsWith(S)&&x.charAt(S.length)==="/"),I={isActive:O,isPending:b,isTransitioning:C},G=O?e:void 0,j;typeof r=="function"?j=r(I):j=[r,O?"active":null,b?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let F=typeof a=="function"?a(I):a;return Ae.createElement(jw,{...u,"aria-current":G,className:j,ref:d,style:F,to:o,viewTransition:s},typeof c=="function"?c(I):c)});jI.displayName="NavLink";var qI=Ae.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:a,method:o=Ah,action:s,onSubmit:c,relative:u,preventScrollReset:d,viewTransition:g,...h},m)=>{let y=QI(),v=JI(s,{relative:u}),C=o.toLowerCase()==="get"?"get":"post",S=typeof s=="string"&&Hw.test(s),w=x=>{if(c&&c(x),x.defaultPrevented)return;x.preventDefault();let R=x.nativeEvent.submitter,O=R?.getAttribute("formmethod")||o;y(R||x.currentTarget,{fetcherKey:e,method:O,navigate:n,replace:i,state:a,relative:u,preventScrollReset:d,viewTransition:g})};return Ae.createElement("form",{ref:m,method:C,action:v,onSubmit:r?c:w,...h,"data-discover":!S&&t==="render"?"true":void 0})});qI.displayName="Form";function KI(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function qw(t){let e=Ae.useContext(vf);return hr(e,KI(t)),e}function YI(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:a,viewTransition:o}={}){let s=oI(),c=Yl(),u=L1(t,{relative:a});return Ae.useCallback(d=>{if(DI(d,e)){d.preventDefault();let g=n!==void 0?n:d1(c)===d1(u);s(t,{replace:g,state:r,preventScrollReset:i,relative:a,viewTransition:o})}},[c,s,u,n,r,e,t,i,a,o])}var XI=0,ZI=()=>`__${String(++XI)}__`;function QI(){let{router:t}=qw("useSubmit"),{basename:e}=Ae.useContext(Ws),n=vI();return Ae.useCallback(async(r,i={})=>{let{action:a,method:o,encType:s,formData:c,body:u}=MI(r,e);if(i.navigate===!1){let d=i.fetcherKey||ZI();await t.fetch(d,n,i.action||a,{preventScrollReset:i.preventScrollReset,formData:c,body:u,formMethod:i.method||o,formEncType:i.encType||s,flushSync:i.flushSync})}else await t.navigate(i.action||a,{preventScrollReset:i.preventScrollReset,formData:c,body:u,formMethod:i.method||o,formEncType:i.encType||s,replace:i.replace,state:i.state,fromRouteId:n,flushSync:i.flushSync,viewTransition:i.viewTransition})},[t,e,n])}function JI(t,{relative:e}={}){let{basename:n}=Ae.useContext(Ws),r=Ae.useContext(Qc);hr(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),a={...L1(t||".",{relative:e})},o=Yl();if(t==null){a.search=o.search;let s=new URLSearchParams(a.search),c=s.getAll("index");if(c.some(d=>d==="")){s.delete("index"),c.filter(g=>g).forEach(g=>s.append("index",g));let d=s.toString();a.search=d?`?${d}`:""}}return(!t||t===".")&&i.route.index&&(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(a.pathname=a.pathname==="/"?n:Fc([n,a.pathname])),d1(a)}function eA(t,{relative:e}={}){let n=Ae.useContext(Pw);hr(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=qw("useViewTransitionState"),i=L1(t,{relative:e});if(!n.isTransitioning)return!1;let a=Kc(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=Kc(n.nextLocation.pathname,r)||n.nextLocation.pathname;return v2(i.pathname,o)!=null||v2(i.pathname,a)!=null}var We;(function(t){t.ERROR_EVENT="CORNERSTONE_ERROR",t.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",t.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",t.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",t.CAMERA_RESET="CORNERSTONE_CAMERA_RESET",t.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",t.PRESET_MODIFIED="CORNERSTONE_VIEWPORT_RENDERING_PRESET_MODIFIED",t.DISPLAY_AREA_MODIFIED="CORNERSTONE_DISPLAY_AREA_MODIFIED",t.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",t.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",t.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",t.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",t.IMAGE_VOLUME_LOADING_COMPLETED="CORNERSTONE_IMAGE_VOLUME_LOADING_COMPLETED",t.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",t.IMAGE_RETRIEVAL_STAGE="CORNERSTONE_IMAGE_RETRIEVAL_STAGE",t.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",t.VOLUME_VIEWPORT_NEW_VOLUME="CORNERSTONE_VOLUME_VIEWPORT_NEW_VOLUME",t.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",t.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",t.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",t.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",t.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",t.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",t.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",t.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",t.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",t.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",t.VIEWPORT_NEW_IMAGE_SET="CORNERSTONE_VIEWPORT_NEW_IMAGE_SET",t.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL",t.STACK_SCROLL_OUT_OF_BOUNDS="STACK_SCROLL_OUT_OF_BOUNDS",t.GEOMETRY_CACHE_GEOMETRY_ADDED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_ADDED",t.GEOMETRY_CACHE_GEOMETRY_REMOVED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_REMOVED",t.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS="VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS",t.VOLUME_VIEWPORT_SCROLL="VOLUME_VIEWPORT_SCROLL",t.CLIPPING_PLANES_UPDATED="CORNERSTONE_CLIPPING_PLANES_UPDATED",t.WEB_WORKER_PROGRESS="CORNERSTONE_WEB_WORKER_PROGRESS",t.COLORMAP_MODIFIED="CORNERSTONE_COLORMAP_MODIFIED",t.DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED="DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED",t.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED="DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED",t.DYNAMIC_VOLUME_DIMENSION_GROUP_LOADED="DYNAMIC_VOLUME_DIMENSION_GROUP_LOADED",t.DYNAMIC_VOLUME_TIME_POINT_LOADED="DYNAMIC_VOLUME_TIME_POINT_LOADED",t.GEOMETRY_LOADED="GEOMETRY_LOADED",t.GEOMETRY_LOAD_PROGRESS="GEOMETRY_LOAD_PROGRESS",t.GEOMETRY_LOADED_FAILED="GEOMETRY_LOADED_FAILED",t.ACTORS_CHANGED="CORNERSTONE_ACTORS_CHANGED"})(We||(We={}));var Nt;(function(t){t.Interaction="interaction",t.Thumbnail="thumbnail",t.Prefetch="prefetch",t.Compute="compute"})(Nt||(Nt={}));var yn;(function(t){t.STACK="stack",t.ORTHOGRAPHIC="orthographic",t.PERSPECTIVE="perspective",t.VOLUME_3D="volume3d",t.VIDEO="video",t.WHOLE_SLIDE="wholeSlide"})(yn||(yn={}));var Nc;(function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t[t.FAST_LINEAR=2]="FAST_LINEAR"})(Nc||(Nc={}));const Ph={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5,LABELMAP_EDGE_PROJECTION_BLEND:6},tA={OFF:0,NORMALIZED:1,RAW:2};var Kw={BlendMode:Ph,FilterMode:tA};const{BlendMode:yg}=Kw;var F0;(function(t){t[t.COMPOSITE=yg.COMPOSITE_BLEND]="COMPOSITE",t[t.MAXIMUM_INTENSITY_BLEND=yg.MAXIMUM_INTENSITY_BLEND]="MAXIMUM_INTENSITY_BLEND",t[t.MINIMUM_INTENSITY_BLEND=yg.MINIMUM_INTENSITY_BLEND]="MINIMUM_INTENSITY_BLEND",t[t.AVERAGE_INTENSITY_BLEND=yg.AVERAGE_INTENSITY_BLEND]="AVERAGE_INTENSITY_BLEND",t[t.LABELMAP_EDGE_PROJECTION_BLEND=yg.LABELMAP_EDGE_PROJECTION_BLEND]="LABELMAP_EDGE_PROJECTION_BLEND"})(F0||(F0={}));var k0;(function(t){t.AXIAL="axial",t.CORONAL="coronal",t.SAGITTAL="sagittal",t.ACQUISITION="acquisition",t.AXIAL_REFORMAT="axial_reformat",t.CORONAL_REFORMAT="coronal_reformat",t.SAGITTAL_REFORMAT="sagittal_reformat",t.REFORMAT="reformat"})(k0||(k0={}));var y2;(function(t){t.CONTOUR="CONTOUR",t.SURFACE="SURFACE",t.MESH="MESH"})(y2||(y2={}));var g4;(function(t){t.CLOSED_PLANAR="CLOSED_PLANAR",t.OPEN_PLANAR="OPEN_PLANAR"})(g4||(g4={}));const nA=g4;var d4;(function(t){t.PLY="PLY",t.STL="STL",t.OBJ="OBJ",t.VTP="VTP"})(d4||(d4={}));const rA=d4;var Pi;(function(t){t.LINEAR="LINEAR",t.SAMPLED_SIGMOID="SIGMOID",t.LINEAR_EXACT="LINEAR_EXACT"})(Pi||(Pi={}));var h4;(function(t){t.SUM="SUM",t.AVERAGE="AVERAGE",t.SUBTRACT="SUBTRACT"})(h4||(h4={}));const iA=h4;var Rs;(function(t){t.NOT_APPLICABLE="",t.ERMF="ERMF",t.USER="User",t.PROJECTION="Proj",t.REGION="Region",t.ERROR="Error",t.UNCALIBRATED="Uncalibrated",t.CALIBRATED="Calibrated",t.UNKNOWN="Unknown"})(Rs||(Rs={}));var qi;(function(t){t.NO_DATA="noData",t.LOADING="loading",t.PRE_RENDER="preRender",t.RESIZE="resize",t.RENDERED="rendered"})(qi||(qi={}));var no;(function(t){t[t.FAR_REPLICATE=1]="FAR_REPLICATE",t[t.ADJACENT_REPLICATE=3]="ADJACENT_REPLICATE",t[t.SUBRESOLUTION=6]="SUBRESOLUTION",t[t.LOSSY=7]="LOSSY",t[t.FULL_RESOLUTION=8]="FULL_RESOLUTION"})(no||(no={}));var h1;(function(t){t.FRAME="f",t.SECOND="s"})(h1||(h1={}));const aA=Object.freeze(Object.defineProperty({__proto__:null,get SpeedUnit(){return h1}},Symbol.toStringTag,{value:"Module"}));var ga;(function(t){t.CALIBRATION="calibrationModule",t.CINE="cineModule",t.GENERAL_IMAGE="generalImageModule",t.GENERAL_SERIES="generalSeriesModule",t.GENERAL_STUDY="generalStudyModule",t.IMAGE_PIXEL="imagePixelModule",t.IMAGE_PLANE="imagePlaneModule",t.IMAGE_URL="imageUrlModule",t.MODALITY_LUT="modalityLutModule",t.MULTIFRAME="multiframeModule",t.NM_MULTIFRAME_GEOMETRY="nmMultiframeGeometryModule",t.OVERLAY_PLANE="overlayPlaneModule",t.PATIENT="patientModule",t.PATIENT_STUDY="patientStudyModule",t.PET_IMAGE="petImageModule",t.PET_ISOTOPE="petIsotopeModule",t.PET_SERIES="petSeriesModule",t.SOP_COMMON="sopCommonModule",t.ULTRASOUND_ENHANCED_REGION="ultrasoundEnhancedRegionModule",t.VOI_LUT="voiLutModule",t.WADO_WEB_CLIENT="wadoWebClient"})(ga||(ga={}));var p4;(function(t){t.SUM="SUM",t.SUBTRACT="SUBTRACT",t.AVERAGE="AVERAGE"})(p4||(p4={}));var T2;(function(t){t.RLE="RLE",t.Volume="Volume"})(T2||(T2={}));var Ul;(function(t){t.Tiled="tiled",t.ContextPool="contextPool"})(Ul||(Ul={}));const zs=Object.freeze(Object.defineProperty({__proto__:null,BlendModes:F0,CalibrationTypes:Rs,ContourType:nA,DynamicOperatorType:iA,Events:We,get GenerateImageType(){return p4},GeometryType:y2,ImageQualityStatus:no,InterpolationType:Nc,MeshType:rA,MetadataModules:ga,OrientationAxis:k0,RenderingEngineModeEnum:Ul,RequestType:Nt,VOILUTFunctionType:Pi,VideoEnums:aA,ViewportStatus:qi,ViewportType:yn,VoxelManagerEnum:T2},Symbol.toStringTag,{value:"Module"})),m4={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}},fr={MINIMUM_SLAB_THICKNESS:.05,MAXIMUM_RAY_DISTANCE:1e6};Object.freeze(fr);const Lo=.001;function Yw(t){const e=Object.getOwnPropertyNames(t);for(const n of e){const r=t[n];r&&typeof r=="object"&&Yw(r)}return Object.freeze(t)}const oA={axial:{viewPlaneNormal:[0,0,-1],viewUp:[0,-1,0],viewRight:[1,0,0]},sagittal:{viewPlaneNormal:[1,0,0],viewUp:[0,0,1],viewRight:[0,1,0]},coronal:{viewPlaneNormal:[0,-1,0],viewUp:[0,0,1],viewRight:[1,0,0]}},Pc=Yw(oA),Xw=[{name:"CT-AAA",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 143.556 0 166.222 0.686275 214.389 0.696078 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 143.556 0.615686 0.356863 0.184314 166.222 0.882353 0.603922 0.290196 214.389 1 1 1 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-AAA2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"16 -3024 0 129.542 0 145.244 0.166667 157.02 0.5 169.918 0.627451 395.575 0.8125 1578.73 0.8125 3071 0.8125",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"32 -3024 0 0 0 129.542 0.54902 0.25098 0.14902 145.244 0.6 0.627451 0.843137 157.02 0.890196 0.47451 0.6 169.918 0.992157 0.870588 0.392157 395.575 1 0.886275 0.658824 1578.73 1 0.829256 0.957922 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -16.4458 0 641.385 0.715686 3071 0.705882",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -16.4458 0.729412 0.254902 0.301961 641.385 0.905882 0.815686 0.552941 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bones",gradientOpacity:"4 0 1 985.12 1",specularPower:"1",scalarOpacity:"8 -1000 0 152.19 0 278.93 0.190476 952 0.2",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -1000 0.3 0.3 1 -488 0.3 1 0.3 463.28 1 0 0 659.15 1 0.912535 0.0374849 953 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-Cardiac",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 -77.6875 0 94.9518 0.285714 179.052 0.553571 260.439 0.848214 3071 0.875",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 -77.6875 0.54902 0.25098 0.14902 94.9518 0.882353 0.603922 0.290196 179.052 1 0.937033 0.954531 260.439 0.615686 0 0 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 42.8964 0 163.488 0.428571 277.642 0.776786 1587 0.754902 3071 0.754902",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 42.8964 0.54902 0.25098 0.14902 163.488 0.917647 0.639216 0.0588235 277.642 1 0.878431 0.623529 1587 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -3024 0 -86.9767 0 45.3791 0.169643 139.919 0.589286 347.907 0.607143 1224.16 0.607143 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -3024 0 0 0 -86.9767 0 0.25098 1 45.3791 1 0 0 139.919 1 0.894893 0.894893 347.907 1 1 0.25098 1224.16 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Contrast-Enhanced",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 67.0106 0 251.105 0.446429 439.291 0.625 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 67.0106 0.54902 0.25098 0.14902 251.105 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Vessels",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -3024 0 -1278.35 0 22.8277 0.428571 439.291 0.625 3071 0.616071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -3024 0 0 0 -1278.35 0.54902 0.25098 0.14902 22.8277 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 136.47 0 159.215 0.258929 318.43 0.571429 478.693 0.776786 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 136.47 0 0 0 159.215 0.159804 0.159804 0.159804 318.43 0.764706 0.764706 0.764706 478.693 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-2",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 142.677 0 145.016 0.116071 192.174 0.5625 217.24 0.776786 384.347 0.830357 3661 0.830357",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 142.677 0 0 0 145.016 0.615686 0 0.0156863 192.174 0.909804 0.454902 0 217.24 0.972549 0.807843 0.611765 384.347 0.909804 0.909804 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -2048 0 128.643 0 129.982 0.0982143 173.636 0.669643 255.884 0.857143 584.878 0.866071 3661 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -2048 0 0 0 128.643 0 0 0 129.982 0.615686 0 0.0156863 173.636 0.909804 0.454902 0 255.884 0.886275 0.886275 0.886275 584.878 0.968627 0.968627 0.968627 3661 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cropped-Volume-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -451 0 -450 1 1050 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -451 0 0 0 -450 0.0556356 0.0556356 0.0556356 1050 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Fat",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"14 -1000 0 -100 0 -99 0.15 -60 0.15 -59 0 101.2 0 952 0",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"36 -1000 0.3 0.3 1 -497.5 0.3 1 0.3 -99 0 0 1 -76.946 0 1 0 -65.481 0.835431 0.888889 0.0165387 83.89 1 0 0 463.28 1 0 0 659.15 1 0.912535 0.0374849 2952 1 0.300267 0.299886",diffuse:"1",interpolation:"1"},{name:"CT-Liver-Vasculature",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 149.113 0 157.884 0.482143 339.96 0.660714 388.526 0.830357 1197.95 0.839286 3661 0.848214",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 149.113 0 0 0 157.884 0.501961 0.25098 0 339.96 0.695386 0.59603 0.36886 388.526 0.854902 0.85098 0.827451 1197.95 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Lung",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"12 -1000 0 -600 0 -599 0.15 -400 0.15 -399 0 2952 0",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -1000 0.3 0.3 1 -600 0 0 1 -530 0.134704 0.781726 0.0724558 -460 0.929244 1 0.109473 -400 0.888889 0.254949 0.0240258 2952 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -637.62 0 700 1 3071 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -637.62 1 1 1 700 1 1 1 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Muscle",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 -155.407 0 217.641 0.676471 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 -155.407 0.54902 0.25098 0.14902 217.641 0.882353 0.603922 0.290196 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Pulmonary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 -568.625 0 -364.081 0.0714286 -244.813 0.401786 18.2775 0.607143 447.798 0.830357 3592.73 0.839286",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 -568.625 0 0 0 -364.081 0.396078 0.301961 0.180392 -244.813 0.611765 0.352941 0.0705882 18.2775 0.843137 0.0156863 0.156863 447.798 0.752941 0.752941 0.752941 3592.73 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Soft-Tissue",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -167.01 0 -160 1 240 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -167.01 0 0 0 -160 0.0556356 0.0556356 0.0556356 240 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Air",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0.705882 -900.0 0.715686 -500.0 0 3071 0",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 1 1 1 -900.0 0.2 1.0 1.0 -500.0 0.3 0.3 1.0 3071 0 0 0 ",diffuse:"0.9",interpolation:"1"},{name:"MR-Angio",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 151.354 0 158.279 0.4375 190.112 0.580357 200.873 0.732143 3661 0.741071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 151.354 0 0 0 158.279 0.74902 0.376471 0 190.112 1 0.866667 0.733333 200.873 0.937255 0.937255 0.937255 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-Default",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 0 0 20 0 40 0.15 120 0.3 220 0.375 1024 0.5",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 0 0 0 0 20 0.168627 0 0 40 0.403922 0.145098 0.0784314 120 0.780392 0.607843 0.380392 220 0.847059 0.835294 0.788235 1024 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"8 0 0 98.3725 0 416.637 1 2800 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"16 0 1 1 1 98.3725 1 1 1 416.637 1 1 1 2800 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-T2-Brain",gradientOpacity:"4 0 1 160.25 1",specularPower:"40",scalarOpacity:"10 0 0 36.05 0 218.302 0.171429 412.406 1 641 1",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"16 0 0 0 0 98.7223 0.956863 0.839216 0.192157 412.406 0 0.592157 0.807843 641 1 1 1",diffuse:"0.6",interpolation:"1"},{name:"DTI-FA-Brain",gradientOpacity:"4 0 1 0.9950 1",specularPower:"40",scalarOpacity:"16 0 0 0 0 0.3501 0.0158 0.49379 0.7619 0.6419 1 0.9920 1 0.9950 0 0.9950 0",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"28 0 1 0 0 0 1 0 0 0.24974 0.4941 1 0 0.49949 0 0.9882 1 0.7492 0.51764 0 1 0.9950 1 0 0 0.9950 1 0 0",diffuse:"0.9",interpolation:"1"}],sA={slicer3D:[160/255,164/255,217/255]},Tv=Object.freeze(Object.defineProperty({__proto__:null,BACKGROUND_COLORS:sA,CPU_COLORMAPS:m4,EPSILON:Lo,MPR_CAMERA_VALUES:Pc,RENDERING_DEFAULTS:fr,VIEWPORT_PRESETS:Xw},Symbol.toStringTag,{value:"Module"})),Tg={},p1={get:t=>Tg[t],set:t=>{const e=t.id;Tg[e]=t},delete:t=>delete Tg[t],getAll:()=>{const e=Object.keys(Tg).map(n=>Tg[n]);return e.sort((n,r)=>n.id[0]==="_"&&r.id[0]!=="_"?1:n.id[0]!=="_"&&r.id[0]==="_"?-1:0),e}};function Yc(t){return p1.get(t)}function Hs(){return p1.getAll()}const C2=t=>t&&typeof t=="object"&&Object.prototype.toString.call(t)!=="[object RegExp]"&&Object.prototype.toString.call(t)!=="[object Date]",cA=t=>Array.isArray(t)?[]:{},m1=(t,e)=>e&&e.clone===!0&&C2(t)?Ia(cA(t),t,e):t,W7=(t,e,n)=>{const r=t.slice();return e.forEach(function(i,a){typeof r[a]>"u"?r[a]=m1(i,n):C2(i)?r[a]=Ia(t[a],i,n):t.indexOf(i)===-1&&(r[a]=m1(i,n))}),r},lA=(t,e,n)=>{const r={};return C2(t)&&Object.keys(t).forEach(function(i){r[i]=m1(t[i],n)}),Object.keys(e).forEach(function(i){!C2(e[i])||!t[i]?r[i]=m1(e[i],n):r[i]=Ia(t[i],e[i],n)}),r},Ia=(t={},e={},n=void 0)=>{const r=Array.isArray(e),a=(n||{arrayMerge:W7}).arrayMerge||W7;return r?Array.isArray(t)?a(t,e,n):m1(e,n):lA(t,e,n)};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Zw=Symbol("Comlink.proxy"),uA=Symbol("Comlink.endpoint"),Qw=Symbol("Comlink.releaseProxy"),Qm=Symbol("Comlink.finalizer"),Uh=Symbol("Comlink.thrown"),Jw=t=>typeof t=="object"&&t!==null||typeof t=="function",fA={canHandle:t=>Jw(t)&&t[Zw],serialize(t){const{port1:e,port2:n}=new MessageChannel;return Cv(t,e),[n,[n]]},deserialize(t){return t.start(),v4(t)}},gA={canHandle:t=>Jw(t)&&Uh in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},ex=new Map([["proxy",fA],["throw",gA]]);function dA(t,e){for(const n of t)if(e===n||n==="*"||n instanceof RegExp&&n.test(e))return!0;return!1}function Cv(t,e=globalThis,n=["*"]){e.addEventListener("message",function r(i){if(!i||!i.data)return;if(!dA(n,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:a,type:o,path:s}=Object.assign({path:[]},i.data),c=(i.data.argumentList||[]).map(xl);let u;try{const d=s.slice(0,-1).reduce((h,m)=>h[m],t),g=s.reduce((h,m)=>h[m],t);switch(o){case"GET":u=g;break;case"SET":d[s.slice(-1)[0]]=xl(i.data.value),u=!0;break;case"APPLY":u=g.apply(d,c);break;case"CONSTRUCT":{const h=new g(...c);u=ix(h)}break;case"ENDPOINT":{const{port1:h,port2:m}=new MessageChannel;Cv(t,m),u=yA(h,[h])}break;case"RELEASE":u=void 0;break;default:return}}catch(d){u={value:d,[Uh]:0}}Promise.resolve(u).catch(d=>({value:d,[Uh]:0})).then(d=>{const[g,h]=x2(d);e.postMessage(Object.assign(Object.assign({},g),{id:a}),h),o==="RELEASE"&&(e.removeEventListener("message",r),tx(e),Qm in t&&typeof t[Qm]=="function"&&t[Qm]())}).catch(d=>{const[g,h]=x2({value:new TypeError("Unserializable return value"),[Uh]:0});e.postMessage(Object.assign(Object.assign({},g),{id:a}),h)})}),e.start&&e.start()}function hA(t){return t.constructor.name==="MessagePort"}function tx(t){hA(t)&&t.close()}function v4(t,e){const n=new Map;return t.addEventListener("message",function(i){const{data:a}=i;if(!a||!a.id)return;const o=n.get(a.id);if(o)try{o(a)}finally{n.delete(a.id)}}),y4(t,n,[],e)}function Jd(t){if(t)throw new Error("Proxy has been released and is not useable")}function nx(t){return Fu(t,new Map,{type:"RELEASE"}).then(()=>{tx(t)})}const S2=new WeakMap,w2="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(S2.get(t)||0)-1;S2.set(t,e),e===0&&nx(t)});function pA(t,e){const n=(S2.get(e)||0)+1;S2.set(e,n),w2&&w2.register(t,e,t)}function mA(t){w2&&w2.unregister(t)}function y4(t,e,n=[],r=function(){}){let i=!1;const a=new Proxy(r,{get(o,s){if(Jd(i),s===Qw)return()=>{mA(a),nx(t),e.clear(),i=!0};if(s==="then"){if(n.length===0)return{then:()=>a};const c=Fu(t,e,{type:"GET",path:n.map(u=>u.toString())}).then(xl);return c.then.bind(c)}return y4(t,e,[...n,s])},set(o,s,c){Jd(i);const[u,d]=x2(c);return Fu(t,e,{type:"SET",path:[...n,s].map(g=>g.toString()),value:u},d).then(xl)},apply(o,s,c){Jd(i);const u=n[n.length-1];if(u===uA)return Fu(t,e,{type:"ENDPOINT"}).then(xl);if(u==="bind")return y4(t,e,n.slice(0,-1));const[d,g]=z7(c);return Fu(t,e,{type:"APPLY",path:n.map(h=>h.toString()),argumentList:d},g).then(xl)},construct(o,s){Jd(i);const[c,u]=z7(s);return Fu(t,e,{type:"CONSTRUCT",path:n.map(d=>d.toString()),argumentList:c},u).then(xl)}});return pA(a,t),a}function vA(t){return Array.prototype.concat.apply([],t)}function z7(t){const e=t.map(x2);return[e.map(n=>n[0]),vA(e.map(n=>n[1]))]}const rx=new WeakMap;function yA(t,e){return rx.set(t,e),t}function ix(t){return Object.assign(t,{[Zw]:!0})}function x2(t){for(const[e,n]of ex)if(n.canHandle(t)){const[r,i]=n.serialize(t);return[{type:"HANDLER",name:e,value:r},i]}return[{type:"RAW",value:t},rx.get(t)||[]]}function xl(t){switch(t.type){case"HANDLER":return ex.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Fu(t,e,n,r){return new Promise(i=>{const a=TA();e.set(a,i),t.start&&t.start(),t.postMessage(Object.assign({id:a},n),r)})}function TA(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Ui(){return typeof crypto.randomUUID=="function"?crypto.randomUUID():("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}class Sv{constructor(e){this.numRequests={[Nt.Interaction]:0,[Nt.Thumbnail]:0,[Nt.Prefetch]:0,[Nt.Compute]:0},this.id=e||Ui(),this.requestPool={[Nt.Interaction]:{0:[]},[Nt.Thumbnail]:{0:[]},[Nt.Prefetch]:{0:[]},[Nt.Compute]:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={[Nt.Interaction]:0,[Nt.Thumbnail]:0,[Nt.Prefetch]:0,[Nt.Compute]:0},this.maxNumRequests={[Nt.Interaction]:6,[Nt.Thumbnail]:6,[Nt.Prefetch]:5,[Nt.Compute]:1e3}}setMaxSimultaneousRequests(e,n){this.maxNumRequests[e]=n}getMaxSimultaneousRequests(e){return this.maxNumRequests[e]}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,n,r,i=0){const a={requestFn:e,type:n,additionalDetails:r};this.requestPool[n][i]===void 0&&(this.requestPool[n][i]=[]),this.requestPool[n][i].push(a),this.startGrabbing()}filterRequests(e){Object.keys(this.requestPool).forEach(n=>{const r=this.requestPool[n];Object.keys(r).forEach(i=>{r[i]=r[i].filter(a=>e(a))})})}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const n=this.maxNumRequests[e]-this.numRequests[e];let r=0;for(let i=0;i<n;i++){const a=this.getNextRequest(e);if(a===null)return!1;if(a){this.numRequests[e]++,this.awake=!0;let o;try{o=a.requestFn()}catch(s){console.warn("sendRequest failed",s)}o?.finally?o.finally(()=>{this.numRequests[e]--,this.startAgain()}):(this.numRequests[e]--,r++)}}return r&&this.startAgain(),!0}getNextRequest(e){const n=this.getSortedPriorityGroups(e);for(const r of n)if(this.requestPool[e][r].length)return this.requestPool[e][r].shift();return null}startGrabbing(){const e=this.sendRequests(Nt.Interaction),n=this.sendRequests(Nt.Thumbnail),r=this.sendRequests(Nt.Prefetch),i=this.sendRequests(Nt.Compute);!e&&!n&&!r&&!i&&(this.awake=!1)}startAgain(){this.awake&&(this.grabDelay!==void 0?this.timeoutHandle||(this.timeoutHandle=window.setTimeout(()=>{this.timeoutHandle=null,this.startGrabbing()},this.grabDelay)):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter(r=>this.requestPool[e][r].length).sort((r,i)=>r-i)}getRequestPool(){return this.requestPool}}class ax{constructor(){this.workerRegistry={},this.workerPoolManager=new Sv("webworker")}registerWorker(e,n,r={}){const{maxWorkerInstances:i=1,overwrite:a=!1,autoTerminateOnIdle:o={enabled:!1,idleTimeThreshold:3e3}}=r;if(this.workerRegistry[e]&&!a){console.warn(`Worker type '${e}' is already registered...`);return}a&&this.workerRegistry[e]?.idleCheckIntervalId&&clearInterval(this.workerRegistry[e].idleCheckIntervalId);const s={workerFn:null,instances:[],loadCounters:[],lastActiveTime:[],nativeWorkers:[],autoTerminateOnIdle:o.enabled,idleCheckIntervalId:null,idleTimeThreshold:o.idleTimeThreshold};s.loadCounters=Array(i).fill(0),s.lastActiveTime=Array(i).fill(null);for(let c=0;c<i;c++){const u=n();s.instances.push(v4(u)),s.nativeWorkers.push(u),s.workerFn=n}this.workerRegistry[e]=s}getNextWorkerAPI(e){const n=this.workerRegistry[e];if(!n)return console.error(`Worker type '${e}' is not registered.`),null;const r=n.instances.filter(o=>o!==null);let i=0,a=n.loadCounters[0]||0;for(let o=1;o<r.length;o++){const s=n.loadCounters[o]||0;s<a&&(i=o,a=s)}if(n.instances[i]===null){const o=n.workerFn();n.instances[i]=v4(o),n.nativeWorkers[i]=o}return n.loadCounters[i]+=1,{api:n.instances[i],index:i}}executeTask(e,n,r={},{requestType:i=Nt.Compute,priority:a=0,options:o={},callbacks:s=[]}={}){return new Promise((c,u)=>{const d=async()=>{const{api:g,index:h}=this.getNextWorkerAPI(e);if(!g){const m=new Error(`No available worker instance for '${e}'`);console.error(m),u(m);return}try{let m=[];s.length&&(m=s.map(C=>ix(C)));const y=this.workerRegistry[e];y.processing=!0;const v=await g[n](r,...m);y.processing=!1,y.lastActiveTime[h]=Date.now(),y.autoTerminateOnIdle&&!y.idleCheckIntervalId&&y.idleTimeThreshold&&(y.idleCheckIntervalId=setInterval(()=>{this.terminateIdleWorkers(e,y.idleTimeThreshold)},y.idleTimeThreshold)),c(v)}catch(m){console.error(`Error executing method '${n}' on worker '${e}':`,m),u(m)}finally{this.workerRegistry[e].loadCounters[h]--}};this.workerPoolManager.addRequest(d,i,o,a)})}terminateIdleWorkers(e,n){const r=this.workerRegistry[e];if(r.processing)return;const i=Date.now();r.instances.forEach((a,o)=>{const s=r.lastActiveTime[o],c=s!==null&&r.loadCounters[o]>0,u=i-s;!c&&u>n&&this.terminateWorkerInstance(e,o)})}terminate(e){const n=this.workerRegistry[e];if(!n){console.error(`Worker type '${e}' is not registered.`);return}n.instances.forEach((r,i)=>{this.terminateWorkerInstance(e,i)})}terminateWorkerInstance(e,n){const r=this.workerRegistry[e],i=r.instances[n];i!==null&&(i[Qw](),r.nativeWorkers[n].terminate(),r.instances[n]=null,r.lastActiveTime[n]=null)}}const Jm=4,CA=5,SA=1,H7=[1,1];function j7({ext:t,filterType:e,texData:n,internalFormat:r,glDataType:i}){try{const a=document.createElement("canvas");a.width=Jm,a.height=Jm;const o=a.getContext("webgl2");if(!o)return!1;const s=`#version 300 es
    void main() {
      gl_PointSize = ${Jm.toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,c=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `;let u;if(t&&(u=o.getExtension(t),!u))return!1;const d=o.createShader(o.VERTEX_SHADER);if(o.shaderSource(d,s),o.compileShader(d),!o.getShaderParameter(d,o.COMPILE_STATUS))return!1;const g=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(g,c),o.compileShader(g),!o.getShaderParameter(g,o.COMPILE_STATUS))return!1;const h=o.createProgram();if(o.attachShader(h,d),o.attachShader(h,g),o.linkProgram(h),!o.getProgramParameter(h,o.LINK_STATUS))return!1;const m=o.createTexture();o.bindTexture(o.TEXTURE_2D,m),o.texImage2D(o.TEXTURE_2D,0,r(o,u),CA,SA,0,o.RED,i(o,u),n);const y=e==="LINEAR"?o.LINEAR:o.NEAREST;o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,y),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,y),o.useProgram(h),o.drawArrays(o.POINTS,0,1);const v=new Uint8Array(4);o.readPixels(H7[0],H7[1],1,1,o.RGBA,o.UNSIGNED_BYTE,v);const[C,S,w]=v,x=o.getExtension("WEBGL_lose_context");return x&&x.loseContext(),C===S&&S===w&&C!==0}catch{return!1}}function wA(){const t=new Int16Array([32767,2e3,3e3,4e3,5e3,16784,7e3,8e3,9e3,32767]);return{norm16:j7({ext:"EXT_texture_norm16",filterType:"NEAREST",texData:t,internalFormat:(e,n)=>n.R16_SNORM_EXT,glDataType:e=>e.SHORT}),norm16Linear:j7({ext:"EXT_texture_norm16",filterType:"LINEAR",texData:t,internalFormat:(e,n)=>n.R16_SNORM_EXT,glDataType:e=>e.SHORT})}}let Ig=!1;const T4={gpuTier:{tier:2},isMobile:!1,rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,strictZSpacingForVolumeViewport:!0,renderingEngineMode:Ul.ContextPool,webGlContextCount:7},debug:{statsOverlay:!1},peerImport:t=>null};let _c={...T4,rendering:{...T4.rendering}},Kg=null,ox=!1;function xA(){const t=document.createElement("canvas");return t.getContext("webgl2")||t.getContext("webgl")||t.getContext("experimental-webgl")}function EA(){const t=xA();return t instanceof WebGLRenderingContext||t instanceof WebGL2RenderingContext}function RA(){const t=wA();return t.norm16&&t.norm16Linear}function sx(){return/iPad|iPhone|iPod/.test(navigator.platform)?!0:navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel")}function OA(t=_c){return Ig||(ox=RA(),_c=Ia(T4,t),_c.isMobile&&(_c.rendering.webGlContextCount=1),sx()&&(t.rendering?.preferSizeOverAccuracy?_c.rendering.preferSizeOverAccuracy=!0:console.log("norm16 texture not supported, you can turn on the preferSizeOverAccuracy flag to use native data type, but be aware of the inaccuracy of the rendering in high bits")),EA()?console.log("CornerstoneRender: using GPU rendering"):(console.log("CornerstoneRender: GPU not detected, using CPU rendering"),_c.rendering.useCPURendering=!0),Ig=!0,Kg||(Kg=new ax),Ig)}function DA(){return ox}function wv(){return!sx()}function Yg(){return _c.rendering.useCPURendering}function _A(){return Ig}function Xl(){return _c}function cx(){return Kg||(Kg=new ax),Kg}async function bA(t){return _c.peerImport(t)}class MA{constructor(){this.listeners={},this.debouncedListeners={}}reset(){this.listeners={},this.debouncedListeners={}}addEventListenerOnce(e,n){const r=i=>{this.removeEventListener(e,r),n.call(this,i)};this.addEventListener(e,r)}addEventListener(e,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].indexOf(n)===-1&&this.listeners[e].push(n)}addEventListenerDebounced(e,n,r){this.debouncedListeners[e]=this.debouncedListeners[e]||{};const i=this.debouncedListeners[e];if(!i[n]){const a=o=>{i[n]&&clearTimeout(i[n].timeoutId),i[n].timeoutId=setTimeout(()=>{n.call(this,o)},r)};i[n]={original:n,handle:a,timeoutId:null},this.addEventListener(e,a)}}removeEventListenerDebounced(e,n){if(this.debouncedListeners[e]?.[n]){const r=this.debouncedListeners[e][n];this.removeEventListener(e,r.handle),clearTimeout(r.timeoutId),delete this.debouncedListeners[e][n]}}removeEventListener(e,n){if(!this.listeners[e])return;const r=this.listeners[e],i=r.length;for(let a=0;a<i;a++)if(r[a]===n){r.splice(a,1);return}}dispatchEvent(e){if(!this.listeners[e.type])return!e.defaultPrevented;const n=this.listeners[e.type].slice(),r=n.length;for(let i=0;i<r;i++)try{n[i].call(this,e)}catch(a){console.error(`error in event listener of type:  ${e.type}`,a)}return!e.defaultPrevented}}const Ye=new MA;function je(t=Ye,e,n=null){if(!e)throw new Error("Event type was not defined");const r=new CustomEvent(e,{detail:n,cancelable:!0});return t?.dispatchEvent(r)}var e3,q7;function LA(){return q7||(q7=1,e3=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(e)){if(r=e.length,r!=n.length)return!1;for(i=r;i--!==0;)if(!t(e[i],n[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(a=Object.keys(e),r=a.length,r!==Object.keys(n).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;i--!==0;){var o=a[i];if(!t(e[o],n[o]))return!1}return!0}return e!==e&&n!==n}),e3}var VA=LA();const xv=$s(VA);var t3,K7;function lx(){if(K7)return t3;K7=1;var t=Object.prototype.toString;return t3=function(n){var r=t.call(n),i=r==="[object Arguments]";return i||(i=r!=="[object Array]"&&n!==null&&typeof n=="object"&&typeof n.length=="number"&&n.length>=0&&t.call(n.callee)==="[object Function]"),i},t3}var n3,Y7;function IA(){if(Y7)return n3;Y7=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=lx(),i=Object.prototype.propertyIsEnumerable,a=!i.call({toString:null},"toString"),o=i.call(function(){},"prototype"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(h){var m=h.constructor;return m&&m.prototype===h},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},d=function(){if(typeof window>"u")return!1;for(var h in window)try{if(!u["$"+h]&&e.call(window,h)&&window[h]!==null&&typeof window[h]=="object")try{c(window[h])}catch{return!0}}catch{return!0}return!1}(),g=function(h){if(typeof window>"u"||!d)return c(h);try{return c(h)}catch{return!1}};t=function(m){var y=m!==null&&typeof m=="object",v=n.call(m)==="[object Function]",C=r(m),S=y&&n.call(m)==="[object String]",w=[];if(!y&&!v&&!C)throw new TypeError("Object.keys called on a non-object");var x=o&&v;if(S&&m.length>0&&!e.call(m,0))for(var R=0;R<m.length;++R)w.push(String(R));if(C&&m.length>0)for(var O=0;O<m.length;++O)w.push(String(O));else for(var b in m)!(x&&b==="prototype")&&e.call(m,b)&&w.push(String(b));if(a)for(var I=g(m),G=0;G<s.length;++G)!(I&&s[G]==="constructor")&&e.call(m,s[G])&&w.push(s[G]);return w}}return n3=t,n3}var r3,X7;function AA(){if(X7)return r3;X7=1;var t=Array.prototype.slice,e=lx(),n=Object.keys,r=n?function(o){return n(o)}:IA(),i=Object.keys;return r.shim=function(){if(Object.keys){var o=function(){var s=Object.keys(arguments);return s&&s.length===arguments.length}(1,2);o||(Object.keys=function(c){return e(c)?i(t.call(c)):i(c)})}else Object.keys=r;return Object.keys||r},r3=r,r3}var i3,Z7;function ux(){if(Z7)return i3;Z7=1;var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return i3=t,i3}var a3,Q7;function NA(){return Q7||(Q7=1,a3=SyntaxError),a3}var o3,J7;function PA(){return J7||(J7=1,o3=TypeError),o3}var s3,eT;function UA(){return eT||(eT=1,s3=Object.getOwnPropertyDescriptor),s3}var c3,tT;function FA(){if(tT)return c3;tT=1;var t=UA();if(t)try{t([],"length")}catch{t=null}return c3=t,c3}var l3,nT;function kA(){if(nT)return l3;nT=1;var t=ux(),e=NA(),n=PA(),r=FA();return l3=function(a,o,s){if(!a||typeof a!="object"&&typeof a!="function")throw new n("`obj` must be an object or a function`");if(typeof o!="string"&&typeof o!="symbol")throw new n("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new n("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new n("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new n("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new n("`loose`, if provided, must be a boolean");var c=arguments.length>3?arguments[3]:null,u=arguments.length>4?arguments[4]:null,d=arguments.length>5?arguments[5]:null,g=arguments.length>6?arguments[6]:!1,h=!!r&&r(a,o);if(t)t(a,o,{configurable:d===null&&h?h.configurable:!d,enumerable:c===null&&h?h.enumerable:!c,value:s,writable:u===null&&h?h.writable:!u});else if(g||!c&&!u&&!d)a[o]=s;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},l3}var u3,rT;function GA(){if(rT)return u3;rT=1;var t=ux(),e=function(){return!!t};return e.hasArrayLengthDefineBug=function(){if(!t)return null;try{return t([],"length",{value:1}).length!==1}catch{return!0}},u3=e,u3}var f3,iT;function fx(){if(iT)return f3;iT=1;var t=AA(),e=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",n=Object.prototype.toString,r=Array.prototype.concat,i=kA(),a=function(u){return typeof u=="function"&&n.call(u)==="[object Function]"},o=GA()(),s=function(u,d,g,h){if(d in u){if(h===!0){if(u[d]===g)return}else if(!a(h)||!h())return}o?i(u,d,g,!0):i(u,d,g)},c=function(u,d){var g=arguments.length>2?arguments[2]:{},h=t(d);e&&(h=r.call(h,Object.getOwnPropertySymbols(d)));for(var m=0;m<h.length;m+=1)s(u,h[m],d[h[m]],g[h[m]])};return c.supportsDescriptors=!!o,f3=c,f3}var Cg={exports:{}},aT;function gx(){return aT||(aT=1,typeof self<"u"?Cg.exports=self:typeof window<"u"?Cg.exports=window:Cg.exports=Function("return this")()),Cg.exports}var g3,oT;function dx(){if(oT)return g3;oT=1;var t=gx();return g3=function(){return typeof Lc!="object"||!Lc||Lc.Math!==Math||Lc.Array!==Array?t:Lc},g3}var d3,sT;function BA(){if(sT)return d3;sT=1;var t=fx(),e=dx();return d3=function(){var r=e();if(t.supportsDescriptors){var i=Object.getOwnPropertyDescriptor(r,"globalThis");(!i||i.configurable&&(i.enumerable||!i.writable||globalThis!==r))&&Object.defineProperty(r,"globalThis",{configurable:!0,enumerable:!1,value:r,writable:!0})}else(typeof globalThis!="object"||globalThis!==r)&&(r.globalThis=r);return r},d3}var h3,cT;function $A(){if(cT)return h3;cT=1;var t=fx(),e=gx(),n=dx(),r=BA(),i=n(),a=function(){return i};return t(a,{getPolyfill:n,implementation:e,shim:r}),h3=a,h3}var WA=$A();const zA=$s(WA),Qo=zA(),hx={vtkObject:()=>null};function ts(t){if(t==null||t.isA)return t;if(!t.vtkClass)return Qo.console&&Qo.console.error&&Qo.console.error("Invalid VTK object"),null;const e=hx[t.vtkClass];if(!e)return Qo.console&&Qo.console.error&&Qo.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;const n={...t};Object.keys(n).forEach(i=>{n[i]&&typeof n[i]=="object"&&n[i].vtkClass&&(n[i]=ts(n[i]))});const r=e(n);return r&&r.modified&&r.modified(),r}function HA(t,e){hx[t]=e}ts.register=HA;class p3 extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}let C4=0;const px=Symbol("void");function jA(){return C4}const mx={};function El(){}const qA=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];qA.forEach(t=>{mx[t]=El});Qo.console=console.hasOwnProperty("log")?console:mx;const $0={debug:El,error:Qo.console.error||El,info:Qo.console.info||El,log:Qo.console.log||El,warn:Qo.console.warn||El};function vx(t,e){$0[t]&&($0[t]=e||El)}function yx(){$0.log(...arguments)}function Tx(){$0.info(...arguments)}function E2(){$0.debug(...arguments)}function Wt(){$0.error(...arguments)}function dp(){$0.warn(...arguments)}const lT={};function Cx(t){lT[t]||($0.error(t),lT[t]=!0)}const Yi=Object.create(null);Yi.Float32Array=Float32Array;Yi.Float64Array=Float64Array;Yi.Uint8Array=Uint8Array;Yi.Int8Array=Int8Array;Yi.Uint16Array=Uint16Array;Yi.Int16Array=Int16Array;Yi.Uint32Array=Uint32Array;Yi.Int32Array=Int32Array;Yi.Uint8ClampedArray=Uint8ClampedArray;try{Yi.BigInt64Array=BigInt64Array,Yi.BigUint64Array=BigUint64Array}catch{}function yf(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return new(Yi[t]||Float64Array)(...n)}function hp(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return(Yi[t]||Float64Array).from(...n)}function pp(t){return t.charAt(0).toUpperCase()+t.slice(1)}function br(t){return pp(t[0]==="_"?t.slice(1):t)}function Sx(t){return t.charAt(0).toLowerCase()+t.slice(1)}function wx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;const r=["TB","GB","MB","KB"];let i=Number(t),a="B";for(;i>n;)i/=n,a=r.pop();return`${i.toFixed(e)} ${a}`}function xx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ";const n=[];let r=t;for(;r>1e3;)n.push(`000${r%1e3}`.slice(-3)),r=Math.floor(r/1e3);return r>0&&n.push(r),n.reverse(),n.join(e)}function Ex(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function KA(t){return Object.values(Yi).some(e=>t instanceof e)}function YA(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return!1}function XA(t,e){return Object.keys(t).find(n=>t[n]===e)}function Rx(t){return t&&t.isA?t.getState():t}function Ev(t){setTimeout(t,0)}function Ox(t,e){const n=performance.now();t.finally(()=>{const r=performance.now()-n;e(r)})}function Yn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ex(e);const n=[];if(Number.isInteger(e.mtime)||(e.mtime=++C4),!("classHierarchy"in e))e.classHierarchy=new p3("vtkObject");else if(!(e.classHierarchy instanceof p3)){const a=new p3;for(let o=0;o<e.classHierarchy.length;o++)a.push(e.classHierarchy[o]);e.classHierarchy=a}function r(a){n[a]=null}function i(a){function o(){r(a)}return Object.freeze({unsubscribe:o})}return t.isDeleted=()=>!!e.deleted,t.modified=a=>{if(e.deleted){Wt("instance deleted - cannot call any method");return}a&&a<t.getMTime()||(e.mtime=++C4,n.forEach(o=>o&&o(t)))},t.onModified=a=>{if(e.deleted)return Wt("instance deleted - cannot call any method"),null;const o=n.length;return n.push(a),i(o)},t.getMTime=()=>e.mtime,t.isA=a=>{let o=e.classHierarchy.length;for(;o--;)if(e.classHierarchy[o]===a)return!0;return!1},t.getClassName=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-a]},t.set=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(a).forEach(u=>{const d=s?null:t[`set${pp(u)}`];d&&Array.isArray(a[u])&&d.length>1?c=d(...a[u])||c:d?c=d(a[u])||c:(["mtime"].indexOf(u)===-1&&!o&&dp(`Warning: Set value to model directly ${u}, ${a[u]}`),c=e[u]!==a[u]||c,e[u]=a[u])}),c},t.get=function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];if(!o.length)return e;const c={};return o.forEach(u=>{c[u]=e[u]}),c},t.getReferenceByName=a=>e[a],t.delete=()=>{Object.keys(e).forEach(a=>delete e[a]),n.forEach((a,o)=>r(o)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;const a={...e,vtkClass:t.getClassName()};Object.keys(a).forEach(s=>{a[s]===null||a[s]===void 0||s[0]==="_"?delete a[s]:a[s].isA?a[s]=a[s].getState():Array.isArray(a[s])?a[s]=a[s].map(Rx):KA(a[s])&&(a[s]=Array.from(a[s]))});const o={};return Object.keys(a).sort().forEach(s=>{o[s]=a[s]}),o.mtime&&delete o.mtime,o},t.shallowCopy=function(a){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(a.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${a.getClassName()} into ${t.getClassName()}`);const s=a.get(),c=Object.keys(e).sort();Object.keys(s).sort().forEach(d=>{const g=c.indexOf(d);g===-1?o&&E2(`add ${d} in shallowCopy`):c.splice(g,1),e[d]=s[d]}),c.length&&o&&E2(`Untouched keys: ${c.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}const ZA={object(t,e,n){return function(){return{...e[n.name]}}}};function ha(t,e,n){n.forEach(r=>{if(typeof r=="object"){const i=ZA[r.type];i?t[`get${br(r.name)}`]=i(t,e,r):t[`get${br(r.name)}`]=()=>e[r.name]}else t[`get${br(r)}`]=()=>e[r]})}const Dx={enum(t,e,n){const r=`_on${br(n.name)}Changed`;return i=>{if(typeof i=="string"){if(n.enum[i]!==void 0)return e[n.name]!==n.enum[i]?(e[n.name]=n.enum[i],t.modified(),!0):!1;throw Wt(`Set Enum with invalid argument ${n}, ${i}`),new RangeError("Set Enum with invalid string argument")}if(typeof i=="number"){if(e[n.name]!==i){if(Object.keys(n.enum).map(a=>n.enum[a]).indexOf(i)!==-1){const a=e[n.name];return e[n.name]=i,e[r]?.(t,e,i,a),t.modified(),!0}throw Wt(`Set Enum outside numeric range ${n}, ${i}`),new RangeError("Set Enum outside numeric range")}return!1}throw Wt(`Set Enum with invalid argument (String/Number) ${n}, ${i}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,n){n.params?.length===1&&dp('Setter of type "object" with a single "param" field is not supported');const r=`_on${br(n.name)}Changed`;return function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];let s;if(a.length>1&&n.params?.length?s=n.params.reduce((c,u,d)=>Object.assign(c,{[u]:a[d]}),{}):s=a[0],!xv(e[n.name],s)){const c=e[n.name];return e[n.name]=s,e[r]?.(t,e,s,c),t.modified(),!0}return!1}}};function uT(t){if(typeof t=="object"){const e=Dx[t.type];if(e)return(n,r)=>e(n,r,t);throw Wt(`No setter for field ${t}`),new TypeError("No setter for field")}return function(n,r){const i=`_on${br(t)}Changed`;return function(o){if(r.deleted)return Wt("instance deleted - cannot call any method"),!1;if(r[t]!==o){const s=r[t.name];return r[t]=o,r[i]?.(n,r,o,s),n.modified(),!0}return!1}}}function V1(t,e,n){n.forEach(r=>{typeof r=="object"?t[`set${br(r.name)}`]=uT(r)(t,e):t[`set${br(r)}`]=uT(r)(t,e)})}function ri(t,e,n){ha(t,e,n),V1(t,e,n)}function Tf(t,e,n){n.forEach(r=>{t[`get${br(r)}`]=()=>e[r]?Array.from(e[r]):e[r],t[`get${br(r)}ByReference`]=()=>e[r]})}function Rv(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;n.forEach(a=>{if(e[a]&&r&&e[a].length!==r)throw new RangeError(`Invalid initial number of values for array (${a})`);const o=`_on${br(a)}Changed`;t[`set${br(a)}`]=function(){if(e.deleted)return Wt("instance deleted - cannot call any method"),!1;for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];let d=c,g,h=!1;if(d.length===1&&(d[0]==null||d[0].length>=0)&&(d=d[0],h=!0),d==null)g=e[a]!==d;else{if(r&&d.length!==r)if(d.length<r&&i!==void 0)for(d=Array.from(d),h=!1;d.length<r;)d.push(i);else throw new RangeError(`Invalid number of values for array setter (${a})`);g=e[a]==null||e[a].length!==d.length;for(let m=0;!g&&m<d.length;++m)g=e[a][m]!==d[m];g&&h&&(d=Array.from(d))}if(g){const m=e[a.name];e[a]=d,e[o]?.(t,e,d,m),t.modified()}return g},t[`set${br(a)}From`]=s=>{const c=e[a];s.forEach((u,d)=>{c[d]=u})}})}function Ov(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;Tf(t,e,n),Rv(t,e,n,r,i)}function I1(t,e,n){for(let r=0;r<n.length;r++){const i=n[r];e[i]!==void 0&&(e[`_${i}`]=e[i],delete e[i])}}function Dv(t,e,n,r){e.inputData?e.inputData=e.inputData.map(ts):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(ts):e.inputConnection=[],e.output?e.output=e.output.map(ts):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(ts):e.inputArrayToProcess=[],e.numberOfInputs=n;function i(m){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){Wt("instance deleted - cannot call any method");return}if(y>=e.numberOfInputs){Wt(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[y]!==m||e.inputConnection[y])&&(e.inputData[y]=m,e.inputConnection[y]=null,t.modified&&t.modified())}function a(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[m]&&(e.inputData[m]=e.inputConnection[m]()),e.inputData[m]}function o(m){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){Wt("instance deleted - cannot call any method");return}if(y>=e.numberOfInputs){let v=`algorithm ${t.getClassName()} only has `;v+=`${e.numberOfInputs}`,v+=" input ports. To add more input ports, use addInputConnection()",Wt(v);return}e.inputData[y]=null,e.inputConnection[y]=m}function s(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[m]}function c(){let m=e.numberOfInputs;for(;m&&!e.inputData[m-1]&&!e.inputConnection[m-1];)m--;return m===e.numberOfInputs&&e.numberOfInputs++,m}function u(m){if(e.deleted){Wt("instance deleted - cannot call any method");return}o(m,c())}function d(m){if(e.deleted){Wt("instance deleted - cannot call any method");return}i(m,c())}function g(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(Wt("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[m])}t.shouldUpdate=()=>{const m=t.getMTime();let y=1/0,v=r;for(;v--;){if(!e.output[v]||e.output[v].isDeleted())return!0;const C=e.output[v].getMTime();if(C<m)return!0;C<y&&(y=C)}for(v=e.numberOfInputs;v--;)if(e.inputConnection[v]?.filter.shouldUpdate()||t.getInputData(v)?.getMTime()>y)return!0;return!1};function h(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const y=()=>g(m);return y.filter=t,y}if(e.numberOfInputs){let m=e.numberOfInputs;for(;m--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=i,t.setInputConnection=o,t.addInputData=d,t.addInputConnection=u,t.getInputData=a,t.getInputConnection=s}r&&(t.getOutputData=g,t.getOutputPort=h),t.update=()=>{const m=[];if(e.numberOfInputs){let y=0;for(;y<e.numberOfInputs;)m[y]=t.getInputData(y),y++}t.shouldUpdate()&&t.requestData&&t.requestData(m,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>r||e.output.length,t.getInputArrayToProcess=m=>{const y=e.inputArrayToProcess[m],v=e.inputData[m];return y&&v?v[`get${y.fieldAssociation}`]().getArray(y.arrayName):null},t.setInputArrayToProcess=function(m,y,v){let C=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<m;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[m]={arrayName:y,fieldAssociation:v,attributeType:C}}}const _v=Symbol("Event abort");function _x(t,e,n){const r=[],i=t.delete;let a=1;function o(u){for(let d=0;d<r.length;++d){const[g]=r[d];if(g===u){r.splice(d,1);return}}}function s(u){function d(){o(u)}return Object.freeze({unsubscribe:d})}function c(){if(e.deleted){Wt("instance deleted - cannot call any method");return}const u=r.slice();for(let d=0;d<u.length;++d){const[,g,h]=u[d];if(g){if(h<0)setTimeout(()=>g.apply(t,arguments),1-h);else if(g.apply(t,arguments)===_v)break}}}t[`invoke${br(n)}`]=c,t[`on${br(n)}`]=function(u){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!u.apply)return console.error(`Invalid callback for event ${n}`),null;if(e.deleted)return Wt("instance deleted - cannot call any method"),null;const g=a++;return r.push([g,u,d]),r.sort((h,m)=>m[2]-h[2]),s(g)},t.delete=()=>{i(),r.forEach(u=>{let[d]=u;return o(d)})}}function An(t,e){const n=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i={},a={};return t(a,i,r),Object.freeze(a)};return e&&ts.register(e,n),n}function A1(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e.filter(o=>!!o).map(o=>o(...i))}}function bv(t){return t&&t.isA&&t.isA("vtkObject")}function R2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(bv(t)){if(r.indexOf(t)>=0)return n;r.push(t);const i=e(t);i!==void 0&&n.push(i);const a=t.get();Object.keys(a).forEach(o=>{const s=a[o];Array.isArray(s)?s.forEach(c=>{R2(c,e,n,r)}):R2(s,e,n,r)})}return n}function bx(t,e,n){var r=this;let i;const a=function(){for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];const u=r,d=()=>{i=null,n||t.apply(u,s)},g=n&&!i;clearTimeout(i),i=setTimeout(d,e),g&&t.apply(u,s)};return a.cancel=()=>clearTimeout(i),a}function Mx(t,e){let n=!1,r=null;function i(){n=!1,r!==null&&(a(...r),r=null)}function a(){for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];if(n){r=s;return}n=!0,t(...s),setTimeout(i,e)}return a}function Mv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},n),t.setKey=(r,i)=>{e.keystore[r]=i},t.getKey=r=>e.keystore[r],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=r=>delete e.keystore[r],t.clearKeystore=()=>t.getAllKeys().forEach(r=>delete e.keystore[r])}let QA=1;const eh="__root__";function Lx(t,e){Mv(t,e);const n=t.delete;e.proxyId=`${QA++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),ha(t,e,["proxyId","proxyGroup","proxyName"]),ri(t,e,["proxyManager"]);const r={},i={};function a(u,d){i[d]||(i[d]=[]);const g=i[d];for(let h=0;h<u.length;h++)g.push(u[h].name),r[u[h].name]=u[h],u[h].children&&u[h].children.length&&a(u[h].children,u[h].name)}a(e.ui,eh),t.updateUI=u=>{e.ui=JSON.parse(JSON.stringify(u||[])),Object.keys(r).forEach(d=>delete r[d]),Object.keys(i).forEach(d=>delete i[d]),a(e.ui,eh),t.modified()};function o(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:eh;return i[u]}t.updateProxyProperty=(u,d)=>{const g=r[u];g?Object.assign(g,d):r[u]={...d}},t.activate=()=>{if(e.proxyManager){const u=`setActive${br(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[u]&&e.proxyManager[u](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(u,d)=>{d in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[d]=[]),e.propertyLinkSubscribers[d].push(u)},t.gcPropertyLinks=u=>{const d=e.propertyLinkSubscribers[u]||[];for(;d.length;)d.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(u){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[u])return e.propertyLinkMap[u];let g=null;const h=[];let m=0,y=!1;function v(R){let O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(y)return null;const b=[];let I=null;for(m=h.length;m--;){const j=h[m];j.instance===R?I=j:b.push(j)}if(!I)return null;const G=I.instance[`get${br(I.propertyName)}`]();if(!YA(G,g)||O){for(g=G,y=!0;b.length;){const j=b.pop();j.instance.set({[j.propertyName]:g})}y=!1}return e.propertyLinkMap[u].persistent&&(e.propertyLinkMap[u].value=G),G}function C(R,O){const b=[];for(m=h.length;m--;){const I=h[m];I.instance===R&&(I.propertyName===O||O===void 0)&&(I.subscription.unsubscribe(),b.push(m))}for(;b.length;)h.splice(b.pop(),1)}function S(R,O){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const I=R.onModified(v),G=h[0];return h.push({instance:R,propertyName:O,subscription:I}),b&&(e.propertyLinkMap[u].persistent&&e.propertyLinkMap[u].value!==void 0?R.set({[O]:e.propertyLinkMap[u].value}):G&&v(G.instance,!0)),{unsubscribe:()=>C(R,O)}}function w(){for(;h.length;)h.pop().subscription.unsubscribe()}const x={bind:S,unbind:C,unsubscribe:w,persistent:d};return e.propertyLinkMap[u]=x,x};function s(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:eh;const d=[],g=e.proxyId,h=o(u)||[];for(let m=0;m<h.length;m++){const y=h[m],v=t[`get${br(y)}`],C=v?v():void 0,S={id:g,name:y,value:C},w=s(y);w.length&&(S.children=w),d.push(S)}return d}t.listPropertyNames=()=>s().map(u=>u.name),t.getPropertyByName=u=>s().find(d=>d.name===u),t.getPropertyDomainByName=u=>(r[u]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:s()}),t.delete=()=>{const u=Object.keys(e.propertyLinkMap);let d=u.length;for(;d--;)e.propertyLinkMap[u[d]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),n()},t.getState=()=>null;function c(){if(e.links)for(let u=0;u<e.links.length;u++){const{link:d,property:g,persistent:h,updateOnBind:m,type:y}=e.links[u];if(y==="application"){const v=e.proxyManager.getPropertyLink(d,h);t.registerPropertyLinkForGC(v,"application"),v.bind(t,g,m)}}}Ev(c)}function Vx(t,e,n){const r=t.delete,i=[],a=Object.keys(n);let o=a.length;for(;o--;){const s=a[o],{modelKey:c,property:u,modified:d=!0}=n[s],g=br(u),h=br(s);t[`get${h}`]=e[c][`get${g}`],t[`set${h}`]=e[c][`set${g}`],d&&i.push(e[c].onModified(t.modified))}t.delete=()=>{for(;i.length;)i.pop().unsubscribe();r()}}function Ix(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function i(s){const c=Object.keys(s);let u=c.length;for(;u--;){const d=c[u];e[d].set(s[d])}}const a=Object.keys(r);let o=a.length;for(;o--;){const s=a[o];e[s]=r[s];const c=n[s];t[`set${br(s)}`]=u=>{if(u!==e[s]){e[s]=u;const d=c[u];i(d),t.modified()}}}a.length&&ha(t,e,a)}const fT=10,gT=40,dT=800;function Ax(t){let e=0,n=0,r=0,i=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*fT,i=n*fT,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||i)&&t.deltaMode&&(t.deltaMode===1?(r*=gT,i*=gT):(r*=dT,i*=dT)),r&&!e&&(e=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:e,spinY:n||e,pixelX:r,pixelY:i||r}}var H={algo:Dv,capitalize:pp,chain:A1,debounce:bx,enumToString:XA,event:_x,EVENT_ABORT:_v,formatBytesToProperUnit:wx,formatNumbersWithThousandSeparator:xx,get:ha,getArray:Tf,getCurrentGlobalMTime:jA,getStateArrayMapFunc:Rx,isVtkObject:bv,keystore:Mv,measurePromiseExecution:Ox,moveToProtected:I1,newInstance:An,newTypedArray:yf,newTypedArrayFrom:hp,normalizeWheel:Ax,obj:Yn,proxy:Lx,proxyPropertyMapping:Vx,proxyPropertyState:Ix,safeArrays:Ex,set:V1,setArray:Rv,setGet:ri,setGetArray:Ov,setImmediate:Ev,setLoggerFunction:vx,throttle:Mx,traverseInstanceTree:R2,TYPED_ARRAYS:Yi,uncapitalize:Sx,VOID:px,vtkDebugMacro:E2,vtkErrorMacro:Wt,vtkInfoMacro:Tx,vtkLogMacro:yx,vtkOnceErrorMacro:Cx,vtkWarningMacro:dp,objectSetterMap:Dx},Zi=Object.freeze({__proto__:null,VOID:px,setLoggerFunction:vx,vtkLogMacro:yx,vtkInfoMacro:Tx,vtkDebugMacro:E2,vtkErrorMacro:Wt,vtkWarningMacro:dp,vtkOnceErrorMacro:Cx,TYPED_ARRAYS:Yi,newTypedArray:yf,newTypedArrayFrom:hp,capitalize:pp,_capitalize:br,uncapitalize:Sx,formatBytesToProperUnit:wx,formatNumbersWithThousandSeparator:xx,setImmediateVTK:Ev,measurePromiseExecution:Ox,obj:Yn,get:ha,set:V1,setGet:ri,getArray:Tf,setArray:Rv,setGetArray:Ov,moveToProtected:I1,algo:Dv,EVENT_ABORT:_v,event:_x,newInstance:An,chain:A1,isVtkObject:bv,traverseInstanceTree:R2,debounce:bx,throttle:Mx,keystore:Mv,proxy:Lx,proxyPropertyMapping:Vx,proxyPropertyState:Ix,normalizeWheel:Ax,default:H}),Fh={exports:{}},JA=Fh.exports,hT;function eN(){return hT||(hT=1,function(t){(function(e,n,r){function i(c){var u=this,d=s();u.next=function(){var g=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=g-(u.c=g|0)},u.c=1,u.s0=d(" "),u.s1=d(" "),u.s2=d(" "),u.s0-=d(c),u.s0<0&&(u.s0+=1),u.s1-=d(c),u.s1<0&&(u.s1+=1),u.s2-=d(c),u.s2<0&&(u.s2+=1),d=null}function a(c,u){return u.c=c.c,u.s0=c.s0,u.s1=c.s1,u.s2=c.s2,u}function o(c,u){var d=new i(c),g=u&&u.state,h=d.next;return h.int32=function(){return d.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,g&&(typeof g=="object"&&a(g,d),h.state=function(){return a(d,{})}),h}function s(){var c=4022871197,u=function(d){d=String(d);for(var g=0;g<d.length;g++){c+=d.charCodeAt(g);var h=.02519603282416938*c;c=h>>>0,h-=c,h*=c,c=h>>>0,h-=c,c+=h*4294967296}return(c>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=o:this.alea=o})(JA,t)}(Fh)),Fh.exports}var kh={exports:{}},tN=kh.exports,pT;function nN(){return pT||(pT=1,function(t){(function(e,n,r){function i(s){var c=this,u="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var g=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^g^g>>>8},s===(s|0)?c.x=s:u+=s;for(var d=0;d<u.length+64;d++)c.x^=u.charCodeAt(d)|0,c.next()}function a(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c}function o(s,c){var u=new i(s),d=c&&c.state,g=function(){return(u.next()>>>0)/4294967296};return g.double=function(){do var h=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(h+m)/(1<<21);while(y===0);return y},g.int32=u.next,g.quick=g,d&&(typeof d=="object"&&a(d,u),g.state=function(){return a(u,{})}),g}n&&n.exports?n.exports=o:this.xor128=o})(tN,t)}(kh)),kh.exports}var Gh={exports:{}},rN=Gh.exports,mT;function iN(){return mT||(mT=1,function(t){(function(e,n,r){function i(s){var c=this,u="";c.next=function(){var g=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(g^g<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,s===(s|0)?c.x=s:u+=s;for(var d=0;d<u.length+64;d++)c.x^=u.charCodeAt(d)|0,d==u.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function a(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c.v=s.v,c.d=s.d,c}function o(s,c){var u=new i(s),d=c&&c.state,g=function(){return(u.next()>>>0)/4294967296};return g.double=function(){do var h=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(h+m)/(1<<21);while(y===0);return y},g.int32=u.next,g.quick=g,d&&(typeof d=="object"&&a(d,u),g.state=function(){return a(u,{})}),g}n&&n.exports?n.exports=o:this.xorwow=o})(rN,t)}(Gh)),Gh.exports}var Bh={exports:{}},aN=Bh.exports,vT;function oN(){return vT||(vT=1,function(t){(function(e,n,r){function i(s){var c=this;c.next=function(){var d=c.x,g=c.i,h,m;return h=d[g],h^=h>>>7,m=h^h<<24,h=d[g+1&7],m^=h^h>>>10,h=d[g+3&7],m^=h^h>>>3,h=d[g+4&7],m^=h^h<<7,h=d[g+7&7],h=h^h<<13,m^=h^h<<9,d[g]=m,c.i=g+1&7,m};function u(d,g){var h,m=[];if(g===(g|0))m[0]=g;else for(g=""+g,h=0;h<g.length;++h)m[h&7]=m[h&7]<<15^g.charCodeAt(h)+m[h+1&7]<<13;for(;m.length<8;)m.push(0);for(h=0;h<8&&m[h]===0;++h);for(h==8?m[7]=-1:m[h],d.x=m,d.i=0,h=256;h>0;--h)d.next()}u(c,s)}function a(s,c){return c.x=s.x.slice(),c.i=s.i,c}function o(s,c){s==null&&(s=+new Date);var u=new i(s),d=c&&c.state,g=function(){return(u.next()>>>0)/4294967296};return g.double=function(){do var h=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(h+m)/(1<<21);while(y===0);return y},g.int32=u.next,g.quick=g,d&&(d.x&&a(d,u),g.state=function(){return a(u,{})}),g}n&&n.exports?n.exports=o:this.xorshift7=o})(aN,t)}(Bh)),Bh.exports}var $h={exports:{}},sN=$h.exports,yT;function cN(){return yT||(yT=1,function(t){(function(e,n,r){function i(s){var c=this;c.next=function(){var d=c.w,g=c.X,h=c.i,m,y;return c.w=d=d+1640531527|0,y=g[h+34&127],m=g[h=h+1&127],y^=y<<13,m^=m<<17,y^=y>>>15,m^=m>>>12,y=g[h]=y^m,c.i=h,y+(d^d>>>16)|0};function u(d,g){var h,m,y,v,C,S=[],w=128;for(g===(g|0)?(m=g,g=null):(g=g+"\0",m=0,w=Math.max(w,g.length)),y=0,v=-32;v<w;++v)g&&(m^=g.charCodeAt((v+32)%g.length)),v===0&&(C=m),m^=m<<10,m^=m>>>15,m^=m<<4,m^=m>>>13,v>=0&&(C=C+1640531527|0,h=S[v&127]^=m+C,y=h==0?y+1:0);for(y>=128&&(S[(g&&g.length||0)&127]=-1),y=127,v=512;v>0;--v)m=S[y+34&127],h=S[y=y+1&127],m^=m<<13,h^=h<<17,m^=m>>>15,h^=h>>>12,S[y]=m^h;d.w=C,d.X=S,d.i=y}u(c,s)}function a(s,c){return c.i=s.i,c.w=s.w,c.X=s.X.slice(),c}function o(s,c){s==null&&(s=+new Date);var u=new i(s),d=c&&c.state,g=function(){return(u.next()>>>0)/4294967296};return g.double=function(){do var h=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(h+m)/(1<<21);while(y===0);return y},g.int32=u.next,g.quick=g,d&&(d.X&&a(d,u),g.state=function(){return a(u,{})}),g}n&&n.exports?n.exports=o:this.xor4096=o})(sN,t)}($h)),$h.exports}var Wh={exports:{}},lN=Wh.exports,TT;function uN(){return TT||(TT=1,function(t){(function(e,n,r){function i(s){var c=this,u="";c.next=function(){var g=c.b,h=c.c,m=c.d,y=c.a;return g=g<<25^g>>>7^h,h=h-m|0,m=m<<24^m>>>8^y,y=y-g|0,c.b=g=g<<20^g>>>12^h,c.c=h=h-m|0,c.d=m<<16^h>>>16^y,c.a=y-g|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,s===Math.floor(s)?(c.a=s/4294967296|0,c.b=s|0):u+=s;for(var d=0;d<u.length+20;d++)c.b^=u.charCodeAt(d)|0,c.next()}function a(s,c){return c.a=s.a,c.b=s.b,c.c=s.c,c.d=s.d,c}function o(s,c){var u=new i(s),d=c&&c.state,g=function(){return(u.next()>>>0)/4294967296};return g.double=function(){do var h=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(h+m)/(1<<21);while(y===0);return y},g.int32=u.next,g.quick=g,d&&(typeof d=="object"&&a(d,u),g.state=function(){return a(u,{})}),g}n&&n.exports?n.exports=o:this.tychei=o})(lN,t)}(Wh)),Wh.exports}var zh={exports:{}};const fN={},gN=Object.freeze(Object.defineProperty({__proto__:null,default:fN},Symbol.toStringTag,{value:"Module"})),As=SV(gN);var dN=zh.exports,CT;function hN(){return CT||(CT=1,function(t){(function(e,n,r){var i=256,a=6,o=52,s="random",c=r.pow(i,a),u=r.pow(2,o),d=u*2,g=i-1,h;function m(R,O,b){var I=[];O=O==!0?{entropy:!0}:O||{};var G=S(C(O.entropy?[R,x(n)]:R??w(),3),I),j=new y(I),F=function(){for(var $=j.g(a),z=c,oe=0;$<u;)$=($+oe)*i,z*=i,oe=j.g(1);for(;$>=d;)$/=2,z/=2,oe>>>=1;return($+oe)/z};return F.int32=function(){return j.g(4)|0},F.quick=function(){return j.g(4)/4294967296},F.double=F,S(x(j.S),n),(O.pass||b||function($,z,oe,Q){return Q&&(Q.S&&v(Q,j),$.state=function(){return v(j,{})}),oe?(r[s]=$,z):$})(F,G,"global"in O?O.global:this==r,O.state)}function y(R){var O,b=R.length,I=this,G=0,j=I.i=I.j=0,F=I.S=[];for(b||(R=[b++]);G<i;)F[G]=G++;for(G=0;G<i;G++)F[G]=F[j=g&j+R[G%b]+(O=F[G])],F[j]=O;(I.g=function($){for(var z,oe=0,Q=I.i,le=I.j,X=I.S;$--;)z=X[Q=g&Q+1],oe=oe*i+X[g&(X[Q]=X[le=g&le+z])+(X[le]=z)];return I.i=Q,I.j=le,oe})(i)}function v(R,O){return O.i=R.i,O.j=R.j,O.S=R.S.slice(),O}function C(R,O){var b=[],I=typeof R,G;if(O&&I=="object")for(G in R)try{b.push(C(R[G],O-1))}catch{}return b.length?b:I=="string"?R:R+"\0"}function S(R,O){for(var b=R+"",I,G=0;G<b.length;)O[g&G]=g&(I^=O[g&G]*19)+b.charCodeAt(G++);return x(O)}function w(){try{var R;return h&&(R=h.randomBytes)?R=R(i):(R=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(R)),x(R)}catch{var O=e.navigator,b=O&&O.plugins;return[+new Date,e,b,e.screen,x(n)]}}function x(R){return String.fromCharCode.apply(0,R)}if(S(r.random(),n),t.exports){t.exports=m;try{h=As}catch{}}else r["seed"+s]=m})(typeof self<"u"?self:dN,[],Math)}(zh)),zh.exports}var m3,ST;function pN(){if(ST)return m3;ST=1;var t=eN(),e=nN(),n=iN(),r=oN(),i=cN(),a=uN(),o=hN();return o.alea=t,o.xor128=e,o.xorwow=n,o.xorshift7=r,o.xor4096=i,o.tychei=a,m3=o,m3}var mN=pN();const vN=$s(mN),Lv=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],yN=[1,0,0,0,1,0,0,0,1],Vv=1e-6,Iv=1e-12,{vtkErrorMacro:Nx,vtkWarningMacro:Fl}=H;let Px=0;const wT=20;function N1(t){return()=>Nx(`vtkMath::${t} - NOT IMPLEMENTED`)}function Xg(t,e,n,r){let i;for(let a=0;a<e;a++)i=t[n*e+a],t[n*e+a]=t[r*e+a],t[r*e+a]=i}function Ag(t,e,n,r){let i;for(let a=0;a<e;a++)i=t[a*e+n],t[a*e+n]=t[a*e+r],t[a*e+r]=i}function jn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;const e=Array(t);for(let n=0;n<t;++n)e[n]=0;return e}const TN=()=>Math.PI;function CN(t,e){return e>1023?t*2**1023*2**(e-1023):e<-1074?t*2**-1074*2**(e+1074):t*2**e}function ur(t){return t/180*Math.PI}function O2(t){return t*180/Math.PI}const{round:SN,floor:Av,ceil:wN,min:xN,max:EN}=Math;function RN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0;for(let i=e,a=t.length;i<a;i+=n)t[i]<r&&(r=t[i]);return r}function ON(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=-1/0;for(let i=e,a=t.length;i<a;i+=n)r<t[i]&&(r=t[i]);return r}function DN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0,i=-1/0;for(let a=e,o=t.length;a<o;a+=n)t[a]<r&&(r=t[a]),i<t[a]&&(i=t[a]);return[r,i]}const _N=N1("ceilLog2"),bN=N1("factorial");function b0(t){let e=1;for(;e<t;)e*=2;return e}function Ng(t){return t===b0(t)}function MN(t,e){let n=1;for(let r=1;r<=e;++r)n*=(t-r+1)/r;return Math.floor(n)}function LN(t,e){if(t<e)return 0;const n=jn(e);for(let r=0;r<e;++r)n[r]=r;return n}function VN(t,e,n){let r=0;for(let i=e-1;i>=0;--i)if(n[i]<t-e+i){let a=n[i]+1;for(;i<e;)n[i++]=a++;r=1;break}return r}function IN(t){vN(`${t}`,{global:!0}),Px=t}function AN(){return Px}function NN(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const n=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:1)-t;return t+n*Math.random()}const PN=N1("gaussian");function D2(t,e,n){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function kc(t,e,n){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function Ux(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function Fx(t,e){return t[0]*=e,t[1]*=e,t}function S4(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function UN(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r}function Ft(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function FN(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[0]*e[2],n[3]=t[1]*e[0],n[4]=t[1]*e[1],n[5]=t[1]*e[2],n[6]=t[2]*e[0],n[7]=t[2]*e[1],n[8]=t[2]*e[2]}function Ns(t,e,n){const r=t[1]*e[2]-t[2]*e[1],i=t[2]*e[0]-t[0]*e[2],a=t[0]*e[1]-t[1]*e[0];return n[0]=r,n[1]=i,n[2]=a,n}function N0(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let n=0;for(let r=0;r<e;r++)n+=t[r]*t[r];return Math.sqrt(n)}}}function kl(t){const e=N0(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function kN(t,e,n,r){const i=t[0]*t[0],a=t[1]*t[1],o=t[2]*t[2],s=Math.sqrt(i+a+o);let c,u,d;i>a&&i>o?(c=0,u=1,d=2):a>o?(c=1,u=2,d=0):(c=2,u=0,d=1);const g=t[c]/s,h=t[u]/s,m=t[d]/s,y=Math.sqrt(g*g+m*m);if(r!==0){const v=Math.sin(r),C=Math.cos(r);e&&(e[c]=(m*C-g*h*v)/y,e[u]=v*y,e[d]=(-(g*C)-h*m*v)/y),n&&(n[c]=(-(m*v)-g*h*C)/y,n[u]=C*y,n[d]=(g*v-h*m*C)/y)}else e&&(e[c]=m/y,e[u]=0,e[d]=-g/y),n&&(n[c]=-g*h/y,n[u]=y,n[d]=-h*m/y)}function GN(t,e,n){const r=Ft(e,e);if(r===0)return n[0]=0,n[1]=0,n[2]=0,!1;const i=Ft(t,e)/r;for(let a=0;a<3;a++)n[a]=e[a];return Ux(n,i),!0}function w4(t,e){return t[0]*e[0]+t[1]*e[1]}function BN(t,e,n){const r=w4(e,e);if(r===0)return n[0]=0,n[1]=0,!1;const i=w4(t,e)/r;for(let a=0;a<2;a++)n[a]=e[a];return Fx(n,i),!0}function Es(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function $N(t,e){const n=[0,0,0];return Ns(t,e,n),Math.atan2(N0(n),Ft(t,e))}function WN(t,e,n){const r=Math.abs(t-n);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-(r**2)/(2*e))}function zN(t,e,n){const r=Math.abs(t-n);return Math.exp(-(r**2)/(2*e))}function HN(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[1]*e[0],n[3]=t[1]*e[1]}function kx(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function jN(t){const e=kx(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function gr(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function qN(t,e){let n,r,i;const a=[0,0,0];for(let o=0;o<3;o++)i=Math.abs(t[o*3]),(r=Math.abs(t[o*3+1]))>i&&(i=r),(r=Math.abs(t[o*3+2]))>i&&(i=r),a[o]=1/i;i=a[0]*Math.abs(t[0]),n=0,(r=a[1]*Math.abs(t[3]))>=i&&(i=r,n=1),(r=a[2]*Math.abs(t[6]))>=i&&(n=2),n!==0&&(Xg(t,3,n,0),a[n]=a[0]),e[0]=n,t[3]/=t[0],t[6]/=t[0],t[4]-=t[3]*t[1],t[7]-=t[6]*t[1],i=a[1]*Math.abs(t[4]),n=1,(r=a[2]*Math.abs(t[7]))>=i&&(n=2,Xg(t,3,1,2),a[2]=a[1]),e[1]=n,t[7]/=t[4],t[5]-=t[3]*t[2],t[8]-=t[6]*t[2]+t[7]*t[5],e[2]=2}function KN(t,e,n){let r=n[e[0]];n[e[0]]=n[0],n[0]=r,r=n[e[1]],n[e[1]]=n[1],n[1]=r-t[3]*n[0],r=n[e[2]],n[e[2]]=n[2],n[2]=r-t[6]*n[0]-t[7]*n[1],n[2]/=t[8],n[1]=(n[1]-t[5]*n[2])/t[4],n[0]=(n[0]-t[1]*n[1]-t[2]*n[2])/t[0]}function YN(t,e,n){const r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],u=t[6],d=t[7],g=t[8],h=+gr(s,d,c,g),m=-gr(o,u,c,g),y=+gr(o,u,s,d),v=-gr(i,d,a,g),C=+gr(r,u,a,g),S=-gr(r,u,i,d),w=+gr(i,s,a,c),x=-gr(r,o,a,c),R=+gr(r,o,i,s),O=r*h+i*m+a*y,b=h*e[0]+v*e[1]+w*e[2],I=m*e[0]+C*e[1]+x*e[2],G=y*e[0]+S*e[1]+R*e[2];n[0]=b/O,n[1]=I/O,n[2]=G/O}function Hh(t,e,n){const r=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],i=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],a=t[6]*e[0]+t[7]*e[1]+t[8]*e[2];n[0]=r,n[1]=i,n[2]=a}function x4(t,e,n){const r=[...t],i=[...e];for(let a=0;a<3;a++)n[a]=r[0]*i[a]+r[1]*i[a+3]+r[2]*i[a+6],n[a+3]=r[3]*i[a]+r[4]*i[a+3]+r[5]*i[a+6],n[a+6]=r[6]*i[a]+r[7]*i[a+3]+r[8]*i[a+6]}function XN(t,e,n,r,i,a,o){r!==i&&Nx("Number of columns of A must match number of rows of B.");const s=[...t],c=[...e];for(let u=0;u<n;u++)for(let d=0;d<a;d++){o[u*a+d]=0;for(let g=0;g<r;g++)o[u*a+d]+=s[u*r+g]*c[d+a*g]}}function Ku(t,e){let n;n=t[3],e[3]=t[1],e[1]=n,n=t[6],e[6]=t[2],e[2]=n,n=t[7],e[7]=t[5],e[5]=n,e[0]=t[0],e[4]=t[4],e[8]=t[8]}function ZN(t,e){const n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],u=t[7],d=t[8],g=+gr(o,u,s,d),h=-gr(a,c,s,d),m=+gr(a,c,o,u),y=-gr(r,u,i,d),v=+gr(n,c,i,d),C=-gr(n,c,r,u),S=+gr(r,o,i,s),w=-gr(n,a,i,s),x=+gr(n,a,r,o),R=n*g+r*h+i*m;R===0&&Fl("Matrix has 0 determinant"),e[0]=g/R,e[3]=h/R,e[6]=m/R,e[1]=y/R,e[4]=v/R,e[7]=C/R,e[2]=S/R,e[5]=w/R,e[8]=x/R}function mp(t){return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}function Gx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Vv;if(t.length!==e.length)return!1;function r(i,a){return Math.abs(i-e[a])<=n}return t.every(r)}const P1=Gx;function Bx(t){for(let e=0;e<3;e++)t[e*3]=t[e*3+1]=t[e*3+2]=0,t[e*3+e]=1}function $x(t,e){for(let n=0;n<t;n++){for(let r=0;r<t;r++)e[n*t+r]=0;e[n*t+n]=1}return e}function QN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Vv;return P1(t,Lv,e)}function JN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Vv;return P1(t,yN,e)}function Wx(t,e){const n=t[0]*t[0],r=t[0]*t[1],i=t[0]*t[2],a=t[0]*t[3],o=t[1]*t[1],s=t[2]*t[2],c=t[3]*t[3],u=t[1]*t[2],d=t[1]*t[3],g=t[2]*t[3],h=o+s+c;let m=1/(n+h);const y=(n-h)*m;m*=2,e[0]=o*m+y,e[3]=(u+a)*m,e[6]=(d-i)*m,e[1]=(u-a)*m,e[4]=s*m+y,e[7]=(g+r)*m,e[2]=(d+i)*m,e[5]=(g-r)*m,e[8]=c*m+y}function jh(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;const n=`${t}`.split("e");let r="";return+n[1]+e>0&&(r="+"),+`${Math.round(`${+n[0]}e${r}${+n[1]+e}`)}e-${e}`}function E4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=jh(t[0],n),e[1]=jh(t[1],n),e[2]=jh(t[2],n),e}function U1(t,e,n,r){let i,a,o,s,c,u,d,g,h,m,y,v,C,S,w,x;const R=jn(e),O=jn(e),b=(G,j,F)=>{S=G[j],C=G[F],G[j]=S-v*(C+S*m),G[F]=C+v*(S-C*m)};for($x(e,r),c=0;c<e;c++)R[c]=n[c]=t[c+c*e],O[c]=0;for(i=0;i<wT;i++){for(y=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)y+=Math.abs(t[c*e+s]);if(y===0)break;for(i<3?d=.2*y/(e*e):d=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)if(S=100*Math.abs(t[c*e+s]),i>3&&Math.abs(n[c])+S===Math.abs(n[c])&&Math.abs(n[s])+S===Math.abs(n[s]))t[c*e+s]=0;else if(Math.abs(t[c*e+s])>d){for(C=n[s]-n[c],Math.abs(C)+S===Math.abs(C)?h=t[c*e+s]/C:(g=.5*C/t[c*e+s],h=1/(Math.abs(g)+Math.sqrt(1+g*g)),g<0&&(h=-h)),w=1/Math.sqrt(1+h*h),v=h*w,m=v/(1+w),C=h*t[c*e+s],O[c]-=C,O[s]+=C,n[c]-=C,n[s]+=C,t[c*e+s]=0,a=0;a<=c-1;a++)b(t,a*e+c,a*e+s);for(a=c+1;a<=s-1;a++)b(t,c*e+a,a*e+s);for(a=s+1;a<e;a++)b(t,c*e+a,s*e+a);for(a=0;a<e;a++)b(r,a*e+c,a*e+s)}for(c=0;c<e;c++)R[c]+=O[c],n[c]=R[c],O[c]=0}if(i>=wT)return Fl("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(a=0;a<e-1;a++){for(o=a,x=n[o],i=a+1;i<e;i++)(n[i]>=x||Math.abs(n[i]-x)<Iv)&&(o=i,x=n[o]);o!==a&&(n[o]=n[a],n[a]=x,Ag(r,e,a,o))}const I=(e>>1)+(e&1);for(u=0,i=0;i<e*e;i++)r[i]>=0&&u++;if(u<I)for(i=0;i<e;i++)r[i*e+a]*=-1;return 1}function zx(t,e){const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];n[0]=t[0]+t[4]+t[8],n[5]=t[0]-t[4]-t[8],n[10]=-t[0]+t[4]-t[8],n[15]=-t[0]-t[4]+t[8],n[1]=n[4]=t[7]-t[5],n[2]=n[8]=t[2]-t[6],n[3]=n[12]=t[3]-t[1],n[6]=n[9]=t[3]+t[1],n[7]=n[13]=t[2]+t[6],n[11]=n[14]=t[7]+t[5];const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0],a=[...n];U1(a,4,i,r),e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12]}function eP(t,e,n){const r=t[0]*e[0],i=t[0]*e[1],a=t[0]*e[2],o=t[0]*e[3],s=t[1]*e[0],c=t[1]*e[1],u=t[1]*e[2],d=t[1]*e[3],g=t[2]*e[0],h=t[2]*e[1],m=t[2]*e[2],y=t[2]*e[3],v=t[3]*e[0],C=t[3]*e[1],S=t[3]*e[2],w=t[3]*e[3];n[0]=r-c-m-w,n[1]=i+s+y-S,n[2]=a-d+g+C,n[3]=o+u-h+v}function Hx(t,e){for(let h=0;h<9;h++)e[h]=t[h];const n=jn(3),r=jn(3);let i;for(let h=0;h<3;h++){const m=Math.abs(e[h*3]),y=Math.abs(e[h*3+1]),v=Math.abs(e[h*3+2]);i=y>m?y:m,i=v>i?v:i,n[h]=1,i!==0&&(n[h]/=i)}const a=Math.abs(e[0])*n[0],o=Math.abs(e[3])*n[1],s=Math.abs(e[6])*n[2];r[0]=0,i=a,o>=i&&(i=o,r[0]=1),s>=i&&(r[0]=2),r[0]!==0&&(Ag(e,3,r[0],0),n[r[0]]=n[0]);const c=Math.abs(e[4])*n[1],u=Math.abs(e[7])*n[2];r[1]=1,i=c,u>=i&&(r[1]=2,Ag(e,3,1,2)),r[2]=2;let d=0;if(mp(e)<0){d=1;for(let h=0;h<9;h++)e[h]=-e[h]}const g=jn(4);if(zx(e,g),Wx(g,e),d)for(let h=0;h<9;h++)e[h]=-e[h];r[1]!==1&&Ag(e,3,r[1],1),r[0]!==0&&Ag(e,3,r[0],0)}function jx(t,e,n){let r,i,a,o,s,c;const u=[...t];if(U1(u,3,e,n),e[0]===e[1]&&e[0]===e[2]){Bx(n);return}for(Ku(n,n),r=0;r<3;r++)if(e[(r+1)%3]===e[(r+2)%3]){for(c=Math.abs(n[r*3]),o=0,i=1;i<3;i++)c<(s=Math.abs(n[r*3+i]))&&(c=s,o=i);o!==r&&(s=e[o],e[o]=e[r],e[r]=s,Xg(n,3,r,o)),n[o*3+o]<0&&(n[o*3]=-n[o*3],n[o*3+1]=-n[o*3+1],n[o*3+2]=-n[o*3+2]),i=(o+1)%3,a=(o+2)%3,n[i*3]=0,n[i*3+1]=0,n[i*3+2]=0,n[i*3+i]=1;const d=Ns([n[o*3],n[o*3+1],n[o*3+2]],[n[i*3],n[i*3+1],n[i*3+2]],[]);kl(d);const g=Ns(d,[n[o*3],n[o*3+1],n[o*3+2]],[]);for(let h=0;h<3;h++)n[a*3+h]=d[h],n[i*3+h]=g[h];Ku(n,n);return}for(c=Math.abs(n[0]),o=0,r=1;r<3;r++)c<(s=Math.abs(n[r*3]))&&(c=s,o=r);if(o!==0){const d=e[o];e[o]=e[0],e[0]=d,Xg(n,3,o,0)}if(Math.abs(n[4])<Math.abs(n[7])){const d=e[2];e[2]=e[1],e[1]=d,Xg(n,3,1,2)}for(r=0;r<2;r++)n[r*3+r]<0&&(n[r*3]=-n[r*3],n[r*3+1]=-n[r*3+1],n[r*3+2]=-n[r*3+2]);mp(n)<0&&(n[6]=-n[6],n[7]=-n[7],n[8]=-n[8]),Ku(n,n)}function tP(t,e,n,r){let i;const a=[...t],o=mp(a);if(o<0)for(i=0;i<9;i++)a[i]=-a[i];Hx(a,e),Ku(a,a),x4(a,e,r),jx(r,n,r),x4(e,r,e),Ku(r,r),o<0&&(n[0]=-n[0],n[1]=-n[1],n[2]=-n[2])}function Nv(t,e,n){let r,i,a,o,s=0,c,u,d;const g=jn(n);for(r=0;r<n;r++){for(o=0,i=0;i<n;i++)(d=Math.abs(t[r*n+i]))>o&&(o=d);if(o===0)return Fl("Unable to factor linear system"),0;g[r]=1/o}for(i=0;i<n;i++){for(r=0;r<i;r++){for(c=t[r*n+i],a=0;a<r;a++)c-=t[r*n+a]*t[a*n+i];t[r*n+i]=c}for(o=0,r=i;r<n;r++){for(c=t[r*n+i],a=0;a<i;a++)c-=t[r*n+a]*t[a*n+i];t[r*n+i]=c,(u=g[r]*Math.abs(c))>=o&&(o=u,s=r)}if(i!==s){for(a=0;a<n;a++)u=t[s*n+a],t[s*n+a]=t[i*n+a],t[i*n+a]=u;g[s]=g[i]}if(e[i]=s,Math.abs(t[i*n+i])<=Iv)return Fl("Unable to factor linear system"),0;if(i!==n-1)for(u=1/t[i*n+i],r=i+1;r<n;r++)t[r*n+i]*=u}return 1}function Pv(t,e,n,r){let i,a,o,s,c;for(o=-1,i=0;i<r;i++){if(s=e[i],c=n[s],n[s]=n[i],o>=0)for(a=o;a<=i-1;a++)c-=t[i*r+a]*n[a];else c!==0&&(o=i);n[i]=c}for(i=r-1;i>=0;i--){for(c=n[i],a=i+1;a<r;a++)c-=t[i*r+a]*n[a];n[i]=c/t[i*r+i]}}function qx(t,e,n){if(n===2){const i=jn(2),a=gr(t[0],t[1],t[2],t[3]);return a===0?0:(i[0]=(t[3]*e[0]-t[1]*e[1])/a,i[1]=(-(t[2]*e[0])+t[0]*e[1])/a,e[0]=i[0],e[1]=i[1],1)}if(n===1)return t[0]===0?0:(e[0]/=t[0],1);const r=jn(n);return Nv(t,r,n)===0?0:(Pv(t,r,e,n),1)}function Kx(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;const a=r||jn(n),o=i||jn(n);if(Nv(t,a,n)===0)return null;for(let s=0;s<n;s++){for(let c=0;c<n;c++)o[c]=0;o[s]=1,Pv(t,a,o,n);for(let c=0;c<n;c++)e[c*n+s]=o[c]}return e}function nP(t,e){let n=+Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let i=0;i<e;i++)for(let a=i;a<e;a++)Math.abs(t[i*e+a])>r&&(r=Math.abs(t[i*e+a]));for(let i=0;i<e;i++)Math.abs(t[i*e+i])<n&&(n=Math.abs(t[i*e+i]));return n===0?Number.MAX_VALUE:r/n}function rP(t,e,n){return U1(t,3,e,n)}function R4(t,e,n,r){if(t<n)return Fl("Insufficient number of samples. Underdetermined."),0;let i,a,o;const s=jn(n*n),c=jn(n),u=jn(n*n);for(o=0;o<t;o++)for(i=0;i<n;i++)for(a=i;a<n;a++)s[i*n+a]+=e[o*n+i]*e[o*n+a];for(i=0;i<n;i++)for(a=0;a<i;a++)s[i*n+a]=s[a*n+i];for(U1(s,n,c,u),i=0;i<n;i++)r[i]=u[i*n+n-1];return 1}function iP(t,e,n,r,i,a){let o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;if(t<n||t<i)return Fl("Insufficient number of samples. Underdetermined."),0;const s=jn(i);let c=1,u,d=0,g,h,m,y=0;if(o){for(h=0;h<i;h++)s[h]=1;for(g=0;g<t;g++)for(h=0;h<i;h++)Math.abs(r[g*i+h])>Iv&&(c=0,s[h]=0);if(c&&i===1)return Fl("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),R4(t,e,n,a);if(c)y=1;else for(h=0;h<i;h++)s[h]&&(y=1)}y&&(u=jn(n),d=R4(t,e,n,u));const v=jn(n*n),C=jn(n*n),S=jn(n*i);for(m=0;m<t;m++)for(g=0;g<n;g++){for(h=g;h<n;h++)v[g*n+h]+=e[m*n+g]*e[m*n+h];for(h=0;h<i;h++)S[g*i+h]+=e[m*n+g]*r[m*i+h]}for(g=0;g<n;g++)for(h=0;h<g;h++)v[g*n+h]=v[h*n+g];const w=Kx(v,C,n);if(w)for(g=0;g<n;g++)for(h=0;h<i;h++)for(a[g*i+h]=0,m=0;m<n;m++)a[g*i+h]+=C[g*n+m]*S[m*i+h];if(y){for(h=0;h<i;h++)if(s[h])for(g=0;g<n;g++)a[g*i+h]=u[g*i]}return y?d&&w:w}function aP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,.5,1];switch(t.length){case 3:return e[0]=parseInt(t[0],16)*17/255,e[1]=parseInt(t[1],16)*17/255,e[2]=parseInt(t[2],16)*17/255,e;case 4:return e[0]=parseInt(t[1],16)*17/255,e[1]=parseInt(t[2],16)*17/255,e[2]=parseInt(t[3],16)*17/255,e;case 6:return e[0]=parseInt(t.substr(0,2),16)/255,e[1]=parseInt(t.substr(2,2),16)/255,e[2]=parseInt(t.substr(4,2),16)/255,e;case 7:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e;case 9:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e[3]=parseInt(t.substr(7,2),16)/255,e;default:return e}}function Pg(t,e){let n,r;const[i,a,o]=t,s=1/3,c=1/6,u=2/3;let d=i,g=i;a>d?d=a:a<g&&(g=a),o>d?d=o:o<g&&(g=o);const h=d;h>0?r=(d-g)/d:r=0,r>0?(i===d?n=c*(a-o)/(d-g):a===d?n=s+c*(o-i)/(d-g):n=u+c*(i-a)/(d-g),n<0&&(n+=1)):n=0,e[0]=n,e[1]=r,e[2]=h}function Rl(t,e){const[n,r,i]=t,a=1/3,o=1/6,s=2/3,c=5/6;let u,d,g;n>o&&n<=a?(d=1,u=(a-n)/o,g=0):n>a&&n<=.5?(d=1,g=(n-a)/o,u=0):n>.5&&n<=s?(g=1,d=(s-n)/o,u=0):n>s&&n<=c?(g=1,u=(n-s)/o,d=0):n>c&&n<=1?(u=1,g=(1-n)/o,d=0):(u=1,d=n/o,g=0),u=r*u+(1-r),d=r*d+(1-r),g=r*g+(1-r),u*=i,d*=i,g*=i,e[0]=u,e[1]=d,e[2]=g}function Yx(t,e){const[n,r,i]=t;let a=(n+16)/116,o=r/500+a,s=a-i/200;a**3>.008856?a**=3:a=(a-16/116)/7.787,o**3>.008856?o**=3:o=(o-16/116)/7.787,s**3>.008856?s**=3:s=(s-16/116)/7.787;const c=.9505,u=1,d=1.089;e[0]=c*o,e[1]=u*a,e[2]=d*s}function Xx(t,e){const[n,r,i]=t,a=.9505,o=1,s=1.089;let c=n/a,u=r/o,d=i/s;c>.008856?c**=1/3:c=7.787*c+16/116,u>.008856?u**=1/3:u=7.787*u+16/116,d>.008856?d**=1/3:d=7.787*d+16/116,e[0]=116*u-16,e[1]=500*(c-u),e[2]=200*(u-d)}function Zx(t,e){const[n,r,i]=t;let a=n*3.2406+r*-1.5372+i*-.4986,o=n*-.9689+r*1.8758+i*.0415,s=n*.0557+r*-.204+i*1.057;a>.0031308?a=1.055*a**(1/2.4)-.055:a*=12.92,o>.0031308?o=1.055*o**(1/2.4)-.055:o*=12.92,s>.0031308?s=1.055*s**(1/2.4)-.055:s*=12.92;let c=a;c<o&&(c=o),c<s&&(c=s),c>1&&(a/=c,o/=c,s/=c),a<0&&(a=0),o<0&&(o=0),s<0&&(s=0),e[0]=a,e[1]=o,e[2]=s}function Qx(t,e){let[n,r,i]=t;n>.04045?n=((n+.055)/1.055)**2.4:n/=12.92,r>.04045?r=((r+.055)/1.055)**2.4:r/=12.92,i>.04045?i=((i+.055)/1.055)**2.4:i/=12.92,e[0]=n*.4124+r*.3576+i*.1805,e[1]=n*.2126+r*.7152+i*.0722,e[2]=n*.0193+r*.1192+i*.9505}function _l(t,e){const n=[0,0,0];Qx(t,n),Xx(n,e)}function _2(t,e){const n=[0,0,0];Yx(t,n),Zx(n,e)}function Cf(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function qh(t){return!(t[1]-t[0]<0)}function oP(t,e,n){return n[0]=Math.min(t[0],e[0]),n[1]=Math.max(t[0],e[0]),n[2]=Math.min(t[1],e[1]),n[3]=Math.max(t[1],e[1]),n[4]=Math.min(t[2],e[2]),n[5]=Math.max(t[2],e[2]),n}function ns(t,e,n){return t<e?e:t>n?n:t}function O4(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return r[0]=ns(t[0],e[0],n[0]),r[1]=ns(t[1],e[1],n[1]),r[2]=ns(t[2],e[2],n[2]),r}function sP(t,e){let n=0;return e[0]!==e[1]&&(t<e[0]?n=e[0]:t>e[1]?n=e[1]:n=t,n=(n-e[0])/(e[1]-e[0])),n}const cP=N1("GetScalarTypeFittingRange"),lP=N1("GetAdjustedScalarRange");function uP(t,e){if(!t||!e)return 0;for(let n=0;n<6;n+=2)if(t[n]<e[n]||t[n]>e[n+1]||t[n+1]<e[n]||t[n+1]>e[n+1])return 0;return 1}function fP(t,e,n){if(!t||!e)return 0;for(let r=0;r<6;r+=2)if(t[r]+n[r/2]<e[r]||t[r]-n[r/2]>e[r+1]||t[r+1]+n[r/2]<e[r]||t[r+1]-n[r/2]>e[r+1])return 0;return 1}function gP(t,e,n){if(!t||!e||!n)return 0;for(let r=0;r<3;r++)if(t[r]+n[r]<e[2*r]||t[r]-n[r]>e[2*r+1])return 0;return 1}function dP(t,e,n,r){const i=jn(3),a=jn(3),o=jn(3),s=jn(3),c=jn(3),u=jn(3);for(let R=0;R<3;++R)i[R]=t[R]-e[R],a[R]=e[R]-n[R],o[R]=n[R]-t[R],s[R]=-i[R],c[R]=-a[R],u[R]=-o[R];const d=N0(s),g=N0(c),h=N0(o),m=jn(3);Ns(i,a,m);const y=N0(m),v=d*g*h/(2*y),C=2*y*y,S=g*g*Ft(i,u)/C,w=h*h*Ft(s,a)/C,x=d*d*Ft(o,c)/C;for(let R=0;R<3;++R)r[R]=S*t[R]+w*e[R]+x*n[R];return v}const hP=1/0,pP=-1/0,Jx=t=>!Number.isFinite(t),{isFinite:mP,isNaN:D4}=Number,b2=D4;function W0(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function vP(t){let e=-1,n=-1;for(let r=0;r<t.length;r++){const i=Math.abs(t[r]);i>e&&(n=r,e=i)}return n}function eE(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;const n=new Array(e),r=new Array(e);for(let a=0;a<e;++a)n[a]=a,r[a]=a;for(let a=e-1;a>0;a--){let o=-1/0,s=0,c=0;for(let u=0;u<=a;++u){const d=n[u];for(let g=0;g<=a;++g){const h=r[g],m=Math.abs(t[d+e*h]);m>o&&(o=m,s=u,c=g)}}[n[a],n[s]]=[n[s],n[a]],[r[a],r[c]]=[r[c],r[a]]}const i=new Array(e*e).fill(0);for(let a=0;a<e;++a){const o=n[a]+e*r[a];i[o]=t[o]<0?-1:1}return i}function tE(t){const e=Math.floor(t*255);return e>15?e.toString(16):`0${e.toString(16)}`}function yP(t){return`${arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#"}${t.map(tE).join("")}`}function th(t){return Math.round(t*255)}function TP(t){return t.length===3?`rgb(${t.map(th).join(", ")})`:`rgba(${th(t[0]||0)}, ${th(t[1]||0)}, ${th(t[2]||0)}, ${t[3]||0})`}var _o={Pi:TN,ldexp:CN,radiansFromDegrees:ur,degreesFromRadians:O2,round:SN,floor:Av,ceil:wN,ceilLog2:_N,min:xN,max:EN,arrayMin:RN,arrayMax:ON,arrayRange:DN,isPowerOfTwo:Ng,nearestPowerOfTwo:b0,factorial:bN,binomial:MN,beginCombination:LN,nextCombination:VN,randomSeed:IN,getSeed:AN,random:NN,gaussian:PN,add:D2,subtract:kc,multiplyScalar:Ux,multiplyScalar2D:Fx,multiplyAccumulate:S4,multiplyAccumulate2D:UN,dot:Ft,outer:FN,cross:Ns,norm:N0,normalize:kl,perpendiculars:kN,projectVector:GN,projectVector2D:BN,distance2BetweenPoints:Es,angleBetweenVectors:$N,gaussianAmplitude:WN,gaussianWeight:zN,dot2D:w4,outer2D:HN,norm2D:kx,normalize2D:jN,determinant2x2:gr,LUFactor3x3:qN,LUSolve3x3:KN,linearSolve3x3:YN,multiply3x3_vect3:Hh,multiply3x3_mat3:x4,multiplyMatrix:XN,transpose3x3:Ku,invert3x3:ZN,identity3x3:Bx,identity:$x,isIdentity:QN,isIdentity3x3:JN,determinant3x3:mp,quaternionToMatrix3x3:Wx,areEquals:Gx,areMatricesEqual:P1,roundNumber:jh,roundVector:E4,matrix3x3ToQuaternion:zx,multiplyQuaternion:eP,orthogonalize3x3:Hx,diagonalize3x3:jx,singularValueDecomposition3x3:tP,solveLinearSystem:qx,invertMatrix:Kx,luFactorLinearSystem:Nv,luSolveLinearSystem:Pv,estimateMatrixCondition:nP,jacobi:rP,jacobiN:U1,solveHomogeneousLeastSquares:R4,solveLeastSquares:iP,hex2float:aP,rgb2hsv:Pg,hsv2rgb:Rl,lab2xyz:Yx,xyz2lab:Xx,xyz2rgb:Zx,rgb2xyz:Qx,rgb2lab:_l,lab2rgb:_2,uninitializeBounds:Cf,areBoundsInitialized:qh,computeBoundsFromPoints:oP,clampValue:ns,clampVector:O4,clampAndNormalizeValue:sP,getScalarTypeFittingRange:cP,getAdjustedScalarRange:lP,extentIsWithinOtherExtent:uP,boundsIsWithinOtherBounds:fP,pointIsWithinBounds:gP,solve3PointCircle:dP,inf:hP,negInf:pP,isInf:Jx,isNan:D4,isNaN:D4,isFinite:mP,createUninitializedBounds:W0,getMajorAxisIndex:vP,getSparseOrthogonalMatrix:eE,floatToHex2:tE,floatRGB2HexCode:yP,float2CssRGBA:TP};const CP={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},kt={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},SP=kt.FLOAT;var nE={DefaultDataType:SP,DataTypeByteSize:CP,VtkDataTypes:kt};const{vtkErrorMacro:wP}=Zi,{DefaultDataType:xP}=nE,EP=1e-6;function _4(t,e,n){const r=t.length;let i=Number.MAX_VALUE,a=-Number.MAX_VALUE,o,s;for(s=e;s<r;s+=n)if(!Number.isNaN(t[s])){i=t[s],a=i;break}for(;s<r;s+=n)o=t[s],o<i?i=o:o>a&&(a=o);return{min:i,max:a}}function RP(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,n=0,r=0;return{add(i){t>i&&(t=i),e<i&&(e=i),n++,r+=i},get(){return{min:t,max:e,count:n,sum:r,mean:r/n}},getRange(){return{min:t,max:e}}}}function rE(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&n>1){const i=t.length/n,a=new Float64Array(i);for(let o=0,s=0;o<i;++o){for(let c=s+n;s<c;++s)a[o]+=t[s]*t[s];a[o]**=.5}return _4(a,0,1)}return _4(t,e<0?0:e,n)}function xT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=t||[];for(;n.length<=e;)n.push(null);return n}function Uv(t){return Object.prototype.toString.call(t).slice(8,-1)}function OP(t){const e=t.getNumberOfComponents();let n=0;const r=new Array(e);for(let i=0;i<t.getNumberOfTuples();++i){t.getTuple(i,r);const a=N0(r,e);a>n&&(n=a)}return n}const DP={computeRange:rE,createRangeHelper:RP,fastComputeRange:_4,getDataType:Uv,getMaxNorm:OP};function _P(t,e){e.classHierarchy.push("vtkDataArray");function n(r){if(r<0)return!1;const i=t.getNumberOfComponents(),a=e.values.length/(i>0?i:1);if(r===a)return!0;if(r>a){const o=e.values;return e.values=yf(e.dataType,(r+a)*i),e.values.set(o),!0}return e.size>r*i&&(e.size=r*i,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.resize=r=>{n(r);const i=r*t.getNumberOfComponents();return e.size!==i?(e.size=i,t.dataChange(),!0):!1},t.initialize=()=>{t.resize(0)},t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[r*e.numberOfComponents+i]},t.setComponent=(r,i,a)=>{a!==e.values[r*e.numberOfComponents+i]&&(e.values[r*e.numberOfComponents+i]=a,t.dataChange())},t.getValue=r=>{const i=r/e.numberOfComponents,a=r%e.numberOfComponents;return t.getComponent(i,a)},t.setValue=(r,i)=>{const a=r/e.numberOfComponents,o=r%e.numberOfComponents;t.setComponent(a,o,i)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,i=r;i<0&&(i=e.numberOfComponents===1?0:e.numberOfComponents);let a=null;return e.ranges||(e.ranges=xT(e.ranges,e.numberOfComponents)),a=e.ranges[i],a?(e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple):(a=rE(t.getData(),r,e.numberOfComponents),e.ranges[i]=a,e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple)},t.setRange=(r,i)=>{e.ranges||(e.ranges=xT(e.ranges,e.numberOfComponents));const a={min:r.min,max:r.max};return e.ranges[i]=a,e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple},t.getRanges=function(){if(!(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0))return structuredClone(e.ranges);const i=[];for(let a=0;a<e.numberOfComponents;a++){const[o,s]=t.getRange(a),c={min:o,max:s};i.push(c)}if(e.numberOfComponents>1){const[a,o]=t.getRange(-1),s={min:a,max:o};i.push(s)}return i},t.setTuple=(r,i)=>{const a=r*e.numberOfComponents;for(let o=0;o<e.numberOfComponents;o++)e.values[a+o]=i[o]},t.setTuples=(r,i)=>{let a=r*e.numberOfComponents;const o=Math.min(i.length,e.size-a);for(let s=0;s<o;)e.values[a++]=i[s++]},t.insertTuple=(r,i)=>(e.size<=r*e.numberOfComponents&&(e.size=(r+1)*e.numberOfComponents,n(r+1)),t.setTuple(r,i),r),t.insertTuples=(r,i)=>{const a=r+i.length/e.numberOfComponents;return e.size<a*e.numberOfComponents&&(e.size=a*e.numberOfComponents,n(a)),t.setTuples(r,i),a},t.insertNextTuple=r=>{const i=e.size/e.numberOfComponents;return t.insertTuple(i,r)},t.insertNextTuples=r=>{const i=e.size/e.numberOfComponents;return t.insertTuples(i,r)},t.findTuple=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:EP;for(let a=0;a<e.size;a+=e.numberOfComponents)if(Math.abs(r[0]-e.values[a])<=i){let o=!0;for(let s=1;s<e.numberOfComponents;++s)if(Math.abs(r[s]-e.values[a+s])>i){o=!1;break}if(o)return a/e.numberOfComponents}return-1},t.getTuple=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const a=e.numberOfComponents||1,o=r*a;switch(a){case 4:i[3]=e.values[o+3];case 3:i[2]=e.values[o+2];case 2:i[1]=e.values[o+1];case 1:i[0]=e.values[o];break;default:for(let s=a-1;s>=0;--s)i[s]=e.values[o+s]}return i},t.getTuples=(r,i)=>{const a=(r??0)*e.numberOfComponents,o=(i??t.getNumberOfTuples())*e.numberOfComponents,s=t.getData().subarray(a,o);return s.length>0?s:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>aE({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(r,i)=>{e.values=r,e.size=r.length,e.dataType=Uv(r),i&&(e.numberOfComponents=i),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;const r={...e,vtkClass:t.getClassName()};r.values=Array.from(r.values),delete r.buffer,Object.keys(r).forEach(a=>{r[a]||delete r[a]});const i={};return Object.keys(r).sort().forEach(a=>{i[a]=r[a]}),i.mtime&&delete i.mtime,i},t.deepCopy=r=>{const i=t.getDataType(),a=e.values;t.shallowCopy(r),e.ranges=structuredClone(r.getRanges()),a?.length>=r.getNumberOfValues()&&i===r.getDataType()?(a.set(r.getData()),e.values=a,t.dataChange()):t.setData(r.getData().slice())},t.interpolateTuple=(r,i,a,o,s,c)=>{const u=e.numberOfComponents||1;(u!==i.getNumberOfComponents()||u!==o.getNumberOfComponents())&&wP("numberOfComponents must match");const d=i.getTuple(a),g=o.getTuple(s),h=[];switch(h.length=u,u){case 4:h[3]=d[3]+(g[3]-d[3])*c;case 3:h[2]=d[2]+(g[2]-d[2])*c;case 2:h[1]=d[1]+(g[1]-d[1])*c;case 1:h[0]=d[0]+(g[0]-d[0])*c;break;default:for(let m=0;m<u;m++)h[m]=d[m]+(g[m]-d[m])*c}return t.insertTuple(r,h)}}const bP={name:"",numberOfComponents:1,dataType:xP,rangeTuple:[0,0]};function iE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,bP,n),Array.isArray(n.values)&&n.dataType===void 0&&console.warn("vtkDataArray.newInstance: no dataType provided, converting to Float32Array"),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=hp(e.dataType,e.values)):e.values=yf(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=Uv(e.values)),Yn(t,e),V1(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");_P(t,e)}const aE=An(iE,"vtkDataArray");var Pt={newInstance:aE,extend:iE,...DP,...nE};const MP={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},b4={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4};var Fv={VectorMode:MP,ScalarMappingTarget:b4};const LP={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},VP={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},IP={BY_ID:0,BY_NAME:1};var kv={ColorMode:LP,GetArray:IP,ScalarMode:VP};const{ScalarMappingTarget:ET,VectorMode:xs}=Fv,{VtkDataTypes:S0}=Pt,{ColorMode:nh}=kv,{vtkErrorMacro:RT}=H;function AP(t){return t}function OT(t){return Math.floor(t*255+.5)}function NP(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(xs.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(xs.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(xs.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(n,r)=>{if(!(n&&!r||!n&&r)){if(n&&r&&n.length!==r.length){RT("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],r&&n){const i=r.length;for(let a=0;a<i;a++)e.annotationArray.push({value:n[a],annotation:String(r[a])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(n,r)=>{let i=t.checkForAnnotatedValue(n),a=!1;return i>=0?e.annotationArray[i].annotation!==r&&(e.annotationArray[i].annotation=r,a=!0):(e.annotationArray.push({value:n,annotation:r}),i=e.annotationArray.length-1,a=!0),a&&(t.updateAnnotatedValueMap(),t.modified()),i},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=n=>n<0||n>=e.annotationArray.length?null:e.annotationArray[n].value,t.getAnnotation=n=>e.annotationArray[n]===void 0?null:e.annotationArray[n].annotation,t.getAnnotatedValueIndex=n=>e.annotationArray.length?t.checkForAnnotatedValue(n):-1,t.removeAnnotation=n=>{const r=t.checkForAnnotatedValue(n),i=r>=0;return i&&(e.annotationArray.splice(r,1),t.updateAnnotatedValueMap(),t.modified()),i},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(n,r)=>{if(e.indexedLookup){const i=t.getAnnotatedValueIndex(n);t.getIndexedColor(i,r)}else t.getColor(parseFloat(n),r),r[3]=1},t.checkForAnnotatedValue=n=>t.getAnnotatedValueIndexInternal(n),t.getAnnotatedValueIndexInternal=n=>{if(e.annotatedValueMap[n]!==void 0){const r=e.annotationArray.length;return e.annotatedValueMap[n]%r}return-1},t.getIndexedColor=(n,r)=>{r[0]=0,r[1]=0,r[2]=0,r[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];const n=e.annotationArray.length;for(let r=0;r<n;r++)e.annotatedValueMap[e.annotationArray[r].value]=r},t.mapScalars=(n,r,i)=>{const a=n.getNumberOfComponents();let o=null;if(r===nh.DEFAULT&&(n.getDataType()===S0.UNSIGNED_CHAR||n.getDataType()===S0.UNSIGNED_CHAR_CLAMPED)||r===nh.DIRECT_SCALARS&&n)o=t.convertToRGBA(n,a,n.getNumberOfTuples());else{const s={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:S0.UNSIGNED_CHAR},c=H.newTypedArray(s.dataType,4*n.getNumberOfTuples());s.values=c,s.size=c.length,o=Pt.newInstance(s);let u=i;u<0&&a>1?t.mapVectorsThroughTable(n,o,ET.RGBA,-1,-1):(u<0&&(u=0),u>=a&&(u=a-1),t.mapScalarsThroughTable(n,o,ET.RGBA,u))}return o},t.mapVectorsToMagnitude=(n,r,i)=>{const a=n.getNumberOfTuples(),o=n.getNumberOfComponents(),s=r.getData(),c=n.getData();for(let u=0;u<a;u++){let d=0;for(let g=0;g<i;g++)d+=c[u*o+g]*c[u*o+g];s[u]=Math.sqrt(d)}},t.mapVectorsThroughTable=(n,r,i,a,o)=>{let s=t.getVectorMode(),c=o,u=a;const d=n.getNumberOfComponents();s===xs.COMPONENT?(u===-1&&(u=t.getVectorComponent()),u<0&&(u=0),u>=d&&(u=d-1)):(c===-1&&(c=t.getVectorSize()),c<=0?(u=0,c=d):(u<0&&(u=0),u>=d&&(u=d-1),u+c>d&&(c=d-u)),s===xs.MAGNITUDE&&(d===1||c===1)&&(s=xs.COMPONENT));let g=0;switch(u>0&&(g=u),s){case xs.COMPONENT:{t.mapScalarsThroughTable(n,r,i,g);break}case xs.RGBCOLORS:break;case xs.MAGNITUDE:default:{const h=Pt.newInstance({numberOfComponents:1,values:new Float32Array(n.getNumberOfTuples())});t.mapVectorsToMagnitude(n,h,c),t.mapScalarsThroughTable(h,r,i,0);break}}},t.luminanceToRGBA=(n,r,i,a)=>{const o=a(i),s=r.getData(),c=n.getData(),u=s.length,d=0,g=1;let h=0;for(let m=d;m<u;m+=g){const y=a(s[m]);c[h*4]=y,c[h*4+1]=y,c[h*4+2]=y,c[h*4+3]=o,h++}},t.luminanceAlphaToRGBA=(n,r,i,a)=>{const o=r.getData(),s=n.getData(),c=o.length,u=0,d=2;let g=0;for(let h=u;h<c;h+=d){const m=a(o[h]);s[g]=m,s[g+1]=m,s[g+2]=m,s[g+3]=a(o[h+1])*i,g+=4}},t.rGBToRGBA=(n,r,i,a)=>{const o=OT(i),s=r.getData(),c=n.getData(),u=s.length,d=0,g=3;let h=0;for(let m=d;m<u;m+=g)c[h*4]=a(s[m]),c[h*4+1]=a(s[m+1]),c[h*4+2]=a(s[m+2]),c[h*4+3]=o,h++},t.rGBAToRGBA=(n,r,i,a)=>{const o=r.getData(),s=n.getData(),c=o.length,u=0,d=4;let g=0;for(let h=u;h<c;h+=d)s[g*4]=a(o[h]),s[g*4+1]=a(o[h+1]),s[g*4+2]=a(o[h+2]),s[g*4+3]=a(o[h+3])*i,g++},t.convertToRGBA=(n,r,i)=>{let{alpha:a}=e;if(r===4&&a>=1&&n.getDataType()===S0.UNSIGNED_CHAR)return n;const o=Pt.newInstance({numberOfComponents:4,empty:!0,size:4*i,dataType:S0.UNSIGNED_CHAR});if(i<=0)return o;a=a>0?a:0,a=a<1?a:1;let s=AP;switch((n.getDataType()===S0.FLOAT||n.getDataType()===S0.DOUBLE)&&(s=OT),r){case 1:t.luminanceToRGBA(o,n,a,s);break;case 2:t.luminanceAlphaToRGBA(o,n,s);break;case 3:t.rGBToRGBA(o,n,a,s);break;case 4:t.rGBAToRGBA(o,n,a,s);break;default:return RT("Cannot convert colors"),null}return o},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(n,r)=>t.setMappingRange(n,r),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(n,r,i)=>{if(!n)return t.isOpaque();const a=n.getNumberOfComponents();return r===nh.DEFAULT&&n.getDataType()===S0.UNSIGNED_CHAR||r===nh.DIRECT_SCALARS?a===3||a===1?e.alpha>=1:n.getRange(a-1)[0]===255:!0}}const PP={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:xs.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1};function oE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PP,n),H.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],H.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),H.setArray(t,e,["mappingRange"],2),H.getArray(t,e,["mappingRange"]),NP(t,e)}const UP=H.newInstance(oE,"vtkScalarsToColors");var Gv={newInstance:UP,extend:oE,...Fv};const FP={RGB:0,HSV:1,LAB:2,DIVERGING:3},kP={LINEAR:0,LOG10:1};var sE={ColorSpace:FP,Scale:kP};const{ColorSpace:Ro,Scale:Bv}=sE,{ScalarMappingTarget:rh}=Gv,{vtkDebugMacro:GP,vtkErrorMacro:Cc,vtkWarningMacro:BP}=H;function DT(t,e){const n=t[0],r=t[1],i=t[2],a=Math.sqrt(n*n+r*r+i*i),o=a>.001?Math.acos(n/a):0,s=o>.001?Math.atan2(i,r):0;e[0]=a,e[1]=o,e[2]=s}function $P(t,e){const n=t[0],r=t[1],i=t[2];e[0]=n*Math.cos(r),e[1]=n*Math.sin(r)*Math.cos(i),e[2]=n*Math.sin(r)*Math.sin(i)}function _T(t,e){if(t[0]>=e-.1)return t[2];const n=t[1]*Math.sqrt(e*e-t[0]*t[0])/(t[0]*Math.sin(t[1]));return t[2]>-.3*Math.PI?t[2]+n:t[2]-n}function WP(t,e){let n=t-e;for(n<0&&(n=-n);n>=2*Math.PI;)n-=2*Math.PI;return n>Math.PI&&(n=2*Math.PI-n),n}function bT(t,e,n,r){const i=[],a=[];_l(e,i),_l(n,a);const o=[],s=[];DT(i,o),DT(a,s);let c=t;if(o[1]>.05&&s[1]>.05&&WP(o[2],s[2])>.33*Math.PI){let g=Math.max(o[0],s[0]);g=Math.max(88,g),t<.5?(s[0]=g,s[1]=0,s[2]=0,c*=2):(o[0]=g,o[1]=0,o[2]=0,c=2*c-1)}o[1]<.05&&s[1]>.05?o[2]=_T(s,o[0]):s[1]<.05&&o[1]>.05&&(s[2]=_T(o,s[0]));const u=[];u[0]=(1-c)*o[0]+c*s[0],u[1]=(1-c)*o[1]+c*s[1],u[2]=(1-c)*o[2]+c*s[2];const d=[];$P(u,d),_2(d,r)}function zP(t,e){e.classHierarchy.push("vtkColorTransferFunction"),t.getSize=()=>e.nodes.length,t.addRGBPoint=(n,r,i,a)=>t.addRGBPointLong(n,r,i,a,.5,0),t.addRGBPointLong=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;if(o<0||o>1)return Cc("Midpoint outside range [0.0, 1.0]"),-1;if(s<0||s>1)return Cc("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);const c={x:n,r,g:i,b:a,midpoint:o,sharpness:s};e.nodes.push(c),t.sortAndUpdateRange();let u=0;for(;u<e.nodes.length&&e.nodes[u].x!==n;u++);return u<e.nodes.length?u:-1},t.addHSVPoint=(n,r,i,a)=>t.addHSVPointLong(n,r,i,a,.5,0),t.addHSVPointLong=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;const c=[];return Rl([r,i,a],c),t.addRGBPoint(n,c[0],c[1],c[2],o,s)},t.setNodes=n=>{if(e.nodes!==n){const r=JSON.stringify(e.nodes);e.nodes=n;const i=JSON.stringify(e.nodes);if(t.sortAndUpdateRange()||r!==i)return t.modified(),!0}return!1},t.sortAndUpdateRange=()=>{const n=JSON.stringify(e.nodes);e.nodes.sort((a,o)=>a.x-o.x);const r=JSON.stringify(e.nodes),i=t.updateRange();return!i&&n!==r?(t.modified(),!0):i},t.updateRange=()=>{const n=[2];n[0]=e.mappingRange[0],n[1]=e.mappingRange[1];const r=e.nodes.length;return r?(e.mappingRange[0]=e.nodes[0].x,e.mappingRange[1]=e.nodes[r-1].x):(e.mappingRange[0]=0,e.mappingRange[1]=0),n[0]===e.mappingRange[0]&&n[1]===e.mappingRange[1]?!1:(t.modified(),!0)},t.removePoint=n=>{let r=0;for(;r<e.nodes.length&&e.nodes[r].x!==n;r++);const i=r;if(r>=e.nodes.length)return-1;let a=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(a=t.updateRange()),a||t.modified(),i},t.movePoint=(n,r)=>{if(n!==r){t.removePoint(r);for(let i=0;i<e.nodes.length;i++)if(e.nodes[i].x===n){e.nodes[i].x=r,t.sortAndUpdateRange();break}}},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addRGBSegment=(n,r,i,a,o,s,c,u)=>{t.sortAndUpdateRange();for(let d=0;d<e.nodes.length;)e.nodes[d].x>=n&&e.nodes[d].x<=o?e.nodes.splice(d,1):d++;t.addRGBPointLong(n,r,i,a,.5,0),t.addRGBPointLong(o,s,c,u,.5,0),t.modified()},t.addHSVSegment=(n,r,i,a,o,s,c,u)=>{const d=[r,i,a],g=[s,c,u],h=[],m=[];Rl(d,h),Rl(g,m),t.addRGBSegment(n,h[0],h[1],h[2],o,m[0],m[1],m[2])},t.mapValue=n=>{const r=[];return t.getColor(n,r),[Math.floor(255*r[0]+.5),Math.floor(255*r[1]+.5),Math.floor(255*r[2]+.5),255]},t.getColor=(n,r)=>{if(e.indexedLookup){const i=t.getSize(),a=t.getAnnotatedValueIndexInternal(n);if(a<0||i===0){const o=t.getNanColorByReference();r[0]=o[0],r[1]=o[1],r[2]=o[2]}else{const o=[];t.getNodeValue(a%i,o),r[0]=o[1],r[1]=o[2],r[2]=o[3]}return}t.getTable(n,n,1,r)},t.getRedValue=n=>{const r=[];return t.getColor(n,r),r[0]},t.getGreenValue=n=>{const r=[];return t.getColor(n,r),r[1]},t.getBlueValue=n=>{const r=[];return t.getColor(n,r),r[2]},t.getTable=(n,r,i,a)=>{const o=Number(n),s=Number(r);if(b2(o)||b2(s)){for(let j=0;j<i;j++)a[j*3+0]=e.nanColor[0],a[j*3+1]=e.nanColor[1],a[j*3+2]=e.nanColor[2];return}let c=0;const u=e.nodes.length;let d=0,g=0,h=0;u!==0&&(d=e.nodes[u-1].r,g=e.nodes[u-1].g,h=e.nodes[u-1].b);let m=0,y=0,v=0;const C=[0,0,0],S=[0,0,0];let w=0,x=0;const R=[];let O=e.scale===Bv.LOG10;O&&(O=e.mappingRange[0]>0);let b=0,I=0,G=0;O&&(b=Math.log10(o),I=Math.log10(s));for(let j=0;j<i;j++){const F=3*j;if(i>1?O?(G=b+j/(i-1)*(I-b),m=10**G):m=o+j/(i-1)*(s-o):O?(G=.5*(b+I),m=10**G):m=.5*(o+s),e.discretize){const $=e.mappingRange;if(m>=$[0]&&m<=$[1]){const z=e.numberOfValues,oe=$[1]-$[0];if(z<=1)m=$[0]+oe/2;else{const Q=(m-$[0])/oe,le=Av(z*Q);m=$[0]+le/(z-1)*oe}}}for(;c<u&&m>e.nodes[c].x;)c++,c<u&&(y=e.nodes[c-1].x,v=e.nodes[c].x,O&&(y=Math.log10(y),v=Math.log10(v)),C[0]=e.nodes[c-1].r,S[0]=e.nodes[c].r,C[1]=e.nodes[c-1].g,S[1]=e.nodes[c].g,C[2]=e.nodes[c-1].b,S[2]=e.nodes[c].b,w=e.nodes[c-1].midpoint,x=e.nodes[c-1].sharpness,w<1e-5&&(w=1e-5),w>.99999&&(w=.99999));if(m>e.mappingRange[1])a[F]=0,a[F+1]=0,a[F+2]=0,e.clamping&&(t.getUseAboveRangeColor()?(a[F]=e.aboveRangeColor[0],a[F+1]=e.aboveRangeColor[1],a[F+2]=e.aboveRangeColor[2]):(a[F]=d,a[F+1]=g,a[F+2]=h));else if(m<e.mappingRange[0]||Jx(m)&&m<0)a[F]=0,a[F+1]=0,a[F+2]=0,e.clamping&&(t.getUseBelowRangeColor()?(a[F]=e.belowRangeColor[0],a[F+1]=e.belowRangeColor[1],a[F+2]=e.belowRangeColor[2]):u>0&&(a[F]=e.nodes[0].r,a[F+1]=e.nodes[0].g,a[F+2]=e.nodes[0].b));else if(c===0&&(Math.abs(m-o)<1e-6||e.discretize))u>0?(a[F]=e.nodes[0].r,a[F+1]=e.nodes[0].g,a[F+2]=e.nodes[0].b):(a[F]=0,a[F+1]=0,a[F+2]=0);else{let $=0;if(O?$=(G-y)/(v-y):$=(m-y)/(v-y),$<w?$=.5*$/w:$=.5+.5*($-w)/(1-w),x>.99)if($<.5){a[F]=C[0],a[F+1]=C[1],a[F+2]=C[2];continue}else{a[F]=S[0],a[F+1]=S[1],a[F+2]=S[2];continue}if(x<.01){if(e.colorSpace===Ro.RGB)a[F]=(1-$)*C[0]+$*S[0],a[F+1]=(1-$)*C[1]+$*S[1],a[F+2]=(1-$)*C[2]+$*S[2];else if(e.colorSpace===Ro.HSV){const W=[],ae=[];Pg(C,W),Pg(S,ae),e.hSVWrap&&(W[0]-ae[0]>.5||ae[0]-W[0]>.5)&&(W[0]>ae[0]?W[0]-=1:ae[0]-=1);const fe=[];fe[0]=(1-$)*W[0]+$*ae[0],fe[0]<0&&(fe[0]+=1),fe[1]=(1-$)*W[1]+$*ae[1],fe[2]=(1-$)*W[2]+$*ae[2],Rl(fe,R),a[F]=R[0],a[F+1]=R[1],a[F+2]=R[2]}else if(e.colorSpace===Ro.LAB){const W=[],ae=[];_l(C,W),_l(S,ae);const fe=[];fe[0]=(1-$)*W[0]+$*ae[0],fe[1]=(1-$)*W[1]+$*ae[1],fe[2]=(1-$)*W[2]+$*ae[2],_2(fe,R),a[F]=R[0],a[F+1]=R[1],a[F+2]=R[2]}else e.colorSpace===Ro.DIVERGING?(bT($,C,S,R),a[F]=R[0],a[F+1]=R[1],a[F+2]=R[2]):Cc("ColorSpace set to invalid value.",e.colorSpace);continue}$<.5?$=.5*($*2)**(1+10*x):$>.5&&($=1-.5*((1-$)*2)**(1+10*x));const z=$*$,oe=z*$,Q=2*oe-3*z+1,le=-2*oe+3*z,X=oe-2*z+$,ie=oe-z;let ye,ge;if(e.colorSpace===Ro.RGB)for(let W=0;W<3;W++)ye=S[W]-C[W],ge=(1-x)*ye,a[F+W]=Q*C[W]+le*S[W]+X*ge+ie*ge;else if(e.colorSpace===Ro.HSV){const W=[],ae=[];Pg(C,W),Pg(S,ae),e.hSVWrap&&(W[0]-ae[0]>.5||ae[0]-W[0]>.5)&&(W[0]>ae[0]?W[0]-=1:ae[0]-=1);const fe=[];for(let ue=0;ue<3;ue++)ye=ae[ue]-W[ue],ge=(1-x)*ye,fe[ue]=Q*W[ue]+le*ae[ue]+X*ge+ie*ge,ue===0&&fe[ue]<0&&(fe[ue]+=1);Rl(fe,R),a[F]=R[0],a[F+1]=R[1],a[F+2]=R[2]}else if(e.colorSpace===Ro.LAB){const W=[],ae=[];_l(C,W),_l(S,ae);const fe=[];for(let ue=0;ue<3;ue++)ye=ae[ue]-W[ue],ge=(1-x)*ye,fe[ue]=Q*W[ue]+le*ae[ue]+X*ge+ie*ge;_2(fe,R),a[F]=R[0],a[F+1]=R[1],a[F+2]=R[2]}else e.colorSpace===Ro.DIVERGING?(bT($,C,S,R),a[F]=R[0],a[F+1]=R[1],a[F+2]=R[2]):Cc("ColorSpace set to invalid value.");for(let W=0;W<3;W++)a[F+W]=a[F+W]<0?0:a[F+W],a[F+W]=a[F+W]>1?1:a[F+W]}}},t.getUint8Table=function(n,r,i){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t.getMTime()<=e.buildTime&&e.tableSize===i&&e.tableWithAlpha!==a)return e.table;if(e.nodes.length===0)return Cc("Attempting to lookup a value with no points in the function"),e.table;const o=a?4:3;(e.tableSize!==i||e.tableWithAlpha!==a)&&(e.table=new Uint8Array(i*o),e.tableSize=i,e.tableWithAlpha=a);const s=[];t.getTable(n,r,i,s);for(let c=0;c<i;c++)e.table[c*o+0]=Math.floor(s[c*3+0]*255+.5),e.table[c*o+1]=Math.floor(s[c*3+1]*255+.5),e.table[c*o+2]=Math.floor(s[c*3+2]*255+.5),a&&(e.table[c*o+3]=255);return e.buildTime.modified(),e.table},t.buildFunctionFromArray=n=>{t.removeAllPoints();const r=n.getNumberOfComponents();for(let i=0;i<n.getNumberOfTuples();i++)switch(r){case 3:{e.nodes.push({x:i,r:n.getComponent(i,0),g:n.getComponent(i,1),b:n.getComponent(i,2),midpoint:.5,sharpness:0});break}case 4:{e.nodes.push({x:n.getComponent(i,0),r:n.getComponent(i,1),g:n.getComponent(i,2),b:n.getComponent(i,3),midpoint:.5,sharpness:0});break}case 5:{e.nodes.push({x:i,r:n.getComponent(i,0),g:n.getComponent(i,1),b:n.getComponent(i,2),midpoint:n.getComponent(i,4),sharpness:n.getComponent(i,5)});break}case 6:{e.nodes.push({x:n.getComponent(i,0),r:n.getComponent(i,1),g:n.getComponent(i,2),b:n.getComponent(i,3),midpoint:n.getComponent(i,4),sharpness:n.getComponent(i,5)});break}}t.sortAndUpdateRange()},t.buildFunctionFromTable=(n,r,i,a)=>{let o=0;t.removeAllPoints(),i>1&&(o=(r-n)/(i-1));for(let s=0;s<i;s++){const c={x:n+o*s,r:a[s*3],g:a[s*3+1],b:a[s*3+2],sharpness:0,midpoint:.5};e.nodes.push(c)}t.sortAndUpdateRange()},t.getNodeValue=(n,r)=>n<0||n>=e.nodes.length?(Cc("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].r,r[2]=e.nodes[n].g,r[3]=e.nodes[n].b,r[4]=e.nodes[n].midpoint,r[5]=e.nodes[n].sharpness,1),t.setNodeValue=(n,r)=>{if(n<0||n>=e.nodes.length)return Cc("Index out of range!"),-1;const i=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].r=r[1],e.nodes[n].g=r[2],e.nodes[n].b=r[3],e.nodes[n].midpoint=r[4],e.nodes[n].sharpness=r[5],i!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.getNumberOfAvailableColors=()=>{if(e.indexedLookup&&t.getSize())return t.getSize();if(e.tableSize)return e.tableSize;const n=e.nodes?.length??0;return Math.max(4094,n)},t.getIndexedColor=(n,r)=>{const i=t.getSize();if(i>0&&n>=0){const o=[];t.getNodeValue(n%i,o);for(let s=0;s<3;++s)r[s]=o[s+1];r[3]=1;return}const a=t.getNanColorByReference();r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=1},t.fillFromDataPointer=(n,r)=>{if(!(n<=0||!r)){t.removeAllPoints();for(let i=0;i<n;i++)t.addRGBPoint(r[i*4],r[i*4+1],r[i*4+2],r[i*4+3])}},t.setMappingRange=(n,r)=>{const i=[n,r],a=t.getRange();if(a[1]===i[1]&&a[0]===i[0])return;if(i[1]===i[0]){Cc("attempt to set zero width color range");return}const o=(i[1]-i[0])/(a[1]-a[0]),s=i[0]-a[0]*o;for(let c=0;c<e.nodes.length;++c)e.nodes[c].x=e.nodes[c].x*o+s;e.mappingRange[0]=i[0],e.mappingRange[1]=i[1],t.modified()},t.adjustRange=n=>{const r=t.getRange(),i=[];r[0]<n[0]?(t.getColor(n[0],i),t.addRGBPoint(n[0],i[0],i[1],i[2])):(t.getColor(r[0],i),t.addRGBPoint(n[0],i[0],i[1],i[2])),r[1]>n[1]?(t.getColor(n[1],i),t.addRGBPoint(n[1],i[0],i[1],i[2])):(t.getColor(r[1],i),t.addRGBPoint(n[1],i[0],i[1],i[2])),t.sortAndUpdateRange();for(let a=0;a<e.nodes.length;)e.nodes[a].x>=n[0]&&e.nodes[a].x<=n[1]?e.nodes.splice(a,1):++a;return 1},t.estimateMinNumberOfSamples=(n,r)=>{const i=t.findMinimumXDistance();return Math.ceil((r-n)/i)},t.findMinimumXDistance=()=>{if(e.nodes.length<2)return-1;let n=Number.MAX_VALUE;for(let r=0;r<e.nodes.length-1;r++){const i=e.nodes[r+1].x-e.nodes[r].x;i<n&&(n=i)}return n},t.mapScalarsThroughTable=(n,r,i,a)=>{if(t.getSize()===0){GP("Transfer Function Has No Points!");return}e.indexedLookup?t.mapDataIndexed(n,r,i,a):t.mapData(n,r,i,a)},t.mapData=(n,r,i,a)=>{if(t.getSize()===0){BP("Transfer Function Has No Points!");return}const o=Math.floor(t.getAlpha()*255+.5),s=n.getNumberOfTuples(),c=n.getNumberOfComponents(),u=r.getData(),d=n.getData(),g=[];if(i===rh.RGBA)for(let h=0;h<s;h++){const m=d[h*c+a];t.getColor(m,g),u[h*4]=Math.floor(g[0]*255+.5),u[h*4+1]=Math.floor(g[1]*255+.5),u[h*4+2]=Math.floor(g[2]*255+.5),u[h*4+3]=o}if(i===rh.RGB)for(let h=0;h<s;h++){const m=d[h*c+a];t.getColor(m,g),u[h*3]=Math.floor(g[0]*255+.5),u[h*3+1]=Math.floor(g[1]*255+.5),u[h*3+2]=Math.floor(g[2]*255+.5)}if(i===rh.LUMINANCE)for(let h=0;h<s;h++){const m=d[h*c+a];t.getColor(m,g),u[h]=Math.floor(g[0]*76.5+g[1]*150.45+g[2]*28.05+.5)}if(i===rh.LUMINANCE_ALPHA)for(let h=0;h<s;h++){const m=d[h*c+a];t.getColor(m,g),u[h*2]=Math.floor(g[0]*76.5+g[1]*150.45+g[2]*28.05+.5),u[h*2+1]=o}},t.applyColorMap=n=>{const r=JSON.stringify(e.colorSpace);n.ColorSpace&&(e.colorSpace=Ro[n.ColorSpace.toUpperCase()],e.colorSpace===void 0&&(Cc(`ColorSpace ${n.ColorSpace} not supported, using RGB instead`),e.colorSpace=Ro.RGB));let i=r!==JSON.stringify(e.colorSpace);const a=i||JSON.stringify(e.nanColor);if(n.NanColor)for(e.nanColor=[].concat(n.NanColor);e.nanColor.length<4;)e.nanColor.push(1);i=i||a!==JSON.stringify(e.nanColor);const o=i||JSON.stringify(e.nodes);if(n.RGBPoints){const u=n.RGBPoints.length;e.nodes=[];const d=.5,g=0;for(let h=0;h<u;h+=4)e.nodes.push({x:n.RGBPoints[h],r:n.RGBPoints[h+1],g:n.RGBPoints[h+2],b:n.RGBPoints[h+3],midpoint:d,sharpness:g})}const s=t.sortAndUpdateRange(),c=!s&&(i||o!==JSON.stringify(e.nodes));return c&&t.modified(),s||c}}const HP={clamping:!0,colorSpace:Ro.RGB,hSVWrap:!0,scale:Bv.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function cE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HP,n),Gv.extend(t,e,n),e.table=[],e.nodes=[],e.nanColor=[.5,0,0,1],e.belowRangeColor=[0,0,0,1],e.aboveRangeColor=[1,1,1,1],e.buildTime={},H.obj(e.buildTime),H.get(t,e,["buildTime","mappingRange"]),H.setGet(t,e,["useAboveRangeColor","useBelowRangeColor","discretize","numberOfValues",{type:"enum",name:"colorSpace",enum:Ro},{type:"enum",name:"scale",enum:Bv}]),H.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),H.getArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"]),zP(t,e)}const jP=H.newInstance(cE,"vtkColorTransferFunction");var Xc={newInstance:jP,extend:cE,...sE},qP=[{Name:"KAAMS",IndexedColors:[1,1,1,1,0,0,0,1,0,0,0,1,1,1,0,1,0,1,0,1,1,.63,.63,1,.67,.5,.33,1,.5,.75,.53,.35,.7,1,.75,.5],Annotations:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11]},{ColorSpace:"Diverging",Name:"Cool to Warm",NanColor:[1,1,0],RGBPoints:[0,.23137254902,.298039215686,.752941176471,.5,.865,.865,.865,1,.705882352941,.0156862745098,.149019607843]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Cool to Warm (Extended)",NanColor:[.25,0,0],RGBPoints:[0,0,0,.34902,.03125,.039216,.062745,.380392,.0625,.062745,.117647,.411765,.09375,.090196,.184314,.45098,.125,.12549,.262745,.501961,.15625,.160784,.337255,.541176,.1875,.2,.396078,.568627,.21875,.239216,.454902,.6,.25,.286275,.521569,.65098,.28125,.337255,.592157,.701961,.3125,.388235,.654902,.74902,.34375,.466667,.737255,.819608,.375,.572549,.819608,.878431,.40625,.654902,.866667,.909804,.4375,.752941,.917647,.941176,.46875,.823529,.956863,.968627,.5,.988235,.960784,.901961,.5,.941176,.984314,.988235,.52,.988235,.945098,.85098,.54,.980392,.898039,.784314,.5625,.968627,.835294,.698039,.59375,.94902,.733333,.588235,.625,.929412,.65098,.509804,.65625,.909804,.564706,.435294,.6875,.878431,.458824,.352941,.71875,.839216,.388235,.286275,.75,.760784,.294118,.211765,.78125,.701961,.211765,.168627,.8125,.65098,.156863,.129412,.84375,.6,.094118,.094118,.875,.54902,.066667,.098039,.90625,.501961,.05098,.12549,.9375,.45098,.054902,.172549,.96875,.4,.054902,.192157,1,.34902,.070588,.211765]},{ColorSpace:"Diverging",Name:"Warm to Cool",NanColor:[1,1,0],RGBPoints:[0,.705882352941,.0156862745098,.149019607843,.5,.865,.865,.865,1,.23137254902,.298039215686,.752941176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Warm to Cool (Extended)",NanColor:[.250004,0,0],RGBPoints:[0,.34902,0,.129412,.025,.4,.00392157,.101961,.05,.470588,.0156863,.0901961,.075,.54902,.027451,.0705882,.1,.619608,.0627451,.0431373,.125,.690196,.12549,.0627451,.15,.741176,.184314,.0745098,.175,.788235,.266667,.0941176,.2,.811765,.345098,.113725,.225,.831373,.411765,.133333,.25,.85098,.47451,.145098,.275,.870588,.54902,.156863,.3,.878431,.619608,.168627,.325,.890196,.658824,.196078,.35,.909804,.717647,.235294,.375,.929412,.776471,.278431,.395522,.94902,.823529,.321569,.418905,.968627,.87451,.407843,.444278,.980392,.917647,.509804,.470149,.988235,.956863,.643137,.483582,.992157,.964706,.713725,.499,.988235,.980392,.870588,.5,1,1,1,.501,.913725,.988235,.937255,.516418,.827451,.980392,.886275,.531343,.764706,.980392,.866667,.546766,.658824,.980392,.843137,.564179,.572549,.964706,.835294,.587562,.423529,.941176,.87451,.60597,.262745,.901961,.862745,.629851,.0705882,.854902,.870588,.651741,.0509804,.8,.85098,.681592,.0235294,.709804,.831373,.712935,.0313725,.615686,.811765,.75,.0313725,.537255,.788235,.775,.0392157,.466667,.768627,.8,.0509804,.396078,.741176,.825,.054902,.317647,.709804,.85,.054902,.243137,.678431,.875,.0431373,.164706,.639216,.9,.0313725,.0980392,.6,.925,.0392157,.0392157,.560784,.95,.105882,.0509804,.509804,.975,.113725,.0235294,.45098,1,.12549,0,.380392]},{ColorSpace:"RGB",Name:"Rainbow Desaturated",NanColor:[1,1,0],RGBPoints:[0,.278431372549,.278431372549,.858823529412,.143,0,0,.360784313725,.285,0,1,1,.429,0,.501960784314,0,.571,1,1,0,.714,1,.380392156863,0,.857,.419607843137,0,0,1,.878431372549,.301960784314,.301960784314]},{ColorSpace:"RGB",Name:"Cold and Hot",NanColor:[1,1,0],RGBPoints:[0,0,1,1,.45,0,0,1,.5,0,0,.501960784314,.55,1,0,0,1,1,1,0]},{ColorSpace:"RGB",Name:"Black-Body Radiation",NanColor:[0,.498039215686,1],RGBPoints:[0,0,0,0,.4,.901960784314,0,0,.8,.901960784314,.901960784314,0,1,1,1,1]},{ColorSpace:"RGB",Name:"X Ray",NanColor:[1,0,0],RGBPoints:[0,1,1,1,1,0,0,0]},{ColorSpace:"RGB",Name:"Grayscale",NanColor:[1,0,0],RGBPoints:[0,0,0,0,1,1,1,1]},{ColorSpace:"RGB",Name:"BkRd",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,1,0,0]},{ColorSpace:"RGB",Name:"BkGn",NanColor:[1,0,1],RGBPoints:[0,0,0,0,1,0,1,0]},{ColorSpace:"RGB",Name:"BkBu",NanColor:[1,1,0],RGBPoints:[0,0,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"BkMa",NanColor:[0,1,0],RGBPoints:[0,0,0,0,1,1,0,1]},{ColorSpace:"RGB",Name:"BkCy",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,0,1,1]},{ColorSpace:"RGB",Name:"Black, Blue and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,0,0,.501960784314,.666,0,.501960784314,1,1,1,1,1]},{ColorSpace:"RGB",Name:"Black, Orange and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,.501960784314,0,0,.666,1,.501960784314,0,1,1,1,1]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear YGB 1211g",NanColor:[.25,0,0],RGBPoints:[0,1,.988235,.968627,.02,1,.952941,.878431,.05,.968627,.905882,.776471,.1,.94902,.898039,.647059,.15,.901961,.878431,.556863,.2,.847059,.858824,.482353,.25,.690196,.819608,.435294,.3,.513725,.768627,.384314,.35,.337255,.721569,.337255,.4,.278431,.658824,.392157,.45,.231373,.639216,.435294,.5,.203922,.6,.486275,.55,.172549,.568627,.537255,.6,.141176,.517647,.54902,.65,.133333,.458824,.541176,.7,.12549,.396078,.529412,.75,.117647,.321569,.521569,.8,.121569,.258824,.509804,.85,.133333,.227451,.501961,.9,.145098,.192157,.490196,.95,.188235,.164706,.470588,1,.258824,.196078,.439216]},{ColorSpace:"CIELAB",Creator:"Francesca Samsel",Name:"Linear Green (Gr4L)",NanColor:[.25,0,0],RGBPoints:[0,.054902,.109804,.121569,.05,.07451,.172549,.180392,.1,.086275,.231373,.219608,.15,.094118,.278431,.25098,.2,.109804,.34902,.278431,.25,.113725,.4,.278431,.3,.117647,.45098,.270588,.35,.117647,.490196,.243137,.4,.113725,.521569,.203922,.45,.109804,.54902,.152941,.5,.082353,.588235,.082353,.55,.109804,.631373,.05098,.6,.211765,.678431,.082353,.65,.317647,.721569,.113725,.7,.431373,.760784,.160784,.75,.556863,.8,.239216,.8,.666667,.839216,.294118,.85,.784314,.878431,.396078,.9,.886275,.921569,.533333,.95,.960784,.94902,.670588,1,1,.984314,.901961]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear Blue (8_31f)",NanColor:[.25,0,0],RGBPoints:[0,.960784,1,.980392,.05,.815686,.960784,.913725,.1,.670588,.929412,.870588,.15,.556863,.901961,.843137,.2,.478431,.870588,.823529,.25,.439216,.831373,.803922,.3,.4,.8,.788235,.35,.376471,.768627,.768627,.4,.34902,.709804,.729412,.45,.32549,.654902,.690196,.5,.301961,.607843,.658824,.55,.247059,.545098,.619608,.6,.239216,.494118,.580392,.65,.227451,.439216,.541176,.7,.227451,.403922,.521569,.75,.231373,.368627,.501961,.8,.227451,.321569,.470588,.85,.219608,.282353,.439216,.9,.192157,.235294,.4,.95,.160784,.184314,.34902,1,.133333,.12549,.301961]},{ColorSpace:"HSV",Name:"Blue to Red Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,0,0,1,1,1,0,0]},{ColorSpace:"HSV",Name:"Red to Blue Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,1,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended White",NanColor:[1,1,0],RGBPoints:[0,1,1,1,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Grey",NanColor:[1,1,0],RGBPoints:[0,.317647058824,.341176470588,.43137254902,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Black",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Blue to Yellow",NanColor:[1,0,0],RGBPoints:[0,.0392156862745,.0392156862745,.949019607843,1,.949019607843,.949019607843,.0392156862745]},{ColorSpace:"HSV",Name:"blot",RGBPoints:[0,0,0,1,.166,0,0,1,.167,1,0,1,.332,1,0,1,.333,0,1,1,.5,0,1,1,.501,0,1,0,.666,0,1,0,.667,1,1,0,.832,1,1,0,.833,1,0,0,1,1,0,0]},{ColorSpace:"Lab",Name:"CIELab Blue to Red",NanColor:[1,1,0],RGBPoints:[0,0,.6,.749019607843,1,.76862745098,.466666666667,.341176470588]},{ColorSpace:"RGB",Name:"jet",RGBPoints:[-1,0,0,.5625,-.777778,0,0,1,-.269841,0,1,1,-.015873,.5,1,.5,.238095,1,1,0,.746032,1,0,0,1,.5,0,0]},{ColorSpace:"RGB",Name:"rainbow",RGBPoints:[-1,0,0,1,-.5,0,1,1,0,0,1,0,.5,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"erdc_rainbow_bright",RGBPoints:[-1,.32549,.14902,.960784,-.866221,.297047,.375586,.963836,-.732441,.180302,.536818,.964627,-.598662,.1302,.649207,.929647,-.464883,.0445143,.749654,.855998,-.331104,.0271325,.830713,.721527,-.197324,.259504,.866145,.543555,-.0635452,.428364,.890725,.329819,.0702341,.568503,.898508,.187623,.204013,.738259,.890317,.0825461,.337793,.84546,.86136,.0147555,.471572,.912191,.808018,0,.605351,.962848,.710445,0,.73913,.999469,.600258,.0176284,.87291,.994156,.445975,.193912,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"erdc_rainbow_dark",RGBPoints:[-1,0,0,.423499,-.866221,0,.119346,.529237,-.732441,0,.238691,.634976,-.598662,0,.346852,.68788,-.464883,0,.45022,.718141,-.331104,0,.553554,.664839,-.197324,0,.651082,.519303,-.0635452,.115841,.72479,.352857,.0702341,.326771,.781195,.140187,.204013,.522765,.798524,.0284624,.337793,.703162,.788685,.00885756,.471572,.845118,.751133,0,.605351,.955734,.690825,0,.73913,.995402,.567916,.0618524,.87291,.987712,.403398,.164851,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"nic_CubicL",RGBPoints:[-1,.479965,.0118108,.5307,-.87451,.522213,.0551282,.706919,-.74902,.50839,.237278,.867764,-.623529,.451617,.373834,.987255,-.498039,.39365,.497255,.97506,-.372549,.328631,.599639,.891843,-.247059,.250043,.690286,.778553,-.121569,.249656,.764905,.645857,.00392157,.297954,.821466,.50449,.129412,.337509,.872595,.358447,.254902,.430011,.913789,.297079,.380392,.587191,.931381,.333353,.505882,.727937,.93591,.353742,.631373,.826403,.921081,.365066,.756863,.893201,.846317,.372662,.882353,.965347,.73884,.378506,1,.983235,.597451,.366856]},{ColorSpace:"Lab",Name:"nic_CubicYF",RGBPoints:[-1,.5151,.0482,.6697,-.87451,.520711,.168955,.800574,-.74902,.493694,.278596,.911824,-.623529,.440026,.369475,.984978,-.498039,.398932,.457593,.987053,-.372549,.350651,.540644,.929608,-.247059,.298827,.615625,.857729,-.121569,.239928,.685061,.769531,.00392157,.228832,.739349,.673287,.129412,.263297,.78608,.569988,.254902,.298107,.828337,.460214,.380392,.33092,.864071,.352674,.505882,.38306,.898169,.287309,.631373,.49023,.917481,.307961,.756863,.62372,.926026,.332309,.882353,.717458,.92527,.342476,1,.8,.9255,.3529]},{ColorSpace:"Lab",Name:"gist_earth",RGBPoints:[-1,0,0,0,-.87451,.239216,.027451,.415686,-.74902,.0901961,.254902,.556863,-.623529,.0941176,.352941,.54902,-.498039,.105882,.435294,.533333,-.372549,.12549,.52549,.501961,-.247059,.156863,.596078,.443137,-.121569,.196078,.65098,.380392,.00392157,.282353,.717647,.301961,.129412,.466667,.772549,.27451,.254902,.678431,.784314,.309804,.380392,.901961,.756863,.376471,.505882,.992157,.705882,.521569,.631373,1,.721569,.701961,.756863,1,.784314,.784314,.882353,1,.866667,.866667,1,1,1,1]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_red2yellow_BW",RGBPoints:[-1,754296e-12,0,109827e-10,-.87451,.18285,.0264094,0,-.74902,.3066,0,0,-.623529,.422841,0,0,-.498039,.522945,0,0,-.372549,.605721,0,0,-.247059,.672502,.14168,0,-.121569,.728167,.244025,0,.00392157,.781215,.333454,0,.129412,.825,.423586,0,.254902,.855893,.516793,0,.380392,.880491,.608846,0,.505882,.910305,.695505,0,.631373,.94109,.779067,.223528,.756863,.967873,.858572,.473521,.882353,.986815,.933211,.751583,1,1,1,.999997]},{ColorSpace:"Lab",Name:"erdc_marine2gold_BW",RGBPoints:[-1,111641e-12,0,162551e-11,-.87451,.0413146,.0619808,.209857,-.74902,.0185557,.101341,.350684,-.623529,.00486405,.149847,.461054,-.498039,.0836345,.210845,.517906,-.372549,.173222,.276134,.541793,-.247059,.259857,.343877,.535869,-.121569,.362299,.408124,.504293,.00392157,.468266,.468276,.468257,.129412,.582781,.527545,.374914,.254902,.691591,.585251,.274266,.380392,.784454,.645091,.247332,.505882,.862299,.710383,.27518,.631373,.920863,.782923,.351563,.756863,.955792,.859699,.533541,.882353,.976162,.93433,.780671,1,1,1,.999983]},{ColorSpace:"Lab",Name:"erdc_blue2gold_BW",RGBPoints:[-1,0,0,0,-.87451,.0742735,.0440331,.230013,-.74902,.125276,.0258685,.415826,-.623529,.143879,.0163031,.591346,-.498039,.212261,.0627855,.705239,-.372549,.306048,.141178,.763636,-.247059,.391537,.232286,.773263,-.121569,.461734,.336633,.708321,.00392157,.54209,.427581,.590007,.129412,.61704,.508623,.460978,.254902,.702703,.579586,.309117,.380392,.790336,.644811,.170397,.505882,.870173,.710733,.117134,.631373,.93656,.781991,.157144,.756863,.965672,.862068,.409836,.882353,.985751,.936296,.714162,1,1,1,.999999]},{ColorSpace:"Lab",Name:"erdc_sapphire2gold_BW",RGBPoints:[-1,.107704,.107708,.107694,-.87451,.1851,.112354,.308554,-.74902,.236782,.114233,.48788,-.623529,.28296,.126187,.639464,-.498039,.344787,.171643,.739713,-.372549,.413325,.242371,.76913,-.247059,.481863,.3131,.719841,-.121569,.550402,.383829,.612222,.00392157,.61894,.454558,.51126,.129412,.687478,.525287,.39993,.254902,.756017,.596016,.289923,.380392,.824555,.666745,.255498,.505882,.892979,.736822,.27696,.631373,.938851,.804966,.351734,.756863,.966491,.874853,.53572,.882353,.982105,.94153,.782579,1,1,1,.999986]},{ColorSpace:"Lab",Name:"erdc_red2purple_BW",RGBPoints:[-1,0,0,0,-.87451,.167793,.0166271,.0431278,-.74902,.262608,.0107595,.0791181,-.623529,.351902,.0101858,.100926,-.498039,.441257,.0160835,.131919,-.372549,.5221,.0555972,.195625,-.247059,.593852,.104294,.310234,-.121569,.654628,.158115,.448486,.00392157,.707443,.220914,.570253,.129412,.749504,.293268,.67897,.254902,.781587,.370517,.779269,.380392,.809951,.451099,.855831,.505882,.84424,.531462,.900451,.631373,.865174,.620901,.91606,.756863,.875041,.714054,.910284,.882353,.880764,.80554,.896276,1,.887572,.887591,.887556]},{ColorSpace:"Lab",Name:"erdc_purple2pink_BW",RGBPoints:[-1,0,0,0,-.87451,.117562,.0291202,.175876,-.74902,.178368,.0458476,.285454,-.623529,.237731,.0680173,.387717,-.498039,.300877,.0956291,.484802,-.372549,.370929,.136858,.554985,-.247059,.449033,.189273,.58863,-.121569,.529971,.245796,.598587,.00392157,.609914,.300643,.610244,.129412,.697079,.351286,.616371,.254902,.785858,.401991,.617376,.380392,.862517,.45745,.64463,.505882,.91359,.525462,.705336,.631373,.932583,.61064,.767412,.756863,.922478,.706966,.817522,.882353,.901302,.803071,.856311,1,.887571,.887591,.887549]},{ColorSpace:"Lab",Name:"erdc_pbj_lin",RGBPoints:[-1,0,0,0,-.87451,.091821,.0611476,.10617,-.74902,.160311,.0900022,.192713,-.623529,.22484,.12126,.272128,-.498039,.291263,.157469,.340828,-.372549,.360015,.200388,.388903,-.247059,.437497,.250058,.387201,-.121569,.512636,.304969,.355955,.00392157,.582603,.360874,.33488,.129412,.655126,.416374,.306351,.254902,.725889,.473329,.279051,.380392,.778125,.537928,.302697,.505882,.815894,.606931,.382431,.631373,.839159,.679308,.497608,.756863,.854748,.751666,.631792,.882353,.869483,.822508,.768592,1,.887572,.887589,.887565]},{ColorSpace:"Lab",Name:"erdc_blue2green_muted",RGBPoints:[-1,.107704,.107708,.107695,-.87451,.141522,.13066,.270741,-.74902,.180123,.146119,.42308,-.623529,.210161,.169674,.551795,-.498039,.239701,.212939,.634969,-.372549,.253916,.282947,.653641,-.247059,.242791,.366933,.608521,-.121569,.226302,.446776,.52693,.00392157,.236237,.514689,.458798,.129412,.274641,.577589,.376069,.254902,.349625,.633993,.288131,.380392,.4437,.683677,.260497,.505882,.536247,.731214,.285424,.631373,.628472,.777128,.349151,.756863,.718259,.819287,.496825,.882353,.804768,.856164,.703299,1,.887571,.887591,.887548]},{ColorSpace:"Lab",Name:"erdc_blue2green_BW",RGBPoints:[-1,363578e-12,0,529374e-11,-.87451,.0539915,.0577948,.212806,-.74902,.0620393,.0758942,.388959,-.623529,.0697499,.102032,.54177,-.498039,.113295,.156156,.64334,-.372549,.152047,.243196,.670283,-.247059,.158096,.344084,.622864,-.121569,.151142,.43922,.532767,.00392157,.17155,.521588,.457719,.129412,.225861,.599141,.363997,.254902,.32328,.67007,.259083,.380392,.442344,.733697,.223754,.505882,.558409,.794941,.257411,.631373,.673875,.854344,.340822,.756863,.787244,.909326,.524717,.882353,.896483,.958063,.775914,1,1,1,.999982]},{ColorSpace:"Lab",Name:"GREEN-WHITE_LINEAR",RGBPoints:[-1,0,0,0,-.87451,0,.062745,0,-.74902,0,.12549,0,-.623529,0,.188235,0,-.498039,0,.25098,0,-.372549,0,.313725,0,-.247059,0,.376471,0,-.121569,.094118,.439216,0,.00392157,.196078,.501961,0,.129412,.294118,.564706,0,.254902,.396078,.627451,0,.380392,.498039,.690196,0,.505882,.6,.752941,.145098,.631373,.701961,.815686,.364706,.756863,.8,.878431,.580392,.882353,.901961,.941176,.796078,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_green2yellow_BW",RGBPoints:[-1,0,0,0,-.87451,0,.105542,.0603919,-.74902,0,.159454,.104148,-.623529,0,.219502,.15542,-.498039,0,.282276,.203811,-.372549,0,.346331,.235652,-.247059,0,.411765,.235428,-.121569,0,.477177,.217977,.00392157,.0593644,.541635,.21361,.129412,.233081,.604722,.210591,.254902,.369803,.664942,.226536,.380392,.498446,.722367,.288237,.505882,.601929,.782244,.380815,.631373,.703207,.840497,.512134,.756863,.803186,.896433,.674462,.882353,.903834,.950266,.846715,1,1,1,.999981]},{ColorSpace:"Lab",Name:"blue2cyan",RGBPoints:[-1,0,0,0,-.87451,0,.152941,.364706,-.74902,0,.254902,.470588,-.623529,0,.34902,.572549,-.498039,0,.443137,.670588,-.372549,0,.537255,.772549,-.247059,0,.627451,.870588,-.121569,0,.717647,.964706,.00392157,.0784314,.772549,1,.129412,.207843,.858824,1,.254902,.32549,.941176,1,.380392,.45098,1,1,.505882,.560784,1,1,.631373,.662745,1,1,.756863,.760784,1,1,.882353,.870588,1,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_blue2cyan_BW",RGBPoints:[-1,405298e-12,0,59012e-10,-.87451,.0207526,.0740933,.18093,-.74902,0,.121033,.30343,-.623529,0,.166892,.416095,-.498039,0,.216768,.524796,-.372549,.0164769,.275471,.608585,-.247059,.0544527,.344824,.659267,-.121569,.0880643,.419118,.688675,.00392157,.127938,.492556,.720256,.129412,.149476,.566946,.756918,.254902,.188961,.641333,.792122,.380392,.245482,.715336,.827609,.505882,.329216,.786235,.874761,.631373,.453558,.852803,.918466,.756863,.626281,.910493,.954,.882353,.82257,.958709,.980146,1,1,1,.999989]},{ColorSpace:"Lab",Name:"erdc_blue_BW",RGBPoints:[-1,0,0,0,-.87451,.0425591,.0763529,.150682,-.74902,.0569472,.119154,.275403,-.623529,.0635978,.164772,.395427,-.498039,.0774342,.213851,.510014,-.372549,.106815,.267034,.615102,-.247059,.122093,.324649,.720068,-.121569,.160851,.387068,.806956,.00392157,.213754,.453516,.878012,.129412,.26722,.524656,.932436,.254902,.326844,.599279,.968038,.380392,.403403,.674712,.984784,.505882,.499703,.745519,1,.631373,.615055,.813983,1,.756863,.74405,.879228,1,.882353,.877909,.941913,1,1,1,1,.999996]},{ColorSpace:"Lab",Name:"BLUE-WHITE",RGBPoints:[-1,0,0,0,-.87451,0,0,.082353,-.74902,0,0,.168627,-.623529,0,0,.254902,-.498039,0,0,.337255,-.372549,0,0,.423529,-.247059,0,0,.509804,-.121569,0,.101961,.592157,.00392157,0,.203922,.678431,.129412,0,.301961,.764706,.254902,0,.403922,.85098,.380392,0,.505882,.933333,.505882,0,.603922,1,.631373,.254902,.705882,1,.756863,.509804,.807843,1,.882353,.764706,.905882,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_purple_BW",RGBPoints:[-1,4264e-11,0,620844e-12,-.87451,.100579,.0593111,.145666,-.74902,.167794,.0889224,.254953,-.623529,.231446,.123339,.360511,-.498039,.296699,.163027,.461278,-.372549,.363211,.209286,.55306,-.247059,.431136,.260776,.637195,-.121569,.498202,.320012,.705799,.00392157,.567456,.380459,.778091,.129412,.629381,.445284,.8448,.254902,.688373,.517374,.895694,.380392,.74891,.590906,.93976,.505882,.805017,.667956,.977626,.631373,.850914,.752618,.992396,.756863,.89724,.838454,.994093,.882353,.948461,.922603,.994449,1,1,1,.999967]},{ColorSpace:"Lab",Name:"erdc_magenta_BW",RGBPoints:[-1,0,0,254023e-10,-.87451,.128696,.0456782,.11635,-.74902,.228133,.0476299,.201452,-.623529,.327273,.0374065,.282107,-.498039,.420953,.0408166,.35709,-.372549,.511562,.0642203,.430511,-.247059,.599552,.102686,.504257,-.121569,.684646,.150536,.579429,.00392157,.765817,.205978,.656062,.129412,.839176,.27229,.731807,.254902,.89536,.357594,.797309,.380392,.930238,.457825,.846984,.505882,.945921,.564536,.880571,.631373,.948995,.670753,.902279,.756863,.947124,.772819,.918171,.882353,.947265,.869424,.934352,1,.954719,.95475,.954726]},{ColorSpace:"Lab",Name:"magenta",RGBPoints:[-1,0,0,0,-.87451,.364706,0,.152941,-.74902,.470588,0,.254902,-.623529,.572549,0,.34902,-.498039,.670588,0,.443137,-.372549,.772549,0,.537255,-.247059,.870588,0,.627451,-.121569,.964706,0,.717647,.00392157,1,.0784314,.772549,.129412,1,.207843,.858824,.254902,1,.32549,.941176,.380392,1,.45098,1,.505882,1,.560784,1,.631373,1,.662745,1,.756863,1,.760784,1,.882353,1,.870588,1,1,1,1,1]},{ColorSpace:"Lab",Name:"RED-PURPLE",RGBPoints:[-1,0,0,0,-.87451,.188235,0,.007843,-.74902,.345098,0,.035294,-.623529,.439216,0,.098039,-.498039,.533333,0,.152941,-.372549,.627451,.015686,.211765,-.247059,.721569,.031373,.266667,-.121569,.8,.047059,.329412,.00392157,.862745,.047059,.403922,.129412,.941176,.062745,.466667,.254902,.988235,.078431,.54902,.380392,.988235,.141176,.643137,.505882,.988235,.25098,.729412,.631373,.988235,.376471,.811765,.756863,.988235,.54902,.886275,.882353,.988235,.752941,.952941,1,.996078,.996078,.996078]},{ColorSpace:"Lab",Name:"erdc_red_BW",RGBPoints:[-1,0,0,0,-.87451,.147204,.0480135,.0401815,-.74902,.253411,.0617478,.0301333,-.623529,.356059,.0746331,.0446897,-.498039,.457731,.0934935,.0636931,-.372549,.557199,.122714,.0860013,-.247059,.665179,.144238,.105585,-.121569,.763833,.187056,.138326,.00392157,.847035,.254558,.189407,.129412,.905663,.345937,.258215,.254902,.941431,.447111,.346277,.380392,.962608,.546927,.457571,.505882,.987833,.637276,.569944,.631373,.994202,.732176,.687958,.756863,.993304,.826268,.800567,.882353,.994413,.917205,.906393,1,1,1,.999979]},{ColorSpace:"Lab",Name:"RED_TEMPERATURE",RGBPoints:[-1,0,0,0,-.87451,.090196,0,0,-.74902,.180392,0,0,-.623529,.270588,0,0,-.498039,.360784,0,0,-.372549,.45098,0,0,-.247059,.545098,0,0,-.121569,.635294,0,0,.00392157,.72549,.058824,0,.129412,.815686,.176471,0,.254902,.905882,.294118,0,.380392,1,.411765,0,.505882,1,.533333,.027451,.631373,1,.65098,.27451,.756863,1,.768627,.521569,.882353,1,.886275,.768627,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_orange_BW",RGBPoints:[-1,0,0,253806e-10,-.87451,.135871,.0593824,0,-.74902,.224328,.0907216,0,-.623529,.318083,.119647,0,-.498039,.414443,.150246,0,-.372549,.511077,.184884,0,-.247059,.605501,.226033,0,-.121569,.695274,.275491,0,.00392157,.777826,.334445,0,.129412,.851498,.402441,0,.254902,.915899,.47759,602975e-9,.380392,.971984,.557882,.0361443,.505882,1,.641287,.135967,.631373,1,.725198,.27997,.756863,1,.808205,.438135,.882353,1,.89306,.587036,1,1,.977928,.721599]},{ColorSpace:"Lab",Name:"heated_object",RGBPoints:[-1,0,0,0,-.87451,.34902,.0862745,0,-.74902,.45098,.172549,0,-.623529,.52549,.231373,0,-.498039,.580392,.278431,0,-.372549,.623529,.313725,0,-.247059,.670588,.352941,0,-.121569,.717647,.392157,0,.00392157,.772549,.439216,0,.129412,.839216,.494118,0,.254902,.901961,.541176,0,.380392,.968627,.6,0,.505882,1,.658824,0,.631373,1,.721569,0,.756863,1,.827451,.298039,.882353,1,.976471,.72549,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_gold_BW",RGBPoints:[-1,0,0,190933e-10,-.87451,.128363,.0636265,0,-.74902,.193795,.111057,0,-.623529,.25976,.15987,0,-.498039,.328546,.210589,0,-.372549,.399726,.26332,0,-.247059,.472969,.318261,0,-.121569,.546245,.375827,0,.00392157,.61745,.436719,0,.129412,.685545,.501113,0,.254902,.749578,.568799,0,.380392,.80962,.6394,0,.505882,.865572,.712699,.10257,.631373,.917709,.787569,.233665,.756863,.966914,.863138,.369608,.882353,1,.939405,.496104,1,.999225,1,.612275]},{ColorSpace:"Lab",Name:"erdc_brown_BW",RGBPoints:[-1,33216e-11,0,483629e-11,-.87451,.14693,.0518172,0,-.74902,.225806,.0814996,0,-.623529,.301681,.111452,0,-.498039,.370487,.150664,0,-.372549,.43108,.199477,0,-.247059,.4849,.255107,0,-.121569,.536798,.313486,0,.00392157,.59286,.371167,0,.129412,.653119,.428135,0,.254902,.714589,.485917,.0379541,.380392,.774667,.54565,.116634,.505882,.831222,.608047,.183895,.631373,.880305,.674199,.260298,.756863,.922314,.742472,.367086,.882353,.959408,.811222,.497258,1,.993548,.875183,.622093]},{ColorSpace:"Lab",Name:"copper_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0784314,.0501961,.0313725,-.74902,.156863,.100392,.0627451,-.623529,.235294,.150588,.0941176,-.498039,.313725,.200784,.12549,-.372549,.392157,.25098,.156863,-.247059,.470588,.301176,.188235,-.121569,.54902,.351373,.219608,.00392157,.627451,.401569,.25098,.129412,.705882,.451765,.282353,.254902,.784314,.501961,.313725,.380392,.862745,.552157,.345098,.505882,.941176,.602353,.376471,.631373,1,.652549,.407843,.756863,1,.702745,.439216,.882353,1,.752941,.470588,1,1,.8,.5]},{ColorSpace:"Lab",Name:"pink_Matlab",RGBPoints:[-1,0,0,0,-.87451,.312416,.204524,.204524,-.74902,.441822,.289241,.289241,-.623529,.54112,.354246,.354246,-.498039,.624831,.409048,.409048,-.372549,.698582,.45733,.45733,-.247059,.764404,.502282,.500979,-.121569,.791292,.591516,.54112,.00392157,.817297,.66895,.578481,.129412,.842499,.738308,.613572,.254902,.866968,.801687,.646762,.380392,.890766,.86041,.678329,.505882,.913944,.913944,.711254,.631373,.936549,.936549,.79459,.756863,.958621,.958621,.869979,.882353,.980196,.980196,.939336,1,1,1,1]},{ColorSpace:"Lab",Name:"bone_Matlab",RGBPoints:[-1,0,0,0,-.87451,.054902,.054902,.075817,-.74902,.109804,.109804,.151634,-.623529,.164706,.164706,.227451,-.498039,.219608,.219608,.303268,-.372549,.27451,.27451,.379085,-.247059,.329412,.329902,.454412,-.121569,.384314,.405719,.509314,.00392157,.439216,.481536,.564216,.129412,.494118,.557353,.619118,.254902,.54902,.63317,.67402,.380392,.603922,.708987,.728922,.505882,.660294,.783824,.783824,.631373,.746569,.838725,.838725,.756863,.832843,.893627,.893627,.882353,.919118,.948529,.948529,1,1,1,1]},{ColorSpace:"Lab",Name:"gray_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0627451,.0627451,.0627451,-.74902,.12549,.12549,.12549,-.623529,.188235,.188235,.188235,-.498039,.25098,.25098,.25098,-.372549,.313725,.313725,.313725,-.247059,.376471,.376471,.376471,-.121569,.439216,.439216,.439216,.00392157,.501961,.501961,.501961,.129412,.564706,.564706,.564706,.254902,.627451,.627451,.627451,.380392,.690196,.690196,.690196,.505882,.752941,.752941,.752941,.631373,.815686,.815686,.815686,.756863,.878431,.878431,.878431,.882353,.941176,.941176,.941176,1,1,1,1]},{ColorSpace:"Lab",Name:"Purples",RGBPoints:[-1,.247059,0,.490196,-.87451,.288397,.07677,.525629,-.74902,.32975,.153587,.561092,-.623529,.373057,.236263,.600461,-.498039,.416363,.319,.639923,-.372549,.459669,.405613,.685198,-.247059,.503345,.491534,.730058,-.121569,.562399,.54862,.757616,.00392157,.621453,.606075,.785544,.129412,.680508,.674971,.824914,.254902,.739562,.743406,.863899,.380392,.798616,.800492,.893426,.505882,.85684,.856655,.922491,.631373,.898178,.894056,.942176,.756863,.938654,.930919,.961646,.882353,.964245,.958478,.977393,1,.988235,.984314,.992157]},{ColorSpace:"Lab",Name:"Blues",RGBPoints:[-1,.031373,.188235,.419608,-.87451,.031373,.253195,.516063,-.74902,.031757,.318139,.612149,-.623529,.080969,.38113,.661361,-.498039,.130427,.444152,.710327,-.372549,.195386,.509112,.743791,-.247059,.260715,.573841,.777209,-.121569,.341423,.628958,.808704,.00392157,.422745,.684075,.839892,.129412,.523137,.739193,.861546,.254902,.622684,.793464,.883429,.380392,.701423,.826928,.910988,.505882,.778685,.8603,.937993,.631373,.825928,.891795,.953741,.756863,.87328,.923291,.969489,.882353,.922491,.954787,.985236,1,.968627,.984314,1]},{ColorSpace:"Lab",Name:"Greens",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546082,.271326,-.372549,.197232,.609073,.31857,-.247059,.257255,.671742,.365859,-.121569,.357647,.720953,.415071,.00392157,.45767,.769919,.465021,.129412,.546251,.811257,.537855,.254902,.634295,.852211,.610688,.380392,.709097,.883706,.683522,.505882,.78316,.914833,.755894,.631373,.842215,.938454,.818885,.756863,.899977,.961538,.880692,.882353,.935409,.975317,.92203,1,.968627,.988235,.960784]},{ColorSpace:"Lab",Name:"PuBu",RGBPoints:[-1,.301961,0,.294118,-.87451,.404321,.029527,.390573,-.74902,.50599,.059592,.486782,-.623529,.519769,.158016,.551742,-.498039,.533456,.256194,.616301,-.372549,.54133,.33887,.655671,-.247059,.54902,.421592,.695087,-.121569,.54902,.506236,.736424,.00392157,.550127,.590573,.777701,.129412,.585559,.665375,.81707,.254902,.622145,.739023,.855825,.380392,.687105,.784298,.879446,.505882,.752065,.829758,.903253,.631373,.817024,.87897,.930811,.756863,.880907,.927213,.957832,.882353,.926182,.958708,.975548,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"BuPu",RGBPoints:[-1,.007843,.219608,.345098,-.87451,.01178,.286536,.449427,-.74902,.015702,.35328,.553479,-.623529,.01767,.396586,.622376,-.498039,.021115,.4402,.690688,-.372549,.11757,.503191,.722184,-.247059,.214625,.565859,.753633,-.121569,.336671,.615071,.78316,.00392157,.457978,.663975,.812503,.129412,.556401,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821638,.903068,.631373,.873387,.864944,.92669,.756863,.927536,.907605,.949988,.882353,.964937,.9391,.967705,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGn",RGBPoints:[-1,.031373,.25098,.505882,-.87451,.031373,.329719,.590527,-.74902,.031911,.408397,.674787,-.623529,.100807,.479262,.710219,-.498039,.169704,.550219,.745744,-.372549,.238601,.62699,.787082,-.247059,.307958,.703114,.826759,-.121569,.39654,.752326,.797232,.00392157,.485121,.801046,.767705,.129412,.573702,.83451,.738178,.254902,.661592,.867743,.711034,.380392,.732457,.895302,.74253,.505882,.801845,.922307,.774579,.631373,.841215,.938055,.817885,.756863,.880907,.95391,.861084,.882353,.926182,.971626,.902422,1,.968627,.988235,.941176]},{ColorSpace:"Lab",Name:"GnBu",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546175,.272095,-.372549,.197232,.615071,.368551,-.247059,.256609,.683276,.464867,-.121569,.329443,.722645,.555417,.00392157,.403137,.762138,.645413,.129412,.503529,.805444,.718247,.254902,.603922,.848597,.790465,.380392,.704314,.887966,.847551,.505882,.802307,.926321,.903714,.631373,.851519,.944037,.941115,.756863,.899977,.961538,.976901,.882353,.935409,.975317,.984775,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"GnBuPu",RGBPoints:[-1,.003922,.27451,.211765,-.87451,.003922,.349312,.280661,-.74902,.003937,.423852,.349773,-.623529,.005905,.46519,.446228,-.498039,.009443,.506344,.542837,-.372549,.111803,.535871,.649135,-.247059,.214025,.565859,.753633,-.121569,.310481,.615071,.78316,.00392157,.407797,.663975,.812503,.129412,.531811,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821176,.902884,.631373,.873387,.854641,.922568,.756863,.927536,.888535,.942361,.882353,.964937,.929873,.964014,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGnYl",RGBPoints:[-1,.031373,.113725,.345098,-.87451,.088458,.159,.463206,-.74902,.145052,.204567,.5807,-.623529,.139146,.287243,.620069,-.498039,.13318,.370196,.659562,-.372549,.123337,.470588,.706805,-.247059,.115386,.570335,.753126,-.121569,.186251,.643168,.761,.00392157,.258716,.71514,.768074,.129412,.380761,.760415,.750358,.254902,.503576,.806075,.732795,.380392,.645306,.861192,.719016,.505882,.783899,.91511,.705606,.631373,.858701,.944637,.6997,.756863,.931349,.973303,.698424,.882353,.966782,.987082,.777163,1,1,1,.85098]},{ColorSpace:"Lab",Name:"PuRd",RGBPoints:[-1,.286275,0,.415686,-.87451,.38273,.001968,.441276,-.74902,.479231,.003922,.466774,-.623529,.581592,.003922,.480554,-.498039,.683799,.00549,.494887,-.372549,.776317,.105882,.544098,-.247059,.867866,.206321,.592618,-.121569,.919047,.308681,.612303,.00392157,.968812,.411226,.632603,.129412,.974717,.519493,.671972,.254902,.980546,.626451,.71065,.380392,.984483,.701253,.732303,.505882,.988328,.77504,.755617,.631373,.990296,.828189,.812703,.756863,.992372,.880907,.869035,.882353,.996309,.926182,.912341,1,1,.968627,.952941]},{ColorSpace:"Lab",Name:"RdPu",RGBPoints:[-1,.403922,0,.121569,-.87451,.500377,0,.192434,-.74902,.596909,277e-6,.263037,-.623529,.703206,.035709,.300438,-.498039,.808612,.071296,.338854,-.372549,.857824,.116571,.441215,-.247059,.905513,.163552,.54293,-.121569,.889765,.281661,.617732,.00392157,.873156,.39897,.691611,.129412,.82985,.491488,.736886,.254902,.789081,.583237,.781853,.380392,.810734,.656071,.819254,.505882,.833126,.729181,.85684,.631373,.870527,.80792,.898178,.756863,.907605,.884398,.938331,.882353,.9391,.921799,.958016,1,.968627,.956863,.976471]},{ColorSpace:"Lab",Name:"Oranges",RGBPoints:[-1,.498039,.152941,.015686,-.87451,.57481,.182468,.013718,-.74902,.651765,.212042,.011734,-.623529,.752157,.247474,.007797,-.498039,.851719,.283368,.004475,-.372549,.898962,.348328,.039908,-.247059,.945652,.413426,.076401,-.121569,.969273,.484291,.157109,.00392157,.992157,.554971,.238185,.129412,.992157,.619931,.330704,.254902,.992157,.684967,.423837,.380392,.992157,.751895,.532103,.505882,.992249,.817716,.639354,.631373,.994218,.861023,.725967,.756863,.996186,.903576,.810965,.882353,.998155,.933103,.868051,1,1,.960784,.921569]},{ColorSpace:"Lab",Name:"Reds",RGBPoints:[-1,.403922,0,.05098,-.87451,.525967,.029527,.066728,-.74902,.647643,.058962,.082476,-.623529,.722445,.076678,.098224,-.498039,.797186,.095194,.114187,-.372549,.868051,.164091,.143714,-.247059,.937809,.233541,.173933,-.121569,.96143,.326059,.232987,.00392157,.984375,.418147,.292657,.129412,.986344,.496886,.371396,.254902,.988235,.575702,.450673,.380392,.988235,.656409,.543191,.505882,.98842,.736747,.635894,.631373,.992357,.809581,.732349,.756863,.996186,.880692,.826759,.882353,.998155,.92203,.885813,1,1,.960784,.941176]},{ColorSpace:"Lab",Name:"RdOr",RGBPoints:[-1,.498039,0,0,-.87451,.6004,0,0,-.74902,.702514,738e-6,477e-6,-.623529,.773379,.095225,.061499,-.498039,.843875,.189865,.12283,-.372549,.891119,.294195,.203537,-.247059,.937855,.397924,.283137,-.121569,.963445,.476663,.316601,.00392157,.988297,.555771,.351665,.129412,.990265,.646321,.436309,.254902,.992157,.735256,.519646,.380392,.992157,.784468,.570827,.505882,.992249,.833218,.623483,.631373,.994218,.872587,.706159,.756863,.996186,.911419,.788189,.882353,.998155,.940946,.859054,1,1,.968627,.92549]},{ColorSpace:"Lab",Name:"BrOrYl",RGBPoints:[-1,.4,.145098,.023529,-.87451,.500392,.174625,.019592,-.74902,.600784,.204291,.015656,-.623529,.701176,.251534,.011719,-.498039,.800984,.299146,.008397,-.372549,.863975,.370012,.043829,-.247059,.926321,.441107,.0794,-.121569,.961753,.521815,.120738,.00392157,.996078,.602645,.163122,.129412,.996078,.68729,.237924,.254902,.996078,.771011,.314879,.380392,.996078,.832034,.444798,.505882,.996171,.892042,.572595,.631373,.998139,.931411,.65724,.756863,1,.969489,.741669,.882353,1,.985236,.822376,1,1,1,.898039]},{ColorSpace:"Lab",Name:"RdOrYl",RGBPoints:[-1,.501961,0,.14902,-.87451,.622038,0,.14902,-.74902,.741761,4e-4,.148866,-.623529,.816563,.05158,.129181,-.498039,.890965,.10356,.110235,-.372549,.940177,.205921,.137793,-.247059,.988281,.308789,.165536,-.121569,.99025,.432803,.200969,.00392157,.992218,.555217,.236278,.129412,.994187,.628051,.267774,.254902,.996078,.701038,.301269,.380392,.996078,.777809,.383945,.505882,.996171,.852826,.466621,.631373,.998139,.892195,.549296,.756863,1,.931349,.632188,.882353,1,.966782,.7188,1,1,1,.8]},{ColorSpace:"Lab",Name:"CIELab_blue2red",RGBPoints:[-1,0,.6,.74902,1,.76863,.46667,.34118]},{ColorSpace:"Lab",Name:"blue2yellow",RGBPoints:[-1,0,0,1,0,.5,.5,.5,1,1,1,0]},{ColorSpace:"Lab",Name:"erdc_blue2gold",RGBPoints:[-1,.175119,.0438468,1,-.874016,.22383,.159771,.94557,-.748031,.27254,.233611,.891216,-.622047,.321251,.296526,.836857,-.496063,.369962,.354296,.782359,-.370079,.418672,.409139,.72754,-.244094,.467383,.462152,.672148,-.11811,.51609,.51396,.615825,.00787402,.572863,.55452,.559172,.133858,.630269,.593822,.517729,.259843,.689588,.624668,.47446,.385827,.745394,.656113,.428638,.511811,.798624,.688104,.379105,.637795,.849926,.720593,.323834,.76378,.899765,.753543,.258657,.889764,.948487,.78692,.171778,1,.990413,.816451,.00729848]},{ColorSpace:"Lab",Name:"erdc_blue2yellow",RGBPoints:[-1,.0830122,0,.495617,-.87451,.141973,.0551288,.57363,-.74902,.193048,.110258,.604561,-.623529,.234231,.165386,.57643,-.498039,.275413,.220515,.548299,-.372549,.316596,.275644,.520169,-.247059,.357778,.330773,.492038,-.121569,.398961,.385901,.463908,.00392157,.449929,.438487,.426815,.129412,.511572,.488299,.379944,.254902,.581222,.53603,.325741,.380392,.650871,.583761,.271538,.505882,.720521,.631493,.217335,.631373,.79017,.679224,.163132,.756863,.85982,.726955,.108929,.882353,.910254,.774159,.14112,1,.927513,.81759,.306289]},{ColorSpace:"Lab",Name:"erdc_cyan2orange",RGBPoints:[-1,.0471513,.213874,.414329,-.87451,.0674702,.256648,.439027,-.74902,.0959957,.299331,.462089,-.623529,.132428,.341872,.483212,-.498039,.188743,.38277,.500597,-.372549,.268511,.420229,.512179,-.247059,.352945,.455602,.519101,-.121569,.43893,.489368,.521538,.00392157,.522445,.522495,.522436,.129412,.600089,.555682,.53205,.254902,.67988,.587981,.539163,.380392,.761011,.619586,.544439,.505882,.84278,.650741,.548567,.631373,.910713,.687347,.557822,.756863,.952232,.734972,.577775,.882353,.975642,.789858,.604868,1,.990752,.843643,.632857]},{ColorSpace:"Lab",Name:"erdc_purple2green",RGBPoints:[-1,.235006,.0483128,.530899,-.87451,.302968,.108419,.552391,-.74902,.360241,.166059,.569502,-.623529,.406746,.226782,.579373,-.498039,.444073,.28964,.582094,-.372549,.473648,.353774,.577947,-.247059,.497636,.418154,.567911,-.121569,.519086,.481741,.553968,.00392157,.542884,.542914,.542875,.129412,.566303,.603989,.527499,.254902,.595218,.662965,.516857,.380392,.628641,.720701,.510673,.505882,.665373,.777849,.508165,.631373,.704182,.834921,.508303,.756863,.743846,.892328,.50999,.882353,.783158,.950422,.512181,1,.818617,1,.513888]},{ColorSpace:"Lab",Name:"erdc_purple2green_dark",RGBPoints:[-1,.107656,0,.428682,-.87451,.1924,0,.449799,-.74902,.255118,.0648939,.466726,-.623529,.304256,.133066,.476703,-.498039,.343202,.19716,.479793,-.372549,.373876,.260353,.476241,-.247059,.398497,.322872,.466953,-.121569,.420016,.384252,.453785,.00392157,.44319,.443216,.443186,.129412,.465553,.502139,.428233,.254902,.492959,.559151,.417591,.380392,.524654,.615092,.411016,.505882,.55959,.670583,.40779,.631373,.596614,.726102,.406948,.756863,.634544,.782032,.407439,.882353,.672183,.838703,.408237,1,.706131,.892759,.408452]},{ColorSpace:"Lab",Name:"coolwarm",RGBPoints:[-1,.229806,.298718,.753683,-.875,.303869,.406535,.844959,-.75,.383013,.509419,.917388,-.625,.466667,.604563,.968155,-.5,.552953,.688929,.995376,-.375,.639176,.7596,.998151,-.25,.722193,.813953,.976575,-.125,.798692,.849786,.931689,0,.865395,.86541,.865396,.125,.924128,.827385,.774508,.25,.958853,.769768,.678008,.375,.969954,.694267,.579375,.5,.958003,.602842,.481776,.625,.923945,.497309,.38797,.75,.869187,.378313,.300267,.875,.795632,.241284,.220526,1,.705673,.0155562,.150233]},{ColorSpace:"Lab",Name:"BuRd",RGBPoints:[-1,.019608,.188235,.380392,-.87451,.088504,.321107,.564937,-.74902,.163399,.444983,.697501,-.623529,.247059,.555709,.754095,-.498039,.420684,.676432,.818685,-.372549,.606459,.789773,.880277,-.247059,.761476,.868512,.924567,-.121569,.878047,.925721,.951942,.00392157,.969089,.966474,.964937,.129412,.983852,.897578,.846828,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"Spectral_lowBlue",RGBPoints:[-1,.368627,.309804,.635294,-.87451,.260361,.450058,.70173,-.74902,.248058,.591311,.717186,-.623529,.376009,.734025,.658132,-.498039,.537947,.814764,.64506,-.372549,.702345,.879585,.636678,-.247059,.84752,.938639,.607151,-.121569,.940408,.976163,.656055,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.937793,.398539,.270127,.756863,.861515,.282891,.299654,.882353,.746482,.144637,.288812,1,.619608,.003922,.258824]},{ColorSpace:"Lab",Name:"GnRP",RGBPoints:[-1,0,.266667,.105882,-.87451,.066436,.394617,.174779,-.74902,.168858,.524567,.25767,-.623529,.323875,.657439,.361015,-.498039,.504883,.772318,.506344,-.372549,.678431,.870127,.654902,-.247059,.803922,.921799,.780392,-.121569,.897116,.951942,.882814,.00392157,.967397,.965936,.967474,.129412,.928028,.879815,.930565,.254902,.866052,.780777,.882891,.380392,.77501,.665129,.821376,.505882,.675663,.537024,.737024,.631373,.57847,.396155,.645982,.756863,.492349,.223914,.547559,.882353,.375548,.096886,.423299,1,.25098,0,.294118]},{ColorSpace:"Lab",Name:"GYPi",RGBPoints:[-1,.152941,.392157,.098039,-.87451,.246444,.505344,.117724,-.74902,.351942,.614533,.161399,-.623529,.474971,.717878,.240138,-.498039,.611995,.811226,.392849,-.372549,.746328,.893118,.565321,-.247059,.859516,.94233,.747405,-.121569,.928105,.96386,.875663,.00392157,.969089,.966859,.968012,.129412,.983852,.910265,.948328,.254902,.979239,.833218,.914648,.380392,.949712,.729873,.862976,.505882,.905652,.58293,.763552,.631373,.85521,.410073,.652211,.756863,.793695,.183699,.531642,.882353,.683737,.063899,.420761,1,.556863,.003922,.321569]},{ColorSpace:"Lab",Name:"GnYlRd",RGBPoints:[-1,0,.407843,.215686,-.87451,.063975,.525952,.277201,-.74902,.177932,.633064,.332718,-.623529,.364937,.724106,.379469,-.498039,.527951,.797155,.40223,-.372549,.678431,.862822,.433449,-.247059,.803922,.916955,.514648,-.121569,.909419,.961861,.625067,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.939023,.389927,.245521,.756863,.867666,.239831,.176624,.882353,.762399,.110727,.151326,1,.647059,0,.14902]},{ColorSpace:"Lab",Name:"GBBr",RGBPoints:[-1,0,.235294,.188235,-.87451,.002461,.338639,.301423,-.74902,.055902,.448981,.417609,-.623529,.183852,.56955,.538178,-.498039,.357785,.700115,.660746,-.372549,.540177,.819531,.77624,-.247059,.714879,.890888,.864821,-.121569,.851134,.934564,.922645,.00392157,.960861,.959785,.95694,.129412,.963322,.927797,.83391,.254902,.939946,.868897,.68935,.380392,.883353,.775394,.517109,.505882,.808074,.625836,.324106,.631373,.717647,.476355,.15494,.756863,.592157,.358247,.06882,.882353,.458593,.26436,.031142,1,.329412,.188235,.019608]},{ColorSpace:"Lab",Name:"PuOr",RGBPoints:[-1,.498039,.231373,.031373,-.87451,.62599,.30273,.026451,-.74902,.746943,.387082,.037524,-.623529,.85767,.490427,.071972,-.498039,.936409,.617762,.236371,-.372549,.992695,.743099,.43291,-.247059,.995156,.841523,.63714,-.121569,.985313,.913802,.813687,.00392157,.966244,.966398,.967705,.129412,.889965,.89504,.938178,.254902,.806151,.804306,.894656,.380392,.712649,.688658,.833141,.505882,.594233,.554325,.744637,.631373,.474894,.404229,.652364,.756863,.366628,.217224,.563783,.882353,.266436,.089965,.434833,1,.176471,0,.294118]},{ColorSpace:"Lab",Name:"PRGn",RGBPoints:[-1,.25098,0,.294118,-.87451,.383852,.103345,.431911,-.74902,.497732,.234679,.55371,-.623529,.583852,.40692,.652134,-.498039,.681968,.545175,.742561,-.372549,.7807,.672357,.825221,-.247059,.871742,.788005,.886736,-.121569,.930488,.885198,.932872,.00392157,.966321,.968089,.965859,.129412,.892503,.950865,.877278,.254902,.796078,.91857,.772549,.380392,.670588,.866897,.647059,.505882,.493195,.765398,.496655,.631373,.314187,.649135,.354556,.756863,.15917,.516263,.251211,.882353,.062284,.386621,.170473,1,0,.266667,.105882]},{ColorSpace:"Lab",Name:"PiYG",RGBPoints:[-1,.556863,.003922,.321569,-.87451,.692195,.067897,.427374,-.74902,.797539,.197847,.539177,-.623529,.859054,.424221,.659746,-.498039,.908574,.592618,.770319,-.372549,.951557,.736332,.866205,-.247059,.981084,.839677,.917878,-.121569,.98293,.913802,.949558,.00392157,.96732,.968474,.965629,.129412,.92549,.963552,.869666,.254902,.852441,.939254,.736025,.380392,.739254,.890042,.553941,.505882,.60323,.805536,.382238,.631373,.467282,.711419,.235217,.756863,.344252,.608074,.156478,.882353,.2406,.49827,.116494,1,.152941,.392157,.098039]},{ColorSpace:"Lab",Name:"OrPu",RGBPoints:[-1,.176471,0,.294118,-.87451,.272434,.095963,.444214,-.74902,.373395,.228912,.56932,-.623529,.481661,.415917,.657901,-.498039,.601922,.562937,.750481,-.372549,.718493,.695886,.836986,-.247059,.811995,.811534,.898501,-.121569,.894733,.8995,.940023,.00392157,.969166,.966859,.963629,.129412,.98639,.910265,.803691,.254902,.995002,.835371,.624375,.380392,.992541,.736947,.420146,.505882,.931949,.609458,.224221,.631373,.85075,.483968,.069819,.756863,.740023,.380623,.035371,.882353,.617993,.29827,.026759,1,.498039,.231373,.031373]},{ColorSpace:"Lab",Name:"BrBG",RGBPoints:[-1,.329412,.188235,.019608,-.87451,.467205,.269435,.031911,-.74902,.6,.365629,.074202,-.623529,.72549,.483737,.160323,-.498039,.812995,.635832,.336409,-.372549,.88689,.781238,.527874,-.247059,.943483,.87474,.700115,-.121569,.963168,.929796,.841599,.00392157,.957247,.959938,.959554,.129412,.84406,.932872,.920185,.254902,.70396,.886428,.859285,.380392,.529258,.815071,.770704,.505882,.346251,.691811,.653057,.631373,.175855,.562015,.530642,.756863,.047905,.441446,.410073,.882353,.002307,.33218,.294348,1,0,.235294,.188235]},{ColorSpace:"Lab",Name:"GyRd",RGBPoints:[-1,.101961,.101961,.101961,-.87451,.227451,.227451,.227451,-.74902,.359939,.359939,.359939,-.623529,.502653,.502653,.502653,-.498039,.631373,.631373,.631373,-.372549,.749865,.749865,.749865,-.247059,.843368,.843368,.843368,-.121569,.926105,.926105,.926105,.00392157,.999846,.997232,.995694,.129412,.994925,.908651,.857901,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen",RGBPoints:[-1,.297553,0,.489074,-.87451,.40259,.151146,.567754,-.74902,.516038,.284843,.658231,-.623529,.629783,.423646,.750938,-.498039,.735198,.563697,.835956,-.372549,.82408,.695541,.903582,-.247059,.889091,.807454,.944862,-.121569,.92334,.886917,.951839,.00392157,.921045,.921084,.921003,.129412,.877324,.907455,.845381,.254902,.797649,.849713,.734695,.380392,.691646,.75964,.600532,.505882,.568981,.649159,.453807,.631373,.438945,.529756,.304259,.756863,.30973,.412001,.158303,.882353,.187078,.305111,.00251458,1,.101655,.220836,0]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen_dim",RGBPoints:[-1,.404088,.131038,.592767,-.87451,.486469,.230957,.651243,-.74902,.575165,.339335,.717723,-.623529,.662741,.454332,.784263,-.498039,.742071,.570213,.842918,-.372549,.806935,.678992,.886227,-.247059,.852219,.771315,.90763,-.121569,.873345,.837327,.901572,.00392157,.866783,.86682,.866745,.129412,.82839,.858225,.796812,.254902,.762578,.814287,.700202,.380392,.676429,.744229,.585735,.505882,.577033,.65732,.461526,.631373,.47128,.562476,.33476,.756863,.365461,.467957,.21076,.882353,.264758,.381138,.0878313,1,.182591,.312249,0]},{ColorSpace:"Lab",Name:"erdc_divLow_icePeach",RGBPoints:[-1,.480048,.817441,.998056,-.87451,.425898,.726921,.883187,-.74902,.366682,.629445,.761936,-.623529,.308756,.531002,.640217,-.498039,.258021,.43705,.523433,-.372549,.219244,.352381,.416348,-.247059,.195127,.281032,.322979,-.121569,.186286,.22627,.246525,.00392157,.192352,.19236,.192364,.129412,.255927,.214469,.191756,.254902,.340459,.254426,.206666,.380392,.444655,.309315,.234029,.505882,.565353,.376004,.270969,.631373,.697917,.450748,.314293,.756863,.836657,.529064,.360227,.882353,.972695,.614884,.413123,1,1,.705904,.472699]},{ColorSpace:"Lab",Name:"erdc_divLow_purpleGreen",RGBPoints:[-1,.956034,.666487,.952663,-.87451,.874457,.572698,.936352,-.74902,.753465,.488253,.909063,-.623529,.63309,.413507,.763833,-.498039,.514491,.345878,.620015,-.372549,.405008,.288141,.484376,-.247059,.311388,.241986,.363556,-.121569,.238722,.209044,.263449,.00392157,.192352,.192366,.192362,.129412,.200379,.233201,.168618,.254902,.230151,.291737,.165227,.380392,.279481,.366076,.178607,.505882,.344927,.453267,.205703,.631373,.421554,.549449,.242643,.756863,.503334,.649999,.284377,.882353,.583497,.749672,.324969,1,.650705,.837228,.356264]},{ColorSpace:"Lab",Name:"Haze_green",RGBPoints:[-1,1,.835294,.886275,-.87451,.937255,.756863,.870443,-.74902,.875817,.666376,.857807,-.623529,.778359,.583007,.808134,-.498039,.676253,.494118,.745098,-.372549,.561365,.390123,.682353,-.247059,.438344,.262745,.621496,-.121569,.321133,.141031,.558751,.00392157,.203922,.0217865,.495861,.129412,.265505,.129412,.433261,.254902,.311692,.255338,.37008,.380392,.356282,.377342,.310821,.505882,.39971,.488889,.258243,.631373,.442556,.604357,.205519,.756863,.48671,.71968,.152941,.882353,.529847,.830356,.100944,1,.572549,.933333,.054902]},{ColorSpace:"Lab",Name:"Haze_lime",RGBPoints:[-1,.704034,.784196,1,-.87451,.633111,.691418,.956078,-.74902,.564021,.600606,.912157,-.623529,.496827,.51189,.868235,-.498039,.43157,.425416,.824314,-.372549,.368248,.341347,.780392,-.247059,.306767,.259855,.736471,-.121569,.246862,.181069,.692549,.00392157,.191619,.109542,.648627,.129412,.257404,.194031,.604706,.254902,.321794,.278775,.560784,.380392,.387909,.364617,.516863,.505882,.456569,.451881,.472941,.631373,.527424,.540773,.42902,.756863,.599759,.631427,.385098,.882353,.673065,.723898,.341176,1,.742751,.812252,.3]},{ColorSpace:"RGB",Name:"Haze",RGBPoints:[-1,1,.835294,.996078,-.00392157,.023529,.141176,.498039,.00392157,.015686,.137255,.494118,1,.984314,.764706,0]},{ColorSpace:"Lab",Name:"Haze_cyan",RGBPoints:[-1,.956863,1,.835294,-.87451,.933188,.921714,.760784,-.74902,.870588,.803486,.671605,-.623529,.807843,.684096,.583297,-.498039,.745098,.569208,.494118,-.372549,.682353,.437763,.390123,-.247059,.621496,.288163,.262745,-.121569,.558751,.144517,.141031,.00392157,.495861,.0217865,.0413943,.129412,.433261,.137255,.129412,.254902,.37008,.263181,.255338,.380392,.306318,.381845,.372694,.505882,.243137,.503994,.494263,.631373,.180392,.629484,.619753,.756863,.117647,.754975,.747131,.882353,.054902,.876398,.866812,1,0,.988235,.976471]},{ColorSpace:"Lab",Name:"nic_Edge",RGBPoints:[-1,.191208,.191208,.191208,-.87451,.239484,.00545035,.614821,-.74902,.220593,.0617459,.863547,-.623529,.17509,.278988,.97794,-.498039,.143526,.576069,.998553,-.372549,.166456,.871883,.96594,-.247059,.376202,.993555,.981833,-.121569,.681996,.991297,.999239,.00392157,.954172,.952734,.94374,.129412,.999735,.99301,.662896,.254902,.979399,.991466,.357973,.380392,.968771,.854967,.162659,.505882,.999245,.556697,.144323,.631373,.973959,.26223,.177946,.756863,.852358,.0526707,.222974,.882353,.593889,.00912724,.238855,1,.191208,.191208,.191208]},{ColorSpace:"Lab",Name:"erdc_iceFire_H",RGBPoints:[-1,405432e-12,0,590122e-11,-.87451,0,.120401,.302675,-.74902,0,.216583,.524574,-.623529,.0552475,.345025,.6595,-.498039,.128047,.492588,.720288,-.372549,.188955,.641309,.792092,-.247059,.327673,.784935,.873434,-.121569,.60824,.892164,.935547,.00392157,.881371,.912178,.818099,.129412,.951407,.835621,.449279,.254902,.904481,.690489,0,.380392,.85407,.510864,0,.505882,.777093,.33018,88199e-8,.631373,.672862,.139087,.00269398,.756863,.508815,0,0,.882353,.299417,366289e-9,547829e-9,1,.0157519,.00332021,455569e-13]},{ColorSpace:"Lab",Name:"erdc_iceFire_L",RGBPoints:[-1,.870485,.913768,.832905,-.87451,.586919,.887865,.934003,-.74902,.31583,.776442,.867858,-.623529,.18302,.632034,.787722,-.498039,.117909,.484134,.713825,-.372549,.0507239,.335979,.654741,-.247059,0,.209874,.511832,-.121569,0,.114689,.28935,.00392157,.0157519,.00332021,455569e-13,.129412,.312914,0,0,.254902,.520865,0,0,.380392,.680105,.15255,.0025996,.505882,.785109,.339479,797922e-9,.631373,.857354,.522494,0,.756863,.910974,.699774,0,.882353,.951921,.842817,.478545,1,.881371,.912178,.818099]},{ColorSpace:"RGB",Name:"hsv",RGBPoints:[-1,1,0,0,-.666666,1,0,1,-.333333,0,0,1,0,0,1,1,.33333,0,1,0,.66666,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"hue_L60",RGBPoints:[-1,.964784,.400592,.349549,-.87451,.964915,.372498,.53785,-.74902,.892353,.401039,.759569,-.623529,.79263,.446956,.903017,-.498039,.682208,.49954,.966673,-.372549,.56392,.553082,.968836,-.247059,.442031,.606396,.901601,-.121569,.305499,.65701,.765784,.00392157,.197251,.687914,.620914,.129412,.193882,.701887,.472654,.254902,.249866,.706123,.320005,.380392,.35132,.697417,.202919,.505882,.498097,.669467,.125232,.631373,.637477,.626239,.107431,.756863,.762115,.56872,.155812,.882353,.889434,.481116,.240445,1,.964784,.400592,.349549]},{IndexedColors:[0,0,0,.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,.6509803921568628,.3372549019607843,.1568627450980392],Name:"Spectrum",NanColor:[.6509803921568628,.3372549019607843,.1568627450980392]},{IndexedColors:[.4745098039215686,.09019607843137255,.09019607843137255,.7098039215686275,.00392156862745098,.00392156862745098,.9372549019607843,.2784313725490196,.09803921568627451,.9764705882352941,.5137254901960784,.1411764705882353,1,.7058823529411765,0,1,.8980392156862745,.02352941176470588],Name:"Warm",NanColor:[1,.8980392156862745,.02352941176470588]},{IndexedColors:[.4588235294117647,.6941176470588235,.00392156862745098,.3450980392156863,.5019607843137255,.1607843137254902,.3137254901960784,.8431372549019608,.7490196078431373,.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.6039215686274509,.407843137254902,1,.3725490196078431,.2,.5019607843137255],Name:"Cool",NanColor:[.3725490196078431,.2,.5019607843137255]},{IndexedColors:[.2313725490196079,.407843137254902,.6705882352941176,.1098039215686274,.5843137254901961,.803921568627451,.3058823529411765,.8509803921568627,.9176470588235294,.4509803921568628,.6039215686274509,.8352941176470589,.2588235294117647,.2392156862745098,.6627450980392157,.3137254901960784,.3294117647058823,.5294117647058824,.06274509803921569,.1647058823529412,.3215686274509804],Name:"Blues",NanColor:[.06274509803921569,.1647058823529412,.3215686274509804]},{IndexedColors:[.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.4,.2431372549019608,.7176470588235294,.6352941176470588,.3294117647058823,.8117647058823529,.8705882352941177,.3803921568627451,.807843137254902,.8627450980392157,.3803921568627451,.5843137254901961,.2392156862745098,.06274509803921569,.3215686274509804],Name:"Wild Flower",NanColor:[.2392156862745098,.06274509803921569,.3215686274509804]},{IndexedColors:[.396078431372549,.4862745098039216,.2156862745098039,.4588235294117647,.6941176470588235,.00392156862745098,.6980392156862745,.7294117647058823,.1882352941176471,1,.8980392156862745,.02352941176470588,1,.7058823529411765,0,.9764705882352941,.5137254901960784,.1411764705882353],Name:"Citrus",NanColor:[.9764705882352941,.5137254901960784,.1411764705882353]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (11)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (10)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (9)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (8)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (7)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (6)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.9686274509803922,.9686274509803922,.9686274509803922,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (5)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (4)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9450980392156862,.6392156862745098,.2509803921568627,.9686274509803922,.9686274509803922,.9686274509803922,.6,.5568627450980392,.7647058823529411],Name:"Brewer Diverging Purple-Orange (3)",NanColor:[.6,.5568627450980392,.7647058823529411]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (11)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (10)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (9)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (8)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (7)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (6)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,1,1,.7490196078431373,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (5)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (4)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.9882352941176471,.5529411764705883,.3490196078431372,1,1,.7490196078431373,.6,.8352941176470589,.5803921568627451],Name:"Brewer Diverging Spectral (3)",NanColor:[.6,.8352941176470589,.5803921568627451]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (11)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (10)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (9)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (8)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (7)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (6)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.9607843137254902,.9607843137254902,.9607843137254902,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (5)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (4)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.8470588235294118,.7019607843137254,.396078431372549,.9607843137254902,.9607843137254902,.9607843137254902,.3529411764705883,.7058823529411765,.6745098039215687],Name:"Brewer Diverging Brown-Blue-Green (3)",NanColor:[.3529411764705883,.7058823529411765,.6745098039215687]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.4274509803921568,.1725490196078431,0,.2666666666666667,.1058823529411765],Name:"Brewer Sequential Blue-Green (9)",NanColor:[0,.2666666666666667,.1058823529411765]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (8)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.8,.9254901960784314,.9019607843137255,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (7)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (6)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (5)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1372549019607843,.5450980392156862,.2705882352941176],Name:"Brewer Sequential Blue-Green (4)",NanColor:[.1372549019607843,.5450980392156862,.2705882352941176]},{IndexedColors:[.8980392156862745,.9607843137254902,.9764705882352941,.6,.8470588235294118,.788235294117647,.1725490196078431,.6352941176470588,.3725490196078431],Name:"Brewer Sequential Blue-Green (3)",NanColor:[.1725490196078431,.6352941176470588,.3725490196078431]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.6,.203921568627451,.01568627450980392,.4,.1450980392156863,.02352941176470588],Name:"Brewer Sequential Yellow-Orange-Brown (9)",NanColor:[.4,.1450980392156863,.02352941176470588]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (8)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (7)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (6)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (5)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8,.2980392156862745,.00784313725490196],Name:"Brewer Sequential Yellow-Orange-Brown (4)",NanColor:[.8,.2980392156862745,.00784313725490196]},{IndexedColors:[1,.9686274509803922,.7372549019607844,.996078431372549,.7686274509803922,.3098039215686275,.8509803921568627,.3725490196078431,.05490196078431372],Name:"Brewer Sequential Yellow-Orange-Brown (3)",NanColor:[.8509803921568627,.3725490196078431,.05490196078431372]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.5058823529411764,.05882352941176471,.4862745098039216,.3019607843137255,0,.2941176470588235],Name:"Brewer Sequential Blue-Purple (9)",NanColor:[.3019607843137255,0,.2941176470588235]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (8)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (7)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (6)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (5)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.2549019607843137,.615686274509804],Name:"Brewer Sequential Blue-Purple (4)",NanColor:[.5333333333333333,.2549019607843137,.615686274509804]},{IndexedColors:[.8784313725490196,.9254901960784314,.9568627450980393,.6196078431372549,.7372549019607844,.8549019607843137,.5333333333333333,.3372549019607843,.6549019607843137],Name:"Brewer Sequential Blue-Purple (3)",NanColor:[.5333333333333333,.3372549019607843,.6549019607843137]},{IndexedColors:[.4980392156862745,.788235294117647,.4980392156862745,.7450980392156863,.6823529411764706,.8313725490196079,.9921568627450981,.7529411764705882,.5254901960784314,1,1,.6,.2196078431372549,.4235294117647059,.6901960784313725,.9411764705882353,.00784313725490196,.4980392156862745,.7490196078431373,.3568627450980392,.09019607843137255,.4,.4,.4],Name:"Brewer Qualitative Accent",NanColor:[.4,.4,.4]},{IndexedColors:[.1058823529411765,.6196078431372549,.4666666666666667,.8509803921568627,.3725490196078431,.00784313725490196,.4588235294117647,.4392156862745098,.7019607843137254,.9058823529411765,.1607843137254902,.5411764705882353,.4,.6509803921568628,.1176470588235294,.9019607843137255,.6705882352941176,.00784313725490196,.6509803921568628,.4627450980392157,.1137254901960784,.4,.4,.4],Name:"Brewer Qualitative Dark2",NanColor:[.4,.4,.4]},{IndexedColors:[.4,.7607843137254902,.6470588235294118,.9882352941176471,.5529411764705883,.3843137254901961,.5529411764705883,.6274509803921569,.796078431372549,.9058823529411765,.5411764705882353,.7647058823529411,.6509803921568628,.8470588235294118,.3294117647058823,1,.8509803921568627,.1843137254901961,.8980392156862745,.7686274509803922,.5803921568627451,.7019607843137254,.7019607843137254,.7019607843137254],Name:"Brewer Qualitative Set2",NanColor:[.7019607843137254,.7019607843137254,.7019607843137254]},{IndexedColors:[.7019607843137254,.8862745098039215,.803921568627451,.9921568627450981,.803921568627451,.6745098039215687,.796078431372549,.8352941176470589,.9098039215686274,.9568627450980393,.792156862745098,.8941176470588236,.9019607843137255,.9607843137254902,.788235294117647,1,.9490196078431372,.6823529411764706,.9450980392156862,.8862745098039215,.8,.8,.8,.8],Name:"Brewer Qualitative Pastel2",NanColor:[.8,.8,.8]},{IndexedColors:[.984313725490196,.7058823529411765,.6823529411764706,.7019607843137254,.803921568627451,.8901960784313725,.8,.9215686274509803,.7725490196078432,.8705882352941177,.796078431372549,.8941176470588236,.996078431372549,.8509803921568627,.6509803921568628,1,1,.8,.8980392156862745,.8470588235294118,.7411764705882353,.9921568627450981,.8549019607843137,.9254901960784314,.9490196078431372,.9490196078431372,.9490196078431372],Name:"Brewer Qualitative Pastel1",NanColor:[.9490196078431372,.9490196078431372,.9490196078431372]},{IndexedColors:[.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,1,1,.2,.6509803921568628,.3372549019607843,.1568627450980392,.9686274509803922,.5058823529411764,.7490196078431373,.6,.6,.6],Name:"Brewer Qualitative Set1",NanColor:[.6,.6,.6]},{IndexedColors:[.6509803921568628,.807843137254902,.8901960784313725,.1215686274509804,.4705882352941176,.7058823529411765,.6980392156862745,.8745098039215686,.5411764705882353,.2,.6274509803921569,.1725490196078431,.984313725490196,.6039215686274509,.6,.8901960784313725,.1019607843137255,.1098039215686274,.9921568627450981,.7490196078431373,.4352941176470588,1,.4980392156862745,0,.792156862745098,.6980392156862745,.8392156862745098,.4156862745098039,.2392156862745098,.6039215686274509,1,1,.6],Name:"Brewer Qualitative Paired",NanColor:[1,1,.6]},{IndexedColors:[.5529411764705883,.8274509803921568,.7803921568627451,1,1,.7019607843137254,.7450980392156863,.7294117647058823,.8549019607843137,.984313725490196,.5019607843137255,.4470588235294118,.5019607843137255,.6941176470588235,.8274509803921568,.9921568627450981,.7058823529411765,.3843137254901961,.7019607843137254,.8705882352941177,.4117647058823529,.9882352941176471,.803921568627451,.8980392156862745,.8509803921568627,.8509803921568627,.8509803921568627,.7372549019607844,.5019607843137255,.7411764705882353,.8,.9215686274509803,.7725490196078432,1,.9294117647058824,.4352941176470588],Name:"Brewer Qualitative Set3",NanColor:[1,.9294117647058824,.4352941176470588]},{IndexedColors:[1,0,0,1,.862745,0,0,.695201,0],Name:"Traffic Lights",NanColor:[.803922,0,.803922]},{IndexedColors:[.908659,.604013,.581857,1,.862745,0,0,.695201,0],Name:"Traffic Lights For Deuteranopes",NanColor:[.803922,0,.803922]},{IndexedColors:[.4196078431372549,0,.07058823529411765,.9019607843137255,.9411764705882353,.0196078431372549,.01568627450980392,.6196078431372549,.00784313725490196],Name:"Traffic Lights For Deuteranopes 2",NanColor:[.803922,0,.803922]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Muted Blue-Green",NanColor:[.25,0,0],RGBPoints:[0,.109804,.27451,.301961,.02,.129412,.309804,.341176,.05,.14902,.341176,.380392,.1,.188235,.403922,.458824,.15,.227451,.447059,.521569,.2,.290196,.494118,.588235,.25,.368627,.552941,.670588,.3,.458824,.619608,.74902,.35,.588235,.713725,.85098,.4,.72549,.815686,.941176,.45,.831373,.882353,.980392,.475,.909804,.933333,1,.5,.980392,.984314,1,.5,.996078,1,.94902,.5,1,1,.980392,.5,.980392,.984314,1,.525,.972549,.988235,.890196,.55,.917647,.960784,.835294,.6,.835294,.921569,.772549,.65,.768627,.901961,.737255,.7,.670588,.831373,.654902,.75,.576471,.760784,.584314,.8,.498039,.678431,.521569,.85,.392157,.560784,.427451,.9,.294118,.45098,.333333,.95,.211765,.34902,.254902,1,.152941,.278431,.196078]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Green-Blue Asymmetric Divergent (62Blbc)",NanColor:[.25,0,0],RGBPoints:[0,.121569,.2,.145098,.05,.196078,.301961,.223529,.1,.258824,.4,.278431,.2,.341176,.54902,.341176,.25,.419608,.619608,.376471,.3,.545098,.701961,.392157,.35,.643137,.780392,.403922,.4,.729412,.819608,.45098,.45,.811765,.870588,.521569,.5,.898039,.909804,.564706,.55,.941176,.92549,.686275,.6,.960784,.94902,.776471,.64,1,1,1,.65,.890196,.988235,.972549,.7,.721569,.894118,.901961,.75,.631373,.823529,.839216,.8,.517647,.662745,.701961,.85,.384314,.494118,.54902,.9,.298039,.360784,.45098,.95,.223529,.25098,.34902,.99,.156863,.172549,.25098,1,.137255,.137255,.188235]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Asymmtrical Earth Tones (6_21b)",NanColor:[.25,0,0],RGBPoints:[0,.141176,.14902,.2,.05,.215686,.258824,.321569,.1,.243137,.368627,.380392,.15,.27451,.439216,.4,.2,.32549,.501961,.384314,.25,.403922,.6,.419608,.3,.486275,.701961,.454902,.35,.556863,.74902,.494118,.4,.670588,.8,.545098,.5,.854902,.901961,.631373,.55,.92549,.941176,.694118,.6,.960784,.94902,.776471,.65,.988235,.968627,.909804,.7,.839216,.815686,.772549,.75,.701961,.662745,.615686,.8,.6,.529412,.478431,.85,.501961,.403922,.360784,.9,.439216,.313725,.290196,1,.301961,.164706,.176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Yellow 15",NanColor:[.25,0,0],RGBPoints:[0,1,1,.988235,.002,1,1,.988235,.05,.984314,.988235,.843137,.1,.988235,.988235,.741176,.15,.980392,.968627,.654902,.2,.980392,.945098,.576471,.25,.968627,.905882,.486275,.3,.968627,.862745,.388235,.35,.960784,.803922,.286275,.4,.94902,.741176,.219608,.45,.941176,.678431,.14902,.5,.929412,.607843,.094118,.55,.921569,.545098,.054902,.6,.909804,.486275,.035294,.65,.890196,.411765,.019608,.7,.8,.305882,0,.75,.760784,.239216,0,.8,.678431,.180392,.011765,.85,.6,.121569,.023529,.9,.501961,.054902,.031373,.95,.4,.039216,.058824,1,.301961,.047059,.090196]},{ColorSpace:"Diverging",Name:"Magma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002258,.001295,.018331,.007843,.003279,.002305,.023708,.011765,.004512,.00349,.029965,.015686,.00595,.004843,.03713,.019608,.007588,.006356,.044973,.023529,.009426,.008022,.052844,.027451,.011465,.009828,.06075,.031373,.013708,.011771,.068667,.035294,.016156,.01384,.076603,.039216,.018815,.016026,.084584,.043137,.021692,.01832,.09261,.047059,.024792,.020715,.100676,.05098,.028123,.023201,.108787,.054902,.031696,.025765,.116965,.058824,.03552,.028397,.125209,.062745,.039608,.03109,.133515,.066667,.04383,.03383,.141886,.070588,.048062,.036607,.150327,.07451,.05232,.039407,.158841,.078431,.056615,.04216,.167446,.082353,.060949,.044794,.176129,.086275,.06533,.047318,.184892,.090196,.069764,.049726,.193735,.094118,.074257,.052017,.20266,.098039,.078815,.054184,.211667,.101961,.083446,.056225,.220755,.105882,.088155,.058133,.229922,.109804,.092949,.059904,.239164,.113725,.097833,.061531,.248477,.117647,.102815,.06301,.257854,.121569,.107899,.064335,.267289,.12549,.113094,.065492,.276784,.129412,.118405,.066479,.286321,.133333,.123833,.067295,.295879,.137255,.12938,.067935,.305443,.141176,.135053,.068391,.315,.145098,.140858,.068654,.324538,.14902,.146785,.068738,.334011,.152941,.152839,.068637,.343404,.156863,.159018,.068354,.352688,.160784,.165308,.067911,.361816,.164706,.171713,.067305,.370771,.168627,.178212,.066576,.379497,.172549,.184801,.065732,.387973,.176471,.19146,.064818,.396152,.180392,.198177,.063862,.404009,.184314,.204935,.062907,.411514,.188235,.211718,.061992,.418647,.192157,.218512,.061158,.425392,.196078,.225302,.060445,.431742,.2,.232077,.059889,.437695,.203922,.238826,.059517,.443256,.207843,.245543,.059352,.448436,.211765,.25222,.059415,.453248,.215686,.258857,.059706,.45771,.219608,.265447,.060237,.46184,.223529,.271994,.060994,.46566,.227451,.278493,.061978,.46919,.231373,.284951,.063168,.472451,.235294,.291366,.064553,.475462,.239216,.29774,.066117,.478243,.243137,.304081,.067835,.480812,.247059,.310382,.069702,.483186,.25098,.316654,.07169,.48538,.254902,.322899,.073782,.487408,.258824,.329114,.075972,.489287,.262745,.335308,.078236,.491024,.266667,.341482,.080564,.492631,.270588,.347636,.082946,.494121,.27451,.353773,.085373,.495501,.278431,.359898,.087831,.496778,.282353,.366012,.090314,.49796,.286275,.372116,.092816,.499053,.290196,.378211,.095332,.500067,.294118,.384299,.097855,.501002,.298039,.390384,.100379,.501864,.301961,.396467,.102902,.502658,.305882,.402548,.10542,.503386,.309804,.408629,.10793,.504052,.313725,.414709,.110431,.504662,.317647,.420791,.11292,.505215,.321569,.426877,.115395,.505714,.32549,.432967,.117855,.50616,.329412,.439062,.120298,.506555,.333333,.445163,.122724,.506901,.337255,.451271,.125132,.507198,.341176,.457386,.127522,.507448,.345098,.463508,.129893,.507652,.34902,.46964,.132245,.507809,.352941,.47578,.134577,.507921,.356863,.481929,.136891,.507989,.360784,.488088,.139186,.508011,.364706,.494258,.141462,.507988,.368627,.500438,.143719,.50792,.372549,.506629,.145958,.507806,.376471,.512831,.148179,.507648,.380392,.519045,.150383,.507443,.384314,.52527,.152569,.507192,.388235,.531507,.154739,.506895,.392157,.537755,.156894,.506551,.396078,.544015,.159033,.506159,.4,.550287,.161158,.505719,.403922,.556571,.163269,.50523,.407843,.562866,.165368,.504692,.411765,.569172,.167454,.504105,.415686,.57549,.16953,.503466,.419608,.581819,.171596,.502777,.423529,.588158,.173652,.502035,.427451,.594508,.175701,.501241,.431373,.600868,.177743,.500394,.435294,.607238,.179779,.499492,.439216,.613617,.181811,.498536,.443137,.620005,.18384,.497524,.447059,.626401,.185867,.496456,.45098,.632805,.187893,.495332,.454902,.639216,.189921,.49415,.458824,.645633,.191952,.49291,.462745,.652056,.193986,.491611,.466667,.658483,.196027,.490253,.470588,.664915,.198075,.488836,.47451,.671349,.200133,.487358,.478431,.677786,.202203,.485819,.482353,.684224,.204286,.484219,.486275,.690661,.206384,.482558,.490196,.697098,.208501,.480835,.494118,.703532,.210638,.479049,.498039,.709962,.212797,.477201,.501961,.716387,.214982,.47529,.505882,.722805,.217194,.473316,.509804,.729216,.219437,.471279,.513725,.735616,.221713,.46918,.517647,.742004,.224025,.467018,.521569,.748378,.226377,.464794,.52549,.754737,.228772,.462509,.529412,.761077,.231214,.460162,.533333,.767398,.233705,.457755,.537255,.773695,.236249,.455289,.541176,.779968,.238851,.452765,.545098,.786212,.241514,.450184,.54902,.792427,.244242,.447543,.552941,.798608,.24704,.444848,.556863,.804752,.249911,.442102,.560784,.810855,.252861,.439305,.564706,.816914,.255895,.436461,.568627,.822926,.259016,.433573,.572549,.828886,.262229,.430644,.576471,.834791,.26554,.427671,.580392,.840636,.268953,.424666,.584314,.846416,.272473,.421631,.588235,.852126,.276106,.418573,.592157,.857763,.279857,.415496,.596078,.86332,.283729,.412403,.6,.868793,.287728,.409303,.603922,.874176,.291859,.406205,.607843,.879464,.296125,.403118,.611765,.884651,.30053,.400047,.615686,.889731,.305079,.397002,.619608,.8947,.309773,.393995,.623529,.899552,.314616,.391037,.627451,.904281,.31961,.388137,.631373,.908884,.324755,.385308,.635294,.913354,.330052,.382563,.639216,.917689,.3355,.379915,.643137,.921884,.341098,.377376,.647059,.925937,.346844,.374959,.65098,.929845,.352734,.372677,.654902,.933606,.358764,.370541,.658824,.937221,.364929,.368567,.662745,.940687,.371224,.366762,.666667,.944006,.377643,.365136,.670588,.94718,.384178,.363701,.67451,.95021,.39082,.362468,.678431,.953099,.397563,.361438,.682353,.955849,.4044,.360619,.686275,.958464,.411324,.360014,.690196,.960949,.418323,.35963,.694118,.96331,.42539,.359469,.698039,.965549,.432519,.359529,.701961,.967671,.439703,.35981,.705882,.96968,.446936,.360311,.709804,.971582,.45421,.36103,.713725,.973381,.46152,.361965,.717647,.975082,.468861,.363111,.721569,.97669,.476226,.364466,.72549,.97821,.483612,.366025,.729412,.979645,.491014,.367783,.733333,.981,.498428,.369734,.737255,.982279,.505851,.371874,.741176,.983485,.51328,.374198,.745098,.984622,.520713,.376698,.74902,.985693,.528148,.379371,.752941,.9867,.535582,.38221,.756863,.987646,.543015,.38521,.760784,.988533,.550446,.388365,.764706,.989363,.557873,.391671,.768627,.990138,.565296,.395122,.772549,.990871,.572706,.398714,.776471,.991558,.580107,.402441,.780392,.992196,.587502,.406299,.784314,.992785,.594891,.410283,.788235,.993326,.602275,.41439,.792157,.993834,.609644,.418613,.796078,.994309,.616999,.42295,.8,.994738,.62435,.427397,.803922,.995122,.631696,.431951,.807843,.99548,.639027,.436607,.811765,.99581,.646344,.441361,.815686,.996096,.653659,.446213,.819608,.996341,.660969,.45116,.823529,.99658,.668256,.456192,.827451,.996775,.675541,.461314,.831373,.996925,.682828,.466526,.835294,.997077,.690088,.471811,.839216,.997186,.697349,.477182,.843137,.997254,.704611,.482635,.847059,.997325,.711848,.488154,.85098,.997351,.719089,.493755,.854902,.997351,.726324,.499428,.858824,.997341,.733545,.505167,.862745,.997285,.740772,.510983,.866667,.997228,.747981,.516859,.870588,.997138,.75519,.522806,.87451,.997019,.762398,.528821,.878431,.996898,.769591,.534892,.882353,.996727,.776795,.541039,.886275,.996571,.783977,.547233,.890196,.996369,.791167,.553499,.894118,.996162,.798348,.55982,.898039,.995932,.805527,.566202,.901961,.99568,.812706,.572645,.905882,.995424,.819875,.57914,.909804,.995131,.827052,.585701,.913725,.994851,.834213,.592307,.917647,.994524,.841387,.598983,.921569,.994222,.84854,.605696,.92549,.993866,.855711,.612482,.929412,.993545,.862859,.619299,.933333,.99317,.870024,.626189,.937255,.992831,.877168,.633109,.941176,.99244,.88433,.640099,.945098,.992089,.89147,.647116,.94902,.991688,.898627,.654202,.952941,.991332,.905763,.661309,.956863,.99093,.912915,.668481,.960784,.99057,.920049,.675675,.964706,.990175,.927196,.682926,.968627,.989815,.934329,.690198,.972549,.989434,.94147,.697519,.976471,.989077,.948604,.704863,.980392,.988717,.955742,.712242,.984314,.988367,.962878,.719649,.988235,.988033,.970012,.727077,.992157,.987691,.977154,.734536,.996078,.987387,.984288,.742002,1,.987053,.991438,.749504]},{ColorSpace:"Diverging",Name:"Inferno (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002267,.00127,.01857,.007843,.003299,.002249,.024239,.011765,.004547,.003392,.030909,.015686,.006006,.004692,.038558,.019608,.007676,.006136,.046836,.023529,.009561,.007713,.055143,.027451,.011663,.009417,.06346,.031373,.013995,.011225,.071862,.035294,.016561,.013136,.080282,.039216,.019373,.015133,.088767,.043137,.022447,.017199,.097327,.047059,.025793,.019331,.10593,.05098,.029432,.021503,.114621,.054902,.033385,.023702,.123397,.058824,.037668,.025921,.132232,.062745,.042253,.028139,.141141,.066667,.046915,.030324,.150164,.070588,.051644,.032474,.159254,.07451,.056449,.034569,.168414,.078431,.06134,.03659,.177642,.082353,.066331,.038504,.186962,.086275,.071429,.040294,.196354,.090196,.076637,.041905,.205799,.094118,.081962,.043328,.215289,.098039,.087411,.044556,.224813,.101961,.09299,.045583,.234358,.105882,.098702,.046402,.243904,.109804,.104551,.047008,.25343,.113725,.110536,.047399,.262912,.117647,.116656,.047574,.272321,.121569,.122908,.047536,.281624,.12549,.129285,.047293,.290788,.129412,.135778,.046856,.299776,.133333,.142378,.046242,.308553,.137255,.149073,.045468,.317085,.141176,.15585,.044559,.325338,.145098,.162689,.043554,.333277,.14902,.169575,.042489,.340874,.152941,.176493,.041402,.348111,.156863,.183429,.040329,.354971,.160784,.190367,.039309,.361447,.164706,.197297,.0384,.367535,.168627,.204209,.037632,.373238,.172549,.211095,.03703,.378563,.176471,.217949,.036615,.383522,.180392,.224763,.036405,.388129,.184314,.231538,.036405,.3924,.188235,.238273,.036621,.396353,.192157,.244967,.037055,.400007,.196078,.25162,.037705,.403378,.2,.258234,.038571,.406485,.203922,.26481,.039647,.409345,.207843,.271347,.040922,.411976,.211765,.27785,.042353,.414392,.215686,.284321,.043933,.416608,.219608,.290763,.045644,.418637,.223529,.297178,.04747,.420491,.227451,.303568,.049396,.422182,.231373,.309935,.051407,.423721,.235294,.316282,.05349,.425116,.239216,.32261,.055634,.426377,.243137,.328921,.057827,.427511,.247059,.335217,.06006,.428524,.25098,.3415,.062325,.429425,.254902,.347771,.064616,.430217,.258824,.354032,.066925,.430906,.262745,.360284,.069247,.431497,.266667,.366529,.071579,.431994,.270588,.372768,.073915,.4324,.27451,.379001,.076253,.432719,.278431,.385228,.078591,.432955,.282353,.391453,.080927,.433109,.286275,.397674,.083257,.433183,.290196,.403894,.08558,.433179,.294118,.410113,.087896,.433098,.298039,.416331,.090203,.432943,.301961,.422549,.092501,.432714,.305882,.428768,.09479,.432412,.309804,.434987,.097069,.432039,.313725,.441207,.099338,.431594,.317647,.447428,.101597,.43108,.321569,.453651,.103848,.430498,.32549,.459875,.106089,.429846,.329412,.4661,.108322,.429125,.333333,.472328,.110547,.428334,.337255,.478558,.112764,.427475,.341176,.484789,.114974,.426548,.345098,.491022,.117179,.425552,.34902,.497257,.119379,.424488,.352941,.503493,.121575,.423356,.356863,.50973,.123769,.422156,.360784,.515967,.12596,.420887,.364706,.522206,.12815,.419549,.368627,.528444,.130341,.418142,.372549,.534683,.132534,.416667,.376471,.54092,.134729,.415123,.380392,.547157,.136929,.413511,.384314,.553392,.139134,.411829,.388235,.559624,.141346,.410078,.392157,.565854,.143567,.408258,.396078,.572081,.145797,.406369,.4,.578304,.148039,.404411,.403922,.584521,.150294,.402385,.407843,.590734,.152563,.40029,.411765,.59694,.154848,.398125,.415686,.603139,.157151,.395891,.419608,.60933,.159474,.393589,.423529,.615513,.161817,.391219,.427451,.621685,.164184,.388781,.431373,.627847,.166575,.386276,.435294,.633998,.168992,.383704,.439216,.640135,.171438,.381065,.443137,.64626,.173914,.378359,.447059,.652369,.176421,.375586,.45098,.658463,.178962,.372748,.454902,.66454,.181539,.369846,.458824,.670599,.184153,.366879,.462745,.676638,.186807,.363849,.466667,.682656,.189501,.360757,.470588,.688653,.192239,.357603,.47451,.694627,.195021,.354388,.478431,.700576,.197851,.351113,.482353,.7065,.200728,.347777,.486275,.712396,.203656,.344383,.490196,.718264,.206636,.340931,.494118,.724103,.20967,.337424,.498039,.729909,.212759,.333861,.501961,.735683,.215906,.330245,.505882,.741423,.219112,.326576,.509804,.747127,.222378,.322856,.513725,.752794,.225706,.319085,.517647,.758422,.229097,.315266,.521569,.76401,.232554,.311399,.52549,.769556,.236077,.307485,.529412,.775059,.239667,.303526,.533333,.780517,.243327,.299523,.537255,.785929,.247056,.295477,.541176,.791293,.250856,.29139,.545098,.796607,.254728,.287264,.54902,.801871,.258674,.283099,.552941,.807082,.262692,.278898,.556863,.812239,.266786,.274661,.560784,.817341,.270954,.27039,.564706,.822386,.275197,.266085,.568627,.827372,.279517,.26175,.572549,.832299,.283913,.257383,.576471,.837165,.288385,.252988,.580392,.841969,.292933,.248564,.584314,.846709,.297559,.244113,.588235,.851384,.30226,.239636,.592157,.855992,.307038,.235133,.596078,.860533,.311892,.230606,.6,.865006,.316822,.226055,.603922,.869409,.321827,.221482,.607843,.873741,.326906,.216886,.611765,.878001,.33206,.212268,.615686,.882188,.337287,.207628,.619608,.886302,.342586,.202968,.623529,.890341,.347957,.198286,.627451,.894305,.353399,.193584,.631373,.898192,.358911,.18886,.635294,.902003,.364492,.184116,.639216,.905735,.37014,.17935,.643137,.90939,.375856,.174563,.647059,.912966,.381636,.169755,.65098,.916462,.387481,.164924,.654902,.919879,.393389,.16007,.658824,.923215,.399359,.155193,.662745,.92647,.405389,.150292,.666667,.929644,.411479,.145367,.670588,.932737,.417627,.140417,.67451,.935747,.423831,.13544,.678431,.938675,.430091,.130438,.682353,.941521,.436405,.125409,.686275,.944285,.442772,.120354,.690196,.946965,.449191,.115272,.694118,.949562,.45566,.110164,.698039,.952075,.462178,.105031,.701961,.954506,.468744,.099874,.705882,.956852,.475356,.094695,.709804,.959114,.482014,.089499,.713725,.961293,.488716,.084289,.717647,.963387,.495462,.079073,.721569,.965397,.502249,.073859,.72549,.967322,.509078,.068659,.729412,.969163,.515946,.063488,.733333,.970919,.522853,.058367,.737255,.97259,.529798,.053324,.741176,.974176,.53678,.048392,.745098,.975677,.543798,.043618,.74902,.977092,.55085,.03905,.752941,.978422,.557937,.034931,.756863,.979666,.565057,.031409,.760784,.980824,.572209,.028508,.764706,.981895,.579392,.02625,.768627,.982881,.586606,.024661,.772549,.983779,.593849,.02377,.776471,.984591,.601122,.023606,.780392,.985315,.608422,.024202,.784314,.985952,.61575,.025592,.788235,.986502,.623105,.027814,.792157,.986964,.630485,.030908,.796078,.987337,.63789,.034916,.8,.987622,.64532,.039886,.803922,.987819,.652773,.045581,.807843,.987926,.66025,.05175,.811765,.987945,.667748,.058329,.815686,.987874,.675267,.065257,.819608,.987714,.682807,.072489,.823529,.987464,.690366,.07999,.827451,.987124,.697944,.087731,.831373,.986694,.70554,.095694,.835294,.986175,.713153,.103863,.839216,.985566,.720782,.112229,.843137,.984865,.728427,.120785,.847059,.984075,.736087,.129527,.85098,.983196,.743758,.138453,.854902,.982228,.751442,.147565,.858824,.981173,.759135,.156863,.862745,.980032,.766837,.166353,.866667,.978806,.774545,.176037,.870588,.977497,.782258,.185923,.87451,.976108,.789974,.196018,.878431,.974638,.797692,.206332,.882353,.973088,.805409,.216877,.886275,.971468,.813122,.227658,.890196,.969783,.820825,.238686,.894118,.968041,.828515,.249972,.898039,.966243,.836191,.261534,.901961,.964394,.843848,.273391,.905882,.962517,.851476,.285546,.909804,.960626,.859069,.29801,.913725,.95872,.866624,.31082,.917647,.956834,.874129,.323974,.921569,.954997,.881569,.337475,.92549,.953215,.888942,.351369,.929412,.951546,.896226,.365627,.933333,.950018,.903409,.380271,.937255,.948683,.910473,.395289,.941176,.947594,.917399,.410665,.945098,.946809,.924168,.426373,.94902,.946392,.930761,.442367,.952941,.946403,.937159,.458592,.956863,.946903,.943348,.47497,.960784,.947937,.949318,.491426,.964706,.949545,.955063,.50786,.968627,.95174,.960587,.524203,.972549,.954529,.965896,.540361,.976471,.957896,.971003,.556275,.980392,.961812,.975924,.571925,.984314,.966249,.980678,.587206,.988235,.971162,.985282,.602154,.992157,.976511,.989753,.61676,.996078,.982257,.994109,.631017,1,.988362,.998364,.644924]},{ColorSpace:"Diverging",Name:"Plasma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.050383,.029803,.527975,.003922,.063536,.028426,.533124,.007843,.075353,.027206,.538007,.011765,.086222,.026125,.542658,.015686,.096379,.025165,.547103,.019608,.10598,.024309,.551368,.023529,.115124,.023556,.555468,.027451,.123903,.022878,.559423,.031373,.132381,.022258,.56325,.035294,.140603,.021687,.566959,.039216,.148607,.021154,.570562,.043137,.156421,.020651,.574065,.047059,.16407,.020171,.577478,.05098,.171574,.019706,.580806,.054902,.17895,.019252,.584054,.058824,.186213,.018803,.587228,.062745,.193374,.018354,.59033,.066667,.200445,.017902,.593364,.070588,.207435,.017442,.596333,.07451,.21435,.016973,.599239,.078431,.221197,.016497,.602083,.082353,.227983,.016007,.604867,.086275,.234715,.015502,.607592,.090196,.241396,.014979,.610259,.094118,.248032,.014439,.612868,.098039,.254627,.013882,.615419,.101961,.261183,.013308,.617911,.105882,.267703,.012716,.620346,.109804,.274191,.012109,.622722,.113725,.280648,.011488,.625038,.117647,.287076,.010855,.627295,.121569,.293478,.010213,.62949,.12549,.299855,.009561,.631624,.129412,.30621,.008902,.633694,.133333,.312543,.008239,.6357,.137255,.318856,.007576,.63764,.141176,.32515,.006915,.639512,.145098,.331426,.006261,.641316,.14902,.337683,.005618,.643049,.152941,.343925,.004991,.64471,.156863,.35015,.004382,.646298,.160784,.356359,.003798,.64781,.164706,.362553,.003243,.649245,.168627,.368733,.002724,.650601,.172549,.374897,.002245,.651876,.176471,.381047,.001814,.653068,.180392,.387183,.001434,.654177,.184314,.393304,.001114,.655199,.188235,.399411,859e-6,.656133,.192157,.405503,678e-6,.656977,.196078,.41158,577e-6,.65773,.2,.417642,564e-6,.65839,.203922,.423689,646e-6,.658956,.207843,.429719,831e-6,.659425,.211765,.435734,.001127,.659797,.215686,.441732,.00154,.660069,.219608,.447714,.00208,.66024,.223529,.453677,.002755,.66031,.227451,.459623,.003574,.660277,.231373,.46555,.004545,.660139,.235294,.471457,.005678,.659897,.239216,.477344,.00698,.659549,.243137,.48321,.00846,.659095,.247059,.489055,.010127,.658534,.25098,.494877,.01199,.657865,.254902,.500678,.014055,.657088,.258824,.506454,.016333,.656202,.262745,.512206,.018833,.655209,.266667,.517933,.021563,.654109,.270588,.523633,.024532,.652901,.27451,.529306,.027747,.651586,.278431,.534952,.031217,.650165,.282353,.54057,.03495,.64864,.286275,.546157,.038954,.64701,.290196,.551715,.043136,.645277,.294118,.557243,.047331,.643443,.298039,.562738,.051545,.641509,.301961,.568201,.055778,.639477,.305882,.573632,.060028,.637349,.309804,.579029,.064296,.635126,.313725,.584391,.068579,.632812,.317647,.589719,.072878,.630408,.321569,.595011,.07719,.627917,.32549,.600266,.081516,.625342,.329412,.605485,.085854,.622686,.333333,.610667,.090204,.619951,.337255,.615812,.094564,.61714,.341176,.620919,.098934,.614257,.345098,.625987,.103312,.611305,.34902,.631017,.107699,.608287,.352941,.636008,.112092,.605205,.356863,.640959,.116492,.602065,.360784,.645872,.120898,.598867,.364706,.650746,.125309,.595617,.368627,.65558,.129725,.592317,.372549,.660374,.134144,.588971,.376471,.665129,.138566,.585582,.380392,.669845,.142992,.582154,.384314,.674522,.147419,.578688,.388235,.67916,.151848,.575189,.392157,.683758,.156278,.57166,.396078,.688318,.160709,.568103,.4,.69284,.165141,.564522,.403922,.697324,.169573,.560919,.407843,.701769,.174005,.557296,.411765,.706178,.178437,.553657,.415686,.710549,.182868,.550004,.419608,.714883,.187299,.546338,.423529,.719181,.191729,.542663,.427451,.723444,.196158,.538981,.431373,.72767,.200586,.535293,.435294,.731862,.205013,.531601,.439216,.736019,.209439,.527908,.443137,.740143,.213864,.524216,.447059,.744232,.218288,.520524,.45098,.748289,.222711,.516834,.454902,.752312,.227133,.513149,.458824,.756304,.231555,.509468,.462745,.760264,.235976,.505794,.466667,.764193,.240396,.502126,.470588,.76809,.244817,.498465,.47451,.771958,.249237,.494813,.478431,.775796,.253658,.491171,.482353,.779604,.258078,.487539,.486275,.783383,.2625,.483918,.490196,.787133,.266922,.480307,.494118,.790855,.271345,.476706,.498039,.794549,.27577,.473117,.501961,.798216,.280197,.469538,.505882,.801855,.284626,.465971,.509804,.805467,.289057,.462415,.513725,.809052,.293491,.45887,.517647,.812612,.297928,.455338,.521569,.816144,.302368,.451816,.52549,.819651,.306812,.448306,.529412,.823132,.311261,.444806,.533333,.826588,.315714,.441316,.537255,.830018,.320172,.437836,.541176,.833422,.324635,.434366,.545098,.836801,.329105,.430905,.54902,.840155,.33358,.427455,.552941,.843484,.338062,.424013,.556863,.846788,.342551,.420579,.560784,.850066,.347048,.417153,.564706,.853319,.351553,.413734,.568627,.856547,.356066,.410322,.572549,.85975,.360588,.406917,.576471,.862927,.365119,.403519,.580392,.866078,.36966,.400126,.584314,.869203,.374212,.396738,.588235,.872303,.378774,.393355,.592157,.875376,.383347,.389976,.596078,.878423,.387932,.3866,.6,.881443,.392529,.383229,.603922,.884436,.397139,.37986,.607843,.887402,.401762,.376494,.611765,.89034,.406398,.37313,.615686,.89325,.411048,.369768,.619608,.896131,.415712,.366407,.623529,.898984,.420392,.363047,.627451,.901807,.425087,.359688,.631373,.904601,.429797,.356329,.635294,.907365,.434524,.35297,.639216,.910098,.439268,.34961,.643137,.9128,.444029,.346251,.647059,.915471,.448807,.34289,.65098,.918109,.453603,.339529,.654902,.920714,.458417,.336166,.658824,.923287,.463251,.332801,.662745,.925825,.468103,.329435,.666667,.928329,.472975,.326067,.670588,.930798,.477867,.322697,.67451,.933232,.48278,.319325,.678431,.93563,.487712,.315952,.682353,.93799,.492667,.312575,.686275,.940313,.497642,.309197,.690196,.942598,.502639,.305816,.694118,.944844,.507658,.302433,.698039,.947051,.512699,.299049,.701961,.949217,.517763,.295662,.705882,.951344,.52285,.292275,.709804,.953428,.52796,.288883,.713725,.95547,.533093,.28549,.717647,.957469,.53825,.282096,.721569,.959424,.543431,.278701,.72549,.961336,.548636,.275305,.729412,.963203,.553865,.271909,.733333,.965024,.559118,.268513,.737255,.966798,.564396,.265118,.741176,.968526,.5697,.261721,.745098,.970205,.575028,.258325,.74902,.971835,.580382,.254931,.752941,.973416,.585761,.25154,.756863,.974947,.591165,.248151,.760784,.976428,.596595,.244767,.764706,.977856,.602051,.241387,.768627,.979233,.607532,.238013,.772549,.980556,.613039,.234646,.776471,.981826,.618572,.231287,.780392,.983041,.624131,.227937,.784314,.984199,.629718,.224595,.788235,.985301,.63533,.221265,.792157,.986345,.640969,.217948,.796078,.987332,.646633,.214648,.8,.98826,.652325,.211364,.803922,.989128,.658043,.2081,.807843,.989935,.663787,.204859,.811765,.990681,.669558,.201642,.815686,.991365,.675355,.198453,.819608,.991985,.681179,.195295,.823529,.992541,.68703,.19217,.827451,.993032,.692907,.189084,.831373,.993456,.69881,.186041,.835294,.993814,.704741,.183043,.839216,.994103,.710698,.180097,.843137,.994324,.716681,.177208,.847059,.994474,.722691,.174381,.85098,.994553,.728728,.171622,.854902,.994561,.734791,.168938,.858824,.994495,.74088,.166335,.862745,.994355,.746995,.163821,.866667,.994141,.753137,.161404,.870588,.993851,.759304,.159092,.87451,.993482,.765499,.156891,.878431,.993033,.77172,.154808,.882353,.992505,.777967,.152855,.886275,.991897,.784239,.151042,.890196,.991209,.790537,.149377,.894118,.990439,.796859,.14787,.898039,.989587,.803205,.146529,.901961,.988648,.809579,.145357,.905882,.987621,.815978,.144363,.909804,.986509,.822401,.143557,.913725,.985314,.828846,.142945,.917647,.984031,.835315,.142528,.921569,.982653,.841812,.142303,.92549,.98119,.848329,.142279,.929412,.979644,.854866,.142453,.933333,.977995,.861432,.142808,.937255,.976265,.868016,.143351,.941176,.974443,.874622,.144061,.945098,.97253,.88125,.144923,.94902,.970533,.887896,.145919,.952941,.968443,.894564,.147014,.956863,.966271,.901249,.14818,.960784,.964021,.90795,.14937,.964706,.961681,.914672,.15052,.968627,.959276,.921407,.151566,.972549,.956808,.928152,.152409,.976471,.954287,.934908,.152921,.980392,.951726,.941671,.152925,.984314,.949151,.948435,.152178,.988235,.946602,.95519,.150328,.992157,.944152,.961916,.146861,.996078,.941896,.96859,.140956,1,.940015,.975158,.131326]},{ColorSpace:"Diverging",Name:"Viridis (matplotlib)",NanColor:[1,0,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Eric Firing",RGBPoints:[0,.267004,.004874,.329415,.003922,.26851,.009605,.335427,.007843,.269944,.014625,.341379,.011765,.271305,.019942,.347269,.015686,.272594,.025563,.353093,.019608,.273809,.031497,.358853,.023529,.274952,.037752,.364543,.027451,.276022,.044167,.370164,.031373,.277018,.050344,.375715,.035294,.277941,.056324,.381191,.039216,.278791,.062145,.386592,.043137,.279566,.067836,.391917,.047059,.280267,.073417,.397163,.05098,.280894,.078907,.402329,.054902,.281446,.08432,.407414,.058824,.281924,.089666,.412415,.062745,.282327,.094955,.417331,.066667,.282656,.100196,.42216,.070588,.28291,.105393,.426902,.07451,.283091,.110553,.431554,.078431,.283197,.11568,.436115,.082353,.283229,.120777,.440584,.086275,.283187,.125848,.44496,.090196,.283072,.130895,.449241,.094118,.282884,.13592,.453427,.098039,.282623,.140926,.457517,.101961,.28229,.145912,.46151,.105882,.281887,.150881,.465405,.109804,.281412,.155834,.469201,.113725,.280868,.160771,.472899,.117647,.280255,.165693,.476498,.121569,.279574,.170599,.479997,.12549,.278826,.17549,.483397,.129412,.278012,.180367,.486697,.133333,.277134,.185228,.489898,.137255,.276194,.190074,.493001,.141176,.275191,.194905,.496005,.145098,.274128,.199721,.498911,.14902,.273006,.20452,.501721,.152941,.271828,.209303,.504434,.156863,.270595,.214069,.507052,.160784,.269308,.218818,.509577,.164706,.267968,.223549,.512008,.168627,.26658,.228262,.514349,.172549,.265145,.232956,.516599,.176471,.263663,.237631,.518762,.180392,.262138,.242286,.520837,.184314,.260571,.246922,.522828,.188235,.258965,.251537,.524736,.192157,.257322,.25613,.526563,.196078,.255645,.260703,.528312,.2,.253935,.265254,.529983,.203922,.252194,.269783,.531579,.207843,.250425,.27429,.533103,.211765,.248629,.278775,.534556,.215686,.246811,.283237,.535941,.219608,.244972,.287675,.53726,.223529,.243113,.292092,.538516,.227451,.241237,.296485,.539709,.231373,.239346,.300855,.540844,.235294,.237441,.305202,.541921,.239216,.235526,.309527,.542944,.243137,.233603,.313828,.543914,.247059,.231674,.318106,.544834,.25098,.229739,.322361,.545706,.254902,.227802,.326594,.546532,.258824,.225863,.330805,.547314,.262745,.223925,.334994,.548053,.266667,.221989,.339161,.548752,.270588,.220057,.343307,.549413,.27451,.21813,.347432,.550038,.278431,.21621,.351535,.550627,.282353,.214298,.355619,.551184,.286275,.212395,.359683,.55171,.290196,.210503,.363727,.552206,.294118,.208623,.367752,.552675,.298039,.206756,.371758,.553117,.301961,.204903,.375746,.553533,.305882,.203063,.379716,.553925,.309804,.201239,.38367,.554294,.313725,.19943,.387607,.554642,.317647,.197636,.391528,.554969,.321569,.19586,.395433,.555276,.32549,.1941,.399323,.555565,.329412,.192357,.403199,.555836,.333333,.190631,.407061,.556089,.337255,.188923,.41091,.556326,.341176,.187231,.414746,.556547,.345098,.185556,.41857,.556753,.34902,.183898,.422383,.556944,.352941,.182256,.426184,.55712,.356863,.180629,.429975,.557282,.360784,.179019,.433756,.55743,.364706,.177423,.437527,.557565,.368627,.175841,.44129,.557685,.372549,.174274,.445044,.557792,.376471,.172719,.448791,.557885,.380392,.171176,.45253,.557965,.384314,.169646,.456262,.55803,.388235,.168126,.459988,.558082,.392157,.166617,.463708,.558119,.396078,.165117,.467423,.558141,.4,.163625,.471133,.558148,.403922,.162142,.474838,.55814,.407843,.160665,.47854,.558115,.411765,.159194,.482237,.558073,.415686,.157729,.485932,.558013,.419608,.15627,.489624,.557936,.423529,.154815,.493313,.55784,.427451,.153364,.497,.557724,.431373,.151918,.500685,.557587,.435294,.150476,.504369,.55743,.439216,.149039,.508051,.55725,.443137,.147607,.511733,.557049,.447059,.14618,.515413,.556823,.45098,.144759,.519093,.556572,.454902,.143343,.522773,.556295,.458824,.141935,.526453,.555991,.462745,.140536,.530132,.555659,.466667,.139147,.533812,.555298,.470588,.13777,.537492,.554906,.47451,.136408,.541173,.554483,.478431,.135066,.544853,.554029,.482353,.133743,.548535,.553541,.486275,.132444,.552216,.553018,.490196,.131172,.555899,.552459,.494118,.129933,.559582,.551864,.498039,.128729,.563265,.551229,.501961,.127568,.566949,.550556,.505882,.126453,.570633,.549841,.509804,.125394,.574318,.549086,.513725,.124395,.578002,.548287,.517647,.123463,.581687,.547445,.521569,.122606,.585371,.546557,.52549,.121831,.589055,.545623,.529412,.121148,.592739,.544641,.533333,.120565,.596422,.543611,.537255,.120092,.600104,.54253,.541176,.119738,.603785,.5414,.545098,.119512,.607464,.540218,.54902,.119423,.611141,.538982,.552941,.119483,.614817,.537692,.556863,.119699,.61849,.536347,.560784,.120081,.622161,.534946,.564706,.120638,.625828,.533488,.568627,.12138,.629492,.531973,.572549,.122312,.633153,.530398,.576471,.123444,.636809,.528763,.580392,.12478,.640461,.527068,.584314,.126326,.644107,.525311,.588235,.128087,.647749,.523491,.592157,.130067,.651384,.521608,.596078,.132268,.655014,.519661,.6,.134692,.658636,.517649,.603922,.137339,.662252,.515571,.607843,.14021,.665859,.513427,.611765,.143303,.669459,.511215,.615686,.146616,.67305,.508936,.619608,.150148,.676631,.506589,.623529,.153894,.680203,.504172,.627451,.157851,.683765,.501686,.631373,.162016,.687316,.499129,.635294,.166383,.690856,.496502,.639216,.170948,.694384,.493803,.643137,.175707,.6979,.491033,.647059,.180653,.701402,.488189,.65098,.185783,.704891,.485273,.654902,.19109,.708366,.482284,.658824,.196571,.711827,.479221,.662745,.202219,.715272,.476084,.666667,.20803,.718701,.472873,.670588,.214,.722114,.469588,.67451,.220124,.725509,.466226,.678431,.226397,.728888,.462789,.682353,.232815,.732247,.459277,.686275,.239374,.735588,.455688,.690196,.24607,.73891,.452024,.694118,.252899,.742211,.448284,.698039,.259857,.745492,.444467,.701961,.266941,.748751,.440573,.705882,.274149,.751988,.436601,.709804,.281477,.755203,.432552,.713725,.288921,.758394,.428426,.717647,.296479,.761561,.424223,.721569,.304148,.764704,.419943,.72549,.311925,.767822,.415586,.729412,.319809,.770914,.411152,.733333,.327796,.77398,.40664,.737255,.335885,.777018,.402049,.741176,.344074,.780029,.397381,.745098,.35236,.783011,.392636,.74902,.360741,.785964,.387814,.752941,.369214,.788888,.382914,.756863,.377779,.791781,.377939,.760784,.386433,.794644,.372886,.764706,.395174,.797475,.367757,.768627,.404001,.800275,.362552,.772549,.412913,.803041,.357269,.776471,.421908,.805774,.35191,.780392,.430983,.808473,.346476,.784314,.440137,.811138,.340967,.788235,.449368,.813768,.335384,.792157,.458674,.816363,.329727,.796078,.468053,.818921,.323998,.8,.477504,.821444,.318195,.803922,.487026,.823929,.312321,.807843,.496615,.826376,.306377,.811765,.506271,.828786,.300362,.815686,.515992,.831158,.294279,.819608,.525776,.833491,.288127,.823529,.535621,.835785,.281908,.827451,.545524,.838039,.275626,.831373,.555484,.840254,.269281,.835294,.565498,.84243,.262877,.839216,.575563,.844566,.256415,.843137,.585678,.846661,.249897,.847059,.595839,.848717,.243329,.85098,.606045,.850733,.236712,.854902,.616293,.852709,.230052,.858824,.626579,.854645,.223353,.862745,.636902,.856542,.21662,.866667,.647257,.8584,.209861,.870588,.657642,.860219,.203082,.87451,.668054,.861999,.196293,.878431,.678489,.863742,.189503,.882353,.688944,.865448,.182725,.886275,.699415,.867117,.175971,.890196,.709898,.868751,.169257,.894118,.720391,.87035,.162603,.898039,.730889,.871916,.156029,.901961,.741388,.873449,.149561,.905882,.751884,.874951,.143228,.909804,.762373,.876424,.137064,.913725,.772852,.877868,.131109,.917647,.783315,.879285,.125405,.921569,.79376,.880678,.120005,.92549,.804182,.882046,.114965,.929412,.814576,.883393,.110347,.933333,.82494,.88472,.106217,.937255,.83527,.886029,.102646,.941176,.845561,.887322,.099702,.945098,.85581,.888601,.097452,.94902,.866013,.889868,.095953,.952941,.876168,.891125,.09525,.956863,.886271,.892374,.095374,.960784,.89632,.893616,.096335,.964706,.906311,.894855,.098125,.968627,.916242,.896091,.100717,.972549,.926106,.89733,.104071,.976471,.935904,.89857,.108131,.980392,.945636,.899815,.112838,.984314,.9553,.901065,.118128,.988235,.964894,.902323,.123941,.992157,.974417,.90359,.130215,.996078,.983868,.904867,.136897,1,.993248,.906157,.143936]},{ShowIndexedColorActiveValues:1,IndexedColors:[.07,.5,.7,1,1,1,.85,1,1,.8,.5,1,.76,1,0,1,.71,.71,.5,.5,.5,.05,.05,1,1,.05,.05,.7,1,1,.7,.89,.96,.67,.36,.95,.54,1,0,.75,.65,.65,.5,.6,.6,1,.5,0,1,1,.19,.12,.94,.12,.5,.82,.89,.56,.25,.83,.24,1,0,.9,.9,.9,.75,.76,.78,.65,.65,.67,.54,.6,.78,.61,.48,.78,.5,.48,.78,.44,.48,.78,.36,.48,.76,1,.48,.38,.49,.5,.69,.76,.56,.56,.4,.56,.56,.74,.5,.89,1,.63,0,.65,.16,.16,.36,.72,.82,.44,.18,.69,0,1,0,.58,1,1,.58,.88,.88,.45,.76,.79,.33,.71,.71,.23,.62,.62,.14,.56,.56,.04,.49,.55,0,.41,.52,.88,.88,1,1,.85,.56,.65,.46,.45,.4,.5,.5,.62,.39,.71,.83,.48,0,.58,0,.58,.26,.62,.69,.34,.09,.56,0,.79,0,.44,.83,1,1,1,.78,.85,1,.78,.78,1,.78,.64,1,.78,.56,1,.78,.38,1,.78,.27,1,.78,.19,1,.78,.12,1,.78,0,1,.61,0,.9,.46,0,.83,.32,0,.75,.22,0,.67,.14,.3,.76,1,.3,.65,1,.13,.58,.84,.15,.49,.67,.15,.4,.59,.09,.33,.53,.96,.93,.82,.8,.82,.12,.71,.71,.76,.65,.33,.3,.34,.35,.38,.62,.31,.71,.67,.36,0,.46,.31,.27,.26,.51,.59,.26,0,.4,0,.49,0,.44,.67,.98,0,.73,1,0,.63,1,0,.56,1,0,.5,1,0,.42,1,.33,.36,.95,.47,.36,.89,.54,.31,.89,.63,.21,.83,.7,.12,.83,.7,.12,.73,.7,.05,.65,.74,.05,.53,.78,0,.4,.8,0,.35,.82,0,.31,.85,0,.27,.88,0,.22,.9,0,.18,.91,0,.15,.92,0,.14,.93,0,.13,.94,0,.12,.95,0,.11,.96,0,.1,.97,0,.09,.98,0,.08,.99,0,.07,1,0,.06],Annotations:[0,"Xx",1,"H",2,"He",3,"Li",4,"Be",5,"B",6,"C",7,"N",8,"O",9,"F",10,"Ne",11,"Na",12,"Mg",13,"Al",14,"Si",15,"P",16,"S",17,"Cl",18,"Ar",19,"K",20,"Ca",21,"Sc",22,"Ti",23,"V",24,"Cr",25,"Mn",26,"Fe",27,"Co",28,"Ni",29,"Cu",30,"Zn",31,"Ga",32,"Ge",33,"As",34,"Se",35,"Br",36,"Kr",37,"Rb",38,"Sr",39,"Y",40,"Zr",41,"Nb",42,"Mo",43,"Tc",44,"Ru",45,"Rh",46,"Pd",47,"Ag",48,"Cd",49,"In",50,"Sn",51,"Sb",52,"Te",53,"I",54,"Xe",55,"Cs",56,"Ba",57,"La",58,"Ce",59,"Pr",60,"Nd",61,"Pm",62,"Sm",63,"Eu",64,"Gd",65,"Tb",66,"Dy",67,"Ho",68,"Er",69,"Tm",70,"Yb",71,"Lu",72,"Hf",73,"Ta",74,"W",75,"Re",76,"Os",77,"Ir",78,"Pt",79,"Au",80,"Hg",81,"Tl",82,"Pb",83,"Bi",84,"Po",85,"At",86,"Rn",87,"Fr",88,"Ra",89,"Ac",90,"Th",91,"Pa",92,"U",93,"Np",94,"Pu",95,"Am",96,"Cm",97,"Bk",98,"Cf",99,"Es",100,"Fm",101,"Md",102,"No",103,"Lr",104,"Rf",105,"Db",106,"Sg",107,"Bh",108,"Hs",109,"Mt",110,"Ds",111,"Rg",112,"Cn",113,"Uut",114,"Uuq",115,"Uup",116,"Uuh",117,"Uus",118,"Uuo"],Name:"BlueObeliskElements"}];const rf=Object.create(null);qP.filter(t=>t.RGBPoints).filter(t=>t.ColorSpace!=="CIELAB").forEach(t=>{rf[t.Name]=t});const af=Object.keys(rf);af.sort();function KP(t){return rf[t]}function YP(t){!t.RGBPoints||t.ColorSpace==="CIELAB"||(rf[t.Name]||(af.push(t.Name),af.sort()),rf[t.Name]=t)}function XP(t){const e=af.indexOf(t);e>-1&&af.splice(e,1),delete rf[t]}var v1={addPreset:YP,removePresetByName:XP,getPresetByName:KP,rgbPresetNames:af};const{vtkErrorMacro:ih}=H;function ZP(t,e){e.classHierarchy.push("vtkPiecewiseFunction"),t.getSize=()=>e.nodes.length,t.getType=()=>{let n,r=0,i=0;e.nodes.length>0&&(r=e.nodes[0].y);for(let a=1;a<e.nodes.length;a++){if(n=e.nodes[a].y,n!==r)if(n>r)switch(i){case 0:case 1:i=1;break;case 2:default:i=3;break}else switch(i){case 0:case 2:i=2;break;case 1:default:i=3;break}if(r=n,i===3)break}switch(i){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";case 3:default:return"Varied"}},t.getDataPointer=()=>{const n=e.nodes.length;if(e.function=null,n>0){e.function=[];for(let r=0;r<n;r++)e.function[2*r]=e.nodes[r].x,e.function[2*r+1]=e.nodes[r].y}return e.function},t.getFirstNonZeroValue=()=>{if(e.nodes.length===0)return 0;let n=1,r=0,i=0;for(;i<e.nodes.length;i++)if(e.nodes[i].y!==0){n=0;break}return n?r=Number.MAX_VALUE:i>0?r=e.nodes[i-1].x:e.clamping?r=-Number.MAX_VALUE:r=e.nodes[0].x,r},t.getNodeValue=(n,r)=>{const i=e.nodes.length;return n<0||n>=i?(ih("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].y,r[2]=e.nodes[n].midpoint,r[3]=e.nodes[n].sharpness,1)},t.setNodeValue=(n,r)=>{const i=e.nodes.length;if(n<0||n>=i)return ih("Index out of range!"),-1;const a=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].y=r[1],e.nodes[n].midpoint=r[2],e.nodes[n].sharpness=r[3],a!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.addPoint=(n,r)=>t.addPointLong(n,r,.5,0),t.addPointLong=(n,r,i,a)=>{if(i<0||i>1)return ih("Midpoint outside range [0.0, 1.0]"),-1;if(a<0||a>1)return ih("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);const o={x:n,y:r,midpoint:i,sharpness:a};e.nodes.push(o),t.sortAndUpdateRange();let s;for(s=0;s<e.nodes.length&&e.nodes[s].x!==n;s++);return s<e.nodes.length?s:-1},t.setNodes=n=>{e.nodes!==n&&(e.nodes=n,t.sortAndUpdateRange())},t.sortAndUpdateRange=()=>{e.nodes.sort((r,i)=>r.x-i.x),t.updateRange()||t.modified()},t.updateRange=()=>{const n=e.range.slice(),r=e.nodes.length;return r?(e.range[0]=e.nodes[0].x,e.range[1]=e.nodes[r-1].x):(e.range[0]=0,e.range[1]=0),n[0]===e.range[0]&&n[1]===e.range[1]?!1:(t.modified(),!0)},t.removePoint=n=>{let r;for(r=0;r<e.nodes.length&&e.nodes[r].x!==n;r++);if(r>=e.nodes.length)return-1;const i=r;let a=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(a=t.updateRange()),a||t.modified(),i},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addSegment=(n,r,i,a)=>{t.sortAndUpdateRange();for(let o=0;o<e.nodes.length;)e.nodes[o].x>=n&&e.nodes[o].x<=i?e.nodes.splice(o,1):o++;t.addPoint(n,r,.5,0),t.addPoint(i,a,.5,0)},t.getValue=n=>{const r=[];return t.getTable(n,n,1,r),r[0]},t.adjustRange=n=>{if(n.length<2)return 0;const r=t.getRange();r[0]<n[0]?t.addPoint(n[0],t.getValue(n[0])):t.addPoint(n[0],t.getValue(r[0])),r[1]>n[1]?t.addPoint(n[1],t.getValue(n[1])):t.addPoint(n[1],t.getValue(r[1])),t.sortAndUpdateRange();for(let i=0;i<e.nodes.length;)e.nodes[i].x>=n[0]&&e.nodes[i].x<=n[1]?e.nodes.splice(i,1):++i;return t.sortAndUpdateRange(),1},t.estimateMinNumberOfSamples=(n,r)=>{const i=t.findMinimumXDistance();return Math.ceil((r-n)/i)},t.findMinimumXDistance=()=>{const n=e.nodes.length;if(n<2)return-1;let r=e.nodes[1].x-e.nodes[0].x;for(let i=0;i<n-1;i++){const a=e.nodes[i+1].x-e.nodes[i].x;a<r&&(r=a)}return r},t.getTable=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,s,c=0;const u=e.nodes.length;let d=0;u!==0&&(d=e.nodes[u-1].y);let g=0,h=0,m=0,y=0,v=0,C=0,S=0;for(s=0;s<i;s++){const w=o*s;for(i>1?g=n+s/(i-1)*(r-n):g=.5*(n+r);c<u&&g>e.nodes[c].x;)c++,c<u&&(h=e.nodes[c-1].x,m=e.nodes[c].x,y=e.nodes[c-1].y,v=e.nodes[c].y,C=e.nodes[c-1].midpoint,S=e.nodes[c-1].sharpness,C<1e-5&&(C=1e-5),C>.99999&&(C=.99999));if(c>=u)a[w]=e.clamping?d:0;else if(c===0)a[w]=e.clamping?e.nodes[0].y:0;else{let x=(g-h)/(m-h);if(x<C?x=.5*x/C:x=.5+.5*(x-C)/(1-C),S>.99)if(x<.5){a[w]=y;continue}else{a[w]=v;continue}if(S<.01){a[w]=(1-x)*y+x*v;continue}x<.5?x=.5*(x*2)**(1+10*S):x>.5&&(x=1-.5*((1-x)*2)**(1+10*S));const R=x*x,O=R*x,b=2*O-3*R+1,I=-2*O+3*R,G=O-2*R+x,j=O-R,F=v-y,$=(1-S)*F;a[w]=b*y+I*v+G*$+j*$;const z=y<v?y:v,oe=y>v?y:v;a[w]=a[w]<z?z:a[w],a[w]=a[w]>oe?oe:a[w]}}}}const QP={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function lE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QP,n),H.obj(t,e),e.nodes=[],H.setGet(t,e,["allowDuplicateScalars","clamping"]),H.setArray(t,e,["range"],2),H.getArray(t,e,["range"]),ZP(t,e)}const JP=H.newInstance(lE,"vtkPiecewiseFunction");var Gl={newInstance:JP,extend:lE},rn=1e-6,Mr=typeof Float32Array<"u"?Float32Array:Array,eU=Math.PI/180;function tU(t){return t*eU}function M2(t,e){return Math.abs(t-e)<=rn*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function $v(){var t=new Mr(9);return Mr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function vp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function nU(t){var e=new Mr(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function rU(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Ug(t,e,n,r,i,a,o,s,c){var u=new Mr(9);return u[0]=t,u[1]=e,u[2]=n,u[3]=r,u[4]=i,u[5]=a,u[6]=o,u[7]=s,u[8]=c,u}function uE(t,e,n,r,i,a,o,s,c,u){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=c,t[8]=u,t}function rs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Wv(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function F1(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],u=e[7],d=e[8],g=d*o-s*u,h=-d*a+s*c,m=u*a-o*c,y=n*g+r*h+i*m;return y?(y=1/y,t[0]=g*y,t[1]=(-d*r+i*u)*y,t[2]=(s*r-i*o)*y,t[3]=h*y,t[4]=(d*n-i*c)*y,t[5]=(-s*n+i*a)*y,t[6]=m*y,t[7]=(-u*n+r*c)*y,t[8]=(o*n-r*a)*y,t):null}function iU(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],u=e[7],d=e[8];return t[0]=o*d-s*u,t[1]=i*u-r*d,t[2]=r*s-i*o,t[3]=s*c-a*d,t[4]=n*d-i*c,t[5]=i*a-n*s,t[6]=a*u-o*c,t[7]=r*c-n*u,t[8]=n*o-r*a,t}function Tl(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],c=t[7],u=t[8];return e*(u*a-o*c)+n*(-u*i+o*s)+r*(c*i-a*s)}function of(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],u=e[6],d=e[7],g=e[8],h=n[0],m=n[1],y=n[2],v=n[3],C=n[4],S=n[5],w=n[6],x=n[7],R=n[8];return t[0]=h*r+m*o+y*u,t[1]=h*i+m*s+y*d,t[2]=h*a+m*c+y*g,t[3]=v*r+C*o+S*u,t[4]=v*i+C*s+S*d,t[5]=v*a+C*c+S*g,t[6]=w*r+x*o+R*u,t[7]=w*i+x*s+R*d,t[8]=w*a+x*c+R*g,t}function aU(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],u=e[6],d=e[7],g=e[8],h=n[0],m=n[1];return t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=c,t[6]=h*r+m*o+u,t[7]=h*i+m*s+d,t[8]=h*a+m*c+g,t}function oU(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],u=e[6],d=e[7],g=e[8],h=Math.sin(n),m=Math.cos(n);return t[0]=m*r+h*o,t[1]=m*i+h*s,t[2]=m*a+h*c,t[3]=m*o-h*r,t[4]=m*s-h*i,t[5]=m*c-h*a,t[6]=u,t[7]=d,t[8]=g,t}function sU(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function cU(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function lU(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function uU(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function fU(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function gU(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,c=i+i,u=n*o,d=r*o,g=r*s,h=i*o,m=i*s,y=i*c,v=a*o,C=a*s,S=a*c;return t[0]=1-g-y,t[3]=d-S,t[6]=h+C,t[1]=d+S,t[4]=1-u-y,t[7]=m-v,t[2]=h-C,t[5]=m+v,t[8]=1-u-g,t}function dU(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],u=e[7],d=e[8],g=e[9],h=e[10],m=e[11],y=e[12],v=e[13],C=e[14],S=e[15],w=n*s-r*o,x=n*c-i*o,R=n*u-a*o,O=r*c-i*s,b=r*u-a*s,I=i*u-a*c,G=d*v-g*y,j=d*C-h*y,F=d*S-m*y,$=g*C-h*v,z=g*S-m*v,oe=h*S-m*C,Q=w*oe-x*z+R*$+O*F-b*j+I*G;return Q?(Q=1/Q,t[0]=(s*oe-c*z+u*$)*Q,t[1]=(c*F-o*oe-u*j)*Q,t[2]=(o*z-s*F+u*G)*Q,t[3]=(i*z-r*oe-a*$)*Q,t[4]=(n*oe-i*F+a*j)*Q,t[5]=(r*F-n*z-a*G)*Q,t[6]=(v*I-C*b+S*O)*Q,t[7]=(C*R-y*I-S*x)*Q,t[8]=(y*b-v*R+S*w)*Q,t):null}function hU(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function pU(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function mU(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function vU(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function fE(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function yU(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function TU(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function CU(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function SU(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],u=t[7],d=t[8],g=e[0],h=e[1],m=e[2],y=e[3],v=e[4],C=e[5],S=e[6],w=e[7],x=e[8];return Math.abs(n-g)<=rn*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(r-h)<=rn*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-m)<=rn*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(a-y)<=rn*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(o-v)<=rn*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-C)<=rn*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(c-S)<=rn*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(u-w)<=rn*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(d-x)<=rn*Math.max(1,Math.abs(d),Math.abs(x))}var wU=of,xU=fE;const EU=Object.freeze(Object.defineProperty({__proto__:null,add:vU,adjoint:iU,clone:nU,copy:rU,create:$v,determinant:Tl,equals:SU,exactEquals:CU,frob:mU,fromMat2d:fU,fromMat4:vp,fromQuat:gU,fromRotation:lU,fromScaling:uU,fromTranslation:cU,fromValues:Ug,identity:rs,invert:F1,mul:wU,multiply:of,multiplyScalar:yU,multiplyScalarAndAdd:TU,normalFromMat4:dU,projection:hU,rotate:oU,scale:sU,set:uE,str:pU,sub:xU,subtract:fE,translate:aU,transpose:Wv},Symbol.toStringTag,{value:"Module"}));function Ps(){var t=new Mr(16);return Mr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function RU(t){var e=new Mr(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function _r(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function gE(t,e,n,r,i,a,o,s,c,u,d,g,h,m,y,v){var C=new Mr(16);return C[0]=t,C[1]=e,C[2]=n,C[3]=r,C[4]=i,C[5]=a,C[6]=o,C[7]=s,C[8]=c,C[9]=u,C[10]=d,C[11]=g,C[12]=h,C[13]=m,C[14]=y,C[15]=v,C}function OU(t,e,n,r,i,a,o,s,c,u,d,g,h,m,y,v,C){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=c,t[8]=u,t[9]=d,t[10]=g,t[11]=h,t[12]=m,t[13]=y,t[14]=v,t[15]=C,t}function wt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qt(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Br(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],u=e[7],d=e[8],g=e[9],h=e[10],m=e[11],y=e[12],v=e[13],C=e[14],S=e[15],w=n*s-r*o,x=n*c-i*o,R=n*u-a*o,O=r*c-i*s,b=r*u-a*s,I=i*u-a*c,G=d*v-g*y,j=d*C-h*y,F=d*S-m*y,$=g*C-h*v,z=g*S-m*v,oe=h*S-m*C,Q=w*oe-x*z+R*$+O*F-b*j+I*G;return Q?(Q=1/Q,t[0]=(s*oe-c*z+u*$)*Q,t[1]=(i*z-r*oe-a*$)*Q,t[2]=(v*I-C*b+S*O)*Q,t[3]=(h*b-g*I-m*O)*Q,t[4]=(c*F-o*oe-u*j)*Q,t[5]=(n*oe-i*F+a*j)*Q,t[6]=(C*R-y*I-S*x)*Q,t[7]=(d*I-h*R+m*x)*Q,t[8]=(o*z-s*F+u*G)*Q,t[9]=(r*F-n*z-a*G)*Q,t[10]=(y*b-v*R+S*w)*Q,t[11]=(g*R-d*b-m*w)*Q,t[12]=(s*j-o*$-c*G)*Q,t[13]=(n*$-r*j+i*G)*Q,t[14]=(v*x-y*O-C*w)*Q,t[15]=(d*O-g*x+h*w)*Q,t):null}function DU(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],u=e[7],d=e[8],g=e[9],h=e[10],m=e[11],y=e[12],v=e[13],C=e[14],S=e[15];return t[0]=s*(h*S-m*C)-g*(c*S-u*C)+v*(c*m-u*h),t[1]=-(r*(h*S-m*C)-g*(i*S-a*C)+v*(i*m-a*h)),t[2]=r*(c*S-u*C)-s*(i*S-a*C)+v*(i*u-a*c),t[3]=-(r*(c*m-u*h)-s*(i*m-a*h)+g*(i*u-a*c)),t[4]=-(o*(h*S-m*C)-d*(c*S-u*C)+y*(c*m-u*h)),t[5]=n*(h*S-m*C)-d*(i*S-a*C)+y*(i*m-a*h),t[6]=-(n*(c*S-u*C)-o*(i*S-a*C)+y*(i*u-a*c)),t[7]=n*(c*m-u*h)-o*(i*m-a*h)+d*(i*u-a*c),t[8]=o*(g*S-m*v)-d*(s*S-u*v)+y*(s*m-u*g),t[9]=-(n*(g*S-m*v)-d*(r*S-a*v)+y*(r*m-a*g)),t[10]=n*(s*S-u*v)-o*(r*S-a*v)+y*(r*u-a*s),t[11]=-(n*(s*m-u*g)-o*(r*m-a*g)+d*(r*u-a*s)),t[12]=-(o*(g*C-h*v)-d*(s*C-c*v)+y*(s*h-c*g)),t[13]=n*(g*C-h*v)-d*(r*C-i*v)+y*(r*h-i*g),t[14]=-(n*(s*C-c*v)-o*(r*C-i*v)+y*(r*c-i*s)),t[15]=n*(s*h-c*g)-o*(r*h-i*g)+d*(r*c-i*s),t}function _U(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],c=t[7],u=t[8],d=t[9],g=t[10],h=t[11],m=t[12],y=t[13],v=t[14],C=t[15],S=e*o-n*a,w=e*s-r*a,x=e*c-i*a,R=n*s-r*o,O=n*c-i*o,b=r*c-i*s,I=u*y-d*m,G=u*v-g*m,j=u*C-h*m,F=d*v-g*y,$=d*C-h*y,z=g*C-h*v;return S*z-w*$+x*F+R*j-O*G+b*I}function zt(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],u=e[6],d=e[7],g=e[8],h=e[9],m=e[10],y=e[11],v=e[12],C=e[13],S=e[14],w=e[15],x=n[0],R=n[1],O=n[2],b=n[3];return t[0]=x*r+R*s+O*g+b*v,t[1]=x*i+R*c+O*h+b*C,t[2]=x*a+R*u+O*m+b*S,t[3]=x*o+R*d+O*y+b*w,x=n[4],R=n[5],O=n[6],b=n[7],t[4]=x*r+R*s+O*g+b*v,t[5]=x*i+R*c+O*h+b*C,t[6]=x*a+R*u+O*m+b*S,t[7]=x*o+R*d+O*y+b*w,x=n[8],R=n[9],O=n[10],b=n[11],t[8]=x*r+R*s+O*g+b*v,t[9]=x*i+R*c+O*h+b*C,t[10]=x*a+R*u+O*m+b*S,t[11]=x*o+R*d+O*y+b*w,x=n[12],R=n[13],O=n[14],b=n[15],t[12]=x*r+R*s+O*g+b*v,t[13]=x*i+R*c+O*h+b*C,t[14]=x*a+R*u+O*m+b*S,t[15]=x*o+R*d+O*y+b*w,t}function Gr(t,e,n){var r=n[0],i=n[1],a=n[2],o,s,c,u,d,g,h,m,y,v,C,S;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*a+e[12],t[13]=e[1]*r+e[5]*i+e[9]*a+e[13],t[14]=e[2]*r+e[6]*i+e[10]*a+e[14],t[15]=e[3]*r+e[7]*i+e[11]*a+e[15]):(o=e[0],s=e[1],c=e[2],u=e[3],d=e[4],g=e[5],h=e[6],m=e[7],y=e[8],v=e[9],C=e[10],S=e[11],t[0]=o,t[1]=s,t[2]=c,t[3]=u,t[4]=d,t[5]=g,t[6]=h,t[7]=m,t[8]=y,t[9]=v,t[10]=C,t[11]=S,t[12]=o*r+d*i+y*a+e[12],t[13]=s*r+g*i+v*a+e[13],t[14]=c*r+h*i+C*a+e[14],t[15]=u*r+m*i+S*a+e[15]),t}function Us(t,e,n){var r=n[0],i=n[1],a=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Yo(t,e,n,r){var i=r[0],a=r[1],o=r[2],s=Math.hypot(i,a,o),c,u,d,g,h,m,y,v,C,S,w,x,R,O,b,I,G,j,F,$,z,oe,Q,le;return s<rn?null:(s=1/s,i*=s,a*=s,o*=s,c=Math.sin(n),u=Math.cos(n),d=1-u,g=e[0],h=e[1],m=e[2],y=e[3],v=e[4],C=e[5],S=e[6],w=e[7],x=e[8],R=e[9],O=e[10],b=e[11],I=i*i*d+u,G=a*i*d+o*c,j=o*i*d-a*c,F=i*a*d-o*c,$=a*a*d+u,z=o*a*d+i*c,oe=i*o*d+a*c,Q=a*o*d-i*c,le=o*o*d+u,t[0]=g*I+v*G+x*j,t[1]=h*I+C*G+R*j,t[2]=m*I+S*G+O*j,t[3]=y*I+w*G+b*j,t[4]=g*F+v*$+x*z,t[5]=h*F+C*$+R*z,t[6]=m*F+S*$+O*z,t[7]=y*F+w*$+b*z,t[8]=g*oe+v*Q+x*le,t[9]=h*oe+C*Q+R*le,t[10]=m*oe+S*Q+O*le,t[11]=y*oe+w*Q+b*le,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function zv(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[4],o=e[5],s=e[6],c=e[7],u=e[8],d=e[9],g=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+u*r,t[5]=o*i+d*r,t[6]=s*i+g*r,t[7]=c*i+h*r,t[8]=u*i-a*r,t[9]=d*i-o*r,t[10]=g*i-s*r,t[11]=h*i-c*r,t}function Hv(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],c=e[3],u=e[8],d=e[9],g=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-u*r,t[1]=o*i-d*r,t[2]=s*i-g*r,t[3]=c*i-h*r,t[8]=a*r+u*i,t[9]=o*r+d*i,t[10]=s*r+g*i,t[11]=c*r+h*i,t}function jv(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],c=e[3],u=e[4],d=e[5],g=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+u*r,t[1]=o*i+d*r,t[2]=s*i+g*r,t[3]=c*i+h*r,t[4]=u*i-a*r,t[5]=d*i-o*r,t[6]=g*i-s*r,t[7]=h*i-c*r,t}function k1(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function qv(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Kv(t,e,n){var r=n[0],i=n[1],a=n[2],o=Math.hypot(r,i,a),s,c,u;return o<rn?null:(o=1/o,r*=o,i*=o,a*=o,s=Math.sin(e),c=Math.cos(e),u=1-c,t[0]=r*r*u+c,t[1]=i*r*u+a*s,t[2]=a*r*u-i*s,t[3]=0,t[4]=r*i*u-a*s,t[5]=i*i*u+c,t[6]=a*i*u+r*s,t[7]=0,t[8]=r*a*u+i*s,t[9]=i*a*u-r*s,t[10]=a*a*u+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function bU(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function MU(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function LU(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function dE(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=r+r,c=i+i,u=a+a,d=r*s,g=r*c,h=r*u,m=i*c,y=i*u,v=a*u,C=o*s,S=o*c,w=o*u;return t[0]=1-(m+v),t[1]=g+w,t[2]=h-S,t[3]=0,t[4]=g-w,t[5]=1-(d+v),t[6]=y+C,t[7]=0,t[8]=h+S,t[9]=y-C,t[10]=1-(d+m),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function VU(t,e){var n=new Mr(3),r=-e[0],i=-e[1],a=-e[2],o=e[3],s=e[4],c=e[5],u=e[6],d=e[7],g=r*r+i*i+a*a+o*o;return g>0?(n[0]=(s*o+d*r+c*a-u*i)*2/g,n[1]=(c*o+d*i+u*r-s*a)*2/g,n[2]=(u*o+d*a+s*i-c*r)*2/g):(n[0]=(s*o+d*r+c*a-u*i)*2,n[1]=(c*o+d*i+u*r-s*a)*2,n[2]=(u*o+d*a+s*i-c*r)*2),dE(t,e,n),t}function IU(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function hE(t,e){var n=e[0],r=e[1],i=e[2],a=e[4],o=e[5],s=e[6],c=e[8],u=e[9],d=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(a,o,s),t[2]=Math.hypot(c,u,d),t}function M4(t,e){var n=new Mr(3);hE(n,e);var r=1/n[0],i=1/n[1],a=1/n[2],o=e[0]*r,s=e[1]*i,c=e[2]*a,u=e[4]*r,d=e[5]*i,g=e[6]*a,h=e[8]*r,m=e[9]*i,y=e[10]*a,v=o+d+y,C=0;return v>0?(C=Math.sqrt(v+1)*2,t[3]=.25*C,t[0]=(g-m)/C,t[1]=(h-c)/C,t[2]=(s-u)/C):o>d&&o>y?(C=Math.sqrt(1+o-d-y)*2,t[3]=(g-m)/C,t[0]=.25*C,t[1]=(s+u)/C,t[2]=(h+c)/C):d>y?(C=Math.sqrt(1+d-o-y)*2,t[3]=(h-c)/C,t[0]=(s+u)/C,t[1]=.25*C,t[2]=(g+m)/C):(C=Math.sqrt(1+y-o-d)*2,t[3]=(s-u)/C,t[0]=(h+c)/C,t[1]=(g+m)/C,t[2]=.25*C),t}function pE(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3],c=i+i,u=a+a,d=o+o,g=i*c,h=i*u,m=i*d,y=a*u,v=a*d,C=o*d,S=s*c,w=s*u,x=s*d,R=r[0],O=r[1],b=r[2];return t[0]=(1-(y+C))*R,t[1]=(h+x)*R,t[2]=(m-w)*R,t[3]=0,t[4]=(h-x)*O,t[5]=(1-(g+C))*O,t[6]=(v+S)*O,t[7]=0,t[8]=(m+w)*b,t[9]=(v-S)*b,t[10]=(1-(g+y))*b,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function AU(t,e,n,r,i){var a=e[0],o=e[1],s=e[2],c=e[3],u=a+a,d=o+o,g=s+s,h=a*u,m=a*d,y=a*g,v=o*d,C=o*g,S=s*g,w=c*u,x=c*d,R=c*g,O=r[0],b=r[1],I=r[2],G=i[0],j=i[1],F=i[2],$=(1-(v+S))*O,z=(m+R)*O,oe=(y-x)*O,Q=(m-R)*b,le=(1-(h+S))*b,X=(C+w)*b,ie=(y+x)*I,ye=(C-w)*I,ge=(1-(h+v))*I;return t[0]=$,t[1]=z,t[2]=oe,t[3]=0,t[4]=Q,t[5]=le,t[6]=X,t[7]=0,t[8]=ie,t[9]=ye,t[10]=ge,t[11]=0,t[12]=n[0]+G-($*G+Q*j+ie*F),t[13]=n[1]+j-(z*G+le*j+ye*F),t[14]=n[2]+F-(oe*G+X*j+ge*F),t[15]=1,t}function L2(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,c=i+i,u=n*o,d=r*o,g=r*s,h=i*o,m=i*s,y=i*c,v=a*o,C=a*s,S=a*c;return t[0]=1-g-y,t[1]=d+S,t[2]=h-C,t[3]=0,t[4]=d-S,t[5]=1-u-y,t[6]=m+v,t[7]=0,t[8]=h+C,t[9]=m-v,t[10]=1-u-g,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function NU(t,e,n,r,i,a,o){var s=1/(n-e),c=1/(i-r),u=1/(a-o);return t[0]=a*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*c,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*c,t[10]=(o+a)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*u,t[15]=0,t}function mE(t,e,n,r,i){var a=1/Math.tan(e/2),o;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var PU=mE;function UU(t,e,n,r,i){var a=1/Math.tan(e/2),o;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t}function FU(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),c=2/(o+s),u=2/(i+a);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((o-s)*c*.5),t[9]=(i-a)*u*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function vE(t,e,n,r,i,a,o){var s=1/(e-n),c=1/(r-i),u=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*c,t[14]=(o+a)*u,t[15]=1,t}var Yv=vE;function kU(t,e,n,r,i,a,o){var s=1/(e-n),c=1/(r-i),u=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*c,t[14]=a*u,t[15]=1,t}function yE(t,e,n,r){var i,a,o,s,c,u,d,g,h,m,y=e[0],v=e[1],C=e[2],S=r[0],w=r[1],x=r[2],R=n[0],O=n[1],b=n[2];return Math.abs(y-R)<rn&&Math.abs(v-O)<rn&&Math.abs(C-b)<rn?wt(t):(d=y-R,g=v-O,h=C-b,m=1/Math.hypot(d,g,h),d*=m,g*=m,h*=m,i=w*h-x*g,a=x*d-S*h,o=S*g-w*d,m=Math.hypot(i,a,o),m?(m=1/m,i*=m,a*=m,o*=m):(i=0,a=0,o=0),s=g*o-h*a,c=h*i-d*o,u=d*a-g*i,m=Math.hypot(s,c,u),m?(m=1/m,s*=m,c*=m,u*=m):(s=0,c=0,u=0),t[0]=i,t[1]=s,t[2]=d,t[3]=0,t[4]=a,t[5]=c,t[6]=g,t[7]=0,t[8]=o,t[9]=u,t[10]=h,t[11]=0,t[12]=-(i*y+a*v+o*C),t[13]=-(s*y+c*v+u*C),t[14]=-(d*y+g*v+h*C),t[15]=1,t)}function GU(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=r[0],c=r[1],u=r[2],d=i-n[0],g=a-n[1],h=o-n[2],m=d*d+g*g+h*h;m>0&&(m=1/Math.sqrt(m),d*=m,g*=m,h*=m);var y=c*h-u*g,v=u*d-s*h,C=s*g-c*d;return m=y*y+v*v+C*C,m>0&&(m=1/Math.sqrt(m),y*=m,v*=m,C*=m),t[0]=y,t[1]=v,t[2]=C,t[3]=0,t[4]=g*C-h*v,t[5]=h*y-d*C,t[6]=d*v-g*y,t[7]=0,t[8]=d,t[9]=g,t[10]=h,t[11]=0,t[12]=i,t[13]=a,t[14]=o,t[15]=1,t}function BU(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function $U(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function WU(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function TE(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function zU(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function HU(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function jU(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function qU(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],u=t[7],d=t[8],g=t[9],h=t[10],m=t[11],y=t[12],v=t[13],C=t[14],S=t[15],w=e[0],x=e[1],R=e[2],O=e[3],b=e[4],I=e[5],G=e[6],j=e[7],F=e[8],$=e[9],z=e[10],oe=e[11],Q=e[12],le=e[13],X=e[14],ie=e[15];return Math.abs(n-w)<=rn*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(r-x)<=rn*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(i-R)<=rn*Math.max(1,Math.abs(i),Math.abs(R))&&Math.abs(a-O)<=rn*Math.max(1,Math.abs(a),Math.abs(O))&&Math.abs(o-b)<=rn*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-I)<=rn*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(c-G)<=rn*Math.max(1,Math.abs(c),Math.abs(G))&&Math.abs(u-j)<=rn*Math.max(1,Math.abs(u),Math.abs(j))&&Math.abs(d-F)<=rn*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(g-$)<=rn*Math.max(1,Math.abs(g),Math.abs($))&&Math.abs(h-z)<=rn*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(m-oe)<=rn*Math.max(1,Math.abs(m),Math.abs(oe))&&Math.abs(y-Q)<=rn*Math.max(1,Math.abs(y),Math.abs(Q))&&Math.abs(v-le)<=rn*Math.max(1,Math.abs(v),Math.abs(le))&&Math.abs(C-X)<=rn*Math.max(1,Math.abs(C),Math.abs(X))&&Math.abs(S-ie)<=rn*Math.max(1,Math.abs(S),Math.abs(ie))}var V2=zt,KU=TE;const I2=Object.freeze(Object.defineProperty({__proto__:null,add:WU,adjoint:DU,clone:RU,copy:_r,create:Ps,determinant:_U,equals:qU,exactEquals:jU,frob:$U,fromQuat:L2,fromQuat2:VU,fromRotation:Kv,fromRotationTranslation:dE,fromRotationTranslationScale:pE,fromRotationTranslationScaleOrigin:AU,fromScaling:qv,fromTranslation:k1,fromValues:gE,fromXRotation:bU,fromYRotation:MU,fromZRotation:LU,frustum:NU,getRotation:M4,getScaling:hE,getTranslation:IU,identity:wt,invert:Br,lookAt:yE,mul:V2,multiply:zt,multiplyScalar:zU,multiplyScalarAndAdd:HU,ortho:Yv,orthoNO:vE,orthoZO:kU,perspective:PU,perspectiveFromFieldOfView:FU,perspectiveNO:mE,perspectiveZO:UU,rotate:Yo,rotateX:zv,rotateY:Hv,rotateZ:jv,scale:Us,set:OU,str:BU,sub:KU,subtract:TE,targetTo:GU,translate:Gr,transpose:Qt},Symbol.toStringTag,{value:"Module"}));function Ke(){var t=new Mr(3);return Mr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function CE(t){var e=new Mr(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Gc(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function on(t,e,n){var r=new Mr(3);return r[0]=t,r[1]=e,r[2]=n,r}function YU(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function gn(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function z0(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function ei(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function XU(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ZU(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function bs(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Si(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function y1(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function Bc(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function SE(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Sn(t,e){var n=e[0],r=e[1],i=e[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function ft(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Cn(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],c=n[2];return t[0]=i*c-a*s,t[1]=a*o-r*c,t[2]=r*s-i*o,t}function an(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,t}function Kh(t,e,n){var r=e[0],i=e[1],a=e[2];return t[0]=r*n[0]+i*n[3]+a*n[6],t[1]=r*n[1]+i*n[4]+a*n[7],t[2]=r*n[2]+i*n[5]+a*n[8],t}function wE(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],o=e[1],s=e[2],c=Math.sqrt(n*n+r*r+i*i),u=Math.sqrt(a*a+o*o+s*s),d=c*u,g=d&&ft(t,e)/d;return Math.acos(Math.min(Math.max(g,-1),1))}function QU(t){return t[0]=0,t[1]=0,t[2]=0,t}function MT(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function LT(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],o=e[1],s=e[2];return Math.abs(n-a)<=rn*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=rn*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=rn*Math.max(1,Math.abs(i),Math.abs(s))}var hn=ei,JU=XU,A2=Gc;(function(){var t=Ke();return function(e,n,r,i,a,o){var s,c;for(n||(n=3),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,s=r;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}})();function eF(){var t=new Mr(4);return Mr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function tF(t,e,n,r){var i=new Mr(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function VT(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function nF(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=a*o,t}function bl(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,t}(function(){var t=eF();return function(e,n,r,i,a,o){var s,c;for(n||(n=4),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,s=r;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}})();function Bl(){var t=new Mr(4);return Mr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Xv(t,e,n){n=n*.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function rF(t,e){var n=Math.acos(e[3])*2,r=Math.sin(n/2);return r>rn?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function IT(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=n[0],c=n[1],u=n[2],d=n[3];return t[0]=r*d+o*s+i*u-a*c,t[1]=i*d+o*c+a*s-r*u,t[2]=a*d+o*u+r*c-i*s,t[3]=o*d-r*s-i*c-a*u,t}function Yh(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3],c=n[0],u=n[1],d=n[2],g=n[3],h,m,y,v,C;return m=i*c+a*u+o*d+s*g,m<0&&(m=-m,c=-c,u=-u,d=-d,g=-g),1-m>rn?(h=Math.acos(m),y=Math.sin(h),v=Math.sin((1-r)*h)/y,C=Math.sin(r*h)/y):(v=1-r,C=r),t[0]=v*i+C*c,t[1]=v*a+C*u,t[2]=v*o+C*d,t[3]=v*s+C*g,t}function iF(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function aF(t,e){var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[i*3+i]-e[a*3+a]-e[o*3+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[a*3+o]-e[o*3+a])*r,t[a]=(e[a*3+i]+e[i*3+a])*r,t[o]=(e[o*3+i]+e[i*3+o])*r}return t}var AT=tF,xE=nF;(function(){var t=Ke(),e=on(1,0,0),n=on(0,1,0);return function(r,i,a){var o=ft(i,a);return o<-.999999?(Cn(t,e,i),A2(t)<1e-6&&Cn(t,n,i),Sn(t,t),Xv(r,t,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Cn(t,i,a),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+o,xE(r,r))}})();(function(){var t=Bl(),e=Bl();return function(n,r,i,a,o,s){return Yh(t,r,o,s),Yh(e,i,a,s),Yh(n,t,e,2*s*(1-s)),n}})();(function(){var t=$v();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],xE(e,aF(e,t))}})();function tr(){var t=new Mr(2);return Mr!=Float32Array&&(t[0]=0,t[1]=0),t}function NT(t,e){var n=new Mr(2);return n[0]=t,n[1]=e,n}function Yu(t,e,n){return t[0]=e,t[1]=n,t}function Zv(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function Ni(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function PT(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function ah(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function wi(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function P0(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function EE(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function Cl(t,e){return t[0]*e[0]+t[1]*e[1]}var N2=Ni,Qv=wi;(function(){var t=tr();return function(e,n,r,i,a,o){var s,c;for(n||(n=2),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,s=r;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],a(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}})();function da(t){const e=t.indexOf(":");return t.substring(e+1)}function RE(t){let e=2166136261;for(let n=0;n<t.length;n++)e^=t.charCodeAt(n),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return(e>>>0).toString(36)}const oF=1073741824;class sF{constructor(){this._imageCache=new Map,this._volumeCache=new Map,this._imageIdsToVolumeIdCache=new Map,this._referencedImageIdToImageIdCache=new Map,this._geometryCache=new Map,this._imageCacheSize=0,this._maxCacheSize=3*oF,this._geometryCacheSize=0,this.setMaxCacheSize=e=>{if(!e||typeof e!="number"){const n=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(n)}this._maxCacheSize=e},this.isCacheable=e=>{const n=this.getBytesAvailable(),r=Array.from(this._imageCache.values()).reduce((a,o)=>o.sharedCacheKey?a:a+o.sizeInBytes,0);return n+r>=e},this.getMaxCacheSize=()=>this._maxCacheSize,this.getCacheSize=()=>this._imageCacheSize,this._decacheImage=(e,n=!1)=>{const r=this._imageCache.get(e);if(!r)return;if(r.sharedCacheKey&&!n)throw new Error("Cannot decache an image with a shared cache key. You need to manually decache the volume first.");const{imageLoadObject:i}=r;r.image?.referencedImageId&&this._referencedImageIdToImageIdCache.delete(r.image.referencedImageId),i?.cancelFn&&i.cancelFn(),i?.decache&&i.decache(),this._imageCache.delete(e)},this._decacheVolume=e=>{const n=this._volumeCache.get(e);if(!n)return;const{volumeLoadObject:r,volume:i}=n;i&&(i.cancelLoading&&i.cancelLoading(),i.imageData&&i.imageData.delete(),r.cancelFn&&r.cancelFn(),i.imageIds&&i.imageIds.forEach(a=>{const o=this._imageCache.get(a);o&&o.sharedCacheKey===e&&(o.sharedCacheKey=void 0)}),this._volumeCache.delete(e))},this.purgeCache=()=>{const e=this._imageCache.keys();for(this.purgeVolumeCache();;){const{value:n,done:r}=e.next();if(r)break;this.removeImageLoadObject(n,{force:!0}),je(Ye,We.IMAGE_CACHE_IMAGE_REMOVED,{imageId:n})}},this.purgeVolumeCache=()=>{const e=this._volumeCache.keys();for(;;){const{value:n,done:r}=e.next();if(r)break;this.removeVolumeLoadObject(n),je(Ye,We.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:n})}},this.getVolumeLoadObject=e=>{if(e===void 0)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(n)return n.timeStamp=Date.now(),n.volumeLoadObject},this.putGeometryLoadObject=(e,n)=>{if(e===void 0)throw new Error("putGeometryLoadObject: geometryId must not be undefined");if(n.promise===void 0)throw new Error("putGeometryLoadObject: geometryLoadObject.promise must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometryLoadObject: geometryId already present in geometryCache");if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putGeometryLoadObject: geometryLoadObject.cancel must be a function");const r={loaded:!1,geometryId:e,geometryLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._geometryCache.set(e,r),n.promise.then(i=>{try{this._putGeometryCommon(e,i,r)}catch(a){throw console.debug(`Error in _putGeometryCommon for geometry ${e}:`,a),a}}).catch(i=>{throw console.debug(`Error caching geometry ${e}:`,i),this._geometryCache.delete(e),i})},this.getGeometry=e=>{if(e===void 0)throw new Error("getGeometry: geometryId must not be undefined");const n=this._geometryCache.get(e);if(n)return n.timeStamp=Date.now(),n.geometry},this.removeGeometryLoadObject=e=>{if(e===void 0)throw new Error("removeGeometryLoadObject: geometryId must not be undefined");const n=this._geometryCache.get(e);if(!n)throw new Error("removeGeometryLoadObject: geometryId was not present in geometryCache");this.decrementGeometryCacheSize(n.sizeInBytes);const r={geometry:n,geometryId:e};je(Ye,We.GEOMETRY_CACHE_GEOMETRY_REMOVED,r),this._decacheGeometry(e)},this._decacheGeometry=e=>{const n=this._geometryCache.get(e);if(!n)return;const{geometryLoadObject:r}=n;r.cancelFn&&r.cancelFn(),r.decache&&r.decache(),this._geometryCache.delete(e)},this.incrementGeometryCacheSize=e=>{this._geometryCacheSize+=e},this.decrementGeometryCacheSize=e=>{this._geometryCacheSize-=e},this.getImageByReferencedImageId=e=>{const n=this._referencedImageIdToImageIdCache.get(e);if(n)return this._imageCache.get(n)?.image},this.getImage=(e,n=no.FAR_REPLICATE)=>{if(e===void 0)throw new Error("getImage: imageId must not be undefined");const r=this._imageCache.get(e);if(r&&(r.timeStamp=Date.now(),!(r.image?.imageQualityStatus<n)))return r.image},this.getVolume=(e,n=!1)=>{if(e===void 0)throw new Error("getVolume: volumeId must not be undefined");const r=this._volumeCache.get(e);return r?(r.timeStamp=Date.now(),r.volume):n?[...this._volumeCache.values()].find(i=>i.volumeId.includes(e))?.volume:void 0},this.getVolumes=()=>Array.from(this._volumeCache.values()).map(n=>n.volume),this.filterVolumesByReferenceId=e=>this.getVolumes().filter(r=>r.referencedVolumeId===e),this.removeImageLoadObject=(e,{force:n=!1}={})=>{if(e===void 0)throw new Error("removeImageLoadObject: imageId must not be undefined");const r=this._imageCache.get(e);if(!r)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this._decacheImage(e,n),this.incrementImageCacheSize(-r.sizeInBytes);const i={image:r,imageId:e};je(Ye,We.IMAGE_CACHE_IMAGE_REMOVED,i)},this.removeVolumeLoadObject=e=>{if(e===void 0)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(!n)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");const r={volume:n,volumeId:e};je(Ye,We.VOLUME_CACHE_VOLUME_REMOVED,r),this._decacheVolume(e)},this.incrementImageCacheSize=e=>{this._imageCacheSize+=e},this.decrementImageCacheSize=e=>{this._imageCacheSize-=e},this.getGeometryLoadObject=e=>{if(e===void 0)throw new Error("getGeometryLoadObject: geometryId must not be undefined");const n=this._geometryCache.get(e);if(n)return n.timeStamp=Date.now(),n.geometryLoadObject}}generateVolumeId(e){const n=e.map(da).sort();let r=2166136261;for(const i of n){const a=RE(i);for(let o=0;o<a.length;o++)r^=a.charCodeAt(o),r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24)}return`volume-${(r>>>0).toString(36)}`}getImageIdsForVolumeId(e){return Array.from(this._imageIdsToVolumeIdCache.entries()).filter(([n,r])=>r===e).map(([n])=>n)}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(e,n){let r=this.getBytesAvailable();if(r>=e)return r;const i=Array.from(this._imageCache.values()).filter(c=>!c.sharedCacheKey);function a(c,u){return c.timeStamp>u.timeStamp?1:c.timeStamp<u.timeStamp?-1:0}i.sort(a);const o=i.map(c=>c.imageId);let s=o;n&&(s=o.filter(c=>!n.includes(c)));for(const c of s)if(this.removeImageLoadObject(c),je(Ye,We.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),r=this.getBytesAvailable(),r>=e)return r;for(const c of o)if(this.removeImageLoadObject(c),je(Ye,We.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),r=this.getBytesAvailable(),r>=e)return r}_putImageCommon(e,n,r){if(!this._imageCache.has(e)){console.warn("The image was purged from the cache before it completed loading.");return}if(!n){console.warn("Image is undefined");return}if(n.sizeInBytes===void 0||Number.isNaN(n.sizeInBytes))throw new Error("_putImageCommon: image.sizeInBytes must not be undefined");if(n.sizeInBytes.toFixed===void 0)throw new Error("_putImageCommon: image.sizeInBytes is not a number");if(!this.isCacheable(n.sizeInBytes))throw new Error(We.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(n.sizeInBytes),r.loaded=!0,r.image=n,r.sizeInBytes=n.sizeInBytes,this.incrementImageCacheSize(r.sizeInBytes);const i={image:r};n.referencedImageId&&this._referencedImageIdToImageIdCache.set(n.referencedImageId,e),je(Ye,We.IMAGE_CACHE_IMAGE_ADDED,i),r.sharedCacheKey=n.sharedCacheKey}async putImageLoadObject(e,n){if(e===void 0)throw console.error("putImageLoadObject: imageId must not be undefined"),new Error("putImageLoadObject: imageId must not be undefined");if(n.promise===void 0)throw console.error("putImageLoadObject: imageLoadObject.promise must not be undefined"),new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");const r=this._imageCache.get(e);if(r?.imageLoadObject)throw console.warn(`putImageLoadObject: imageId ${e} already in cache`),new Error("putImageLoadObject: imageId already in cache");if(n.cancelFn&&typeof n.cancelFn!="function")throw console.error("putImageLoadObject: imageLoadObject.cancel must be a function"),new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const i={...r,loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(e,i),n.promise.then(a=>{try{this._putImageCommon(e,a,i)}catch(o){throw console.debug(`Error in _putImageCommon for image ${e}:`,o),o}}).catch(a=>{throw console.debug(`Error caching image ${e}:`,a),this._imageCache.delete(e),a})}putImageSync(e,n){if(e===void 0)throw new Error("putImageSync: imageId must not be undefined");if(this._imageCache.has(e))throw new Error("putImageSync: imageId already in cache");const r={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._imageCache.set(e,r);try{this._putImageCommon(e,n,r)}catch(i){throw this._imageCache.delete(e),i}}getImageLoadObject(e){if(e===void 0)throw new Error("getImageLoadObject: imageId must not be undefined");const n=this._imageCache.get(e);if(n)return n.timeStamp=Date.now(),n.imageLoadObject}isLoaded(e){const n=this._imageCache.get(e);return n?n.loaded:!1}getVolumeContainingImageId(e){const n=Array.from(this._volumeCache.keys()),r=da(e);for(const i of n){const a=this._volumeCache.get(i);if(!a)return;const{volume:o}=a;if(!o.imageIds.length)return;const s=o.getImageURIIndex(r);if(s>-1)return{volume:o,imageIdIndex:s}}}getCachedImageBasedOnImageURI(e){const n=da(e),i=Array.from(this._imageCache.keys()).find(a=>da(a)===n);if(i)return this._imageCache.get(i)}_putVolumeCommon(e,n,r){if(!this._volumeCache.get(e)){console.warn("The volume was purged from the cache before it completed loading.");return}r.loaded=!0,r.volume=n,n.imageIds?.forEach(a=>{const o=this._imageCache.get(a);o&&(o.sharedCacheKey=e)});const i={volume:r};je(Ye,We.VOLUME_CACHE_VOLUME_ADDED,i)}putVolumeSync(e,n){if(e===void 0)throw new Error("putVolumeSync: volumeId must not be undefined");if(this._volumeCache.has(e))throw new Error("putVolumeSync: volumeId already in cache");const r={loaded:!1,volumeId:e,volumeLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._volumeCache.set(e,r);try{this._putVolumeCommon(e,n,r)}catch(i){throw this._volumeCache.delete(e),i}}async putVolumeLoadObject(e,n){if(e===void 0)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(n.promise===void 0)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(e))throw new Error(`putVolumeLoadObject: volumeId:${e} already in cache`);if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const r={loaded:!1,volumeId:e,volumeLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(e,r),n.promise.then(i=>{try{this._putVolumeCommon(e,i,r)}catch(a){throw console.error(`Error in _putVolumeCommon for volume ${e}:`,a),this._volumeCache.delete(e),a}}).catch(i=>{throw this._volumeCache.delete(e),i})}_putGeometryCommon(e,n,r){if(!this._geometryCache.get(e)){console.warn("The geometry was purged from the cache before it completed loading.");return}if(!n){console.warn("Geometry is undefined");return}if(n.sizeInBytes===void 0||Number.isNaN(n.sizeInBytes))throw new Error("_putGeometryCommon: geometry.sizeInBytes must not be undefined");if(n.sizeInBytes.toFixed===void 0)throw new Error("_putGeometryCommon: geometry.sizeInBytes is not a number");if(!this.isCacheable(n.sizeInBytes))throw new Error(We.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(n.sizeInBytes),r.loaded=!0,r.geometry=n,r.sizeInBytes=n.sizeInBytes,this.incrementGeometryCacheSize(r.sizeInBytes);const i={geometry:r};je(Ye,We.GEOMETRY_CACHE_GEOMETRY_ADDED,i)}putGeometrySync(e,n){if(e===void 0)throw new Error("putGeometrySync: geometryId must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometrySync: geometryId already in cache");const r={loaded:!1,geometryId:e,geometryLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._geometryCache.set(e,r);try{this._putGeometryCommon(e,n,r)}catch(i){throw this._geometryCache.delete(e),i}}setPartialImage(e,n){const r=this._imageCache.get(e);if(!r){n&&this._imageCache.set(e,{image:n,imageId:e,loaded:!1,timeStamp:Date.now(),sizeInBytes:0});return}r.loaded&&(r.loaded=!1,r.imageLoadObject=null,this.incrementImageCacheSize(-r.sizeInBytes),r.sizeInBytes=0),r.image=n||r.image}getImageQuality(e){const n=this._imageCache.get(e)?.image;return n?n.imageQualityStatus||no.FULL_RESOLUTION:void 0}}const rt=new sF;function OE(t,e,n){return Math.abs(t-e)<=n}function cF(t,e,n=1e-5){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!OE(t[r],e[r],n))return!1;return!0}function UT(t){return typeof t=="number"}function FT(t){return t&&typeof t=="object"&&"length"in t&&typeof t.length=="number"&&t.length>0&&typeof t[0]=="number"}function Tn(t,e,n=1e-5){return typeof t!=typeof e||t===null||e===null?!1:UT(t)&&UT(e)?OE(t,e,n):FT(t)&&FT(e)?cF(t,e,n):!1}const DE=t=>typeof t=="number"?-t:t?.map?t.map(DE):!t,L4=t=>typeof t=="number"?Math.abs(t):t?.map?t.map(L4):t,_E=(t,e,n=void 0)=>Tn(t,DE(e),n),Xh=(t,e,n=void 0)=>Tn(L4(t),L4(e),n);function Rc(t){return Array.isArray(t)?Rc(t[0]):isFinite(t)&&!isNaN(t)}function Jo(t){return Aa(t,"vtkVolume")||Aa(t,"vtkImageSlice")}function Aa(t,e){const n="isA"in t?t:t.actor;return n?!!n.isA(e):!1}const Jv=new Map;function lF(t){t.name=t.name||t.Name,Jv.set(t.name,t)}function T1(t){return Jv.get(t)}function bE(){return Array.from(Jv.keys())}function e8(t,e){const n=v1.rgbPresetNames.map(c=>v1.getPresetByName(c)),r=bE().map(c=>T1(c)),a=n.concat(r).find(c=>{const{RGBPoints:u}=c;if(u.length!==t.length)return!1;for(let d=0;d<u.length;d+=4)if(!Tn(u.slice(d+1,d+4),t.slice(d+1,d+4)))return!1;return!0});if(!a)return null;const o=[];if(Aa(e,"vtkVolume")){const c=e.getProperty().getScalarOpacity(0).getDataPointer();if(!c)return{name:a.Name};for(let u=0;u<c.length;u+=2)o.push({value:c[u],opacity:c[u+1]})}return{name:a.Name,...Array.isArray(o)&&o.length>0&&{opacity:o},...typeof o=="number"&&{opacity:o}}}function uF(t){const{volumeActor:e,preset:n,opacity:r=.9,threshold:i=null,colorRange:a=[0,5]}=t;e.getMapper().setSampleDistance(1);const s=Xc.newInstance(),c=n||v1.getPresetByName("hsv");s.applyColorMap(c),s.setMappingRange(a[0],a[1]),e.getProperty().setRGBTransferFunction(0,s),t8(e,r,i)}function ME(t,e){const n=n8(t);t8(t,e,n)}function LE(t,e){const n=r8(t);t8(t,n,e)}function t8(t,e,n){const r=t.getMapper().getInputData().get("voxelManager");if(!r?.voxelManager)throw new Error("No voxel manager was found for the volume actor, or you cannot yet update opacity with a threshold using stacked images");const i=r.voxelManager.getRange(),a=Gl.newInstance();if(n!==null){const o=Math.abs(i[1]-i[0])*.001,s=Math.max(i[0],Math.min(i[1],n));a.addPoint(i[0],0),a.addPoint(s-o,0),a.addPoint(s,e),a.addPoint(i[1],e)}else a.addPoint(i[0],e),a.addPoint(i[1],e);t.getProperty().setScalarOpacity(0,a)}function n8(t){const e=t.getProperty().getScalarOpacity(0);if(!e)return null;const n=e.getDataPointer();if(!n||n.length<=4)return null;for(let r=0;r<n.length-2;r+=2){n[r];const i=n[r+1],a=n[r+2],o=n[r+3];if(i===0&&o>0)return a}return null}function r8(t){const e=t.getProperty().getScalarOpacity(0);if(!e)return 1;const n=e.getDataPointer();if(!n||n.length===0)return 1;let r=0;for(let i=1;i<n.length;i+=2)n[i]>r&&(r=n[i]);return r}const fF=Object.freeze(Object.defineProperty({__proto__:null,findMatchingColormap:e8,getColormap:T1,getColormapNames:bE,getMaxOpacity:r8,getThresholdValue:n8,registerColormap:lF,setColorMapTransferFunctionForVolumeActor:uF,updateOpacity:ME,updateThreshold:LE},Symbol.toStringTag,{value:"Module"}));function Zg(t){if(!t)return;const e=t.getSize();for(let n=0;n<e;n++){const r=[];t.getNodeValue(n,r),r[1]=1-r[1],r[2]=1-r[2],r[3]=1-r[3],t.setNodeValue(n,r)}}const V4=(t,e,n)=>e-n/4*Math.log((1-t)/t);function yp(t,e){const n=Math.abs(e-t)+1,r=(t+e+1)/2;return{windowWidth:n,windowCenter:r}}function Qg(t,e,n=Pi.LINEAR){if(n===Pi.LINEAR)return{lower:e-.5-(t-1)/2,upper:e-.5+(t-1)/2};if(n===Pi.LINEAR_EXACT)return{lower:e-t/2,upper:e+t/2};if(n===Pi.SAMPLED_SIGMOID){const r=V4(.01,e,t),i=V4(.99,e,t);return{lower:r,upper:i}}else throw new Error("Invalid VOI LUT function")}const gF=Object.freeze(Object.defineProperty({__proto__:null,toLowHighRange:Qg,toWindowLevel:yp},Symbol.toStringTag,{value:"Module"}));function i8(t,e=1024){const{windowWidth:n,windowCenter:r}=yp(t.lower,t.upper),a=Array.from({length:e},(s,c)=>(c+1)/(e+2)).flatMap(s=>[V4(s,r,n),s,s,s,.5,0]),o=Xc.newInstance();return o.buildFunctionFromArray(Pt.newInstance({values:a,numberOfComponents:6})),o}function Vc(t,e){return t.worldToIndex(e).map(Math.round)}function Zh(t,e){return t.worldToIndex(e)}function P2(t){const e=t.getSize(),n=[];for(let r=0;r<e;r++){const i=[];t.getNodeValue(r,i),n.push(i)}return n}function Tp(t,e){e?.length&&(t.removeAllPoints(),e.forEach(n=>{t.addRGBPoint(...n)}))}const dF=Object.freeze(Object.defineProperty({__proto__:null,getTransferFunctionNodes:P2,setTransferFunctionNodes:Tp},Symbol.toStringTag,{value:"Module"}));function hF(t,e){e.classHierarchy.push("vtkImplicitFunction"),t.functionValue=n=>{if(!e.transform)return t.evaluateFunction(n);const r=[];return e.transform.transformPoint(n,r),t.evaluateFunction(r)},t.evaluateFunction=n=>{H.vtkErrorMacro("not implemented")}}const pF={};function VE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pF,n),H.obj(t,e),H.setGet(t,e,["transform"]),hF(t,e)}const mF=H.newInstance(VE,"vtkImplicitFunction");var vF={newInstance:mF,extend:VE};const I4=1e-6,IE="coincide",AE="disjoint";function yF(t,e,n){return t[0]*(n[0]-e[0])+t[1]*(n[1]-e[1])+t[2]*(n[2]-e[2])}function NE(t,e,n){const r=n[0]*(t[0]-e[0])+n[1]*(t[1]-e[1])+n[2]*(t[2]-e[2]);return Math.abs(r)}function PE(t,e,n,r){const i=[];kc(t,e,i);const a=Ft(n,i);r[0]=t[0]-a*n[0],r[1]=t[1]-a*n[1],r[2]=t[2]-a*n[2]}function UE(t,e,n){const r=Ft(t,e);let i=Ft(e,e);return i===0&&(i=1),n[0]=t[0]-r*e[0]/i,n[1]=t[1]-r*e[1]/i,n[2]=t[2]-r*e[2]/i,n}function FE(t,e,n,r){const i=[];kc(t,e,i);const a=Ft(n,i),o=Ft(n,n);o!==0?(r[0]=t[0]-a*n[0]/o,r[1]=t[1]-a*n[1]/o,r[2]=t[2]-a*n[2]/o):(r[0]=t[0],r[1]=t[1],r[2]=t[2])}function kE(t,e,n,r){const i={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},a=[],o=[];kc(e,t,a),kc(n,t,o);const s=Ft(r,o),c=Ft(r,a);let u,d;return c<0?u=-c:u=c,s<0?d=-s*I4:d=s*I4,u<=d||(i.t=s/c,i.x[0]=t[0]+i.t*a[0],i.x[1]=t[1]+i.t*a[1],i.x[2]=t[2]+i.t*a[2],i.intersection=!0,i.betweenPoints=i.t>=0&&i.t<=1),i}function GE(t,e,n,r){const i={intersection:!1,l0:[],l1:[],error:null},a=[];Ns(e,r,a);const o=a.map(g=>Math.abs(g));if(o[0]+o[1]+o[2]<I4){const g=[];return kc(t,n,g),Ft(e,g)===0?i.error=IE:i.error=AE,i}let s;o[0]>o[1]&&o[0]>o[2]?s="x":o[1]>o[2]?s="y":s="z";const c=[],u=-Ft(e,t),d=-Ft(r,n);switch(s){case"x":c[0]=0,c[1]=(d*e[2]-u*r[2])/a[0],c[2]=(u*r[1]-d*e[1])/a[0];break;case"y":c[0]=(u*r[2]-d*e[2])/a[1],c[1]=0,c[2]=(d*e[0]-u*r[0])/a[1];break;case"z":c[0]=(d*e[1]-u*r[1])/a[2],c[1]=(u*r[0]-d*e[0])/a[2],c[2]=0;break}return i.l0=c,D2(c,a,i.l1),i.intersection=!0,i}const TF={evaluate:yF,distanceToPlane:NE,projectPoint:PE,projectVector:UE,generalizedProjectPoint:FE,intersectWithLine:kE,intersectWithPlane:GE,DISJOINT:AE,COINCIDE:IE};function CF(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=n=>NE(n,e.origin,e.normal),t.projectPoint=(n,r)=>{PE(n,e.origin,e.normal,r)},t.projectVector=(n,r)=>UE(n,e.normal,r),t.push=n=>{if(n!==0)for(let r=0;r<3;r++)e.origin[r]+=n*e.normal[r]},t.generalizedProjectPoint=(n,r)=>{FE(n,e.origin,e.normal,r)},t.evaluateFunction=(n,r,i)=>Array.isArray(n)?e.normal[0]*(n[0]-e.origin[0])+e.normal[1]*(n[1]-e.origin[1])+e.normal[2]*(n[2]-e.origin[2]):e.normal[0]*(n-e.origin[0])+e.normal[1]*(r-e.origin[1])+e.normal[2]*(i-e.origin[2]),t.evaluateGradient=n=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(n,r)=>kE(n,r,e.origin,e.normal),t.intersectWithPlane=(n,r)=>GE(n,r,e.origin,e.normal)}const SF={normal:[0,0,1],origin:[0,0,0]};function BE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SF,n),vF.extend(t,e,n),H.setGetArray(t,e,["normal","origin"],3),CF(t,e)}const wF=H.newInstance(BE,"vtkPlane");var Ki={newInstance:wF,extend:BE,...TF};const Cp=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function $E(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Zc(t){return t?.length>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function a8(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function o8(t){return a8(t,Cp)}function U2(t,e,n,r){const[i,a,o,s,c,u]=t;return t[0]=i<e?i:e,t[1]=a>e?a:e,t[2]=o<n?o:n,t[3]=s>n?s:n,t[4]=c<r?c:r,t[5]=u>r?u:r,t}function s8(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let n=0;n<e.length;++n)U2(t,...e[n]);else for(let n=0;n<e.length;n+=3)U2(t,...e.slice(n,n+3));return t}function WE(t,e,n,r,i,a,o){const[s,c,u,d,g,h]=t;return o===void 0?(t[0]=Math.min(e[0],s),t[1]=Math.max(e[1],c),t[2]=Math.min(e[2],u),t[3]=Math.max(e[3],d),t[4]=Math.min(e[4],g),t[5]=Math.max(e[5],h)):(t[0]=Math.min(e,s),t[1]=Math.max(n,c),t[2]=Math.min(r,u),t[3]=Math.max(i,d),t[4]=Math.min(a,g),t[5]=Math.max(o,h)),t}function zE(t,e,n,r){const[i,a,o,s,c,u]=t;return t[0]=e,t[1]=e>a?e:a,t[2]=n,t[3]=n>s?n:s,t[4]=r,t[5]=r>u?r:u,i!==e||o!==n||c!==r}function HE(t,e,n,r){const[i,a,o,s,c,u]=t;return t[0]=e<i?e:i,t[1]=e,t[2]=n<o?n:o,t[3]=n,t[4]=r<c?r:c,t[5]=r,a!==e||s!==n||u!==r}function jE(t,e){return t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t}function c8(t,e,n,r){return Zc(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),n>=0?(t[2]*=n,t[3]*=n):(t[2]=n*t[3],t[3]=n*t[2]),r>=0?(t[4]*=r,t[5]*=r):(t[4]=r*t[5],t[5]=r*t[4]),!0):!1}function l8(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function xF(t,e,n,r){if(!Zc(t))return!1;const i=l8(t);return t[0]-=i[0],t[1]-=i[0],t[2]-=i[1],t[3]-=i[1],t[4]-=i[2],t[5]-=i[2],c8(t,e,n,r),t[0]+=i[0],t[1]+=i[0],t[2]+=i[1],t[3]+=i[1],t[4]+=i[2],t[5]+=i[2],!0}function Jg(t,e){return t[e*2+1]-t[e*2]}function Sp(t){return[Jg(t,0),Jg(t,1),Jg(t,2)]}function qE(t){return t.slice(0,2)}function KE(t){return t.slice(2,4)}function YE(t){return t.slice(4,6)}function XE(t){const e=Sp(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function ZE(t){if(Zc(t)){const e=Sp(t);return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}return null}function u8(t){return[t[0],t[2],t[4]]}function f8(t){return[t[1],t[3],t[5]]}function oh(t,e){return t<=0&&e>=0||t>=0&&e<=0}function g8(t,e){let n=0;for(let r=0;r<2;r++)for(let i=2;i<4;i++)for(let a=4;a<6;a++)e[n++]=[t[r],t[i],t[a]];return e}function QE(t,e,n){return e[0]=t[0],e[1]=t[2],e[2]=t[4],n[0]=t[1],n[1]=t[3],n[2]=t[5],e}function JE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const r=g8(t,[]);for(let i=0;i<r.length;++i)an(r[i],r[i],e);return o8(n),s8(n,r)}function eR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function tR(t,e,n,r){const i=[].concat(Cp),a=t.getData();for(let o=0;o<a.length;o+=3){const s=[a[o],a[o+1],a[o+2]],c=Ft(s,e);i[0]=Math.min(c,i[0]),i[1]=Math.max(c,i[1]);const u=Ft(s,n);i[2]=Math.min(u,i[2]),i[3]=Math.max(u,i[3]);const d=Ft(s,r);i[4]=Math.min(d,i[4]),i[5]=Math.max(d,i[5])}return i}function nR(t,e,n,r,i){let a=!0;const o=[];let s=0;const c=[],u=[0,0,0],d=0,g=1,h=2;for(let m=0;m<3;m++)e[m]<t[2*m]?(o[m]=g,u[m]=t[2*m],a=!1):e[m]>t[2*m+1]?(o[m]=d,u[m]=t[2*m+1],a=!1):o[m]=h;if(a)return r[0]=e[0],r[1]=e[1],r[2]=e[2],i[0]=0,1;for(let m=0;m<3;m++)o[m]!==h&&n[m]!==0?c[m]=(u[m]-e[m])/n[m]:c[m]=-1;for(let m=0;m<3;m++)c[s]<c[m]&&(s=m);if(c[s]>1||c[s]<0)return 0;i[0]=c[s];for(let m=0;m<3;m++)if(s!==m){if(r[m]=e[m]+c[s]*n[m],r[m]<t[2*m]||r[m]>t[2*m+1])return 0}else r[m]=u[m];return 1}function rR(t,e,n){const r=[];let i=0,a=1,o=1;for(let s=4;s<=5;++s){r[2]=t[s];for(let c=2;c<=3;++c){r[1]=t[c];for(let u=0;u<=1;++u)if(r[0]=t[u],i=Ki.evaluate(n,e,r),o&&(a=i>=0?1:-1,o=0),i===0||a>0&&i<0||a<0&&i>0)return 1}}return 0}function iR(t,e){if(!(Zc(t)&&Zc(e)))return!1;const n=[0,0,0,0,0,0];let r;for(let i=0;i<3;i++)if(r=!1,e[i*2]>=t[i*2]&&e[i*2]<=t[i*2+1]?(r=!0,n[i*2]=e[i*2]):t[i*2]>=e[i*2]&&t[i*2]<=e[i*2+1]&&(r=!0,n[i*2]=t[i*2]),e[i*2+1]>=t[i*2]&&e[i*2+1]<=t[i*2+1]?(r=!0,n[i*2+1]=e[2*i+1]):t[i*2+1]>=e[i*2]&&t[i*2+1]<=e[i*2+1]&&(r=!0,n[i*2+1]=t[i*2+1]),!r)return!1;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],!0}function F2(t,e){if(!(Zc(t)&&Zc(e)))return!1;for(let n=0;n<3;n++)if(!(e[n*2]>=t[n*2]&&e[n*2]<=t[n*2+1])&&!(t[n*2]>=e[n*2]&&t[n*2]<=e[n*2+1])&&!(e[n*2+1]>=t[n*2]&&e[n*2+1]<=t[n*2+1])&&!(t[n*2+1]>=e[n*2]&&t[n*2+1]<=e[n*2+1]))return!1;return!0}function k2(t,e,n,r){return!(e<t[0]||e>t[1]||n<t[2]||n>t[3]||r<t[4]||r>t[5])}function EF(t,e){return!(!F2(t,e)||!k2(t,...u8(e))||!k2(t,...f8(e)))}function aR(t,e,n){const r=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],i=[0,0,0,0,0,0,0,0];let a=0;for(let g=0;g<2;g++)for(let h=2;h<4;h++)for(let m=4;m<6;m++){const y=[t[g],t[h],t[m]];i[a++]=Ki.evaluate(n,e,y)}let o=2;for(;o--&&!(oh(i[r[o][0]],i[r[o][4]])&&oh(i[r[o][1]],i[r[o][5]])&&oh(i[r[o][2]],i[r[o][6]])&&oh(i[r[o][3]],i[r[o][7]])););if(o<0)return!1;const s=Math.sign(n[o]),c=Math.abs((t[o*2+1]-t[o*2])*n[o]);let u=s>0?1:0;for(let g=0;g<4;g++){if(c===0)continue;const h=Math.abs(i[r[o][g]])/c;s>0&&h<u&&(u=h),s<0&&h>u&&(u=h)}const d=(1-u)*t[o*2]+u*t[o*2+1];return s>0?t[o*2]=d:t[o*2+1]=d,!0}class RF{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(Cp))}getBounds(){return this.bounds}equals(e){return $E(this.bounds,e)}isValid(){return Zc(this.bounds)}setBounds(e){return a8(this.bounds,e)}reset(){return o8(this.bounds)}addPoint(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return U2(this.bounds,...n)}addPoints(e){return s8(this.bounds,e)}addBounds(e,n,r,i,a,o){return WE(this.bounds,e,n,r,i,a,o)}setMinPoint(e,n,r){return zE(this.bounds,e,n,r)}setMaxPoint(e,n,r){return HE(this.bounds,e,n,r)}inflate(e){return jE(this.bounds,e)}scale(e,n,r){return c8(this.bounds,e,n,r)}getCenter(){return l8(this.bounds)}getLength(e){return Jg(this.bounds,e)}getLengths(){return Sp(this.bounds)}getMaxLength(){return XE(this.bounds)}getDiagonalLength(){return ZE(this.bounds)}getMinPoint(){return u8(this.bounds)}getMaxPoint(){return f8(this.bounds)}getXRange(){return qE(this.bounds)}getYRange(){return KE(this.bounds)}getZRange(){return YE(this.bounds)}getCorners(e){return g8(this.bounds,e)}computeCornerPoints(e,n){return QE(this.bounds,e,n)}computeLocalBounds(e,n,r){return tR(this.bounds,e,n,r)}transformBounds(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return JE(this.bounds,e,n)}computeScale3(e){return eR(this.bounds,e)}cutWithPlane(e,n){return aR(this.bounds,e,n)}intersectBox(e,n,r,i){return nR(this.bounds,e,n,r,i)}intersectPlane(e,n){return rR(this.bounds,e,n)}intersect(e){return iR(this.bounds,e)}intersects(e){return F2(this.bounds,e)}containsPoint(e,n,r){return k2(this.bounds,e,n,r)}contains(e){return F2(this.bounds,e)}}function OF(t){const e=t&&t.bounds;return new RF(e)}const DF={equals:$E,isValid:Zc,setBounds:a8,reset:o8,addPoint:U2,addPoints:s8,addBounds:WE,setMinPoint:zE,setMaxPoint:HE,inflate:jE,scale:c8,scaleAboutCenter:xF,getCenter:l8,getLength:Jg,getLengths:Sp,getMaxLength:XE,getDiagonalLength:ZE,getMinPoint:u8,getMaxPoint:f8,getXRange:qE,getYRange:KE,getZRange:YE,getCorners:g8,computeCornerPoints:QE,computeLocalBounds:tR,transformBounds:JE,computeScale3:eR,cutWithPlane:aR,intersectBox:nR,intersectPlane:rR,intersect:iR,intersects:F2,containsPoint:k2,contains:EF,INIT_BOUNDS:Cp};var kn={newInstance:OF,...DF};const _F={DISPLAY:0,WORLD:1};var oR={CoordinateSystem:_F};const{CoordinateSystem:A4}=oR;function kT(t){return()=>H.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function bF(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let n=e.mtime;for(let r=0;r<e.textures.length;++r){const i=e.textures[r].getMTime();i>n&&(n=i)}return n},t.processSelectorPixelBuffers=(n,r)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=kT("pick"),t.hasKey=kT("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=n=>{e.estimatedRenderTime=n,e.savedEstimatedRenderTime=n},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=n=>{e.estimatedRenderTime+=n},t.setAllocatedRenderTime=n=>{e.allocatedRenderTime=n,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=n=>e.textures.indexOf(n)!==-1,t.addTexture=n=>{n&&!t.hasTexture(n)&&(e.textures=e.textures.concat(n),t.modified())},t.removeTexture=n=>{const r=e.textures.filter(i=>i!==n);e.textures.length!==r.length&&(e.textures=r,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(A4.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(A4.DISPLAY)}const MF={allocatedRenderTime:10,coordinateSystem:A4.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function sR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,MF,n),H.obj(t,e),H.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),H.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),H.moveToProtected(t,e,["parentProp"]),bF(t,e)}const LF=H.newInstance(sR,"vtkProp");var cR={newInstance:LF,extend:sR,...oR};const VF=1e-6;function IF(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=r=>{e.position=e.position.map((i,a)=>i+r[a]),t.modified()},t.getOrientationWXYZ=()=>{const r=Bl();M4(r,e.rotation);const i=new Float64Array(3),a=rF(i,r);return[O2(a),i[0],i[1],i[2]]},t.getOrientationQuaternion=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return M4(r,e.rotation)},t.rotateX=r=>{r!==0&&(zv(e.rotation,e.rotation,ur(r)),t.modified())},t.rotateY=r=>{r!==0&&(Hv(e.rotation,e.rotation,ur(r)),t.modified())},t.rotateZ=r=>{r!==0&&(jv(e.rotation,e.rotation,ur(r)),t.modified())},t.rotateWXYZ=(r,i,a,o)=>{if(r===0||i===0&&a===0&&o===0)return;const s=ur(r),c=Bl();Xv(c,[i,a,o],s);const u=new Float64Array(16);L2(u,c),zt(e.rotation,e.rotation,u),t.modified()},t.rotateQuaternion=r=>{if(Math.abs(r[3])>=1-VF)return;const i=L2(new Float64Array(16),r);zt(e.rotation,e.rotation,i),t.modified()},t.setOrientation=(r,i,a)=>r===e.orientation[0]&&i===e.orientation[1]&&a===e.orientation[2]?!1:(e.orientation=[r,i,a],wt(e.rotation),t.rotateZ(a),t.rotateX(r),t.rotateY(i),t.modified(),!0),t.setUserMatrix=r=>P1(e.userMatrix,r)?!1:(_r(e.userMatrix,r),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){wt(e.matrix),e.userMatrix&&zt(e.matrix,e.matrix,e.userMatrix),Gr(e.matrix,e.matrix,e.origin),Gr(e.matrix,e.matrix,e.position),zt(e.matrix,e.matrix,e.rotation),Us(e.matrix,e.matrix,e.scale),Gr(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),Qt(e.matrix,e.matrix),e.isIdentity=!0;for(let r=0;r<4;++r)for(let i=0;i<4;++i)(r===i?1:0)!==e.matrix[r+i*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getCenter=()=>kn.getCenter(e.bounds),t.getLength=()=>kn.getLength(e.bounds),t.getXRange=()=>kn.getXRange(e.bounds),t.getYRange=()=>kn.getYRange(e.bounds),t.getZRange=()=>kn.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function n(){t.computeMatrix()}t.onModified(n)}const AF={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[1,-1,1,-1,1,-1],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function lR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AF,n),cR.extend(t,e,n),e.matrixMTime={},H.obj(e.matrixMTime),H.get(t,e,["bounds","isIdentity"]),H.getArray(t,e,["orientation"]),H.setGetArray(t,e,["origin","position","scale"],3),e.matrix=wt(new Float64Array(16)),e.rotation=wt(new Float64Array(16)),e.userMatrix=wt(new Float64Array(16)),e.transform=null,IF(t,e)}const NF=H.newInstance(lR,"vtkProp3D");var d8={newInstance:NF,extend:lR};const N4={NEAREST:0,LINEAR:1,FAST_LINEAR:2},uR={FRACTIONAL:0,PROPORTIONAL:1},Qh={CUSTOM:0,ADDITIVE:1,COLORIZE:2};var fR={InterpolationType:N4,OpacityMode:uR,ColorMixPreset:Qh};const{InterpolationType:Fg,OpacityMode:PF}=fR,{vtkErrorMacro:v3}=H,Jh=4;function UF(t,e){e.classHierarchy.push("vtkVolumeProperty"),t.getMTime=()=>{let i=e.mtime,a;for(let o=0;o<Jh;o++)e.componentData[o].colorChannels===1?e.componentData[o].grayTransferFunction&&(a=e.componentData[o].grayTransferFunction.getMTime(),i=i>a?i:a):e.componentData[o].colorChannels===3&&e.componentData[o].rGBTransferFunction&&(a=e.componentData[o].rGBTransferFunction.getMTime(),i=i>a?i:a),e.componentData[o].scalarOpacity&&(a=e.componentData[o].scalarOpacity.getMTime(),i=i>a?i:a),e.componentData[o].gradientOpacity&&(e.componentData[o].disableGradientOpacity||(a=e.componentData[o].gradientOpacity.getMTime(),i=i>a?i:a));return i},t.getColorChannels=i=>i<0||i>3?(v3("Bad index - must be between 0 and 3"),0):e.componentData[i].colorChannels,t.setGrayTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=!1;return e.componentData[i].grayTransferFunction!==a&&(e.componentData[i].grayTransferFunction=a,o=!0),e.componentData[i].colorChannels!==1&&(e.componentData[i].colorChannels=1,o=!0),o&&t.modified(),o},t.getGrayTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].grayTransferFunction===null&&(e.componentData[i].grayTransferFunction=Gl.newInstance(),e.componentData[i].grayTransferFunction.addPoint(0,0),e.componentData[i].grayTransferFunction.addPoint(1024,1),e.componentData[i].colorChannels!==1&&(e.componentData[i].colorChannels=1),t.modified()),e.componentData[i].grayTransferFunction},t.setRGBTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=!1;return e.componentData[i].rGBTransferFunction!==a&&(e.componentData[i].rGBTransferFunction=a,o=!0),e.componentData[i].colorChannels!==3&&(e.componentData[i].colorChannels=3,o=!0),o&&t.modified(),o},t.getRGBTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].rGBTransferFunction===null&&(e.componentData[i].rGBTransferFunction=Xc.newInstance(),e.componentData[i].rGBTransferFunction.addRGBPoint(0,0,0,0),e.componentData[i].rGBTransferFunction.addRGBPoint(1024,1,1,1),e.componentData[i].colorChannels!==3&&(e.componentData[i].colorChannels=3),t.modified()),e.componentData[i].rGBTransferFunction},t.setScalarOpacity=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return e.componentData[i].scalarOpacity!==a?(e.componentData[i].scalarOpacity=a,t.modified(),!0):!1},t.getScalarOpacity=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].scalarOpacity===null&&(e.componentData[i].scalarOpacity=Gl.newInstance(),e.componentData[i].scalarOpacity.addPoint(0,1),e.componentData[i].scalarOpacity.addPoint(1024,1),t.modified()),e.componentData[i].scalarOpacity},t.setComponentWeight=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(i<0||i>=Jh)return v3("Invalid index"),!1;const o=Math.min(1,Math.max(0,a));return e.componentData[i].componentWeight!==o?(e.componentData[i].componentWeight=o,t.modified(),!0):!1},t.getComponentWeight=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return i<0||i>=Jh?(v3("Invalid index"),0):e.componentData[i].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(Fg.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(Fg.LINEAR),t.setInterpolationTypeToFastLinear=()=>t.setInterpolationType(Fg.FAST_LINEAR),t.getInterpolationTypeAsString=()=>H.enumToString(Fg,e.interpolationType),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(i=>{const a=H.capitalize(i);t[`set${a}`]=(o,s)=>e.componentData[o][`${i}`]!==s?(e.componentData[o][`${i}`]=s,t.modified(),!0):!1}),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(i=>{const a=H.capitalize(i);t[`get${a}`]=o=>e.componentData[o][`${i}`]})}const FF={colorMixPreset:null,independentComponents:!0,interpolationType:Fg.FAST_LINEAR,shade:!1,ambient:.1,diffuse:.7,specular:.2,specularPower:10,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function kF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,FF,n),H.obj(t,e),!e.componentData){e.componentData=[];for(let r=0;r<Jh;++r)e.componentData.push({colorChannels:1,grayTransferFunction:null,rGBTransferFunction:null,scalarOpacity:null,scalarOpacityUnitDistance:1,opacityMode:PF.FRACTIONAL,gradientOpacityMinimumValue:0,gradientOpacityMinimumOpacity:0,gradientOpacityMaximumValue:1,gradientOpacityMaximumOpacity:1,useGradientOpacity:!1,componentWeight:1,forceNearestInterpolation:!1})}H.setGet(t,e,["colorMixPreset","independentComponents","interpolationType","shade","ambient","diffuse","specular","specularPower","useLabelOutline","labelOutlineOpacity"]),H.setGetArray(t,e,["labelOutlineThickness"]),UF(t,e)}const GF=H.newInstance(kF,"vtkVolumeProperty");var BF={newInstance:GF,...fR};const{vtkDebugMacro:$F}=H;function WF(t,e){e.classHierarchy.push("vtkVolume"),t.getVolumes=()=>t,t.makeProperty=BF.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;const r=i=>i[0].map((a,o)=>i.map(s=>s[o]));if(!e.mapperBounds||!r([n,e.mapperBounds]).reduce((i,a)=>i&&a[0]===a[1],!0)||t.getMTime()>e.boundsMTime.getMTime()){$F("Recomputing bounds..."),e.mapperBounds=n.map(o=>o);const i=[];kn.getCorners(n,i),t.computeMatrix();const a=new Float64Array(16);Qt(a,e.matrix),i.forEach(o=>an(o,o,a)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((o,s)=>s%2===0?i.reduce((c,u)=>c>u[s/2]?u[s/2]:c,o):i.reduce((c,u)=>c<u[(s-1)/2]?u[(s-1)/2]:c,o)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let n=e.mtime;if(e.property!==null){const r=e.property.getMTime();n=r>n?r:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}return n}}const zF={mapper:null,property:null,bounds:[1,-1,1,-1,1,-1]};function gR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zF,n),d8.extend(t,e,n),e.boundsMTime={},H.obj(e.boundsMTime),H.set(t,e,["property"]),H.setGet(t,e,["mapper"]),H.getArray(t,e,["bounds"],6),WF(t,e)}const HF=H.newInstance(gR,"vtkVolume");var jF={newInstance:HF,extend:gR};const{vtkErrorMacro:qF}=H,KF=["Build","Render"];function YF(t,e){e.classHierarchy.push("vtkViewNode"),t.build=r=>{},t.render=r=>{},t.traverse=r=>{const i=r.getTraverseOperation(),a=t[i];if(a){a(r);return}t.apply(r,!0);for(let o=0;o<e.children.length;o++)e.children[o].traverse(r);t.apply(r,!1)},t.apply=(r,i)=>{const a=t[r.getOperation()];a&&a(i,r)},t.getViewNodeFor=r=>{if(e.renderable===r)return t;for(let i=0;i<e.children.length;++i){const o=e.children[i].getViewNodeFor(r);if(o)return o}},t.getFirstAncestorOfType=r=>e._parent?e._parent.isA(r)?e._parent:e._parent.getFirstAncestorOfType(r):null,t.getLastAncestorOfType=r=>{if(!e._parent)return null;const i=e._parent.getLastAncestorOfType(r);return i||(e._parent.isA(r)?e._parent:null)},t.addMissingNode=r=>{if(!r)return;const i=e._renderableChildMap.get(r);if(i!==void 0)return i.setVisited(!0),i;const a=t.createViewNode(r);if(a)return a.setParent(t),a.setVisited(!0),e._renderableChildMap.set(r,a),e.children.push(a),a},t.addMissingNodes=r=>{if(!(!r||!r.length))for(let i=0;i<r.length;++i){const a=r[i];t.addMissingNode(a)}},t.addMissingChildren=r=>{if(!(!r||!r.length))for(let i=0;i<r.length;++i){const a=r[i];if(e.children.indexOf(a)===-1){a.setParent(t),e.children.push(a);const s=a.getRenderable();s&&e._renderableChildMap.set(s,a)}a.setVisited(!0)}},t.removeNode=r=>{const i=e.children.findIndex(o=>o===r);if(i<0)return!1;const a=r.getRenderable();return a&&e._renderableChildMap.delete(a),r.delete(),e.children.splice(i,1),!0},t.prepareNodes=()=>{for(let r=0;r<e.children.length;++r)e.children[r].setVisited(!1)},t.setVisited=r=>{e.visited=r},t.removeUnusedNodes=()=>{let r=0;for(let i=0;i<e.children.length;++i){const a=e.children[i];if(a.getVisited())e.children[r++]=a,a.setVisited(!1);else{const s=a.getRenderable();s&&e._renderableChildMap.delete(s),a.delete()}}e.children.length=r},t.createViewNode=r=>{if(!e.myFactory)return qF("Cannot create view nodes without my own factory"),null;const i=e.myFactory.createNode(r);return i&&i.setRenderable(r),i};const n=t.delete;t.delete=()=>{for(let r=0;r<e.children.length;r++)e.children[r].delete();n()}}const XF={renderable:null,myFactory:null,children:[],visited:!1};function dR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XF,n),H.obj(t,e),H.event(t,e,"event"),e._renderableChildMap=new Map,H.get(t,e,["visited"]),H.setGet(t,e,["_parent","renderable","myFactory"]),H.getArray(t,e,["children"]),H.moveToProtected(t,e,["parent"]),YF(t,e)}const ZF=H.newInstance(dR,"vtkViewNode");var $r={newInstance:ZF,extend:dR,PASS_TYPES:KF};function QF(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,i=n.getClassName(r++),a=!1;const o=Object.keys(e.overrides);for(;i&&!a;)o.indexOf(i)!==-1?a=!0:i=n.getClassName(r++);if(!a)return null;const s=e.overrides[i]();return s.setMyFactory(t),s}}const JF={};function hR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JF,n),H.obj(t,e),QF(t,e)}const ek=H.newInstance(hR,"vtkViewNodeFactory");var h8={newInstance:ek,extend:hR};const pR=Object.create(null);function xi(t,e){pR[t]=e}function tk(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}const nk={};function mR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nk,n),e.overrides=pR,h8.extend(t,e,n),tk(t,e)}const rk=H.newInstance(mR,"vtkOpenGLViewNodeFactory");var ik={newInstance:rk,extend:mR};function ak(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=n=>{if(n){const r=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize),e.context.scissor(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=n=>{if(n!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||n.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){_r(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),vp(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),F1(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Qt(e.keyMatrices.wcvc,e.keyMatrices.wcvc);const r=e._openGLRenderer.getAspectRatio();_r(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(r,-1,1)),Qt(e.keyMatrices.vcpc,e.keyMatrices.vcpc),zt(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=n}return e.keyMatrices}}const ok={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function sk(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ok,n),$r.extend(t,e,n),e.keyMatrixTime={},Yn(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},ri(t,e,["context","keyMatrixTime"]),ak(t,e)}const vR=An(sk);var ck={newInstance:vR};xi("vtkCamera",vR);const{vtkDebugMacro:lk}=Zi;function uk(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes()}},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let i=0;i<r.length;++i)r[i].getSwitch()>0&&n++;return n||(lk("No lights are on, creating one."),e.renderable.createLight()),n},t.zBufferPass=n=>{if(n){let r=0;const i=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),r|=i.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(i.clearDepth(1),r|=i.DEPTH_BUFFER_BIT,e.context.depthMask(!0));const a=t.getTiledSizeAndOrigin();i.enable(i.SCISSOR_TEST),i.scissor(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),i.viewport(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),i.colorMask(!0,!0,!0,!0),r&&i.clear(r),i.enable(i.DEPTH_TEST)}},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.cameraPass=n=>{n&&t.clear()},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],i=n[0]-r[0],a=n[1]-r[1],o=e._parent.normalizedDisplayToDisplay(i,a),s=Math.round(o[0]),c=Math.round(o[1]),u=n[2]-r[0],d=n[3]-r[1],g=e._parent.normalizedDisplayToDisplay(u,d);let h=Math.round(g[0])-s,m=Math.round(g[1])-c;return h<0&&(h=0),m<0&&(m=0),{usize:h,vsize:m,lowerLeftU:s,lowerLeftV:c}},t.clear=()=>{let n=0;const r=e.context;if(!e.renderable.getTransparent()){const a=e.renderable.getBackgroundByReference();r.clearColor(a[0],a[1],a[2],a[3]),n|=r.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(r.clearDepth(1),n|=r.DEPTH_BUFFER_BIT,r.depthMask(!0)),r.colorMask(!0,!0,!0,!0);const i=t.getTiledSizeAndOrigin();r.enable(r.SCISSOR_TEST),r.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),r.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),n&&r.clear(n),r.enable(r.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(n=>{n.modified()})},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const fk={context:null,_openGLRenderWindow:null,selector:null};function gk(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fk,n),$r.extend(t,e,n),ha(t,e,["shaderCache"]),ri(t,e,["selector"]),I1(t,e,["openGLRenderWindow"]),uk(t,e)}const yR=An(gk,"vtkOpenGLRenderer");var dk={newInstance:yR};xi("vtkRenderer",yR);function TR(t){let e=0;return t.filter((n,r)=>r===e?(e+=n+1,!0):!1)}function CR(t){let e=0;for(let n=0;n<t.length;)n+=t[n]+1,e++;return e}const hk={extractCellSizes:TR,getNumberOfCells:CR};function pk(t,e){e.classHierarchy.push("vtkCellArray");const n={...t};t.getNumberOfCells=r=>(e.numberOfCells!==void 0&&!r||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=CR(t.getData())),e.numberOfCells),t.getCellSizes=r=>(e.cellSizes!==void 0&&!r||(e.cellSizes=TR(t.getData())),e.cellSizes),t.resize=r=>{const i=t.getNumberOfTuples();n.resize(r);const a=t.getNumberOfTuples();a<i&&(a===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=r=>{n.setData(r,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=r=>{let i=r;const a=e.values[i++];return e.values.subarray(i,i+a)},t.insertNextCell=r=>{const i=t.getNumberOfCells();return t.insertNextTuples([r.length,...r]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(r.length),i}}function mk(t){return{empty:!0,numberOfComponents:1,dataType:kt.UNSIGNED_INT,...t}}function SR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Pt.extend(t,e,mk(n)),pk(t,e)}const vk=H.newInstance(SR,"vtkCellArray");var $l={newInstance:vk,extend:SR,...hk};const{vtkErrorMacro:yk}=H,Tk=[1,-1,1,-1,1,-1];function Ck(t,e){e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==n&&(e.size=n*r,e.values=H.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(r),t.modified())},t.setPoint=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];t.setTuple(n,i)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(n,r,i)=>t.insertNextTuple([n,r,i]),t.getBounds=()=>{if(t.getNumberOfComponents()===3){const i=t.getRange(0);e.bounds[0]=i[0],e.bounds[1]=i[1];const a=t.getRange(1);e.bounds[2]=a[0],e.bounds[3]=a[1];const o=t.getRange(2);return e.bounds[4]=o[0],e.bounds[5]=o[1],e.bounds}if(t.getNumberOfComponents()!==2)return yk(`getBounds called on an array with components of
        ${t.getNumberOfComponents()}`),Tk;const n=t.getRange(0);e.bounds[0]=n[0],e.bounds[1]=n[1];const r=t.getRange(1);return e.bounds[2]=r[0],e.bounds[3]=r[1],e.bounds[4]=0,e.bounds[5]=0,e.bounds},t.computeBounds=t.getBounds,t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}const Sk={empty:!0,numberOfComponents:3,dataType:kt.FLOAT,bounds:[1,-1,1,-1,1,-1]};function wR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Sk,n),Pt.extend(t,e,n),Ck(t,e)}const wk=H.newInstance(wR,"vtkPoints");var P4={newInstance:wk,extend:wR};function xk(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(r){e.pointsIds=r;let i=e.points.getData();i.length!==3*e.pointsIds.length&&(i=H.newTypedArray(n.getDataType(),3*e.pointsIds.length));const a=n.getData();e.pointsIds.forEach((o,s)=>{let c=3*o,u=3*s;i[u]=a[c],i[++u]=a[++c],i[++u]=a[++c]}),e.points.setData(i)}else{e.points=n,e.pointsIds=new Array(n.getNumberOfPoints());for(let i=n.getNumberOfPoints()-1;i>=0;--i)e.pointsIds[i]=i}},t.getBounds=()=>{const n=e.points.getNumberOfPoints(),r=[];if(n){e.points.getPoint(0,r),e.bounds[0]=r[0],e.bounds[1]=r[0],e.bounds[2]=r[1],e.bounds[3]=r[1],e.bounds[4]=r[2],e.bounds[5]=r[2];for(let i=1;i<n;i++)e.points.getPoint(i,r),e.bounds[0]=r[0]<e.bounds[0]?r[0]:e.bounds[0],e.bounds[1]=r[0]>e.bounds[1]?r[0]:e.bounds[1],e.bounds[2]=r[1]<e.bounds[2]?r[1]:e.bounds[2],e.bounds[3]=r[1]>e.bounds[3]?r[1]:e.bounds[3],e.bounds[4]=r[2]<e.bounds[4]?r[2]:e.bounds[4],e.bounds[5]=r[2]>e.bounds[5]?r[2]:e.bounds[5]}else Cf(e.bounds);return e.bounds},t.getLength2=()=>{t.getBounds();let n=0,r=0;for(let i=0;i<3;i++)r=e.bounds[2*i+1]-e.bounds[2*i],n+=r*r;return n},t.getParametricDistance=n=>{let r,i=0;for(let a=0;a<3;a++)n[a]<0?r=-n[a]:n[a]>1?r=n[a]-1:r=0,r>i&&(i=r);return i},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=n=>{n.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(n,r,i,a,o,s,c)=>{},t.evaluatePosition=(n,r,i,a,o,s)=>{H.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}const Ek={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function xR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ek,n),H.obj(t,e),e.points||(e.points=P4.newInstance()),H.get(t,e,["points","pointsIds"]),xk(t,e)}const Rk=H.newInstance(xR,"vtkCell");var G2={newInstance:Rk,extend:xR};function Ok(t,e){let n=e;for(e>=t.array.length&&(n+=t.array.length);n>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=n}function Dk(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=n=>{const r=n.getPoints().getNumberOfPoints(),i=n.getNumberOfCells(),a=new Uint32Array(r);if(n.isA("vtkPolyData")){for(let o=0;o<i;++o){const{cellPointIds:s}=n.getCellPoints(o);s.forEach(c=>{t.incrementLinkCount(c)})}t.allocateLinks(r),e.maxId=r-1;for(let o=0;o<i;++o){const{cellPointIds:s}=n.getCellPoints(o);s.forEach(c=>{t.insertCellReference(c,a[c]++,o)})}}else{for(let o=0;o<i;o++)G2.newInstance().getPointsIds().forEach(c=>{t.incrementLinkCount(c)});t.allocateLinks(r),e.maxId=r-1;for(let o=0;o<i;++o)G2.newInstance().getPointsIds().forEach(c=>{t.insertCellReference(c,a[c]++,o)})}},t.allocate=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(n).fill().map(()=>({ncells:0,cells:null})),e.extend=r,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=n=>e.array[n],t.getNcells=n=>e.array[n].ncells,t.getCells=n=>e.array[n].cells,t.insertNextPoint=n=>{e.array.push({ncells:n,cells:Array(n)}),++e.maxId},t.insertNextCellReference=(n,r)=>{e.array[n].cells[e.array[n].ncells++]=r},t.deletePoint=n=>{e.array[n].ncells=0,e.array[n].cells=null},t.removeCellReference=(n,r)=>{e.array[r].cells=e.array[r].cells.filter(i=>i!==n),e.array[r].ncells=e.array[r].cells.length},t.addCellReference=(n,r)=>{e.array[r].cells[e.array[r].ncells++]=n},t.resizeCellList=(n,r)=>{e.array[n].cells.length=r},t.squeeze=()=>{Ok(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{e.array=[...n.array],e.extend=n.extend,e.maxId=n.maxId},t.incrementLinkCount=n=>{++e.array[n].ncells},t.allocateLinks=n=>{for(let r=0;r<n;++r)e.array[r].cells=new Array(e.array[r].ncells)},t.insertCellReference=(n,r,i)=>{e.array[n].cells[r]=i}}const _k={array:null,maxId:0,extend:0};function ER(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_k,n),H.obj(t,e),Dk(t,e)}const bk=H.newInstance(ER,"vtkCellLinks");var Mk={newInstance:bk,extend:ER};const Hn={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_QUAD:9,VTK_QUADRATIC_EDGE:21,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42},U4=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function Lk(t){return t<U4.length?U4[t]:"UnknownClass"}function Vk(t){return U4.findIndex(t)}function Ik(t){return t<Hn.VTK_QUADRATIC_EDGE||t===Hn.VTK_CONVEX_POINT_SET||t===Hn.VTK_POLYHEDRON}function Ak(t){return t===Hn.VTK_TRIANGLE_STRIP||t===Hn.VTK_POLY_LINE||t===Hn.VTK_POLY_VERTEX}const Nk={getClassNameFromTypeId:Lk,getTypeIdFromClassName:Vk,isLinear:Ik,hasSubCells:Ak};function Pk(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=n>0?n:1,e.extend=r>0?r:1,e.maxId=-1,e.typeArray=new Uint8Array(n),e.locationArray=new Uint32Array(n)},t.insertCell=(n,r,i)=>{e.typeArray[n]=r,e.locationArray[n]=i,n>e.maxId&&(e.maxId=n)},t.insertNextCell=(n,r)=>(t.insertCell(++e.maxId,n,r),e.maxId),t.setCellTypes=(n,r,i)=>{e.size=n,e.typeArray=r,e.locationArray=i,e.maxId=n-1},t.getCellLocation=n=>e.locationArray[n],t.deleteCell=n=>{e.typeArray[n]=Hn.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=n=>{const r=t.getNumberOfTypes();for(let i=0;i<r;++i)if(n===t.getCellType(i))return!0;return!1},t.insertNextType=n=>t.insertNextCell(n,-1),t.getCellType=n=>e.typeArray[n],t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{t.allocate(n.getSize(),n.getExtend()),e.typeArray.set(n.getTypeArray()),e.locationArray.set(n.getLocationArray()),e.maxId=n.getMaxId()}}const Uk={size:0,maxId:-1,extend:1e3};function RR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Uk,n),H.obj(t,e),H.get(t,e,["size","maxId","extend"]),H.getArray(t,e,["typeArray","locationArray"]),Pk(t,e)}const Fk=H.newInstance(RR,"vtkCellTypes");var kk={newInstance:Fk,extend:RR,...Nk};const Gk={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2};var OR={IntersectionState:Gk};const{IntersectionState:e2}=OR;function Gu(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;const i={t:Number.MIN_VALUE,distance:0},a=[];let o;a[0]=n[0]-e[0],a[1]=n[1]-e[1],a[2]=n[2]-e[2];const s=a[0]*(t[0]-e[0])+a[1]*(t[1]-e[1])+a[2]*(t[2]-e[2]),c=Ft(a,a);let u=1e-5*s;return c!==0&&(i.t=s/c),u<0&&(u=-u),-u<c&&c<u||c<=0||i.t<0?o=e:i.t>1?o=n:(o=a,a[0]=e[0]+i.t*a[0],a[1]=e[1]+i.t*a[1],a[2]=e[2]+i.t*a[2]),r&&(r[0]=o[0],r[1]=o[1],r[2]=o[2]),i.distance=Es(o,t),i}function DR(t,e,n,r,i,a){const o=[],s=[],c=[];i[0]=0,a[0]=0,kc(e,t,o),kc(r,n,s),kc(n,t,c);const u=[Ft(o,o),-Ft(o,s),-Ft(o,s),Ft(s,s)],d=[];if(d[0]=Ft(o,c),d[1]=-Ft(s,c),qx(u,d,2)===0){let g=Number.MAX_VALUE;const h=[t,e,n,r],m=[n,n,t,t],y=[r,r,e,e];a[0],a[0],i[0],i[0],i[0],i[0],a[0],a[0];let v;for(let C=0;C<4;C++)v=Gu(h[C],m[C],y[C]),v.distance<g&&(g=v.distance,v.t);return e2.ON_LINE}return i[0]=d[0],a[0]=d[1],i[0]>=0&&i[0]<=1&&a[0]>=0&&a[0]<=1?e2.YES_INTERSECTION:e2.NO_INTERSECTION}const Bk={distanceToLine:Gu,intersection:DR};function $k(t,e){e.classHierarchy.push("vtkLine");function n(r){return r>=0&&r<=1}t.getCellDimension=()=>1,t.intersectWithLine=(r,i,a,o,s)=>{const c={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};s[1]=0,s[2]=0;const u=[],d=[],g=[];e.points.getPoint(0,d),e.points.getPoint(1,g);const h=[],m=[],y=DR(r,i,d,g,h,m);if(c.t=h[0],c.betweenPoints=n(c.t),s[0]=m[0],y===e2.YES_INTERSECTION){for(let v=0;v<3;v++)o[v]=d[v]+s[0]*(g[v]-d[v]),u[v]=r[v]+c.t*(i[v]-r[v]);if(Es(o,u)<=a*a)return c.intersect=1,c}else{let v;if(c.t<0)return v=Gu(r,d,g,o),v.distance<=a*a&&(c.t=0,c.intersect=1,c.betweenPoints=!0),c;if(c.t>1)return v=Gu(i,d,g,o),v.distance<=a*a&&(c.t=1,c.intersect=1,c.betweenPoints=!0),c;if(s[0]<0)return s[0]=0,v=Gu(d,r,i,o),c.t=v.t,v.distance<=a*a&&(c.intersect=1),c;if(s[0]>1)return s[0]=1,v=Gu(g,r,i,o),c.t=v.t,v.distance<=a*a&&(c.intersect=1),c}return c},t.evaluateLocation=(r,i,a)=>{const o=[],s=[];e.points.getPoint(0,o),e.points.getPoint(1,s);for(let c=0;c<3;c++)i[c]=o[c]+r[0]*(s[c]-o[c]);a[0]=1-r[0],a[1]=r[0]},t.evaluateOrientation=(r,i,a)=>e.orientations?(Yh(i,e.orientations[0],e.orientations[1],r[0]),a[0]=1-r[0],a[1]=r[0],!0):!1}const Wk={orientations:null};function _R(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Wk,n),G2.extend(t,e,n),H.setGet(t,e,["orientations"]),$k(t,e)}const zk=H.newInstance(_R,"vtkLine");var Oo={newInstance:zk,extend:_R,...Bk,...OR};const{vtkErrorMacro:GT,vtkWarningMacro:Hk}=H;function jk(t,e){e.classHierarchy.push("vtkFieldData");const n=t.getState;e.arrays&&(e.arrays=e.arrays.map(r=>({data:ts(r.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=r=>{t.initializeFields(),e.copyFieldFlags=r.getCopyFieldFlags().map(i=>i),e.arrays=r.arrays().map(i=>({array:i}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=r=>{const i=r.getName(),{array:a,index:o}=t.getArrayWithIndex(i);return a!=null?(e.arrays[o]={data:r},o):(e.arrays=[].concat(e.arrays,{data:r}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=r=>{const i=e.arrays.findIndex(a=>a.data.getName()===r);return t.removeArrayByIndex(i)},t.removeArrayByIndex=r=>r!==-1&&r<e.arrays.length?(e.arrays.splice(r,1),!0):!1,t.getArrays=()=>e.arrays.map(r=>r.data),t.getArray=r=>typeof r=="number"?t.getArrayByIndex(r):t.getArrayByName(r),t.getArrayByName=r=>e.arrays.reduce((i,a,o)=>a.data.getName()===r?a.data:i,null),t.getArrayWithIndex=r=>{const i=e.arrays.findIndex(a=>a.data.getName()===r);return{array:i!==-1?e.arrays[i].data:null,index:i}},t.getArrayByIndex=r=>r>=0&&r<e.arrays.length?e.arrays[r].data:null,t.hasArray=r=>t.getArrayWithIndex(r).index>=0,t.getArrayName=r=>{const i=e.arrays[r];return i?i.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=r=>e.copyFieldFlags[r],t.passData=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;r.getArrays().forEach(o=>{const s=t.getFlag(o.getName());if(s!==!1&&!(e.doCopyAllOff&&s!==!0)&&o){let c=t.getArrayByName(o.getName());if(c)if(o.getNumberOfComponents()===c.getNumberOfComponents())if(i>-1&&i<o.getNumberOfTuples()){const u=a>-1?a:i;c.insertTuple(u,o.getTuple(i))}else c.insertTuples(0,o.getTuples());else GT("Unhandled case in passData");else if(i<0||i>o.getNumberOfTuples())t.addArray(o),r.getAttributes(o).forEach(u=>{t.setAttribute(o,u)});else{const u=o.getNumberOfComponents();let d=o.getNumberOfValues();const g=a>-1?a:i;d<=g*u&&(d=(g+1)*u),c=Pt.newInstance({name:o.getName(),dataType:o.getDataType(),numberOfComponents:u,values:H.newTypedArray(o.getDataType(),d),size:0}),c.insertTuple(g,o.getTuple(i)),t.addArray(c),r.getAttributes(o).forEach(h=>{t.setAttribute(c,h)})}}})},t.interpolateData=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;r.getArrays().forEach(c=>{const u=t.getFlag(c.getName());if(u!==!1&&!(e.doCopyAllOff&&u!==!0)&&c){let d=t.getArrayByName(c.getName());if(d)if(c.getNumberOfComponents()===d.getNumberOfComponents())if(i>-1&&i<c.getNumberOfTuples()){const g=o>-1?o:i;d.interpolateTuple(g,c,i,c,a,s),Hk("Unexpected case in interpolateData")}else d.insertTuples(c.getTuples());else GT("Unhandled case in interpolateData");else if(i<0||a<0||i>c.getNumberOfTuples())t.addArray(c),r.getAttributes(c).forEach(g=>{t.setAttribute(c,g)});else{const g=c.getNumberOfComponents();let h=c.getNumberOfValues();const m=o>-1?o:i;h<=m*g&&(h=(m+1)*g),d=Pt.newInstance({name:c.getName(),dataType:c.getDataType(),numberOfComponents:g,values:H.newTypedArray(c.getDataType(),h),size:0}),d.interpolateTuple(m,c,i,c,a,s),t.addArray(d),r.getAttributes(c).forEach(y=>{t.setAttribute(d,y)})}}})},t.copyFieldOn=r=>{e.copyFieldFlags[r]=!0},t.copyFieldOff=r=>{e.copyFieldFlags[r]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=r=>{e.arrays=r.getArrays().map(i=>{const a=i.newClone();return a.deepCopy(i),{data:a}})},t.copyFlags=r=>r.getCopyFieldFlags().map(i=>i),t.reset=()=>e.arrays.forEach(r=>r.data.reset()),t.getMTime=()=>e.arrays.reduce((r,i)=>i.data.getMTime()>r?i.data.getMTime():r,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((r,i)=>r+i.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{const r=n();return r&&(r.arrays=e.arrays.map(i=>({data:i.data.getState()}))),r}}const qk={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function bR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qk,n),H.obj(t,e),jk(t,e)}const Kk=H.newInstance(bR,"vtkFieldData");var Yk={newInstance:Kk,extend:bR};const Xk={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},Zk={MAX:0,EXACT:1,NOLIMIT:2},Qk={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},Jk={DUPLICATEPOINT:1,HIDDENPOINT:2},eG={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},tG="vtkGhostType",nG={DEFAULT:0,SINGLE:1,DOUBLE:2};var MR={AttributeCopyOperations:eG,AttributeLimitTypes:Zk,AttributeTypes:Xk,CellGhostTypes:Qk,DesiredOutputPrecision:nG,PointGhostTypes:Jk,ghostArrayName:tG};const{AttributeTypes:w0,AttributeCopyOperations:ll}=MR,{vtkWarningMacro:sh}=H;function rG(t,e){const n=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function r(o){let s=n.find(c=>w0[c.toUpperCase()]===o||typeof o!="number"&&c.toLowerCase()===o.toLowerCase());return typeof s>"u"&&(s=null),s}e.classHierarchy.push("vtkDataSetAttributes");const i={...t};t.checkNumberOfComponents=o=>!0,t.setAttribute=(o,s)=>{const c=r(s);if(o&&c.toUpperCase()==="PEDIGREEIDS"&&!o.isA("vtkDataArray"))return sh(`Cannot set attribute ${c}. The attribute must be a vtkDataArray.`),-1;if(o&&!t.checkNumberOfComponents(o,c))return sh(`Cannot set attribute ${c}. Incorrect number of components.`),-1;let u=e[`active${c}`];if(u>=0&&u<e.arrays.length){if(e.arrays[u]===o)return u;t.removeArrayByIndex(u)}return o?(u=t.addArray(o),e[`active${c}`]=u):e[`active${c}`]=-1,t.modified(),e[`active${c}`]},t.getAttributes=o=>n.filter(s=>t[`get${s}`]()===o),t.setActiveAttributeByName=(o,s)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(o).index,s),t.setActiveAttributeByIndex=(o,s)=>{const c=r(s);if(o>=0&&o<e.arrays.length){if(c.toUpperCase()!=="PEDIGREEIDS"){const u=t.getArrayByIndex(o);if(!u.isA("vtkDataArray"))return sh(`Cannot set attribute ${c}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(u,c))return sh(`Cannot set attribute ${c}. Incorrect number of components.`),-1}return e[`active${c}`]=o,t.modified(),o}return o===-1&&(e[`active${c}`]=o,t.modified()),-1},t.getActiveAttribute=o=>{const s=r(o);return t[`get${s}`]()},t.removeAllArrays=()=>{n.forEach(o=>{e[`active${o}`]=-1}),i.removeAllArrays()},t.removeArrayByIndex=o=>(o!==-1&&n.forEach(s=>{o===e[`active${s}`]?e[`active${s}`]=-1:o<e[`active${s}`]&&(e[`active${s}`]-=1)}),i.removeArrayByIndex(o)),n.forEach(o=>{const s=`active${o}`;t[`get${o}`]=()=>t.getArrayByIndex(e[s]),t[`set${o}`]=c=>t.setAttribute(c,o),t[`setActive${o}`]=c=>t.setActiveAttributeByIndex(t.getArrayWithIndex(c).index,o),t[`copy${o}Off`]=()=>{const c=o.toUpperCase();e.copyAttributeFlags[ll.PASSDATA][w0[c]]=!1},t[`copy${o}On`]=()=>{const c=o.toUpperCase();e.copyAttributeFlags[ll.PASSDATA][w0[c]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys(ll).filter(o=>o!=="ALLCOPY").forEach(o=>{e.copyAttributeFlags[ll[o]]=Object.keys(w0).filter(s=>s!=="NUM_ATTRIBUTES").reduce((s,c)=>(s[w0[c]]=!0,s),[])}),e.copyAttributeFlags[ll.COPYTUPLE][w0.GLOBALIDS]=!1,e.copyAttributeFlags[ll.INTERPOLATE][w0.GLOBALIDS]=!1,e.copyAttributeFlags[ll.COPYTUPLE][w0.PEDIGREEIDS]=!1},t.initialize=H.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(o=>{!e.dataArrays[o].ref&&e.dataArrays[o].type==="vtkDataArray"&&t.addArray(Pt.newInstance(e.dataArrays[o]))});const a=t.shallowCopy;t.shallowCopy=(o,s)=>{a(o,s),e.arrays=o.getArrays().map(c=>{const u=c.newClone();return u.shallowCopy(c,s),{data:u}})},t.initializeAttributeCopyFlags()}const iG={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function LR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iG,n),Yk.extend(t,e,n),H.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),rG(t,e)}const aG=H.newInstance(LR,"vtkDataSetAttributes");var BT={newInstance:aG,extend:LR,...MR};const oG={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},sG={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7};var cG={FieldDataTypes:oG,FieldAssociations:sG};const F4=["pointData","cellData","fieldData"];function lG(t,e){e.classHierarchy.push("vtkDataSet"),F4.forEach(r=>{e[r]?e[r]=ts(e[r]):e[r]=BT.newInstance()});const n=t.shallowCopy;t.shallowCopy=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,i),F4.forEach(a=>{e[a]=BT.newInstance(),e[a].shallowCopy(r.getReferenceByName(a))})}}const uG={};function VR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uG,n),H.obj(t,e),H.setGet(t,e,F4),lG(t,e)}const fG=H.newInstance(VR,"vtkDataSet");var Sf={newInstance:fG,extend:VR,...cG};function gG(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=ts(e.points):e.points=P4.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};const n=t.shallowCopy;t.shallowCopy=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,i),e.points=P4.newInstance(),e.points.shallowCopy(r.getPoints())}}const dG={};function IR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dG,n),Sf.extend(t,e,n),H.setGet(t,e,["points"]),gG(t,e)}const hG=H.newInstance(IR,"vtkPointSet");var pG={newInstance:hG,extend:IR};function p8(t,e,n,r){const i=n[0]-e[0],a=n[1]-e[1],o=n[2]-e[2],s=t[0]-e[0],c=t[1]-e[1],u=t[2]-e[2];r[0]=a*u-o*c,r[1]=o*s-i*u,r[2]=i*c-a*s}function B2(t,e,n,r){p8(t,e,n,r);const i=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);i!==0&&(r[0]/=i,r[1]/=i,r[2]/=i)}function mG(t,e,n,r,i,a){let o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,s=!1;const c=[],u=[],d=[],g=[],h=[];B2(t,e,n,g),B2(r,i,a,h);const m=-Ft(g,t),y=-Ft(h,r),v=[Ft(h,t)+y,Ft(h,e)+y,Ft(h,n)+y];if(v[0]*v[1]>o&&v[0]*v[2]>o)return{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:d};const C=[Ft(g,r)+m,Ft(g,i)+m,Ft(g,a)+m];if(C[0]*C[1]>o&&C[0]*C[2]>o)return{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:d};if(Math.abs(g[0]-h[0])<1e-9&&Math.abs(g[1]-h[1])<1e-9&&Math.abs(g[2]-h[2])<1e-9&&Math.abs(m-y)<1e-9)return s=!0,{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:d};const S=[t,e,n],w=[r,i,a],x=Ft(g,h),R=(m-y*x)/(x*x-1),O=(y-m*x)/(x*x-1),b=[R*g[0]+O*h[0],R*g[1]+O*h[1],R*g[2]+O*h[2]],I=Ns(g,h,[]);kl(I);let G=0,j=0;const F=[],$=[];let z=50,oe=50;for(let X=0;X<3;X++){const ie=X,ye=(X+1)%3,ge=Ki.intersectWithLine(S[ie],S[ye],r,h);ge.intersection&&ge.t>0-o&&ge.t<1+o&&(ge.t<1+o&&ge.t>1-o&&(z=G),F[G++]=Ft(ge.x,I)-Ft(b,I));const W=Ki.intersectWithLine(w[ie],w[ye],t,g);W.intersection&&W.t>0-o&&W.t<1+o&&(W.t<1+o&&W.t>1-o&&(oe=j),$[j++]=Ft(W.x,I)-Ft(b,I))}if(G>2){G--;const X=F[2];F[2]=F[z],F[z]=X}if(j>2){j--;const X=$[2];$[2]=$[oe],$[oe]=X}if(G!==2||j!==2)return{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:d};if(Number.isNaN(F[0])||Number.isNaN(F[1])||Number.isNaN($[0])||Number.isNaN($[1]))return{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:d};if(F[0]>F[1]){const X=F[1];F[1]=F[0],F[0]=X}if($[0]>$[1]){const X=$[1];$[1]=$[0],$[0]=X}let Q,le;return F[1]<$[0]||$[1]<F[0]?{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:d}:(F[0]<$[0]?F[1]<$[1]?(d[0]=2,d[1]=1,Q=$[0],le=F[1]):(d[0]=2,d[1]=2,Q=$[0],le=$[1]):F[1]<$[1]?(d[0]=1,d[1]=1,Q=F[0],le=F[1]):(d[0]=1,d[1]=2,Q=F[0],le=$[1]),S4(b,I,Q,c),S4(b,I,le,u),{intersect:!0,coplanar:s,pt1:c,pt2:u,surfaceId:d})}const vG={computeNormalDirection:p8,computeNormal:B2,intersectWithTriangle:mG};function yG(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(n,r,i,a,o)=>{const s={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};o[2]=0;const c=[],u=i*i,d=[],g=[],h=[];e.points.getPoint(0,d),e.points.getPoint(1,g),e.points.getPoint(2,h);const m=[],y=[];if(B2(d,g,h,m),m[0]!==0||m[1]!==0||m[2]!==0){const x=Ki.intersectWithLine(n,r,d,m);if(s.betweenPoints=x.betweenPoints,s.t=x.t,a[0]=x.x[0],a[1]=x.x[1],a[2]=x.x[2],!x.intersection)return o[0]=0,o[1]=0,s.intersect=0,s;const R=t.evaluatePosition(a,c,o,y);if(R.evaluation>=0)return R.dist2<=u?(s.intersect=1,s):(s.intersect=R.evaluation,s)}const v=Es(d,g),C=Es(g,h),S=Es(h,d);e.line||(e.line=Oo.newInstance()),v>C&&v>S?(e.line.getPoints().setPoint(0,d),e.line.getPoints().setPoint(1,g)):C>S&&C>v?(e.line.getPoints().setPoint(0,g),e.line.getPoints().setPoint(1,h)):(e.line.getPoints().setPoint(0,h),e.line.getPoints().setPoint(1,d));const w=e.line.intersectWithLine(n,r,i,a,o);if(s.betweenPoints=w.betweenPoints,s.t=w.t,w.intersect){const x=[],R=[],O=[];for(let b=0;b<3;b++)x[b]=d[b]-h[b],R[b]=g[b]-h[b],O[b]=a[b]-h[b];return o[0]=Ft(O,x)/S,o[1]=Ft(O,R)/C,s.intersect=1,s}return o[0]=0,o[1]=0,s.intersect=0,s},t.evaluatePosition=(n,r,i,a)=>{const o={subId:0,dist2:0,evaluation:-1};let s,c;const u=[],d=[],g=[],h=[];let m;const y=[],v=[],C=[];let S=0,w=0;const x=[];let R,O,b,I=[];const G=[],j=[],F=[];o.subId=0,i[2]=0,e.points.getPoint(1,u),e.points.getPoint(2,d),e.points.getPoint(0,g),p8(u,d,g,h),Ki.generalizedProjectPoint(n,u,h,F);let $=0;for(s=0;s<3;s++)h[s]<0?m=-h[s]:m=h[s],m>$&&($=m,w=s);for(c=0,s=0;s<3;s++)s!==w&&(x[c++]=s);for(s=0;s<2;s++)y[s]=F[x[s]]-g[x[s]],v[s]=u[x[s]]-g[x[s]],C[s]=d[x[s]]-g[x[s]];if(S=gr(v,C),S===0)return i[0]=0,i[1]=0,o.evaluation=-1,o;if(i[0]=gr(y,C)/S,i[1]=gr(v,y)/S,a[0]=1-(i[0]+i[1]),a[1]=i[0],a[2]=i[1],a[0]>=0&&a[0]<=1&&a[1]>=0&&a[1]<=1&&a[2]>=0&&a[2]<=1)r&&(o.dist2=Es(F,n),r[0]=F[0],r[1]=F[1],r[2]=F[2]),o.evaluation=1;else{let z;if(r){if(a[1]<0&&a[2]<0)for(R=Es(n,g),O=Oo.distanceToLine(n,u,g,z,G),b=Oo.distanceToLine(n,g,d,z,j),R<O?(o.dist2=R,I=g):(o.dist2=O,I=G),b<o.dist2&&(o.dist2=b,I=j),s=0;s<3;s++)r[s]=I[s];else if(a[2]<0&&a[0]<0)for(R=Es(n,u),O=Oo.distanceToLine(n,u,g,z,G),b=Oo.distanceToLine(n,u,d,z,j),R<O?(o.dist2=R,I=u):(o.dist2=O,I=G),b<o.dist2&&(o.dist2=b,I=j),s=0;s<3;s++)r[s]=I[s];else if(a[1]<0&&a[0]<0)for(R=Es(n,d),O=Oo.distanceToLine(n,d,g,z,G),b=Oo.distanceToLine(n,u,d,z,j),R<O?(o.dist2=R,I=d):(o.dist2=O,I=G),b<o.dist2&&(o.dist2=b,I=j),s=0;s<3;s++)r[s]=I[s];else if(a[0]<0){const oe=Oo.distanceToLine(n,u,d,r);o.dist2=oe.distance}else if(a[1]<0){const oe=Oo.distanceToLine(n,d,g,r);o.dist2=oe.distance}else if(a[2]<0){const oe=Oo.distanceToLine(n,u,g,r);o.dist2=oe.distance}}o.evaluation=0}return o},t.evaluateLocation=(n,r,i)=>{const a=[],o=[],s=[];e.points.getPoint(0,a),e.points.getPoint(1,o),e.points.getPoint(2,s);const c=1-n[0]-n[1];for(let u=0;u<3;u++)r[u]=a[u]*c+o[u]*n[0]+s[u]*n[1];i[0]=c,i[1]=n[0],i[2]=n[1]},t.getParametricDistance=n=>{let r,i=0;const a=[];a[0]=n[0],a[1]=n[1],a[2]=1-n[0]-n[1];for(let o=0;o<3;o++)a[o]<0?r=-a[o]:a[o]>1?r=a[o]-1:r=0,r>i&&(i=r);return i}}const TG={};function AR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TG,n),G2.extend(t,e,n),yG(t,e)}const CG=H.newInstance(AR,"vtkTriangle");var SG={newInstance:CG,extend:AR,...vG};const y3=["verts","lines","polys","strips"],{vtkWarningMacro:$T}=H,wG={[Hn.VTK_LINE]:Oo,[Hn.VTK_POLY_LINE]:Oo,[Hn.VTK_TRIANGLE]:SG};function xG(t,e){e.classHierarchy.push("vtkPolyData");function n(i){return i.replace(/(?:^\w|[A-Z]|\b\w)/g,a=>a.toUpperCase()).replace(/\s+/g,"")}y3.forEach(i=>{t[`getNumberOf${n(i)}`]=()=>e[i].getNumberOfCells(),e[i]?e[i]=ts(e[i]):e[i]=$l.newInstance()}),t.getNumberOfCells=()=>y3.reduce((i,a)=>i+e[a].getNumberOfCells(),0);const r=t.shallowCopy;t.shallowCopy=function(i){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(i,a),y3.forEach(o=>{e[o]=$l.newInstance(),e[o].shallowCopy(i.getReferenceByName(o))})},t.buildCells=()=>{const i=t.getNumberOfVerts(),a=t.getNumberOfLines(),o=t.getNumberOfPolys(),s=t.getNumberOfStrips(),c=i+a+o+s,u=new Uint8Array(c);let d=u;const g=new Uint32Array(c);let h=g;if(i){let m=0;e.verts.getCellSizes().forEach((y,v)=>{h[v]=m,d[v]=y>1?Hn.VTK_POLY_VERTEX:Hn.VTK_VERTEX,m+=y+1}),h=h.subarray(i),d=d.subarray(i)}if(a){let m=0;e.lines.getCellSizes().forEach((y,v)=>{h[v]=m,d[v]=y>2?Hn.VTK_POLY_LINE:Hn.VTK_LINE,y===1&&$T("Building VTK_LINE ",v," with only one point, but VTK_LINE needs at least two points. Check the input."),m+=y+1}),h=h.subarray(a),d=d.subarray(a)}if(o){let m=0;e.polys.getCellSizes().forEach((y,v)=>{switch(h[v]=m,y){case 3:d[v]=Hn.VTK_TRIANGLE;break;case 4:d[v]=Hn.VTK_QUAD;break;default:d[v]=Hn.VTK_POLYGON;break}y<3&&$T("Building VTK_TRIANGLE ",v," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),m+=y+1}),h+=h.subarray(o),d+=d.subarray(o)}if(s){let m=0;d.fill(Hn.VTK_TRIANGLE_STRIP,0,s),e.strips.getCellSizes().forEach((y,v)=>{h[v]=m,m+=y+1})}e.cells=kk.newInstance(),e.cells.setCellTypes(c,u,g)},t.buildLinks=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells===void 0&&t.buildCells(),e.links=Mk.newInstance(),i>0?e.links.allocate(i):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=i=>e.cells.getCellType(i),t.getCellPoints=i=>{const a=t.getCellType(i);let o=null;switch(a){case Hn.VTK_VERTEX:case Hn.VTK_POLY_VERTEX:o=e.verts;break;case Hn.VTK_LINE:case Hn.VTK_POLY_LINE:o=e.lines;break;case Hn.VTK_TRIANGLE:case Hn.VTK_QUAD:case Hn.VTK_POLYGON:o=e.polys;break;case Hn.VTK_TRIANGLE_STRIP:o=e.strips;break;default:return o=null,{type:0,cellPointIds:null}}const s=e.cells.getCellLocation(i),c=o.getCell(s);return{cellType:a,cellPointIds:c}},t.getPointCells=i=>e.links.getCells(i),t.getCellEdgeNeighbors=(i,a,o)=>{const s=e.links.getLink(a),c=e.links.getLink(o);return s.cells.filter(u=>u!==i&&c.cells.indexOf(u)!==-1)},t.getCell=function(i){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const o=t.getCellPoints(i),s=a||wG[o.cellType].newInstance();return s.initialize(t.getPoints(),o.cellPointIds),s}}const EG={};function NR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,EG,n),pG.extend(t,e,n),H.get(t,e,["cells","links"]),H.setGet(t,e,["verts","lines","polys","strips"]),xG(t,e)}const RG=H.newInstance(NR,"vtkPolyData");var $c={newInstance:RG,extend:NR};const{vtkErrorMacro:OG}=H;class DG{constructor(){this.segmentMapping={},this.segments=[null],this.faces=[]}addSegment(e){const n=e[0],r=e[e.length-1];if(n===r||e.length<2)return;const i=this.segmentMapping[n],a=this.segmentMapping[r];if(i!==void 0&&a!==void 0)if(Math.abs(i)===Math.abs(a)){const o=i<a?a:i,s=this.segments[o];if(i>0)for(let c=1;c<e.length-1;c++)s.push(e[c]);else for(let c=1;c<e.length-1;c++)s.unshift(e[e.length-1-c]);this.faces.push(s),this.segments[o]=null,this.segmentMapping[n]=void 0,this.segmentMapping[r]=void 0}else{const o=Math.abs(i),s=Math.abs(a),c=this.segments[o],u=this.segments[s];this.segments[o]=null,this.segments[s]=null,this.segmentMapping[c[0]]=void 0,this.segmentMapping[u[0]]=void 0,this.segmentMapping[c[c.length-1]]=void 0,this.segmentMapping[u[u.length-1]]=void 0,this.addSegment(e),this.addSegment(c),this.addSegment(u)}else if(i!==void 0){if(i>0){const o=this.segments[i];for(let s=1;s<e.length;s++)o.push(e[s]);this.segmentMapping[r]=i}else{const o=this.segments[-i];this.segmentMapping[r]=i;for(let s=1;s<e.length;s++)o.unshift(e[s])}this.segmentMapping[n]=void 0}else if(a!==void 0){if(a>0){const o=this.segments[a];for(let s=1;s<e.length;s++)o.push(e[e.length-1-s]);this.segmentMapping[n]=a}else{const o=this.segments[-a];this.segmentMapping[n]=a;for(let s=1;s<e.length;s++)o.unshift(e[e.length-s-1])}this.segmentMapping[r]=void 0}else{const o=this.segments.length;this.segments.push(e),this.segmentMapping[n]=-o,this.segmentMapping[r]=o}}}function _G(t,e){e.classHierarchy.push("vtkClosedPolyLineToSurfaceFilter"),t.requestData=(n,r)=>{const i=n[0];if(!i){OG("Invalid or missing input");return}const a=$c.newInstance();a.shallowCopy(i);const o=new DG,s=i.getLines().getData();let c=0;for(;c<s.length;){const h=s[c++],m=[];for(let y=0;y<h;y++)m.push(s[c+y]);o.addSegment(m),c+=h}const{faces:u}=o;let d=u.length;for(let h=0;h<u.length;h++)d+=u[h].length;const g=new Uint16Array(d);c=0;for(let h=0;h<u.length;h++){const m=u[h];g[c++]=m.length;for(let y=0;y<m.length;y++)g[c++]=m[y]}a.setPolys($l.newInstance({values:g,name:"faces"})),r[0]=a}}const bG={};function PR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bG,n),H.obj(t,e),H.algo(t,e,1,1),_G(t,e)}const MG=H.newInstance(PR,"vtkClosedPolyLineToSurfaceFilter");var LG={newInstance:MG,extend:PR};const{vtkErrorMacro:WT}=Zi;function VG(t){const e=t.getPolys().getData(),n=t.getStrips().getData(),r={cellSize:0,cell:[],done:!1,polyIdx:0,stripIdx:0,remainingStripLength:0,next(){if(r.polyIdx<e.length){r.cellSize=e[r.polyIdx];const i=r.polyIdx+1,a=i+r.cellSize;r.polyIdx=a;let o=0;for(let s=i;s<a;++s)r.cell[o++]=e[s]}else if(r.stripIdx<n.length){r.cellSize=3,r.remainingStripLength===0&&(r.remainingStripLength=n[r.stripIdx]-2,r.stripIdx+=3);const i=r.stripIdx-2,a=r.stripIdx+1;r.stripIdx++,r.remainingStripLength--;let o=0;for(let s=i;s<a;++s)r.cell[o++]=n[s]}else if(!r.done)r.done=!0;else throw new Error("Iterator is done")}};return r.next(),r}function IG(t,e){e.classHierarchy.push("vtkCutter");const n={...t};t.getMTime=()=>{let i=n.getMTime();return e.cutFunction&&(i=Math.max(i,e.cutFunction.getMTime())),i};function r(i,a){const o=i.getPoints(),s=o.getData(),c=o.getNumberOfPoints(),u=[],d=[],g=[];(!e.cutScalars||e.cutScalars.length<c)&&(e.cutScalars=new Float32Array(c));let h=0,m=0;for(;h<s.length;)e.cutScalars[m++]=e.cutFunction.evaluateFunction(s[h++],s[h++],s[h++]);const y=[],v=new Array(3),C=new Array(3),S=[];for(const x=VG(i);!x.done;x.next()){if(x.cellSize<=2)continue;for(let G=0;G<x.cellSize;)S[G]=e.cutScalars[x.cell[G++]];const R=S[0]>0;let O=!0;for(let G=1;G<x.cell.length;G++)if(S[G]>0!==R){O=!1;break}if(O)continue;const b=[];for(let G=0;G<x.cellSize;G++){const j=G+1===x.cellSize?0:G+1,F=S[G]>0;if(S[j]>0===F)continue;let z=G,oe=j,Q=S[oe]-S[z];Q<=0&&(z=j,oe=G,Q*=-1);let le=0;Q!==0&&(le=(e.cutValue-S[z])/Q);const X=x.cell[z],ie=x.cell[oe];v[0]=s[X*3],v[1]=s[X*3+1],v[2]=s[X*3+2],C[0]=s[ie*3],C[1]=s[ie*3+1],C[2]=s[ie*3+2];const ye=[v[0]+le*(C[0]-v[0]),v[1]+le*(C[1]-v[1]),v[2]+le*(C[2]-v[2])];b.push({pointEdge1:X,pointEdge2:ie,intersectedPoint:ye,newPointID:-1})}for(let G=0;G<b.length;G++){const j=b[G];let F=!1;for(let $=0;$<y.length;$++){const z=y[$],oe=j.pointEdge1===z.pointEdge1&&j.pointEdge2===z.pointEdge2,Q=j.intersectedPoint[0]===z.intersectedPoint[0]&&j.intersectedPoint[1]===z.intersectedPoint[1]&&j.intersectedPoint[2]===z.intersectedPoint[2];if(oe||Q){F=!0,b[G].newPointID=y[$].newPointID;break}}F||(u.push(j.intersectedPoint[0]),u.push(j.intersectedPoint[1]),u.push(j.intersectedPoint[2]),b[G].newPointID=u.length/3-1,y.push(b[G]))}const I=b.length;I===2?d.push(I,b[0].newPointID,b[1].newPointID):I>2&&(g.push(I),b.forEach(G=>{g.push(G.newPointID)}))}a.getPoints().setData(hp(o.getDataType(),u),3),d.length!==0&&a.getLines().setData(Uint16Array.from(d)),g.length!==0&&a.getPolys().setData(Uint16Array.from(g))}t.requestData=(i,a)=>{const o=i[0];if(!o){WT("Invalid or missing input");return}if(!e.cutFunction){WT("Missing cut function");return}const s=$c.newInstance();r(o,s),a[0]=s}}const AG={cutFunction:null,cutScalars:null,cutValue:0};function UR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AG,n),Yn(t,e),Dv(t,e,1,1),ri(t,e,["cutFunction","cutValue"]),IG(t,e)}const NG=An(UR,"vtkCutter");var PG={newInstance:NG,extend:UR};const Wc={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2};var FR={ObjectType:Wc};const{ObjectType:t2}=FR,UG={};function FG(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function n(s){switch(s){case t2.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case t2.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case t2.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let r=null,i=null,a=!0,o="";t.getType=()=>r,t.setType=s=>{r=s},t.getHandle=()=>i,t.isReady=()=>a===!1,t.generateBuffer=s=>{const c=n(s);return i===null&&(i=e.context.createBuffer(),r=s),n(r)===c},t.upload=(s,c)=>t.generateBuffer(c)?(e.context.bindBuffer(n(r),i),e.context.bufferData(n(r),s,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=s.length*s.BYTES_PER_ELEMENT,a=!1,!0):(o="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>i?(e.context.bindBuffer(n(r),i),!0):!1,t.release=()=>i?(e.context.bindBuffer(n(r),null),!0):!1,t.releaseGraphicsResources=()=>{i!==null&&(e.context.bindBuffer(n(r),null),e.context.deleteBuffer(i),i=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=s=>{e._openGLRenderWindow!==s&&(t.releaseGraphicsResources(),e._openGLRenderWindow=s,e.context=null,s&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>o}const kG={objectType:t2.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function kR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kG,n),H.obj(t,e),H.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),H.moveToProtected(t,e,["openGLRenderWindow"]),FG(t,e)}const GG=H.newInstance(kR);var Uc={newInstance:GG,extend:kR,...UG,...FR};const GR={FLAT:0,GOURAUD:1,PHONG:2},bo={POINTS:0,WIREFRAME:1,SURFACE:2},BG=GR;var BR={Shading:GR,Representation:bo,Interpolation:BG};const{vtkErrorMacro:zT}=H;function $G(t,e){const n=new Float64Array(3);SE(n,e);const r=new Float64Array(16);return pE(r,Bl(),t,n),r}function WG(t,e){return t===null||e===null?!1:!(MT(t,[0,0,0])&&MT(e,[1,1,1]))}function zG(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(Wc.ARRAY_BUFFER),t.createVBO=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!n.getData()||!n.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];const s=a.points.getData();let c=null,u=null,d=null;const g=a.colors?a.colors.getNumberOfComponents():0,h=a.tcoords?a.tcoords.getNumberOfComponents():0;a.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,c=a.normals.getData()),a.customAttributes&&a.customAttributes.forEach(ge=>{ge&&(e.customData.push({data:ge.getData(),offset:4*e.blockSize,components:ge.getNumberOfComponents(),name:ge.getName()}),e.blockSize+=ge.getNumberOfComponents())}),a.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=h,e.blockSize+=h,u=a.tcoords.getData()),a.colors?(e.colorComponents=a.colors.getNumberOfComponents(),e.colorOffset=0,d=a.colors.getData(),e.colorBO||(e.colorBO=Uc.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let m=0,y=0,v=0,C=0,S=0,w=0,x;const R={anythingToPoints(ge,W,ae,fe){for(let ue=0;ue<ge;++ue)x(W[ae+ue],fe)},linesToWireframe(ge,W,ae,fe){for(let ue=0;ue<ge-1;++ue)x(W[ae+ue],fe),x(W[ae+ue+1],fe)},polysToWireframe(ge,W,ae,fe){if(ge>2)for(let ue=0;ue<ge;++ue)x(W[ae+ue],fe),x(W[ae+(ue+1)%ge],fe)},stripsToWireframe(ge,W,ae,fe){if(ge>2){for(let ue=0;ue<ge-1;++ue)x(W[ae+ue],fe),x(W[ae+ue+1],fe);for(let ue=0;ue<ge-2;ue++)x(W[ae+ue],fe),x(W[ae+ue+2],fe)}},polysToSurface(ge,W,ae,fe){for(let ue=0;ue<ge-2;ue++)x(W[ae+0],fe),x(W[ae+ue+1],fe),x(W[ae+ue+2],fe)},stripsToSurface(ge,W,ae,fe){for(let ue=0;ue<ge-2;ue++)x(W[ae+ue],fe),x(W[ae+ue+1+ue%2],fe),x(W[ae+ue+1+(ue+1)%2],fe)}},O={anythingToPoints(ge,W){return ge},linesToWireframe(ge,W){return ge>1?(ge-1)*2:0},polysToWireframe(ge,W){return ge>2?ge*2:0},stripsToWireframe(ge,W){return ge>2?ge*4-6:0},polysToSurface(ge,W){return ge>2?(ge-2)*3:0},stripsToSurface(ge,W,ae){return ge>2?(ge-2)*3:0}};let b=null,I=null;i===bo.POINTS||r==="verts"?(b=R.anythingToPoints,I=O.anythingToPoints):i===bo.WIREFRAME||r==="lines"?(b=R[`${r}ToWireframe`],I=O[`${r}ToWireframe`]):(b=R[`${r}ToSurface`],I=O[`${r}ToSurface`]);const G=n.getData(),j=G.length;let F=0;for(let ge=0;ge<j;)F+=I(G[ge],G),ge+=G[ge]+1;let $=null;const z=new Float32Array(F*e.blockSize);d&&($=new Uint8Array(F*4));let oe=0,Q=0,le=0,X=0;for(let ge=0;ge<3;++ge){const W=a.points.getRange(ge),ae=W[1]-W[0];le+=ae*ae;const fe=.5*(W[1]+W[0]);X+=fe*fe}if(le>0&&(Math.abs(X)/le>1e6||Math.abs(Math.log10(le))>3||le===0&&X>1e6)){const ge=new Float64Array(3),W=new Float64Array(3);for(let ae=0;ae<3;++ae){const fe=a.points.getRange(ae),ue=fe[1]-fe[0];ge[ae]=.5*(fe[1]+fe[0]),W[ae]=ue>0?1/ue:1}t.setCoordShiftAndScale(ge,W)}else e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null);if(o)if(!o.points&&!o.cells)o.points=new Int32Array(F),o.cells=new Int32Array(F);else{const ge=new Int32Array(F+o.points.length);ge.set(o.points),o.points=ge;const W=new Int32Array(F+o.cells.length);W.set(o.cells),o.cells=W}let ye=a.vertexOffset;x=function(W,ae){if(o&&(o.points[ye]=W,o.cells[ye]=w+a.cellOffset),++ye,m=W*3,e.coordShiftAndScaleEnabled?(z[oe++]=(s[m++]-e.coordShift[0])*e.coordScale[0],z[oe++]=(s[m++]-e.coordShift[1])*e.coordScale[1],z[oe++]=(s[m++]-e.coordShift[2])*e.coordScale[2]):(z[oe++]=s[m++],z[oe++]=s[m++],z[oe++]=s[m++]),c!==null&&(a.haveCellNormals?y=(w+a.cellOffset)*3:y=W*3,z[oe++]=c[y++],z[oe++]=c[y++],z[oe++]=c[y++]),e.customData.forEach(fe=>{S=W*fe.components;for(let ue=0;ue<fe.components;++ue)z[oe++]=fe.data[S++]}),u!==null){a.useTCoordsPerCell?v=ae*h:v=W*h;for(let fe=0;fe<h;++fe)z[oe++]=u[v++]}d!==null&&(a.haveCellScalars?C=(w+a.cellOffset)*g:C=W*g,$[Q++]=d[C++],$[Q++]=d[C++],$[Q++]=d[C++],$[Q++]=g===4?d[C++]:255)};for(let ge=0;ge<j;ge+=G[ge]+1,w++)b(G[ge],G,ge+1,w+a.cellOffset);return e.elementCount=F,t.upload(z,Wc.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload($,Wc.ARRAY_BUFFER)),w},t.setCoordShiftAndScale=(n,r)=>{if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){zT("Wrong type for coordShift, expected vec3 or null");return}if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){zT("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||n===null||!LT(n,e.coordShift))&&(e.coordShift=n),(e.coordScale===null||r===null||!LT(r,e.coordScale))&&(e.coordScale=r),e.coordShiftAndScaleEnabled=WG(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=$G(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}const HG={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function $R(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HG,n),Uc.extend(t,e,n),H.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),H.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),zG(t,e)}const jG=H.newInstance($R);var qG={newInstance:jG,extend:$R};const{vtkErrorMacro:KG}=H;function YG(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let n=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":n=e.context.FRAGMENT_SHADER;break;case"Vertex":default:n=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(n),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){const i=e.context.getShaderInfoLog(e.handle);return KG(`Error compiling shader '${e.source}': ${i}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}const XG={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function WR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XG,n),H.obj(t,e),H.setGet(t,e,["shaderType","source","error","handle","context"]),YG(t,e)}const ZG=H.newInstance(WR,"vtkShader");var T3={newInstance:ZG,extend:WR};const{vtkErrorMacro:Ss}=H;function QG(t,e,n,r){const i=typeof n=="string"?n:n.join(`
`),a=r===!1?e:new RegExp(e,"g"),o=t.replace(a,i);return{replace:o!==i,result:o}}function JG(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(Ss(e.error),0):t.link()?(t.setCompiled(!0),1):(Ss(`Links failed: ${e.error}`),0):(Ss(e.fragmentShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),Ss(e.fragmentShader.getError()),0):(Ss(e.vertexShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),Ss(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=n=>{e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){const r=e.context.getProgramInfoLog(e.handle);return Ss(`Error linking shader ${r}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const a=new Float32Array(r);return e.context.uniformMatrix4fv(i,!1,a),!0},t.setUniformMatrix3x3=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const a=new Float32Array(r);return e.context.uniformMatrix3fv(i,!1,a),!0},t.setUniformf=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1f(i,r),!0)},t.setUniformfv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1fv(i,r),!0)},t.setUniformi=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1i(i,r),!0)},t.setUniformiv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1iv(i,r),!0)},t.setUniform2f=(n,r,i)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(a,r,i),!0},t.setUniform2fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2fv(i,r),!0)},t.setUniform2i=(n,r,i)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(a,r,i),!0},t.setUniform2iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2iv(i,r),!0)},t.setUniform3f=(n,r,i,a)=>{const o=t.findUniform(n);if(o===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(o,r,i,a),!0},t.setUniform3fArray=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(!Array.isArray(r)||r.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(i,r[0],r[1],r[2]),!0},t.setUniform3fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3fv(i,r),!0)},t.setUniform3i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s=a;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(r,s[0],s[1],s[2]),!0},t.setUniform3iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3iv(i,r),!0)},t.setUniform4f=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s=a;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(r,s[0],s[1],s[2],s[3]),!0},t.setUniform4fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4fv(i,r),!0)},t.setUniform4i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s=a;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(r,s[0],s[1],s[2],s[3]),!0},t.setUniform4iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4iv(i,r),!0)},t.findUniform=n=>{if(!n||!e.linked)return-1;let r=e.uniformLocs[n];return r!==void 0?r:(r=e.context.getUniformLocation(e.handle,n),r===null?(e.error=`Uniform ${n} not found in current shader program.`,e.uniformLocs[n]=-1,-1):(e.uniformLocs[n]=r,r))},t.isUniformUsed=n=>{if(!n)return!1;let r=e.uniformLocs[n];return r!==void 0?r!==null:e.linked?(r=e.context.getUniformLocation(e.handle,n),e.uniformLocs[n]=r,r!==null):(Ss("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=n=>{if(!n)return!1;if(n in e.attributeLocs)return!0;if(!e.linked)return Ss("attempt to find uniform when the shader program is not linked"),!1;const r=e.context.getAttribLocation(e.handle,n);return r===-1?!1:(e.attributeLocs[n]=r,!0)},t.attachShader=n=>{if(n.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){const r=e.context.createProgram();if(r===0)return e.error="Could not create shader program.",!1;e.handle=r,e.linked=!1}return n.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=n.getHandle()),n.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=n.getHandle()),e.context.attachShader(e.handle,n.getHandle()),t.setLinked(!1),!0},t.detachShader=n=>{if(n.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),n.getShaderType()){case"Vertex":return e.vertexShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=n=>{e.context=n,e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.setLastCameraMTime=n=>{e.lastCameraMTime=n}}const eB={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function zR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eB,n),e.attributesLocs={},e.uniformLocs={},e.vertexShader=T3.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=T3.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=T3.newInstance(),e.geometryShader.setShaderType("Geometry"),H.obj(t,e),H.get(t,e,["lastCameraMTime"]),H.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),JG(t,e)}const tB=H.newInstance(zR,"vtkShaderProgram");var Te={newInstance:tB,extend:zR,substitute:QG};function nB(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,i.buffer);for(let a=0;a<i.attributes.length;++a){const o=i.attributes[a],s=o.isMatrix?o.size:1;for(let c=0;c<s;++c)n.enableVertexAttribArray(o.index+c),n.vertexAttribPointer(o.index+c,o.size,o.type,o.normalize,o.stride,o.offset+o.stride*c/o.size),o.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(o.index+c,1):n.vertexAttribDivisor(o.index+c,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,i.buffer);for(let a=0;a<i.attributes.length;++a){const o=i.attributes[a],s=o.isMatrix?o.size:1;for(let c=0;c<s;++c)n.enableVertexAttribArray(o.index+c),n.vertexAttribPointer(o.index+c,o.size,o.type,o.normalize,o.stride,o.offset+o.stride*c/o.size),o.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(o.index+c,0):n.vertexAttribDivisor(o.index+c,0)),n.disableVertexAttribArray(o.index+c)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(n,r,i,a,o,s,c,u)=>t.addAttributeArrayWithDivisor(n,r,i,a,o,s,c,u,0,!1),t.addAttributeArrayWithDivisor=(n,r,i,a,o,s,c,u,d,g)=>{if(!n||!n.isBound()||r.getHandle()===0||r.getType()!==Wc.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=n.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==n.getHandle()))return!1;const h=e.context,m={};if(m.name=i,m.index=h.getAttribLocation(e.handleProgram,i),m.offset=a,m.stride=o,m.type=s,m.size=c,m.normalize=u,m.isMatrix=g,m.divisor=d,m.Index===-1)return!1;if(r.bind(),h.enableVertexAttribArray(m.index),h.vertexAttribPointer(m.index,m.size,m.type,m.normalize,m.stride,m.offset),d>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(m.index,1):h.vertexAttribDivisor(m.index,1)),m.buffer=r.getHandle(),!e.supported){let y=!1;for(let v=0;v<e.buffers.length;++v){const C=e.buffers[v];if(C.buffer===m.buffer){y=!0;let S=!1;for(let w=0;w<C.attributes.length;++w)C.attributes[w].name===i&&(S=!0,C.attributes[w]=m);S||C.attributes.push(m)}}y||e.buffers.push({buffer:m.buffer,attributes:[m]})}return!0},t.addAttributeMatrixWithDivisor=(n,r,i,a,o,s,c,u,d)=>{const g=t.addAttributeArrayWithDivisor(n,r,i,a,o,s,c,u,d,!0);if(!g)return g;const h=e.context,m=h.getAttribLocation(e.handleProgram,i);for(let y=1;y<c;y++)h.enableVertexAttribArray(m+y),h.vertexAttribPointer(m+y,c,s,u,o,a+o*y/c),d>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(m+y,1):h.vertexAttribDivisor(m+y,1));return!0},t.removeAttributeArray=n=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];for(let a=0;a<i.attributes.length;++a)if(i.attributes[a].name===n)return i.attributes.splice(a,1),i.attributes.length||e.buffers.splice(r,1),!0}return!0},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const rB={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function HR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rB,n),e.buffers=[],H.obj(t,e),H.get(t,e,["supported"]),H.setGet(t,e,["forceEmulation"]),nB(t,e)}const iB=H.newInstance(HR,"vtkOpenGLVertexArrayObject");var m8={newInstance:iB,extend:HR};const O0={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function aB(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=n=>{e.context=n.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(n),e.CABO.setOpenGLRenderWindow(n)},t.releaseGraphicsResources=n=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(n,r,i,a)=>{if(e.CABO.getElementCount()){const o=t.getOpenGLMode(i),s=t.haveWideLines(n,r),c=e.context,u=c.getParameter(c.DEPTH_WRITEMASK);e.pointPicking&&c.depthMask(!1),o===c.LINES&&s?(t.updateShaders(n,r,a),c.drawArraysInstanced(o,0,e.CABO.getElementCount(),2*Math.ceil(r.getProperty().getLineWidth()))):(c.lineWidth(r.getProperty().getLineWidth()),t.updateShaders(n,r,a),c.drawArrays(o,0,e.CABO.getElementCount()),c.lineWidth(1));const g=(o===c.POINTS?1:0)||(o===c.LINES?2:3);return e.pointPicking&&c.depthMask(u),e.CABO.getElementCount()/g}return 0},t.getOpenGLMode=n=>{if(e.pointPicking)return e.context.POINTS;const r=e.primitiveType;return n===bo.POINTS||r===O0.Points?e.context.POINTS:n===bo.WIREFRAME||r===O0.Lines||r===O0.TrisEdges||r===O0.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(n,r)=>r.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=r.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(n,r,i)=>!!(i.getNeedToRebuildShaders(t,n,r)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<i.getMTime()||t.getShaderSourceTime().getMTime()<r.getMTime()),t.updateShaders=(n,r,i)=>{if(t.getNeedToRebuildShaders(n,r,i)){const a={Vertex:null,Fragment:null,Geometry:null};i.buildShaders(a,n,r);const o=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(a.Vertex,a.Fragment,a.Geometry);o!==t.getProgram()&&(t.setProgram(o),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),i.setMapperShaderParameters(t,n,r),i.setPropertyShaderParameters(t,n,r),i.setCameraShaderParameters(t,n,r),i.setLightingShaderParameters(t,n,r),i.invokeShaderCallbacks(t,n,r)},t.setMapperShaderParameters=(n,r,i)=>{if(t.haveWideLines(n,r)){t.getProgram().setUniform2f("viewportSize",i.usize,i.vsize);const a=parseFloat(r.getProperty().getLineWidth()),o=a/2;t.getProgram().setUniformf("lineWidthStepSize",a/Math.ceil(a)),t.getProgram().setUniformf("halfLineWidth",o)}e.primitiveType===O0.Points||r.getProperty().getRepresentation()===bo.POINTS?t.getProgram().setUniformf("pointSize",r.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(n,r,i)=>{let a=n.Vertex;a=Te.substitute(a,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,a=Te.substitute(a,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(i.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(r,i)&&(a=Te.substitute(a,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,a=Te.substitute(a,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),n.Vertex=a},t.getPointPickingPrimitiveSize=()=>e.primitiveType===O0.Points?2:e.primitiveType===O0.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}const oB={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function jR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oB,n),H.obj(t,e),e.shaderSourceTime={},H.obj(e.shaderSourceTime),e.attributeUpdateTime={},H.obj(e.attributeUpdateTime),H.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=Te.newInstance(),e.VAO=m8.newInstance(),e.CABO=qG.newInstance(),aB(t,e)}const sB=H.newInstance(jR);var Y0={newInstance:sB,extend:jR,primTypes:O0};const cB=t=>t,HT=1e-6;let qR=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.matrix=wt(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?tU:cB}rotateFromDirections(e,n){const r=new Float64Array(3),i=new Float64Array(3),a=new Float64Array(16);gn(r,e[0],e[1],e[2]),gn(i,n[0],n[1],n[2]),Sn(r,r),Sn(i,i);const o=ft(r,i);return o>=1?this:(Cn(this.tmp,r,i),Gc(this.tmp)<HT&&(Cn(this.tmp,[1,0,0],e),Gc(this.tmp)<HT&&Cn(this.tmp,[0,1,0],e)),Kv(a,Math.acos(o),this.tmp),zt(this.matrix,this.matrix,a),this)}rotate(e,n){return gn(this.tmp,...n),Sn(this.tmp,this.tmp),Yo(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return zv(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return Hv(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return jv(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,n,r){return gn(this.tmp,e,n,r),Gr(this.matrix,this.matrix,this.tmp),this}scale(e,n,r){return gn(this.tmp,e,n,r),Us(this.matrix,this.matrix,this.tmp),this}multiply(e){return zt(this.matrix,this.matrix,e),this}multiply3x3(e){return zt(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return Br(this.matrix,this.matrix),this}identity(){return wt(this.matrix),this}apply(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(P1(Lv,this.matrix))return this;const i=r===-1?e.length:n+r*3;for(let a=n;a<i;a+=3)gn(this.tmp,e[a],e[a+1],e[a+2]),an(this.tmp,this.tmp,this.matrix),e[a]=this.tmp[0],e[a+1]=this.tmp[1],e[a+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&e.length===16&&_r(this.matrix,e),this}};function lB(){return new qR(!0)}function uB(){return new qR(!1)}var Ml={buildFromDegree:lB,buildFromRadian:uB};const fB=[2,0,1,2,2,3,2,4,5,2,6,7,2,0,2,2,1,3,2,4,6,2,5,7,2,0,4,2,1,5,2,2,6,2,3,7],gB=[4,0,1,3,2,4,4,6,7,5,4,8,10,11,9,4,12,13,15,14,4,16,18,19,17,4,20,21,23,22];function dB(t,e){e.classHierarchy.push("vtkCubeSource");function n(r,i){if(e.deleted)return;const a=$c.newInstance();i[0]=a;const o=24,s=H.newTypedArray(e.pointType,o*3);a.getPoints().setData(s,3);const c=H.newTypedArray(e.pointType,o*3),u=Pt.newInstance({name:"Normals",values:c,numberOfComponents:3});a.getPointData().setNormals(u);let d=2;e.generate3DTextureCoordinates===!0&&(d=3);const g=H.newTypedArray(e.pointType,o*d),h=Pt.newInstance({name:"TextureCoordinates",values:g,numberOfComponents:d});a.getPointData().setTCoords(h);const m=[0,0,0],y=[0,0,0],v=[0,0];let C=0;m[0]=-e.xLength/2,y[0]=-1,y[1]=0,y[2]=0;for(let S=0;S<2;S++){m[1]=-e.yLength/2;for(let w=0;w<2;w++){v[1]=m[1]+.5,m[2]=-e.zLength/2;for(let x=0;x<2;x++)v[0]=(m[2]+.5)*(1-2*S),s[C*3]=m[0],s[C*3+1]=m[1],s[C*3+2]=m[2],c[C*3]=y[0],c[C*3+1]=y[1],c[C*3+2]=y[2],d===2?(g[C*d]=v[0],g[C*d+1]=v[1]):(g[C*d]=2*S-1,g[C*d+1]=2*w-1,g[C*d+2]=2*x-1),C++,m[2]+=e.zLength;m[1]+=e.yLength}m[0]+=e.xLength,y[0]+=2}m[1]=-e.yLength/2,y[1]=-1,y[0]=0,y[2]=0;for(let S=0;S<2;S++){m[0]=-e.xLength/2;for(let w=0;w<2;w++){v[0]=(m[0]+.5)*(2*S-1),m[2]=-e.zLength/2;for(let x=0;x<2;x++)v[1]=(m[2]+.5)*-1,s[C*3]=m[0],s[C*3+1]=m[1],s[C*3+2]=m[2],c[C*3]=y[0],c[C*3+1]=y[1],c[C*3+2]=y[2],d===2?(g[C*d]=v[0],g[C*d+1]=v[1]):(g[C*d]=2*w-1,g[C*d+1]=2*S-1,g[C*d+2]=2*x-1),C++,m[2]+=e.zLength;m[0]+=e.xLength}m[1]+=e.yLength,y[1]+=2}m[2]=-e.zLength/2,y[2]=-1,y[0]=0,y[1]=0;for(let S=0;S<2;S++){m[1]=-e.yLength/2;for(let w=0;w<2;w++){v[1]=m[1]+.5,m[0]=-e.xLength/2;for(let x=0;x<2;x++)v[0]=(m[0]+.5)*(2*S-1),s[C*3]=m[0],s[C*3+1]=m[1],s[C*3+2]=m[2],c[C*3]=y[0],c[C*3+1]=y[1],c[C*3+2]=y[2],d===2?(g[C*d]=v[0],g[C*d+1]=v[1]):(g[C*d]=2*x-1,g[C*d+1]=2*w-1,g[C*d+2]=2*S-1),C++,m[0]+=e.xLength;m[1]+=e.yLength}m[2]+=e.zLength,y[2]+=2}if(e.rotations&&Ml.buildFromDegree().rotateX(e.rotations[0]).rotateY(e.rotations[1]).rotateZ(e.rotations[2]).apply(s).apply(c),e.center&&Ml.buildFromRadian().translate(...e.center).apply(s),e.matrix){Ml.buildFromRadian().setMatrix(e.matrix).apply(s);const S=[e.matrix[0],e.matrix[1],e.matrix[2],0,e.matrix[4],e.matrix[5],e.matrix[6],0,e.matrix[8],e.matrix[9],e.matrix[10],0,0,0,0,1];Ml.buildFromRadian().setMatrix(S).apply(c)}e.generateFaces?a.getPolys().deepCopy(e._polys):a.getPolys().initialize(),e.generateLines?(a.getLines().deepCopy(e._lineCells),a.getPointData().setNormals(null)):a.getLines().initialize(),a.modified()}t.setBounds=function(){let r=[];if(Array.isArray(arguments.length<=0?void 0:arguments[0]))r=arguments.length<=0?void 0:arguments[0];else for(let i=0;i<arguments.length;i++)r.push(i<0||arguments.length<=i?void 0:arguments[i]);r.length===6&&(t.setXLength(r[1]-r[0]),t.setYLength(r[3]-r[2]),t.setZLength(r[5]-r[4]),t.setCenter([(r[0]+r[1])/2,(r[2]+r[3])/2,(r[4]+r[5])/2]))},t.requestData=n}const hB={xLength:1,yLength:1,zLength:1,pointType:"Float64Array",generate3DTextureCoordinates:!1,generateFaces:!0,generateLines:!1};function KR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hB,n),H.obj(t,e),H.setGet(t,e,["xLength","yLength","zLength","generate3DTextureCoordinates","generateFaces","generateLines"]),H.setGetArray(t,e,["center","rotations"],3),H.setGetArray(t,e,["matrix"],16),e._polys=$l.newInstance({values:Uint16Array.from(gB)}),e._lineCells=$l.newInstance({values:Uint16Array.from(fB)}),H.moveToProtected(t,e,["polys","lineCells"]),H.algo(t,e,0,1),dB(t,e)}const pB=H.newInstance(KR,"vtkCubeSource");var mB={newInstance:pB,extend:KR};const{vtkErrorMacro:jT}=H;function vB(t,e){e.classHierarchy.push("vtkImageDataOutlineFilter");const n={...t};t.requestData=(r,i)=>{const a=r[0];if(!a||!a.isA("vtkImageData")){jT("Invalid or missing input");return}const o=a.getSpatialExtent();if(!o){jT("Unable to fetch spatial extents of input image.");return}e._cubeSource.setBounds(o),e._cubeSource.setMatrix(a.getIndexToWorld()),i[0]=e._cubeSource.getOutputData()},t.getMTime=()=>Math.max(n.getMTime(),e._cubeSource.getMTime()),t.setGenerateFaces=e._cubeSource.setGenerateFaces,t.setGenerateLines=e._cubeSource.setGenerateLines,t.getGenerateFaces=e._cubeSource.getGenerateFaces,t.getGenerateLines=e._cubeSource.getGenerateLines}const yB={};function YR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yB,n),H.obj(t,e),H.algo(t,e,1,1),e._cubeSource=mB.newInstance(),H.moveToProtected(t,e,["cubeSource","tmpOut"]),vB(t,e)}const TB=H.newInstance(YR,"vtkImageDataOutlineFilter");var CB={newInstance:TB,extend:YR};const C1={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},pt={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5};var XR={Wrap:C1,Filter:pt};const ZR=new Float32Array(1),SB=new Int32Array(ZR.buffer);function wB(t){ZR[0]=t;const e=SB[0];let n=e>>16&32768,r=e>>12&2047;const i=e>>23&255;return i<103?n:i>142?(n|=31744,n|=(i===255?0:1)&&e&8388607,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=r&1,n)}function xB(t){const e=(t&32768)>>15,n=(t&31744)>>10,r=t&1023;return n===0?(e?-1:1)*2**-14*(r/2**10):n===31?r?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(n-15)*(1+r/2**10)}var ku={fromHalf:xB,toHalf:wB};function EB(){try{const r=new Int16Array([0,32767]),i=[1,1],a=document.createElement("canvas");a.width=4,a.height=4;const o=a.getContext("webgl2");if(!o)return!1;const s=o.getExtension("EXT_texture_norm16");if(!s)return!1;const c=`#version 300 es
    void main() {
      gl_PointSize = ${4 .toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,u=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `,d=o.createShader(o.VERTEX_SHADER);if(o.shaderSource(d,c),o.compileShader(d),!o.getShaderParameter(d,o.COMPILE_STATUS))return!1;const g=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(g,u),o.compileShader(g),!o.getShaderParameter(g,o.COMPILE_STATUS))return!1;const h=o.createProgram();if(o.attachShader(h,d),o.attachShader(h,g),o.linkProgram(h),!o.getProgramParameter(h,o.LINK_STATUS))return!1;const m=o.createTexture();o.bindTexture(o.TEXTURE_2D,m),o.texImage2D(o.TEXTURE_2D,0,s.R16_SNORM_EXT,2,1,0,o.RED,o.SHORT,r),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.useProgram(h),o.drawArrays(o.POINTS,0,1);const y=new Uint8Array(4);o.readPixels(i[0],i[1],1,1,o.RGBA,o.UNSIGNED_BYTE,y);const[v,C,S]=y,w=o.getExtension("WEBGL_lose_context");return w&&w.loseContext(),v===C&&C===S&&v!==0}catch{return!1}}let C3;function RB(){return C3===void 0&&(C3=EB()),C3}const{Wrap:bc,Filter:li}=XR,{VtkDataTypes:cn}=Pt,{vtkDebugMacro:S3,vtkErrorMacro:Ru,vtkWarningMacro:qT}=Zi,{toHalf:OB}=ku;function DB(t,e){e.classHierarchy.push("vtkOpenGLTexture");function n(){return{internalFormat:e.internalFormat,format:e.format,openGLDataType:e.openGLDataType,width:e.width,height:e.height}}t.render=function(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(y?e._openGLRenderWindow=y:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow")),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(li.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(li.LINEAR),t.setMagnificationFilter(li.LINEAR)):(t.setMinificationFilter(li.NEAREST),t.setMagnificationFilter(li.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(bc.REPEAT),t.setWrapS(bc.REPEAT),t.setWrapT(bc.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(li.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(li.LINEAR_MIPMAP_LINEAR));const C=e.renderable.getCanvas();t.create2DFromRaw(C.width,C.height,4,cn.UNSIGNED_CHAR,C,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){const C=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(li.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw(C.width,C.height,4,cn.UNSIGNED_CHAR,C.data,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}const v=e.renderable.getInputData(0);if(v&&v.getPointData().getScalars()){const C=v.getExtent(),S=v.getPointData().getScalars(),w=[];for(let x=0;x<e.renderable.getNumberOfInputPorts();++x){const R=e.renderable.getInputData(x),O=R?R.getPointData().getScalars().getData():null;O&&w.push(O)}e.renderable.getInterpolate()&&S.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(li.LINEAR_MIPMAP_LINEAR)),w.length%6===0?t.createCubeFromRaw(C[1]-C[0]+1,C[3]-C[2]+1,S.getNumberOfComponents(),S.getDataType(),w):t.create2DFromRaw(C[1]-C[0]+1,C[3]-C[2]+1,S.getNumberOfComponents(),S.getDataType(),S.getData()),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()};const r=()=>{if(!((e.minificationFilter===li.LINEAR||e.magnificationFilter===li.LINEAR)&&!RB()))return e.oglNorm16Ext};t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=y=>{y&&e.handle&&(y.activateTexture(t),y.deactivateTexture(t),e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(y),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let y=!1;if(e.context&&e.handle){let v=0;switch(e.target){case e.context.TEXTURE_2D:v=e.context.TEXTURE_BINDING_2D;break;default:qT("impossible case");break}y=e.context.getIntegerv(v)===e.handle}return y},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(y,v)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(y,v)),e.internalFormat||S3(`Unable to find suitable internal format for T=${y} NC= ${v}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&qT("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(y,v)=>{let C=0;return C=e._openGLRenderWindow.getDefaultTextureInternalFormat(y,v,r(),t.useHalfFloat()),C||(C||(S3("Unsupported internal texture type!"),S3(`Unable to find suitable internal format for T=${y} NC= ${v}`)),C)},t.useHalfFloat=()=>e.enableUseHalfFloat&&e.canUseHalfFloat,t.setInternalFormat=y=>{e._forceInternalFormat=!0,y!==e.internalFormat&&(e.internalFormat=y,t.modified())},t.getFormat=(y,v)=>(e.format=t.getDefaultFormat(y,v),e.format),t.getDefaultFormat=(y,v)=>{if(e._openGLRenderWindow.getWebgl2())switch(v){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(v){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e._prevTexParams=null,e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=y=>{const v=t.useHalfFloat();if(e._openGLRenderWindow.getWebgl2())switch(y){case cn.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(r()&&!v&&cn.SHORT):return e.context.SHORT;case(r()&&!v&&cn.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(v&&cn.SHORT):return e.context.HALF_FLOAT;case(v&&cn.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case cn.FLOAT:case cn.VOID:default:return e.context.FLOAT}switch(y){case cn.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case cn.FLOAT:case cn.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{const C=e.context.getExtension("OES_texture_half_float");if(C&&e.context.getExtension("OES_texture_half_float_linear"))return C.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(y){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||v)&&(e.openGLDataType=t.getDefaultDataType(y)),e.openGLDataType},t.getShiftAndScale=()=>{let y=0,v=1;switch(e.openGLDataType){case e.context.BYTE:v=127.5,y=v-128;break;case e.context.UNSIGNED_BYTE:v=255,y=0;break;case e.context.SHORT:v=32767.5,y=v-32768;break;case e.context.UNSIGNED_SHORT:v=65536,y=0;break;case e.context.INT:v=21474836475e-1,y=v-2147483648;break;case e.context.UNSIGNED_INT:v=4294967295,y=0;break;case e.context.FLOAT:}return{shift:y,scale:v}},t.getOpenGLFilterMode=y=>{switch(y){case li.NEAREST:return e.context.NEAREST;case li.LINEAR:return e.context.LINEAR;case li.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case li.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case li.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case li.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=y=>{switch(y){case bc.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case bc.REPEAT:return e.context.REPEAT;case bc.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}};function i(y){const[v,C,S,w,x,R]=y;return[C-v+1,w-S+1,R-x+1]}function a(y){const[v,C,S]=i(y);return v*C*S}function o(y,v,C,S,w){const[x,R,O,b,I,G]=C,[j,F]=v,$=j*F;let z=w;for(let oe=I;oe<=G;oe++){const Q=oe*$;for(let le=O;le<=b;le++){const X=Q+le*j;for(let ie=X+x,ye=X+R;ie<=ye;ie++,z++)S[z]=y[ie]}}}function s(y,v){const S=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:null)||y.constructor,w=v.reduce((b,I)=>b+a(I),0),x=new S(w),R=[e.width,e.height,e.depth];let O=0;return v.forEach(b=>{o(y,R,b,x,O),O+=a(b)}),x}t.updateArrayDataTypeForGL=function(y,v){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];const w=[];let x=e.width*e.height*e.components;C&&(x*=e.depth);const R=!!S.length;if(y!==cn.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let b=0;b<v.length;b++)if(v[b])if(R)w.push(s(v[b],S,Float32Array));else{const I=v[b].length>x?v[b].subarray(0,x):v[b];w.push(new Float32Array(I))}else w.push(null);if(y!==cn.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let b=0;b<v.length;b++)if(v[b])if(R)w.push(s(v[b],S,Uint8Array));else{const I=v[b].length>x?v[b].subarray(0,x):v[b];w.push(new Uint8Array(I))}else w.push(null);let O=!1;if(e._openGLRenderWindow.getWebgl2())O=e.openGLDataType===e.context.HALF_FLOAT;else{const b=e.context.getExtension("OES_texture_half_float");O=b&&e.openGLDataType===b.HALF_FLOAT_OES}if(O)for(let b=0;b<v.length;b++)if(v[b]){const I=R?s(v[b],S):v[b],G=new Uint16Array(R?I.length:x),j=G.length;for(let F=0;F<j;F++)G[F]=OB(I[F]);w.push(G)}else w.push(null);if(w.length===0)for(let b=0;b<v.length;b++)w.push(R&&v[b]?s(v[b],S):v[b]);return w};function c(y){if(e._openGLRenderWindow.getWebgl2())return y;const v=[],C=e.width,S=e.height,w=e.components;if(y&&(!Ng(C)||!Ng(S))){const x=e.context.getExtension("OES_texture_half_float"),R=b0(C),O=b0(S),b=R*O*e.components;for(let I=0;I<y.length;I++)if(y[I]!==null){let G=null;const j=S/O,F=C/R;let $=!1;e.openGLDataType===e.context.FLOAT?G=new Float32Array(b):x&&e.openGLDataType===x.HALF_FLOAT_OES?(G=new Uint16Array(b),$=!0):G=new Uint8Array(b);for(let z=0;z<O;z++){const oe=z*R*w,Q=z*j;let le=Math.floor(Q),X=Math.ceil(Q);X>=S&&(X=S-1);const ie=Q-le,ye=1-ie;le=le*C*w,X=X*C*w;for(let ge=0;ge<R;ge++){const W=ge*w,ae=ge*F;let fe=Math.floor(ae),ue=Math.ceil(ae);ue>=C&&(ue=C-1);const qe=ae-fe;fe*=w,ue*=w;for(let et=0;et<w;et++)$?G[oe+W+et]=ku.toHalf(ku.fromHalf(y[I][le+fe+et])*ye*(1-qe)+ku.fromHalf(y[I][le+ue+et])*ye*qe+ku.fromHalf(y[I][X+fe+et])*ie*(1-qe)+ku.fromHalf(y[I][X+ue+et])*ie*qe):G[oe+W+et]=y[I][le+fe+et]*ye*(1-qe)+y[I][le+ue+et]*ye*qe+y[I][X+fe+et]*ie*(1-qe)+y[I][X+ue+et]*ie*qe}}v.push(G),e.width=R,e.height=O}else v.push(null)}if(v.length===0)for(let x=0;x<y.length;x++)v.push(y[x]);return v}function u(y){return e._openGLRenderWindow?e.resizable||e.renderable?.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&r()&&(y===cn.UNSIGNED_SHORT||y===cn.SHORT)):!1:!1}t.create2DFromRaw=function(y,v,C,S,w){let x=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(t.getOpenGLDataType(S,!0),t.getInternalFormat(S,C),t.getFormat(S,C),!e.internalFormat||!e.format||!e.openGLDataType)return Ru("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=C,e.width=y,e.height=v,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const R=[w],O=t.updateArrayDataTypeForGL(S,R),b=c(O);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,x),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),u(S)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),b[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,b[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,b[0]),e.generateMipmap&&e.context.generateMipmap(e.target),x&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*C*e._openGLRenderWindow.getDefaultTextureByteSize(S,r(),t.useHalfFloat()),t.deactivate(),!0},t.createCubeFromRaw=(y,v,C,S,w)=>{if(t.getOpenGLDataType(S),t.getInternalFormat(S,C),t.getFormat(S,C),!e.internalFormat||!e.format||!e.openGLDataType)return Ru("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=C,e.width=y,e.height=v,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=w.length/6-1,t.createTexture(),t.bind();const x=t.updateArrayDataTypeForGL(S,w),R=c(x),O=[];let b=e.width,I=e.height;for(let G=0;G<R.length;G++){G%6===0&&G!==0&&(b/=2,I/=2),O[G]=yf(S,I*b*e.components);for(let j=0;j<I;++j){const F=j*b*e.components,$=(I-j-1)*b*e.components;O[G].set(R[G].slice($,$+b*e.components),F)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),u(S)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let G=0;G<6;G++){let j=0,F=e.width,$=e.height;for(;F>=1&&$>=1;){let z=null;j<=e.maxLevel&&(z=O[6*j+G]),u(S)?z!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+G,j,0,0,F,$,e.format,e.openGLDataType,z):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+G,j,e.internalFormat,F,$,0,e.format,e.openGLDataType,z),j++,F/=2,$/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*C*e._openGLRenderWindow.getDefaultTextureByteSize(S,r(),t.useHalfFloat()),t.deactivate(),!0},t.createDepthFromRaw=(y,v,C,S)=>(t.getOpenGLDataType(C),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?C===cn.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(Ru("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=y,e.height=v,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),u(C)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),S!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,S)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,S),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(C,r(),t.useHalfFloat()),t.deactivate(),!0)),t.create2DFromImage=y=>{if(t.getOpenGLDataType(cn.UNSIGNED_CHAR),t.getInternalFormat(cn.UNSIGNED_CHAR,4),t.getFormat(cn.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return Ru("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1);const v=!e._openGLRenderWindow.getWebgl2()&&(!Ng(y.width)||!Ng(y.height)),C=document.createElement("canvas");C.width=v?b0(y.width):y.width,C.height=v?b0(y.height):y.height,e.width=C.width,e.height=C.height;const S=C.getContext("2d");S.translate(0,C.height),S.scale(1,-1),S.drawImage(y,0,0,y.width,y.height,0,0,C.width,C.height);const w=C;return u(cn.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),w!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,w)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,w),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(cn.UNSIGNED_CHAR,r(),t.useHalfFloat()),t.deactivate(),!0};function d(y,v,C){const S=new Array(C),w=new Array(C);for(let x=0;x<C;++x)S[x]=y[x],w[x]=v[x]-y[x]||1;return{scale:w,offset:S}}function g(y,v){for(let C=0;C<y.length;C++){const S=y[C],w=v[C]+S;if(S<-2048||S>2048||w<-2048||w>2048)return!1}return!0}function h(y,v,C,S){t.getOpenGLDataType(y);const w=g(v,C)||S;let x=!1;if(e._openGLRenderWindow.getWebgl2())x=e.openGLDataType===e.context.FLOAT&&e.context.getExtension("OES_texture_float_linear")===null&&w||e.openGLDataType===e.context.HALF_FLOAT;else{const R=e.context.getExtension("OES_texture_half_float");x=R&&e.openGLDataType===R.HALF_FLOAT_OES}e.canUseHalfFloat=x&&w}function m(y,v){const C=y.getNumberOfComponents(),S=y.getDataType(),w=y.getData(),x=new Array(C),R=new Array(C);for(let b=0;b<C;++b){const[I,G]=y.getRange(b);x[b]=I,R[b]=G}const O=d(x,R,C);return h(S,O.offset,O.scale,v),t.useHalfFloat()||t.getOpenGLDataType(S,!0),{numComps:C,dataType:S,data:w,scaleOffsets:O}}t.create2DFilterableFromRaw=function(y,v,C,S,w){let x=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,R=arguments.length>6&&arguments[6]!==void 0?arguments[6]:void 0;return t.create2DFilterableFromDataArray(y,v,Pt.newInstance({numberOfComponents:C,dataType:S,values:w,ranges:R}),x)},t.create2DFilterableFromDataArray=function(y,v,C){let S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const{numComps:w,dataType:x,data:R}=m(C,S);t.create2DFromRaw(y,v,w,x,R)},t.updateVolumeInfoForGL=(y,v)=>{let C=!1;const S=t.useHalfFloat();(!e.volumeInfo?.scale||!e.volumeInfo?.offset)&&(e.volumeInfo={scale:new Array(v),offset:new Array(v)});for(let w=0;w<v;++w)e.volumeInfo.scale[w]=1,e.volumeInfo.offset[w]=0;if(r()&&!S&&y===cn.SHORT){for(let w=0;w<v;++w)e.volumeInfo.scale[w]=32767;C=!0}if(r()&&!S&&y===cn.UNSIGNED_SHORT){for(let w=0;w<v;++w)e.volumeInfo.scale[w]=65535;C=!0}if(y===cn.UNSIGNED_CHAR){for(let w=0;w<v;++w)e.volumeInfo.scale[w]=255;C=!0}return(y===cn.FLOAT||S&&(y===cn.SHORT||y===cn.UNSIGNED_SHORT))&&(C=!0),C},t.create3DFromRaw=function(y,v,C,S,w,x){let R=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[],O=w,b=x;if(!t.updateVolumeInfoForGL(O,S)&&b){const oe=y*v*C,Q=structuredClone(e.volumeInfo),le=new Float32Array(oe*S);e.volumeInfo.offset=Q.offset,e.volumeInfo.scale=Q.scale;let X=0;const ie=Q.scale.map(ye=>1/ye);for(let ye=0;ye<oe;ye++)for(let ge=0;ge<S;ge++)le[X]=(b[X]-Q.offset[ge])*ie[ge],X++;O=cn.FLOAT,b=le}if(t.getOpenGLDataType(O),t.getInternalFormat(O,S),t.getFormat(O,S),!e.internalFormat||!e.format||!e.openGLDataType)return Ru("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=S,e.width=y,e.height=v,e.depth=C,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const I=R.length>0,G=!I||!xv(e._prevTexParams,n()),j=[b],$=t.updateArrayDataTypeForGL(O,j,!0,G?[]:R),z=c($);if(e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),G)u(O)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),z[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,z[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,z[0]),e._prevTexParams=n();else if(I){const oe=z[0];let Q=0;for(let le=0;le<R.length;le++){const X=R[le],ie=i(X),ye=a(X),ge=new oe.constructor(oe.buffer,Q,ye);Q+=ge.byteLength,e.context.texSubImage3D(e.target,0,X[0],X[2],X[4],ie[0],ie[1],ie[2],e.format,e.openGLDataType,ge)}}return e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(O,r(),t.useHalfFloat()),t.deactivate(),!0},t.create3DFilterableFromRaw=function(y,v,C,S,w,x){let R=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1,O=arguments.length>7&&arguments[7]!==void 0?arguments[7]:void 0,b=arguments.length>8&&arguments[8]!==void 0?arguments[8]:[];return t.create3DFilterableFromDataArray(y,v,C,Pt.newInstance({numberOfComponents:S,dataType:w,values:x,ranges:O}),R,b)},t.create3DFilterableFromDataArray=function(y,v,C,S){let w=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,x=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];const{numComps:R,dataType:O,data:b,scaleOffsets:I}=m(S,w),G=[],j=[];for(let Ze=0;Ze<R;++Ze)G[Ze]=0,j[Ze]=1;if(e.volumeInfo={scale:j,offset:G,dataComputedScale:I.scale,dataComputedOffset:I.offset,width:y,height:v,depth:C},e._openGLRenderWindow.getWebgl2())return t.create3DFromRaw(y,v,C,R,O,b,x);const F=y*v*C,$=structuredClone(I);let z=(Ze,yt,tt,st,Bt)=>{Ze[yt]=tt},oe=cn.UNSIGNED_CHAR;if(O===cn.UNSIGNED_CHAR)for(let Ze=0;Ze<R;++Ze)$.offset[Ze]=0,$.scale[Ze]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(oe=cn.FLOAT,z=(Ze,yt,tt,st,Bt)=>{Ze[yt]=(tt-st)/Bt}):(oe=cn.UNSIGNED_CHAR,z=(Ze,yt,tt,st,Bt)=>{Ze[yt]=255*(tt-st)/Bt});if(t.getOpenGLDataType(oe),t.getInternalFormat(oe,R),t.getFormat(oe,R),!e.internalFormat||!e.format||!e.openGLDataType)return Ru("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=R,e.depth=1,e.numberOfDimensions=2;let Q=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);Q>4096&&(oe===cn.FLOAT||R>=3)&&(Q=4096);let le=1,X=1;F>Q*Q&&(le=Math.ceil(Math.sqrt(F/(Q*Q))),X=le);let ie=Math.sqrt(F)/le;ie=b0(ie);const ye=Math.floor(ie*le/y),ge=Math.ceil(C/ye),W=b0(v*ge/X);e.width=ie,e.height=W,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=ye,e.volumeInfo.yreps=ge,e.volumeInfo.xstride=le,e.volumeInfo.ystride=X,e.volumeInfo.offset=$.offset,e.volumeInfo.scale=$.scale;let ae;const fe=ie*W*R;oe===cn.FLOAT?ae=new Float32Array(fe):ae=new Uint8Array(fe);let ue=0;const qe=Math.floor(y/le),et=Math.floor(v/X);for(let Ze=0;Ze<ge;Ze++){const yt=Math.min(ye,C-Ze*ye),tt=R*(e.width-yt*Math.floor(y/le));for(let st=0;st<et;st++){for(let Bt=0;Bt<yt;Bt++){const pr=R*((Ze*ye+Bt)*y*v+X*st*y);for(let Lr=0;Lr<qe;Lr++)for(let bn=0;bn<R;bn++)z(ae,ue,b[pr+le*Lr*R+bn],$.offset[bn],$.scale[bn]),ue++}ue+=tt}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),u(oe)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),ae!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,ae)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,ae),t.deactivate(),!0},t.setOpenGLRenderWindow=y=>{e._openGLRenderWindow!==y&&(t.releaseGraphicsResources(),e._openGLRenderWindow=y,e.context=null,y&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=y=>y&&y.isCurrent()?y.getIntegerv(y.MAX_TEXTURE_SIZE):-1,t.enableUseHalfFloat=y=>{e.enableUseHalfFloat=y}}const _B={_openGLRenderWindow:null,_forceInternalFormat:!1,_prevTexParams:null,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:bc.CLAMP_TO_EDGE,wrapT:bc.CLAMP_TO_EDGE,wrapR:bc.CLAMP_TO_EDGE,minificationFilter:li.NEAREST,magnificationFilter:li.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0,enableUseHalfFloat:!0,canUseHalfFloat:!1};function QR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_B,n),$r.extend(t,e,n),e.sendParametersTime={},Yn(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},Yn(e.textureBuildTime,{mtime:0}),V1(t,e,["format","openGLDataType"]),ri(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),ha(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),I1(t,e,["openGLRenderWindow"]),DB(t,e)}const JR=An(QR,"vtkOpenGLTexture");var qn={newInstance:JR,extend:QR,...XR};xi("vtkTexture",JR);function bB(t,e){t.replaceShaderCoincidentOffset=(n,r,i)=>{const a=t.getCoincidentParameters(r,i);if(a&&(a.factor!==0||a.offset!==0)){let o=n.Fragment;o=Te.substitute(o,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(a.factor!==0?(o=Te.substitute(o,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,o=Te.substitute(o,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):o=Te.substitute(o,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(a.factor!==0?(o=Te.substitute(o,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,o=Te.substitute(o,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):o=Te.substitute(o,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),n.Fragment=o}}}function MB(t,e){t.applyShaderReplacements=(n,r,i)=>{let a=null;if(r&&(a=r.ShaderReplacements),a)for(let o=0;o<a.length;o++){const s=a[o];if(i&&s.replaceFirst||!i&&!s.replaceFirst){const c=s.shaderType,u=n[c],d=Te.substitute(u,s.originalValue,s.replacementValue,s.replaceAll);n[c]=d.result}}},t.buildShaders=(n,r,i)=>{t.getReplacedShaderTemplate(n,r,i),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(n);const a=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(n,a,!0),t.replaceShaderValues(n,r,i),t.applyShaderReplacements(n,a)},t.getReplacedShaderTemplate=(n,r,i)=>{const a=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(n,r,i);let o=n.Vertex;if(a){const u=a.VertexShaderCode;u!==void 0&&u!==""&&(o=u)}n.Vertex=o;let s=n.Fragment;if(a){const u=a.FragmentShaderCode;u!==void 0&&u!==""&&(s=u)}n.Fragment=s;let c=n.Geometry;if(a){const u=a.GeometryShaderCode;u!==void 0&&(c=u)}n.Geometry=c}}var H0={implementReplaceShaderCoincidentOffset:bB,implementBuildShadersWithReplacements:MB};let v8;function LB(t,e){e.classHierarchy.push("vtkAbstractTransform","vtkHomogeneousTransform","vtkTransform"),t.transformPoint=(n,r)=>(an(r,n,e.matrix),r),t.transformPoints=(n,r)=>{const i=new Float64Array(3),a=new Float64Array(3);for(let o=0;o<n.length;o+=3)i[0]=n[o],i[1]=n[o+1],i[2]=n[o+2],an(a,i,e.matrix),r[o]=a[0],r[o+1]=a[1],r[o+2]=a[2];return r},t.preMultiply=()=>{t.setPreMultiplyFlag(!0)},t.postMultiply=()=>{t.setPreMultiplyFlag(!1)},t.transformMatrix=(n,r)=>(e.preMultiplyFlag?zt(r,e.matrix,n):zt(r,n,e.matrix),r),t.transformMatrices=(n,r)=>{const i=new Float64Array(16),a=new Float64Array(16),o=e.preMultiplyFlag?()=>zt(a,e.matrix,i):()=>zt(a,i,e.matrix);for(let s=0;s<n.length;s+=16){for(let c=0;c<16;++c)i[c]=n[s+c];o();for(let c=0;c<16;++c)r[s+c]=a[c]}return r},t.getInverse=()=>v8({matrix:_o.invertMatrix(Array.from(e.matrix),[],4),preMultiplyFlag:e.preMultiplyFlag})}const VB={preMultiplyFlag:!1,matrix:[...Lv]};function eO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VB,n),H.obj(t,e),H.setGet(t,e,["preMultiplyFlag"]),H.setGetArray(t,e,["matrix"],16),LB(t,e)}v8=H.newInstance(eO,"vtkTransform");var IB={newInstance:v8,extend:eO};function Fs(t,e,n){return t?`${t.getMTime()}-${e}-${n}`:"0"}function y8(t,e){return`${t.getMTime()}A${e.getMTime()}`}var AB=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model coordinates
// WC - World coordinates
// VC - View coordinates
// DC - Display coordinates
// TC - Texture coordinates

// frag position in VC
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// camera and actor matrix values
//VTK::Camera::Dec

void main()
{
  //VTK::PositionVC::Impl

  //VTK::TCoord::Impl

  //VTK::Picking::Impl
}
`,NB=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the gpu image mapper fragment shader

// VC position of this fragment
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

// the output of this shader
//VTK::Output::Dec

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  //VTK::TCoord::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;const Il={NEAREST:0,LINEAR:1};var PB={InterpolationType:Il};const is={Off:0,PolygonOffset:1};let k4=is.PolygonOffset,$2=is.Off;const UB=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function FB(){return k4}function kB(t){const e=k4===t;return k4=t,e}function GB(){return $2}function wp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const e=$2===t;return $2=t,e}function BB(){return wp(is.Off)}function $B(){return wp(is.Off)}function WB(){return wp(is.PolygonOffset)}function zB(){return UB[$2]}var G4={Resolve:is,getResolveCoincidentTopologyAsString:zB,getResolveCoincidentTopologyPolygonOffsetFaces:FB,getResolveCoincidentTopology:GB,setResolveCoincidentTopology:wp,setResolveCoincidentTopologyPolygonOffsetFaces:kB,setResolveCoincidentTopologyToDefault:BB,setResolveCoincidentTopologyToOff:$B,setResolveCoincidentTopologyToPolygonOffset:WB};function tO(t,e,n){n.forEach(r=>{t[`get${r.method}`]=()=>e[r.key],t[`set${r.method}`]=H.objectSetterMap.object(t,e,{name:r.key,params:["factor","offset"]})})}const T8=["Polygon","Line","Point"],HB={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},jB=()=>{},Ol={modified:jB};tO(Ol,HB,T8.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function qB(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),H.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(G4).forEach(n=>{t[n]=G4[n]}),Object.keys(Ol).filter(n=>n!=="modified").forEach(n=>{t[n]=Ol[n]}),tO(t,e.topologyOffset,T8.map(n=>({key:n,method:`RelativeCoincidentTopology${n}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{const n=Ol.getResolveCoincidentTopologyPolygonOffsetParameters(),r=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{const n=Ol.getResolveCoincidentTopologyLineOffsetParameters(),r=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{const n=Ol.getResolveCoincidentTopologyPointOffsetParameters(),r=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}}}var xp={implementCoincidentTopologyMethods:qB,staticOffsetAPI:Ol,otherStaticMethods:G4,CATEGORIES:T8,Resolve:is};const{vtkErrorMacro:ul}=Zi;function KT(t,e,n){return e.identity(n),t.reduce((r,i,a)=>a===0?i?e.copy(r,i):e.identity(r):i?e.multiply(r,r,i):r,n)}function KB(t,e){e.classHierarchy.push("vtkOpenGLImageResliceMapper");function n(i){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(a=>i.unregisterGraphicsResourceUser(a,t))}t.buildPass=i=>{if(i){e.currentRenderPass=null,e._openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const a=e._openGLRenderer.getRenderable();e._openGLCamera=e._openGLRenderer.getViewNodeFor(a.getActiveCamera());const o=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),o&&!o.isDeleted()&&o!==e._openGLRenderWindow&&n(o),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.translucentPass=(i,a)=>{i&&(e.currentRenderPass=a,t.render())},t.zBufferPass=i=>{i&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=i=>t.zBufferPass(i),t.opaquePass=i=>{i&&t.render()},t.getCoincidentParameters=(i,a)=>e.renderable.getResolveCoincidentTopology()==is.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const i=e._openGLImageSlice.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,i)},t.renderPiece=(i,a)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),!e.currentInput){ul("No input!");return}t.updateResliceGeometry(),t.renderPieceStart(i,a),t.renderPieceDraw(i,a),t.renderPieceFinish(i,a),t.invokeEvent({type:"EndEvent"})},t.renderPieceStart=(i,a)=>{t.updateBufferObjects(i,a),a.getProperty().getInterpolationType()===Il.NEAREST?(e.openGLTexture.setMinificationFilter(pt.NEAREST),e.openGLTexture.setMagnificationFilter(pt.NEAREST),e.colorTexture.setMinificationFilter(pt.NEAREST),e.colorTexture.setMagnificationFilter(pt.NEAREST),e.pwfTexture.setMinificationFilter(pt.NEAREST),e.pwfTexture.setMagnificationFilter(pt.NEAREST)):(e.openGLTexture.setMinificationFilter(pt.LINEAR),e.openGLTexture.setMagnificationFilter(pt.LINEAR),e.colorTexture.setMinificationFilter(pt.LINEAR),e.colorTexture.setMagnificationFilter(pt.LINEAR),e.pwfTexture.setMinificationFilter(pt.LINEAR),e.pwfTexture.setMagnificationFilter(pt.LINEAR)),e.lastBoundBO=null},t.renderPieceDraw=(i,a)=>{const o=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),t.updateShaders(e.tris,i,a),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(i,a)=>{},t.updateBufferObjects=(i,a)=>{t.getNeedToRebuildBufferObjects(i,a)&&t.buildBufferObjects(i,a)},t.getNeedToRebuildBufferObjects=(i,a)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<a.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<a.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||e.VBOBuildTime.getMTime()<e.resliceGeom.getMTime()||!e.openGLTexture?.getHandle()||!e.colorTexture?.getHandle()||!e.pwfTexture?.getHandle(),t.buildBufferObjects=(i,a)=>{const o=e.currentInput;if(!o)return;const s=o.getPointData()?.getScalars();if(!s)return;const c=s.getNumberOfComponents();let u=y8(o,s);const d=e._openGLRenderWindow.getGraphicsResourceForObject(s),g=!d?.oglObject?.getHandle()||d?.hash!==u,h=e.renderable.getUpdatedExtents(),m=!!h.length;if(g&&!m){e.openGLTexture=qn.newInstance(),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.openGLTexture.resetFormatAndType();const j=o.getDimensions();e.openGLTexture.create3DFilterableFromDataArray(j[0],j[1],j[2],s,!1,h),e._openGLRenderWindow.setGraphicsResourceForObject(s,e.openGLTexture,u),s!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(s,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=s}else e.openGLTexture=d.oglObject;if(m){e.renderable.setUpdatedExtents([]);const j=o.getDimensions();e.openGLTexture.create3DFilterableFromDataArray(j[0],j[1],j[2],s,!1,h)}const y=a.getProperty(),v=y.getIndependentComponents(),C=v?c:1,S=v?2*C:1,w=y.getRGBTransferFunction();u=Fs(w,v,C);const x=e._openGLRenderWindow.getGraphicsResourceForObject(w);if(!x?.oglObject?.getHandle()||x?.hash!==u){const F=1024*S*3,$=new Uint8ClampedArray(F);if(e.colorTexture=qn.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),w){const z=new Float32Array(3072);for(let oe=0;oe<C;oe++){const Q=y.getRGBTransferFunction(oe),le=Q.getRange();if(Q.getTable(le[0],le[1],1024,z,1),v)for(let X=0;X<1024*3;X++)$[oe*1024*6+X]=255*z[X],$[oe*1024*6+X+1024*3]=255*z[X];else for(let X=0;X<1024*3;X++)$[oe*1024*6+X]=255*z[X]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,S,3,kt.UNSIGNED_CHAR,$)}else{for(let z=0;z<1024*3;++z)$[z]=255*z/(1023*3),$[z+1]=255*z/(1023*3),$[z+2]=255*z/(1023*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,1,3,kt.UNSIGNED_CHAR,$)}w&&(e._openGLRenderWindow.setGraphicsResourceForObject(w,e.colorTexture,u),w!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(w,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=w)}else e.colorTexture=x.oglObject;const O=y.getPiecewiseFunction();u=Fs(O,v,C);const b=e._openGLRenderWindow.getGraphicsResourceForObject(O);if(!b?.oglObject?.getHandle()||b?.hash!==u){const F=1024*S,$=new Uint8ClampedArray(F);if(e.pwfTexture=qn.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),O){const z=new Float32Array(F),oe=new Float32Array(1024);for(let Q=0;Q<C;++Q){const le=y.getPiecewiseFunction(Q);if(le===null)z.fill(1);else{const X=le.getRange();if(le.getTable(X[0],X[1],1024,oe,1),v)for(let ie=0;ie<1024;ie++)z[Q*1024*2+ie]=oe[ie],z[Q*1024*2+ie+1024]=oe[ie];else for(let ie=0;ie<1024;ie++)z[Q*1024*2+ie]=oe[ie]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,S,1,kt.FLOAT,z)}else $.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,1,1,kt.UNSIGNED_CHAR,$);O&&(e._openGLRenderWindow.setGraphicsResourceForObject(O,e.pwfTexture,u),O!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(O,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=O)}else e.pwfTexture=b.oglObject;const G=`${e.resliceGeom.getMTime()}A${e.renderable.getSlabThickness()}`;if(!e.tris.getCABO().getElementCount()||e.VBOBuildString!==G){const j=Pt.newInstance({numberOfComponents:3,values:e.resliceGeom.getPoints().getData()});j.setName("points");const F=Pt.newInstance({numberOfComponents:1,values:e.resliceGeom.getPolys().getData()}),$={points:j,cellOffset:0};if(e.renderable.getSlabThickness()>0){const z=e.resliceGeom.getPointData().getNormals();z?$.normals=z:ul("Slab mode requested without normals")}e.tris.getCABO().createVBO(F,"polys",bo.SURFACE,$)}e.VBOBuildString=G,e.VBOBuildTime.modified()},t.updateShaders=(i,a,o)=>{if(e.lastBoundBO=i,t.getNeedToRebuildShaders(i,a,o)){const s={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(s,a,o);const c=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);c!==i.getProgram()&&(i.setProgram(c),i.getVAO().releaseGraphicsResources()),i.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(i.getProgram());i.getVAO().bind(),t.setMapperShaderParameters(i,a,o),t.setCameraShaderParameters(i,a,o),t.setPropertyShaderParameters(i,a,o)},t.setMapperShaderParameters=(i,a,o)=>{const s=i.getProgram();if(i.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>i.getAttributeUpdateTime().getMTime()||i.getShaderSourceTime().getMTime()>i.getAttributeUpdateTime().getMTime())){s.isUniformUsed("texture1")&&s.setUniformi("texture1",e.openGLTexture.getTextureUnit()),s.isAttributeUsed("vertexWC")&&(i.getVAO().addAttributeArray(s,i.getCABO(),"vertexWC",i.getCABO().getVertexOffset(),i.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||ul("Error setting vertexWC in shader VAO.")),s.isAttributeUsed("normalWC")&&(i.getVAO().addAttributeArray(s,i.getCABO(),"normalWC",i.getCABO().getNormalOffset(),i.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||ul("Error setting normalWC in shader VAO.")),s.isUniformUsed("slabThickness")&&s.setUniformf("slabThickness",e.renderable.getSlabThickness()),s.isUniformUsed("spacing")&&s.setUniform3fv("spacing",e.currentInput.getSpacing()),s.isUniformUsed("slabType")&&s.setUniformi("slabType",e.renderable.getSlabType()),s.isUniformUsed("slabType")&&s.setUniformi("slabType",e.renderable.getSlabType()),s.isUniformUsed("slabTrapezoid")&&s.setUniformi("slabTrapezoid",e.renderable.getSlabTrapezoidIntegration());const u=i.getCABO().getCoordShiftAndScaleEnabled()?i.getCABO().getInverseShiftAndScaleMatrix():null;if(s.isUniformUsed("WCTCMatrix")){const d=e.currentInput,g=d.getDimensions();_r(e.tmpMat4,d.getIndexToWorld()),Gr(e.tmpMat4,e.tmpMat4,[-.5,-.5,-.5]),Us(e.tmpMat4,e.tmpMat4,g),Br(e.tmpMat4,e.tmpMat4),u&&zt(e.tmpMat4,e.tmpMat4,u),s.setUniformMatrix("WCTCMatrix",e.tmpMat4)}s.isUniformUsed("vboScaling")&&s.setUniform3fv("vboScaling",i.getCABO().getCoordScale()??[1,1,1]),i.getAttributeUpdateTime().modified()}if(e.haveSeenDepthRequest&&i.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),i.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(a,o);i.getProgram().setUniformf("coffset",c.offset),i.getProgram().isUniformUsed("cfactor")&&i.getProgram().setUniformf("cfactor",c.factor)}},t.setCameraShaderParameters=(i,a,o)=>{const s=e._openGLCamera.getKeyMatrices(a),c=e._openGLImageSlice.getKeyMatrices(),d=i.getCABO().getCoordShiftAndScaleEnabled()?i.getCABO().getInverseShiftAndScaleMatrix():null,g=i.getProgram();g.isUniformUsed("MCPCMatrix")&&(wt(e.tmpMat4),g.setUniformMatrix("MCPCMatrix",KT([s.wcpc,c.mcwc,d],I2,e.tmpMat4))),g.isUniformUsed("MCVCMatrix")&&(wt(e.tmpMat4),g.setUniformMatrix("MCVCMatrix",KT([s.wcvc,c.mcwc,d],I2,e.tmpMat4)))},t.setPropertyShaderParameters=(i,a,o)=>{const s=i.getProgram(),c=o.getProperty(),u=c.getOpacity();s.setUniformf("opacity",u);const d=e.openGLTexture.getComponents(),g=c.getIndependentComponents();if(g)for(let v=0;v<d;++v)s.setUniformf(`mix${v}`,c.getComponentWeight(v));const h=e.openGLTexture.getVolumeInfo();for(let v=0;v<d;v++){let C=c.getColorWindow(),S=c.getColorLevel();const w=g?v:0,x=c.getRGBTransferFunction(w);if(x&&c.getUseLookupTableScalarRange()){const b=x.getRange();C=b[1]-b[0],S=.5*(b[1]+b[0])}const R=h.scale[v]/C,O=(h.offset[v]-S)/C+.5;s.setUniformf(`cshift${v}`,O),s.setUniformf(`cscale${v}`,R)}const m=e.colorTexture.getTextureUnit();s.setUniformi("colorTexture1",m);for(let v=0;v<d;v++){let C=1,S=0;const w=g?v:0,x=c.getPiecewiseFunction(w);if(x){const R=x.getRange(),O=R[1]-R[0],b=.5*(R[0]+R[1]);C=h.scale[v]/O,S=(h.offset[v]-b)/O+.5}s.setUniformf(`pwfshift${v}`,S),s.setUniformf(`pwfscale${v}`,C)}const y=e.pwfTexture.getTextureUnit();s.setUniformi("pwfTexture1",y),s.setUniform4fv("backgroundColor",e.renderable.getBackgroundColor())},t.getNeedToRebuildShaders=(i,a,o)=>{const s=e.openGLTexture.getComponents(),c=o.getProperty().getIndependentComponents(),u=e.renderable.getSlabThickness(),d=e.renderable.getSlabType(),g=e.renderable.getSlabTrapezoidIntegration();let h=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(h=!0),h||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||i.getProgram()?.getHandle()===0||e.lastTextureComponents!==s||e.lastIndependentComponents!==c||e.lastSlabThickness!==u||e.lastSlabType!==d||e.lastSlabTrapezoidIntegration!==g?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=s,e.lastIndependentComponents=c,e.lastSlabThickness=u,e.lastSlabType=d,e.lastSlabTrapezoidIntegration=g,!0):!1},t.getShaderTemplate=(i,a,o)=>{i.Vertex=AB,i.Fragment=NB,i.Geometry=""},t.replaceShaderValues=(i,a,o)=>{if(t.replaceShaderTCoord(i,a,o),t.replaceShaderPositionVC(i,a,o),e.haveSeenDepthRequest){let s=i.Fragment;s=Te.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=Te.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,i.Fragment=s}t.replaceShaderCoincidentOffset(i,a,o)},t.replaceShaderTCoord=(i,a,o)=>{let s=i.Vertex;const c=i.Geometry;let u=i.Fragment;const d=["uniform mat4 WCTCMatrix;","out vec3 fragTexCoord;"],g=e.renderable.getSlabThickness();s=Te.substitute(s,"//VTK::TCoord::Dec",d).result;const h=["fragTexCoord = (WCTCMatrix * vertexWC).xyz;"];s=Te.substitute(s,"//VTK::TCoord::Impl",h).result;const m=e.openGLTexture.getComponents(),y=o.getProperty().getIndependentComponents();let v=["in vec3 fragTexCoord;","uniform highp sampler3D texture1;","uniform mat4 WCTCMatrix;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;"];if(y){for(let S=1;S<m;S++)v=v.concat([`uniform float cshift${S};`,`uniform float cscale${S};`,`uniform float pwfshift${S};`,`uniform float pwfscale${S};`]);switch(m){case 1:v=v.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:v=v.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:v=v.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:v=v.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:ul("Unsupported number of independent coordinates.")}}g>0&&(v=v.concat(["uniform vec3 spacing;","uniform float slabThickness;","uniform int slabType;","uniform int slabTrapezoid;","uniform vec3 vboScaling;"]),v=v.concat(["vec4 compositeValue(vec4 currVal, vec4 valToComp, int trapezoid)","{","  vec4 retVal = vec4(1.0);","  if (slabType == 0) // min","  {","    retVal = min(currVal, valToComp);","  }","  else if (slabType == 1) // max","  {","    retVal = max(currVal, valToComp);","  }","  else if (slabType == 3) // sum","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  else // mean","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  return retVal;","}"])),u=Te.substitute(u,"//VTK::TCoord::Dec",v).result;let C=["if (any(greaterThan(fragTexCoord, vec3(1.0))) || any(lessThan(fragTexCoord, vec3(0.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}","vec4 tvalue = texture(texture1, fragTexCoord);"];if(g>0&&(C=C.concat(["// Get the first and last samples","int numSlices = 1;","float scaling = min(min(spacing.x, spacing.y), spacing.z) * 0.5;","vec3 normalxspacing = scaling * normalWCVSOutput;","float distTraveled = length(normalxspacing);","int trapezoid = 0;","while (distTraveled < slabThickness * 0.5)","{","  distTraveled += length(normalxspacing);","  float fnumSlices = float(numSlices);","  if (distTraveled > slabThickness * 0.5)","  {","    // Before stepping outside the slab, sample at the boundaries","    normalxspacing = normalWCVSOutput * slabThickness * 0.5 / fnumSlices;","    trapezoid = slabTrapezoid;","  }","  vec3 fragTCoordNeg = (WCTCMatrix * vec4(vertexWCVSOutput.xyz - fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordNeg);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","  vec3 fragTCoordPos = (WCTCMatrix * vec4(vertexWCVSOutput.xyz + fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordPos);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","}","// Finally, if slab type is *mean*, divide the sum by the numSlices","if (slabType == 2)","{","  tvalue = tvalue / float(numSlices);","}"])),y){const S=["r","g","b","a"];for(let w=0;w<m;++w)C=C.concat([`vec3 tcolor${w} = mix${w} * texture2D(colorTexture1, vec2(tvalue.${S[w]} * cscale${w} + cshift${w}, height${w})).rgb;`,`float compWeight${w} = mix${w} * texture2D(pwfTexture1, vec2(tvalue.${S[w]} * pwfscale${w} + pwfshift${w}, height${w})).r;`]);switch(m){case 1:C=C.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:C=C.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:C=C.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:C=C.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:ul("Unsupported number of independent coordinates.")}}else switch(m){case 1:C=C.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:C=C.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:C=C.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:C=C.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}u=Te.substitute(u,"//VTK::TCoord::Impl",C).result,i.Vertex=s,i.Fragment=u,i.Geometry=c},t.replaceShaderPositionVC=(i,a,o)=>{let s=i.Vertex;const c=i.Geometry;let u=i.Fragment;const d=e.renderable.getSlabThickness();let g=["attribute vec4 vertexWC;"];g=g.concat([`//${t.getMTime()}${e.resliceGeomUpdateString}`]),d>0&&(g=g.concat(["attribute vec3 normalWC;","varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),s=Te.substitute(s,"//VTK::PositionVC::Dec",g).result;let h=["gl_Position = MCPCMatrix * vertexWC;"];d>0&&(h=h.concat(["normalWCVSOutput = normalWC;","vertexWCVSOutput = vertexWC;"])),s=Te.substitute(s,"//VTK::PositionVC::Impl",h).result,s=Te.substitute(s,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result;let m=[];d>0&&(m=m.concat(["varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),u=Te.substitute(u,"//VTK::PositionVC::Dec",m).result,i.Vertex=s,i.Geometry=c,i.Fragment=u};function r(i){_o.normalize(i);const a=[0,0,0];for(let o=0;o<3;++o){QU(a),a[o]=1;const s=_o.dot(i,a);if(s<-.999999||s>.999999)return[!0,o]}return[!1,2]}t.updateResliceGeometry=()=>{let i="";const a=e.currentInput,o=a?.getBounds();let s=!0,c=2;const u=e.renderable.getSlicePolyData(),d=e.renderable.getSlicePlane();if(u)i=i.concat(`PolyData${u.getMTime()}`);else if(d){i=i.concat(`Plane${d.getMTime()}`);const g=$v();a&&(i=i.concat(`Image${a.getMTime()}`),uE(g,...a.getDirection()),F1(g,g));const h=[...d.getNormal()];Kh(h,h,g),[s,c]=r(h)}else{const g=Ki.newInstance();g.setNormal(0,0,1);let h=[0,1,0,1,0,1];a&&(h=o),g.setOrigin(h[0],h[2],.5*(h[5]+h[4])),e.renderable.setSlicePlane(g),i=i.concat(`Plane${d?.getMTime()}`),a&&(i=i.concat(`Image${a.getMTime()}`))}if(!e.resliceGeom||e.resliceGeomUpdateString!==i){if(u)e.resliceGeom||(e.resliceGeom=$c.newInstance()),e.resliceGeom.getPoints().setData(u.getPoints().getData(),3),e.resliceGeom.getPolys().setData(u.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(u.getPointData().getNormals());else if(d)if(s){const g=new Float32Array(12),h=a.worldToIndex(d.getOrigin(),[0,0,0]),m=[(c+1)%3,(c+2)%3].sort(),y=a.getSpatialExtent();let v=0;for(let R=0;R<2;++R)for(let O=0;O<2;++O)g[v+c]=h[c],g[v+m[0]]=y[2*m[0]+O],g[v+m[1]]=y[2*m[1]+R],v+=3;e.transform.setMatrix(a.getIndexToWorld()),e.transform.transformPoints(g,g);const C=new Uint16Array(8);C[0]=3,C[1]=0,C[2]=1,C[3]=3,C[4]=3,C[5]=0,C[6]=3,C[7]=2;const S=d.getNormal();_o.normalize(S);const w=new Float32Array(12);for(let R=0;R<4;++R)w[3*R]=S[0],w[3*R+1]=S[1],w[3*R+2]=S[2];e.resliceGeom||(e.resliceGeom=$c.newInstance()),e.resliceGeom.getPoints().setData(g,3),e.resliceGeom.getPolys().setData(C,1);const x=Pt.newInstance({numberOfComponents:3,values:w,name:"Normals"});e.resliceGeom.getPointData().setNormals(x)}else{e.outlineFilter.setInputData(a),e.cutter.setInputConnection(e.outlineFilter.getOutputPort()),e.cutter.setCutFunction(d),e.lineToSurfaceFilter.setInputConnection(e.cutter.getOutputPort()),e.lineToSurfaceFilter.update(),e.resliceGeom||(e.resliceGeom=$c.newInstance());const g=e.lineToSurfaceFilter.getOutputData();e.resliceGeom.getPoints().setData(g.getPoints().getData(),3),e.resliceGeom.getPolys().setData(g.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(g.getPointData().getNormals());const h=d.getNormal(),m=e.resliceGeom.getNumberOfPoints();_o.normalize(h);const y=new Float32Array(m*3);for(let C=0;C<m;++C)y[3*C]=h[0],y[3*C+1]=h[1],y[3*C+2]=h[2];const v=Pt.newInstance({numberOfComponents:3,values:y,name:"Normals"});e.resliceGeom.getPointData().setNormals(v)}else ul("Something went wrong.","A default slice plane should have been created in the beginning of","updateResliceGeometry.");e.resliceGeomUpdateString=i,e.resliceGeom?.modified()}},t.setOpenGLTexture=i=>{i&&(e.openGLTexture=i,e._externalOpenGLTexture=!0)},t.delete=A1(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const YB={VBOBuildTime:{},VBOBuildString:null,haveSeenDepthRequest:!1,lastHaveSeenDepthRequest:!1,lastIndependentComponents:!1,lastTextureComponents:0,lastSlabThickness:0,lastSlabTrapezoidIntegration:0,lastSlabType:-1,openGLTexture:null,colorTextureString:null,pwfTextureString:null,resliceGeom:null,resliceGeomUpdateString:null,tris:null,colorTexture:null,pwfTexture:null,_externalOpenGLTexture:!1};function XB(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YB,n),$r.extend(t,e,n),H0.implementReplaceShaderCoincidentOffset(t,e,n),H0.implementBuildShadersWithReplacements(t,e,n),e.tris=Y0.newInstance(),e.openGLTexture=null,e.colorTexture=null,e.pwfTexture=null,e.VBOBuildTime={},Yn(e.VBOBuildTime),e.tmpMat4=wt(new Float64Array(16)),e.outlineFilter=CB.newInstance(),e.outlineFilter.setGenerateFaces(!0),e.outlineFilter.setGenerateLines(!1),e.cubePolyData=$c.newInstance(),e.cutter=PG.newInstance(),e.lineToSurfaceFilter=LG.newInstance(),e.transform=IB.newInstance(),ha(t,e,["openGLTexture"]),KB(t,e)}const ZB=An(XB,"vtkOpenGLImageResliceMapper");xi("vtkImageResliceMapper",ZB);const QB={NONE:-1,I:0,J:1,K:2,X:3,Y:4,Z:5};var Ep={SlicingMode:QB},C8=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,G1=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;const{vtkErrorMacro:Ou}=Zi,{SlicingMode:Xa}=Ep;function JB(t){const e=t.split(`
`),n=[];for(let r=0;r<e.length;++r){const i=e[r].trim();i.length>0&&n.push(i)}return n}function e$(t,e){e.classHierarchy.push("vtkOpenGLImageMapper");function n(r){e.openGLTexture.releaseGraphicsResources(r),[e._colorTransferFunc,e._pwFunc,e._labelOutlineThicknessArray].forEach(i=>r.unregisterGraphicsResourceUser(i,t))}t.buildPass=r=>{if(r){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&n(i),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow);const a=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(a.getActiveCamera()),e.renderable.isA("vtkImageMapper")&&e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(a.getActiveCamera())}},t.translucentPass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.getCoincidentParameters=(r,i)=>e.renderable.getResolveCoincidentTopology()==is.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const r=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,r)},t.getShaderTemplate=(r,i,a)=>{r.Vertex=C8,r.Fragment=G1,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;o=Te.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=Te.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result,o=Te.substitute(o,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result,o=Te.substitute(o,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result;const c=e.openGLTexture.getComponents(),u=a.getProperty().getIndependentComponents();let d=["varying vec2 tcoordVCVSOutput;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D texture1;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform sampler2D labelOutlineTexture1;","uniform float opacity;","uniform float outlineOpacity;"];if(u){for(let h=1;h<c;h++)d=d.concat([`uniform float cshift${h};`,`uniform float cscale${h};`,`uniform float pwfshift${h};`,`uniform float pwfscale${h};`]);switch(c){case 1:d=d.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:d=d.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:d=d.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:d=d.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:Ou("Unsupported number of independent coordinates.")}}if(s=Te.substitute(s,"//VTK::TCoord::Dec",d).result,a.getProperty().getUseLabelOutline()===!0&&(s=Te.substitute(s,"//VTK::LabelOutline::Dec",["uniform int outlineThickness;","uniform float vpWidth;","uniform float vpHeight;","uniform float vpOffsetX;","uniform float vpOffsetY;","uniform mat4 PCWCMatrix;","uniform mat4 vWCtoIDX;","uniform ivec3 imageDimensions;","uniform int sliceAxis;"]).result,s=Te.substitute(s,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result,s=Te.substitute(s,"//VTK::LabelOutlineHelperFunction",["#ifdef vtkImageLabelOutlineOn","vec3 fragCoordToIndexSpace(vec4 fragCoord) {","  vec4 pcPos = vec4(","    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,","    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,","    (fragCoord.z - 0.5) * 2.0,","    1.0);","","  vec4 worldCoord = PCWCMatrix * pcPos;","  vec4 vertex = (worldCoord/worldCoord.w);","","  vec3 index = (vWCtoIDX * vertex).xyz;","","  // half voxel fix for labelmapOutline","  return (index + vec3(0.5)) / vec3(imageDimensions);","}","vec2 getSliceCoords(vec3 coord, int axis) {","  if (axis == 0) return coord.yz;","  if (axis == 1) return coord.xz;","  if (axis == 2) return coord.xy;","}","#endif"]).result),u){const h=["r","g","b","a"];let m=["vec4 tvalue = texture2D(texture1, tcoordVCVSOutput);"];for(let y=0;y<c;y++)m=m.concat([`vec3 tcolor${y} = mix${y} * texture2D(colorTexture1, vec2(tvalue.${h[y]} * cscale${y} + cshift${y}, height${y})).rgb;`,`float compWeight${y} = mix${y} * texture2D(pwfTexture1, vec2(tvalue.${h[y]} * pwfscale${y} + pwfshift${y}, height${y})).r;`]);switch(c){case 1:m=m.concat(["gl_FragData[0] = vec4(tcolor0.rgb, opacity);"]);break;case 2:m=m.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:m=m.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:m=m.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:Ou("Unsupported number of independent coordinates.")}s=Te.substitute(s,"//VTK::TCoord::Impl",m).result}else switch(c){case 1:s=Te.substitute(s,"//VTK::TCoord::Impl",[...JB(`
                #ifdef vtkImageLabelOutlineOn
                  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord);
                  float centerValue = texture2D(texture1, getSliceCoords(centerPosIS, sliceAxis)).r;
                  bool pixelOnBorder = false;
                  vec3 tColor = texture2D(colorTexture1, vec2(centerValue * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(centerValue * pwfscale0 + pwfshift0, 0.5)).r;
                  float opacityToUse = scalarOpacity * opacity;
                  int segmentIndex = int(centerValue * 255.0);
                  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
                  float textureValue = texture2D(labelOutlineTexture1, vec2(textureCoordinate, 0.5)).r;
                  int actualThickness = int(textureValue * 255.0);

                  if (segmentIndex == 0){
                    gl_FragData[0] = vec4(0.0, 0.0, 0.0, 0.0);
                    return;
                  }

                  for (int i = -actualThickness; i <= actualThickness; i++) {
                    for (int j = -actualThickness; j <= actualThickness; j++) {
                      if (i == 0 || j == 0) {
                        continue;
                      }
                      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
                        gl_FragCoord.y + float(j),
                        gl_FragCoord.z, gl_FragCoord.w);
                      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
                      float value = texture2D(texture1, getSliceCoords(neighborPosIS, sliceAxis)).r;
                      if (value != centerValue) {
                        pixelOnBorder = true;
                        break;
                      }
                    }
                    if (pixelOnBorder == true) {
                      break;
                    }
                  }
                  if (pixelOnBorder == true) {
                    gl_FragData[0] = vec4(tColor, outlineOpacity);
                  }
                  else {
                    gl_FragData[0] = vec4(tColor, opacityToUse);
                  }
                #else
                  float intensity = texture2D(texture1, tcoordVCVSOutput).r;
                  vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;
                  gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);
                #endif
                `)]).result;break;case 2:s=Te.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","float intensity = tcolor.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tcolor.g + pwfshift0);"]).result;break;case 3:s=Te.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]).result;break;default:s=Te.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"]).result}e.haveSeenDepthRequest&&(s=Te.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=Te.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,t.replaceShaderClip(r,i,a),t.replaceShaderCoincidentOffset(r,i,a)},t.replaceShaderClip=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(Wt("OpenGL has a limit of 6 clipping planes"),c=6),o=Te.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,o=Te.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=Te.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,s=Te.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=o,r.Fragment=s},t.getNeedToRebuildShaders=(r,i,a)=>{const o=e.openGLTexture.getComponents(),s=a.getProperty().getIndependentComponents();let c=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(c=!0),c||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||r.getProgram()?.getHandle()===0||e.lastTextureComponents!==o||e.lastIndependentComponents!==s?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=o,e.lastIndependentComponents=s,!0):!1},t.updateShaders=(r,i,a)=>{if(e.lastBoundBO=r,t.getNeedToRebuildShaders(r,i,a)){const o={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(o,i,a);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);s!==r.getProgram()&&(r.setProgram(s),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,i,a),t.setCameraShaderParameters(r,i,a),t.setPropertyShaderParameters(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Ou("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),e.context.FALSE)||Ou("Error setting tcoordMC in shader VAO.")),r.getAttributeUpdateTime().modified());const o=e.openGLTexture.getTextureUnit();r.getProgram().setUniformi("texture1",o);const s=e.openGLTexture.getComponents(),c=a.getProperty().getIndependentComponents();if(c)for(let y=0;y<s;y++)r.getProgram().setUniformf(`mix${y}`,a.getProperty().getComponentWeight(y));const u=e.openGLTexture.getShiftAndScale();for(let y=0;y<s;y++){let v=a.getProperty().getColorWindow(),C=a.getProperty().getColorLevel();const S=c?y:0,w=a.getProperty().getRGBTransferFunction(S);if(w&&a.getProperty().getUseLookupTableScalarRange()){const O=w.getRange();v=O[1]-O[0],C=.5*(O[1]+O[0])}const x=u.scale/v,R=(u.shift-C)/v+.5;r.getProgram().setUniformf(`cshift${y}`,R),r.getProgram().setUniformf(`cscale${y}`,x)}for(let y=0;y<s;y++){let v=1,C=0;const S=c?y:0,w=a.getProperty().getPiecewiseFunction(S);if(w){const x=w.getRange(),R=x[1]-x[0],O=.5*(x[0]+x[1]);v=u.scale/R,C=(u.shift-O)/R+.5}r.getProgram().setUniformf(`pwfshift${y}`,C),r.getProgram().setUniformf(`pwfscale${y}`,v)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const y=t.getCoincidentParameters(i,a);r.getProgram().setUniformf("coffset",y.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",y.factor)}const d=e.colorTexture.getTextureUnit();r.getProgram().setUniformi("colorTexture1",d);const g=e.pwfTexture.getTextureUnit();r.getProgram().setUniformi("pwfTexture1",g);const h=e.labelOutlineThicknessTexture.getTextureUnit();if(r.getProgram().setUniformi("labelOutlineTexture1",h),e.renderable.getNumberOfClippingPlanes()){let y=e.renderable.getNumberOfClippingPlanes();y>6&&(Wt("OpenGL has a limit of 6 clipping planes"),y=6);const C=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,S=C?_r(e.imagematinv,a.getMatrix()):a.getMatrix();C&&(Qt(S,S),zt(S,S,C),Qt(S,S)),Qt(e.imagemat,e.currentInput.getIndexToWorld()),zt(e.imagematinv,S,e.imagemat);const w=[];for(let x=0;x<y;x++){const R=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,x,R);for(let O=0;O<4;O++)w.push(R[O])}r.getProgram().setUniformi("numClipPlanes",y),r.getProgram().setUniform4fv("clipPlanes",w)}if(a.getProperty().getUseLabelOutline()===!0){const y=a.getProperty().getLabelOutlineOpacity();r.getProgram().setUniformf("outlineOpacity",y)}},t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=e.openGLImageSlice.getKeyMatrices(),c=e.currentInput,u=c.getIndexToWorld();zt(e.imagemat,s.mcwc,u);const d=e.openGLCamera.getKeyMatrices(i);if(zt(e.imagemat,d.wcpc,e.imagemat),r.getCABO().getCoordShiftAndScaleEnabled()){const h=r.getCABO().getInverseShiftAndScaleMatrix();zt(e.imagemat,e.imagemat,h)}if(o.setUniformMatrix("MCPCMatrix",e.imagemat),a.getProperty().getUseLabelOutline()===!0){const h=c.getWorldToIndex(),m=c.getDimensions();let y=e.renderable.getClosestIJKAxis().ijkMode;y===Xa.NONE&&(y=Xa.K),o.setUniform3i("imageDimensions",m[0],m[1],m[2]),o.setUniformi("sliceAxis",y),o.setUniformMatrix("vWCtoIDX",h);const v=e.openGLCamera.getKeyMatrices(i);Br(e.projectionToWorld,v.wcpc),e.openGLCamera.getKeyMatrices(i),o.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const C=t.getRenderTargetSize();o.setUniformf("vpWidth",C[0]),o.setUniformf("vpHeight",C[1]);const S=t.getRenderTargetOffset();o.setUniformf("vpOffsetX",S[0]/C[0]),o.setUniformf("vpOffsetY",S[1]/C[1])}},t.setPropertyShaderParameters=(r,i,a)=>{const o=r.getProgram(),c=a.getProperty().getOpacity();o.setUniformf("opacity",c)},t.renderPieceStart=(r,i)=>{t.updateBufferObjects(r,i),e.lastBoundBO=null},t.renderPieceDraw=(r,i)=>{const a=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.labelOutlineThicknessTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,r,i),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.labelOutlineThicknessTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(r,i)=>{},t.renderPiece=(r,i)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getCurrentImage(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){Ou("No input!");return}t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.computeBounds=(r,i)=>{if(!t.getInput()){Cf(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i)},t.getNeedToRebuildBufferObjects=(r,i)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<i.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<i.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!e.openGLTexture?.getHandle()||!e.colorTexture?.getHandle()||!e.labelOutlineThicknessTexture?.getHandle()||!e.pwfTexture?.getHandle(),t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(!a)return;const o=a.getPointData()&&a.getPointData().getScalars();if(!o)return;const s=o.getDataType(),c=o.getNumberOfComponents(),u=i.getProperty(),d=u.getInterpolationType(),g=u.getIndependentComponents(),h=g?c:1,m=g?2*h:1,y=u.getRGBTransferFunction(),v=Fs(y,g,h),C=e._openGLRenderWindow.getGraphicsResourceForObject(y);if(!C?.oglObject?.getHandle()||C?.hash!==v){e.colorTexture=qn.newInstance({resizable:!0}),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const z=1024,oe=z*m*3,Q=new Uint8ClampedArray(oe);if(d===Il.NEAREST?(e.colorTexture.setMinificationFilter(pt.NEAREST),e.colorTexture.setMagnificationFilter(pt.NEAREST)):(e.colorTexture.setMinificationFilter(pt.LINEAR),e.colorTexture.setMagnificationFilter(pt.LINEAR)),y){const le=new Float32Array(z*3);for(let X=0;X<h;X++){const ie=u.getRGBTransferFunction(X),ye=ie.getRange();if(ie.getTable(ye[0],ye[1],z,le,1),g)for(let ge=0;ge<z*3;ge++)Q[X*z*6+ge]=255*le[ge],Q[X*z*6+ge+z*3]=255*le[ge];else for(let ge=0;ge<z*3;ge++)Q[X*z*6+ge]=255*le[ge]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(z,m,3,kt.UNSIGNED_CHAR,Q)}else{for(let le=0;le<z*3;++le)Q[le]=255*le/((z-1)*3),Q[le+1]=255*le/((z-1)*3),Q[le+2]=255*le/((z-1)*3);e.colorTexture.create2DFromRaw(z,1,3,kt.UNSIGNED_CHAR,Q)}y&&(e._openGLRenderWindow.setGraphicsResourceForObject(y,e.colorTexture,v),y!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(y,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=y)}else e.colorTexture=C.oglObject;const w=u.getPiecewiseFunction(),x=Fs(w,g,h),R=e._openGLRenderWindow.getGraphicsResourceForObject(w);if(!R?.oglObject?.getHandle()||R?.hash!==x){const oe=1024*m,Q=new Uint8ClampedArray(oe);if(e.pwfTexture=qn.newInstance({resizable:!0}),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),d===Il.NEAREST?(e.pwfTexture.setMinificationFilter(pt.NEAREST),e.pwfTexture.setMagnificationFilter(pt.NEAREST)):(e.pwfTexture.setMinificationFilter(pt.LINEAR),e.pwfTexture.setMagnificationFilter(pt.LINEAR)),w){const le=new Float32Array(oe),X=new Float32Array(1024);for(let ie=0;ie<h;++ie){const ye=u.getPiecewiseFunction(ie);if(ye===null)le.fill(1);else{const ge=ye.getRange();if(ye.getTable(ge[0],ge[1],1024,X,1),g)for(let W=0;W<1024;W++)le[ie*1024*2+W]=X[W],le[ie*1024*2+W+1024]=X[W];else for(let W=0;W<1024;W++)le[ie*1024*2+W]=X[W]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,m,1,kt.FLOAT,le)}else Q.fill(255),e.pwfTexture.create2DFromRaw(1024,1,1,kt.UNSIGNED_CHAR,Q);w&&(e._openGLRenderWindow.setGraphicsResourceForObject(w,e.pwfTexture,x),w!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(w,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=w)}else e.pwfTexture=R.oglObject;t.updatelabelOutlineThicknessTexture(i);const{ijkMode:b}=e.renderable.getClosestIJKAxis();let I=e.renderable.getSlice();b!==e.renderable.getSlicingMode()&&(I=e.renderable.getSliceAtPosition(I));const G=e.renderable.isA("vtkImageArrayMapper")?e.renderable.getSubSlice():Math.round(I),j=a.getExtent();let F;b===Xa.I&&(F=G-j[0]),b===Xa.J&&(F=G-j[2]),(b===Xa.K||b===Xa.NONE)&&(F=G-j[4]);const $=`${I}A${a.getMTime()}A${o.getMTime()}B${t.getMTime()}C${e.renderable.getSlicingMode()}D${i.getProperty().getInterpolationType()}`;if(e.VBOBuildString!==$){const z=a.getDimensions();e.openGLTexture||(e.openGLTexture=qn.newInstance({resizable:!0})),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),d===Il.NEAREST?(new Set([1,3,4]).has(c)&&s===kt.UNSIGNED_CHAR&&!g&&e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(pt.NEAREST),e.openGLTexture.setMagnificationFilter(pt.NEAREST)):(c===4&&s===kt.UNSIGNED_CHAR&&!g?(e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(pt.LINEAR_MIPMAP_LINEAR)):e.openGLTexture.setMinificationFilter(pt.LINEAR),e.openGLTexture.setMagnificationFilter(pt.LINEAR)),e.openGLTexture.setWrapS(C1.CLAMP_TO_EDGE),e.openGLTexture.setWrapT(C1.CLAMP_TO_EDGE);const oe=z[0]*z[1]*c,Q=new Float32Array(12),le=new Float32Array(8);for(let et=0;et<4;et++)le[et*2]=et%2?1:0,le[et*2+1]=et>1?1:0;const X=[Xa.X,Xa.Y,Xa.Z].includes(e.renderable.getSlicingMode())?I:G,ie=a.getSpatialExtent(),ye=o.getData();let ge=null;if(b===Xa.I){ge=new ye.constructor(z[2]*z[1]*c);let et=0;for(let Ze=0;Ze<z[2];Ze++)for(let yt=0;yt<z[1];yt++){let tt=(F+yt*z[0]+Ze*z[0]*z[1])*c;et=(Ze*z[1]+yt)*c;const st=tt+c;for(;tt<st;)ge[et++]=ye[tt++]}z[0]=z[1],z[1]=z[2],Q[0]=X,Q[1]=ie[2],Q[2]=ie[4],Q[3]=X,Q[4]=ie[3],Q[5]=ie[4],Q[6]=X,Q[7]=ie[2],Q[8]=ie[5],Q[9]=X,Q[10]=ie[3],Q[11]=ie[5]}else if(b===Xa.J){ge=new ye.constructor(z[2]*z[0]*c);let et=0;for(let Ze=0;Ze<z[2];Ze++)for(let yt=0;yt<z[0];yt++){let tt=(yt+F*z[0]+Ze*z[0]*z[1])*c;et=(Ze*z[0]+yt)*c;const st=tt+c;for(;tt<st;)ge[et++]=ye[tt++]}z[1]=z[2],Q[0]=ie[0],Q[1]=X,Q[2]=ie[4],Q[3]=ie[1],Q[4]=X,Q[5]=ie[4],Q[6]=ie[0],Q[7]=X,Q[8]=ie[5],Q[9]=ie[1],Q[10]=X,Q[11]=ie[5]}else b===Xa.K||b===Xa.NONE?(ge=ye.subarray(F*oe,(F+1)*oe),Q[0]=ie[0],Q[1]=ie[2],Q[2]=X,Q[3]=ie[1],Q[4]=ie[2],Q[5]=X,Q[6]=ie[0],Q[7]=ie[3],Q[8]=X,Q[9]=ie[1],Q[10]=ie[3],Q[11]=X):Ou("Reformat slicing not yet supported.");const W=o.getRanges();e.openGLTexture.resetFormatAndType(),e.openGLTexture.create2DFilterableFromRaw(z[0],z[1],c,o.getDataType(),ge,e.renderable.getPreferSizeOverAccuracy?.(),W),e.openGLTexture.activate(),e.openGLTexture.sendParameters(),e.openGLTexture.deactivate();const ae=Pt.newInstance({numberOfComponents:3,values:Q});ae.setName("points");const fe=Pt.newInstance({numberOfComponents:2,values:le});fe.setName("tcoords");const ue=new Uint16Array(8);ue[0]=3,ue[1]=0,ue[2]=1,ue[3]=3,ue[4]=3,ue[5]=0,ue[6]=3,ue[7]=2;const qe=Pt.newInstance({numberOfComponents:1,values:ue});e.tris.getCABO().createVBO(qe,"polys",bo.SURFACE,{points:ae,tcoords:fe,cellOffset:0}),e.VBOBuildTime.modified(),e.VBOBuildString=$}},t.updatelabelOutlineThicknessTexture=r=>{const i=r.getProperty().getLabelOutlineThicknessByReference(),a=e._openGLRenderWindow.getGraphicsResourceForObject(i),o=`${i.join("-")}`;if(!a?.oglObject?.getHandle()||a?.hash!==o){const g=new Uint8Array(1024);for(let h=0;h<1024;++h){const m=typeof i[h]<"u"?i[h]:i[0];g[h]=m}e.labelOutlineThicknessTexture=qn.newInstance({resizable:!1}),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(pt.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(pt.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw(1024,1,1,kt.UNSIGNED_CHAR,g),i&&(e._openGLRenderWindow.setGraphicsResourceForObject(i,e.labelOutlineThicknessTexture,o),i!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(i,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=i)}else e.labelOutlineThicknessTexture=a.oglObject},t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:r,vsize:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[r,i]},t.getRenderTargetOffset=()=>{const{lowerLeftU:r,lowerLeftV:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[r,i]},t.delete=A1(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const t$={VBOBuildTime:0,VBOBuildString:null,openGLTexture:null,tris:null,imagemat:null,imagematinv:null,colorTexture:null,pwfTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0};function n$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,t$,n),$r.extend(t,e,n),H0.implementReplaceShaderCoincidentOffset(t,e,n),H0.implementBuildShadersWithReplacements(t,e,n),e.tris=Y0.newInstance(),e.imagemat=wt(new Float64Array(16)),e.imagematinv=wt(new Float64Array(16)),e.projectionToWorld=wt(new Float64Array(16)),e.idxToView=wt(new Float64Array(16)),e.idxNormalMatrix=rs(new Float64Array(9)),e.modelToView=wt(new Float64Array(16)),e.projectionToView=wt(new Float64Array(16)),ri(t,e,[]),e.VBOBuildTime={},Yn(e.VBOBuildTime),e$(t,e)}const nO=An(n$,"vtkOpenGLImageMapper");var r$={newInstance:nO};xi("vtkAbstractImageMapper",nO);const fl={MAX:0,MIN:1,AVERAGE:2},{vtkErrorMacro:ch}=H;function i$(t,e){e.classHierarchy.push("vtkOpenGLImageCPRMapper");function n(r){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(i=>r.unregisterGraphicsResourceUser(i,t))}t.buildPass=r=>{if(r){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&n(i),e.context=e._openGLRenderWindow.getContext(),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.opaquePass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.opaqueZBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.getCoincidentParameters=(r,i)=>e.renderable.getResolveCoincidentTopology()===is.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const r=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,r)},t.renderPiece=(r,i)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update(),t.invokeEvent({type:"EndEvent"}),e.renderable.preRenderCheck()&&(e.currentImageDataInput=e.renderable.getInputData(0),e.currentCenterlineInput=e.renderable.getOrientedCenterline(),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i))},t.renderPieceStart=(r,i)=>{t.updateBufferObjects(r,i)},t.renderPieceDraw=(r,i)=>{const a=e.context;e.volumeTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,r,i),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.volumeTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(r,i)=>{},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i),i.getProperty().getInterpolationType()===Il.NEAREST?(e.volumeTexture.setMinificationFilter(pt.NEAREST),e.volumeTexture.setMagnificationFilter(pt.NEAREST),e.colorTexture.setMinificationFilter(pt.NEAREST),e.colorTexture.setMagnificationFilter(pt.NEAREST),e.pwfTexture.setMinificationFilter(pt.NEAREST),e.pwfTexture.setMagnificationFilter(pt.NEAREST)):(e.volumeTexture.setMinificationFilter(pt.LINEAR),e.volumeTexture.setMagnificationFilter(pt.LINEAR),e.colorTexture.setMinificationFilter(pt.LINEAR),e.colorTexture.setMagnificationFilter(pt.LINEAR),e.pwfTexture.setMinificationFilter(pt.LINEAR),e.pwfTexture.setMagnificationFilter(pt.LINEAR))},t.getNeedToRebuildBufferObjects=(r,i)=>{const a=e.VBOBuildTime.getMTime();return a<t.getMTime()||a<e.renderable.getMTime()||a<i.getMTime()||a<e.currentImageDataInput.getMTime()||a<e.currentCenterlineInput.getMTime()||!e.volumeTexture?.getHandle()},t.buildBufferObjects=(r,i)=>{const a=e.currentImageDataInput,o=e.currentCenterlineInput,s=a?.getPointData()?.getScalars();if(!s)return;const c=e._openGLRenderWindow.getGraphicsResourceForObject(s),u=y8(a,s),d=!c?.oglObject?.getHandle()||c?.hash!==u,g=e.renderable.getUpdatedExtents(),h=!!g.length;if(d){e.volumeTexture=qn.newInstance(),e.volumeTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const F=a.getDimensions();e.volumeTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.volumeTexture.resetFormatAndType(),e.volumeTexture.create3DFilterableFromDataArray(F[0],F[1],F[2],s,e.renderable.getPreferSizeOverAccuracy()),e._openGLRenderWindow.setGraphicsResourceForObject(s,e.volumeTexture,u),s!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(s,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=s}else e.volumeTexture=c.oglObject;if(h){e.renderable.setUpdatedExtents([]);const F=a.getDimensions();e.volumeTexture.create3DFilterableFromDataArray(F[0],F[1],F[2],s,!1,g)}const m=s.getNumberOfComponents(),y=i.getProperty(),v=y.getIndependentComponents(),C=v?m:1,S=v?2*C:1,w=y.getRGBTransferFunction(),x=Fs(w,v,C),R=e._openGLRenderWindow.getGraphicsResourceForObject(w);if(!R?.oglObject?.getHandle()||R?.hash!==x){const $=1024*S*3,z=new Uint8ClampedArray($);if(e.colorTexture=qn.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),w){const oe=new Float32Array(3072);for(let Q=0;Q<C;Q++){const le=y.getRGBTransferFunction(Q),X=le.getRange();if(le.getTable(X[0],X[1],1024,oe,1),v)for(let ie=0;ie<1024*3;ie++)z[Q*1024*6+ie]=255*oe[ie],z[Q*1024*6+ie+1024*3]=255*oe[ie];else for(let ie=0;ie<1024*3;ie++)z[Q*1024*6+ie]=255*oe[ie]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,S,3,kt.UNSIGNED_CHAR,z)}else{for(let oe=0;oe<1024*3;++oe)z[oe]=255*oe/(1023*3),z[oe+1]=255*oe/(1023*3),z[oe+2]=255*oe/(1023*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,1,3,kt.UNSIGNED_CHAR,z)}w&&(e._openGLRenderWindow.setGraphicsResourceForObject(w,e.colorTexture,x),w!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(w,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=w)}else e.colorTexture=R.oglObject;const b=y.getPiecewiseFunction(),I=Fs(b,v,C),G=e._openGLRenderWindow.getGraphicsResourceForObject(b);if(!G?.oglObject?.getHandle()||G?.hash!==I){const $=1024*S,z=new Uint8ClampedArray($);if(e.pwfTexture=qn.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),b){const oe=new Float32Array($),Q=new Float32Array(1024);for(let le=0;le<C;++le){const X=y.getPiecewiseFunction(le);if(X===null)oe.fill(1);else{const ie=X.getRange();if(X.getTable(ie[0],ie[1],1024,Q,1),v)for(let ye=0;ye<1024;ye++)oe[le*1024*2+ye]=Q[ye],oe[le*1024*2+ye+1024]=Q[ye];else for(let ye=0;ye<1024;ye++)oe[le*1024*2+ye]=Q[ye]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,S,1,kt.FLOAT,oe)}else z.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,1,1,kt.UNSIGNED_CHAR,z);b&&(e._openGLRenderWindow.setGraphicsResourceForObject(b,e.pwfTexture,I),b!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(b,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=b)}else e.pwfTexture=G.oglObject;if(e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<o.getMTime()){const F=o.getNumberOfPoints(),$=F<=1?0:F-1,z=o.getDistancesToFirstPoint(),oe=e.renderable.getHeight(),Q=4*$,le=new Float32Array(3*Q),X=e.renderable.getWidth();for(let tt=0,st=0;tt<$;++tt)le.set([0,oe-z[tt],0],st),st+=3,le.set([X,oe-z[tt],0],st),st+=3,le.set([X,oe-z[tt+1],0],st),st+=3,le.set([0,oe-z[tt+1],0],st),st+=3;const ie=Pt.newInstance({numberOfComponents:3,values:le});ie.setName("points");const ye=new Uint16Array(5*$);for(let tt=0,st=0,Bt=0;tt<$;++tt)ye.set([4,Bt+3,Bt+2,Bt+1,Bt],st),st+=5,Bt+=4;const ge=Pt.newInstance({numberOfComponents:1,values:ye}),W=o.getPoints(),ae=new Float32Array(3*Q),fe=new Array(3),ue=new Array(3);for(let tt=0,st=0;tt<$;++tt)W.getPoint(tt,fe),W.getPoint(tt+1,ue),ae.set(fe,st),st+=3,ae.set(fe,st),st+=3,ae.set(ue,st),st+=3,ae.set(ue,st),st+=3;const qe=Pt.newInstance({numberOfComponents:3,values:ae,name:"centerlinePosition"}),et=new Float32Array(Q);for(let tt=0,st=0;tt<$;++tt)et.set([0,1,3,2],st),st+=4;const Ze=Pt.newInstance({numberOfComponents:1,values:et,name:"quadIndex"}),yt=[qe,Ze];if(!e.renderable.getUseUniformOrientation()){const tt=e.renderable.getOrientedCenterline().getOrientations()??[],st=new Float32Array(4*Q),Bt=new Float32Array(4*Q);for(let bn=0;bn<$;++bn){const Gn=tt[bn],Mn=tt[bn+1];for(let Nn=0;Nn<4;++Nn){const Bn=4*(Nn+4*bn);st.set(Gn,Bn),Bt.set(Mn,Bn)}}const pr=Pt.newInstance({numberOfComponents:4,values:st,name:"centerlineTopOrientation"}),Lr=Pt.newInstance({numberOfComponents:4,values:Bt,name:"centerlineBotOrientation"});yt.push(pr,Lr)}e.tris.getCABO().createVBO(ge,"polys",bo.SURFACE,{points:ie,customAttributes:yt}),e.VBOBuildTime.modified()}},t.getNeedToRebuildShaders=(r,i,a)=>{const o=e.volumeTexture.getComponents(),s=a.getProperty().getIndependentComponents(),c=!!e.renderable.getCenterPoint(),u=e.renderable.getUseUniformOrientation(),d=e.renderable.isProjectionEnabled()&&e.renderable.getProjectionMode();return r.getProgram()===0||e.lastUseCenterPoint!==c||e.lastUseUniformOrientation!==u||e.lastProjectionMode!==d||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||e.lastTextureComponents!==o||e.lastIndependentComponents!==s?(e.lastUseCenterPoint=c,e.lastUseUniformOrientation=u,e.lastProjectionMode=d,e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=o,e.lastIndependentComponents=s,!0):!1},t.buildShaders=(r,i,a)=>{t.getShaderTemplate(r,i,a),t.replaceShaderValues(r,i,a)},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;const c=["vec3 applyQuaternionToVec(vec4 q, vec3 v) {","  float uvx = q.y * v.z - q.z * v.y;","  float uvy = q.z * v.x - q.x * v.z;","  float uvz = q.x * v.y - q.y * v.x;","  float uuvx = q.y * uvz - q.z * uvy;","  float uuvy = q.z * uvx - q.x * uvz;","  float uuvz = q.x * uvy - q.y * uvx;","  float w2 = q.w * 2.0;","  uvx *= w2;","  uvy *= w2;","  uvz *= w2;","  uuvx *= 2.0;","  uuvy *= 2.0;","  uuvz *= 2.0;","  return vec3(v.x + uvx + uuvx, v.y + uvy + uuvy, v.z + uvz + uuvz);","}"];o=Te.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=Te.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result;const u=["attribute vec3 centerlinePosition;","attribute float quadIndex;","uniform float width;","out vec2 quadOffsetVSOutput;","out vec3 centerlinePosVSOutput;"],d=e.renderable.isProjectionEnabled(),g=e.renderable.getUseUniformOrientation();g?(u.push("out vec3 samplingDirVSOutput;","uniform vec4 centerlineOrientation;","uniform vec3 tangentDirection;",...c),d&&u.push("out vec3 projectionDirVSOutput;","uniform vec3 bitangentDirection;")):u.push("out vec4 centerlineTopOrientationVSOutput;","out vec4 centerlineBotOrientationVSOutput;","attribute vec4 centerlineTopOrientation;","attribute vec4 centerlineBotOrientation;"),o=Te.substitute(o,"//VTK::Color::Dec",u).result;const h=["quadOffsetVSOutput = vec2(width * (mod(quadIndex, 2.0) == 0.0 ? -0.5 : 0.5), quadIndex > 1.0 ? 0.0 : 1.0);","centerlinePosVSOutput = centerlinePosition;"];g?(h.push("samplingDirVSOutput = applyQuaternionToVec(centerlineOrientation, tangentDirection);"),d&&h.push("projectionDirVSOutput = applyQuaternionToVec(centerlineOrientation, bitangentDirection);")):h.push("centerlineTopOrientationVSOutput = centerlineTopOrientation;","centerlineBotOrientationVSOutput = centerlineBotOrientation;"),o=Te.substitute(o,"//VTK::Color::Impl",h).result;const m=e.volumeTexture.getComponents(),y=a.getProperty().getIndependentComponents();let v=["uniform mat4 MCTCMatrix; // Model coordinates to texture coordinates","in vec2 quadOffsetVSOutput;","in vec3 centerlinePosVSOutput;","uniform highp sampler3D volumeTexture;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;"];d&&v.push("uniform vec3 volumeSizeMC;","uniform int projectionSlabNumberOfSamples;","uniform float projectionConstantOffset;","uniform float projectionStepLength;"),g?(v.push("in vec3 samplingDirVSOutput;"),d&&v.push("in vec3 projectionDirVSOutput;")):(v.push("uniform vec3 tangentDirection;","in vec4 centerlineTopOrientationVSOutput;","in vec4 centerlineBotOrientationVSOutput;",...c),d&&v.push("uniform vec3 bitangentDirection;"));const C=e.renderable.getCenterPoint();if(C&&v.push("uniform vec3 globalCenterPoint;"),y){for(let w=1;w<m;w++)v=v.concat([`uniform float cshift${w};`,`uniform float cscale${w};`,`uniform float pwfshift${w};`,`uniform float pwfscale${w};`]);switch(m){case 1:v=v.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:v=v.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:v=v.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:v=v.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:ch("Unsupported number of independent coordinates.")}}s=Te.substitute(s,"//VTK::TCoord::Dec",v).result;let S=[];if(g?(S.push("vec3 samplingDirection = samplingDirVSOutput;"),d&&S.push("vec3 projectionDirection = projectionDirVSOutput;")):(S.push("vec4 q0 = centerlineBotOrientationVSOutput;","vec4 q1 = centerlineTopOrientationVSOutput;","float qCosAngle = dot(q0, q1);","vec4 interpolatedOrientation;","if (qCosAngle > 0.999 || qCosAngle < -0.999) {","  // Use LERP instead of SLERP when the two quaternions are close or opposite","  interpolatedOrientation = normalize(mix(q0, q1, quadOffsetVSOutput.y));","} else {","  float omega = acos(qCosAngle);","  interpolatedOrientation = normalize(sin((1.0 - quadOffsetVSOutput.y) * omega) * q0 + sin(quadOffsetVSOutput.y * omega) * q1);","}","vec3 samplingDirection = applyQuaternionToVec(interpolatedOrientation, tangentDirection);"),d&&S.push("vec3 projectionDirection = applyQuaternionToVec(interpolatedOrientation, bitangentDirection);")),C?S.push("float baseOffset = dot(samplingDirection, globalCenterPoint - centerlinePosVSOutput);","float horizontalOffset = quadOffsetVSOutput.x + baseOffset;"):S.push("float horizontalOffset = quadOffsetVSOutput.x;"),S.push("vec3 volumePosMC = centerlinePosVSOutput + horizontalOffset * samplingDirection;","vec3 volumePosTC = (MCTCMatrix * vec4(volumePosMC, 1.0)).xyz;","if (any(lessThan(volumePosTC, vec3(0.0))) || any(greaterThan(volumePosTC, vec3(1.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}"),d){const w=e.renderable.getProjectionMode();switch(w){case fl.MIN:S.push("const vec4 initialProjectionTextureValue = vec4(1.0);");break;case fl.MAX:case fl.AVERAGE:default:S.push("const vec4 initialProjectionTextureValue = vec4(0.0);");break}switch(S.push("vec3 projectionScaledDirection = projectionDirection / volumeSizeMC;","vec3 projectionStep = projectionStepLength * projectionScaledDirection;","vec3 projectionStartPosition = volumePosTC + projectionConstantOffset * projectionScaledDirection;","vec4 tvalue = initialProjectionTextureValue;","for (int projectionSampleIdx = 0; projectionSampleIdx < projectionSlabNumberOfSamples; ++projectionSampleIdx) {","  vec3 projectionSamplePosition = projectionStartPosition + float(projectionSampleIdx) * projectionStep;","  vec4 sampledTextureValue = texture(volumeTexture, projectionSamplePosition);"),w){case fl.MAX:S.push("  tvalue = max(tvalue, sampledTextureValue);");break;case fl.MIN:S.push("  tvalue = min(tvalue, sampledTextureValue);");break;case fl.AVERAGE:default:S.push("  tvalue = tvalue + sampledTextureValue;");break}S.push("}"),w===fl.AVERAGE&&S.push("tvalue = tvalue / float(projectionSlabNumberOfSamples);")}else S.push("vec4 tvalue = texture(volumeTexture, volumePosTC);");if(y){const w=["r","g","b","a"];for(let x=0;x<m;++x)S=S.concat([`vec3 tcolor${x} = mix${x} * texture2D(colorTexture1, vec2(tvalue.${w[x]} * cscale${x} + cshift${x}, height${x})).rgb;`,`float compWeight${x} = mix${x} * texture2D(pwfTexture1, vec2(tvalue.${w[x]} * pwfscale${x} + pwfshift${x}, height${x})).r;`]);switch(m){case 1:S=S.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:S=S.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:S=S.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:S=S.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:ch("Unsupported number of independent coordinates.")}}else switch(m){case 1:S=S.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:S=S.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:S=S.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:S=S.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}s=Te.substitute(s,"//VTK::TCoord::Impl",S).result,e.haveSeenDepthRequest&&(s=Te.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=Te.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,t.replaceShaderClip(r,i,a),t.replaceShaderCoincidentOffset(r,i,a)},t.replaceShaderClip=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(H.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),c=6),o=Te.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,o=Te.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=Te.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,s=Te.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=o,r.Fragment=s},t.getShaderTemplate=(r,i,a)=>{r.Vertex=C8,r.Fragment=G1,r.Geometry=""},t.setMapperShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=r.getCABO();s.getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(o.isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(o,s,"vertexMC",s.getVertexOffset(),s.getStride(),e.context.FLOAT,3,e.context.FALSE)||ch("Error setting vertexMC in shader VAO.")),r.getCABO().getCustomData().forEach(m=>{m&&o.isAttributeUsed(m.name)&&!r.getVAO().addAttributeArray(o,s,m.name,m.offset,s.getStride(),e.context.FLOAT,m.components,e.context.FALSE)&&ch(`Error setting ${m.name} in shader VAO.`)}),r.getAttributeUpdateTime().modified());const c=e.volumeTexture.getTextureUnit();if(o.setUniformi("volumeTexture",c),o.setUniformf("width",e.renderable.getWidth()),r.getProgram().setUniform4fv("backgroundColor",e.renderable.getBackgroundColor()),o.isUniformUsed("tangentDirection")){const m=e.renderable.getTangentDirection();r.getProgram().setUniform3fArray("tangentDirection",m)}if(o.isUniformUsed("bitangentDirection")){const m=e.renderable.getBitangentDirection();r.getProgram().setUniform3fArray("bitangentDirection",m)}if(o.isUniformUsed("centerlineOrientation")){const m=e.renderable.getUniformOrientation();r.getProgram().setUniform4fv("centerlineOrientation",m)}if(o.isUniformUsed("globalCenterPoint")){const m=e.renderable.getCenterPoint();o.setUniform3fArray("globalCenterPoint",m)}if(e.renderable.isProjectionEnabled()){const m=e.currentImageDataInput,y=m.getSpacing(),v=m.getDimensions(),C=e.renderable.getProjectionSlabThickness(),S=e.renderable.getProjectionSlabNumberOfSamples(),w=JU([],y,v);o.setUniform3fArray("volumeSizeMC",w),o.setUniformi("projectionSlabNumberOfSamples",S);const x=-.5*C;o.setUniformf("projectionConstantOffset",x);const R=C/(S-1);o.setUniformf("projectionStepLength",R)}const u=e.currentImageDataInput,d=u.getWorldToIndex(),g=qv(new Float32Array(16),SE([],u.getDimensions())),h=V2(g,g,d);if(o.setUniformMatrix("MCTCMatrix",h),e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),e.renderable.getNumberOfClippingPlanes()){let m=e.renderable.getNumberOfClippingPlanes();m>6&&(H.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),m=6);const v=s.getCoordShiftAndScaleEnabled()?s.getInverseShiftAndScaleMatrix():null,C=v?_r(e.imagematinv,a.getMatrix()):a.getMatrix();v&&(Qt(C,C),zt(C,C,v),Qt(C,C)),Qt(e.imagemat,e.currentImageDataInput.getIndexToWorld()),zt(e.imagematinv,C,e.imagemat);const S=[];for(let w=0;w<m;w++){const x=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,w,x);for(let R=0;R<4;R++)S.push(x[R])}o.setUniformi("numClipPlanes",m),o.setUniform4fv("clipPlanes",S)}if(o.isUniformUsed("coffset")){const m=t.getCoincidentParameters(i,a);o.setUniformf("coffset",m.offset),o.isUniformUsed("cfactor")&&o.setUniformf("cfactor",m.factor)}},t.setCameraShaderParameters=(r,i,a)=>{const o=e.openGLImageSlice.getKeyMatrices().mcwc,s=e.openGLCamera.getKeyMatrices(i).wcpc;if(zt(e.imagemat,s,o),r.getCABO().getCoordShiftAndScaleEnabled()){const c=r.getCABO().getInverseShiftAndScaleMatrix();zt(e.imagemat,e.imagemat,c)}r.getProgram().setUniformMatrix("MCPCMatrix",e.imagemat)},t.setPropertyShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=a.getProperty(),c=s.getOpacity();o.setUniformf("opacity",c);const u=e.volumeTexture.getComponents(),d=s.getIndependentComponents();if(d)for(let y=0;y<u;++y)o.setUniformf(`mix${y}`,s.getComponentWeight(y));const g=e.volumeTexture.getVolumeInfo();for(let y=0;y<u;y++){let v=s.getColorWindow(),C=s.getColorLevel();const S=d?y:0,w=s.getRGBTransferFunction(S);if(w&&s.getUseLookupTableScalarRange()){const O=w.getRange();v=O[1]-O[0],C=.5*(O[1]+O[0])}const x=g.scale[y]/v,R=(g.offset[y]-C)/v+.5;o.setUniformf(`cshift${y}`,R),o.setUniformf(`cscale${y}`,x)}const h=e.colorTexture.getTextureUnit();o.setUniformi("colorTexture1",h);for(let y=0;y<u;y++){let v=1,C=0;const S=d?y:0,w=s.getPiecewiseFunction(S);if(w){const x=w.getRange(),R=x[1]-x[0],O=.5*(x[0]+x[1]);v=g.scale[y]/R,C=(g.offset[y]-O)/R+.5}o.setUniformf(`pwfshift${y}`,C),o.setUniformf(`pwfscale${y}`,v)}const m=e.pwfTexture.getTextureUnit();o.setUniformi("pwfTexture1",m)},t.updateShaders=(r,i,a)=>{if(t.getNeedToRebuildShaders(r,i,a)){const o={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(o,i,a);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);s!==r.getProgram()&&(r.setProgram(s),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,i,a),t.setCameraShaderParameters(r,i,a),t.setPropertyShaderParameters(r,i,a)},t.delete=H.chain(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const a$={currentRenderPass:null,volumeTexture:null,colorTexture:null,pwfTexture:null,tris:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0,lastIndependentComponents:0,imagemat:null,imagematinv:null};function o$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,a$,n),$r.extend(t,e,n),H0.implementReplaceShaderCoincidentOffset(t,e,n),H.algo(t,e,2,0),e.tris=Y0.newInstance(),e.volumeTexture=null,e.colorTexture=null,e.pwfTexture=null,e.imagemat=wt(new Float64Array(16)),e.imagematinv=wt(new Float64Array(16)),e.VBOBuildTime={},H.obj(e.VBOBuildTime,{mtime:0}),i$(t,e)}const rO=H.newInstance(o$,"vtkOpenGLImageCPRMapper"),s$={};var c$={newInstance:rO,...s$};xi("vtkImageCPRMapper",rO);function l$(t,e){e.classHierarchy.push("vtkOpenGLImageSlice"),t.buildPass=n=>{if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{n&&e.context.depthMask(!0)},t.translucentPass=(n,r)=>{e.context.depthMask(!n)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(_r(e.keyMatrices.mcwc,e.renderable.getMatrix()),Qt(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.keyMatrixTime.modified()),e.keyMatrices)}const u$={context:null,keyMatrixTime:null,keyMatrices:null};function f$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,u$,n),$r.extend(t,e,n),e.keyMatrixTime={},Yn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:wt(new Float64Array(16))},ri(t,e,["context"]),l$(t,e)}const iO=An(f$,"vtkOpenGLImageSlice");var g$={newInstance:iO};xi("vtkImageSlice",iO);function d$(t,e){e.classHierarchy.push("vtkOpenGLVolume"),t.buildPass=n=>{!e.renderable||!e.renderable.getVisibility()||n&&(e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementVolumeCount()}},t.traverseVolumePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0].traverse(n),t.apply(n,!1))},t.volumePass=n=>{!e.renderable||!e.renderable.getVisibility()||e.context.depthMask(!n)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),_r(e.MCWCMatrix,e.renderable.getMatrix()),Qt(e.MCWCMatrix,e.MCWCMatrix),e.renderable.getIsIdentity()?rs(e.normalMatrix):(vp(e.normalMatrix,e.MCWCMatrix),F1(e.normalMatrix,e.normalMatrix),Wv(e.normalMatrix,e.normalMatrix)),e.keyMatrixTime.modified()),{mcwc:e.MCWCMatrix,normalMatrix:e.normalMatrix})}const h$={};function p$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,h$,n),$r.extend(t,e,n),e.keyMatrixTime={},Yn(e.keyMatrixTime,{mtime:0}),e.normalMatrix=new Float64Array(9),e.MCWCMatrix=new Float64Array(16),ri(t,e,["context"]),d$(t,e)}const aO=An(p$,"vtkOpenGLVolume");var m$={newInstance:aO};xi("vtkVolume",aO);function v$(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.saveCurrentBindings(r),t.saveCurrentBuffers(r)},t.saveCurrentBindings=n=>{if(!e.context){Wt("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}const r=e.context;e.previousDrawBinding=r.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=n=>{},t.restorePreviousBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.restorePreviousBindings(r),t.restorePreviousBuffers(r)},t.restorePreviousBindings=n=>{if(!e.context){Wt("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}const r=e.context;r.bindFramebuffer(r.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=n=>{},t.bind=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;r===null&&(r=e.context.FRAMEBUFFER),e.context.bindFramebuffer(r,e.glFramebuffer);for(let i=0;i<e.colorBuffers.length;i++)e.colorBuffers[i].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(n,r)=>{if(!e.context){Wt("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=n,e.glFramebuffer.height=r},t.setColorBuffer=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=e.context;if(!i){Wt("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let a=i.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())a+=r;else{Wt("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[r]=n,i.framebufferTexture2D(i.FRAMEBUFFER,a,i.TEXTURE_2D,n.getHandle(),0)},t.removeColorBuffer=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const r=e.context;if(!r){Wt("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let i=r.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())i+=n;else{Wt("Using multiple framebuffer attachments requires WebGL 2");return}r.framebufferTexture2D(r.FRAMEBUFFER,i,r.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(n,1)},t.setDepthBuffer=n=>{if(!e.context){Wt("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,n.getHandle(),0)}else Wt("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){Wt("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,null,0)}else Wt("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){Wt("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();const n=e.context,r=qn.newInstance();r.setOpenGLRenderWindow(e._openGLRenderWindow),r.setMinificationFilter(pt.LINEAR),r.setMagnificationFilter(pt.LINEAR),r.create2DFromRaw(e.glFramebuffer.width,e.glFramebuffer.height,4,kt.UNSIGNED_CHAR,null),t.setColorBuffer(r),e.depthTexture=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,e.depthTexture),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}const y$={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function oO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,y$,n),Yn(t,e),e.colorBuffers&&Wt("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],Tf(t,e,["colorBuffers"]),v$(t,e)}const T$=An(oO,"vtkFramebuffer");var Rp={newInstance:T$,extend:oO},C$=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexDC;

varying vec3 vertexVCVSOutput;
uniform mat4 PCVCMatrix;

uniform float dcxmin;
uniform float dcxmax;
uniform float dcymin;
uniform float dcymax;

void main()
{
  // dcsmall is the device coords reduced to the
  // x y area covered by the volume
  vec4 dcsmall = vec4(
    dcxmin + 0.5 * (vertexDC.x + 1.0) * (dcxmax - dcxmin),
    dcymin + 0.5 * (vertexDC.y + 1.0) * (dcymax - dcymin),
    vertexDC.z,
    vertexDC.w);
  vec4 vcpos = PCVCMatrix * dcsmall;
  vertexVCVSOutput = vcpos.xyz/vcpos.w;
  gl_Position = dcsmall;
}
`,S$=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the volume mappers fragment shader

// the output of this shader
//VTK::Output::Dec

varying vec3 vertexVCVSOutput;

// first declare the settings from the mapper
// that impact the code paths in here

// always set vtkNumComponents 1,2,3,4
//VTK::NumComponents

// possibly define vtkTrilinearOn
//VTK::TrilinearOn

// possibly define UseIndependentComponents
//VTK::IndependentComponentsOn

// possibly define vtkCustomComponentsColorMix
//VTK::CustomComponentsColorMixOn

// possibly define any "proportional" components
//VTK::vtkProportionalComponents

// possibly define any components that are forced to nearest interpolation
//VTK::vtkForceNearestComponents

// Define the blend mode to use
#define vtkBlendMode //VTK::BlendMode

// Possibly define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Possibly define vtkLabelEdgeProjectionOn
//VTK::LabelEdgeProjectionOn


#ifdef vtkImageLabelOutlineOn
  uniform float outlineOpacity;
  uniform float vpWidth;
  uniform float vpHeight;
  uniform float vpOffsetX;
  uniform float vpOffsetY;
  uniform mat4 PCWCMatrix;
  uniform mat4 vWCtoIDX;

  const int MAX_SEGMENT_INDEX = 256; // Define as per expected maximum
  // bool seenSegmentsByOriginalPos[MAX_SEGMENT_INDEX];
  #define MAX_SEGMENTS 256
  #define UINT_SIZE 32
  #define BITMASK_SIZE ((MAX_SEGMENTS + UINT_SIZE - 1) / UINT_SIZE)

  uint bitmask[BITMASK_SIZE];

  // Set the corresponding bit in the bitmask
  void setBit(int segmentIndex) {
    int index = segmentIndex / UINT_SIZE;
    int bitIndex = segmentIndex % UINT_SIZE;
    bitmask[index] |= 1u << bitIndex;
  }

  // Check if a bit is set in the bitmask
  bool isBitSet(int segmentIndex) {
    int index = segmentIndex / UINT_SIZE;
    int bitIndex = segmentIndex % UINT_SIZE;
    return ((bitmask[index] & (1u << bitIndex)) != 0u);
  }
#endif

// define vtkLightComplexity
//VTK::LightComplexity
#if vtkLightComplexity > 0
uniform float vSpecularPower;
uniform float vAmbient;
uniform float vDiffuse;
uniform float vSpecular;
//VTK::Light::Dec
#endif

//VTK::VolumeShadowOn
//VTK::SurfaceShadowOn
//VTK::localAmbientOcclusionOn
//VTK::LAO::Dec
//VTK::VolumeShadow::Dec

// define vtkComputeNormalFromOpacity
//VTK::vtkComputeNormalFromOpacity

// possibly define vtkGradientOpacityOn
//VTK::GradientOpacityOn
#ifdef vtkGradientOpacityOn
uniform float goscale0;
uniform float goshift0;
uniform float gomin0;
uniform float gomax0;
#ifdef UseIndependentComponents
#if vtkNumComponents > 1
uniform float goscale1;
uniform float goshift1;
uniform float gomin1;
uniform float gomax1;
#if vtkNumComponents > 2
uniform float goscale2;
uniform float goshift2;
uniform float gomin2;
uniform float gomax2;
#if vtkNumComponents > 3
uniform float goscale3;
uniform float goshift3;
uniform float gomin3;
uniform float gomax3;
#endif
#endif
#endif
#endif
#endif

// if you want to see the raw tiled
// data in webgl1 uncomment the following line
// #define debugtile

// camera values
uniform float camThick;
uniform float camNear;
uniform float camFar;
uniform int cameraParallel;

// values describing the volume geometry
uniform vec3 vOriginVC;
uniform vec3 vSpacing;
uniform ivec3 volumeDimensions; // 3d texture dimensions
uniform vec3 vPlaneNormal0;
uniform float vPlaneDistance0;
uniform vec3 vPlaneNormal1;
uniform float vPlaneDistance1;
uniform vec3 vPlaneNormal2;
uniform float vPlaneDistance2;
uniform vec3 vPlaneNormal3;
uniform float vPlaneDistance3;
uniform vec3 vPlaneNormal4;
uniform float vPlaneDistance4;
uniform vec3 vPlaneNormal5;
uniform float vPlaneDistance5;

//VTK::ClipPlane::Dec

// opacity and color textures
uniform sampler2D otexture;
uniform float oshift0;
uniform float oscale0;
uniform sampler2D ctexture;
uniform float cshift0;
uniform float cscale0;

#if vtkNumComponents >= 2
uniform float oshift1;
uniform float oscale1;
uniform float cshift1;
uniform float cscale1;
#endif
#if vtkNumComponents >= 3
uniform float oshift2;
uniform float oscale2;
uniform float cshift2;
uniform float cscale2;
#endif
#if vtkNumComponents >= 4
uniform float oshift3;
uniform float oscale3;
uniform float cshift3;
uniform float cscale3;
#endif

// jitter texture
uniform sampler2D jtexture;
uniform sampler2D ttexture;


// some 3D texture values
uniform float sampleDistance;
uniform vec3 vVCToIJK;
uniform vec3 volumeSpacings; // spacing in the world coorindates


// the heights defined below are the locations
// for the up to four components of the tfuns
// the tfuns have a height of 2XnumComps pixels so the
// values are computed to hit the middle of the two rows
// for that component
#ifdef UseIndependentComponents
#if vtkNumComponents == 1
uniform float mix0;
#define height0 0.5
#endif
#if vtkNumComponents == 2
uniform float mix0;
uniform float mix1;
#define height0 0.25
#define height1 0.75
#endif
#if vtkNumComponents == 3
uniform float mix0;
uniform float mix1;
uniform float mix2;
#define height0 0.17
#define height1 0.5
#define height2 0.83
#endif
#if vtkNumComponents == 4
uniform float mix0;
uniform float mix1;
uniform float mix2;
uniform float mix3;
#define height0 0.125
#define height1 0.375
#define height2 0.625
#define height3 0.875
#endif
#endif

uniform vec4 ipScalarRangeMin;
uniform vec4 ipScalarRangeMax;

// declaration for intermixed geometry
//VTK::ZBuffer::Dec

//=======================================================================
// global and custom variables (a temporary section before photorealistics rendering module is complete)
vec3 rayDirVC;
float sampleDistanceISVS;
float sampleDistanceIS;

#define SQRT3    1.7321
#define INV4PI   0.0796
#define EPSILON  0.001
#define PI       3.1415
#define PI2      9.8696

//=======================================================================
// Webgl2 specific version of functions
#if __VERSION__ == 300

uniform highp sampler3D texture1;

vec4 getTextureValue(vec3 pos)
{
  vec4 tmp = texture(texture1, pos);

  #if defined(vtkComponent0ForceNearest) || \\
      defined(vtkComponent1ForceNearest) || \\
      defined(vtkComponent2ForceNearest) || \\
      defined(vtkComponent3ForceNearest)
    vec3 nearestPos = (floor(pos * vec3(volumeDimensions)) + 0.5) / vec3(volumeDimensions);
    vec4 nearestValue = texture(texture1, nearestPos);
    #ifdef vtkComponent0ForceNearest
      tmp[0] = nearestValue[0];
    #endif
    #ifdef vtkComponent1ForceNearest
      tmp[1] = nearestValue[1];
    #endif
    #ifdef vtkComponent2ForceNearest
      tmp[2] = nearestValue[2];
    #endif
    #ifdef vtkComponent3ForceNearest
      tmp[3] = nearestValue[3];
    #endif
  #endif

  #ifndef UseIndependentComponents
    #if vtkNumComponents == 1
      tmp.a = tmp.r;
    #endif
    #if vtkNumComponents == 2
      tmp.a = tmp.g;
    #endif
    #if vtkNumComponents == 3
      tmp.a = length(tmp.rgb);
    #endif
  #endif

  return tmp;
}

//=======================================================================
// WebGL1 specific version of functions
#else

uniform sampler2D texture1;

uniform float texWidth;
uniform float texHeight;
uniform int xreps;
uniform int xstride;
uniform int ystride;

// if computing trilinear values from multiple z slices
#ifdef vtkTrilinearOn
vec4 getTextureValue(vec3 ijk)
{
  float zoff = 1.0/float(volumeDimensions.z);
  vec4 val1 = getOneTextureValue(ijk);
  vec4 val2 = getOneTextureValue(vec3(ijk.xy, ijk.z + zoff));

  float indexZ = float(volumeDimensions)*ijk.z;
  float zmix =  indexZ - floor(indexZ);

  return mix(val1, val2, zmix);
}

vec4 getOneTextureValue(vec3 ijk)
#else // nearest or fast linear
vec4 getTextureValue(vec3 ijk)
#endif
{
  vec3 tdims = vec3(volumeDimensions);

#ifdef debugtile
  vec2 tpos = vec2(ijk.x, ijk.y);
  vec4 tmp = texture2D(texture1, tpos);
  tmp.a = 1.0;

#else
  int z = int(ijk.z * tdims.z);
  int yz = z / xreps;
  int xz = z - yz*xreps;

  int tileWidth = volumeDimensions.x/xstride;
  int tileHeight = volumeDimensions.y/ystride;

  xz *= tileWidth;
  yz *= tileHeight;

  float ni = float(xz) + (ijk.x*float(tileWidth));
  float nj = float(yz) + (ijk.y*float(tileHeight));

  vec2 tpos = vec2(ni/texWidth, nj/texHeight);

  vec4 tmp = texture2D(texture1, tpos);

#if vtkNumComponents == 1
  tmp.a = tmp.r;
#endif
#if vtkNumComponents == 2
  tmp.g = tmp.a;
#endif
#if vtkNumComponents == 3
  tmp.a = length(tmp.rgb);
#endif
#endif

  return tmp;
}

// End of Webgl1 specific code
//=======================================================================
#endif

//=======================================================================
// transformation between VC and IS space

// convert vector position from idx to vc
#if (vtkLightComplexity > 0) || (defined vtkClippingPlanesOn)
vec3 IStoVC(vec3 posIS){
  vec3 posVC = posIS / vVCToIJK;
  return posVC.x * vPlaneNormal0 +
         posVC.y * vPlaneNormal2 +
         posVC.z * vPlaneNormal4 +
         vOriginVC;
}

// convert vector position from vc to idx
vec3 VCtoIS(vec3 posVC){
  posVC = posVC - vOriginVC;
  posVC = vec3(
    dot(posVC, vPlaneNormal0),
    dot(posVC, vPlaneNormal2),
    dot(posVC, vPlaneNormal4));
  return posVC * vVCToIJK;
}
#endif

//Rotate vector to view coordinate
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
void rotateToViewCoord(inout vec3 dirIS){
  dirIS.xyz =
    dirIS.x * vPlaneNormal0 +
    dirIS.y * vPlaneNormal2 +
    dirIS.z * vPlaneNormal4;
}

//Rotate vector to idx coordinate
vec3 rotateToIDX(vec3 dirVC){
  vec3 dirIS;
  dirIS.xyz = vec3(
    dot(dirVC, vPlaneNormal0),
    dot(dirVC, vPlaneNormal2),
    dot(dirVC, vPlaneNormal4));
  return dirIS;
}
#endif

//=======================================================================
// Given a normal compute the gradient opacity factors
float computeGradientOpacityFactor(
  float normalMag, float goscale, float goshift, float gomin, float gomax)
{
  return clamp(normalMag * goscale + goshift, gomin, gomax);
}

//=======================================================================
// compute the normal and gradient magnitude for a position, uses forward difference
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
  #ifdef vtkClippingPlanesOn
    void adjustClippedVoxelValues(vec3 pos, vec3 texPos[3], inout vec3 g1)
    {
      vec3 g1VC[3];
      for (int i = 0; i < 3; ++i)
      {
        g1VC[i] = IStoVC(texPos[i]);
      }
      vec3 posVC = IStoVC(pos);
      for (int i = 0; i < clip_numPlanes; ++i)
      {
        for (int j = 0; j < 3; ++j)
        {
          if(dot(vec3(vClipPlaneOrigins[i] - g1VC[j].xyz), vClipPlaneNormals[i]) > 0.0)
          {
            g1[j] = 0.0;
          }
        }
      }
    }
  #endif

  #ifdef vtkComputeNormalFromOpacity
    vec4 computeDensityNormal(vec3 opacityUCoords[2], float opactityTextureHeight, float gradientOpacity) {
      vec3 opacityG1, opacityG2;
      opacityG1.x = texture2D(otexture, vec2(opacityUCoords[0].x, opactityTextureHeight)).r;
      opacityG1.y = texture2D(otexture, vec2(opacityUCoords[0].y, opactityTextureHeight)).r;
      opacityG1.z = texture2D(otexture, vec2(opacityUCoords[0].z, opactityTextureHeight)).r;
      opacityG2.x = texture2D(otexture, vec2(opacityUCoords[1].x, opactityTextureHeight)).r;
      opacityG2.y = texture2D(otexture, vec2(opacityUCoords[1].y, opactityTextureHeight)).r;
      opacityG2.z = texture2D(otexture, vec2(opacityUCoords[1].z, opactityTextureHeight)).r;
      opacityG1.xyz *= gradientOpacity;
      opacityG2.xyz *= gradientOpacity;

      vec4 opacityG = vec4(opacityG1 - opacityG2, 1.0f);
      // divide by spacing
      opacityG.xyz /= vSpacing;
      opacityG.w = length(opacityG.xyz);
      // rotate to View Coords
      rotateToViewCoord(opacityG.xyz);
      if (!all(equal(opacityG.xyz, vec3(0.0)))) {
        return vec4(normalize(opacityG.xyz),opacityG.w);
      } else {
        return vec4(0.0);
      }
    }

    vec4 computeNormalForDensity(vec3 pos, vec3 tstep, out vec3 scalarInterp[2], const int opacityComponent)
    {
      vec3 xvec = vec3(tstep.x, 0.0, 0.0);
      vec3 yvec = vec3(0.0, tstep.y, 0.0);
      vec3 zvec = vec3(0.0, 0.0, tstep.z);
      vec3 texPosPVec[3];
      texPosPVec[0] = pos + xvec;
      texPosPVec[1] = pos + yvec;
      texPosPVec[2] = pos + zvec;
      vec3 texPosNVec[3];
      texPosNVec[0] = pos - xvec;
      texPosNVec[1] = pos - yvec;
      texPosNVec[2] = pos - zvec;
      vec3 g1, g2;

      scalarInterp[0].x = getTextureValue(texPosPVec[0])[opacityComponent];
      scalarInterp[0].y = getTextureValue(texPosPVec[1])[opacityComponent];
      scalarInterp[0].z = getTextureValue(texPosPVec[2])[opacityComponent];
      scalarInterp[1].x = getTextureValue(texPosNVec[0])[opacityComponent];
      scalarInterp[1].y = getTextureValue(texPosNVec[1])[opacityComponent];
      scalarInterp[1].z = getTextureValue(texPosNVec[2])[opacityComponent];

      #ifdef vtkClippingPlanesOn
        adjustClippedVoxelValues(pos, texPosPVec, scalarInterp[0]);
        adjustClippedVoxelValues(pos, texPosNVec, scalarInterp[1]);
      #endif
      vec4 result;
      result.x = scalarInterp[0].x - scalarInterp[1].x;
      result.y = scalarInterp[0].y - scalarInterp[1].y;
      result.z = scalarInterp[0].z - scalarInterp[1].z;
      // divide by spacing
      result.xyz /= vSpacing;
      result.w = length(result.xyz);
      // rotate to View Coords
      rotateToViewCoord(result.xyz);
      if (length(result.xyz) > 0.0) {
        return vec4(normalize(result.xyz),result.w);
      } else {
        return vec4(0.0);
      }
    }
  #endif

  // only works with dependent components
  vec4 computeNormal(vec3 pos, vec3 tstep)
  {
    vec3 xvec = vec3(tstep.x, 0.0, 0.0);
    vec3 yvec = vec3(0.0, tstep.y, 0.0);
    vec3 zvec = vec3(0.0, 0.0, tstep.z);
    vec3 texPosPVec[3];
    texPosPVec[0] = pos + xvec;
    texPosPVec[1] = pos + yvec;
    texPosPVec[2] = pos + zvec;
    vec3 texPosNVec[3];
    texPosNVec[0] = pos - xvec;
    texPosNVec[1] = pos - yvec;
    texPosNVec[2] = pos - zvec;
    vec3 g1, g2;
    g1.x = getTextureValue(texPosPVec[0]).a;
    g1.y = getTextureValue(texPosPVec[1]).a;
    g1.z = getTextureValue(texPosPVec[2]).a;
    g2.x = getTextureValue(texPosNVec[0]).a;
    g2.y = getTextureValue(texPosNVec[1]).a;
    g2.z = getTextureValue(texPosNVec[2]).a;
    #ifdef vtkClippingPlanesOn
      adjustClippedVoxelValues(pos, texPosPVec, g1);
      adjustClippedVoxelValues(pos, texPosNVec, g2);
    #endif
    vec4 result;
    result = vec4(g1 - g2, -1.0);
    // divide by spacing
    result.xyz /= vSpacing;
    result.w = length(result.xyz);
    if (result.w > 0.0){
      // rotate to View Coords
      rotateToViewCoord(result.xyz);
      return vec4(normalize(result.xyz),result.w);
    } else {
      return vec4(0.0);
    }
  }
#endif


#ifdef vtkImageLabelOutlineOn
  vec4 fragCoordToPCPos(vec4 fragCoord) {
    return vec4(
      (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,
      (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,
      (fragCoord.z - 0.5) * 2.0,
      1.0);
  }

  vec4 pcPosToWorldCoord(vec4 pcPos) {
    return PCWCMatrix * pcPos;
  }

  vec3 fragCoordToIndexSpace(vec4 fragCoord) {
    vec4 pcPos = fragCoordToPCPos(fragCoord);
    vec4 worldCoord = pcPosToWorldCoord(pcPos);
    vec4 vertex = (worldCoord / worldCoord.w);

    vec3 index = (vWCtoIDX * vertex).xyz;

    // half voxel fix for labelmapOutline
    return (index + vec3(0.5)) / vec3(volumeDimensions);
  }

  vec3 fragCoordToWorld(vec4 fragCoord) {
    vec4 pcPos = fragCoordToPCPos(fragCoord);
    vec4 worldCoord = pcPosToWorldCoord(pcPos);
    return worldCoord.xyz;
  }
#endif

//=======================================================================
// compute the normals and gradient magnitudes for a position
// for independent components
mat4 computeMat4Normal(vec3 pos, vec4 tValue, vec3 tstep)
{
  mat4 result;
  vec4 distX = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)) - tValue;
  vec4 distY = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)) - tValue;
  vec4 distZ = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)) - tValue;

  // divide by spacing
  distX /= vSpacing.x;
  distY /= vSpacing.y;
  distZ /= vSpacing.z;

  mat3 rot;
  rot[0] = vPlaneNormal0;
  rot[1] = vPlaneNormal2;
  rot[2] = vPlaneNormal4;

#if !defined(vtkComponent0Proportional)
  result[0].xyz = vec3(distX.r, distY.r, distZ.r);
  result[0].a = length(result[0].xyz);
  result[0].xyz *= rot;
  if (result[0].w > 0.0)
  {
    result[0].xyz /= result[0].w;
  }
#endif

// optionally compute the 2nd component
#if vtkNumComponents >= 2 && !defined(vtkComponent1Proportional)
  result[1].xyz = vec3(distX.g, distY.g, distZ.g);
  result[1].a = length(result[1].xyz);
  result[1].xyz *= rot;
  if (result[1].w > 0.0)
  {
    result[1].xyz /= result[1].w;
  }
#endif

// optionally compute the 3rd component
#if vtkNumComponents >= 3 && !defined(vtkComponent2Proportional)
  result[2].xyz = vec3(distX.b, distY.b, distZ.b);
  result[2].a = length(result[2].xyz);
  result[2].xyz *= rot;
  if (result[2].w > 0.0)
  {
    result[2].xyz /= result[2].w;
  }
#endif

// optionally compute the 4th component
#if vtkNumComponents >= 4 && !defined(vtkComponent3Proportional)
  result[3].xyz = vec3(distX.a, distY.a, distZ.a);
  result[3].a = length(result[3].xyz);
  result[3].xyz *= rot;
  if (result[3].w > 0.0)
  {
    result[3].xyz /= result[3].w;
  }
#endif

  return result;
}

//=======================================================================
// global shadow - secondary ray
#if defined(VolumeShadowOn) || defined(localAmbientOcclusionOn)
float random()
{
  float rand = fract(sin(dot(gl_FragCoord.xy,vec2(12.9898,78.233)))*43758.5453123);
  float jitter=texture2D(jtexture,gl_FragCoord.xy/32.).r;
  uint pcg_state = floatBitsToUint(jitter);
  uint state = pcg_state;
  pcg_state = pcg_state * uint(747796405) + uint(2891336453);
  uint word = ((state >> ((state >> uint(28)) + uint(4))) ^ state) * uint(277803737);
  return (float((((word >> uint(22)) ^ word) >> 1 ))/float(2147483647) + rand)/2.0;
}
#endif

#ifdef VolumeShadowOn
// henyey greenstein phase function
float phase_function(float cos_angle)
{
  // divide by 2.0 instead of 4pi to increase intensity
  return ((1.0-anisotropy2)/pow(1.0+anisotropy2-2.0*anisotropy*cos_angle, 1.5))/2.0;
}

// Computes the intersection between a ray and a box
struct Hit
{
  float tmin;
  float tmax;
};

struct Ray
{
  vec3 origin;
  vec3 dir;
  vec3 invDir;
};

bool BBoxIntersect(vec3 boundMin, vec3 boundMax, const Ray r, out Hit hit)
{
  vec3 tbot = r.invDir * (boundMin - r.origin);
  vec3 ttop = r.invDir * (boundMax - r.origin);
  vec3 tmin = min(ttop, tbot);
  vec3 tmax = max(ttop, tbot);
  vec2 t = max(tmin.xx, tmin.yz);
  float t0 = max(t.x, t.y);
  t = min(tmax.xx, tmax.yz);
  float t1 = min(t.x, t.y);
  hit.tmin = t0;
  hit.tmax = t1;
  return t1 > max(t0,0.0);
}

// As BBoxIntersect requires the inverse of the ray coords,
// this function is used to avoid numerical issues
void safe_0_vector(inout Ray ray)
{
  if(abs(ray.dir.x) < EPSILON) ray.dir.x = sign(ray.dir.x) * EPSILON;
  if(abs(ray.dir.y) < EPSILON) ray.dir.y = sign(ray.dir.y) * EPSILON;
  if(abs(ray.dir.z) < EPSILON) ray.dir.z = sign(ray.dir.z) * EPSILON;
}

float volume_shadow(vec3 posIS, vec3 lightDirNormIS)
{
  float shadow = 1.0;
  float opacity = 0.0;

  // modify sample distance with a random number between 1.5 and 3.0
  float sampleDistanceISVS_jitter = sampleDistanceISVS * mix(1.5, 3.0, random());
  float opacityPrev = texture2D(otexture, vec2(getTextureValue(posIS).r * oscale0 + oshift0, 0.5)).r;

  // in case the first sample near surface has a very tiled light ray, we need to offset start position
  posIS += sampleDistanceISVS_jitter * lightDirNormIS;

  // compute the start and end points for the ray
  Ray ray;
  Hit hit;
  ray.origin = posIS;
  ray.dir = lightDirNormIS;
  safe_0_vector(ray);
  ray.invDir = 1.0/ray.dir;

  if(!BBoxIntersect(vec3(0.0),vec3(1.0), ray, hit))
  {
    return 1.0;
  }
  float maxdist = hit.tmax;

  // interpolate shadow ray length between: 1 unit of sample distance in IS to SQRT3, based on globalIlluminationReach
  float maxgi = mix(sampleDistanceISVS_jitter,SQRT3,giReach);
  maxdist = min(maxdist,maxgi);
  if(maxdist < EPSILON) {
    return 1.0;
  }

  float current_dist = 0.0;
  float current_step = length(sampleDistanceISVS_jitter * lightDirNormIS);
  float clamped_step = 0.0;

  vec4 scalar = vec4(0.0);
  while(current_dist < maxdist)
  {
#ifdef vtkClippingPlanesOn
    vec3 posVC = IStoVC(posIS);
    for (int i = 0; i < clip_numPlanes; ++i)
    {
      if (dot(vec3(vClipPlaneOrigins[i] - posVC), vClipPlaneNormals[i]) > 0.0)
      {
        current_dist = maxdist;
      }
    }
#endif
    scalar = getTextureValue(posIS);
    opacity = texture2D(otexture, vec2(scalar.r * oscale0 + oshift0, 0.5)).r;
    #if defined(vtkGradientOpacityOn) && !defined(UseIndependentComponents)
      vec4 normal = computeNormal(posIS, vec3(1.0/vec3(volumeDimensions)));
      opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
    #endif
    shadow *= 1.0 - opacity;

    // optimization: early termination
    if (shadow < EPSILON){
      return 0.0;
    }

    clamped_step = min(maxdist - current_dist, current_step);
    posIS += clamped_step * lightDirNormIS;
    current_dist += current_step;
  }

  return shadow;
}

vec3 applyShadowRay(vec3 tColor, vec3 posIS, vec3 viewDirectionVC)
{
  vec3 vertLight = vec3(0.0);
  vec3 secondary_contrib = vec3(0.0);
  // here we assume only positional light, no effect of cones
  for (int i = 0; i < lightNum; i++)
  {
    #if(vtkLightComplexity==3)
      if (lightPositional[i] == 1){
        vertLight = lightPositionVC[i] - IStoVC(posIS);
      }else{
        vertLight = - lightDirectionVC[i];
      }
    #else
      vertLight = - lightDirectionVC[i];
    #endif
    // here we assume achromatic light, only intensity
    float dDotL = dot(viewDirectionVC, normalize(vertLight));
    // isotropic scatter returns 0.5 instead of 1/4pi to increase intensity
    float phase_attenuation = 0.5;
    if (abs(anisotropy) > EPSILON){
      phase_attenuation = phase_function(dDotL);
    }
    float vol_shadow = volume_shadow(posIS, normalize(rotateToIDX(vertLight)));
    secondary_contrib += tColor * vDiffuse * lightColor[i] * vol_shadow * phase_attenuation;
    secondary_contrib += tColor * vAmbient;
  }
  return secondary_contrib;
}
#endif

//=======================================================================
// local ambient occlusion
#ifdef localAmbientOcclusionOn
vec3 sample_direction_uniform(int i)
{
  float rand = random() * 0.5;
  float theta = PI2 * (kernelSample[i][0] + rand);
  float phi = acos(2.0 * (kernelSample[i][1] + rand) -1.0) / 2.5;
  return normalize(vec3(cos(theta)*sin(phi), sin(theta)*sin(phi), cos(phi)));
}

// return a matrix that transform startDir into z axis; startDir should be normalized
mat3 zBaseRotationalMatrix(vec3 startDir){
  vec3 axis = cross(startDir, vec3(0.0,0.0,1.0));
  float cosA = startDir.z;
  float k = 1.0 / (1.0 + cosA);
  mat3 matrix = mat3((axis.x * axis.x * k) + cosA, (axis.y * axis.x * k) - axis.z, (axis.z * axis.x * k) + axis.y,
              (axis.x * axis.y * k) + axis.z, (axis.y * axis.y * k) + cosA, (axis.z * axis.y * k) - axis.x,
              (axis.x * axis.z * k) - axis.y, (axis.y * axis.z * k) + axis.x, (axis.z * axis.z * k) + cosA);
  return matrix;
}

float computeLAO(vec3 posIS, float op, vec3 lightDir, vec4 normal){
  // apply LAO only at selected locations, otherwise return full brightness
  if (normal.w > 0.0 && op > 0.05){
    float total_transmittance = 0.0;
    mat3 inverseRotateBasis = inverse(zBaseRotationalMatrix(normalize(-normal.xyz)));
    vec3 currPos, randomDirStep;
    float weight, transmittance, opacity;
    for (int i = 0; i < kernelSize; i++)
    {
      randomDirStep = inverseRotateBasis * sample_direction_uniform(i) * sampleDistanceIS;
      weight = 1.0 - dot(normalize(lightDir), normalize(randomDirStep));
      currPos = posIS;
      transmittance = 1.0;
      for (int j = 0; j < kernelRadius ; j++){
        currPos += randomDirStep;
        // check if it's at clipping plane, if so return full brightness
        if (all(greaterThan(currPos, vec3(EPSILON))) && all(lessThan(currPos,vec3(1.0-EPSILON)))){
          opacity = texture2D(otexture, vec2(getTextureValue(currPos).r * oscale0 + oshift0, 0.5)).r;
          #ifdef vtkGradientOpacityOn
             opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
          #endif
          transmittance *= 1.0 - opacity;
        }
        else{
          break;
        }
      }
      total_transmittance += transmittance / float(kernelRadius) * weight;

      // early termination if fully translucent
      if (total_transmittance > 1.0 - EPSILON){
        return 1.0;
      }
    }
    // average transmittance and reduce variance
    return clamp(total_transmittance / float(kernelSize), 0.3, 1.0);
  } else {
    return 1.0;
  }
}
#endif

//=======================================================================
// surface light contribution
#if vtkLightComplexity > 0
  void applyLighting(inout vec3 tColor, vec4 normal)
  {
    vec3 diffuse = vec3(0.0, 0.0, 0.0);
    vec3 specular = vec3(0.0, 0.0, 0.0);
    float df, sf = 0.0;
    for (int i = 0; i < lightNum; i++){
        df = abs(dot(normal.rgb, -lightDirectionVC[i]));
        diffuse += df * lightColor[i];
        sf = pow( abs(dot(lightHalfAngleVC[i],normal.rgb)), vSpecularPower);
        specular += sf * lightColor[i];
    }
    tColor.rgb = tColor.rgb*(diffuse*vDiffuse + vAmbient) + specular*vSpecular;
  }
  #ifdef SurfaceShadowOn
  #if vtkLightComplexity < 3
    vec3 applyLightingDirectional(vec3 posIS, vec4 tColor, vec4 normal)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float ndotL,vdotR;
        vertLightDirection = lightDirectionVC[i];
        ndotL = dot(normal.xyz, vertLightDirection);
        if (ndotL < 0.0 && twoSidedLighting)
        {
          ndotL = -ndotL;
        }
        if (ndotL > 0.0)
        {
          diffuse += ndotL * lightColor[i];
          //specular
          vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
          if (vdotR > 0.0)
          {
            specular += pow(vdotR, vSpecularPower) * lightColor[i];
          }
        }
        #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
        #endif
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #else
    vec3 applyLightingPositional(vec3 posIS, vec4 tColor, vec4 normal, vec3 posVC)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float distance,attenuation,ndotL,vdotR;
        vec3 lightDir;
        if (lightPositional[i] == 1){
          lightDir = lightDirectionVC[i];
          vertLightDirection = posVC - lightPositionVC[i];
          distance = length(vertLightDirection);
          vertLightDirection = normalize(vertLightDirection);
          attenuation = 1.0 / (lightAttenuation[i].x
                              + lightAttenuation[i].y * distance
                              + lightAttenuation[i].z * distance * distance);
          // per OpenGL standard cone angle is 90 or less for a spot light
          if (lightConeAngle[i] <= 90.0){
            float coneDot = dot(vertLightDirection, lightDir);
            if (coneDot >= cos(radians(lightConeAngle[i]))){  // if inside cone
              attenuation = attenuation * pow(coneDot, lightExponent[i]);
            }
            else {
              attenuation = 0.0;
            }
          }
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * attenuation * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * attenuation * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        } else {
          vertLightDirection = lightDirectionVC[i];
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        }
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #endif
  #endif
#endif

// LAO of surface shadows and volume shadows only work with dependent components
vec3 applyAllLightning(vec3 tColor, float alpha, vec3 posIS, vec4 normalLight) {
  #if vtkLightComplexity > 0
    // surface shadows if needed
    #ifdef SurfaceShadowOn
      #if vtkLightComplexity < 3
        vec3 tColorS = applyLightingDirectional(posIS, vec4(tColor, alpha), normalLight);
      #else
        vec3 tColorS = applyLightingPositional(posIS, vec4(tColor, alpha), normalLight, IStoVC(posIS));
      #endif
    #endif

    // volume shadows if needed
    #ifdef VolumeShadowOn
      vec3 tColorVS = applyShadowRay(tColor, posIS, rayDirVC);
    #endif

    // merge
    #ifdef VolumeShadowOn
      #ifdef SurfaceShadowOn
        // surface shadows + volumetric shadows
        float vol_coef = volumetricScatteringBlending * (1.0 - alpha / 2.0) * (1.0 - atan(normalLight.w) * INV4PI);
        tColor = (1.0-vol_coef) * tColorS + vol_coef * tColorVS;
      #else
        // volumetric shadows only
        tColor = tColorVS;
      #endif
    #else
      #ifdef SurfaceShadowOn
        // surface shadows only
        tColor = tColorS;
      #else
        // no shadows
        applyLighting(tColor, normal3);
      #endif
    #endif
  #endif
  return tColor;
}

  
vec4 getColorForValue(vec4 tValue, vec3 posIS, vec3 tstep)
{

// If labeloutline and not the edge labelmap, since in the edge labelmap blend
// we need the underlying data to sample through
#if defined(vtkImageLabelOutlineOn) && !defined(vtkLabelEdgeProjectionOn)
  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord); // pos in texture space
  vec4 centerValue = getTextureValue(centerPosIS);
  bool pixelOnBorder = false;
  vec4 tColor = texture2D(ctexture, vec2(centerValue.r * cscale0 + cshift0, 0.5));

  // Get alpha of segment from opacity function.
  tColor.a = texture2D(otexture, vec2(centerValue.r * oscale0 + oshift0, 0.5)).r;

  int segmentIndex = int(centerValue.r * 255.0);
  
  // Use texture sampling for outlineThickness
  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
  float textureValue = texture2D(ttexture, vec2(textureCoordinate, 0.5)).r;

  int actualThickness = int(textureValue * 255.0);


  // If it is the background (segment index 0), we should quickly bail out. 
  // Previously, this was determined by tColor.a, which was incorrect as it
  // prevented the outline from appearing when the fill is 0.
  if (segmentIndex == 0){
    return vec4(0, 0, 0, 0);
  }

  // Only perform outline check on fragments rendering voxels that aren't invisible.
  // Saves a bunch of needless checks on the background.
  // TODO define epsilon when building shader?
  for (int i = -actualThickness; i <= actualThickness; i++) {
    for (int j = -actualThickness; j <= actualThickness; j++) {
      if (i == 0 || j == 0) {
        continue;
      }

      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
        gl_FragCoord.y + float(j),
        gl_FragCoord.z, gl_FragCoord.w);

      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
      vec4 value = getTextureValue(neighborPosIS);

      // If any of my neighbours are not the same value as I
      // am, this means I am on the border of the segment.
      // We can break the loops
      if (any(notEqual(value, centerValue))) {
        pixelOnBorder = true;
        break;
      }
    }

    if (pixelOnBorder == true) {
      break;
    }
  }

  // If I am on the border, I am displayed at full opacity
  if (pixelOnBorder == true) {
    tColor.a = outlineOpacity;
  }

  return tColor;

#else
  // compute the normal and gradient magnitude if needed
  // We compute it as a vec4 if possible otherwise a mat4

  #ifdef UseIndependentComponents

    // sample textures
    vec3 tColor0 = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, height0)).rgb;
    float pwfValue0 = texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, height0)).r;

    #if vtkNumComponents > 1
      vec3 tColor1 = texture2D(ctexture, vec2(tValue.g * cscale1 + cshift1, height1)).rgb;
      float pwfValue1 = texture2D(otexture, vec2(tValue.g * oscale1 + oshift1, height1)).r;

      #if vtkNumComponents > 2
        vec3 tColor2 = texture2D(ctexture, vec2(tValue.b * cscale2 + cshift2, height2)).rgb;
        float pwfValue2 = texture2D(otexture, vec2(tValue.b * oscale2 + oshift2, height2)).r;

        #if vtkNumComponents > 3
          vec3 tColor3 = texture2D(ctexture, vec2(tValue.a * cscale3 + cshift3, height3)).rgb;
          float pwfValue3 = texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, height3)).r;
        #endif
      #endif
    #endif

    #if !defined(vtkCustomComponentsColorMix)
      // default path for component color mix

      // compute the normal vectors as needed
      #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
      #endif

      // compute gradient opacity factors as needed
      vec4 goFactor = vec4(1.0, 1.0 ,1.0 ,1.0);
      #if defined(vtkGradientOpacityOn)
        #if !defined(vtkComponent0Proportional)
          goFactor.x =
            computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
        #endif
        #if vtkNumComponents > 1
          #if !defined(vtkComponent1Proportional)
            goFactor.y =
              computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);
          #endif
          #if vtkNumComponents > 2
            #if !defined(vtkComponent2Proportional)
              goFactor.z =
                computeGradientOpacityFactor(normalMat[2].a, goscale2, goshift2, gomin2, gomax2);
            #endif
            #if vtkNumComponents > 3
              #if !defined(vtkComponent3Proportional)
                goFactor.w =
                  computeGradientOpacityFactor(normalMat[3].a, goscale3, goshift3, gomin3, gomax3);
              #endif
            #endif
          #endif
        #endif
      #endif

      // process color and opacity for each component
      #if !defined(vtkComponent0Proportional)
        float alpha = goFactor.x*mix0*pwfValue0;
        #if vtkLightComplexity > 0
          applyLighting(tColor0, normalMat[0]);
        #endif
      #else
        tColor0 *= pwfValue0;
        float alpha = mix(pwfValue0, 1.0, (1.0 - mix0));
      #endif

      #if vtkNumComponents > 1
        #if !defined(vtkComponent1Proportional)
          alpha += goFactor.y*mix1*pwfValue1;
          #if vtkLightComplexity > 0
            applyLighting(tColor1, normalMat[1]);
          #endif
        #else
          tColor1 *= pwfValue1;
          alpha *= mix(pwfValue1, 1.0, (1.0 - mix1));
        #endif

        #if vtkNumComponents > 2
          #if !defined(vtkComponent2Proportional)
            alpha += goFactor.z*mix2*pwfValue2;
            #if vtkLightComplexity > 0
              applyLighting(tColor2, normalMat[2]);
            #endif
          #else
            tColor2 *= pwfValue2;
            alpha *= mix(pwfValue2, 1.0, (1.0 - mix2));
          #endif
        #endif

        #if vtkNumComponents > 3
          #if !defined(vtkComponent3Proportional)
            alpha += goFactor.w*mix3*pwfValue3;
            #if vtkLightComplexity > 0
              applyLighting(tColor3, normalMat[3]);
            #endif
          #else
            tColor3 *= pwfValue3;
            alpha *= mix(pwfValue3, 1.0, (1.0 - mix3));
          #endif
        #endif
      #endif

      // perform final independent blend
      vec3 tColor = mix0 * tColor0;
      #if vtkNumComponents > 1
        tColor += mix1 * tColor1;
        #if vtkNumComponents > 2
          tColor += mix2 * tColor2;
          #if vtkNumComponents > 3
            tColor += mix3 * tColor3;
          #endif
        #endif
      #endif

      return vec4(tColor, alpha);
    #else
      /*
       * Mix the color information from all the independent components to get a single rgba output
       * Gradient opactity factors and normals are not computed
       *
       * You can compute these using:
       * - computeMat4Normal: always available, compute normal only for non proportional components, used by default independent component mix
       * - computeDensityNormal & computeNormalForDensity: available if ((LightComplexity > 0) || GradientOpacityOn) && ComputeNormalFromOpacity),
       *                                                   used by dependent component color mix, see code for Additive preset in OpenGl/VolumeMapper
       * - computeGradientOpacityFactor: always available, used in a lot of places
       *
       * Using applyAllLightning() is advised for shading but some features don't work well with it (volume shadows, LAO)
       * mix0, mix1, ... are defined for each component that is used and correspond to the componentWeight
       */
      //VTK::CustomComponentsColorMix::Impl
    #endif
  #else
    // dependent components

    // compute normal if needed
    #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
      // use component 3 of the opacity texture as getTextureValue() sets alpha to the opacity value
      #ifdef vtkComputeNormalFromOpacity
        vec3 scalarInterp[2];
        vec4 normal0 = computeNormalForDensity(posIS, tstep, scalarInterp, 3);
      #else
        vec4 normal0 = computeNormal(posIS, tstep);
      #endif
    #endif

    // compute gradient opacity factor enabled
    #if defined(vtkGradientOpacityOn)
      float gradientOpacity = computeGradientOpacityFactor(normal0.a, goscale0, goshift0, gomin0, gomax0);
    #else
      const float gradientOpacity = 1.0;
    #endif

    // get color and opacity
    #if vtkNumComponents == 1
      vec3 tColor = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, 0.5)).rgb;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
      if (alpha < EPSILON){
        return vec4(0.0);
      }
    #endif
    #if vtkNumComponents == 2
      vec3 tColor = vec3(tValue.r * cscale0 + cshift0);
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale1 + oshift1, 0.5)).r;
    #endif
    #if vtkNumComponents == 3
      vec3 tColor;
      tColor.r = tValue.r * cscale0 + cshift0;
      tColor.g = tValue.g * cscale1 + cshift1;
      tColor.b = tValue.b * cscale2 + cshift2;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale0 + oshift0, 0.5)).r;
    #endif
    #if vtkNumComponents == 4
      vec3 tColor;
      tColor.r = tValue.r * cscale0 + cshift0;
      tColor.g = tValue.g * cscale1 + cshift1;
      tColor.b = tValue.b * cscale2 + cshift2;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, 0.5)).r;
    #endif

    // lighting
    #if (vtkLightComplexity > 0)
      #ifdef vtkComputeNormalFromOpacity
        vec4 normalLight;
        if (!all(equal(normal0, vec4(0.0)))) {
          scalarInterp[0] = scalarInterp[0] * oscale0 + oshift0;
          scalarInterp[1] = scalarInterp[1] * oscale0 + oshift0;
          normalLight = computeDensityNormal(scalarInterp, 0.5, gradientOpacity);
          if (all(equal(normalLight, vec4(0.0)))) {
            normalLight = normal0;
          }
        }
      #else
        vec4 normalLight = normal0;
      #endif
      tColor = applyAllLightning(tColor, alpha, posIS, normalLight);
    #endif

    return vec4(tColor, alpha);
  #endif // dependent
#endif
}

bool valueWithinScalarRange(vec4 val, vec4 min, vec4 max) {
  bool withinRange = false;
  #if vtkNumComponents == 1
    if (val.r >= min.r && val.r <= max.r) {
      withinRange = true;
    }
  #else
    #ifdef UseIndependentComponents
      #if vtkNumComponents == 2
        if (val.r >= min.r && val.r <= max.r &&
            val.g >= min.g && val.g <= max.g) {
          withinRange = true;
        }
      #else
        if (all(greaterThanEqual(val, ipScalarRangeMin)) &&
            all(lessThanEqual(val, ipScalarRangeMax))) {
          withinRange = true;
        }
      #endif
    #endif
  #endif
  return withinRange;
}

#if vtkBlendMode == 6 
bool checkOnEdgeForNeighbor(int i, int j, int s, vec3 stepIS) {
    vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i), gl_FragCoord.y + float(j), gl_FragCoord.z, gl_FragCoord.w);
    vec3 originalNeighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);

    bool justSawIt = false;

    vec3 neighborPosIS = originalNeighborPosIS;

    float stepsTraveled = 0.0;


    // float neighborValue;
    for (int k = 0; k < //VTK::MaximumSamplesValue /2 ; ++k) {
        ivec3 texCoord = ivec3(neighborPosIS * vec3(volumeDimensions));
        vec4 texValue = texelFetch(texture1, texCoord, 0);

        if (int(texValue.g) == s) {
            justSawIt = true;
            break;
        }
        neighborPosIS += stepIS;
    }

    if (justSawIt){
      return false;
    }

   
    neighborPosIS = originalNeighborPosIS;
    for (int k = 0; k < //VTK::MaximumSamplesValue /2 ; ++k) {
        ivec3 texCoord = ivec3(neighborPosIS * vec3(volumeDimensions));
        vec4 texValue = texelFetch(texture1, texCoord, 0);

        if (int(texValue.g) == s) {
            justSawIt = true;
            break;
        }
        neighborPosIS -= stepIS;
    }


    if (!justSawIt) {
        // onedge
        vec3 tColorSegment = texture2D(ctexture, vec2(float(s) * cscale1 + cshift1, height1)).rgb;
        float pwfValueSegment = texture2D(otexture, vec2(float(s) * oscale1 + oshift1, height1)).r;
        gl_FragData[0] = vec4(tColorSegment, pwfValueSegment);
        return true;
    }

    // not on edge
    return false;
}

#endif


//=======================================================================
// Apply the specified blend mode operation along the ray's path.
//
void applyBlend(vec3 posIS, vec3 endIS, vec3 tdims)
{
  vec3 tstep = 1.0/tdims;

  // start slightly inside and apply some jitter
  vec3 delta = endIS - posIS;
  vec3 stepIS = normalize(delta)*sampleDistanceIS;
  float raySteps = length(delta)/sampleDistanceIS;

  // Initialize arrays to false
  // avoid 0.0 jitter
  float jitter = 0.01 + 0.99*texture2D(jtexture, gl_FragCoord.xy/32.0).r;
  float stepsTraveled = jitter;

  // local vars for the loop
  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);
  vec4 tValue;
  vec4 tColor;

  // if we have less than one step then pick the middle point
  // as our value
  // if (raySteps <= 1.0)
  // {
  //   posIS = (posIS + endIS)*0.5;
  // }

  // Perform initial step at the volume boundary
  // compute the scalar
  tValue = getTextureValue(posIS);
  
  #if vtkBlendMode == 6 
    if (raySteps <= 1.0)
    {
      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);
      return;
    }

    vec4 value = tValue;
    posIS += (jitter*stepIS);
    vec3 maxPosIS = posIS; // Store the position of the max value
    int segmentIndex = int(value.g);
    bool originalPosHasSeenNonZero = false;

    uint bitmask = 0u;

    if (segmentIndex != 0) {
      // Tried using the segment index in an boolean array but reading 
      // from the array by dynamic indexing was horrondously slow
      // so use bit masking instead and assign 1 to the bit corresponding to the segment index
      // and later check if the bit is set via bit operations
      setBit(segmentIndex);
    }
    
    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);
      segmentIndex = int(tValue.g);

      if (segmentIndex != 0) {
        originalPosHasSeenNonZero = true;
        setBit(segmentIndex);
      }

      if (tValue.r > value.r) {
        value =  tValue; // Update the max value
        maxPosIS = posIS; // Update the position where max occurred
      }

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;
    tValue = getTextureValue(posIS);

    if (tValue.r > value.r) {
      value = tValue; // Update the max value
      maxPosIS = posIS; // Update the position where max occurred
    }  

    // If we have not seen any non-zero segments, we can return early
    // and grab color from the actual center value first component (image)
    if (!originalPosHasSeenNonZero) {
      gl_FragData[0] = getColorForValue(value, maxPosIS, tstep);
      return;
    }

    // probably we can make this configurable but for now we will use the same
    // sample distance as the original sample distance
    float neighborSampleDistanceIS = sampleDistanceIS;

    vec3 neighborRayStepsIS = stepIS;
    float neighborRaySteps = raySteps;
    bool shouldLookInAllNeighbors = false;

    float minVoxelSpacing = min(volumeSpacings[0], min(volumeSpacings[1], volumeSpacings[2]));
    vec4 base = vec4(gl_FragCoord.x, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);

    vec4 baseXPlus = vec4(gl_FragCoord.x + 1.0, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);
    vec4 baseYPlus = vec4(gl_FragCoord.x, gl_FragCoord.y + 1.0, gl_FragCoord.z, gl_FragCoord.w);

    vec3 baseWorld = fragCoordToWorld(base);
    vec3 baseXPlusWorld = fragCoordToWorld(baseXPlus);
    vec3 baseYPlusWorld = fragCoordToWorld(baseYPlus);

    float XPlusDiff = length(baseXPlusWorld - baseWorld);
    float YPlusDiff = length(baseYPlusWorld - baseWorld);

    float minFragSpacingWorld = min(XPlusDiff, YPlusDiff);

    for (int s = 1; s < MAX_SEGMENT_INDEX; s++) {
      // bail out quickly if the segment index has not 
      // been seen by the center segment
      if (!isBitSet(s)) {
       continue;
      }

      // Use texture sampling for outlineThickness so that we can have 
      // per segment thickness
      float textureCoordinate = float(s - 1) / 1024.0;
      float textureValue = texture2D(ttexture, vec2(textureCoordinate, 0.5)).r;

      int actualThickness = int(textureValue * 255.0);

      // check the extreme points in the neighborhood since there is a better
      // chance of finding the edge there, so that we can bail out 
      // faster if we find the edge
      bool onEdge =
          checkOnEdgeForNeighbor(-actualThickness, -actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(actualThickness, actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(actualThickness, -actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(-actualThickness, +actualThickness, s, stepIS);

      if (onEdge) {
        return;
      }

      // since the next step is computationally expensive, we need to perform
      // some optimizations to avoid it if possible. One of the optimizations
      // is to check the whether the minimum of the voxel spacing is greater than 
      // the 2 * the thickness of the outline segment. If that is the case
      // then we can safely skip the next step since we can be sure that the
      // the previous 4 checks on the extreme points would caught the entirety 
      // of the all the fragments inside. i.e., this happens when we zoom out, 
      if (minVoxelSpacing > (2.0 * float(actualThickness) - 1.0) * minFragSpacingWorld) {
        continue;
      }
      
      // Loop through the rest, skipping the processed extremes and the center
      for (int i = -actualThickness; i <= actualThickness; i++) {
            for (int j = -actualThickness; j <= actualThickness; j++) {
                if (i == 0 && j == 0) continue; // Skip the center
                if (abs(i) == actualThickness && abs(j) == actualThickness) continue; // Skip corners
                if (checkOnEdgeForNeighbor(i, j, s, stepIS )) {
                    return;
                }
          }
      }
    }

    vec3 tColor0 = texture2D(ctexture, vec2(value.r * cscale0 + cshift0, height0)).rgb;
    float pwfValue0 = texture2D(otexture, vec2(value.r * oscale0 + oshift0, height0)).r;
    gl_FragData[0] = vec4(tColor0, pwfValue0);
  #endif
  #if vtkBlendMode == 0 // COMPOSITE_BLEND
    // now map through opacity and color
    tColor = getColorForValue(tValue, posIS, tstep);

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps);
      gl_FragData[0] = tColor;
      return;
    }

    tColor.a = 1.0 - pow(1.0 - tColor.a, jitter);
    color = vec4(tColor.rgb*tColor.a, tColor.a);
    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);

      float mix = (1.0 - color.a);

      // this line should not be needed but nvidia seems to not handle
      // the break correctly on windows/chrome 58 angle
      //mix = mix * sign(max(raySteps - stepsTraveled - 1.0, 0.0));

      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
      stepsTraveled++;
      posIS += stepIS;
      if (color.a > 0.99) { color.a = 1.0; break; }
    }

    if (color.a < 0.99 && (raySteps - stepsTraveled) > 0.0)
    {
      posIS = endIS;

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps - stepsTraveled);

      float mix = (1.0 - color.a);
      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
    }

    gl_FragData[0] = vec4(color.rgb/color.a, color.a);
  #endif
  #if vtkBlendMode == 1 || vtkBlendMode == 2
    // MAXIMUM_INTENSITY_BLEND || MINIMUM_INTENSITY_BLEND
    // Find maximum/minimum intensity along the ray.

    // Define the operation we will use (min or max)
    #if vtkBlendMode == 1
    #define OP max
    #else
    #define OP min
    #endif

    // If the clipping range is shorter than the sample distance
    // we can skip the sampling loop along the ray.
    if (raySteps <= 1.0)
    {
      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);
      return;
    }

    vec4 value = tValue;
    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // Update the maximum value if necessary
      value = OP(tValue, value);

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;
    tValue = getTextureValue(posIS);
    value = OP(tValue, value);

    // Now map through opacity and color
    gl_FragData[0] = getColorForValue(value, posIS, tstep);
  #endif
  #if vtkBlendMode == 3 || vtkBlendMode == 4 //AVERAGE_INTENSITY_BLEND || ADDITIVE_BLEND
    vec4 sum = vec4(0.);

    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;
    }

    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(sum, posIS, tstep);
      return;
    }

    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // One can control the scalar range by setting the AverageIPScalarRange to disregard scalar values, not in the range of interest, from the average computation.
      // Notes:
      // - We are comparing all values in the texture to see if any of them
      //   are outside of the scalar range. In the future we might want to allow
      //   scalar ranges for each component.
      if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
        // Sum the values across each step in the path
        sum += tValue;
      }
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;

    // compute the scalar
    tValue = getTextureValue(posIS);

    // One can control the scalar range by setting the IPScalarRange to disregard scalar values, not in the range of interest, from the average computation
    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;

      stepsTraveled++;
    }

    #if vtkBlendMode == 3 // Average
      sum /= vec4(stepsTraveled, stepsTraveled, stepsTraveled, 1.0);
    #endif

    gl_FragData[0] = getColorForValue(sum, posIS, tstep);
  #endif
  #if vtkBlendMode == 5 // RADON
    float normalizedRayIntensity = 1.0;

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tValue = getTextureValue(posIS);
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
      gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity, 0.5));
      return;
    }

    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar value
      tValue = getTextureValue(posIS);

      // Convert scalar value to normalizedRayIntensity coefficient and accumulate normalizedRayIntensity
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;

      posIS += stepIS;
      stepsTraveled++;
    }

    // map normalizedRayIntensity to color
    gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity , 0.5));

  #endif
}

//=======================================================================
// Compute a new start and end point for a given ray based
// on the provided bounded clipping plane (aka a rectangle)
void getRayPointIntersectionBounds(
  vec3 rayPos, vec3 rayDir,
  vec3 planeDir, float planeDist,
  inout vec2 tbounds, vec3 vPlaneX, vec3 vPlaneY,
  float vSize1, float vSize2)
{
  float result = dot(rayDir, planeDir);
  if (abs(result) < 1e-6)
  {
    return;
  }
  result = -1.0 * (dot(rayPos, planeDir) + planeDist) / result;
  vec3 xposVC = rayPos + rayDir*result;
  vec3 vxpos = xposVC - vOriginVC;
  vec2 vpos = vec2(
    dot(vxpos, vPlaneX),
    dot(vxpos, vPlaneY));

  // on some apple nvidia systems this does not work
  // if (vpos.x < 0.0 || vpos.x > vSize1 ||
  //     vpos.y < 0.0 || vpos.y > vSize2)
  // even just
  // if (vpos.x < 0.0 || vpos.y < 0.0)
  // fails
  // so instead we compute a value that represents in and out
  //and then compute the return using this value
  float xcheck = max(0.0, vpos.x * (vpos.x - vSize1)); //  0 means in bounds
  float check = sign(max(xcheck, vpos.y * (vpos.y - vSize2))); //  0 means in bounds, 1 = out

  tbounds = mix(
   vec2(min(tbounds.x, result), max(tbounds.y, result)), // in value
   tbounds, // out value
   check);  // 0 in 1 out
}

//=======================================================================
// given a
// - ray direction (rayDir)
// - starting point (vertexVCVSOutput)
// - bounding planes of the volume
// - optionally depth buffer values
// - far clipping plane
// compute the start/end distances of the ray we need to cast
vec2 computeRayDistances(vec3 rayDir, vec3 tdims)
{
  vec2 dists = vec2(100.0*camFar, -1.0);

  vec3 vSize = vSpacing*tdims;

  // all this is in View Coordinates
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal0, vPlaneDistance0, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal1, vPlaneDistance1, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal2, vPlaneDistance2, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal3, vPlaneDistance3, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal4, vPlaneDistance4, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal5, vPlaneDistance5, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);

  //VTK::ClipPlane::Impl

  // do not go behind front clipping plane
  dists.x = max(0.0,dists.x);

  // do not go PAST far clipping plane
  float farDist = -camThick/rayDir.z;
  dists.y = min(farDist,dists.y);

  // Do not go past the zbuffer value if set
  // This is used for intermixing opaque geometry
  //VTK::ZBuffer::Impl

  return dists;
}

//=======================================================================
// Compute the index space starting position (pos) and end
// position
//
void computeIndexSpaceValues(out vec3 pos, out vec3 endPos, vec3 rayDir, vec2 dists)
{
  // compute starting and ending values in volume space
  pos = vertexVCVSOutput + dists.x*rayDir;
  pos = pos - vOriginVC;
  // convert to volume basis and origin
  pos = vec3(
    dot(pos, vPlaneNormal0),
    dot(pos, vPlaneNormal2),
    dot(pos, vPlaneNormal4));

  endPos = vertexVCVSOutput + dists.y*rayDir;
  endPos = endPos - vOriginVC;
  endPos = vec3(
    dot(endPos, vPlaneNormal0),
    dot(endPos, vPlaneNormal2),
    dot(endPos, vPlaneNormal4));

  float delta = length(endPos - pos);

  pos *= vVCToIJK;
  endPos *= vVCToIJK;

  float delta2 = length(endPos - pos);
  sampleDistanceIS = sampleDistance*delta2/delta;
  #ifdef VolumeShadowOn
    sampleDistanceISVS = sampleDistanceIS * volumeShadowSamplingDistFactor;
  #endif
}

void main()
{

  if (cameraParallel == 1)
  {
    // Camera is parallel, so the rayDir is just the direction of the camera.
    rayDirVC = vec3(0.0, 0.0, -1.0);
  } else {
    // camera is at 0,0,0 so rayDir for perspective is just the vc coord
    rayDirVC = normalize(vertexVCVSOutput);
  }

  vec3 tdims = vec3(volumeDimensions);

  // compute the start and end points for the ray
  vec2 rayStartEndDistancesVC = computeRayDistances(rayDirVC, tdims);

  // do we need to composite? aka does the ray have any length
  // If not, bail out early
  if (rayStartEndDistancesVC.y <= rayStartEndDistancesVC.x)
  {
    discard;
  }

  // IS = Index Space
  vec3 posIS;
  vec3 endIS;
  computeIndexSpaceValues(posIS, endIS, rayDirVC, rayStartEndDistancesVC);

  // Perform the blending operation along the ray
  applyBlend(posIS, endIS, tdims);
}
`;const{vtkWarningMacro:w$,vtkErrorMacro:w3}=Zi;function x$(t){switch(t){case Qh.CUSTOM:return"//VTK::CustomColorMix";case Qh.ADDITIVE:return`
        // compute normals
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)
          vec3 scalarInterp0[2];
          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);
          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;
          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;
          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);

          vec3 scalarInterp1[2];
          vec4 normalLight1 = computeNormalForDensity(posIS, tstep, scalarInterp1, 1);
          scalarInterp1[0] = scalarInterp1[0] * oscale1 + oshift1;
          scalarInterp1[1] = scalarInterp1[1] * oscale1 + oshift1;
          normalLight1 = computeDensityNormal(scalarInterp1, height1, 1.0);
        #else
          vec4 normalLight0 = normalMat[0];
          vec4 normalLight1 = normalMat[1];
        #endif

        // compute opacities
        float opacity0 = pwfValue0;
        float opacity1 = pwfValue1;
        #ifdef vtkGradientOpacityOn
          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
          opacity0 *= gof0;
          float gof1 = computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);
          opacity1 *= gof1;
        #endif
        float opacitySum = opacity0 + opacity1;
        if (opacitySum <= 0.0) {
          return vec4(0.0);
        }

        // mix the colors and opacities
        tColor0 = applyAllLightning(tColor0, opacity0, posIS, normalLight0);
        tColor1 = applyAllLightning(tColor1, opacity1, posIS, normalLight1);
        vec3 mixedColor = (opacity0 * tColor0 + opacity1 * tColor1) / opacitySum;
        return vec4(mixedColor, min(1.0, opacitySum));
`;case Qh.COLORIZE:return`
        // compute normals
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)
          vec3 scalarInterp0[2];
          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);
          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;
          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;
          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);
        #else
          vec4 normalLight0 = normalMat[0];
        #endif

        // compute opacities
        float opacity0 = pwfValue0;
        #ifdef vtkGradientOpacityOn
          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
          opacity0 *= gof0;
        #endif

        // mix the colors and opacities
        vec3 color = tColor0 * mix(vec3(1.0), tColor1, pwfValue1);
        color = applyAllLightning(color, opacity0, posIS, normalLight0);
        return vec4(color, opacity0);
`;default:return null}}function E$(t,e){e.classHierarchy.push("vtkOpenGLVolumeMapper");function n(i){[e._scalars,e._scalarOpacityFunc,e._colorTransferFunc,e._labelOutlineThicknessArray].forEach(a=>i.unregisterGraphicsResourceUser(a,t))}t.buildPass=()=>{e.zBufferTexture=null},t.zBufferPass=(i,a)=>{if(i){const o=a.getZBufferTexture();o!==e.zBufferTexture&&(e.zBufferTexture=o)}},t.opaqueZBufferPass=(i,a)=>t.zBufferPass(i,a),t.volumePass=(i,a)=>{if(i){const o=e._openGLRenderWindow;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),o&&!o.isDeleted()&&o!==e._openGLRenderWindow&&n(o),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.jitterTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLVolume=t.getFirstAncestorOfType("vtkOpenGLVolume");const s=e.openGLVolume.getRenderable();e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const c=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(c.getActiveCamera()),t.renderPiece(c,s)}},t.getShaderTemplate=(i,a,o)=>{i.Vertex=C$,i.Fragment=S$,i.Geometry=""},t.useIndependentComponents=i=>{const a=i.getIndependentComponents(),s=e.currentInput?.getPointData()?.getScalars()?.getNumberOfComponents(),c=i.getColorMixPreset();return a&&s>=2||!!c},t.replaceShaderValues=(i,a,o)=>{const s=o.getProperty();let c=i.Fragment;s.getInterpolationType()===N4.LINEAR&&(c=Te.substitute(c,"//VTK::TrilinearOn","#define vtkTrilinearOn").result),t.isLabelmapOutlineRequired(o)===!0&&(c=Te.substitute(c,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result),e.renderable.getBlendMode()===Ph.LABELMAP_EDGE_PROJECTION_BLEND&&(c=Te.substitute(c,"//VTK::LabelEdgeProjectionOn","#define vtkLabelEdgeProjectionOn").result);const h=e.scalarTexture.getComponents();c=Te.substitute(c,"//VTK::NumComponents",`#define vtkNumComponents ${h}`).result;const m=t.useIndependentComponents(s);m&&(c=Te.substitute(c,"//VTK::IndependentComponentsOn","#define UseIndependentComponents").result);const y=[],v=[];for(let I=0;I<h;I++)s.getOpacityMode(I)===uR.PROPORTIONAL&&y.push(`#define vtkComponent${I}Proportional`),s.getForceNearestInterpolation(I)&&v.push(`#define vtkComponent${I}ForceNearest`);c=Te.substitute(c,"//VTK::vtkProportionalComponents",y.join(`
`)).result,c=Te.substitute(c,"//VTK::vtkForceNearestComponents",v.join(`
`)).result;const C=s.getColorMixPreset(),S=x$(C);S&&(c=Te.substitute(c,"//VTK::CustomComponentsColorMixOn","#define vtkCustomComponentsColorMix").result,c=Te.substitute(c,"//VTK::CustomComponentsColorMix::Impl",S).result);const w=e.currentInput.getSpatialExtent(),x=e.currentInput.getSpacing(),R=new Float64Array(3);gn(R,(w[1]-w[0])*x[0],(w[3]-w[2])*x[1],(w[5]-w[4])*x[2]);const O=Gc(R)/t.getCurrentSampleDistance(a);c=Te.substitute(c,"//VTK::MaximumSamplesValue",`${Math.ceil(O)}`).result,c=Te.substitute(c,"//VTK::LightComplexity",`#define vtkLightComplexity ${e.lightComplexity}`).result,e.lightComplexity>0&&(e.renderable.getVolumetricScatteringBlending()>0&&(c=Te.substitute(c,"//VTK::VolumeShadowOn","#define VolumeShadowOn").result),e.renderable.getVolumetricScatteringBlending()<1&&(c=Te.substitute(c,"//VTK::SurfaceShadowOn","#define SurfaceShadowOn").result),e.renderable.getLocalAmbientOcclusion()&&s.getAmbient()>0&&(c=Te.substitute(c,"//VTK::localAmbientOcclusionOn","#define localAmbientOcclusionOn").result));const b=m?h:1;e.gopacity=!1;for(let I=0;!e.gopacity&&I<b;++I)e.gopacity||=s.getUseGradientOpacity(I);e.gopacity&&(c=Te.substitute(c,"//VTK::GradientOpacityOn","#define vtkGradientOpacityOn").result),e.renderable.getComputeNormalFromOpacity()&&(c=Te.substitute(c,"//VTK::vtkComputeNormalFromOpacity","#define vtkComputeNormalFromOpacity").result),e.zBufferTexture!==null&&(c=Te.substitute(c,"//VTK::ZBuffer::Dec",["uniform sampler2D zBufferTexture;","uniform float vpZWidth;","uniform float vpZHeight;"]).result,c=Te.substitute(c,"//VTK::ZBuffer::Impl",["vec4 depthVec = texture2D(zBufferTexture, vec2(gl_FragCoord.x / vpZWidth, gl_FragCoord.y/vpZHeight));","float zdepth = (depthVec.r*256.0 + depthVec.g)/257.0;","zdepth = zdepth * 2.0 - 1.0;","if (cameraParallel == 0) {","zdepth = -2.0 * camFar * camNear / (zdepth*(camFar-camNear)-(camFar+camNear)) - camNear;}","else {",`zdepth = (zdepth + 1.0) * 0.5 * (camFar - camNear);}
`,"zdepth = -zdepth/rayDir.z;","dists.y = min(zdepth,dists.y);"]).result),c=Te.substitute(c,"//VTK::BlendMode",`${e.renderable.getBlendMode()}`).result,i.Fragment=c,t.replaceShaderLight(i,a,o),t.replaceShaderClippingPlane(i,a,o)},t.replaceShaderLight=(i,a,o)=>{if(e.lightComplexity===0)return;let s=i.Fragment,c=0;a.getLights().forEach(u=>{u.getSwitch()&&(c+=1)}),s=Te.substitute(s,"//VTK::Light::Dec",["uniform int lightNum;","uniform bool twoSidedLighting;",`uniform vec3 lightColor[${c}];`,`uniform vec3 lightDirectionVC[${c}]; // normalized`,`uniform vec3 lightHalfAngleVC[${c}];`,"//VTK::Light::Dec"],!1).result,e.lightComplexity===3&&(s=Te.substitute(s,"//VTK::Light::Dec",[`uniform vec3 lightPositionVC[${c}];`,`uniform vec3 lightAttenuation[${c}];`,`uniform float lightConeAngle[${c}];`,`uniform float lightExponent[${c}];`,`uniform int lightPositional[${c}];`],!1).result),e.renderable.getVolumetricScatteringBlending()>0&&(s=Te.substitute(s,"//VTK::VolumeShadow::Dec",["uniform float volumetricScatteringBlending;","uniform float giReach;","uniform float volumeShadowSamplingDistFactor;","uniform float anisotropy;","uniform float anisotropy2;"],!1).result),e.renderable.getLocalAmbientOcclusion()&&o.getProperty().getAmbient()>0&&(s=Te.substitute(s,"//VTK::LAO::Dec",["uniform int kernelRadius;",`uniform vec2 kernelSample[${e.renderable.getLAOKernelRadius()}];`,"uniform int kernelSize;"],!1).result),i.Fragment=s},t.replaceShaderClippingPlane=(i,a,o)=>{let s=i.Fragment;if(e.renderable.getClippingPlanes().length>0){const c=e.renderable.getClippingPlanes().length;s=Te.substitute(s,"//VTK::ClipPlane::Dec",["uniform vec3 vClipPlaneNormals[6];","uniform float vClipPlaneDistances[6];","uniform vec3 vClipPlaneOrigins[6];","uniform int clip_numPlanes;","//VTK::ClipPlane::Dec","#define vtkClippingPlanesOn"],!1).result,s=Te.substitute(s,"//VTK::ClipPlane::Impl",[`for(int i = 0; i < ${c}; i++) {`,"  float rayDirRatio = dot(rayDir, vClipPlaneNormals[i]);","  float equationResult = dot(vertexVCVSOutput, vClipPlaneNormals[i]) + vClipPlaneDistances[i];","  if (rayDirRatio == 0.0)","  {","    if (equationResult < 0.0) dists.x = dists.y;","    continue;","  }","  float result = -1.0 * equationResult / rayDirRatio;","  if (rayDirRatio < 0.0) dists.y = min(dists.y, result);","  else dists.x = max(dists.x, result);","}","//VTK::ClipPlane::Impl"],!1).result}i.Fragment=s};const r=(i,a)=>{let o=0;i.getProperty().getShade()&&e.renderable.getBlendMode()===Ph.COMPOSITE_BLEND&&(o=0,e.numberOfLights=0,a.forEach(s=>{s.getSwitch()>0&&(e.numberOfLights++,o===0&&(o=1)),o===1&&(e.numberOfLights>1||s.getIntensity()!==1||!s.lightTypeIsHeadLight())&&(o=2),o<3&&s.getPositional()&&(o=3)})),o!==e.lightComplexity&&(e.lightComplexity=o,t.modified())};t.getNeedToRebuildShaders=(i,a,o)=>{const s=o.getProperty();r(o,a.getLights());const c=e.scalarTexture.getComponents(),u=[],d=[];for(let S=0;S<c;S++)u.push(s.getOpacityMode(S)),d.push(s.getForceNearestInterpolation(S));const g=e.currentInput.getSpatialExtent(),h=e.currentInput.getSpacing(),m=new Float64Array(3);gn(m,(g[1]-g[0])*h[0],(g[3]-g[2])*h[1],(g[5]-g[4])*h[2]);const y=Gc(m)/t.getCurrentSampleDistance(a),v=!!e.zBufferTexture,C={iComps:s.getIndependentComponents(),colorMixPreset:s.getColorMixPreset(),interpolationType:s.getInterpolationType(),useLabelOutline:t.isLabelmapOutlineRequired(o),numComp:c,maxSamples:y,useGradientOpacity:s.getUseGradientOpacity(0),blendMode:e.renderable.getBlendMode(),hasZBufferTexture:v,opacityModes:u,forceNearestInterps:d};return i.getProgram()?.getHandle()===0||i.getShaderSourceTime().getMTime()<t.getMTime()||i.getShaderSourceTime().getMTime()<e.renderable.getMTime()||!e.previousState||!xv(e.previousState,C)?(e.previousState=C,!0):!1},t.updateShaders=(i,a,o)=>{if(t.getNeedToRebuildShaders(i,a,o)){const s={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(s,a,o);const c=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);c!==i.getProgram()&&(i.setProgram(c),i.getVAO().releaseGraphicsResources()),i.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(i.getProgram());i.getVAO().bind(),t.setMapperShaderParameters(i,a,o),t.setCameraShaderParameters(i,a,o),t.setPropertyShaderParameters(i,a,o),t.getClippingPlaneShaderParameters(i,a,o)},t.setMapperShaderParameters=(i,a,o)=>{const s=i.getProgram();i.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>i.getAttributeUpdateTime().getMTime()||i.getShaderSourceTime().getMTime()>i.getAttributeUpdateTime().getMTime())&&(s.isAttributeUsed("vertexDC")&&(i.getVAO().addAttributeArray(s,i.getCABO(),"vertexDC",i.getCABO().getVertexOffset(),i.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||w3("Error setting vertexDC in shader VAO.")),i.getAttributeUpdateTime().modified()),s.setUniformi("texture1",e.scalarTexture.getTextureUnit()),s.setUniformf("sampleDistance",t.getCurrentSampleDistance(a));const c=e.scalarTexture.getVolumeInfo(),u=e.renderable.getIpScalarRange();if(c?.dataComputedScale?.length){const d=[],g=[];for(let h=0;h<4;h++)d[h]=u[0]*c.dataComputedScale[h]+c.dataComputedOffset[h],g[h]=u[1]*c.dataComputedScale[h]+c.dataComputedOffset[h],d[h]=(d[h]-c.offset[h])/c.scale[h],g[h]=(g[h]-c.offset[h])/c.scale[h];s.setUniform4f("ipScalarRangeMin",d[0],d[1],d[2],d[3]),s.setUniform4f("ipScalarRangeMax",g[0],g[1],g[2],g[3])}if(e.zBufferTexture!==null){s.setUniformi("zBufferTexture",e.zBufferTexture.getTextureUnit());const d=e._useSmallViewport?[e._smallViewportWidth,e._smallViewportHeight]:e._openGLRenderWindow.getFramebufferSize();s.setUniformf("vpZWidth",d[0]),s.setUniformf("vpZHeight",d[1])}},t.setCameraShaderParameters=(i,a,o)=>{const s=e.openGLCamera.getKeyMatrices(a),c=e.openGLVolume.getKeyMatrices();zt(e.modelToView,s.wcvc,c.mcwc);const u=i.getProgram(),d=e.openGLCamera.getRenderable(),g=d.getClippingRange();u.setUniformf("camThick",g[1]-g[0]),u.setUniformf("camNear",g[0]),u.setUniformf("camFar",g[1]);const h=e.currentInput.getBounds(),m=e.currentInput.getDimensions(),y=new Float64Array(3),v=new Float64Array(3);let C=1,S=-1,w=1,x=-1;for(let X=0;X<8;++X){if(gn(y,h[X%2],h[2+Math.floor(X/2)%2],h[4+Math.floor(X/4)]),an(y,y,e.modelToView),!d.getParallelProjection()){Sn(v,y);const ie=-g[0]/y[2];bs(y,v,ie)}an(y,y,s.vcpc),C=Math.min(y[0],C),S=Math.max(y[0],S),w=Math.min(y[1],w),x=Math.max(y[1],x)}u.setUniformf("dcxmin",C),u.setUniformf("dcxmax",S),u.setUniformf("dcymin",w),u.setUniformf("dcymax",x),u.isUniformUsed("cameraParallel")&&u.setUniformi("cameraParallel",d.getParallelProjection());const R=e.currentInput.getSpatialExtent(),O=e.currentInput.getSpacing(),b=new Float64Array(3);gn(b,(R[1]-R[0])*O[0],(R[3]-R[2])*O[1],(R[5]-R[4])*O[2]),u.setUniform3f("vSpacing",O[0],O[1],O[2]),gn(y,R[0],R[2],R[4]),e.currentInput.indexToWorldVec3(y,y),an(y,y,e.modelToView),u.setUniform3f("vOriginVC",y[0],y[1],y[2]);const I=e.currentInput.getIndexToWorld();zt(e.idxToView,e.modelToView,I),of(e.idxNormalMatrix,s.normalMatrix,c.normalMatrix),of(e.idxNormalMatrix,e.idxNormalMatrix,e.currentInput.getDirectionByReference());const G=Gc(b)/t.getCurrentSampleDistance(a);G>e.renderable.getMaximumSamplesPerRay()&&w$(`The number of steps required ${Math.ceil(G)} is larger than the
        specified maximum number of steps ${e.renderable.getMaximumSamplesPerRay()}.
        Please either change the
        volumeMapper sampleDistance or its maximum number of samples.`);const j=new Float64Array(3);if(gn(j,1,1,1),ZU(j,j,b),u.setUniform3f("vVCToIJK",j[0],j[1],j[2]),u.setUniform3i("volumeDimensions",m[0],m[1],m[2]),u.setUniform3f("volumeSpacings",O[0],O[1],O[2]),!e._openGLRenderWindow.getWebgl2()){const X=e.scalarTexture.getVolumeInfo();u.setUniformf("texWidth",e.scalarTexture.getWidth()),u.setUniformf("texHeight",e.scalarTexture.getHeight()),u.setUniformi("xreps",X.xreps),u.setUniformi("xstride",X.xstride),u.setUniformi("ystride",X.ystride)}const F=new Float64Array(3),$=new Float64Array(3);for(let X=0;X<6;++X){switch(X){case 1:gn(F,-1,0,0),gn($,R[0],R[2],R[4]);break;case 2:gn(F,0,1,0),gn($,R[1],R[3],R[5]);break;case 3:gn(F,0,-1,0),gn($,R[0],R[2],R[4]);break;case 4:gn(F,0,0,1),gn($,R[1],R[3],R[5]);break;case 5:gn(F,0,0,-1),gn($,R[0],R[2],R[4]);break;case 0:default:gn(F,1,0,0),gn($,R[1],R[3],R[5]);break}Kh(F,F,e.idxNormalMatrix),an($,$,e.idxToView);const ie=-1*ft($,F);u.setUniform3f(`vPlaneNormal${X}`,F[0],F[1],F[2]),u.setUniformf(`vPlaneDistance${X}`,ie)}if(t.isLabelmapOutlineRequired(o)){const ie=e.currentInput.getWorldToIndex();u.setUniformMatrix("vWCtoIDX",ie);const ye=a.getActiveCamera(),[ge,W]=ye.getClippingRange(),ae=ye.getDistance();ye.setClippingRange(ae,ae+.1);const fe=e.openGLCamera.getKeyMatrices(a);Br(e.projectionToWorld,fe.wcpc),ye.setClippingRange(ge,W),e.openGLCamera.getKeyMatrices(a),u.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const ue=t.getRenderTargetSize();u.setUniformf("vpWidth",ue[0]),u.setUniformf("vpHeight",ue[1]);const qe=t.getRenderTargetOffset();u.setUniformf("vpOffsetX",qe[0]/ue[0]),u.setUniformf("vpOffsetY",qe[1]/ue[1])}if(Br(e.projectionToView,s.vcpc),u.setUniformMatrix("PCVCMatrix",e.projectionToView),e.lightComplexity===0)return;let z=0;const oe=[],Q=[],le=[];if(a.getLights().forEach(X=>{if(X.getSwitch()>0){const ye=X.getColor(),ge=X.getIntensity();oe[0+z*3]=ye[0]*ge,oe[1+z*3]=ye[1]*ge,oe[2+z*3]=ye[2]*ge;const W=X.getDirection();gn(F,W[0],W[1],W[2]),Kh(F,F,s.normalMatrix),Sn(F,F),Q[0+z*3]=F[0],Q[1+z*3]=F[1],Q[2+z*3]=F[2],le[0+z*3]=-.5*F[0],le[1+z*3]=-.5*F[1],le[2+z*3]=-.5*(F[2]-1),z++}}),u.setUniformi("twoSidedLighting",a.getTwoSidedLighting()),u.setUniformi("lightNum",z),u.setUniform3fv("lightColor",oe),u.setUniform3fv("lightDirectionVC",Q),u.setUniform3fv("lightHalfAngleVC",le),e.lightComplexity===3){z=0;const X=[],ie=[],ye=[],ge=[],W=[];a.getLights().forEach(ae=>{if(ae.getSwitch()>0){const ue=ae.getAttenuationValues();ie[0+z*3]=ue[0],ie[1+z*3]=ue[1],ie[2+z*3]=ue[2],ge[z]=ae.getExponent(),ye[z]=ae.getConeAngle(),W[z]=ae.getPositional();const qe=ae.getTransformedPosition();an(qe,qe,e.modelToView),X[0+z*3]=qe[0],X[1+z*3]=qe[1],X[2+z*3]=qe[2],z+=1}}),u.setUniform3fv("lightPositionVC",X),u.setUniform3fv("lightAttenuation",ie),u.setUniformfv("lightConeAngle",ye),u.setUniformfv("lightExponent",ge),u.setUniformiv("lightPositional",W)}if(e.renderable.getVolumetricScatteringBlending()>0&&(u.setUniformf("giReach",e.renderable.getGlobalIlluminationReach()),u.setUniformf("volumetricScatteringBlending",e.renderable.getVolumetricScatteringBlending()),u.setUniformf("volumeShadowSamplingDistFactor",e.renderable.getVolumeShadowSamplingDistFactor()),u.setUniformf("anisotropy",e.renderable.getAnisotropy()),u.setUniformf("anisotropy2",e.renderable.getAnisotropy()**2)),e.renderable.getLocalAmbientOcclusion()&&o.getProperty().getAmbient()>0){const X=e.renderable.getLAOKernelSize();u.setUniformi("kernelSize",X);const ie=[];for(let ye=0;ye<X;ye++)ie[ye*2]=Math.random()*.5,ie[ye*2+1]=Math.random()*.5;u.setUniform2fv("kernelSample",ie),u.setUniformi("kernelRadius",e.renderable.getLAOKernelRadius())}},t.setPropertyShaderParameters=(i,a,o)=>{const s=i.getProgram();s.setUniformi("ctexture",e.colorTexture.getTextureUnit()),s.setUniformi("otexture",e.opacityTexture.getTextureUnit()),s.setUniformi("jtexture",e.jitterTexture.getTextureUnit()),s.setUniformi("ttexture",e.labelOutlineThicknessTexture.getTextureUnit());const c=e.scalarTexture.getVolumeInfo(),u=o.getProperty(),d=e.scalarTexture.getComponents(),g=t.useIndependentComponents(u);if(g)for(let m=0;m<d;m++)s.setUniformf(`mix${m}`,o.getProperty().getComponentWeight(m));for(let m=0;m<d;m++){const y=g?m:0,v=c.scale[m],S=u.getScalarOpacity(y).getRange(),w=v/(S[1]-S[0]),x=(c.offset[m]-S[0])/(S[1]-S[0]);s.setUniformf(`oshift${m}`,x),s.setUniformf(`oscale${m}`,w);const O=u.getRGBTransferFunction(y).getRange(),b=(c.offset[m]-O[0])/(O[1]-O[0]),I=v/(O[1]-O[0]);s.setUniformf(`cshift${m}`,b),s.setUniformf(`cscale${m}`,I)}if(e.gopacity)if(g)for(let m=0;m<d;++m){const y=c.scale[m];if(u.getUseGradientOpacity(m)){const C=u.getGradientOpacityMinimumOpacity(m),S=u.getGradientOpacityMaximumOpacity(m);s.setUniformf(`gomin${m}`,C),s.setUniformf(`gomax${m}`,S);const w=[u.getGradientOpacityMinimumValue(m),u.getGradientOpacityMaximumValue(m)];s.setUniformf(`goscale${m}`,y*(S-C)/(w[1]-w[0])),s.setUniformf(`goshift${m}`,-w[0]*(S-C)/(w[1]-w[0])+C)}else s.setUniformf(`gomin${m}`,1),s.setUniformf(`gomax${m}`,1),s.setUniformf(`goscale${m}`,0),s.setUniformf(`goshift${m}`,1)}else{const m=c.scale[d-1],y=u.getGradientOpacityMinimumOpacity(0),v=u.getGradientOpacityMaximumOpacity(0);s.setUniformf("gomin0",y),s.setUniformf("gomax0",v);const C=[u.getGradientOpacityMinimumValue(0),u.getGradientOpacityMaximumValue(0)];s.setUniformf("goscale0",m*(v-y)/(C[1]-C[0])),s.setUniformf("goshift0",-C[0]*(v-y)/(C[1]-C[0])+y)}if(t.isLabelmapOutlineRequired(o)===!0){const m=o.getProperty().getLabelOutlineOpacity();s.setUniformf("outlineOpacity",m)}e.lightComplexity>0&&(s.setUniformf("vAmbient",u.getAmbient()),s.setUniformf("vDiffuse",u.getDiffuse()),s.setUniformf("vSpecular",u.getSpecular()),s.setUniformf("vSpecularPower",u.getSpecularPower()))},t.getClippingPlaneShaderParameters=(i,a,o)=>{if(e.renderable.getClippingPlanes().length>0){const s=e.openGLCamera.getKeyMatrices(a),c=[],u=[],d=[],g=e.renderable.getClippingPlanes(),h=g.length;for(let y=0;y<h;++y){const v=g[y].getNormal(),C=g[y].getOrigin();Kh(v,v,s.normalMatrix),an(C,C,s.wcvc);const S=-1*ft(C,v);c.push(v[0]),c.push(v[1]),c.push(v[2]),u.push(S),d.push(C[0]),d.push(C[1]),d.push(C[2])}const m=i.getProgram();m.setUniform3fv("vClipPlaneNormals",c),m.setUniformfv("vClipPlaneDistances",u),m.setUniform3fv("vClipPlaneOrigins",d),m.setUniformi("clip_numPlanes",h)}},t.delete=A1(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete),t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:i,vsize:a}=e._openGLRenderer.getTiledSizeAndOrigin();return[i,a]},t.getRenderTargetOffset=()=>{const{lowerLeftU:i,lowerLeftV:a}=e._openGLRenderer.getTiledSizeAndOrigin();return[i,a]},t.getCurrentSampleDistance=i=>{const a=i.getVTKWindow().getInteractor(),o=e.renderable.getSampleDistance();if(a.isAnimating()){const s=e.renderable.getInteractionSampleDistanceFactor();return o*s}return o},t.renderPieceStart=(i,a)=>{const o=i.getVTKWindow().getInteractor();if(e._lastScale||(e._lastScale=e.renderable.getInitialInteractionScale()),e._useSmallViewport=!1,o.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._animationRateSubscription||(e._animationRateSubscription=o.onAnimationFrameRateUpdate(()=>{if(e.renderable.getAutoAdjustSampleDistances()){const c=o.getRecentAnimationFrameRate(),u=o.getDesiredUpdateRate()/c;(u>1.15||u<.85)&&(e._lastScale*=u),e._lastScale>400&&(e._lastScale=400),e._lastScale<1.5&&(e._lastScale=1.5)}else e._lastScale=e.renderable.getImageSampleDistance()*e.renderable.getImageSampleDistance()})),e._useSmallViewport){const c=e._openGLRenderWindow.getFramebufferSize(),u=1/Math.sqrt(e._lastScale);if(e._smallViewportWidth=Math.ceil(u*c[0]),e._smallViewportHeight=Math.ceil(u*c[1]),e._smallViewportHeight>c[1]&&(e._smallViewportHeight=c[1]),e._smallViewportWidth>c[0]&&(e._smallViewportWidth=c[0]),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.getGLFramebuffer()===null)e.framebuffer.create(c[0],c[1]),e.framebuffer.populateFramebuffer();else{const g=e.framebuffer.getSize();(!g||g[0]!==c[0]||g[1]!==c[1])&&(e.framebuffer.create(c[0],c[1]),e.framebuffer.populateFramebuffer())}e.framebuffer.bind();const d=e.context;d.clearColor(0,0,0,0),d.colorMask(!0,!0,!0,!0),d.clear(d.COLOR_BUFFER_BIT),d.viewport(0,0,e._smallViewportWidth,e._smallViewportHeight),e.fvp=[e._smallViewportWidth/c[0],e._smallViewportHeight/c[1]]}e.context.disable(e.context.DEPTH_TEST),t.updateBufferObjects(i,a),a.getProperty().getInterpolationType()===N4.NEAREST?(e.scalarTexture.setMinificationFilter(pt.NEAREST),e.scalarTexture.setMagnificationFilter(pt.NEAREST)):(e.scalarTexture.setMinificationFilter(pt.LINEAR),e.scalarTexture.setMagnificationFilter(pt.LINEAR)),e.zBufferTexture!==null&&e.zBufferTexture.activate()},t.renderPieceDraw=(i,a)=>{const o=e.context;e.scalarTexture.activate(),e.opacityTexture.activate(),e.labelOutlineThicknessTexture.activate(),e.colorTexture.activate(),e.jitterTexture.activate(),t.updateShaders(e.tris,i,a),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.scalarTexture.deactivate(),e.colorTexture.deactivate(),e.opacityTexture.deactivate(),e.labelOutlineThicknessTexture.deactivate(),e.jitterTexture.deactivate()},t.renderPieceFinish=(i,a)=>{if(e.zBufferTexture!==null&&e.zBufferTexture.deactivate(),e._useSmallViewport){if(e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null){e.copyShader=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","uniform vec2 tfactor;","varying vec2 tcoord;","void main() { tcoord = vec2(vertexDC.x*0.5 + 0.5, vertexDC.y*0.5 + 0.5) * tfactor; gl_Position = vertexDC; }"].join(`
`),["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D texture1;","varying vec2 tcoord;","void main() { gl_FragData[0] = texture2D(texture1,tcoord); }"].join(`
`),"");const u=e.copyShader;e.copyVAO=m8.newInstance(),e.copyVAO.setOpenGLRenderWindow(e._openGLRenderWindow),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(u,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||w3("Error setting vertexDC in copy shader VAO.")}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.copyShader);const o=e._openGLRenderWindow.getFramebufferSize();e.context.viewport(0,0,o[0],o[1]);const s=e.framebuffer.getColorTexture();s.activate(),e.copyShader.setUniformi("texture",s.getTextureUnit()),e.copyShader.setUniform2f("tfactor",e.fvp[0],e.fvp[1]);const c=e.context;c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),s.deactivate(),c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)}},t.renderPiece=(i,a)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){w3("No input!");return}t.renderPieceStart(i,a),t.renderPieceDraw(i,a),t.renderPieceFinish(i,a)},t.computeBounds=(i,a)=>{if(!t.getInput()){Cf(e.Bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(i,a)=>{t.getNeedToRebuildBufferObjects(i,a)&&t.buildBufferObjects(i,a)},t.getNeedToRebuildBufferObjects=(i,a)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<a.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<a.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!e.scalarTexture?.getHandle()||!e.colorTexture?.getHandle()||!e.labelOutlineThicknessTexture?.getHandle(),t.buildBufferObjects=(i,a)=>{const o=e.currentInput;if(!o)return;const s=o.getPointData()&&o.getPointData().getScalars();if(!s)return;const c=a.getProperty();if(!e.jitterTexture.getHandle()){const I=new Uint8Array(1024);for(let G=0;G<1024;++G)I[G]=255*Math.random();e.jitterTexture.setMinificationFilter(pt.LINEAR),e.jitterTexture.setMagnificationFilter(pt.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,kt.UNSIGNED_CHAR,I)}const u=s.getNumberOfComponents(),d=t.useIndependentComponents(c),g=d?u:1,h=c.getScalarOpacity(),m=e._openGLRenderWindow.getGraphicsResourceForObject(h);let y=Fs(h,d,g);if(!m?.oglObject||m.hash!==y){e.opacityTexture=qn.newInstance(),e.opacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const I=1024,G=I*2*g,j=new Float32Array(G),F=new Float32Array(I);for(let $=0;$<g;++$){const z=c.getScalarOpacity($),oe=t.getCurrentSampleDistance(i)/c.getScalarOpacityUnitDistance($),Q=z.getRange();z.getTable(Q[0],Q[1],I,F,1);for(let le=0;le<I;++le)j[$*I*2+le]=1-(1-F[le])**oe,j[$*I*2+le+I]=j[$*I*2+le]}if(e.opacityTexture.resetFormatAndType(),e.opacityTexture.setMinificationFilter(pt.LINEAR),e.opacityTexture.setMagnificationFilter(pt.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(I,2*g,1,kt.FLOAT,j);else{const $=new Uint8ClampedArray(G);for(let z=0;z<G;++z)$[z]=255*j[z];e.opacityTexture.create2DFromRaw(I,2*g,1,kt.UNSIGNED_CHAR,$)}h&&(e._openGLRenderWindow.setGraphicsResourceForObject(h,e.opacityTexture,y),h!==e._scalarOpacityFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(h,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalarOpacityFunc,t)),e._scalarOpacityFunc=h)}else e.opacityTexture=m.oglObject;const C=c.getRGBTransferFunction();y=Fs(C,d,g);const S=e._openGLRenderWindow.getGraphicsResourceForObject(C);if(!S?.oglObject?.getHandle()||S?.hash!==y){e.colorTexture=qn.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const I=1024,G=I*2*g*3,j=new Uint8ClampedArray(G),F=new Float32Array(I*3);for(let $=0;$<g;++$){const z=c.getRGBTransferFunction($),oe=z.getRange();z.getTable(oe[0],oe[1],I,F,1);for(let Q=0;Q<I*3;++Q)j[$*I*6+Q]=255*F[Q],j[$*I*6+Q+I*3]=255*F[Q]}e.colorTexture.resetFormatAndType(),e.colorTexture.setMinificationFilter(pt.LINEAR),e.colorTexture.setMagnificationFilter(pt.LINEAR),e.colorTexture.create2DFromRaw(I,2*g,3,kt.UNSIGNED_CHAR,j),C&&(e._openGLRenderWindow.setGraphicsResourceForObject(C,e.colorTexture,y),C!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(C,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=C)}else e.colorTexture=S.oglObject;t.updateLabelOutlineThicknessTexture(a);const x=e._openGLRenderWindow.getGraphicsResourceForObject(s);y=y8(o,s);const R=!x?.oglObject?.getHandle()||x?.hash!==y,O=e.renderable.getUpdatedExtents(),b=!!O.length;if(R&&!b){e.scalarTexture=qn.newInstance(),e.scalarTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const I=o.getDimensions();e.scalarTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.scalarTexture.resetFormatAndType(),e.scalarTexture.create3DFilterableFromDataArray(I[0],I[1],I[2],s),s&&(e._openGLRenderWindow.setGraphicsResourceForObject(s,e.scalarTexture,y),s!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(s,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=s)}else e.scalarTexture=x.oglObject;if(b){e.renderable.setUpdatedExtents([]);const I=o.getDimensions();e.scalarTexture.create3DFilterableFromDataArray(I[0],I[1],I[2],s,!1,O)}if(!e.tris.getCABO().getElementCount()){const I=new Float32Array(12);for(let $=0;$<4;$++)I[$*3]=$%2*2-1,I[$*3+1]=$>1?1:-1,I[$*3+2]=-1;const G=new Uint16Array(8);G[0]=3,G[1]=0,G[2]=1,G[3]=3,G[4]=3,G[5]=0,G[6]=3,G[7]=2;const j=Pt.newInstance({numberOfComponents:3,values:I});j.setName("points");const F=Pt.newInstance({numberOfComponents:1,values:G});e.tris.getCABO().createVBO(F,"polys",bo.SURFACE,{points:j,cellOffset:0})}e.VBOBuildTime.modified()},t.updateLabelOutlineThicknessTexture=i=>{const a=i.getProperty().getLabelOutlineThickness(),o=e._openGLRenderWindow.getGraphicsResourceForObject(a),s=`${a.join("-")}`;if(!o?.oglObject?.getHandle()||o?.hash!==s){e.labelOutlineThicknessTexture=qn.newInstance(),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const u=1024,d=1,g=u*d,h=new Uint8Array(g);for(let m=0;m<u;++m){const y=typeof a[m]<"u"?a[m]:a[0];h[m]=y}e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(pt.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(pt.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw(u,d,1,kt.UNSIGNED_CHAR,h),a&&(e._openGLRenderWindow.setGraphicsResourceForObject(a,e.labelOutlineThicknessTexture,s),a!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(a,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=a)}else e.labelOutlineThicknessTexture=o.oglObject},t.isLabelmapOutlineRequired=i=>{const a=i.getProperty(),o=e.renderable;return a.getUseLabelOutline()||o.getBlendMode()===Ph.LABELMAP_EDGE_PROJECTION_BLEND}}const R$={context:null,VBOBuildTime:null,scalarTexture:null,opacityTexture:null,opacityTextureString:null,colorTexture:null,colorTextureString:null,jitterTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,tris:null,framebuffer:null,copyShader:null,copyVAO:null,lastXYF:1,targetXYF:1,zBufferTexture:null,lastZBufferTexture:null,lightComplexity:0,fullViewportTime:1,idxToView:null,idxNormalMatrix:null,modelToView:null,projectionToView:null,avgWindowArea:0,avgFrameTime:0};function sO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,R$,n),$r.extend(t,e,n),H0.implementBuildShadersWithReplacements(t,e,n),e.VBOBuildTime={},Yn(e.VBOBuildTime,{mtime:0}),e.tris=Y0.newInstance(),e.jitterTexture=qn.newInstance(),e.jitterTexture.setWrapS(C1.REPEAT),e.jitterTexture.setWrapT(C1.REPEAT),e.framebuffer=Rp.newInstance(),e.idxToView=wt(new Float64Array(16)),e.idxNormalMatrix=rs(new Float64Array(9)),e.modelToView=wt(new Float64Array(16)),e.projectionToView=wt(new Float64Array(16)),e.projectionToWorld=wt(new Float64Array(16)),ri(t,e,["context"]),E$(t,e)}const cO=An(sO,"vtkOpenGLVolumeMapper");var lO={newInstance:cO,extend:sO};xi("vtkVolumeMapper",cO);const{vtkDebugMacro:O$}=Zi;function D$(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow");const i=e._openGLRenderer.getAspectRatio(),a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,o=e._openGLRenderer.getTiledSizeAndOrigin();let s=null;if(e.renderable.getUseZValues()){const c=r.getZBufferTexture(),u=Math.floor(c.getWidth()),d=Math.floor(c.getHeight()),g=e._openGLRenderWindow.getContext();c.bind();const h=r.getFramebuffer();h?h.saveCurrentBindingsAndBuffers():O$("No framebuffer to save/restore");const m=g.createFramebuffer();g.bindFramebuffer(g.FRAMEBUFFER,m),g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,c.getHandle(),0),g.checkFramebufferStatus(g.FRAMEBUFFER)===g.FRAMEBUFFER_COMPLETE&&(s=new Uint8Array(u*d*4),g.viewport(0,0,u,d),g.readPixels(0,0,u,d,g.RGBA,g.UNSIGNED_BYTE,s)),h&&h.restorePreviousBindingsAndBuffers(),g.deleteFramebuffer(m)}e.renderable.invokeCallback(e.renderable.getInputData(),a,i,o,s)},t.queryPass=(n,r)=>{n&&e.renderable.getUseZValues()&&r.requestDepth()}}const _$={};function b$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_$,n),$r.extend(t,e,n),D$(t,e)}const uO=An(b$,"vtkOpenGLPixelSpaceCallbackMapper");var M$={newInstance:uO};xi("vtkPixelSpaceCallbackMapper",uO);const fO=Object.create(null);function wf(t,e){fO[t]=e}function L$(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}const V$={};function I$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,V$,n),e.overrides=fO,h8.extend(t,e,n),L$(t,e)}H.newInstance(I$,"vtkWebGPUViewNodeFactory");function A$(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(n,r,i,a)=>{if(wt(n),e.renderable.getParallelProjection()){const o=e.renderable.getParallelScale(),s=o*r,c=o,u=(a[0]-1)*s,d=(a[0]+1)*s,g=(a[1]-1)*c,h=(a[1]+1)*c,m=1/(d-u),y=1/(h-g);n[0]=2*m,n[5]=2*y,n[10]=1/(i[1]-i[0]),n[12]=(d+u)*m,n[13]=(h+g)*y,n[14]=i[1]/(i[1]-i[0])}else{const o=Math.tan(Math.PI*e.renderable.getViewAngle()/360);let s,c;e.renderable.getUseHorizontalViewAngle()===!0?(s=i[0]*o,c=i[0]*o/r):(s=i[0]*o*r,c=i[0]*o);const u=(a[0]-1)*s,d=(a[0]+1)*s,g=(a[1]-1)*c,h=(a[1]+1)*c;n[0]=2*i[0]/(d-u),n[5]=2*i[0]/(h-g),n[12]=(u+d)/(d-u),n[13]=(g+h)/(h-g),n[10]=0,n[14]=i[0],n[11]=-1,n[15]=0}},t.convertToOpenGLDepth=n=>{if(e.renderable.getParallelProjection())return 1-n;const r=e.renderable.getClippingRangeByReference();let i=-r[0]/n;return i=(r[0]+r[1])/(r[1]-r[0])+2*r[0]*r[1]/(i*(r[1]-r[0])),.5*i+.5},t.getKeyMatrices=n=>{const r=n.getRenderable(),i=n.getParent();if(Math.max(i.getMTime(),t.getMTime(),r.getMTime(),e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatrixTime.getMTime()){const a=e.renderable.getViewMatrix();_r(e.keyMatrices.normalMatrix,a),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Br(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Qt(e.keyMatrices.wcvc,a);const o=n.getStabilizedCenterByReference();Gr(e.keyMatrices.scvc,e.keyMatrices.wcvc,o);const s=n.getAspectRatio(),c=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,s,c,e.renderable.getWindowCenterByReference()),zt(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),Br(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}const N$={keyMatrixTime:null,keyMatrices:null};function P$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,N$,n),$r.extend(t,e,n),e.keyMatrixTime={},H.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},H.setGet(t,e,["keyMatrixTime"]),A$(t,e)}const U$=H.newInstance(P$);wf("vtkCamera",U$);function F$(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=n=>{if(e.bindables.length===n.length){let r=!0;for(let i=0;i<e.bindables.length;i++)e.bindables[i]!==n[i]&&(r=!1);if(r)return}e.bindables=n,t.modified()},t.getBindGroupLayout=n=>{const r=[];for(let i=0;i<e.bindables.length;i++){const a=e.bindables[i].getBindGroupLayoutEntry();a.binding=i,r.push(a)}return n.getBindGroupLayout({entries:r})},t.getBindGroup=n=>{let r=t.getMTime();for(let a=0;a<e.bindables.length;a++){const o=e.bindables[a].getBindGroupTime().getMTime();r=o>r?o:r}if(r<e.bindGroupTime.getMTime())return e.bindGroup;const i=[];for(let a=0;a<e.bindables.length;a++){const o=e.bindables[a].getBindGroupEntry();o.binding=a,i.push(o)}return e.bindGroup=n.getHandle().createBindGroup({layout:t.getBindGroupLayout(n),entries:i,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=n=>{const r=[],i=n.getBindGroupLayoutCount(e.label);for(let a=0;a<e.bindables.length;a++)r.push(e.bindables[a].getShaderCode(a,i));return r.join(`
`)}}const k$={device:null,handle:null,label:null};function gO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,k$,n),H.obj(t,e),e.bindables=[],e.bindGroupTime={},H.obj(e.bindGroupTime,{mtime:0}),H.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),H.setGet(t,e,["label","device","arrayInformation"]),F$(t,e)}const G$=H.newInstance(gO);var dO={newInstance:G$,extend:gO};function B$(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(n,r)=>{e.device=n,e.handle=e.device.getHandle().createShaderModule({code:r.getCode()})}}const $$={device:null,handle:null};function hO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$$,n),H.obj(t,e),H.get(t,e,["lastCameraMTime"]),H.setGet(t,e,["device","handle"]),B$(t,e)}const W$=H.newInstance(hO,"vtkWebGPUShaderModule");var z$={newInstance:W$,extend:hO};function H$(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;const i=Array.isArray(n)?n.join(`
`):n;let a=!1;t.search(e)!==-1&&(a=!0);let o="";r&&(o="g");const s=new RegExp(e,o),c=t.replace(s,i);return{replace:a,result:c}}function j$(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=n=>{const r=n.getType(),i=n.getHash(),a=e._shaderModules.keys();for(let s=0;s<a.length;s++){const c=a[s];if(c.getHash()===i&&c.getType()===r)return e._shaderModules.get(c)}const o=z$.newInstance();return o.initialize(e.device,n),e._shaderModules.set(n,o),o}}const q$={shaderModules:null,device:null,window:null};function pO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,q$,n),e._shaderModules=new Map,H.obj(t,e),H.setGet(t,e,["device","window"]),j$(t,e)}const K$=H.newInstance(pO,"vtkWebGPUShaderCache");var to={newInstance:K$,extend:pO,substitute:H$};function Y$(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(n,r)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=r;const i=[];for(let a=0;a<e.layouts.length;a++)i.push(e.layouts[a].layout);e.pipelineLayout=n.getHandle().createPipelineLayout({bindGroupLayouts:i}),e.pipelineDescription.layout=e.pipelineLayout;for(let a=0;a<e.shaderDescriptions.length;a++){const o=e.shaderDescriptions[a],s=n.getShaderModule(o);o.getType()==="vertex"&&(e.pipelineDescription.vertex.module=s.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),o.getType()==="fragment"&&(e.pipelineDescription.fragment.module=s.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=n.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=n=>{for(let r=0;r<e.shaderDescriptions.length;r++)if(e.shaderDescriptions[r].getType()===n)return e.shaderDescriptions[r];return null},t.addBindGroupLayout=n=>{n&&e.layouts.push({layout:n.getBindGroupLayout(e.device),label:n.getLabel()})},t.getBindGroupLayout=n=>e.layouts[n].layout,t.getBindGroupLayoutCount=n=>{for(let r=0;r<e.layouts.length;r++)if(e.layouts[r].label===n)return r;return 0},t.bindVertexInput=(n,r)=>{r.bindBuffers(n)}}const X$={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function mO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,X$,n),Yn(t,e),e.layouts=[],e.shaderDescriptions=[],ha(t,e,["handle","pipelineDescription"]),ri(t,e,["device","renderEncoder","topology","vertexState"]),Y$(t,e)}const Z$=An(mO,"vtkWebGPUPipeline");var Q$={newInstance:Z$,extend:mO};function J$(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=n=>e.outputNames.includes(n),t.addOutput=function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(n),e.outputNames.push(r),e.outputInterpolations.push(i)},t.addBuiltinOutput=(n,r)=>{e.builtinOutputTypes.push(n),e.builtinOutputNames.push(r)},t.addBuiltinInput=(n,r)=>{e.builtinInputTypes.push(n),e.builtinInputNames.push(r)},t.replaceShaderCode=(n,r)=>{const i=[];let a=[];if(r&&i.push(r.getShaderCode()),n||e.builtinInputNames.length){const o=[];if(o.push(`struct ${e.type}Input
{`),n){const s=n.getOutputNamesByReference(),c=n.getOutputTypesByReference(),u=n.getOutputInterpolationsByReference();for(let d=0;d<s.length;d++)u[d]!==void 0?o.push(`  @location(${d}) @interpolate(${u[d]}) ${s[d]} : ${c[d]},`):o.push(`  @location(${d}) ${s[d]} : ${c[d]},`)}for(let s=0;s<e.builtinInputNames.length;s++)o.push(`  ${e.builtinInputNames[s]} : ${e.builtinInputTypes[s]},`);o.length>1&&(o.push("};"),a=o,i[i.length-1]+=",",i.push(`input: ${e.type}Input`))}if(i.length&&(e.code=to.substitute(e.code,"//VTK::IOStructs::Input",i).result),e.outputNames.length+e.builtinOutputNames.length){const o=[`struct ${e.type}Output
{`];for(let s=0;s<e.outputNames.length;s++)e.outputInterpolations[s]!==void 0?o.push(`  @location(${s}) @interpolate(${e.outputInterpolations[s]}) ${e.outputNames[s]} : ${e.outputTypes[s]},`):o.push(`  @location(${s}) ${e.outputNames[s]} : ${e.outputTypes[s]},`);for(let s=0;s<e.builtinOutputNames.length;s++)o.push(`  ${e.builtinOutputNames[s]} : ${e.builtinOutputTypes[s]},`);o.push("};"),a=a.concat(o),e.code=to.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=to.substitute(e.code,"//VTK::IOStructs::Dec",a).result}}const eW={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function vO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eW,n),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],H.obj(t,e),H.setGet(t,e,["type","hash","code"]),H.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),J$(t,e)}const tW=H.newInstance(vO,"vtkWebGPUShaderDescription");var YT={newInstance:tW,extend:vO};const XT={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function nW(t){return!t||t.length<6?0:t in XT?XT[t]:(Wt(`unknown format ${t}`),null)}function rW(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));const n=e===1?t.length-1:t.length-3,r=Number(t[n]);if(Number.isNaN(r))return Wt(`unknown format ${t}`),0;const i=5-r/2;return e*i}function iW(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function aW(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{Wt(`unknown format ${t}`);return}const n=t.split("x")[0],r=Number(n[n.length-1]);if(Number.isNaN(r)){Wt(`unknown format ${t}`);return}return e+=8*(5-r/2),e+="Array",e}function oW(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{Wt(`unknown format ${t}`);return}let n=1;return t[t.length-2]==="x"&&(n=Number(t[t.length-1])),n===4?`vec4<${e}>`:n===3?`vec3<${e}>`:n===2?`vec2<${e}>`:e}function sW(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function cW(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";Wt(`unknown format ${t}`)}}var Os={getDetailsFromTextureFormat:nW,getByteStrideFromBufferFormat:rW,getNumberOfComponentsFromBufferFormat:iW,getNativeTypeFromBufferFormat:aW,getShaderTypeFromBufferFormat:oW,getByteStrideFromShaderFormat:sW,getNativeTypeFromShaderFormat:cW};function lW(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!e.includes(t[n]))return!1;return!0}function uW(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",a=r;Array.isArray(a)||(a=[a]);for(let o=0;o<e.inputs.length;o++)if(lW(e.inputs[o].names,a)){if(e.inputs[o].buffer===n)return;e.inputs[o].buffer=n;return}e.inputs.push({buffer:n,stepMode:i,names:a}),e.inputs=e.inputs.sort((o,s)=>o.names[0]<s.names[0]?-1:o.names[0]>s.names[0]?1:0)},t.removeBufferIfPresent=n=>{for(let r=0;r<e.inputs.length;r++)e.inputs[r].names.includes(n)&&e.inputs.splice(r,1)},t.getBuffer=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer;return null},t.hasAttribute=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return!0;return!1},t.getAttributeTime=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let n="",r=0;for(let i=0;i<e.inputs.length;i++)for(let a=0;a<e.inputs[i].names.length;a++){const o=e.inputs[i].buffer.getArrayInformation()[a],s=Os.getShaderTypeFromBufferFormat(o.format);r>0&&(n+=`,
`),n=`${n}  @location(${r}) ${e.inputs[i].names[a]} : ${s}`,r++}return n},t.getVertexInputInformation=()=>{const n={};if(e.inputs.length){const r=[];let i=0;for(let a=0;a<e.inputs.length;a++){const o=e.inputs[a].buffer,s={arrayStride:o.getStrideInBytes(),stepMode:e.inputs[a].stepMode,attributes:[]},c=o.getArrayInformation();for(let u=0;u<e.inputs[a].names.length;u++)s.attributes.push({shaderLocation:i,offset:c[u].offset,format:c[u].format}),i++;r.push(s)}n.buffers=r}return n},t.bindBuffers=n=>{for(let r=0;r<e.inputs.length;r++)n.setVertexBuffer(r,e.inputs[r].buffer.getHandle());e.indexBuffer&&n.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}const fW={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function yO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fW,n),Yn(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],ri(t,e,["created","device","handle","indexBuffer"]),uW(t,e)}const gW=An(yO,"vtkWebGPUVertexInput");var dW={newInstance:gW,extend:yO};const hW=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,pW=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function mW(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(n,r,i)=>{const a=YT.newInstance({type:"vertex",hash:n,code:e.vertexShaderTemplate}),o=YT.newInstance({type:"fragment",hash:n,code:e.fragmentShaderTemplate}),s=r.getShaderDescriptions();s.push(a),s.push(o);const c=e.vertexShaderTemplate+e.fragmentShaderTemplate,u=new RegExp("//VTK::[^:]*::","g"),g=c.match(u).filter((h,m,y)=>y.indexOf(h)===m).map(h=>`replaceShader${h.substring(7,h.length-2)}`);for(let h=0;h<g.length;h++){const m=g[h];m!=="replaceShaderIOStructs"&&e.shaderReplacements.has(m)&&e.shaderReplacements.get(m)(n,r,i)}t.replaceShaderIOStructs(n,r,i)},t.replaceShaderIOStructs=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.replaceShaderCode(null,i),r.getShaderDescription("fragment").replaceShaderCode(a)},t.replaceShaderRenderEncoder=(n,r,i)=>{e.renderEncoder.replaceShaderCode(r)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(n,r,i)=>{if(!e.WebGPURenderer)return;const a=e.WebGPURenderer.getBindGroup().getShaderCode(r),o=r.getShaderDescription("vertex");let s=o.getCode();s=to.substitute(s,"//VTK::Renderer::Dec",[a]).result,o.setCode(s);const c=r.getShaderDescription("fragment");s=c.getCode(),s=to.substitute(s,"//VTK::Renderer::Dec",[a]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(n,r,i)=>{const a=e.bindGroup.getShaderCode(r),o=r.getShaderDescription("vertex");let s=o.getCode();s=to.substitute(s,"//VTK::Mapper::Dec",[a]).result,o.setCode(s);const c=r.getShaderDescription("fragment");c.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),s=c.getCode(),s=to.substitute(s,"//VTK::Mapper::Dec",[a]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let o=a.getCode();o=to.substitute(o,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,a.setCode(o)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(n,r,i)=>{r.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=n=>{e.textureViews.includes(n)||e.textureViews.push(n)},t.prepareToDraw=n=>{e.renderEncoder=n,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=n=>{n.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=n=>{t.prepareToDraw(n),n.setPipeline(e.pipeline),t.draw(n)},t.draw=n=>{const r=n.getBoundPipeline();n.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(n),r.bindVertexInput(n,e.vertexInput);const i=e.vertexInput.getIndexBuffer();i?n.drawIndexed(i.getIndexCount(),e.numberOfInstances,0,0,0):n.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{const n=[...e.additionalBindables];e.UBO&&n.push(e.UBO),e.SSBO&&n.push(e.SSBO);for(let r=0;r<e.textureViews.length;r++){n.push(e.textureViews[r]);const i=e.textureViews[r].getSampler();i&&n.push(i)}return n},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=Q$.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}const vW={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function TO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vW,n),$r.extend(t,e,n),e.textureViews=[],e.vertexInput=dW.newInstance(),e.bindGroup=dO.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||pW,e.vertexShaderTemplate=e.vertexShaderTemplate||hW,e.shaderReplacements=new Map,H.get(t,e,["pipeline","vertexInput"]),H.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),mW(t,e)}const yW=H.newInstance(TO,"vtkWebGPUSimpleMapper");var TW={newInstance:yW,extend:TO};function CW(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),a.addOutput("vec4<f32>","vertexVC");let o=a.getCode();o=to.substitute(o,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,a.setCode(o)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{const n=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(n,["vertexBC"]),e.numberOfVertices=6}}const SW={};function CO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SW,n),TW.extend(t,e,n),CW(t,e)}const wW=H.newInstance(CO,"vtkWebGPUFullScreenQuad");var B4={newInstance:wW,extend:CO};const xW={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},EW={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6};var B1={BufferUsage:xW,PrimitiveTypes:EW};const x3=["getMappedRange","mapAsync","unmap"];function RW(t,e,n,r){const i=r.byteLength,a=t.createBuffer({size:i,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),o=a.getMappedRange(0,i);new Uint8Array(o).set(new Uint8Array(r)),a.unmap();const s=t.createCommandEncoder();s.copyBufferToBuffer(a,0,e,n,i);const c=s.finish();t.queue.submit([c]),a.destroy()}function OW(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n,usage:r,label:e.label}),e.sizeInBytes=n,e.usage=r},t.write=n=>{RW(e.device.getHandle(),e.handle,0,n.buffer)},t.createAndWrite=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n.byteLength,usage:r,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=n.byteLength,e.usage=r,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(n.buffer)),e.handle.unmap()};for(let n=0;n<x3.length;n++)t[x3[n]]=function(){return e.handle[x3[n]](...arguments)}}const DW={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function SO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DW,n),H.obj(t,e),H.get(t,e,["handle","sizeInBytes","usage"]),H.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),OW(t,e)}const _W=H.newInstance(SO);var $4={newInstance:_W,extend:SO,...B1};const{Representation:kg,Interpolation:Gg}=BR;function ZT(t){return()=>H.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function bW(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(n,r,i)=>{Array.isArray(n)?(e.color[0]!==n[0]||e.color[1]!==n[1]||e.color[2]!==n[2])&&(e.color[0]=n[0],e.color[1]=n[1],e.color[2]=n[2],t.modified()):(e.color[0]!==n||e.color[1]!==r||e.color[2]!==i)&&(e.color[0]=n,e.color[1]=r,e.color[2]=i,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=ZT("ComputeCompositeColor"),t.getColor=()=>{let n=0;e.ambient+e.diffuse+e.specular>0&&(n=1/(e.ambient+e.diffuse+e.specular));for(let r=0;r<3;r++)e.color[r]=n*(e.ambient*e.ambientColor[r]+e.diffuse*e.diffuseColor[r]+e.specular*e.specularColor[r]);return[].concat(e.color)},t.setSpecularPower=n=>{const r=1/Math.max(1,n);(e.roughness!==r||e.specularPower!==n)&&(e.specularPower=n,e.roughness=r,t.modified())},t.addShaderVariable=ZT("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation(Gg.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation(Gg.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation(Gg.PHONG),t.getInterpolationAsString=()=>H.enumToString(Gg,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(kg.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(kg.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(kg.POINTS),t.getRepresentationAsString=()=>H.enumToString(kg,e.representation)}const MW={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:Gg.GOURAUD,representation:kg.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null};function LW(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,MW,n),H.obj(t,e),H.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture"]),H.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),bW(t,e)}const VW=H.newInstance(LW,"vtkProperty");var $1={newInstance:VW,...BR};const{Representation:QT}=$1,{PrimitiveTypes:M0}=B1;class IW{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return!0}get(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return this.values[n]}set(e,n){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=n)}}function AW(t){switch(t){case M0.Points:return"points";case M0.Lines:return"lines";case M0.Triangles:case M0.TriangleEdges:return"polys";case M0.TriangleStripEdges:case M0.TriangleStrips:return"strips";default:return""}}function lh(t,e,n){let r=t.pointIdToFlatId[e];return r<0&&(r=t.flatId,t.pointIdToFlatId[e]=r,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=n,t.flatId++),r}function NW(t,e,n){const r=t.length;for(let o=0;o<r;o++){let s=t[o];if(n.cellProvokedMap.has(s)){n.ibo[n.iboId++]=n.cellProvokedMap.get(s);for(let c=o+1;c<o+r;c++){s=t[c%r];const u=lh(n,s,e);n.ibo[n.iboId++]=u}return}}for(let o=0;o<r;o++){let s=t[o];if(!n.provokedPointIds[s]){let c=lh(n,s,e);n.provokedPointIds[s]=1,n.cellProvokedMap.set(s,c),n.flatIdToCellId[c]=e,n.ibo[n.iboId++]=c;for(let u=o+1;u<o+r;u++)s=t[u%r],c=lh(n,s,e),n.ibo[n.iboId++]=c;return}}let i=t[0],a=n.flatId;n.cellProvokedMap.set(i,a),n.flatIdToPointId[n.flatId]=i,n.flatIdToCellId[n.flatId]=e,n.flatId++,n.ibo[n.iboId++]=a;for(let o=1;o<r;o++)i=t[o],a=lh(n,i,e),n.ibo[n.iboId++]=a}function PW(t,e,n){const r=t.length;n.iboSize+=r;for(let i=0;i<r;i++){const a=t[i];if(n.cellProvokedMap.has(a))return}for(let i=0;i<r;i++){const a=t[i];if(!n.provokedPointIds[a]){n.provokedPointIds[a]=1,n.cellProvokedMap.set(a,1);return}}n.cellProvokedMap.set(t[0],1),n.extraPoints++}let Oc;const JT=new Uint32Array(1),Eo=new Uint32Array(2),x0=new Uint32Array(3),E3={anythingToPoints(t,e,n,r,i){for(let a=0;a<t;++a)JT[0]=e[n+a],Oc(JT,r,i)},linesToWireframe(t,e,n,r,i){for(let a=0;a<t-1;++a)Eo[0]=e[n+a],Eo[1]=e[n+a+1],Oc(Eo,r,i)},polysToWireframe(t,e,n,r,i){if(t>2)for(let a=0;a<t;++a)Eo[0]=e[n+a],Eo[1]=e[n+(a+1)%t],Oc(Eo,r,i)},stripsToWireframe(t,e,n,r,i){if(t>2){for(let a=0;a<t-1;++a)Eo[0]=e[n+a],Eo[1]=e[n+a+1],Oc(Eo,r,i);for(let a=0;a<t-2;a++)Eo[0]=e[n+a],Eo[1]=e[n+a+2],Oc(Eo,r,i)}},polysToSurface(t,e,n,r,i){for(let a=0;a<t-2;a++)x0[0]=e[n],x0[1]=e[n+a+1],x0[2]=e[n+a+2],Oc(x0,r,i)},stripsToSurface(t,e,n,r,i){for(let a=0;a<t-2;a++)x0[0]=e[n+a],x0[1]=e[n+a+1+a%2],x0[2]=e[n+a+1+(a+1)%2],Oc(x0,r,i)}};function UW(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=n=>{const r=n.cells,i=n.primitiveType,a=n.representation,o=n.cellOffset,s=r.getData(),c=s.length,u=AW(i),d=n.numberOfPoints,g={provokedPointIds:new Uint8Array(d),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new IW};let h=null;a===QT.POINTS||i===M0.Points?h=E3.anythingToPoints:a===QT.WIREFRAME||i===M0.Lines?h=E3[`${u}ToWireframe`]:h=E3[`${u}ToSurface`],Oc=PW;let m=o||0;for(let y=0;y<c;)g.cellProvokedMap.clear(),h(s[y],s,y+1,m,g),y+=s[y]+1,m++;d<=65535?g.flatIdToPointId=new Uint16Array(d+g.extraPoints):g.flatIdToPointId=new Uint32Array(d+g.extraPoints),d+g.extraPoints<36863?g.pointIdToFlatId=new Int16Array(d):g.pointIdToFlatId=new Int32Array(d),d+g.extraPoints<=65535?(g.ibo=new Uint16Array(g.iboSize),n.format="uint16"):(g.ibo=new Uint32Array(g.iboSize),n.format="uint32"),m<=65535?g.flatIdToCellId=new Uint16Array(d+g.extraPoints):g.flatIdToCellId=new Uint32Array(d+g.extraPoints),g.pointIdToFlatId.fill(-1),g.provokedPointIds.fill(0),Oc=NW,m=o||0;for(let y=0;y<c;)g.cellProvokedMap.clear(),h(s[y],s,y+1,m,g),y+=s[y]+1,m++;delete g.provokedPointIds,delete g.pointIdToFlatId,n.nativeArray=g.ibo,e.flatIdToPointId=g.flatIdToPointId,e.flatIdToCellId=g.flatIdToCellId,e.flatSize=g.flatId,e.indexCount=g.iboId}}const FW={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function wO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FW,n),$4.extend(t,e,n),H.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),UW(t,e)}const kW=H.newInstance(wO);var GW={newInstance:kW,extend:wO,...B1};const{BufferUsage:E0}=B1,{vtkErrorMacro:BW}=Zi,{VtkDataTypes:gl}=Pt,$W={};function WW(t){let e;switch(t.getDataType()){case gl.UNSIGNED_CHAR:e="uint8";break;case gl.FLOAT:e="float32";break;case gl.UNSIGNED_INT:e="uint32";break;case gl.INT:e="sint32";break;case gl.DOUBLE:e="float32";break;case gl.UNSIGNED_SHORT:e="uint16";break;case gl.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||BW(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function eC(t,e,n,r,i){const a={},o=t.getFlatSize();if(!o)return a;let s=[0,0,0,0];i.shift&&(i.shift.length?s=i.shift:s.fill(i.shift));let c=[1,1,1,1];i.scale&&(i.scale.length?c=i.scale:c.fill(i.scale));const u=Object.prototype.hasOwnProperty.call(i,"packExtra")?i.packExtra:!1;let d,g=0;const h=n+(u?1:0),m=yf(r,o*h);let y=t.getFlatIdToPointId();i.cellData&&(y=t.getFlatIdToCellId()),n===1?d=function(C){m[g++]=c[0]*e[C]+s[0]}:n===2?d=function(C){m[g++]=c[0]*e[C]+s[0],m[g++]=c[1]*e[C+1]+s[1]}:n===3&&!u?d=function(C){m[g++]=c[0]*e[C]+s[0],m[g++]=c[1]*e[C+1]+s[1],m[g++]=c[2]*e[C+2]+s[2]}:n===3&&u?d=function(C){m[g++]=c[0]*e[C]+s[0],m[g++]=c[1]*e[C+1]+s[1],m[g++]=c[2]*e[C+2]+s[2],m[g++]=c[3]*1+s[3]}:n===4&&(d=function(C){m[g++]=c[0]*e[C]+s[0],m[g++]=c[1]*e[C+1]+s[1],m[g++]=c[2]*e[C+2]+s[2],m[g++]=c[3]*e[C+3]+s[3]});for(let v=0;v<o;v++){const C=n*y[v];d(C)}return a.nativeArray=m,a}function zW(t,e,n,r){const i=[t[r*3]-t[n*3],t[r*3+1]-t[n*3+1],t[r*3+2]-t[n*3+2]],a=[t[e*3]-t[n*3],t[e*3+1]-t[n*3+1],t[e*3+2]-t[n*3+2]],o=[];return Ns(i,a,o),kl(o),o}function HW(t,e){const n=e.getData(),r=t.getData();if(!r||!n)return null;const i=new Int8Array(t.getNumberOfCells()*4),a=r.length;let o=0;for(let s=0;s<a;){const c=zW(n,r[s+1],r[s+2],r[s+3]);i[o++]=127*c[0],i[o++]=127*c[1],i[o++]=127*c[2],i[o++]=127,s+=r[s]+1}return i}function jW(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function n(r){r.dataArray&&!r.nativeArray&&(r.nativeArray=r.dataArray.getData());let i,a;if(r.usage===E0.Index&&(i=GW.newInstance({label:r.label}),i.setDevice(e.device),a=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,i.buildIndexBuffer(r),i.createAndWrite(r.nativeArray,a),i.setArrayInformation([{format:r.format}])),i||(i=$4.newInstance({label:r.label}),i.setDevice(e.device)),r.usage===E0.UniformArray&&(a=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i.createAndWrite(r.nativeArray,a)),r.usage===E0.Storage&&(a=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,i.createAndWrite(r.nativeArray,a)),r.usage===E0.Texture&&(a=GPUBufferUsage.COPY_SRC,i.createAndWrite(r.nativeArray,a)),r.usage===E0.PointArray){a=GPUBufferUsage.VERTEX;const o=Os.getNativeTypeFromBufferFormat(r.format),s=eC(r.indexBuffer,r.dataArray.getData(),r.dataArray.getNumberOfComponents(),o,{packExtra:r.packExtra,shift:r.shift,scale:r.scale,cellData:r.cellData,cellOffset:r.cellOffset});i.createAndWrite(s.nativeArray,a),i.setStrideInBytes(Os.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format,interpolation:r.cellData?"flat":"perspective"}])}if(r.usage===E0.NormalsFromPoints){a=GPUBufferUsage.VERTEX;const o=Os.getNativeTypeFromBufferFormat(r.format),s=HW(r.cells,r.dataArray),c=eC(r.indexBuffer,s,4,o,{cellData:!0});i.createAndWrite(c.nativeArray,a),i.setStrideInBytes(Os.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format,interpolation:"flat"}])}return r.usage===E0.RawVertex&&(a=GPUBufferUsage.VERTEX,i.createAndWrite(r.nativeArray,a),i.setStrideInBytes(Os.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format}])),i.setSourceTime(r.time),i}t.hasBuffer=r=>e.device.hasCachedObject(r),t.getBuffer=r=>r.hash?e.device.getCachedObject(r.hash,n,r):n(r),t.getBufferForPointArray=(r,i)=>{const a=WW(r),o={hash:`${r.getMTime()}I${i.getMTime()}${a}`,usage:E0.PointArray,format:a,dataArray:r,indexBuffer:i};return t.getBuffer(o)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=$4.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);const r=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(r,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}const qW={device:null,fullScreenQuadBuffer:null};function KW(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qW,n),Yn(t,e),ri(t,e,["device"]),jW(t,e)}An(KW);var xO={...$W,...B1};const{BufferUsage:YW}=xO,{vtkErrorMacro:Du}=H;function XW(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){Du(`entry named ${n} already exists`);return}e._bufferEntryNames.set(n,e.bufferEntries.length);const i=Os.getByteStrideFromShaderFormat(r);e.bufferEntries.push({name:n,type:r,sizeInBytes:i,offset:e.sizeInBytes,nativeType:Os.getNativeTypeFromShaderFormat(r)}),e.sizeInBytes+=i},t.send=n=>{if(!e._buffer){const r={nativeArray:e.Float32Array,usage:YW.Storage,label:e.label};e._buffer=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e._sendTime.modified();return}n.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[n]=H.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r,i)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){Du(`entry named ${n} not found in UBO`);return}const o=e.bufferEntries[a];t.createView(o.nativeType);const s=e[o.nativeType];s[(o.offset+r*e.sizeInBytes)/s.BYTES_PER_ELEMENT]=i},t.setArray=(n,r,i)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){Du(`entry named ${n} not found in UBO`);return}const o=e.bufferEntries[a];t.createView(o.nativeType);const s=e[o.nativeType],c=(o.offset+r*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let u=0;u<i.length;u++)s[c+u]=i[u]},t.setAllInstancesFromArray=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){Du(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],s=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const u=(a.offset+c*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let d=0;d<s;d++)o[u+d]=r[c*s+d]}},t.setAllInstancesFromArrayColorToFloat=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){Du(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],s=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const u=(a.offset+c*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let d=0;d<s;d++)o[u+d]=r[c*s+d]/255}},t.setAllInstancesFromArray3x3To4x4=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){Du(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],s=9;for(let c=0;c<e.numberOfInstances;c++){const u=(a.offset+c*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let d=0;d<3;d++)for(let g=0;g<3;g++)o[u+d*4+g]=r[c*s+d*3+g]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(n,r)=>{const i=[`struct ${e.label}StructEntry
{`];for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];i.push(`  ${o.name}: ${o.type},`)}return i.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${n}) @group(${r}) var<storage, read> ${e.label}: ${e.label}Struct;
`),i.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}const ZW={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function EO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZW,n),H.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},H.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},H.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},H.get(t,e,["bindGroupTime"]),H.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),XW(t,e)}const QW=H.newInstance(EO,"vtkWebGPUStorageBuffer");var JW={newInstance:QW,extend:EO};const{BufferUsage:ez}=xO,{vtkErrorMacro:R3}=H;function tz(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){R3(`entry named ${n} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(n,e.bufferEntries.length),e.bufferEntries.push({name:n,type:r,sizeInBytes:Os.getByteStrideFromShaderFormat(r),offset:-1,nativeType:Os.getNativeTypeFromShaderFormat(r),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let n=0;const r=[];let i=4;for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];o.sizeInBytes%16===0&&(i=Math.max(16,i)),o.sizeInBytes%8===0&&(i=Math.max(8,i))}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];o.packed===!1&&o.sizeInBytes%16===0&&(o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes)}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];if(o.packed===!1&&o.sizeInBytes===12)for(let s=0;s<e.bufferEntries.length;s++){const c=e.bufferEntries[s];if(c.packed===!1&&c.sizeInBytes===4){o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];if(!o.packed&&o.sizeInBytes%8===0)for(let s=a+1;s<e.bufferEntries.length;s++){const c=e.bufferEntries[s];if(!c.packed&&c.sizeInBytes%8===0){o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];if(!o.packed&&o.sizeInBytes%8===0){let s=!1;for(let c=0;!s&&c<e.bufferEntries.length;c++){const u=e.bufferEntries[c];if(!u.packed&&u.sizeInBytes===4)for(let d=c+1;d<e.bufferEntries.length;d++){const g=e.bufferEntries[d];if(!g.packed&&g.sizeInBytes===4){o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes,u.packed=!0,u.offset=n,r.push(u),n+=u.sizeInBytes,g.packed=!0,g.offset=n,r.push(g),n+=g.sizeInBytes,s=!0;break}}}}}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];!o.packed&&o.sizeInBytes>4&&(o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes)}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];o.packed||(o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes)}e.bufferEntries=r,e._bufferEntryNames.clear();for(let a=0;a<e.bufferEntries.length;a++)e._bufferEntryNames.set(e.bufferEntries[a].name,a);e.sizeInBytes=n,e.sizeInBytes=i*Math.ceil(e.sizeInBytes/i),e.sortDirty=!1},t.sendIfNeeded=n=>{if(!e.UBO){const r={nativeArray:e.Float32Array,usage:ez.UniformArray,label:e.label};e.UBO=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(n.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[n]=H.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(n);if(i===void 0){R3(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType];a.lastValue!==r&&(o[a.offset/o.BYTES_PER_ELEMENT]=r,e.sendDirty=!0),a.lastValue=r},t.setArray=(n,r)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(n);if(i===void 0){R3(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType];let s=!1;for(let c=0;c<r.length;c++)(!a.lastValue||a.lastValue[c]!==r[c])&&(o[a.offset/o.BYTES_PER_ELEMENT+c]=r[c],s=!0);s&&(e.sendDirty=!0,a.lastValue=[...r])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(n,r)=>{t.sortBufferEntries();const i=[`struct ${e.label}Struct
{`];for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];i.push(`  ${o.name}: ${o.type},`)}return i.push(`};
@binding(${n}) @group(${r}) var<uniform> ${e.label}: ${e.label}Struct;`),i.join(`
`)}}const nz={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function RO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nz,n),H.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},H.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},H.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,H.get(t,e,["binding","bindGroupTime"]),H.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),tz(t,e)}const rz=H.newInstance(RO,"vtkWebGPUUniformBuffer");var e1={newInstance:rz,extend:RO};const{vtkDebugMacro:iz}=Zi,tC=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,az=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,uh=new Float64Array(16),nC=new Float64Array(16);function oz(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function sz(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{const n=e.camera.getClippingRange(),r=e.camera.getPositionByReference(),i=e.camera.getDirectionOfProjectionByReference(),a=[],o=[];bs(o,i,.5*(n[0]+n[1])),z0(a,r,o),hn(o,a,e.stabilizedCenter),A2(o)/(n[1]-n[0])>e.recenterThreshold&&(e.stabilizedCenter=a,e.stabilizedTime.modified())},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let i=0;i<r.length;++i)r[i].getSwitch()>0&&n++;return n||(iz("No lights are on, creating one."),e.renderable.createLight()),n},t.updateUBO=()=>{const n=e.UBO.getSendTime();if(e._parent.getMTime()>n||t.getMTime()>n||e.camera.getMTime()>n||e.renderable.getMTime()>n){const r=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",r.wcvc),e.UBO.setArray("SCPCMatrix",r.scpc),e.UBO.setArray("PCSCMatrix",r.pcsc),e.UBO.setArray("SCVCMatrix",r.scvc),e.UBO.setArray("VCPCMatrix",r.vcpc),e.UBO.setArray("WCVCNormals",r.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",e.renderable.getEnvironmentTexture()?.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());const i=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[i.usize,i.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());const a=e._parent.getDevice();e.UBO.sendIfNeeded(a)}},t.updateSSBO=()=>{const n=e.renderable.getLights(),r=e.webgpuCamera.getKeyMatrices(t);let i=`${e.renderable.getMTime()}`;for(let a=0;a<n.length;a++)i+=n[a].getMTime();if(i!==e.lightTimeString){const a=new Float32Array(n.length*4),o=new Float32Array(n.length*4),s=new Float32Array(n.length*4),c=new Float32Array(n.length*4);for(let d=0;d<n.length;d++){const g=d*4,h=n[d].getPosition();an(h,h,r.wcvc),a[g]=h[0],a[g+1]=h[1],a[g+2]=h[2],a[g+3]=0,o[g]=-n[d].getDirection()[0],o[g+1]=-n[d].getDirection()[1],o[g+2]=-n[d].getDirection()[2],o[g+3]=0,s[g]=n[d].getColor()[0],s[g+1]=n[d].getColor()[1],s[g+2]=n[d].getColor()[2],s[g+3]=n[d].getIntensity()*5,c[g]=oz(n[d]),c[g+1]=Math.cos(ur(n[d].getConeAngle())),c[g+2]=Math.cos(ur(n[d].getConeAngle()+n[d].getConeFalloff())),c[g+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(n.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",a),e.SSBO.setAllInstancesFromArray("LightDir",o),e.SSBO.setAllInstancesFromArray("LightColor",s),e.SSBO.setAllInstancesFromArray("LightData",c);const u=e._parent.getDevice();e.SSBO.send(u)}e.lightTimeString=i},t.scissorAndViewport=n=>{const r=t.getYInvertedTiledSizeAndOrigin();n.getHandle().setViewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize,0,1),n.getHandle().setScissorRect(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)},t.bindUBO=n=>{n.activateBindGroup(e.bindGroup)},t.opaquePass=n=>{n?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{if(e.renderable.getTransparent()||e.suppressClear)return;const n=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=B4.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(tC);const a=e1.newInstance({label:"mapperUBO"});a.addEntry("FSQMatrix","mat4x4<f32>"),a.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(a),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&e.backgroundTex?.getImageLoaded()){e.clearFSQ.setFragmentShaderTemplate(az);const a=e1.newInstance({label:"mapperUBO"});a.addEntry("FSQMatrix","mat4x4<f32>"),a.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(a);const o=n.getTextureManager().getTextureForVTKTexture(e.backgroundTex);if(o.getReady()){const s=o.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([s]),e.backgroundTexLoaded=!0;const c=e.backgroundTex.getInterpolate()?"linear":"nearest";s.addSampler(n,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:c,magFilter:c,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=B4.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(tC);const a=e1.newInstance({label:"mapperUBO"});a.addEntry("FSQMatrix","mat4x4<f32>"),a.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(a)}const r=e.webgpuCamera.getKeyMatrices(t),i=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",i),Qt(nC,r.normalMatrix),V2(uh,r.scvc,r.pcsc),V2(uh,nC,uh),e.clearFSQ.getUBO().setArray("FSQMatrix",uh),e.clearFSQ.getUBO().sendIfNeeded(n),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.convertToOpenGLDepth=n=>e.webgpuCamera.convertToOpenGLDepth(n),t.getYInvertedTiledSizeAndOrigin=()=>{const n=t.getTiledSizeAndOrigin(),r=e._parent.getSizeByReference();return n.lowerLeftV=r[1]-n.vsize-n.lowerLeftV,n},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],i=n[0]-r[0],a=n[1]-r[1],o=e._parent.normalizedDisplayToDisplay(i,a),s=Math.round(o[0]),c=Math.round(o[1]),u=n[2]-r[0],d=n[3]-r[1],g=e._parent.normalizedDisplayToDisplay(u,d);let h=Math.round(g[0])-s,m=Math.round(g[1])-c;return h<0&&(h=0),m<0&&(m=0),{usize:h,vsize:m,lowerLeftU:s,lowerLeftV:c}},t.getPropFromID=n=>{for(let r=0;r<e.children.length;r++)if((e.children[r].getPropID?e.children[r].getPropID():-1)===n)return e.children[r];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}const cz={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function lz(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cz,n),$r.extend(t,e,n),e.UBO=e1.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=JW.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=dO.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=wt(new Float64Array(16)),e.stabilizedTime={},Yn(e.stabilizedTime,{mtime:0}),ha(t,e,["bindGroup","stabilizedTime"]),Tf(t,e,["stabilizedCenter"]),ri(t,e,["renderEncoder","selector","suppressClear","UBO"]),sz(t,e)}const uz=An(lz,"vtkWebGPURenderer");wf("vtkRenderer",uz);function fz(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=n,e.options.addressModeU=r.addressModeU?r.addressModeU:"clamp-to-edge",e.options.addressModeV=r.addressModeV?r.addressModeV:"clamp-to-edge",e.options.addressModeW=r.addressModeW?r.addressModeW:"clamp-to-edge",e.options.magFilter=r.magFilter?r.magFilter:"nearest",e.options.minFilter=r.minFilter?r.minFilter:"nearest",e.options.mipmapFilter=r.mipmapFilter?r.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(n,r)=>`@binding(${n}) @group(${r}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}const gz={device:null,handle:null,label:null,options:null};function OO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gz,n),H.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},H.obj(e.bindGroupTime,{mtime:0}),H.get(t,e,["bindGroupTime","handle","options"]),H.setGet(t,e,["bindGroupLayoutEntry","device","label"]),fz(t,e)}const dz=H.newInstance(OO);var hz={newInstance:dz,extend:OO};const{SlicingMode:rC}=Ep,pz=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Image::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  //VTK::Image::Sample

  // var computedColor: vec4<f32> = vec4<f32>(1.0,0.7, 0.5, 1.0);

//VTK::RenderEncoder::Impl

  return output;
}
`;function mz(t,e,n){if(e.apply(t)){const i=t.getIndependentComponents();return`${t.getMTime()}-${i}-${n}`}return"0"}const Za=new Float64Array(16),ws=new Float64Array(16),fh=new Float64Array(16),Sc=new Float64Array(4),Qr=new Float64Array(4);function vz(t,e){e.classHierarchy.push("vtkWebGPUImageMapper"),t.buildPass=i=>{if(i){e.WebGPUImageSlice=t.getFirstAncestorOfType("vtkWebGPUImageSlice"),e.WebGPURenderer=e.WebGPUImageSlice.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice();const a=e.WebGPURenderer.getRenderable();e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(a.getActiveCamera())}},t.translucentPass=i=>{i&&t.render()},t.opaquePass=i=>{i&&t.render()},t.render=()=>{e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw)},t.computePipelineHash=()=>{const i=e.currentInput.getExtent();i[0]===i[1]||i[2]===i[3]||i[4]===i[5]?(e.dimensions=2,e.pipelineHash="img2"):(e.dimensions=3,e.pipelineHash="img3")},t.updateUBO=()=>{const i=e.UBO.getSendTime(),a=e.WebGPUImageSlice.getRenderable(),o=a.getMapper();if(t.getMTime()>i||e.renderable.getMTime()>i||a.getProperty().getMTime()>i){const s=o.getInputData(),c=e.WebGPURenderer.getStabilizedCenterByReference();wt(Za),Gr(Za,Za,c);const u=a.getMatrix();Qt(ws,u),Br(ws,ws),zt(Za,ws,Za);const d=s.getWorldToIndex();zt(Za,d,Za),Br(fh,Za),k1(ws,[.5,.5,.5]),zt(Za,ws,Za);const g=s.getDimensions();wt(ws),Us(ws,ws,[1/g[0],1/g[1],1/g[2]]),zt(Za,ws,Za),e.UBO.setArray("SCTCMatrix",Za);const h=e.currentInput.getExtent(),{ijkMode:m}=e.renderable.getClosestIJKAxis();let y=e.renderable.getSlice();m!==e.renderable.getSlicingMode()&&(y=e.renderable.getSliceAtPosition(y));let v=2,C=0,S=1;m===rC.I?(v=0,C=1,S=2):m===rC.J&&(v=1,C=2,S=0),Sc[v]=y,Sc[C]=h[C*2]-.5,Sc[S]=h[S*2]-.5,Sc[3]=1,bl(Sc,Sc,fh),e.UBO.setArray("Origin",Sc),Qr[v]=y,Qr[C]=h[C*2+1]+.5,Qr[S]=h[S*2]-.5,Qr[3]=1,bl(Qr,Qr,fh),VT(Qr,Qr,Sc),Qr[3]=1,e.UBO.setArray("Axis1",Qr),Qr[v]=y,Qr[C]=h[C*2]-.5,Qr[S]=h[S*2+1]+.5,Qr[3]=1,bl(Qr,Qr,fh),VT(Qr,Qr,Sc),Qr[3]=1,e.UBO.setArray("Axis2",Qr);const w=[1,1,1,1],x=[0,0,0,0],R=e.textureViews[0],O=R.getTexture().getScale(),b=R.getTexture().getNumberOfComponents();for(let I=0;I<b;I++){let G=a.getProperty().getColorWindow(),j=a.getProperty().getColorLevel();const $=a.getProperty().getRGBTransferFunction(0);if($){const z=$.getRange();G=z[1]-z[0],j=.5*(z[1]+z[0])}w[I]=O/G,x[I]=-j/G+.5}e.UBO.setArray("cScale",w),e.UBO.setArray("cShift",x),e.UBO.sendIfNeeded(e.device)}},t.updateLUTImage=()=>{const i=e.WebGPUImageSlice.getRenderable().getProperty();t.getTextureViews()[0].getTexture().getNumberOfComponents();const o=1,s=mz(i,i.getRGBTransferFunction,o);if(e.colorTextureString!==s){e.numRows=o;const c=new Uint8ClampedArray(e.numRows*2*e.rowLength*4);let u=i.getRGBTransferFunction();if(u){const d=new Float32Array(e.rowLength*3);for(let g=0;g<o;g++){u=i.getRGBTransferFunction(g);const h=u.getRange();u.getTable(h[0],h[1],e.rowLength,d,1);for(let m=0;m<e.rowLength;m++){const y=g*e.rowLength*8+m*4;c[y]=255*d[m*3],c[y+1]=255*d[m*3+1],c[y+2]=255*d[m*3+2],c[y+3]=255;for(let v=0;v<4;v++)c[y+e.rowLength*4+v]=c[y+v]}}}else for(let d=0;d<e.rowLength;++d){const g=255*d/(e.rowLength-1);c[d*4]=g,c[d*4+1]=g,c[d*4+2]=g,c[d*4+3]=255;for(let h=0;h<4;h++)c[d*4+e.rowLength*4+h]=c[d*4+h]}{const d={nativeArray:c,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},h=e.device.getTextureManager().getTexture(d).createView("tfunTexture");e.textureViews[1]=h}e.colorTextureString=s}};const n=t.updateBuffers;t.updateBuffers=()=>{n();const i=e.device.getTextureManager().getTextureForImageData(e.currentInput),a=e.textureViews;if(!a[0]||a[0].getTexture()!==i){const c=i.createView("imgTexture");a[0]=c}t.updateLUTImage(),t.updateUBO();const s=e.WebGPUImageSlice.getRenderable().getProperty().getInterpolationType()===Il.NEAREST?"nearest":"linear";(!e.clampSampler||s!==e.clampSampler.getOptions().minFilter)&&(e.clampSampler=hz.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:s,magFilter:s}),e.additionalBindables=[e.clampSampler])};const r=t.getShaderReplacements();t.replaceShaderPosition=(i,a,o)=>{const s=a.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let c=s.getCode();const u=["var pos: vec4<f32> = mapperUBO.Origin +","   (vertexBC.x * 0.5 + 0.5) * mapperUBO.Axis1 + (vertexBC.y * 0.5 + 0.5) * mapperUBO.Axis2;","pos.w = 1.0;"];e.dimensions===2?u.push("var tcoord : vec2<f32> = (mapperUBO.SCTCMatrix * pos).xy;"):u.push("var tcoord : vec3<f32> = (mapperUBO.SCTCMatrix * pos).xyz;"),u.push("output.tcoordVS = tcoord;","output.Position = rendererUBO.SCPCMatrix * pos;"),c=to.substitute(c,"//VTK::Position::Impl",u).result,s.setCode(c)},r.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(i,a,o)=>{const s=a.getShaderDescription("vertex");e.dimensions===2?s.addOutput("vec2<f32>","tcoordVS"):s.addOutput("vec3<f32>","tcoordVS")},r.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderImage=(i,a,o)=>{const s=a.getShaderDescription("fragment");let c=s.getCode();e.dimensions===3?c=to.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result:c=to.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result,c=to.substitute(c,"//VTK::Image::Sample",["    var coord: vec2<f32> =","      vec2<f32>(computedColor.r * mapperUBO.cScale.r + mapperUBO.cShift.r, 0.5);","    computedColor = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);"]).result,s.setCode(c)},r.set("replaceShaderImage",t.replaceShaderImage)}const yz={rowLength:1024};function Tz(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yz,n),B4.extend(t,e,n),t.setFragmentShaderTemplate(pz),e.UBO=e1.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.UBO.addEntry("Origin","vec4<f32>"),e.UBO.addEntry("Axis2","vec4<f32>"),e.UBO.addEntry("Axis1","vec4<f32>"),e.UBO.addEntry("cScale","vec4<f32>"),e.UBO.addEntry("cShift","vec4<f32>"),e.lutBuildTime={},Yn(e.lutBuildTime,{mtime:0}),e.imagemat=wt(new Float64Array(16)),e.imagematinv=wt(new Float64Array(16)),e.VBOBuildTime={},Yn(e.VBOBuildTime),vz(t,e)}const Cz=An(Tz,"vtkWebGPUImageMapper");wf("vtkImageMapper",Cz);function Sz(t,e){e.classHierarchy.push("vtkWebGPUImageSlice"),t.buildPass=n=>{if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const r=e.renderable.getMatrix(),i=n.getStabilizedCenterByReference();e.bufferShift[0]=r[3]-i[0],e.bufferShift[1]=r[7]-i[1],e.bufferShift[2]=r[11]-i[2],Qt(e.keyMatrices.bcwc,r),e.renderable.getIsIdentity()?wt(e.keyMatrices.normalMatrix):(_r(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Br(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Qt(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),Gr(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),Gr(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-i[0],-i[1],-i[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const wz={bufferShift:void 0,keyMatrixTime:null,keyMatrices:null,propID:void 0};function xz(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wz,n),$r.extend(t,e,n),e.keyMatricesTime={},Yn(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},e.keyMatrixTime={},Yn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:wt(new Float64Array(16))},e.bufferShift=[0,0,0,0],ha(t,e,["propID","keyMatricesTime"]),Sz(t,e)}const Ez=An(xz,"vtkWebGPUImageSlice");wf("vtkImageSlice",Ez);function Rz(t,e){e.classHierarchy.push("vtkWebGPUVolume"),t.buildPass=i=>{!e.renderable||!e.renderable.getVisibility()||i&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),e.renderable.getMapper().update())},t.queryPass=(i,a)=>{if(i){if(!e.renderable||!e.renderable.getVisibility())return;const o=e.renderable.getMapper().getBounds();if(!o||o.length!==6||o[0]>o[1])return;a.addVolume(t)}};const n=new Float64Array(3),r=new Float64Array(3);t.getBoundingCubePoints=(i,a)=>{const o=e.renderable.getMapper().getInputData();if(!o)return;const s=o.getExtent(),c=e.renderable.getMatrix();let u=0;for(let d=4;d<6;d++){n[2]=s[d];for(let g=2;g<4;g++){n[1]=s[g];for(let h=0;h<2;h++){n[0]=s[h],o.indexToWorld(n,r);let m=a+u*3;i[m++]=c[0]*r[0]+c[1]*r[1]+c[2]*r[2]+c[3],i[m++]=c[4]*r[0]+c[5]*r[1]+c[6]*r[2]+c[7],i[m++]=c[8]*r[0]+c[9]*r[1]+c[10]*r[2]+c[11],u++}}}},t.getKeyMatrices=i=>{if(Math.max(e.renderable.getMTime(),i.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const a=e.renderable.getMatrix(),o=i.getStabilizedCenterByReference();Qt(e.keyMatrices.bcwc,a),Gr(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-o[0],-o[1],-o[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const Oz={propID:void 0,keyMatricesTime:null};function Dz(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Oz,n),$r.extend(t,e,n),e.keyMatricesTime={},H.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={bcwc:new Float64Array(16),bcsc:new Float64Array(16)},H.get(t,e,["propID","keyMatricesTime"]),Rz(t,e)}const _z=H.newInstance(Dz,"vtkWebGPUVolume");wf("vtkVolume",_z);function bz(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();const i=e.WebGPURenderer.getAspectRatio(),a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,o=e.WebGPURenderer.getTiledSizeAndOrigin(),s=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),a,i,o,s)}}const Mz={};function Lz(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Mz,n),$r.extend(t,e,n),bz(t,e)}const Vz=H.newInstance(Lz,"vtkWebGPUPixelSpaceCallbackMapper");wf("vtkPixelSpaceCallbackMapper",Vz);const Xo={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var DO={StructuredType:Xo};const{StructuredType:wc}=DO;function Iz(t){let e=0;for(let n=0;n<3;++n)t[n*2]<t[n*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?wc.EMPTY:e===3?wc.XYZ_GRID:e===2?t[0]===t[1]?wc.YZ_PLANE:t[2]===t[3]?wc.XZ_PLANE:wc.XY_PLANE:e===1?t[0]<t[1]?wc.X_LINE:t[2]<t[3]?wc.Y_LINE:wc.Z_LINE:wc.SINGLE_POINT}var Az={getDataDescriptionFromExtent:Iz,...DO};const{vtkErrorMacro:dl}=H;function Nz(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return dl("instance deleted - cannot call any method"),!1;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];const a=r.length===1?r[0]:r;if(a.length!==6)return!1;const o=e.extent.some((s,c)=>s!==a[c]);return o&&(e.extent=a.slice(),e.dataDescription=Az.getDataDescriptionFromExtent(e.extent),t.modified()),o},t.setDimensions=function(){let n,r,i;if(e.deleted){dl("instance deleted - cannot call any method");return}if(arguments.length===1){const a=arguments.length<=0?void 0:arguments[0];n=a[0],r=a[1],i=a[2]}else if(arguments.length===3)n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],i=arguments.length<=2?void 0:arguments[2];else{dl("Bad dimension specification");return}t.setExtent(0,n-1,0,r-1,0,i-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{const n=t.getDimensions();let r=1;for(let i=0;i<3;i++){if(n[i]===0)return 0;n[i]>1&&(r*=n[i]-1)}return r},t.getNumberOfPoints=()=>{const n=t.getDimensions();return n[0]*n[1]*n[2]},t.getPoint=n=>{const r=t.getDimensions();if(r[0]===0||r[1]===0||r[2]===0)return dl("Requesting a point from an empty image."),null;const i=new Float64Array(3);switch(e.dataDescription){case Xo.EMPTY:return null;case Xo.SINGLE_POINT:break;case Xo.X_LINE:i[0]=n;break;case Xo.Y_LINE:i[1]=n;break;case Xo.Z_LINE:i[2]=n;break;case Xo.XY_PLANE:i[0]=n%r[0],i[1]=n/r[0];break;case Xo.YZ_PLANE:i[1]=n%r[1],i[2]=n/r[1];break;case Xo.XZ_PLANE:i[0]=n%r[0],i[2]=n/r[0];break;case Xo.XYZ_GRID:i[0]=n%r[0],i[1]=n/r[0]%r[1],i[2]=n/(r[0]*r[1]);break;default:dl("Invalid dataDescription");break}const a=[0,0,0];return t.indexToWorld(i,a),a},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=n=>kn.transformBounds(n,e.indexToWorld),t.getSpatialExtent=()=>kn.inflate([...e.extent],.5),t.computeTransforms=()=>{k1(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],Us(e.indexToWorld,e.indexToWorld,e.spacing),Br(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return an(r,n,e.indexToWorld),r},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return an(r,n,e.worldToIndex),r},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return kn.transformBounds(n,e.indexToWorld,r)},t.worldToIndexBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return kn.transformBounds(n,e.worldToIndex,r)},t.onModified(t.computeTransforms),t.computeTransforms(),t.getCenter=()=>kn.getCenter(t.getBounds()),t.computeHistogram=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const i=[0,0,0,0,0,0];t.worldToIndexBounds(n,i);const a=[0,0,0],o=[0,0,0];kn.computeCornerPoints(i,a,o),E4(a,a),E4(o,o);const s=t.getDimensions();O4(a,[0,0,0],[s[0]-1,s[1]-1,s[2]-1],a),O4(o,[0,0,0],[s[0]-1,s[1]-1,s[2]-1],o);const c=s[0],u=s[0]*s[1],d=t.getPointData().getScalars().getData();let g=-1/0,h=1/0,m=0,y=0,v=0;for(let x=a[2];x<=o[2];x++)for(let R=a[1];R<=o[1];R++){let O=a[0]+R*c+x*u;for(let b=a[0];b<=o[0];b++){if(!r||r([b,R,x],i)){const I=d[O];I>g&&(g=I),I<h&&(h=I),m+=I*I,y+=I,v+=1}++O}}const C=v>0?y/v:0,S=v?Math.abs(m/v-C*C):0,w=Math.sqrt(S);return{minimum:h,maximum:g,average:C,variance:S,sigma:w,count:v}},t.computeIncrements=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=[];let a=r;for(let o=0;o<3;++o)i[o]=a,a*=n[o*2+1]-n[o*2]+1;return i},t.computeOffsetIndex=n=>{let[r,i,a]=n;const o=t.getExtent(),s=t.getPointData().getScalars().getNumberOfComponents(),c=t.computeIncrements(o,s);return Math.floor((Math.round(r)-o[0])*c[0]+(Math.round(i)-o[2])*c[1]+(Math.round(a)-o[4])*c[2])},t.getOffsetIndexFromWorld=n=>{const r=t.getExtent(),i=t.worldToIndex(n);for(let a=0;a<3;++a)if(i[a]<r[a*2]||i[a]>r[a*2+1])return dl(`GetScalarPointer: Pixel ${i} is not in memory. Current extent = ${r}`),NaN;return t.computeOffsetIndex(i)},t.getScalarValueFromWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=t.getPointData().getScalars().getNumberOfComponents();if(r<0||r>=i)return dl(`GetScalarPointer: Scalar Component ${r} is not within bounds. Current Scalar numberOfComponents: ${i}`),NaN;const a=t.getOffsetIndexFromWorld(n);return Number.isNaN(a)?a:t.getPointData().getScalars().getComponent(a,r)}}const Pz={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:Xo.EMPTY};function _O(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Pz,n),Sf.extend(t,e,n),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=rs(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),H.get(t,e,["indexToWorld","worldToIndex"]),H.setGetArray(t,e,["origin","spacing"],3),H.setGetArray(t,e,["direction"],9),H.getArray(t,e,["extent"],6),Nz(t,e)}const Uz=H.newInstance(_O,"vtkImageData");var Op={newInstance:Uz,extend:_O};const iC=[[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],aC=[[0,-1,0],[0,1,0]],Fz=[[0,-1,0],[0,1,0],[0,0,-1]],kz=[[0,-1,0],[0,1,0],[0,0,1]],Dy=class Dy{static copyMap(e,n){for(const[r,i]of n.rows)e.rows.set(r,structuredClone(i))}constructor(e,n,r=1){this.rows=new Map,this.height=1,this.width=1,this.depth=1,this.jMultiple=1,this.kMultiple=1,this.numComps=1,this.pixelDataConstructor=Uint8Array,this.updateScalarData=function(i){i.fill(0);const a=(o,s,c)=>{const{start:u,end:d,value:g}=s;for(let h=u;h<d;h++)i[o+h]=g};this.forEach(a)},this.get=i=>{const a=i%this.jMultiple,o=(i-a)/this.jMultiple;return this.getRLE(a,o)?.value??this.defaultValue},this.getRun=(i,a)=>{const o=i+a*this.height;return this.rows.get(o)},this.set=(i,a)=>{if(a===void 0)return;const o=i%this.width,s=(i-o)/this.width,c=this.rows.get(s);if(!c){this.rows.set(s,[{start:o,end:o+1,value:a}]);return}const u=this.findIndex(c,o),d=c[u],g=c[u-1];if(!d){if(!g||g.value!==a||g.end!==o){c[u]={start:o,end:o+1,value:a};return}g.end++;return}const{start:h,end:m,value:y}=d;if(a===y&&o>=h)return;const v={start:o,end:o+1,value:a},C=o>h,S=C?u+1:u,w=C?d:g;let x=C?c[u+1]:d;if(w?.value===a&&w?.end===o){w.end++,x?.value===a&&x.start===o+1?(w.end=x.end,c.splice(u,1)):x?.start===o&&(x.start++,x.start===x.end&&(c.splice(u,1),x=c[u],x?.start===o+1&&x.value===a&&(w.end=x.end,c.splice(u,1))));return}if(x?.value===a&&x.start===o+1){x.start--,w?.end>o&&(w.end=o,w.end===w.start&&c.splice(u,1));return}if(x?.start===o&&x.end===o+1){x.value=a;const R=c[u+1];R?.start==o+1&&R.value===a&&(c.splice(u+1,1),x.end=R.end);return}o===x?.start&&x.start++,C&&m>o+1?c.splice(S,0,v,{start:o+1,end:w.end,value:w.value}):c.splice(S,0,v),w?.end>o&&(w.end=o)},this.width=e,this.height=n,this.depth=r,this.jMultiple=e,this.kMultiple=this.jMultiple*n}toIJK(e){const n=e%this.jMultiple,r=(e-n)/this.jMultiple%this.height,i=Math.floor(e/this.kMultiple);return[n,r,i]}toIndex([e,n,r]){return e+r*this.kMultiple+n*this.jMultiple}getRLE(e,n,r=0){const i=this.rows.get(n+r*this.height);if(!i)return;const a=this.findIndex(i,e),o=i[a];return e>=o?.start?o:void 0}has(e){const n=e%this.jMultiple,r=(e-n)/this.jMultiple;return this.getRLE(n,r)?.value!==void 0}delete(e){const n=e%this.width,r=(e-n)/this.width,i=this.rows.get(r);if(!i)return;const a=this.findIndex(i,n),o=i[a];if(!o||o.start>n)return;if(o.end===n+1){o.end--,o.start>=o.end&&(i.splice(a,1),i.length||this.rows.delete(r));return}if(o.start===n){o.start++;return}const s={value:o.value,start:n+1,end:o.end};o.end=n,i.splice(a+1,0,s)}findIndex(e,n){for(let r=0;r<e.length;r++){const{end:i}=e[r];if(n<i)return r}return e.length}forEach(e,n){const r=n?.rowModified;for(const[i,a]of this.rows){const o=r?[...a]:a;for(const s of o)e(i*this.width,s,a)}}forEachRow(e){for(const[n,r]of this.rows)e(n*this.width,r)}clear(){this.rows.clear()}keys(){return[...this.rows.keys()]}getPixelData(e=0,n){n?n.fill(0):n=new this.pixelDataConstructor(this.width*this.height*this.numComps);const{width:r,height:i,numComps:a}=this;for(let o=0;o<i;o++){const s=this.getRun(o,e);if(s)if(a===1)for(const c of s){const u=o*r,{start:d,end:g,value:h}=c;for(let m=d;m<g;m++)n[u+m]=h}else for(const c of s){const u=o*r*a,{start:d,end:g,value:h}=c;for(let m=d;m<g;m+=a)for(let y=0;y<a;y++)n[u+m+y]=h[y]}}return n}floodFill(e,n,r,i,a){const o=this.getRLE(e,n,r);if(!o)throw new Error(`Initial point ${e},${n},${r} isn't in the RLE`);const s=[[o,n,r]],c=o.value;if(c===i)throw new Error(`source (${c}) and destination (${i}) are identical`);return this.flood(s,c,i,a)}flood(e,n,r,i){let a=0;const{planar:o=!0,diagonals:s=!0,singlePlane:c=!1}=i||{},u={planar:o,diagonals:s,singlePlane:c};for(;e.length;){const d=e.pop(),[g]=d;if(g.value!==n)continue;g.value=r,a+=g.end-g.start;const h=this.findAdjacents(d,u).filter(m=>m&&m[0].value===n);e.push(...h)}return a}fillFrom(e,n){for(let r=n[2][0];r<=n[2][1];r++)for(let i=n[1][0];i<=n[1][1];i++){let a,o;for(let s=n[0][0];s<=n[0][1];s++){const c=e(s,i,r);if(c===void 0){a=void 0;continue}o||(o=[],this.rows.set(i+r*this.height,o)),a&&a.value!==c&&(a=void 0),a||(a={start:s,end:s,value:c},o.push(a)),a.end++}}}findAdjacents(e,{diagonals:n=!0,planar:r=!0,singlePlane:i=!1}){const[a,o,s,c]=e,{start:u,end:d}=a,g=u>0&&this.getRLE(u-1,o,s),h=d<this.width&&this.getRLE(d,o,s),m=n?[u>0?u-1:u,d<this.width?d+1:d]:[u,d],y=[];g&&y.push([g,o,s]),h&&y.push([h,o,s]);for(const v of c||(i?aC:iC)){const[,C,S]=v,w=C+o,x=S+s;if(w<0||w>=this.height||x<0||x>=this.depth)continue;const R=this.getRun(w,x);if(R)for(const O of R){const b=c||i&&aC||r&&S>0&&kz||r&&S<0&&Fz||iC;O.end<=m[0]||O.start>=m[1]||y.push([O,w,x,b])}}return y}};Dy.getScalarData=function(e=Uint8ClampedArray){const n=new e(this.frameSize);return this.map.updateScalarData(n),n};let L0=Dy,n2=class Bg{constructor(e={}){this._dimensions=3,this._length=0,this._byteSize=4,this.growSize=128;const{initialSize:n=1024,dimensions:r=3,growSize:i=128}=e,a=n*r;this.growSize=i,this.array=new ArrayBuffer(a*this._byteSize),this.data=new Float32Array(this.array),this._dimensions=r}forEach(e){for(let n=0;n<this._length;n++)e(this.getPoint(n),n)}get length(){return this._length}get dimensions(){return this._dimensions}get dimensionLength(){return this._length*this._dimensions}getPoint(e){if(e<0&&(e+=this._length),e<0||e>=this._length)return;const n=this._dimensions*e;return this.data.subarray(n,n+this._dimensions)}getPointArray(e){const n=[];if(e<0&&(e+=this._length),e<0||e>=this._length)return;const r=this._dimensions*e;for(let i=0;i<this._dimensions;i++)n.push(this.data[i+r]);return n}grow(e=1,n=this.growSize){if(this.dimensionLength+e*this._dimensions<=this.data.length)return;const r=this.data.length+n,i=new ArrayBuffer(r*this._dimensions*this._byteSize),a=new Float32Array(i);a.set(this.data),this.data=a,this.array=i}reverse(){const e=Math.floor(this._length/2);for(let n=0;n<e;n++){const r=n*this._dimensions,i=(this._length-1-n)*this._dimensions;for(let a=0;a<this._dimensions;a++){const o=this.data[r+a];this.data[r+a]=this.data[i+a],this.data[i+a]=o}}}getTypedArray(){return this.data}push(e){this.grow(1);const n=this.length*this._dimensions;for(let r=0;r<this._dimensions;r++)this.data[r+n]=e[r];this._length++}map(e){const n=[];for(let r=0;r<this._length;r++)n.push(e(this.getPoint(r),r));return n}get points(){return this.map(e=>e)}toXYZ(){const e={x:[],y:[]};this._dimensions>=3&&(e.z=[]);const{x:n,y:r,z:i}=e;return this.forEach(a=>{n.push(a[0]),r.push(a[1]),i&&i.push(a[2])}),e}static fromXYZ({x:e,y:n,z:r}){const i=Bg.create3(e.length);let a=0;for(let o=0;o<e.length;o++)i.data[a++]=e[o],i.data[a++]=n[o],i.data[a++]=r?r[o]:0;return i._length=e.length,i}subselect(e=10,n=0){const r=new Bg({initialSize:e,dimensions:this._dimensions});for(let i=0;i<e;i++){const a=(n+Math.floor(this.length*i/e))%this.length;r.push(this.getPoint(a))}return r}static create3(e=128,n){e=Math.max(e,n?.length||0);const r=new Bg({initialSize:e,dimensions:3});return n&&n.forEach(i=>r.push(i)),r}static create2(e=128){return new Bg({initialSize:e,dimensions:2})}};function bO(t){const e=Ke(),n=t.getDimensions(),r=n2.create3(n[0]),i=n2.create3(n[1]),a=n2.create3(n[2]),o=t.getDirection(),s=o.slice(0,3),c=o.slice(3,6),u=o.slice(6,9),d=t.getSpacing(),[g,h,m]=d,y=t.indexToWorld([0,0,0]),v=on(s[0]*g,s[1]*g,s[2]*g),C=on(c[0]*h,c[1]*h,c[2]*h),S=on(u[0]*m,u[1]*m,u[2]*m),w=Ke();for(let b=0;b<n[0];b++)r.push(z0(w,y,bs(w,v,b)));for(let b=0;b<n[1];b++)i.push(bs(w,C,b));for(let b=0;b<n[2];b++)a.push(bs(w,S,b));const x=r.getTypedArray(),R=i.getTypedArray(),O=a.getTypedArray();return(b,I=e)=>{const[G,j,F]=b,$=G*3,z=j*3,oe=F*3;return I[0]=x[$]+R[z]+O[oe],I[1]=x[$+1]+R[z+1]+O[oe+1],I[2]=x[$+2]+R[z+2]+O[oe+2],I}}function MO(t,e){const{pointInShapeFn:n,callback:r,boundsIJK:i,returnPoints:a=!1}=e;let o;if(t.getScalarData)o=t.getScalarData();else{const g=t.getPointData().getScalars();if(g)o=g.getData();else{const{voxelManager:h}=t.get("voxelManager")||{};h&&(o=h.getCompleteScalarDataArray())}}const s=t.getDimensions(),c=[[0,s[0]],[0,s[1]],[0,s[2]]],d=Gz({imageData:t,bounds:i||c,scalarData:o,pointInShapeFn:n,callback:r});return a?d:void 0}function Gz({imageData:t,bounds:e,scalarData:n,pointInShapeFn:r,callback:i}){const[[a,o],[s,c],[u,d]]=e,{numComps:g}=t,h=t.getDimensions(),m=bO(t),y=[0,0,0],v=g||n.length/h[2]/h[1]/h[0],C=h[0]*v,S=h[1]*C,w=[];for(let x=u;x<=d;x++){y[2]=x;const R=x*S;for(let O=s;O<=c;O++){y[1]=O;const b=R+O*C;for(let I=a;I<=o;I++){y[0]=I;const G=m(y);if(r(G,y)){const j=b+I*v;let F;v>2?F=[n[j],n[j+1],n[j+2]]:F=n[j],w.push({value:F,index:j,pointIJK:y,pointLPS:G.slice()}),i({value:F,index:j,pointIJK:y,pointLPS:G})}}}}return w}function Bz({voxelManager:t,bounds:e,imageData:n,pointInShapeFn:r,callback:i,returnPoints:a}){const[[o,s],[c,u],[d,g]]=e,h=bO(n),m=[0,0,0],y=[];for(let v=d;v<=g;v++){m[2]=v;for(let C=c;C<=u;C++){m[1]=C;for(let S=o;S<=s;S++){m[0]=S;const w=h(m);if(r(w,m)){const x=t.toIndex(m),R=t.getAtIndex(x);a&&y.push({value:R,index:x,pointIJK:[...m],pointLPS:w.slice()}),i?.({value:R,index:x,pointIJK:m,pointLPS:w})}}}}return y}const $z=5*1024;class Fn{get id(){return this._id}constructor(e,n){this.modifiedSlices=new Set,this.boundsIJK=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],this.scalarData=null,this._sliceDataCache=null,this.getAtIJK=(r,i,a)=>{const o=this.toIndex([r,i,a]);return this._get(o)},this.setAtIJK=(r,i,a,o)=>{const s=this.toIndex([r,i,a]),c=this._set(s,o);return c!==!1&&(this.modifiedSlices.add(a),Fn.addBounds(this.boundsIJK,[r,i,a])),c},this.getAtIJKPoint=([r,i,a])=>this.getAtIJK(r,i,a),this.setAtIJKPoint=([r,i,a],o)=>{this.setAtIJK(r,i,a,o)},this.getAtIndex=r=>this._get(r),this.setAtIndex=(r,i)=>{const a=this._set(r,i);if(a!==!1){const o=this.toIJK(r);this.modifiedSlices.add(o[2]),Fn.addBounds(this.boundsIJK,o)}return a},this.getMiddleSliceData=()=>{const r=Math.floor(this.dimensions[2]/2);return this.getSliceData({sliceIndex:r,slicePlane:2})},this.forEach=(r,i={})=>{const a=i.boundsIJK||this.getBoundsIJK(),o=i.isInObject||this.isInObject||(()=>!0),s=i.returnPoints||!1,c=i.imageData,u=Math.min(a[0][0],a[0][1]),d=Math.max(a[0][0],a[0][1]),g=Math.min(a[1][0],a[1][1]),h=Math.max(a[1][0],a[1][1]),m=Math.min(a[2][0],a[2][1]),y=Math.max(a[2][0],a[2][1]),v=[];if(c)return Bz({voxelManager:this,imageData:i.imageData,bounds:[[u,d],[g,h],[m,y]],pointInShapeFn:o,callback:r,returnPoints:s});if(this.map){if(this.map instanceof L0)return this.rleForEach(r,i);for(const C of this.map.keys()){const S=this.toIJK(C);if(!o(null,S))continue;const w=this._get(C);s&&v.push({value:w,index:C,pointIJK:S,pointLPS:null}),r({value:w,index:C,pointIJK:S,pointLPS:null})}return v}else{for(let C=m;C<=y;C++){const S=C*this.frameSize;for(let w=g;w<=h;w++){const x=S+w*this.width;for(let R=u,O=x+R;R<=d;R++,O++){const b=this.getAtIndex(O),I=[R,w,C];o(null,I)&&(s&&v.push({value:b,index:O,pointIJK:I,pointLPS:null}),r({value:b,index:O,pointIJK:[R,w,C],pointLPS:null}))}}}return v}},this.getSliceData=({sliceIndex:r,slicePlane:i})=>{const[a,o,s]=this.dimensions,c=a*o,u=r*c;let d;const g=this.getConstructor();function h(y){return typeof y=="function"}if(!h(g))return new Uint8Array(0);let m;switch(i){case 0:d=o*s,m=new g(d);for(let y=0;y<o;y++)for(let v=0;v<s;v++){const C=r+y*a+v*c;this.setSliceDataValue(m,y*s+v,this._get(C))}break;case 1:d=a*s,m=new g(d);for(let y=0;y<a;y++)for(let v=0;v<s;v++){const C=y+r*a+v*c;this.setSliceDataValue(m,y+v*a,this._get(C))}break;case 2:d=a*o,m=new g(d);for(let y=0;y<d;y++)this.setSliceDataValue(m,y,this._get(u+y));break;default:throw new Error("Oblique plane - todo - implement as ortho normal vector")}return m},this.dimensions=e,this.width=e[0],this.frameSize=this.width*e[1],this._get=n._get,this._set=n._set,this._id=n._id||"",this._getConstructor=n._getConstructor,this.numberOfComponents=this.numberOfComponents||1,this.scalarData=n.scalarData,this._getScalarData=n._getScalarData,this._updateScalarData=n._updateScalarData}getMinMax(){let e,n;const r=({value:i})=>{const a=Array.isArray(i);if(e===void 0&&(e=a?[...i]:i,n=a?[...i]:i),a)for(let o=0;o<i.length;o++)e[o]=Math.min(e[o],i[o]),n[o]=Math.max(n[o],i[o]);else e=Math.min(e,i),n=Math.max(n,i)};return this.forEach(r,{boundsIJK:this.getDefaultBounds()}),{min:e,max:n}}toIJK(e){return[e%this.width,Math.floor(e%this.frameSize/this.width),Math.floor(e/this.frameSize)]}toIndex(e){return e[0]+e[1]*this.width+e[2]*this.frameSize}getDefaultBounds(){return this.dimensions.map(e=>[0,e-1])}getBoundsIJK(){return this.boundsIJK[0][0]<this.dimensions[0]?this.boundsIJK:this.getDefaultBounds()}rleForEach(e,n){const r=n?.boundsIJK||this.getBoundsIJK(),{isWithinObject:i}=n||{},a=this.map;if(!a){console.warn("No map found, you need to use a map voxel manager to use rleForEach");return}a.defaultValue=void 0;for(let o=r[2][0];o<=r[2][1];o++)for(let s=r[1][0];s<=r[1][1];s++){const c=a.getRun(s,o);if(c)for(const u of c){const{start:d,end:g,value:h}=u,m=this.toIndex([0,s,o]);for(let y=d;y<g;y++){const v={value:h,index:m+y,pointIJK:[y,s,o]};i?.(v)!==!1&&e(v)}}}}getScalarData(e=!1){if(this.scalarData)return this._updateScalarData?.(this.scalarData),this.scalarData;if(this._getScalarData){const n=this._getScalarData();return e&&console.log("Not transient, should store value",n),n}throw new Error("No scalar data available")}setScalarData(e){this.scalarData=e}getScalarDataLength(){if(this.scalarData)return this.scalarData.length;if(this._getScalarDataLength)return this._getScalarDataLength();throw new Error("No scalar data available")}get sizeInBytes(){return this.getScalarDataLength()*this.bytePerVoxel}get bytePerVoxel(){return this.scalarData?this.scalarData.BYTES_PER_ELEMENT:this._get(0).BYTES_PER_ELEMENT}clearBounds(){this.boundsIJK.map(e=>{e[0]=1/0,e[1]=-1/0})}clear(){this.map?.clear(),this.clearBounds(),this.modifiedSlices.clear(),this.points?.clear()}getConstructor(){return this.scalarData?this.scalarData.constructor:this._getConstructor?this._getConstructor():(console.warn("No scalar data available or can be used to get the constructor"),Float32Array)}getArrayOfModifiedSlices(){return Array.from(this.modifiedSlices)}resetModifiedSlices(){this.modifiedSlices.clear()}setBounds(e){this.boundsIJK=e}static addBounds(e,n){e||(e=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]]),e[0][0]=Math.min(n[0],e[0][0]),e[0][1]=Math.max(n[0],e[0][1]),e[1][0]=Math.min(n[1],e[1][0]),e[1][1]=Math.max(n[1],e[1][1]),e[2][0]=Math.min(n[2],e[2][0]),e[2][1]=Math.max(n[2],e[2][1])}addPoint(e){const n=Array.isArray(e)?e[0]+this.width*e[1]+this.frameSize*e[2]:e;this.points||(this.points=new Set),this.points.add(n)}getPoints(){return this.points?[...this.points].map(e=>this.toIJK(e)):[]}setSliceDataValue(e,n,r){if(Array.isArray(r))for(let i=0;i<r.length;i++)e[n*r.length+i]=this.toNumber(r[i]);else e[n]=this.toNumber(r)}toNumber(e){return typeof e=="number"?e:Array.isArray(e)&&e[0]||0}static _createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r=3,id:i}){const a=new Fn(e,{_get:o=>(o*=r,[n[o++],n[o++],n[o++]]),_id:i||"_createRGBScalarVolumeVoxelManager",_set:(o,s)=>{o*=3;const c=!Tn(n[o],s);return n[o++]=s[0],n[o++]=s[1],n[o++]=s[2],c},numberOfComponents:r,scalarData:n});return a.clear=()=>{n.fill(0)},a}static createImageVolumeVoxelManager({dimensions:e,imageIds:n,numberOfComponents:r=1,id:i}){const a=e[0]*e[1];function o(g){const h=Math.floor(g/a);if(h<0||h>=e[2])return{};const m=n[h];if(!m)return console.warn(`ImageId not found for sliceIndex: ${h}`),{pixelData:null,pixelIndex:null};const y=rt.getImage(m);if(!y)return console.warn(`Image not found for imageId: ${m}`),{pixelData:null,pixelIndex:null};const v=y.voxelManager,C=g%a;return{voxelManager:v,pixelIndex:C}}function s(g){const{voxelManager:h,pixelIndex:m}=o(g);return!h||m===null?null:h.getAtIndex(m)}function c(g,h){const{voxelManager:m,pixelIndex:y}=o(g);if(!m||y===null)return!1;const v=m.getAtIndex(y),C=!Tn(h,v);return C&&(m.setAtIndex(y,h),!0)}const u=()=>{const{voxelManager:g,pixelIndex:h}=o(0);return!g||h===null?null:g.getConstructor()},d=new Fn(e,{_get:s,_set:c,numberOfComponents:r,_getConstructor:u,_id:i||"createImageVolumeVoxelManager"});return d.getMiddleSliceData=()=>{const g=Math.floor(e[2]/2);return d.getSliceData({sliceIndex:g,slicePlane:2})},d.clear=()=>{for(const g of n)rt.getImage(g).voxelManager.clear()},d.getRange=()=>{let g=1/0,h=-1/0;for(const m of n){const y=rt.getImage(m);y&&(y.minPixelValue<g&&(g=y.minPixelValue),y.maxPixelValue>h&&(h=y.maxPixelValue))}return g===1/0&&h===-1/0?[0,0]:[g,h]},d._getScalarDataLength=()=>{const{voxelManager:g,pixelIndex:h}=o(0);return!g||h===null?0:g.getScalarDataLength()*e[2]},d.getCompleteScalarDataArray=()=>{const g=d._getConstructor();if(!g)return new Uint8Array(0);const h=d.getScalarDataLength(),m=new g(h),y=e[0]*e[1]*r;for(let v=0;v<e[2];v++){const{voxelManager:C,pixelIndex:S}=o(v*y/r);if(C&&S!==null){const w=v*y,x=C.getScalarData();if(r===1)m.set(x,w);else for(let R=0;R<x.length;R+=r)for(let O=0;O<r;O++)m[w+R+O]=x[R+O]}}return m},d.setCompleteScalarDataArray=g=>{const h=e[0]*e[1]*r,m=d._getConstructor();let y=1/0,v=-1/0;for(let C=0;C<e[2];C++){const{voxelManager:S}=o(C*h/r);if(S&&m){const w=C*h,x=w+h,R=new m(h);if(R.set(g.subarray(w,x)),S.scalarData)S.scalarData.set(R),S.modifiedSlices.add(C);else for(let I=0;I<h;I++)S.setAtIndex(I,R[I]);for(let I=0;I<R.length;I++){const G=R[I];y=Math.min(y,G),v=Math.max(v,G)}const O=n[C],b=rt.getImage(O);b&&(b.minPixelValue=y,b.maxPixelValue=v)}}for(let C=0;C<e[2];C++)d.modifiedSlices.add(C);d.boundsIJK=[[0,e[0]-1],[0,e[1]-1],[0,e[2]-1]]},d}static createScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r,id:i}){if(e.length!==3)throw new Error("Dimensions must be provided as [number, number, number] for [width, height, depth]");if(!r&&(r=n.length/e[0]/e[1]/e[2],r>4||r<1||r===2))throw new Error(`Number of components ${r} must be 1, 3 or 4`);return r>1?Fn._createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r,id:i}):Fn._createNumberVolumeVoxelManager({dimensions:e,scalarData:n,id:i})}static createScalarDynamicVolumeVoxelManager({imageIdGroups:e,dimensions:n,dimensionGroupNumber:r=1,timePoint:i=0,numberOfComponents:a=1,id:o}){let s=0;if(r!==void 0?s=r-1:i!==void 0&&(console.warn("Warning: timePoint parameter is deprecated. Please use dimensionGroupNumber instead. timePoint is zero-based while dimensionGroupNumber starts at 1."),s=i),!a){const d=rt.getImage(e[0][0]);if(!d)throw new Error("Unable to determine number of components: No image found");if(a=d.getPixelData().length/(n[0]*n[1]),a>4||a<1||a===2)throw new Error(`Number of components ${a} must be 1, 3 or 4`)}const c=e.map(d=>Fn.createImageVolumeVoxelManager({dimensions:n,imageIds:d,numberOfComponents:a,id:o})),u=new Fn(n,{_get:d=>c[s]._get(d),_set:(d,g)=>c[s]._set(d,g),numberOfComponents:a,_id:o||"createScalarDynamicVolumeVoxelManager"});return u.getScalarDataLength=()=>c[s].getScalarDataLength(),u.getConstructor=()=>c[s].getConstructor(),u.getRange=()=>c[s].getRange(),u.getMiddleSliceData=()=>c[s].getMiddleSliceData(),u.setTimePoint=d=>{console.warn("Warning: setTimePoint is deprecated. Please use setDimensionGroupNumber instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),u.setDimensionGroupNumber(d+1)},u.setDimensionGroupNumber=d=>{s=d-1,u._get=g=>c[s]._get(g),u._set=(g,h)=>c[s]._set(g,h)},u.getAtIndexAndTimePoint=(d,g)=>(console.warn("Warning: getAtIndexAndTimePoint is deprecated. Please use getAtIndexAndDimensionGroup instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),u.getAtIndexAndDimensionGroup(d,g+1)),u.getAtIndexAndDimensionGroup=(d,g)=>c[g-1]._get(d),u.getTimePointScalarData=d=>(console.warn("Warning: getTimePointScalarData is deprecated. Please use getDimensionGroupScalarData instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),u.getDimensionGroupScalarData(d+1)),u.getDimensionGroupScalarData=d=>c[d-1].getCompleteScalarDataArray(),u.getCurrentTimePointScalarData=()=>(console.warn("Warning: getCurrentTimePointScalarData is deprecated. Please use getCurrentDimensionGroupScalarData instead."),u.getCurrentDimensionGroupScalarData()),u.getCurrentDimensionGroupScalarData=()=>c[s].getCompleteScalarDataArray(),u.getCurrentTimePoint=()=>(console.warn("Warning: getCurrentTimePoint is deprecated. Please use getCurrentDimensionGroupNumber instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),s),u.getCurrentDimensionGroupNumber=()=>s+1,u}static createImageVoxelManager({width:e,height:n,scalarData:r,numberOfComponents:i=1,id:a}){const o=[e,n,1];if(!i&&(i=r.length/e/n,i>4||i<1||i===2))throw new Error(`Number of components ${i} must be 1, 3 or 4`);return i>1?Fn._createRGBScalarVolumeVoxelManager({dimensions:o,scalarData:r,numberOfComponents:i,id:a}):Fn._createNumberVolumeVoxelManager({dimensions:o,scalarData:r,id:a})}static _createNumberVolumeVoxelManager({dimensions:e,scalarData:n,id:r}){const i=new Fn(e,{_get:a=>n[a],_set:(a,o)=>{const s=n[a]!==o;return n[a]=o,s},_getConstructor:()=>n.constructor,_id:r||"_createNumberVolumeVoxelManager"});return i.scalarData=n,i.clear=()=>{i.scalarData.fill(0)},i.getMiddleSliceData=()=>{const a=Math.floor(e[2]/2);return i.getSliceData({sliceIndex:a,slicePlane:2})},i}static createMapVoxelManager({dimension:e,id:n}){const r=new Map,i=new Fn(e,{_get:r.get.bind(r),_set:(a,o)=>r.set(a,o)&&!0,_id:n||"createMapVoxelManager"});return i.map=r,i}static createHistoryVoxelManager(e,n){const r=new Map,{dimensions:i}=e,a=new Fn(i,{_get:o=>r.get(o),_set:function(o,s){if(r.has(o))s===r.get(o)&&r.delete(o);else{const c=this.sourceVoxelManager.getAtIndex(o);if(c===s)return!1;r.set(o,c)}this.sourceVoxelManager.setAtIndex(o,s)},_id:n||"createHistoryVoxelManager"});return a.map=r,a.scalarData=e.scalarData,a.sourceVoxelManager=e,a}static createRLEHistoryVoxelManager(e,n){const{dimensions:r}=e,i=new L0(r[0],r[1],r[2]),a=new Fn(r,{_get:o=>i.get(o),_set:function(o,s){const c=i.get(o);if(c===void 0){const u=this.sourceVoxelManager.getAtIndex(o);if(u===s||u===void 0&&s===0||s===null)return!1;i.set(o,u??0)}else(s===c||s===null)&&(i.delete(o),s=c);this.sourceVoxelManager.setAtIndex(o,s)},_getScalarData:L0.getScalarData,_updateScalarData:o=>(i.updateScalarData(o),o),_id:n||"createRLEHistoryVoxelManager"});return a.map=i,a.sourceVoxelManager=e,a}static createLazyVoxelManager({dimensions:e,planeFactory:n,id:r}){const i=new Map,[a,o]=e,s=a*o,c=new Fn(e,{_get:u=>i.get(Math.floor(u/s))[u%s],_set:(u,d)=>{const g=Math.floor(u/s);let h=i.get(g);return h||(h=n(a,o),i.set(g,h)),h[u%s]=d,!0},_id:r||"createLazyVoxelManager"});return c.map=i,c}static createRLEVolumeVoxelManager({dimensions:e,id:n}){const[r,i,a]=e,o=new L0(r,i,a),s=new Fn(e,{_get:c=>o.get(c),_set:(c,u)=>(o.set(c,u),!0),_getScalarData:L0.getScalarData,_updateScalarData:c=>(o.updateScalarData(c),c),_id:n||"createRLEVolumeVoxelManager"});return s.map=o,s.getPixelData=o.getPixelData.bind(o),s}static createRLEImageVoxelManager({dimensions:e,id:n}){const[r,i]=e;return Fn.createRLEVolumeVoxelManager({dimensions:[r,i,1],id:n})}static addInstanceToImage(e){const{width:n,height:r}=e,i=e.voxelManager.getScalarData();if(i.length>=n*r){e.voxelManager=Fn.createScalarVolumeVoxelManager({dimensions:[n,r,1],scalarData:i});return}e.voxelManager=Fn.createRLEVolumeVoxelManager({dimensions:[n,r,1]}),e.getPixelData=e.voxelManager.getPixelData,e.sizeInBytes=$z}}const Wz="WebGL",W2=Object.create(null);function LO(t,e){W2[t]=e}function zz(){return Object.keys(W2)}function VO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return W2[t]&&W2[t](e)}function Hz(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=n=>{t.hasRenderer(n)||(n.setRenderWindow(t),e.renderers.push(n),t.modified())},t.removeRenderer=n=>{e.renderers=e.renderers.filter(r=>r!==n),t.modified()},t.hasRenderer=n=>e.renderers.indexOf(n)!==-1,t.newAPISpecificView=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return VO(n||e.defaultViewAPI,r)},t.addView=n=>{t.hasView(n)||(n.setRenderable(t),e._views.push(n),t.modified())},t.removeView=n=>{e._views=e._views.filter(r=>r!==n),t.modified()},t.hasView=n=>e._views.indexOf(n)!==-1,t.preRender=()=>{e.renderers.forEach(n=>{n.isActiveCameraCreated()||n.resetCamera()})},t.render=()=>{t.preRender(),e.interactor?e.interactor.render():e._views.forEach(n=>n.traverseAllPasses())},t.getStatistics=()=>{const n={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return e._views.forEach(r=>{r.getGraphicsMemoryInfo&&(n.gpuMemoryMB+=r.getGraphicsMemoryInfo()/1e6)}),e.renderers.forEach(r=>{const i=r.getViewProps(),a=e._views[0].getViewNodeFor(r);i.forEach(o=>{if(o.getVisibility()){n.propCount+=1;const s=o.getMapper&&o.getMapper();if(s&&s.getPrimitiveCount){const c=a.getViewNodeFor(s);if(c){c.getAllocatedGPUMemoryInBytes&&(n.gpuMemoryMB+=c.getAllocatedGPUMemoryInBytes()/1e6);const u=s.getPrimitiveCount();Object.keys(u).forEach(d=>{n[d]||(n[d]=0),n[d]+=u[d]})}}}else n.invisiblePropCount+=1})}),n.str=Object.keys(n).map(r=>`${r}: ${n[r]}`).join(`
`),n},t.captureImages=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return H.setImmediate(t.render),e._views.map(i=>i.captureNextImage?i.captureNextImage(n,r):void 0).filter(i=>!!i)},t.addRenderWindow=n=>e.childRenderWindows.includes(n)?!1:(e.childRenderWindows.push(n),t.modified(),!0),t.removeRenderWindow=n=>{const r=e.childRenderWindows.findIndex(i=>i===n);return r<0?!1:(e.childRenderWindows.splice(r,1),t.modified(),!0)}}const jz={defaultViewAPI:Wz,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function IO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jz,n),H.obj(t,e),H.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),H.get(t,e,["neverRendered"]),H.getArray(t,e,["renderers","childRenderWindows"]),H.moveToProtected(t,e,["views"]),H.event(t,e,"completion"),Hz(t,e)}const qz=H.newInstance(IO,"vtkRenderWindow");var Kz={newInstance:qz,extend:IO,registerViewConstructor:LO,listViewAPIs:zz,newAPISpecificView:VO};function Yz(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=()=>e.currentOperation,t.setCurrentOperation=n=>{e.currentOperation=n,e.currentTraverseOperation=`traverse${H.capitalize(e.currentOperation)}`},t.getTraverseOperation=()=>e.currentTraverseOperation,t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=r,e.preDelegateOperations.forEach(i=>{t.setCurrentOperation(i),n.traverse(t)}),e.delegates.forEach(i=>{i.traverse(n,t)}),e.postDelegateOperations.forEach(i=>{t.setCurrentOperation(i),n.traverse(t)}))}}const Xz={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function AO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Xz,n),H.obj(t,e),H.get(t,e,["currentOperation"]),H.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),H.moveToProtected(t,e,["currentParent"]),Yz(t,e)}const Zz=H.newInstance(AO,"vtkRenderPass");var S8={newInstance:Zz,extend:AO};const{Representation:Qz}=$1,{vtkErrorMacro:oC}=H;function Jz(t){const e=Te.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}const eH=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function tH(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=()=>{const n=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),r=new Float32Array([0,0,1,0,0,1,1,1]),i=new Uint16Array([4,0,1,3,2]),a=Pt.newInstance({numberOfComponents:3,values:n});a.setName("points");const o=Pt.newInstance({numberOfComponents:2,values:r});o.setName("tcoords");const s=Pt.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(s,"polys",Qz.SURFACE,{points:a,tcoords:o,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=n=>{const r=n.getSize(),i=n.getContext();e.framebuffer=Rp.newInstance(),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.create(...r),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=qn.newInstance(),e.translucentRGBATexture.setInternalFormat(i.RGBA16F),e.translucentRGBATexture.setFormat(i.RGBA),e.translucentRGBATexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(n),e.translucentRGBATexture.create2DFromRaw(r[0],r[1],4,"Float32Array",null),e.translucentRTexture=qn.newInstance(),e.translucentRTexture.setInternalFormat(i.R16F),e.translucentRTexture.setFormat(i.RED),e.translucentRTexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(n),e.translucentRTexture.create2DFromRaw(r[0],r[1],1,"Float32Array",null),e.translucentZTexture=qn.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(n),e.translucentZTexture.createDepthFromRaw(r[0],r[1],"Float32Array",null),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=n=>{e.copyShader=n.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),eH,"")},t.createVBO=n=>{const r=n.getContext();e.tris.setOpenGLRenderWindow(n),t.createVertexBuffer();const i=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),r.FLOAT,3,r.FALSE)||oC("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),r.FLOAT,2,r.FALSE)||oC("Error setting vertexDC in copy shader VAO.")},t.traverse=(n,r,i)=>{if(e.deleted)return;const a=n.getSize(),o=n.getContext();if(e._supported=!1,r.getSelector()||!o||!n.getWebgl2()||!o.getExtension("EXT_color_buffer_half_float")&&!o.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),r.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(n);else{const c=e.framebuffer.getSize();c===null||c[0]!==a[0]||c[1]!==a[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRTexture.releaseGraphicsResources(n),e.translucentZTexture.releaseGraphicsResources(n),t.createFramebuffer(n)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}o.drawBuffers([o.COLOR_ATTACHMENT0]),o.clearBufferfv(o.COLOR,0,[0,0,0,0]),o.clearBufferfv(o.DEPTH,0,[1]),o.colorMask(!1,!1,!1,!1),i.getOpaqueActorCount()>0&&(i.setCurrentOperation("opaqueZBufferPass"),r.traverse(i)),o.colorMask(!0,!0,!0,!0),o.drawBuffers([o.COLOR_ATTACHMENT0,o.COLOR_ATTACHMENT1]),o.viewport(0,0,a[0],a[1]),o.scissor(0,0,a[0],a[1]),o.clearBufferfv(o.COLOR,0,[0,0,0,1]),o.clearBufferfv(o.COLOR,1,[0,0,0,0]),o.enable(o.DEPTH_TEST),o.enable(o.BLEND),o.blendFuncSeparate(o.ONE,o.ONE,o.ZERO,o.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),r.traverse(t),o.drawBuffers([o.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(n):n.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=m8.newInstance(),e.copyVAO.setOpenGLRenderWindow(n)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(n),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA),o.depthMask(!1),o.depthFunc(o.ALWAYS),o.viewport(0,0,a[0],a[1]),o.scissor(0,0,a[0],a[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),o.depthMask(!0),o.depthFunc(o.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate();const s=r.getTiledSizeAndOrigin();o.scissor(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),o.viewport(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize)},t.getShaderReplacement=()=>e._supported?Jz:null,t.releaseGraphicsResources=n=>{e.framebuffer&&(e.framebuffer.releaseGraphicsResources(n),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(n),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(n),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(n),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(n),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(n),e.tris=null),t.modified()}}const nH={framebuffer:null,copyShader:null,tris:null};function NO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nH,n),S8.extend(t,e,n),e.VBOBuildTime={},H.obj(e.VBOBuildTime,{mtime:0}),e.tris=Y0.newInstance(),H.get(t,e,["framebuffer"]),tH(t,e)}const rH=H.newInstance(NO,"vtkOpenGLOrderIndependentTranslucentPass");var iH={newInstance:rH,extend:NO};function aH(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=r,t.setCurrentOperation("buildPass"),n.traverse(t);const i=n.getRenderable().getNumberOfLayers(),a=n.getRenderable().getRenderersByReference();for(let o=0;o<i;o++)for(let s=0;s<a.length;s++){const c=a[s],u=n.getViewNodeFor(c);if(c.getDraw()&&c.getLayer()===o){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),u.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){const d=n.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=Rp.newInstance()),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.saveCurrentBindingsAndBuffers();const g=e.framebuffer.getSize();(g===null||g[0]!==d[0]||g[1]!==d[1])&&(e.framebuffer.create(d[0],d[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),u.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),u.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),u.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=iH.newInstance()),e.translucentPass.traverse(n,u,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),u.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),u.traverse(t))}}},t.getZBufferTexture=()=>e.framebuffer?e.framebuffer.getColorTexture():null,t.requestDepth=()=>{e.depthRequested=!0},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.incrementVolumeCount=()=>e.volumeCount++,t.incrementOverlayActorCount=()=>e.overlayActorCount++}const oH={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function PO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oH,n),S8.extend(t,e,n),H.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),aH(t,e)}const sH=H.newInstance(PO,"vtkForwardPass");var cH={newInstance:sH,extend:PO};const ua={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3};var UO={PassTypes:ua};const{FieldAssociations:lH}=Sf;function uH(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=async(n,r,i,a,o)=>{},t.selectAsync=async(n,r,i,a,o)=>{const s=await t.getSourceDataAsync(n,r,i,a,o);return s?s.generateSelection(r,i,a,o):[]}}const fH={fieldAssociation:lH.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function FO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fH,n),H.obj(t,e),H.setGet(t,e,["fieldAssociation","captureZValues"]),uH(t,e)}const gH=H.newInstance(FO,"vtkHardwareSelector");var dH={newInstance:gH,extend:FO};const hH={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},pH={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5};var mH={SelectionContent:hH,SelectionField:pH};function vH(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=()=>e.points.getBounds()}const yH={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function kO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yH,n),H.obj(t,e),e.properties={},H.setGet(t,e,["contentType","fieldType","properties","selectionList"]),vH(t,e)}const TH=H.newInstance(kO,"vtkSelectionNode");var GO={newInstance:TH,extend:kO,...mH};const{PassTypes:Fr}=UO,{SelectionContent:CH,SelectionField:sC}=GO,{FieldAssociations:t1}=Sf,{vtkErrorMacro:BO}=H,V0=1;function $O(t){return`${t.propID} ${t.compositeID}`}function WO(t,e,n,r){if(!n)return 0;const i=(e*(r[2]-r[0]+1)+t)*4;return n[i+3]}function Ic(t,e,n,r){if(!n)return 0;const i=(e*(r[2]-r[0]+1)+t)*4,a=n[i],o=n[i+1];return(n[i+2]*256+o)*256+a}function zO(t,e){let n=e;return n<<=24,n|=t,n}function SH(t,e,n,r){{if(r[0]=e[0],r[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;const i=[e[0]-t.area[0],e[1]-t.area[1]],a=Ic(i[0],i[1],t.pixBuffer[Fr.ACTOR_PASS],t.area);if(a<=0||a-V0>=t.props.length)return null;const o={};o.valid=!0,o.propID=a-V0,o.prop=t.props[o.propID];let s=Ic(i[0],i[1],t.pixBuffer[Fr.COMPOSITE_INDEX_PASS],t.area);if((s<0||s>16777215)&&(s=0),o.compositeID=s-V0,t.captureZValues){const d=(i[1]*(t.area[2]-t.area[0]+1)+i[0])*4;o.zValue=(256*t.zBuffer[d]+t.zBuffer[d+1])/65535,o.displayPosition=e}if(t.pixBuffer[Fr.ID_LOW24]&&WO(i[0],i[1],t.pixBuffer[Fr.ID_LOW24],t.area)===0)return o;const c=Ic(i[0],i[1],t.pixBuffer[Fr.ID_LOW24],t.area),u=Ic(i[0],i[1],t.pixBuffer[Fr.ID_HIGH24],t.area);return o.attributeID=zO(c,u),o}}function HO(t,e,n,r,i){const a=[];let o=0;return e.forEach((s,c)=>{const u=GO.newInstance();switch(u.setContentType(CH.INDICES),t){case t1.FIELD_ASSOCIATION_CELLS:u.setFieldType(sC.CELL);break;case t1.FIELD_ASSOCIATION_POINTS:u.setFieldType(sC.POINT);break;default:BO("Unknown field association")}u.getProperties().propID=s.info.propID,u.getProperties().prop=s.info.prop,u.getProperties().compositeID=s.info.compositeID,u.getProperties().attributeID=s.info.attributeID,u.getProperties().pixelCount=s.pixelCount,n&&(u.getProperties().displayPosition=[s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue],u.getProperties().worldPosition=i.displayToWorld(s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue,r)),u.setSelectionList(s.attributeIDs),a[o]=u,o++}),a}function wH(t,e,n,r,i){const a=Math.floor(e),o=Math.floor(n),s=Math.floor(r),c=Math.floor(i),u=new Map,d=[0,0];for(let g=o;g<=c;g++)for(let h=a;h<=s;h++){const y=SH(t,[h,g],0,d);if(y&&y.valid){const v=$O(y);if(!u.has(v))u.set(v,{info:y,pixelCount:1,attributeIDs:[y.attributeID]});else{const C=u.get(v);C.pixelCount++,t.captureZValues&&y.zValue<C.info.zValue&&(C.info=y),C.attributeIDs.indexOf(y.attributeID)===-1&&C.attributeIDs.push(y.attributeID)}}}return HO(t.fieldAssociation,u,t.captureZValues,t.renderer,t.openGLRenderWindow)}function xH(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=()=>{e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=()=>{e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;const r=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=Rp.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();const i=e.framebuffer.getSize();!i||i[0]!==r[0]||i[1]!==r[1]?(e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===t1.FIELD_ASSOCIATION_POINTS){const i=e._openGLRenderWindow.getContext(),a=i.isEnabled(i.BLEND);i.disable(i.BLEND),e._openGLRenderWindow.traverseAllPasses(),a&&i.enable(i.BLEND)}},t.endSelection=()=>{e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending=r.isEnabled(r.BLEND),r.disable(r.BLEND)},t.postCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending&&r.enable(r.BLEND)},t.select=()=>{let r=null;return t.captureBuffers()&&(r=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),r},t.getSourceDataAsync=async(r,i,a,o,s)=>{if(e._renderer=r,i===void 0){const u=e._openGLRenderWindow.getSize();t.setArea(0,0,u[0]-1,u[1]-1)}else t.setArea(i,a,o,s);if(!t.captureBuffers())return!1;const c={area:[...e.area],pixBuffer:[...e.pixBuffer],captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:[...e.props],fieldAssociation:e.fieldAssociation,renderer:r,openGLRenderWindow:e._openGLRenderWindow};return c.generateSelection=function(){for(var u=arguments.length,d=new Array(u),g=0;g<u;g++)d[g]=arguments[g];return wH(c,...d)},c},t.captureBuffers=()=>{if(!e._renderer||!e._openGLRenderWindow)return BO("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);const r=e._openGLRenderWindow.getRenderPasses();t.beginSelection();const i=[];for(e.currentPass=Fr.MIN_KNOWN_PASS;e.currentPass<=Fr.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===Fr.ACTOR_PASS&&typeof r[0].requestDepth=="function"&&typeof r[0].getFramebuffer=="function"&&r[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),i.push(e.currentPass));return i.forEach(a=>{e.currentPass=a,t.processPixelBuffers()}),e.currentPass=Fr.MAX_KNOWN_PASS,t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=()=>{e.props.forEach((r,i)=>{t.isPropHit(i)&&r.processSelectorPixelBuffers(t,e.propPixels[i])})},t.passRequired=r=>{if(r===Fr.ID_HIGH24){if(e.fieldAssociation===t1.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===t1.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=r=>{if(e.pixBuffer[r]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[r]){const i=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[r]=new Uint8Array(i),e.rawPixBuffer[r].set(e.pixBuffer[r])}if(r===Fr.ACTOR_PASS){if(e.captureZValues){const i=e._openGLRenderWindow.getRenderPasses();if(typeof i[0].requestDepth=="function"&&typeof i[0].getFramebuffer=="function"){const a=i[0].getFramebuffer();a.saveCurrentBindingsAndBuffers(),a.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),a.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[r])}},t.buildPropHitList=r=>{let i=0;for(let a=0;a<=e.area[3]-e.area[1];a++)for(let o=0;o<=e.area[2]-e.area[0];o++){let s=Ic(o,a,r,e.area);s>0&&(s--,s in e.hitProps||(e.hitProps[s]=!0,e.propPixels[s]=[]),e.propPixels[s].push(i*4)),++i}},t.renderProp=r=>{e.currentPass===Fr.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+V0),e.props.push(r))},t.renderCompositeIndex=r=>{e.currentPass===Fr.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(r+V0)},t.renderAttributeId=r=>{r<0||(e.maxAttributeId=r>e.maxAttributeId?r:e.maxAttributeId)},t.passTypeToString=r=>H.enumToString(Fr,r),t.isPropHit=r=>!!e.hitProps[r],t.setPropColorValueFromInt=r=>{e.propColorValue[0]=r%256/255,e.propColorValue[1]=Math.floor(r/256)%256/255,e.propColorValue[2]=Math.floor(r/65536)%256/255},t.getPixelInformation=(r,i,a)=>{const o=i<0?0:i;if(o===0){if(a[0]=r[0],a[1]=r[1],r[0]<e.area[0]||r[0]>e.area[2]||r[1]<e.area[1]||r[1]>e.area[3])return null;const d=[r[0]-e.area[0],r[1]-e.area[1]],g=Ic(d[0],d[1],e.pixBuffer[Fr.ACTOR_PASS],e.area);if(g<=0||g-V0>=e.props.length)return null;const h={};h.valid=!0,h.propID=g-V0,h.prop=e.props[h.propID];let m=Ic(d[0],d[1],e.pixBuffer[Fr.COMPOSITE_INDEX_PASS],e.area);if((m<0||m>16777215)&&(m=0),h.compositeID=m-V0,e.captureZValues){const C=(d[1]*(e.area[2]-e.area[0]+1)+d[0])*4;h.zValue=(256*e.zBuffer[C]+e.zBuffer[C+1])/65535,h.displayPosition=r}if(e.pixBuffer[Fr.ID_LOW24]&&WO(d[0],d[1],e.pixBuffer[Fr.ID_LOW24],e.area)===0)return h;const y=Ic(d[0],d[1],e.pixBuffer[Fr.ID_LOW24],e.area),v=Ic(d[0],d[1],e.pixBuffer[Fr.ID_HIGH24],e.area);return h.attributeID=zO(y,v),h}const s=[r[0],r[1]],c=[0,0];let u=t.getPixelInformation(r,0,a);if(u&&u.valid)return u;for(let d=1;d<o;++d){for(let g=s[1]>d?s[1]-d:0;g<=s[1]+d;++g)if(c[1]=g,s[0]>=d&&(c[0]=s[0]-d,u=t.getPixelInformation(c,0,a),u&&u.valid)||(c[0]=s[0]+d,u=t.getPixelInformation(c,0,a),u&&u.valid))return u;for(let g=s[0]>=d?s[0]-(d-1):0;g<=s[0]+(d-1);++g)if(c[0]=g,s[1]>=d&&(c[1]=s[1]-d,u=t.getPixelInformation(c,0,a),u&&u.valid)||(c[1]=s[1]+d,u=t.getPixelInformation(c,0,a),u&&u.valid))return u}return a[0]=r[0],a[1]=r[1],null},t.generateSelection=(r,i,a,o)=>{const s=Math.floor(r),c=Math.floor(i),u=Math.floor(a),d=Math.floor(o),g=new Map,h=[0,0];for(let m=c;m<=d;m++)for(let y=s;y<=u;y++){const v=[y,m],C=t.getPixelInformation(v,0,h);if(C&&C.valid){const S=$O(C);if(!g.has(S))g.set(S,{info:C,pixelCount:1,attributeIDs:[C.attributeID]});else{const w=g.get(S);w.pixelCount++,e.captureZValues&&C.zValue<w.info.zValue&&(w.info=C),w.attributeIDs.indexOf(C.attributeID)===-1&&w.attributeIDs.push(C.attributeID)}}}return HO(e.fieldAssociation,g,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=r=>e.rawPixBuffer[r],t.getPixelBuffer=r=>e.pixBuffer[r],t.attach=(r,i)=>{e._openGLRenderWindow=r,e._renderer=i};const n=t.setArea;t.setArea=function(){return n(...arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}const EH={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function jO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,EH,n),dH.extend(t,e,n),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),H.setGetArray(t,e,["area"],4),H.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),H.setGetArray(t,e,["propColorValue"],3),H.moveToProtected(t,e,["renderer","openGLRenderWindow"]),H.event(t,e,"event"),xH(t,e)}const RH=H.newInstance(jO,"vtkOpenGLHardwareSelector");var w8={newInstance:RH,extend:jO,...UO},O3={exports:{}},cC;function OH(){return cC||(cC=1,function(t,e){(function(n){t.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(S,w){var x=S[0],R=S[1],O=S[2],b=S[3];x+=(R&O|~R&b)+w[0]-680876936|0,x=(x<<7|x>>>25)+R|0,b+=(x&R|~x&O)+w[1]-389564586|0,b=(b<<12|b>>>20)+x|0,O+=(b&x|~b&R)+w[2]+606105819|0,O=(O<<17|O>>>15)+b|0,R+=(O&b|~O&x)+w[3]-1044525330|0,R=(R<<22|R>>>10)+O|0,x+=(R&O|~R&b)+w[4]-176418897|0,x=(x<<7|x>>>25)+R|0,b+=(x&R|~x&O)+w[5]+1200080426|0,b=(b<<12|b>>>20)+x|0,O+=(b&x|~b&R)+w[6]-1473231341|0,O=(O<<17|O>>>15)+b|0,R+=(O&b|~O&x)+w[7]-45705983|0,R=(R<<22|R>>>10)+O|0,x+=(R&O|~R&b)+w[8]+1770035416|0,x=(x<<7|x>>>25)+R|0,b+=(x&R|~x&O)+w[9]-1958414417|0,b=(b<<12|b>>>20)+x|0,O+=(b&x|~b&R)+w[10]-42063|0,O=(O<<17|O>>>15)+b|0,R+=(O&b|~O&x)+w[11]-1990404162|0,R=(R<<22|R>>>10)+O|0,x+=(R&O|~R&b)+w[12]+1804603682|0,x=(x<<7|x>>>25)+R|0,b+=(x&R|~x&O)+w[13]-40341101|0,b=(b<<12|b>>>20)+x|0,O+=(b&x|~b&R)+w[14]-1502002290|0,O=(O<<17|O>>>15)+b|0,R+=(O&b|~O&x)+w[15]+1236535329|0,R=(R<<22|R>>>10)+O|0,x+=(R&b|O&~b)+w[1]-165796510|0,x=(x<<5|x>>>27)+R|0,b+=(x&O|R&~O)+w[6]-1069501632|0,b=(b<<9|b>>>23)+x|0,O+=(b&R|x&~R)+w[11]+643717713|0,O=(O<<14|O>>>18)+b|0,R+=(O&x|b&~x)+w[0]-373897302|0,R=(R<<20|R>>>12)+O|0,x+=(R&b|O&~b)+w[5]-701558691|0,x=(x<<5|x>>>27)+R|0,b+=(x&O|R&~O)+w[10]+38016083|0,b=(b<<9|b>>>23)+x|0,O+=(b&R|x&~R)+w[15]-660478335|0,O=(O<<14|O>>>18)+b|0,R+=(O&x|b&~x)+w[4]-405537848|0,R=(R<<20|R>>>12)+O|0,x+=(R&b|O&~b)+w[9]+568446438|0,x=(x<<5|x>>>27)+R|0,b+=(x&O|R&~O)+w[14]-1019803690|0,b=(b<<9|b>>>23)+x|0,O+=(b&R|x&~R)+w[3]-187363961|0,O=(O<<14|O>>>18)+b|0,R+=(O&x|b&~x)+w[8]+1163531501|0,R=(R<<20|R>>>12)+O|0,x+=(R&b|O&~b)+w[13]-1444681467|0,x=(x<<5|x>>>27)+R|0,b+=(x&O|R&~O)+w[2]-51403784|0,b=(b<<9|b>>>23)+x|0,O+=(b&R|x&~R)+w[7]+1735328473|0,O=(O<<14|O>>>18)+b|0,R+=(O&x|b&~x)+w[12]-1926607734|0,R=(R<<20|R>>>12)+O|0,x+=(R^O^b)+w[5]-378558|0,x=(x<<4|x>>>28)+R|0,b+=(x^R^O)+w[8]-2022574463|0,b=(b<<11|b>>>21)+x|0,O+=(b^x^R)+w[11]+1839030562|0,O=(O<<16|O>>>16)+b|0,R+=(O^b^x)+w[14]-35309556|0,R=(R<<23|R>>>9)+O|0,x+=(R^O^b)+w[1]-1530992060|0,x=(x<<4|x>>>28)+R|0,b+=(x^R^O)+w[4]+1272893353|0,b=(b<<11|b>>>21)+x|0,O+=(b^x^R)+w[7]-155497632|0,O=(O<<16|O>>>16)+b|0,R+=(O^b^x)+w[10]-1094730640|0,R=(R<<23|R>>>9)+O|0,x+=(R^O^b)+w[13]+681279174|0,x=(x<<4|x>>>28)+R|0,b+=(x^R^O)+w[0]-358537222|0,b=(b<<11|b>>>21)+x|0,O+=(b^x^R)+w[3]-722521979|0,O=(O<<16|O>>>16)+b|0,R+=(O^b^x)+w[6]+76029189|0,R=(R<<23|R>>>9)+O|0,x+=(R^O^b)+w[9]-640364487|0,x=(x<<4|x>>>28)+R|0,b+=(x^R^O)+w[12]-421815835|0,b=(b<<11|b>>>21)+x|0,O+=(b^x^R)+w[15]+530742520|0,O=(O<<16|O>>>16)+b|0,R+=(O^b^x)+w[2]-995338651|0,R=(R<<23|R>>>9)+O|0,x+=(O^(R|~b))+w[0]-198630844|0,x=(x<<6|x>>>26)+R|0,b+=(R^(x|~O))+w[7]+1126891415|0,b=(b<<10|b>>>22)+x|0,O+=(x^(b|~R))+w[14]-1416354905|0,O=(O<<15|O>>>17)+b|0,R+=(b^(O|~x))+w[5]-57434055|0,R=(R<<21|R>>>11)+O|0,x+=(O^(R|~b))+w[12]+1700485571|0,x=(x<<6|x>>>26)+R|0,b+=(R^(x|~O))+w[3]-1894986606|0,b=(b<<10|b>>>22)+x|0,O+=(x^(b|~R))+w[10]-1051523|0,O=(O<<15|O>>>17)+b|0,R+=(b^(O|~x))+w[1]-2054922799|0,R=(R<<21|R>>>11)+O|0,x+=(O^(R|~b))+w[8]+1873313359|0,x=(x<<6|x>>>26)+R|0,b+=(R^(x|~O))+w[15]-30611744|0,b=(b<<10|b>>>22)+x|0,O+=(x^(b|~R))+w[6]-1560198380|0,O=(O<<15|O>>>17)+b|0,R+=(b^(O|~x))+w[13]+1309151649|0,R=(R<<21|R>>>11)+O|0,x+=(O^(R|~b))+w[4]-145523070|0,x=(x<<6|x>>>26)+R|0,b+=(R^(x|~O))+w[11]-1120210379|0,b=(b<<10|b>>>22)+x|0,O+=(x^(b|~R))+w[2]+718787259|0,O=(O<<15|O>>>17)+b|0,R+=(b^(O|~x))+w[9]-343485551|0,R=(R<<21|R>>>11)+O|0,S[0]=x+S[0]|0,S[1]=R+S[1]|0,S[2]=O+S[2]|0,S[3]=b+S[3]|0}function a(S){var w=[],x;for(x=0;x<64;x+=4)w[x>>2]=S.charCodeAt(x)+(S.charCodeAt(x+1)<<8)+(S.charCodeAt(x+2)<<16)+(S.charCodeAt(x+3)<<24);return w}function o(S){var w=[],x;for(x=0;x<64;x+=4)w[x>>2]=S[x]+(S[x+1]<<8)+(S[x+2]<<16)+(S[x+3]<<24);return w}function s(S){var w=S.length,x=[1732584193,-271733879,-1732584194,271733878],R,O,b,I,G,j;for(R=64;R<=w;R+=64)i(x,a(S.substring(R-64,R)));for(S=S.substring(R-64),O=S.length,b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],R=0;R<O;R+=1)b[R>>2]|=S.charCodeAt(R)<<(R%4<<3);if(b[R>>2]|=128<<(R%4<<3),R>55)for(i(x,b),R=0;R<16;R+=1)b[R]=0;return I=w*8,I=I.toString(16).match(/(.*?)(.{0,8})$/),G=parseInt(I[2],16),j=parseInt(I[1],16)||0,b[14]=G,b[15]=j,i(x,b),x}function c(S){var w=S.length,x=[1732584193,-271733879,-1732584194,271733878],R,O,b,I,G,j;for(R=64;R<=w;R+=64)i(x,o(S.subarray(R-64,R)));for(S=R-64<w?S.subarray(R-64):new Uint8Array(0),O=S.length,b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],R=0;R<O;R+=1)b[R>>2]|=S[R]<<(R%4<<3);if(b[R>>2]|=128<<(R%4<<3),R>55)for(i(x,b),R=0;R<16;R+=1)b[R]=0;return I=w*8,I=I.toString(16).match(/(.*?)(.{0,8})$/),G=parseInt(I[2],16),j=parseInt(I[1],16)||0,b[14]=G,b[15]=j,i(x,b),x}function u(S){var w="",x;for(x=0;x<4;x+=1)w+=r[S>>x*8+4&15]+r[S>>x*8&15];return w}function d(S){var w;for(w=0;w<S.length;w+=1)S[w]=u(S[w]);return S.join("")}d(s("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function S(w,x){return w=w|0||0,w<0?Math.max(w+x,0):Math.min(w,x)}ArrayBuffer.prototype.slice=function(w,x){var R=this.byteLength,O=S(w,R),b=R,I,G,j,F;return x!==n&&(b=S(x,R)),O>b?new ArrayBuffer(0):(I=b-O,G=new ArrayBuffer(I),j=new Uint8Array(G),F=new Uint8Array(this,O,I),j.set(F),G)}}();function g(S){return/[\u0080-\uFFFF]/.test(S)&&(S=unescape(encodeURIComponent(S))),S}function h(S,w){var x=S.length,R=new ArrayBuffer(x),O=new Uint8Array(R),b;for(b=0;b<x;b+=1)O[b]=S.charCodeAt(b);return w?O:R}function m(S){return String.fromCharCode.apply(null,new Uint8Array(S))}function y(S,w,x){var R=new Uint8Array(S.byteLength+w.byteLength);return R.set(new Uint8Array(S)),R.set(new Uint8Array(w),S.byteLength),R}function v(S){var w=[],x=S.length,R;for(R=0;R<x-1;R+=2)w.push(parseInt(S.substr(R,2),16));return String.fromCharCode.apply(String,w)}function C(){this.reset()}return C.prototype.append=function(S){return this.appendBinary(g(S)),this},C.prototype.appendBinary=function(S){this._buff+=S,this._length+=S.length;var w=this._buff.length,x;for(x=64;x<=w;x+=64)i(this._hash,a(this._buff.substring(x-64,x)));return this._buff=this._buff.substring(x-64),this},C.prototype.end=function(S){var w=this._buff,x=w.length,R,O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b;for(R=0;R<x;R+=1)O[R>>2]|=w.charCodeAt(R)<<(R%4<<3);return this._finish(O,x),b=d(this._hash),S&&(b=v(b)),this.reset(),b},C.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},C.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},C.prototype.setState=function(S){return this._buff=S.buff,this._length=S.length,this._hash=S.hash,this},C.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},C.prototype._finish=function(S,w){var x=w,R,O,b;if(S[x>>2]|=128<<(x%4<<3),x>55)for(i(this._hash,S),x=0;x<16;x+=1)S[x]=0;R=this._length*8,R=R.toString(16).match(/(.*?)(.{0,8})$/),O=parseInt(R[2],16),b=parseInt(R[1],16)||0,S[14]=O,S[15]=b,i(this._hash,S)},C.hash=function(S,w){return C.hashBinary(g(S),w)},C.hashBinary=function(S,w){var x=s(S),R=d(x);return w?v(R):R},C.ArrayBuffer=function(){this.reset()},C.ArrayBuffer.prototype.append=function(S){var w=y(this._buff.buffer,S),x=w.length,R;for(this._length+=S.byteLength,R=64;R<=x;R+=64)i(this._hash,o(w.subarray(R-64,R)));return this._buff=R-64<x?new Uint8Array(w.buffer.slice(R-64)):new Uint8Array(0),this},C.ArrayBuffer.prototype.end=function(S){var w=this._buff,x=w.length,R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],O,b;for(O=0;O<x;O+=1)R[O>>2]|=w[O]<<(O%4<<3);return this._finish(R,x),b=d(this._hash),S&&(b=v(b)),this.reset(),b},C.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},C.ArrayBuffer.prototype.getState=function(){var S=C.prototype.getState.call(this);return S.buff=m(S.buff),S},C.ArrayBuffer.prototype.setState=function(S){return S.buff=h(S.buff,!0),C.prototype.setState.call(this,S)},C.ArrayBuffer.prototype.destroy=C.prototype.destroy,C.ArrayBuffer.prototype._finish=C.prototype._finish,C.ArrayBuffer.hash=function(S,w){var x=c(new Uint8Array(S)),R=d(x);return w?v(R):R},C})}(O3)),O3.exports}var DH=OH();const _H=$s(DH),bH=["lastShaderProgramBound","context","_openGLRenderWindow"];function MH(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=(n,r,i)=>{let a=r;i.length>0&&(a=Te.substitute(a,"VSOut","GSOut").result);const o=e._openGLRenderWindow.getWebgl2();let s=`
`,c=`#version 100
`;o?c=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(s=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(s+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),a=Te.substitute(a,"//VTK::System::Dec",[`${c}
`,o?"":`#extension GL_OES_standard_derivatives : enable
`,s,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let u=Te.substitute(n,"//VTK::System::Dec",[`${c}
`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(o){u=Te.substitute(u,"varying","out").result,a=Te.substitute(a,"varying","in").result;let g="",h=0;for(;a.includes(`gl_FragData[${h}]`);)a=Te.substitute(a,`gl_FragData\\[${h}\\]`,`fragOutput${h}`).result,g+=`layout(location = ${h}) out vec4 fragOutput${h};
`,h++;a=Te.substitute(a,"//VTK::Output::Dec",g).result}const d=Te.substitute(i,"//VTK::System::Dec",c).result;return{VSSource:u,FSSource:a,GSSource:d}},t.readyShaderProgramArray=(n,r,i)=>{const a=t.replaceShaderValues(n,r,i),o=t.getShaderProgram(a.VSSource,a.FSSource,a.GSSource);return t.readyShaderProgram(o)},t.readyShaderProgram=n=>!n||!n.getCompiled()&&!n.compileShader()||!t.bindShaderProgram(n)?null:n,t.getShaderProgram=(n,r,i)=>{const a=`${n}${r}${i}`,o=_H.hash(a);if(!(o in e.shaderPrograms)){const s=Te.newInstance();return s.setContext(e.context),s.getVertexShader().setSource(n),s.getFragmentShader().setSource(r),i&&s.getGeometryShader().setSource(i),s.setMd5Hash(o),e.shaderPrograms[o]=s,s}return e.shaderPrograms[o]},t.releaseGraphicsResources=n=>{t.releaseCurrentShaderProgram(),Object.keys(e.shaderPrograms).map(r=>e.shaderPrograms[r]).forEach(r=>r.cleanup()),e.shaderPrograms={}},t.releaseCurrentShaderProgram=()=>{e.lastShaderProgramBound&&(e.lastShaderProgramBound.cleanup(),e.lastShaderProgramBound=null)},t.bindShaderProgram=n=>(e.lastShaderProgramBound===n||(e.lastShaderProgramBound&&e.lastShaderProgramBound.release(),n.bind(),e.lastShaderProgramBound=n),1)}const LH={lastShaderProgramBound:null,shaderPrograms:null,context:null};function qO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LH,n),e.shaderPrograms={},H.obj(t,e),H.setGet(t,e,bH),H.moveToProtected(t,e,["openGLRenderWindow"]),MH(t,e)}const VH=H.newInstance(qO,"vtkShaderCache");var IH={newInstance:VH,extend:qO};const{vtkErrorMacro:AH}=H;function NH(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]===!0&&AH("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=n=>{if(e.context!==n){if(e.context!==0&&t.deleteTable(),e.context=n,e.context){e.numberOfTextureUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}t.modified()}},t.allocate=()=>{for(let n=0;n<e.numberOfTextureUnits;n++)if(!t.isAllocated(n))return e.textureUnits[n]=!0,n;return-1},t.allocateUnit=n=>t.isAllocated(n)?-1:(e.textureUnits[n]=!0,n),t.isAllocated=n=>e.textureUnits[n],t.free=n=>{e.textureUnits[n]=!1},t.freeAll=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}}const PH={context:null,numberOfTextureUnits:0,textureUnits:0};function KO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PH,n),H.obj(t,e),e.textureUnits=[],H.get(t,e,["numberOfTextureUnits"]),H.setGet(t,e,["context"]),NH(t,e)}const UH=H.newInstance(KO,"vtkOpenGLTextureUnitManager");var FH={newInstance:UH,extend:KO};function kH(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=()=>null,t.getAspectRatio=()=>e.size[0]/e.size[1],t.getAspectRatioForRenderer=n=>{const r=n.getViewportByReference();return e.size[0]*(r[2]-r[0])/((r[3]-r[1])*e.size[1])},t.isInViewport=(n,r,i)=>{const a=i.getViewportByReference(),o=t.getFramebufferSize();return a[0]*o[0]<=n&&a[2]*o[0]>=n&&a[1]*o[1]<=r&&a[3]*o[1]>=r},t.getViewportSize=n=>{const r=n.getViewportByReference(),i=t.getFramebufferSize();return[(r[2]-r[0])*i[0],(r[3]-r[1])*i[1]]},t.getViewportCenter=n=>{const r=t.getViewportSize(n);return[r[0]*.5,r[1]*.5]},t.displayToNormalizedDisplay=(n,r,i)=>{const a=t.getFramebufferSize();return[n/a[0],r/a[1],i]},t.normalizedDisplayToDisplay=(n,r,i)=>{const a=t.getFramebufferSize();return[n*a[0],r*a[1],i]},t.worldToView=(n,r,i,a)=>a.worldToView(n,r,i),t.viewToWorld=(n,r,i,a)=>a.viewToWorld(n,r,i),t.worldToDisplay=(n,r,i,a)=>{const o=a.worldToView(n,r,i),s=t.getViewportSize(a),c=a.viewToProjection(o[0],o[1],o[2],s[0]/s[1]),u=a.projectionToNormalizedDisplay(c[0],c[1],c[2]);return t.normalizedDisplayToDisplay(u[0],u[1],u[2])},t.displayToWorld=(n,r,i,a)=>{const o=t.displayToNormalizedDisplay(n,r,i),s=a.normalizedDisplayToProjection(o[0],o[1],o[2]),c=t.getViewportSize(a),u=a.projectionToView(s[0],s[1],s[2],c[0]/c[1]);return a.viewToWorld(u[0],u[1],u[2])},t.normalizedDisplayToViewport=(n,r,i,a)=>{let o=a.getViewportByReference();o=t.normalizedDisplayToDisplay(o[0],o[1],0);const s=t.normalizedDisplayToDisplay(n,r,i);return[s[0]-o[0]-.5,s[1]-o[1]-.5,i]},t.viewportToNormalizedViewport=(n,r,i,a)=>{const o=t.getViewportSize(a);return o&&o[0]!==0&&o[1]!==0?[n/(o[0]-1),r/(o[1]-1),i]:[n,r,i]},t.normalizedViewportToViewport=(n,r,i,a)=>{const o=t.getViewportSize(a);return[n*(o[0]-1),r*(o[1]-1),i]},t.displayToLocalDisplay=(n,r,i)=>{const a=t.getFramebufferSize();return[n,a[1]-r-1,i]},t.viewportToNormalizedDisplay=(n,r,i,a)=>{let o=a.getViewportByReference();o=t.normalizedDisplayToDisplay(o[0],o[1],0);const s=n+o[0]+.5,c=r+o[1]+.5;return t.displayToNormalizedDisplay(s,c,i)},t.getComputedDevicePixelRatio=()=>e.size[0]/t.getContainerSize()[0],t.getContainerSize=()=>{H.vtkErrorMacro("not implemented")},t.getPixelData=(n,r,i,a)=>{H.vtkErrorMacro("not implemented")},t.createSelector=()=>{H.vtkErrorMacro("not implemented")}}const GH={size:void 0,selector:void 0};function YO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GH,n),e.size||(e.size=[300,300]),H.getArray(t,e,["size"],2),H.get(t,e,["selector"]),$r.extend(t,e,n),kH(t,e)}const BH=H.newInstance(YO,"vtkRenderWindowViewNode");var $H={newInstance:BH,extend:YO};const WH="__getUnderlyingContext";function zH(){const t=new Map,e={apply(i,a,o){return t.has(o[0])?t.get(o[0]):i.apply(a,o)}};function n(i){return{apply(a,o,s){return t.set(i,s[0]),a.apply(o,s)}}}const r=Object.create(null);return r.getParameter=(i,a,o,s)=>new Proxy(s.bind(i),e),r.depthMask=(i,a,o,s)=>new Proxy(s.bind(i),n(i.DEPTH_WRITEMASK)),{get(i,a,o){if(a===WH)return()=>i;let s=Reflect.get(i,a,i);s instanceof Function&&(s=s.bind(i));const c=r[a];return c?c(i,a,o,s):s}}}const{vtkDebugMacro:lC,vtkErrorMacro:uC}=H,HH={position:"absolute",top:0,left:0,width:"100%",height:"100%"},jH=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","registerGraphicsResourceUser","unregisterGraphicsResourceUser","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function ca(t,e,n){const r=t.createFramebuffer(),i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,n,null),t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),a===t.FRAMEBUFFER_COMPLETE}let z2=0;const Dp=[];function qH(){z2++,Dp.forEach(t=>t(z2))}function KH(){z2--,Dp.forEach(t=>t(z2))}function YH(t){Dp.push(t)}function XH(t){return Dp.pop()}function fC(t){t.preventDefault()}function ZH(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");let n;function r(){return n||(n=zH()),n}t.getViewNodeFactory=()=>e.myFactory,e.canvas.addEventListener("webglcontextlost",fC,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);const i=[0,0];function a(){e.renderable&&(e.size[0]!==i[0]||e.size[1]!==i[1])&&(i[0]=e.size[0],i[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(a),t.buildPass=g=>{if(g){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.addMissingNodes(e.renderable.getChildRenderWindowsByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(h=>{h.setOpenGLRenderWindow?.(t)})}},t.initialize=()=>{if(!e.initialized){if(e.rootOpenGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.rootOpenGLRenderWindow)e.context2D=t.get2DContext();else{e.context=t.get3DContext(),t.resizeFromChildRenderWindows(),e.context&&qH(),e.textureUnitManager=FH.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);const g=e.context;g.blendFuncSeparate(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA,g.ONE,g.ONE_MINUS_SRC_ALPHA),g.depthFunc(g.LEQUAL),g.enable(g.BLEND)}e.initialized=!0}},t.makeCurrent=()=>{e.context.makeCurrent()},t.setContainer=g=>{e.el&&e.el!==g&&(e.canvas.parentNode!==e.el&&uC("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==g&&(e.el=g,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:g,height:h}=e.el.getBoundingClientRect();e.containerSize=[g,h]}return e.containerSize||e.size},t.getFramebufferSize=()=>e.activeFramebuffer?.getSize()||e.size,t.getPixelData=(g,h,m,y)=>{const v=new Uint8Array((m-g+1)*(y-h+1)*4);return e.context.readPixels(g,h,m-g+1,y-h+1,e.context.RGBA,e.context.UNSIGNED_BYTE,v),v},t.get3DContext=function(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},h=null;const m=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&m&&(h=e.canvas.getContext("webgl2",g),h&&(e.webgl2=!0,lC("using webgl2"))),h||(lC("using webgl1"),h=e.canvas.getContext("webgl",g)||e.canvas.getContext("experimental-webgl",g)),new Proxy(h,r())},t.get2DContext=function(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.canvas.getContext("2d",g)},t.restoreContext=()=>{const g=S8.newInstance();g.setCurrentOperation("Release"),g.traverse(t,null)},t.activateTexture=g=>{const h=e._textureResourceIds.get(g);if(h!==void 0){e.context.activeTexture(e.context.TEXTURE0+h);return}const m=t.getTextureUnitManager().allocate();if(m<0){uC("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(g,m),e.context.activeTexture(e.context.TEXTURE0+m)},t.deactivateTexture=g=>{const h=e._textureResourceIds.get(g);h!==void 0&&(t.getTextureUnitManager().free(h),e._textureResourceIds.delete(g))},t.getTextureUnitForTexture=g=>{const h=e._textureResourceIds.get(g);return h!==void 0?h:-1},t.getDefaultTextureByteSize=function(g){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e.webgl2)switch(g){case kt.CHAR:case kt.SIGNED_CHAR:case kt.UNSIGNED_CHAR:return 1;case h:case m:case kt.UNSIGNED_SHORT:case kt.SHORT:case kt.VOID:return 2;default:return 4}return 1},t.getDefaultTextureInternalFormat=function(g,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(g){case kt.UNSIGNED_CHAR:switch(h){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(m&&!y&&kt.UNSIGNED_SHORT):switch(h){case 1:return m.R16_EXT;case 2:return m.RG16_EXT;case 3:return m.RGB16_EXT;case 4:default:return m.RGBA16_EXT}case(m&&!y&&kt.SHORT):switch(h){case 1:return m.R16_SNORM_EXT;case 2:return m.RG16_SNORM_EXT;case 3:return m.RGB16_SNORM_EXT;case 4:default:return m.RGBA16_SNORM_EXT}case kt.UNSIGNED_SHORT:case kt.SHORT:case kt.FLOAT:default:switch(h){case 1:return y?e.context.R16F:e.context.R32F;case 2:return y?e.context.RG16F:e.context.RG32F;case 3:return y?e.context.RGB16F:e.context.RGB32F;case 4:default:return y?e.context.RGBA16F:e.context.RGBA32F}}switch(h){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=g=>{e.bgImage.src=g.src},t.setUseBackgroundImage=g=>{e.useBackgroundImage=g,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function o(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const h=document.createElement("canvas"),m=h.getContext("2d");h.width=e.canvas.width,h.height=e.canvas.height,m.drawImage(e.canvas,0,0);const y=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(w=>{w.getViewProps().forEach(R=>{if(R.getContainer){const b=R.getContainer().getElementsByTagName("canvas");for(let I=0;I<b.length;I++){const G=b[I],j=G.getBoundingClientRect(),F=j.x-y.x,$=j.y-y.y;m.drawImage(G,F,$)}}})});const S=h.toDataURL(g);h.remove(),t.invokeImageReady(S)}t.captureNextImage=function(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:h=!1,size:m=null,scale:y=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=g;const v=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:m||y!==1?m||e.size.map(C=>C*y):null},new Promise((C,S)=>{const w=t.onImageReady(x=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=v,w.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(R=>{let{restoreParamsFn:O,arg:b}=R;return O(b)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),C(x);else{const R=document.createElement("img");if(R.style=HH,R.src=x,e._screenshot.placeHolder=e.el.appendChild(R),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e.rootOpenGLRenderWindow?.resizeFromChildRenderWindows(),e._screenshot.size=null,t.modified(),h){const O=h!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(b=>{const I=b.getActiveCamera(),G=I.get("focalPoint","position","parallelScale");return{resetCameraArgs:O?{renderer:b}:void 0,resetCameraFn:O?h:b.resetCamera,restoreParamsFn:I.set,arg:JSON.parse(JSON.stringify(G))}}),e._screenshot.cameras.forEach(b=>{let{resetCameraFn:I,resetCameraArgs:G}=b;return I(G)})}t.traverseAllPasses()}})})};let s;t.getHardwareMaximumLineWidth=()=>{if(s!=null)return s;const g=t.get3DContext(),h=g.getParameter(g.ALIASED_LINE_WIDTH_RANGE);return s=h[1],h[1]},t.getGLInformations=()=>{if(e._glInformation)return e._glInformation;const g=t.get3DContext(),h=g.getExtension("OES_texture_float"),m=g.getExtension("OES_texture_half_float"),y=g.getExtension("WEBGL_debug_renderer_info"),v=g.getExtension("WEBGL_draw_buffers"),C=g.getExtension("EXT_texture_filter_anisotropic")||g.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),S=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",g.getParameter(g.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",g.getParameter(g.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",g.getParameter(g.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",g.getParameter(g.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",g.getParameter(g.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",g.getParameter(g.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",g.getParameter(g.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",g.getParameter(g.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",g.getParameter(g.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",C&&g.getParameter(C.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",g.getParameter(g.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",g.getParameter(g.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",g.getParameter(g.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",g.getParameter(g.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",g.getParameter(g.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",g.getParameter(g.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",g.getParameter(g.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",g.getParameter(g.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",g.getParameter(g.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",g.getParameter(g.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",g.getParameter(g.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",g.getParameter(g.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",g.getParameter(g.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[h&&ca(g,g.RGBA,g.UNSIGNED_BYTE)?"RGBA":"",h&&ca(g,g.RGB,g.UNSIGNED_BYTE)?"RGB":"",h&&ca(g,g.LUMINANCE,g.UNSIGNED_BYTE)?"LUMINANCE":"",h&&ca(g,g.ALPHA,g.UNSIGNED_BYTE)?"ALPHA":"",h&&ca(g,g.LUMINANCE_ALPHA,g.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[m&&ca(g,g.RGBA,m.HALF_FLOAT_OES)?"RGBA":"",m&&ca(g,g.RGB,m.HALF_FLOAT_OES)?"RGB":"",m&&ca(g,g.LUMINANCE,m.HALF_FLOAT_OES)?"LUMINANCE":"",m&&ca(g,g.ALPHA,m.HALF_FLOAT_OES)?"ALPHA":"",m&&ca(g,g.LUMINANCE_ALPHA,m.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[h&&ca(g,g.RGBA,g.FLOAT)?"RGBA":"",h&&ca(g,g.RGB,g.FLOAT)?"RGB":"",h&&ca(g,g.LUMINANCE,g.FLOAT)?"LUMINANCE":"",h&&ca(g,g.ALPHA,g.FLOAT)?"ALPHA":"",h&&ca(g,g.LUMINANCE_ALPHA,g.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",v?g.getParameter(v.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.HIGH_FLOAT).precision," (-2<sup>",g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.MEDIUM_FLOAT).precision," (-2<sup>",g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.LOW_FLOAT).precision," (-2<sup>",g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.HIGH_FLOAT).precision," (-2<sup>",g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.MEDIUM_FLOAT).precision," (-2<sup>",g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.LOW_FLOAT).precision," (-2<sup>",g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.HIGH_INT).precision," (-2<sup>",g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.HIGH_INT).rangeMin,"</sup> - 2<sup>",g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.MEDIUM_INT).precision," (-2<sup>",g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.LOW_INT).precision," (-2<sup>",g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.LOW_INT).rangeMin,"</sup> - 2<sup>",g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.HIGH_INT).precision," (-2<sup>",g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.HIGH_INT).rangeMin,"</sup> - 2<sup>",g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.MEDIUM_INT).precision," (-2<sup>",g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.LOW_INT).precision," (-2<sup>",g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.LOW_INT).rangeMin,"</sup> - 2<sup>",g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",g.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",g.getParameter(g.RENDERER)],["WebGL Vendor","VENDOR",g.getParameter(g.VENDOR)],["WebGL Version","VERSION",g.getParameter(g.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",g.getParameter(g.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",y&&g.getParameter(y.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",y&&g.getParameter(y.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],w={};for(;S.length;){const[x,R,O]=S.pop();R&&(w[R]={label:x,value:O})}return e._glInformation=w,w},t.traverseAllPasses=()=>{if(e.renderPasses)for(let h=0;h<e.renderPasses.length;++h)e.renderPasses[h].traverse(t,null);t.copyParentContent(),e.notifyStartCaptureImage&&o();const g=e.renderable.getChildRenderWindowsByReference();for(let h=0;h<g.length;++h)t.getViewNodeFor(g[h])?.traverseAllPasses()},t.copyParentContent=()=>{const g=e.rootOpenGLRenderWindow;if(!g||!e.context2D||e.children.some(y=>!!y.getSelector?.()))return;const h=g.getCanvas(),m=e.canvas;e.context2D.drawImage(h,0,h.height-m.height,m.width,m.height,0,0,m.width,m.height)},t.resizeFromChildRenderWindows=()=>{const g=e.renderable.getChildRenderWindowsByReference();if(g.length>0){const h=[0,0];for(let m=0;m<g.length;++m){const y=t.getViewNodeFor(g[m])?.getSize();y&&(h[0]=y[0]>h[0]?y[0]:h[0],h[1]=y[1]>h[1]?y[1]:h[1])}t.setSize(...h)}},t.disableCullFace=()=>{e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=()=>{e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=g=>{if(e.viewStream===g)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=g,e.viewStream){const h=e.renderable.getRenderers()[0];h.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(m=>t.setBackgroundImage(m.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=()=>{const g=w8.newInstance();return g.setOpenGLRenderWindow(t),g};function c(){e.canvas.removeEventListener("webglcontextlost",fC),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=H.chain(()=>{e.context&&KH(),t.setContainer(),t.setViewStream()},c,t.delete),t.setActiveFramebuffer=g=>{e.activeFramebuffer=g};const u=t.setSize;t.setSize=(g,h)=>{const m=u(g,h);return m&&t.invokeWindowResizeEvent({width:g,height:h}),m},t.registerGraphicsResourceUser=(g,h)=>{e._graphicsResources.has(g)||t.setGraphicsResourceForObject(g,null,null),e._graphicsResources.get(g)?.users.add(h)},t.unregisterGraphicsResourceUser=(g,h)=>{const m=e._graphicsResources.get(g);m&&(m.users.delete(h),m.users.size||(m.oglObject?.releaseGraphicsResources(t),e._graphicsResources.delete(g)))},t.getGraphicsResourceForObject=g=>e._graphicsResources.get(g),t.setGraphicsResourceForObject=(g,h,m)=>{if(!g)return;const y=e._graphicsResources.get(g);y?.oglObject?.releaseGraphicsResources(t),e._graphicsResources.set(g,{coreObject:g,oglObject:h,hash:m,users:y?.users??new Set})},t.getGraphicsMemoryInfo=()=>{let g=0;return e._graphicsResources.forEach(h=>{let{oglObject:m}=h;g+=m.getAllocatedGPUMemoryInBytes()}),g},t.releaseGraphicsResources=()=>{e.shaderCache!==null&&e.shaderCache.releaseGraphicsResources(t),e._graphicsResources.forEach(g=>{let{oglObject:h}=g;h.releaseGraphicsResources(t)}),e._graphicsResources.clear(),e.textureUnitManager!==null&&e.textureUnitManager.freeAll(),e.renderable.getRenderersByReference().forEach(g=>{t.getViewNodeFor(g)?.releaseGraphicsResources()})};const d={...t};jH.forEach(g=>{t[g]=function(){return e.rootOpenGLRenderWindow?e.rootOpenGLRenderWindow[g](...arguments):d[g](...arguments)}})}const QH={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function XO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QH,n),$H.extend(t,e,n),e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.width="100%"),e.selector||(e.selector=w8.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e._graphicsResources=new Map,e._glInformation=null,e.myFactory=ik.newInstance(),e.shaderCache=IH.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=cH.newInstance(),H.get(t,e,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),H.setGet(t,e,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),H.setGetArray(t,e,["size"],2),H.event(t,e,"imageReady"),H.event(t,e,"windowResizeEvent"),ZH(t,e)}const x8=H.newInstance(XO,"vtkOpenGLRenderWindow");LO("WebGL",x8);var JH={newInstance:x8,extend:XO,pushMonitorGLContextCount:YH,popMonitorGLContextCount:XH};xi("vtkRenderWindow",x8);function ej(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=n=>{if(n){e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const i=e.children[r];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(e._openGLRenderer.getSelector()&&e.renderable.getNestedPickable()),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),_r(e.keyMatrices.mcwc,e.renderable.getMatrix()),Qt(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?rs(e.keyMatrices.normalMatrix):(vp(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),F1(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Wv(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices)}const tj={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function nj(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tj,n),$r.extend(t,e,n),e.keyMatrixTime={},Yn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:rs(new Float64Array(9)),mcwc:wt(new Float64Array(16))},ri(t,e,["context"]),ha(t,e,["activeTextures"]),ej(t,e)}const ZO=An(nj);var rj={newInstance:ZO};xi("vtkActor",ZO);function ij(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=n=>{if(n){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const i=e.children[r];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOverlayActorCount()}},t.traverseOpaquePass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOverlayPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.overlayPass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()}}const aj={context:null,activeTextures:null};function oj(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aj,n),$r.extend(t,e,n),ri(t,e,["context"]),ha(t,e,["activeTextures"]),ij(t,e)}const QO=An(oj);var sj={newInstance:QO};xi("vtkActor2D",QO);function cj(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=n=>n.isA("vtkPlane")?e.clippingPlanes.includes(n)?!1:(e.clippingPlanes.push(n),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=n=>{const r=e.clippingPlanes.indexOf(n);return r===-1?!1:(e.clippingPlanes.splice(r,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=n=>{if(n)if(!Array.isArray(n))t.addClippingPlane(n);else{const r=n.length;for(let i=0;i<r&&i<6;i++)t.addClippingPlane(n[i])}},t.getClippingPlaneInDataCoords=(n,r,i)=>{const a=e.clippingPlanes,o=n;if(a){const s=a.length;if(r>=0&&r<s){const c=a[r],u=c.getNormal(),d=c.getOrigin(),g=u[0],h=u[1],m=u[2],y=-(g*d[0]+h*d[1]+m*d[2]);i[0]=g*o[0]+h*o[4]+m*o[8]+y*o[12],i[1]=g*o[1]+h*o[5]+m*o[9]+y*o[13],i[2]=g*o[2]+h*o[6]+m*o[10]+y*o[14],i[3]=g*o[3]+h*o[7]+m*o[11]+y*o[15];return}}H.vtkErrorMacro(`Clipping plane index ${r} is out of range.`)}}const lj={clippingPlanes:[]};function uj(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lj,n),H.obj(t,e),H.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),cj(t,e)}var fj={extend:uj};function gj(t,e){t.getBounds=()=>(H.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),W0()),t.getCenter=()=>{const n=t.getBounds();return e.center=kn.isValid(n)?kn.getCenter(n):null,e.center?.slice()},t.getLength=()=>{const n=t.getBounds();return kn.getDiagonalLength(n)}}const dj=t=>({bounds:[...kn.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function hj(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dj(n)),fj.extend(t,e,n),H.setGet(t,e,["viewSpecificProperties"]),gj(t,e)}var E8={extend:hj};const{vtkErrorMacro:gC}=H,dC=0,hC=1,D3=2;function pj(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=()=>{if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){let n=!0;e.nanColor[3]<1&&(n=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(n=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(n=0);for(let r=3;r<e.table.length&&n;r+=4)e.table[r]<255&&(n=!1);e.opaqueFlag=n,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>e.table.length/4-3,t.linearIndexLookup=(n,r)=>{let i=0;const a=Number(n);return a<r.range[0]?i=r.maxIndex+dC+1.5:a>r.range[1]?i=r.maxIndex+hC+1.5:(i=(a+r.shift)*r.scale,i=i<r.maxIndex?i:r.maxIndex),Math.floor(i)},t.linearLookup=(n,r,i)=>{let a=0;b2(n)?a=Math.floor(i.maxIndex+1.5+D3):a=t.linearIndexLookup(n,i);const o=4*a;return r.slice(o,o+4)},t.indexedLookupFunction=(n,r,i)=>{let a=t.getAnnotatedValueIndexInternal(n);a===-1&&(a=e.numberOfColors+D3);const o=4*a;return[r[o],r[o+1],r[o+2],r[o+3]]},t.lookupShiftAndScale=(n,r)=>{r.shift=-n[0],r.scale=Number.MAX_VALUE,n[1]>n[0]&&(r.scale=(r.maxIndex+1)/(n[1]-n[0]))},t.mapScalarsThroughTable=(n,r,i,a)=>{let o=t.linearLookup;e.indexedLookup&&(o=t.indexedLookupFunction);const s=t.getMappingRange(),c={maxIndex:t.getNumberOfColors()-1,range:s,shift:0,scale:0};t.lookupShiftAndScale(s,c);const u=t.getAlpha(),d=n.getNumberOfTuples(),g=n.getNumberOfComponents(),h=r.getData(),m=n.getData();if(u>=1){if(i===b4.RGBA)for(let y=0;y<d;y++){const v=o(m[y*g+a],e.table,c);h[y*4]=v[0],h[y*4+1]=v[1],h[y*4+2]=v[2],h[y*4+3]=v[3]}}else if(i===b4.RGBA)for(let y=0;y<d;y++){const v=o(m[y*g+a],e.table,c);h[y*4]=v[0],h[y*4+1]=v[1],h[y*4+2]=v[2],h[y*4+3]=Math.floor(v[3]*u+.5)}},t.forceBuild=()=>{let n=0,r=0,i=0,a=0;const o=e.numberOfColors-1;o&&(n=(e.hueRange[1]-e.hueRange[0])/o,r=(e.saturationRange[1]-e.saturationRange[0])/o,i=(e.valueRange[1]-e.valueRange[0])/o,a=(e.alphaRange[1]-e.alphaRange[0])/o),e.table.length=4*o+16;const s=[],c=[];for(let u=0;u<=o;u++)s[0]=e.hueRange[0]+u*n,s[1]=e.saturationRange[0]+u*r,s[2]=e.valueRange[0]+u*i,Rl(s,c),c[3]=e.alphaRange[0]+u*a,e.table[u*4]=c[0]*255+.5,e.table[u*4+1]=c[1]*255+.5,e.table[u*4+2]=c[2]*255+.5,e.table[u*4+3]=c[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=n=>{if(Array.isArray(n)){const i=n[0].length;e.numberOfColors=n.length;const a=4-i;let o=0;for(let s=0;s<e.numberOfColors;s++)e.table[s*4]=255,e.table[s*4+1]=255,e.table[s*4+2]=255,e.table[s*4+3]=255;for(let s=0;s<n.length;s++){const c=n[s];for(let u=0;u<i;u++)e.table[o++]=c[u];o+=a}return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0}if(n.getNumberOfComponents()!==4)return gC("Expected 4 components for RGBA colors"),!1;if(n.getDataType()!==kt.UNSIGNED_CHAR)return gC("Expected unsigned char values for RGBA colors"),!1;e.numberOfColors=n.getNumberOfTuples();const r=n.getData();e.table.length=r.length;for(let i=0;i<r.length;i++)e.table[i]=r[i];return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0},t.buildSpecialColors=()=>{const{numberOfColors:n}=e,r=e.table;let i=(n+dC)*4;e.useBelowRangeColor||n===0?(r[i]=e.belowRangeColor[0]*255+.5,r[i+1]=e.belowRangeColor[1]*255+.5,r[i+2]=e.belowRangeColor[2]*255+.5,r[i+3]=e.belowRangeColor[3]*255+.5):(r[i]=r[0],r[i+1]=r[1],r[i+2]=r[2],r[i+3]=r[3]),i=(n+hC)*4,e.useAboveRangeColor||n===0?(r[i]=e.aboveRangeColor[0]*255+.5,r[i+1]=e.aboveRangeColor[1]*255+.5,r[i+2]=e.aboveRangeColor[2]*255+.5,r[i+3]=e.aboveRangeColor[3]*255+.5):(r[i]=r[4*(n-1)+0],r[i+1]=r[4*(n-1)+1],r[i+2]=r[4*(n-1)+2],r[i+3]=r[4*(n-1)+3]),i=(n+D3)*4,r[i]=e.nanColor[0]*255+.5,r[i+1]=e.nanColor[1]*255+.5,r[i+2]=e.nanColor[2]*255+.5,r[i+3]=e.nanColor[3]*255+.5},t.build=()=>{(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&(t.buildSpecialColors(),e.insertTime.modified())}const mj={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function JO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mj,n),Gv.extend(t,e,n),e.table||(e.table=[]),e.buildTime={},H.obj(e.buildTime),e.opaqueFlagBuildTime={},H.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},H.obj(e.insertTime,{mtime:0}),H.get(t,e,["buildTime"]),H.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),H.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),H.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),H.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),pj(t,e)}const vj=H.newInstance(JO,"vtkLookupTable");var W4={newInstance:vj,extend:JO};const{FieldAssociations:pC}=Sf,{staticOffsetAPI:yj,otherStaticMethods:Tj}=xp,{ColorMode:gh,ScalarMode:hl,GetArray:_3}=kv,{VectorMode:Cj}=Fv,{VtkDataTypes:Sj}=Pt;function Sg(t){return()=>H.vtkErrorMacro(`vtkMapper::${t} - NOT IMPLEMENTED`)}function wj(t,e){const n=t[1]%2===0?1:-1;if(t[0]+=n,t[0]>=e[0]||t[0]<0){const r=t[2]%2===0?1:-1;t[0]-=n,t[1]+=r,(t[1]>=e[1]||t[1]<0)&&(t[1]-=r,t[2]++)}}function xj(t,e){return t[0]+e[0]*(t[1]+e[1]*t[2])}function mC(t,e,n){const r=Math.floor(e),i=r%(2*n[0]);let a,o;i<n[0]?(t[0]=i,a=1,o=t[0]===n[0]-1):(t[0]=2*n[0]-1-i,a=-1,o=t[0]===0);const s=Math.floor(r/n[0]),c=s%(2*n[1]);let u,d;c<n[1]?(t[1]=c,u=1,d=t[1]===n[1]-1):(t[1]=2*n[1]-1-c,u=-1,d=t[1]===0),t[2]=Math.floor(s/n[1]);const g=e-r;o?d?t[2]+=g:t[1]+=u*g:t[0]+=a*g,t[0]=(t[0]+.5)/n[0],t[1]=(t[1]+.5)/n[1],t[2]=(t[2]+.5)/n[2]}const vC=new WeakMap;function Ej(t,e,n,r,i,a,o){const s=new Array(arguments.length);for(let z=0;z<arguments.length;++z){const oe=arguments[z];s[z]=oe.getMTime?.()??oe}const c=s.join("/"),u=vC.get(t);if(u&&u.stringHash===c)return u.textureCoordinates;const d=(n[1]-n[0])/(r-1),[g,h]=[n[0]-d,n[1]+d],m=g-.5*d,y=1/(h-g+d),v=g,C=(r+1)/(h-g),S=t.getData(),w=t.getNumberOfTuples(),x=t.getNumberOfComponents(),R=e<0||e>=x,O=i[2]<=1?2:3,b=Pt.newInstance({numberOfComponents:O,values:new Float32Array(w*O)}),I=b.getData(),G=[0,0,0];mC(G,r+2,i);let j=0,F=0;const $=[.5,.5,.5];for(let z=0;z<w;++z){let oe;if(R){let Q=0;for(let le=0;le<x;++le){const X=S[j+le];Q+=X*X}oe=Math.sqrt(Q)}else oe=S[j+e];if(j+=x,a&&(oe=W4.applyLogScale(oe,n,n)),b2(oe))$[0]=G[0],$[1]=G[1],$[2]=G[2];else if(o){let Q=(oe-v)*C;Q<1?Q=0:Q>r&&(Q=r+1),mC($,Q,i)}else{$[1]=.49;const Q=(oe-m)*y;Q>1e3?$[0]=1e3:Q<-1e3?$[0]=-1e3:$[0]=Q}for(let Q=0;Q<O;++Q)I[F++]=$[Q]}return vC.set(t,{stringHash:c,textureCoordinates:b}),b}function Rj(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=()=>{const n=t.getInputData();return n?(e.static||t.update(),e.bounds=n.getBounds()):e.bounds=W0(),e.bounds},t.setForceCompileOnly=n=>{e.forceCompileOnly=n},t.setSelectionWebGLIdsToVTKIds=n=>{e.selectionWebGLIdsToVTKIds=n},t.createDefaultLookupTable=()=>{e.lookupTable=W4.newInstance()},t.getColorModeAsString=()=>H.enumToString(gh,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>H.enumToString(hl,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(n,r,i,a,o)=>{if(!n||!e.scalarVisibility)return{scalars:null,cellFlag:!1};let s=null,c=!1;if(r===hl.DEFAULT)s=n.getPointData().getScalars(),s||(s=n.getCellData().getScalars(),c=!0);else if(r===hl.USE_POINT_DATA)s=n.getPointData().getScalars();else if(r===hl.USE_CELL_DATA)s=n.getCellData().getScalars(),c=!0;else if(r===hl.USE_POINT_FIELD_DATA){const u=n.getPointData();i===_3.BY_ID?s=u.getArrayByIndex(a):s=u.getArrayByName(o)}else if(r===hl.USE_CELL_FIELD_DATA){const u=n.getCellData();c=!0,i===_3.BY_ID?s=u.getArrayByIndex(a):s=u.getArrayByName(o)}else if(r===hl.USE_FIELD_DATA){const u=n.getFieldData();i===_3.BY_ID?s=u.getArrayByIndex(a):s=u.getArrayByName(o)}return{scalars:s,cellFlag:c}},t.mapScalars=(n,r)=>{const{scalars:i,cellFlag:a}=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName);if(e.areScalarsMappedFromCells=a,!i){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}const o=`${t.getMTime()}${i.getMTime()}${r}`;if(e.colorBuildString!==o){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(i,a))e.mapScalarsToTexture(i,a,r);else{e.colorCoordinates=null,e.colorTextureMap=null;const s=t.getLookupTable();s&&(s.build(),e.colorMapColors=s.mapScalars(i,e.colorMode,e.fieldDataTupleId))}e.colorBuildString=`${t.getMTime()}${i.getMTime()}${r}`}},e.mapScalarsToTexture=(n,r,i)=>{const a=e.lookupTable.getRange(),o=e.lookupTable.usingLogScale();o&&W4.getLogRange(a,a);const s=e.lookupTable.getAlpha();if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==i){e.lookupTable.setAlpha(i),e.colorTextureMap=null,e.lookupTable.build();const u=e.lookupTable.getNumberOfAvailableColors(),d=2048,g=d**3-3,m=4096-2,y=2,v=r?g:m;e.numberOfColorsInRange=Math.min(Math.max(u,y),v);const C=e.numberOfColorsInRange+3,S=e.numberOfColorsInRange+2,w=r?[Math.min(Math.ceil(C/d**0),d),Math.min(Math.ceil(C/d**1),d),Math.min(Math.ceil(C/d**2),d)]:[S,2,1],x=w[0]*w[1]*w[2],R=new Float64Array(x);R.fill(NaN);const O=e.numberOfColorsInRange,b=O+2,I=[0,0,0],G=a[0],j=a[1]-a[0];for(let z=0;z<b;++z){const oe=xj(I,w),Q=G+j*(z-1)/(O-1);R[oe]=o?10**Q:Q,wj(I,w)}const F=Pt.newInstance({numberOfComponents:1,values:R}),$=e.lookupTable.mapScalars(F,e.colorMode,0);e.colorTextureMap=Op.newInstance(),e.colorTextureMap.setDimensions(w),e.colorTextureMap.getPointData().setScalars($),e.lookupTable.setAlpha(s)}const c=e.lookupTable.getVectorMode()===Cj.MAGNITUDE&&n.getNumberOfComponents()>1?-1:e.lookupTable.getVectorComponent();e.colorCoordinates=Ej(n,c,a,e.numberOfColorsInRange,e.colorTextureMap.getDimensions(),o,r)},t.getIsOpaque=()=>{const n=t.getInputData(),i=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!e.scalarVisibility||i==null)return!0;const a=t.getLookupTable();return a?(a.build(),a.areScalarsOpaque(i,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=(n,r)=>r&&e.colorMode!==gh.DIRECT_SCALARS?!0:!(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup()||!n||e.colorMode===gh.DEFAULT&&n.getDataType()===Sj.UNSIGNED_CHAR||e.colorMode===gh.DIRECT_SCALARS),t.clearColorArrays=()=>{e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let n=e.mtime;if(e.lookupTable!==null){const r=e.lookupTable.getMTime();n=r>n?r:n}return n},t.getPrimitiveCount=()=>{const n=t.getInputData();return{points:n.getPoints().getNumberOfValues()/3,verts:n.getVerts().getNumberOfValues()-n.getVerts().getNumberOfCells(),lines:n.getLines().getNumberOfValues()-2*n.getLines().getNumberOfCells(),triangles:n.getPolys().getNumberOfValues()-3*n.getPolys().getNumberOfCells()}},t.acquireInvertibleLookupTable=Sg("AcquireInvertibleLookupTable"),t.valueToColor=Sg("ValueToColor"),t.colorToValue=Sg("ColorToValue"),t.useInvertibleColorFor=Sg("UseInvertibleColorFor"),t.clearInvertibleColor=Sg("ClearInvertibleColor"),t.processSelectorPixelBuffers=(n,r)=>{if(!n||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)return;const i=n.getRawPixelBuffer(ua.ID_LOW24),a=n.getRawPixelBuffer(ua.ID_HIGH24),o=n.getCurrentPass(),s=n.getFieldAssociation();let c=null;s===pC.FIELD_ASSOCIATION_POINTS?c=e.selectionWebGLIdsToVTKIds.points:s===pC.FIELD_ASSOCIATION_CELLS&&(c=e.selectionWebGLIdsToVTKIds.cells),c&&r.forEach(u=>{if(o===ua.ID_LOW24){let d=0;a&&(d+=a[u],d*=256),d+=i[u+2],d*=256,d+=i[u+1],d*=256,d+=i[u];const g=c[d],h=n.getPixelBuffer(ua.ID_LOW24);h[u]=g&255,h[u+1]=(g&65280)>>8,h[u+2]=(g&16711680)>>16}else if(o===ua.ID_HIGH24&&a){let d=0;d+=a[u],d*=256,d+=i[u+2],d*=256,d+=i[u+1],d*=256,d+=i[u];const g=c[d],h=n.getPixelBuffer(ua.ID_HIGH24);h[u]=(g&4278190080)>>24}})}}const Oj={colorMapColors:null,areScalarsMappedFromCells:!1,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,numberOfColorsInRange:0,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function eD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Oj,n),E8.extend(t,e,n),H.get(t,e,["areScalarsMappedFromCells","colorCoordinates","colorMapColors","colorTextureMap","numberOfColorsInRange","selectionWebGLIdsToVTKIds"]),H.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),H.setGetArray(t,e,["scalarRange"],2),xp.implementCoincidentTopologyMethods(t,e),Rj(t,e)}const Dj=H.newInstance(eD,"vtkMapper");var tD={newInstance:Dj,extend:eD,...yj,...Tj,...kv};const{FieldAssociations:b3}=Sf,{primTypes:ui}=Y0,{Representation:_u,Shading:yC}=$1,{ScalarMode:dh}=tD,{Filter:TC,Wrap:CC}=qn,{vtkErrorMacro:pl}=Zi,_j={type:"StartEvent"},bj={type:"EndEvent"},{CoordinateSystem:Mj}=cR;function Lj(t){const e=t.getSelector();return e?e.getCurrentPass():ua.MIN_KNOWN_PASS-1}function Vj(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=r=>{r&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.render=()=>{const r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(let o=ui.Start;o<ui.End;o++)e.primitives[o].setOpenGLRenderWindow(e._openGLRenderWindow)}const i=e.openGLActor.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,i)},t.getShaderTemplate=(r,i,a)=>{r.Vertex=C8,r.Fragment=G1,r.Geometry=""},t.replaceShaderColor=(r,i,a)=>{let o=r.Vertex,s=r.Geometry,c=r.Fragment;const u=e.lastBoundBO.getReferenceByName("lastLightComplexity");let d=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];u&&(d=d.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let g=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];u&&(g=g.concat(["  vec3 specularColor;","  float specularPower;"])),g=g.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),u&&(g=g.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(d=d.concat(["varying vec4 vertexColorVSOutput;"]),o=Te.substitute(o,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,o=Te.substitute(o,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,s=Te.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=Te.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?c=Te.substitute(c,"//VTK::Color::Impl",g.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:(e.renderable.getAreScalarsMappedFromCells()||e.renderable.getInterpolateScalarsBeforeMapping())&&e.renderable.getColorCoordinates()&&!e.drawingEdges?c=Te.substitute(c,"//VTK::Color::Impl",g.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(a.getBackfaceProperty()&&!e.drawingEdges&&(d=d.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),u?(d=d.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),g=g.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):g=g.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(d=d.concat(["uniform samplerBuffer texture1;"])),c=Te.substitute(c,"//VTK::Color::Impl",g).result),c=Te.substitute(c,"//VTK::Color::Dec",d).result,r.Vertex=o,r.Geometry=s,r.Fragment=c},t.replaceShaderLight=(r,i,a)=>{let o=r.Fragment;const s="",c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),u=e.lastBoundBO.getReferenceByName("lastLightCount");let d=[];switch(c){case 0:o=Te.substitute(o,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:o=Te.substitute(o,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let g=0;g<u;++g)d=d.concat([`uniform vec3 lightColor${g};`,`uniform vec3 lightDirectionVC${g}; // normalized`,`uniform vec3 lightHalfAngleVC${g}; // normalized`]);o=Te.substitute(o,"//VTK::Light::Dec",d).result,d=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let g=0;g<u;++g)d=d.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${g}));`,`  diffuseL += ((df${s}) * lightColor${g});`,`  if (dot(normalVCVSOutput, lightDirectionVC${g}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,
                                              dot(reflect(lightDirectionVC${g},normalVCVSOutput),
                                                  normalize(-vertexVC.xyz))),
                                         specularPower);`,`    specularL += (sf${s} * lightColor${g});`,"    }"]);d=d.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),o=Te.substitute(o,"//VTK::Light::Impl",d,!1).result;break;case 3:for(let g=0;g<u;++g)d=d.concat([`uniform vec3 lightColor${g};`,`uniform vec3 lightDirectionVC${g}; // normalized`,`uniform vec3 lightHalfAngleVC${g}; // normalized`,`uniform vec3 lightPositionVC${g};`,`uniform vec3 lightAttenuation${g};`,`uniform float lightConeAngle${g};`,`uniform float lightExponent${g};`,`uniform int lightPositional${g};`]);o=Te.substitute(o,"//VTK::Light::Dec",d).result,d=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let g=0;g<u;++g)d=d.concat(["  attenuation = 1.0;",`  if (lightPositional${g} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${g};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${g};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${g}.x`,`       + lightAttenuation${g}.y * distanceVC`,`       + lightAttenuation${g}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${g} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${g});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${g})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${g});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df${s}) * lightColor${g});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,
                                                           dot(reflect(lightDirectionVC${g},
                                                                       normalVCVSOutput),
                                                               normalize(-vertexVC.xyz))),
                                                       specularPower);`,`    specularL += ((sf${s}) * lightColor${g});`,"    }"]);d=d.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),o=Te.substitute(o,"//VTK::Light::Impl",d,!1).result;break;default:pl("bad light complexity")}r.Fragment=o},t.replaceShaderNormal=(r,i,a)=>{if(e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=r.Vertex,c=r.Geometry,u=r.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(s=Te.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=Te.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,c=Te.substitute(c,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,c=Te.substitute(c,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,u=Te.substitute(u,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,u=Te.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(u=Te.substitute(u,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,u=Te.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(a.getProperty().getRepresentation())===e.context.LINES?(u=Te.substitute(u,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,u=Te.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(u=Te.substitute(u,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,u=Te.substitute(u,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,u=Te.substitute(u,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),r.Vertex=s,r.Geometry=c,r.Fragment=u}},t.replaceShaderPositionVC=(r,i,a)=>{e.lastBoundBO.replaceShaderPositionVC(r,i,a);let o=r.Vertex,s=r.Geometry,c=r.Fragment;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(o=Te.substitute(o,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,o=Te.substitute(o,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,o=Te.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,s=Te.substitute(s,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,s=Te.substitute(s,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,c=Te.substitute(c,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,c=Te.substitute(c,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(o=Te.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=Te.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),r.Vertex=o,r.Geometry=s,r.Fragment=c},t.replaceShaderTCoord=(r,i,a)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let o=r.Vertex,s=r.Geometry,c=r.Fragment;if(e.drawingEdges)return;o=Te.substitute(o,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;const u=e.openGLActor.getActiveTextures();let d=2,g=2;if(u&&u.length>0&&(d=u[0].getComponents(),u[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(g=3)),e.renderable.getColorTextureMap()&&(d=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),g=2),g===2){if(o=Te.substitute(o,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,s=Te.substitute(s,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,s=Te.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=Te.substitute(c,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,u&&u.length>=1)switch(d){case 1:c=Te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=Te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=Te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(o=Te.substitute(o,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,s=Te.substitute(s,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,s=Te.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=Te.substitute(c,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,d){case 1:c=Te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=Te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=Te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}r.Vertex=o,r.Geometry=s,r.Fragment=c}},t.replaceShaderClip=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes();o=Te.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,o=Te.substitute(o,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=Te.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,s=Te.substitute(s,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=o,r.Fragment=s},t.getCoincidentParameters=(r,i)=>{let a={factor:0,offset:0};const o=i.getProperty();if(e.renderable.getResolveCoincidentTopology()==is.PolygonOffset||o.getEdgeVisibility()&&o.getRepresentation()===_u.SURFACE){const c=e.lastBoundBO.getPrimitiveType();c===ui.Points||o.getRepresentation()===_u.POINTS?a=e.renderable.getCoincidentTopologyPointOffsetParameter():c===ui.Lines||o.getRepresentation()===_u.WIREFRAME?a=e.renderable.getCoincidentTopologyLineOffsetParameters():(c===ui.Tris||c===ui.TriStrips)&&(a=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(c===ui.TrisEdges||c===ui.TriStripsEdges)&&(a=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),a.factor/=2,a.offset/=2)}const s=e._openGLRenderer.getSelector();return s&&s.getFieldAssociation()===b3.FIELD_ASSOCIATION_POINTS&&(a.offset-=2),a},t.replaceShaderPicking=(r,i,a)=>{let o=r.Fragment,s=r.Vertex;if(o=Te.substitute(o,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===ua.ID_LOW24||e.lastSelectionState===ua.ID_HIGH24)&&(s=Te.substitute(s,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,s=Te.substitute(s,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,o=Te.substitute(o,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,o=Te.substitute(o,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case ua.ID_LOW24:o=Te.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case ua.ID_HIGH24:o=Te.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float((idx/16777216)%256)/255.0, 0.0, 0.0, 1.0);").result;break;default:o=Te.substitute(o,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,o=Te.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}r.Fragment=o,r.Vertex=s}},t.replaceShaderValues=(r,i,a)=>{if(t.replaceShaderColor(r,i,a),t.replaceShaderNormal(r,i,a),t.replaceShaderLight(r,i,a),t.replaceShaderTCoord(r,i,a),t.replaceShaderPicking(r,i,a),t.replaceShaderClip(r,i,a),t.replaceShaderCoincidentOffset(r,i,a),t.replaceShaderPositionVC(r,i,a),e.haveSeenDepthRequest){let o=r.Fragment;o=Te.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=Te.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,r.Fragment=o}},t.getNeedToRebuildShaders=(r,i,a)=>{let o=0,s=0;const c=r.getPrimitiveType(),u=e.currentInput;let d=!1;const g=u.getPointData().getNormals(),h=u.getCellData().getNormals(),m=a.getProperty().getInterpolation()===yC.FLAT,y=a.getProperty().getRepresentation(),v=r.getOpenGLMode(y,c);if((v===e.context.TRIANGLES||h&&!g||!m&&g||!m&&v===e.context.LINES)&&(d=!0),a.getProperty().getLighting()&&d){o=0;const x=i.getLightsByReference();for(let R=0;R<x.length;++R){const O=x[R];O.getSwitch()>0&&(s++,o===0&&(o=1)),o===1&&(s>1||O.getIntensity()!==1||!O.lightTypeIsHeadLight())&&(o=2),o<3&&O.getPositional()&&(o=3)}}let C=!1;const S=e.lastBoundBO.getReferenceByName("lastLightComplexity"),w=e.lastBoundBO.getReferenceByName("lastLightCount");return(S!==o||w!==s)&&(e.lastBoundBO.set({lastLightComplexity:o},!0),e.lastBoundBO.set({lastLightCount:s},!0),C=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(C=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||r.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||C?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=(r,i,a)=>{const o=e.renderable.getViewSpecificProperties().ShadersCallbacks;o&&o.forEach(s=>{s.callback(s.userData,r,i,a)})},t.setMapperShaderParameters=(r,i,a)=>{if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isUniformUsed("VertexIDOffset")&&r.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){const c=e.lastBoundBO.getReferenceByName("lastLightComplexity");r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||pl("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("normalMC")&&r.getCABO().getNormalOffset()&&c>0?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"normalMC",r.getCABO().getNormalOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||pl("Error setting normalMC in shader VAO."):r.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach((u,d)=>{r.getProgram().isAttributeUsed(`${u}MC`)&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),`${u}MC`,r.getCABO().getCustomData()[d].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[d].components,!1)||pl(`Error setting ${u}MC in shader VAO.`))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||pl("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),r.getProgram().isAttributeUsed("scalarColor")&&r.getCABO().getColorComponents()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"scalarColor",r.getCABO().getColorOffset(),r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||pl("Error setting scalarColor in shader VAO."):r.getVAO().removeAttributeArray("scalarColor"),r.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes(),u=[],g=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,h=g?_r(e.tmpMat4,a.getMatrix()):a.getMatrix();g&&(Qt(h,h),zt(h,h,g),Qt(h,h));for(let m=0;m<c;m++){const y=[];e.renderable.getClippingPlaneInDataCoords(h,m,y);for(let v=0;v<4;v++)u.push(y[v])}r.getProgram().setUniformi("numClipPlanes",c),r.getProgram().setUniform4fv("clipPlanes",u)}e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const o=e.openGLActor.getActiveTextures();if(o)for(let c=0;c<o.length;++c){const d=o[c].getTextureUnit(),g=`texture${d+1}`;r.getProgram().isUniformUsed(g)&&r.getProgram().setUniformi(g,d)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(i,a);r.getProgram().setUniformf("coffset",c.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",c.factor)}r.setMapperShaderParameters(i,a,e._openGLRenderer.getTiledSizeAndOrigin());const s=e._openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",s?s.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",s?s.getCurrentPass()+1:0)},t.setLightingShaderParameters=(r,i,a)=>{const o=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(o<2)return;const s=r.getProgram();let c=0;const u=i.getLightsByReference();for(let h=0;h<u.length;++h){const m=u[h];if(m.getSwitch()>0){const v=m.getColorByReference(),C=m.getIntensity();e.lightColor[0]=v[0]*C,e.lightColor[1]=v[1]*C,e.lightColor[2]=v[2]*C;const S=m.getDirection(),w=i.getActiveCamera().getViewMatrix(),x=[...S];m.lightTypeIsSceneLight()&&(x[0]=w[0]*S[0]+w[1]*S[1]+w[2]*S[2],x[1]=w[4]*S[0]+w[5]*S[1]+w[6]*S[2],x[2]=w[8]*S[0]+w[9]*S[1]+w[10]*S[2],kl(x)),e.lightDirection[0]=x[0],e.lightDirection[1]=x[1],e.lightDirection[2]=x[2],kl(e.lightDirection),s.setUniform3fArray(`lightColor${c}`,e.lightColor),s.setUniform3fArray(`lightDirectionVC${c}`,e.lightDirection),c++}}if(o<3)return;const g=i.getActiveCamera().getViewMatrix();Qt(g,g),c=0;for(let h=0;h<u.length;++h){const m=u[h];if(m.getSwitch()>0){const v=m.getTransformedPosition(),C=new Float64Array(3);an(C,v,g),s.setUniform3fArray(`lightAttenuation${c}`,m.getAttenuationValuesByReference()),s.setUniformi(`lightPositional${c}`,m.getPositional()),s.setUniformf(`lightExponent${c}`,m.getExponent()),s.setUniformf(`lightConeAngle${c}`,m.getConeAngle()),s.setUniform3fArray(`lightPositionVC${c}`,[C[0],C[1],C[2]]),c++}}};function n(r,i,a){return i.identity(a),r.reduce((o,s,c)=>c===0?s?i.copy(o,s):i.identity(o):s?i.multiply(o,o,s):o,a)}t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=e.openGLCamera.getKeyMatrices(i),c=i.getActiveCamera(),u=e.openGLCamera.getKeyMatrixTime().getMTime(),d=o.getLastCameraMTime(),h=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,m=a.getIsIdentity(),y=m?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(a.getCoordinateSystem()===Mj.DISPLAY){const v=e._openGLRenderer.getTiledSizeAndOrigin();wt(e.tmpMat4),e.tmpMat4[0]=2/v.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/v.vsize,e.tmpMat4[13]=-1,zt(e.tmpMat4,e.tmpMat4,h),o.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else o.setUniformMatrix("MCPCMatrix",n([s.wcpc,y.mcwc,h],I2,e.tmpMat4));o.isUniformUsed("MCVCMatrix")&&o.setUniformMatrix("MCVCMatrix",n([s.wcvc,y.mcwc,h],I2,e.tmpMat4)),o.isUniformUsed("normalMatrix")&&o.setUniformMatrix3x3("normalMatrix",n([s.normalMatrix,y.normalMatrix],EU,e.tmpMat3)),d!==u&&(o.isUniformUsed("cameraParallel")&&o.setUniformi("cameraParallel",c.getParallelProjection()),o.setLastCameraMTime(u)),m||o.setLastCameraMTime(0)},t.setPropertyShaderParameters=(r,i,a)=>{const o=r.getProgram();let s=a.getProperty(),c=s.getOpacity(),u=e.drawingEdges?s.getEdgeColorByReference():s.getAmbientColorByReference(),d=e.drawingEdges?s.getEdgeColorByReference():s.getDiffuseColorByReference(),g=e.drawingEdges?1:s.getAmbient(),h=e.drawingEdges?0:s.getDiffuse(),m=e.drawingEdges?0:s.getSpecular();const y=s.getSpecularPower();o.setUniformf("opacityUniform",c),o.setUniform3fArray("ambientColorUniform",u),o.setUniform3fArray("diffuseColorUniform",d),o.setUniformf("ambient",g),o.setUniformf("diffuse",h);const v=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(v<1)return;let C=s.getSpecularColorByReference();if(o.setUniform3fArray("specularColorUniform",C),o.setUniformf("specularPowerUniform",y),o.setUniformf("specular",m),o.isUniformUsed("ambientIntensityBF")){if(s=a.getBackfaceProperty(),c=s.getOpacity(),u=s.getAmbientColor(),g=s.getAmbient(),d=s.getDiffuseColor(),h=s.getDiffuse(),C=s.getSpecularColor(),m=s.getSpecular(),o.setUniformf("ambientIntensityBF",g),o.setUniformf("diffuseIntensityBF",h),o.setUniformf("opacityUniformBF",c),o.setUniform3fArray("ambientColorUniformBF",u),o.setUniform3fArray("diffuseColorUniformBF",d),v<1)return;o.setUniformf("specularIntensityBF",m),o.setUniform3fArray("specularColorUniformBF",C),o.setUniformf("specularPowerUniformBF",y)}},t.updateMaximumPointCellIds=(r,i)=>{const a=e._openGLRenderer.getSelector();if(!a)return;if(e.selectionWebGLIdsToVTKIds?.points?.length){const s=e.selectionWebGLIdsToVTKIds.points.length;a.setMaximumPointId(s-1)}if(e.selectionWebGLIdsToVTKIds?.cells?.length){const s=e.selectionWebGLIdsToVTKIds.cells.length;a.setMaximumCellId(s-1)}a.getFieldAssociation()===b3.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)},t.renderPieceStart=(r,i)=>{e.primitiveIDOffset=0,e.vertexIDOffset=0;const a=Lj(e._openGLRenderer);e.lastSelectionState!==a&&(e.selectionStateChanged.modified(),e.lastSelectionState=a),e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().renderProp(i),t.updateBufferObjects(r,i),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=(r,i)=>{const a=i.getProperty().getRepresentation(),o=i.getProperty().getEdgeVisibility()&&a===_u.SURFACE,s=e._openGLRenderer.getSelector(),c=s&&s.getFieldAssociation()===b3.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===ua.ID_LOW24||e.lastSelectionState===ua.ID_HIGH24);for(let u=ui.Start;u<ui.End;u++)e.primitives[u].setPointPicking(c),e.primitives[u].getCABO().getElementCount()&&(e.drawingEdges=o&&(u===ui.TrisEdges||u===ui.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[u],e.primitiveIDOffset+=e.primitives[u].drawArrays(r,i,a,t),e.vertexIDOffset+=e.primitives[u].getCABO().getElementCount()))},t.renderPieceFinish=(r,i)=>{e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=(r,i)=>{if(t.invokeEvent(_j),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(bj),!e.currentInput){pl("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const a=e.context,o=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!o&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.FRONT)):(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.BACK)),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.computeBounds=(r,i)=>{if(!t.getInput()){Cf(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i),t.updateMaximumPointCellIds()},t.getNeedToRebuildBufferObjects=(r,i)=>{const a=e.VBOBuildTime.getMTime();return a<t.getMTime()||a<e.renderable.getMTime()||a<i.getMTime()||a<e.currentInput.getMTime()},t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,1);const o=e.renderable.getColorMapColors();e.haveCellScalars=!1;const s=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(s===dh.USE_CELL_DATA||s===dh.USE_CELL_FIELD_DATA||s===dh.USE_FIELD_DATA||!a.getPointData().getScalars())&&s!==dh.USE_POINT_FIELD_DATA&&o&&(e.haveCellScalars=!0);let c=i.getProperty().getInterpolation()!==yC.FLAT?a.getPointData().getNormals():null;c===null&&a.getCellData().getNormals()&&(e.haveCellNormals=!0,c=a.getCellData().getNormals());const u=i.getProperty().getRepresentation();let d=a.getPointData().getTCoords();e.openGLActor.getActiveTextures()||(d=null);let g=!1;if(e.renderable.getColorCoordinates()){d=e.renderable.getColorCoordinates(),g=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=qn.newInstance({resizable:!0}));const m=e.internalColorTexture;m.setMinificationFilter(TC.NEAREST),m.setMagnificationFilter(TC.NEAREST),m.setWrapS(CC.CLAMP_TO_EDGE),m.setWrapT(CC.CLAMP_TO_EDGE),m.setOpenGLRenderWindow(e._openGLRenderWindow);const y=e.renderable.getColorTextureMap(),v=y.getExtent(),C=y.getPointData().getScalars();m.create2DFromRaw(v[1]-v[0]+1,v[3]-v[2]+1,C.getNumberOfComponents(),C.getDataType(),C.getData()),m.activate(),m.sendParameters(),m.deactivate()}const h=`${a.getMTime()}A${u}B${a.getMTime()}C${c?c.getMTime():1}D${o?o.getMTime():1}E${i.getProperty().getEdgeVisibility()}F${d?d.getMTime():1}`;if(e.VBOBuildString!==h){const y={points:a.getPoints(),normals:c,tcoords:d,colors:o,cellOffset:0,vertexOffset:0,useTCoordsPerCell:g,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(S=>a.getPointData().getArrayByName(S))};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});const v=[{inRep:"verts",cells:a.getVerts()},{inRep:"lines",cells:a.getLines()},{inRep:"polys",cells:a.getPolys()},{inRep:"strips",cells:a.getStrips()},{inRep:"polys",cells:a.getPolys()},{inRep:"strips",cells:a.getStrips()}],C=i.getProperty().getEdgeVisibility()&&u===_u.SURFACE;for(let S=ui.Start;S<ui.End;S++)S!==ui.TrisEdges&&S!==ui.TriStripsEdges?(y.cellOffset+=e.primitives[S].getCABO().createVBO(v[S].cells,v[S].inRep,u,y,e.selectionWebGLIdsToVTKIds),y.vertexOffset+=e.primitives[S].getCABO().getElementCount()):C?e.primitives[S].getCABO().createVBO(v[S].cells,v[S].inRep,_u.WIREFRAME,{...y,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[S].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),e.VBOBuildString=h}e.VBOBuildTime.modified()},t.getAllocatedGPUMemoryInBytes=()=>{let r=0;return e.primitives.forEach(i=>{r+=i.getAllocatedGPUMemoryInBytes()}),r}}const Ij={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:ua.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function nD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ij,n),$r.extend(t,e,n),H0.implementReplaceShaderCoincidentOffset(t,e,n),H0.implementBuildShadersWithReplacements(t,e,n),e.primitives=[],e.primTypes=ui,e.tmpMat3=rs(new Float64Array(9)),e.tmpMat4=wt(new Float64Array(16));for(let r=ui.Start;r<ui.End;r++)e.primitives[r]=Y0.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);ri(t,e,["context"]),e.VBOBuildTime={},Yn(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},Yn(e.selectionStateChanged,{mtime:0}),Vj(t,e)}const rD=An(nD,"vtkOpenGLPolyDataMapper");var _p={newInstance:rD,extend:nD};xi("vtkMapper",rD);const{vtkErrorMacro:wg}=Zi,{Representation:Aj}=$1,{ObjectType:hh}=Uc,{PassTypes:Nj}=w8,Pj={type:"StartEvent"},Uj={type:"EndEvent"};function Fj(t,e){e.classHierarchy.push("vtkOpenGLGlyph3DMapper");const n={...t};t.renderPiece=(r,i)=>{if(t.invokeEvent(Pj),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(1),t.invokeEvent(Uj),!e.currentInput){wg("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const a=e.context;e._openGLRenderWindow.getWebgl2()?(e.hardwareSupport=!0,e.extension=null):e.extension||(e.extension=e.context.getExtension("ANGLE_instanced_arrays"),e.hardwareSupport=!!e.extension);const o=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!o&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.FRONT)):(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.BACK)),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.multiply4x4WithOffset=(r,i,a,o)=>{const s=i[0],c=i[1],u=i[2],d=i[3],g=i[4],h=i[5],m=i[6],y=i[7],v=i[8],C=i[9],S=i[10],w=i[11],x=i[12],R=i[13],O=i[14],b=i[15];let I=a[o],G=a[o+1],j=a[o+2],F=a[o+3];r[0]=I*s+G*g+j*v+F*x,r[1]=I*c+G*h+j*C+F*R,r[2]=I*u+G*m+j*S+F*O,r[3]=I*d+G*y+j*w+F*b,I=a[o+4],G=a[o+5],j=a[o+6],F=a[o+7],r[4]=I*s+G*g+j*v+F*x,r[5]=I*c+G*h+j*C+F*R,r[6]=I*u+G*m+j*S+F*O,r[7]=I*d+G*y+j*w+F*b,I=a[o+8],G=a[o+9],j=a[o+10],F=a[o+11],r[8]=I*s+G*g+j*v+F*x,r[9]=I*c+G*h+j*C+F*R,r[10]=I*u+G*m+j*S+F*O,r[11]=I*d+G*y+j*w+F*b,I=a[o+12],G=a[o+13],j=a[o+14],F=a[o+15],r[12]=I*s+G*g+j*v+F*x,r[13]=I*c+G*h+j*C+F*R,r[14]=I*u+G*m+j*S+F*O,r[15]=I*d+G*y+j*w+F*b},t.replaceShaderNormal=(r,i,a)=>{if(e.hardwareSupport&&e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=r.Vertex;e.lastBoundBO.getCABO().getNormalOffset()&&(s=Te.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","attribute mat3 gNormal;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=Te.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * gNormal * normalMC;"]).result),r.Vertex=s}n.replaceShaderNormal(r,i,a)},t.replaceShaderColor=(r,i,a)=>{if(e.hardwareSupport&&e.renderable.getColorArray()){let o=r.Vertex,s=r.Geometry,c=r.Fragment;const u=e.lastBoundBO.getReferenceByName("lastLightComplexity");let d=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity"];u&&(d=d.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let g=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];u&&(g=g.concat(["  vec3 specularColor;","  float specularPower;"])),g=g.concat(["  opacity = opacityUniform;"]),u&&(g=g.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.drawingEdges||(d=d.concat(["varying vec4 vertexColorVSOutput;"]),o=Te.substitute(o,"//VTK::Color::Dec",["attribute vec4 gColor;","varying vec4 vertexColorVSOutput;"]).result,o=Te.substitute(o,"//VTK::Color::Impl",["vertexColorVSOutput = gColor;"]).result,s=Te.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=Te.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,g=g.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])),c=Te.substitute(c,"//VTK::Color::Impl",g).result,c=Te.substitute(c,"//VTK::Color::Dec",d).result,r.Vertex=o,r.Geometry=s,r.Fragment=c}n.replaceShaderColor(r,i,a)},t.replaceShaderPositionVC=(r,i,a)=>{if(e.hardwareSupport){let o=r.Vertex;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(o=Te.substitute(o,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","vertexVCVSOutput = MCVCMatrix * gVertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result,o=Te.substitute(o,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result):(o=Te.substitute(o,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;"]).result,o=Te.substitute(o,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result),r.Vertex=o}n.replaceShaderPositionVC(r,i,a)},t.replaceShaderPicking=(r,i,a)=>{if(e.hardwareSupport){let o=r.Fragment,s=r.Vertex;s=Te.substitute(s,"//VTK::Picking::Dec",["attribute vec3 mapperIndexVS;","varying vec3 mapperIndexVSOutput;"]).result,s=Te.substitute(s,"//VTK::Picking::Impl","  mapperIndexVSOutput = mapperIndexVS;").result,r.Vertex=s,o=Te.substitute(o,"//VTK::Picking::Dec",["varying vec3 mapperIndexVSOutput;","uniform vec3 mapperIndex;","uniform int picking;"]).result,o=Te.substitute(o,"//VTK::Picking::Impl",["  vec4 pickColor = picking == 2 ? vec4(mapperIndexVSOutput,1.0) : vec4(mapperIndex,1.0);","  gl_FragData[0] = picking != 0 ? pickColor : gl_FragData[0];"]).result,r.Fragment=o}else n.replaceShaderPicking(r,i,a)},t.updateGlyphShaderParameters=(r,i,a,o,s,c,u,d)=>{const g=a.getProgram();if(r){const h=e.normalMatrix,m=c,y=u*9,v=e.tmpMat3,C=h[0],S=h[1],w=h[2],x=h[3],R=h[4],O=h[5],b=h[6],I=h[7],G=h[8],j=m[y],F=m[y+1],$=m[y+2],z=m[y+3],oe=m[y+4],Q=m[y+5],le=m[y+6],X=m[y+7],ie=m[y+8];v[0]=j*C+F*x+$*b,v[1]=j*S+F*R+$*I,v[2]=j*w+F*O+$*G,v[3]=z*C+oe*x+Q*b,v[4]=z*S+oe*R+Q*I,v[5]=z*w+oe*O+Q*G,v[6]=le*C+X*x+ie*b,v[7]=le*S+X*R+ie*I,v[8]=le*w+X*O+ie*G,g.setUniformMatrix3x3("normalMatrix",e.tmpMat3)}if(t.multiply4x4WithOffset(e.tmpMat4,e.mcpcMatrix,s,u*16),g.setUniformMatrix("MCPCMatrix",e.tmpMat4),i&&(t.multiply4x4WithOffset(e.tmpMat4,e.mcvcMatrix,s,u*16),g.setUniformMatrix("MCVCMatrix",e.tmpMat4)),o){const h=o.getData();e.tmpColor[0]=h[u*4]/255,e.tmpColor[1]=h[u*4+1]/255,e.tmpColor[2]=h[u*4+2]/255,g.setUniform3fArray("ambientColorUniform",e.tmpColor),g.setUniform3fArray("diffuseColorUniform",e.tmpColor)}d&&g.setUniform3fArray("mapperIndex",d.getPropColorValue())},t.renderPieceDraw=(r,i)=>{const a=i.getProperty().getRepresentation(),o=e.context,s=i.getProperty().getEdgeVisibility()&&a===Aj.SURFACE,c=e.openGLCamera.getKeyMatrices(r),u=e.openGLActor.getKeyMatrices();of(e.normalMatrix,c.normalMatrix,u.normalMatrix),zt(e.mcpcMatrix,c.wcpc,u.mcwc),zt(e.mcvcMatrix,c.wcvc,u.mcwc);const d=e.renderable.getMatrixArray(),g=e.renderable.getNormalArray(),h=e.renderable.getColorArray(),m=d.length/16;let y=!1;e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().getCurrentPass()===Nj.COMPOSITE_INDEX_PASS&&(y=!0);for(let v=e.primTypes.Start;v<e.primTypes.End;v++){const C=e.primitives[v].getCABO();if(C.getElementCount()){e.drawingEdges=s&&(v===e.primTypes.TrisEdges||v===e.primTypes.TriStripsEdges),e.lastBoundBO=e.primitives[v],e.primitives[v].updateShaders(r,i,t);const S=e.primitives[v].getProgram(),w=e.primitives[v].getOpenGLMode(a),x=S.isUniformUsed("normalMatrix"),R=S.isUniformUsed("MCVCMatrix");if(e.hardwareSupport)e.extension?e.extension.drawArraysInstancedANGLE(w,0,C.getElementCount(),m):o.drawArraysInstanced(w,0,C.getElementCount(),m);else for(let O=0;O<m;++O)y&&e._openGLRenderer.getSelector().renderCompositeIndex(O),t.updateGlyphShaderParameters(x,R,e.primitives[v],h,d,g,O,y?e._openGLRenderer.getSelector():null),o.drawArrays(w,0,C.getElementCount())}}},t.setMapperShaderParameters=(r,i,a)=>{if(r.getCABO().getElementCount()&&(e.glyphBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){r.getProgram().isAttributeUsed("gMatrix")?r.getVAO().addAttributeMatrixWithDivisor(r.getProgram(),e.matrixBuffer,"gMatrix",0,64,e.context.FLOAT,4,!1,1)||wg("Error setting gMatrix in shader VAO."):r.getVAO().removeAttributeArray("gMatrix"),r.getProgram().isAttributeUsed("gNormal")?r.getVAO().addAttributeMatrixWithDivisor(r.getProgram(),e.normalBuffer,"gNormal",0,36,e.context.FLOAT,3,!1,1)||wg("Error setting gNormal in shader VAO."):r.getVAO().removeAttributeArray("gNormal"),r.getProgram().isAttributeUsed("gColor")?r.getVAO().addAttributeArrayWithDivisor(r.getProgram(),e.colorBuffer,"gColor",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||wg("Error setting gColor in shader VAO."):r.getVAO().removeAttributeArray("gColor"),r.getProgram().isAttributeUsed("mapperIndexVS")?r.getVAO().addAttributeArrayWithDivisor(r.getProgram(),e.pickBuffer,"mapperIndexVS",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||wg("Error setting mapperIndexVS in shader VAO."):r.getVAO().removeAttributeArray("mapperIndexVS"),n.setMapperShaderParameters(r,i,a),r.getAttributeUpdateTime().modified();return}n.setMapperShaderParameters(r,i,a)},t.getNeedToRebuildBufferObjects=(r,i)=>(e.renderable.buildArrays(),e.VBOBuildTime.getMTime()<e.renderable.getBuildTime().getMTime()?!0:n.getNeedToRebuildBufferObjects(r,i)),t.getNeedToRebuildShaders=(r,i,a)=>!!(n.getNeedToRebuildShaders(r,i,a)||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()),t.buildBufferObjects=(r,i)=>{if(e.hardwareSupport){const a=e.renderable.getMatrixArray(),o=e.renderable.getNormalArray(),s=e.renderable.getColorArray();if(e.matrixBuffer||(e.matrixBuffer=Uc.newInstance(),e.matrixBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.normalBuffer=Uc.newInstance(),e.normalBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorBuffer=Uc.newInstance(),e.colorBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.pickBuffer=Uc.newInstance(),e.pickBuffer.setOpenGLRenderWindow(e._openGLRenderWindow)),e.renderable.getBuildTime().getMTime()>e.glyphBOBuildTime.getMTime()){e.matrixBuffer.upload(a,hh.ARRAY_BUFFER),e.normalBuffer.upload(o,hh.ARRAY_BUFFER),s?e.colorBuffer.upload(s.getData(),hh.ARRAY_BUFFER):e.colorBuffer.releaseGraphicsResources();const c=a.length/16,u=new Uint8Array(4*c);for(let d=0;d<c;++d){let g=d+1;const h=d*4;u[h]=g%256,g-=u[h],g/=256,u[h+1]=g%256,g-=u[h+1],g/=256,u[h+2]=g%256,u[h+3]=255}e.pickBuffer.upload(u,hh.ARRAY_BUFFER),e.glyphBOBuildTime.modified()}}return n.buildBufferObjects(r,i)}}const kj={normalMatrix:null,mcpcMatrix:null,mcwcMatrix:null};function Gj(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kj,n),_p.extend(t,e,n),e.tmpMat3=rs(new Float64Array(9)),e.normalMatrix=rs(new Float64Array(9)),e.mcpcMatrix=wt(new Float64Array(16)),e.mcvcMatrix=wt(new Float64Array(16)),e.tmpColor=[],e.glyphBOBuildTime={},Yn(e.glyphBOBuildTime,{mtime:0}),Fj(t,e)}const iD=An(Gj,"vtkOpenGLGlyph3DMapper");var Bj={newInstance:iD};xi("vtkGlyph3DMapper",iD);const{vtkErrorMacro:SC}=Zi;function $j(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=n=>{if(n){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const r=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(r.getActiveCamera())}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOpaqueActorCount()}},t.opaquePass=(n,r)=>{if(n&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);const i=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",i);const a=e._openGLRenderer.getRenderable(),o=e.openGLCamera.getKeyMatrices(a),s=new Float64Array(16);if(Br(s,o.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",s),e.lastFormat==="box"){const c=a.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",c[0],c[1],c[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=()=>{if(!e.tris.getCABO().getElementCount()){const r=new Float32Array(12);for(let s=0;s<4;s++)r[s*3]=s%2*2-1,r[s*3+1]=s>1?1:-1,r[s*3+2]=1;const i=Pt.newInstance({numberOfComponents:3,values:r});i.setName("points");const a=new Uint16Array(8);a[0]=3,a[1]=0,a[2]=1,a[3]=3,a[4]=3,a[5]=0,a[6]=3,a[7]=2;const o=Pt.newInstance({numberOfComponents:1,values:a});e.tris.getCABO().createVBO(o,"polys",bo.SURFACE,{points:i,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||SC("Error setting vertexMC in shader VAO."));const n=e.renderable.getTextures();n.length||SC("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==n[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(n[0]))}}const Wj={context:null};function zj(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Wj,n),$r.extend(t,e,n),e.openGLTexture=qn.newInstance(),e.tris=Y0.newInstance(),e.keyMatrixTime={},Yn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:rs(new Float64Array(9)),mcwc:wt(new Float64Array(16))},ri(t,e,["context"]),ha(t,e,["activeTextures"]),$j(t,e)}const aD=An(zj);var Hj={newInstance:aD};xi("vtkSkybox",aD);var jj=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkSphereMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Spheres

attribute vec4 vertexMC;
attribute vec2 offsetMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying vec3 centerVCVSOutput;

uniform int cameraParallel;
uniform float scaleFactor;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  // compute the projected vertex position
  vec2 scaledOffsetMC = scaleFactor * offsetMC;
  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = length(scaledOffsetMC)*0.5;

  // make the triangle face the camera
  if (cameraParallel == 0)
    {
    vec3 dir = normalize(-vertexVCVSOutput.xyz);
    vec3 base2 = normalize(cross(dir,vec3(1.0,0.0,0.0)));
    vec3 base1 = cross(base2,dir);
    vertexVCVSOutput.xyz = vertexVCVSOutput.xyz + scaledOffsetMC.x*base1 + scaledOffsetMC.y*base2;
    }
  else
    {
    // add in the offset
    vertexVCVSOutput.xy = vertexVCVSOutput.xy + scaledOffsetMC;
    }

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:qj}=Zi;function Kj(t,e){e.classHierarchy.push("vtkOpenGLSphereMapper");const n={...t};t.getShaderTemplate=(r,i,a)=>{r.Vertex=jj,r.Fragment=G1,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;o=Te.substitute(o,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=Te.substitute(s,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,s=Te.substitute(s,"//VTK::PositionVC::Impl",[`vec4 vertexVC = vertexVCVSOutput;
`]).result;const c=[`uniform float invertedDepth;
`,`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=Te.substitute(s,"//VTK::Normal::Dec",c).result;let u="";e.context.getExtension("EXT_frag_depth")&&(u=`gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(u=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=Te.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float b = 2.0*dot(EyePos,EyeDir);
`,`  float c = dot(EyePos,EyePos) - 1.0;
`,`  float d = b*b - 4.0*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t = (-b - invertedDepth*sqrt(d))*0.5;
`,`    normalVCVSOutput = invertedDepth*normalize(EyePos + t*EyeDir);
`,`    vertexVC.xyz = normalVCVSOutput*radiusVCVSOutput + centerVCVSOutput;
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,u]).result,s=Te.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=Te.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,n.replaceShaderValues(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{if(r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&r.getProgram().isAttributeUsed("offsetMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"offsetMC",12,r.getCABO().getStride(),e.context.FLOAT,2,!1)||qj("Error setting 'offsetMC' in shader VAO.")),r.getProgram().isUniformUsed("invertedDepth")&&r.getProgram().setUniformf("invertedDepth",e.invert?-1:1),r.getProgram().isUniformUsed("scaleFactor")){const s=e.currentInput.getPointData();e.renderable.getScaleArray()!=null&&s.hasArray(e.renderable.getScaleArray())?r.getProgram().setUniformf("scaleFactor",e.renderable.getScaleFactor()):r.getProgram().setUniformf("scaleFactor",1)}n.setMapperShaderParameters(r,i,a)},t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=i.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(i);if(o.isUniformUsed("VCPCMatrix")&&o.setUniformMatrix("VCPCMatrix",c.vcpc),o.isUniformUsed("MCVCMatrix"))if(a.getIsIdentity())o.setUniformMatrix("MCVCMatrix",c.wcvc);else{const u=e.openGLActor.getKeyMatrices(),d=new Float64Array(16);zt(d,c.wcvc,u.mcwc),o.setUniformMatrix("MCVCMatrix",d)}o.isUniformUsed("cameraParallel")&&r.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(r,i)=>e.context.TRIANGLES,t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,1);const o=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=a.getPointData(),u=a.getPoints(),d=u.getNumberOfPoints(),g=u.getData(),h=5;let m=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(m=c.getArray(e.renderable.getScaleArray()).getData());let y=null,v=0,C=null;o?(v=o.getNumberOfComponents(),s.setColorOffset(0),s.setColorBOStride(4),y=o.getData(),C=new Uint8Array(3*d*4),s.getColorBO()||s.setColorBO(Uc.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow)):s.getColorBO()&&s.setColorBO(null),s.setColorComponents(v);const S=new Float32Array(h*d*3);s.setStride(h*4);const w=Math.cos(ur(30));let x=0,R=0,O=0,b=0;for(let I=0;I<d;++I){let G=e.renderable.getRadius();m&&(G=m[I]),x=I*3,S[O++]=g[x++],S[O++]=g[x++],S[O++]=g[x++],S[O++]=-2*G*w,S[O++]=-G,y&&(R=I*v,C[b++]=y[R],C[b++]=y[R+1],C[b++]=y[R+2],C[b++]=y[R+3]),x=I*3,S[O++]=g[x++],S[O++]=g[x++],S[O++]=g[x++],S[O++]=2*G*w,S[O++]=-G,y&&(C[b++]=y[R],C[b++]=y[R+1],C[b++]=y[R+2],C[b++]=y[R+3]),x=I*3,S[O++]=g[x++],S[O++]=g[x++],S[O++]=g[x++],S[O++]=0,S[O++]=2*G,y&&(C[b++]=y[R],C[b++]=y[R+1],C[b++]=y[R+2],C[b++]=y[R+3])}s.setElementCount(O/h),s.upload(S,Wc.ARRAY_BUFFER),o&&s.getColorBO().upload(C,Wc.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const Yj={};function Xj(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Yj,n),_p.extend(t,e,n),Kj(t,e)}const oD=An(Xj,"vtkOpenGLSphereMapper");var Zj={newInstance:oD};xi("vtkSphereMapper",oD);var Qj=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkStickMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Sticks

attribute vec4 vertexMC;
attribute vec3 orientMC;
attribute vec4 offsetMC;
attribute float radiusMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying float lengthVCVSOutput;
varying vec3 centerVCVSOutput;
varying vec3 orientVCVSOutput;

uniform int cameraParallel;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = radiusMC;
  lengthVCVSOutput = length(orientMC);
  orientVCVSOutput = normalMatrix * normalize(orientMC);

  // make sure it is pointing out of the screen
  if (orientVCVSOutput.z < 0.0)
    {
    orientVCVSOutput = -orientVCVSOutput;
    }

  // make the basis
  vec3 xbase;
  vec3 ybase;
  vec3 dir = vec3(0.0,0.0,1.0);
  if (cameraParallel == 0)
    {
    dir = normalize(-vertexVCVSOutput.xyz);
    }
  if (abs(dot(dir,orientVCVSOutput)) == 1.0)
    {
    xbase = normalize(cross(vec3(0.0,1.0,0.0),orientVCVSOutput));
    ybase = cross(xbase,orientVCVSOutput);
    }
  else
    {
    xbase = normalize(cross(orientVCVSOutput,dir));
    ybase = cross(orientVCVSOutput,xbase);
    }

  vec3 offsets = offsetMC.xyz*2.0-1.0;
  vertexVCVSOutput.xyz = vertexVCVSOutput.xyz +
    radiusVCVSOutput*offsets.x*xbase +
    radiusVCVSOutput*offsets.y*ybase +
    0.5*lengthVCVSOutput*offsets.z*orientVCVSOutput;

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:ph}=Zi;function Jj(t,e){e.classHierarchy.push("vtkOpenGLStickMapper");const n={...t};t.getShaderTemplate=(r,i,a)=>{r.Vertex=Qj,r.Fragment=G1,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;o=Te.substitute(o,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=Te.substitute(s,"//VTK::PositionVC::Dec","varying vec4 vertexVCVSOutput;").result,s=Te.substitute(s,"//VTK::PositionVC::Impl",`  vec4 vertexVC = vertexVCVSOutput;
`).result;const c=[`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 orientVCVSOutput;
`,`varying float lengthVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=Te.substitute(s,"//VTK::Normal::Dec",c).result;let u="";e.context.getExtension("EXT_frag_depth")&&(u=`  gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(u=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=Te.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  vec3 base1;
`,`  if (abs(orientVCVSOutput.z) < 0.99) {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,0.0,1.0))); }
`,`  else {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,1.0,0.0))); }
`,`  vec3 base2 = cross(orientVCVSOutput,base1);
`,`  EyePos = vec3(dot(EyePos,base1),dot(EyePos,base2),dot(EyePos,orientVCVSOutput));
`,`  EyeDir = vec3(dot(EyeDir,base1),dot(EyeDir,base2),dot(EyeDir,orientVCVSOutput));
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float a = EyeDir.x*EyeDir.x + EyeDir.y*EyeDir.y;
`,`  float b = 2.0*(EyePos.x*EyeDir.x + EyePos.y*EyeDir.y);
`,`  float c = EyePos.x*EyePos.x + EyePos.y*EyePos.y - 1.0;
`,`  float d = b*b - 4.0*a*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t =  (-b - sqrt(d))/(2.0*a);
`,`    float tz = EyePos.z + t*EyeDir.z;
`,`    vec3 iPoint = EyePos + t*EyeDir;
`,`    if (abs(iPoint.z)*radiusVCVSOutput > lengthVCVSOutput*0.5) {
`,`      float t2 = (-b + sqrt(d))/(2.0*a);
`,`      float tz2 = EyePos.z + t2*EyeDir.z;
`,`      if (tz2*radiusVCVSOutput > lengthVCVSOutput*0.5 || tz*radiusVCVSOutput < -0.5*lengthVCVSOutput) { discard; }
`,`      else {
`,`        normalVCVSOutput = orientVCVSOutput;
`,`        float t3 = (lengthVCVSOutput*0.5/radiusVCVSOutput - EyePos.z)/EyeDir.z;
`,`        iPoint = EyePos + t3*EyeDir;
`,`        vertexVC.xyz = radiusVCVSOutput*(iPoint.x*base1 + iPoint.y*base2 + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`        }
`,`      }
`,`    else {
`,`      normalVCVSOutput = iPoint.x*base1 + iPoint.y*base2;
`,`      vertexVC.xyz = radiusVCVSOutput*(normalVCVSOutput + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`      }
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,u]).result,s=Te.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=Te.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,n.replaceShaderValues(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(r.getProgram().isAttributeUsed("orientMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"orientMC",12,r.getCABO().getStride(),e.context.FLOAT,3,!1)||ph("Error setting 'orientMC' in shader VAO.")),r.getProgram().isAttributeUsed("offsetMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"offsetMC",0,r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,3,!0)||ph("Error setting 'offsetMC' in shader VAO.")),r.getProgram().isAttributeUsed("radiusMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"radiusMC",24,r.getCABO().getStride(),e.context.FLOAT,1,!1)||ph("Error setting 'radiusMC' in shader VAO."))),n.setMapperShaderParameters(r,i,a)},t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=i.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(i);if(o.isUniformUsed("VCPCMatrix")&&o.setUniformMatrix("VCPCMatrix",c.vcpc),a.getIsIdentity())o.isUniformUsed("MCVCMatrix")&&o.setUniformMatrix("MCVCMatrix",c.wcvc),o.isUniformUsed("normalMatrix")&&o.setUniformMatrix3x3("normalMatrix",c.normalMatrix);else{const u=e.openGLActor.getKeyMatrices();if(o.isUniformUsed("MCVCMatrix")){const d=new Float64Array(16);zt(d,c.wcvc,u.mcwc),o.setUniformMatrix("MCVCMatrix",d)}if(o.isUniformUsed("normalMatrix")){const d=new Float64Array(9);of(d,c.normalMatrix,u.normalMatrix),o.setUniformMatrix3x3("normalMatrix",d)}}o.isUniformUsed("cameraParallel")&&r.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(r,i)=>e.context.TRIANGLES,t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,1);const o=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=a.getPointData(),u=a.getPoints(),d=u.getNumberOfPoints(),g=u.getData();let h=3;h+=4;let m=null,y=0;s.setColorBOStride(4),s.getColorBO()||s.setColorBO(Uc.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow),o&&(y=o.getNumberOfComponents(),s.setColorOffset(4),m=o.getData(),s.setColorBOStride(8)),s.setColorComponents(y),s.setStride(h*4);const v=new Float32Array(h*d*12),C=new Uint8Array(12*d*(m?8:4));let S=null,w=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(S=c.getArray(e.renderable.getScaleArray()).getData()),e.renderable.getOrientationArray()!=null&&c.hasArray(e.renderable.getOrientationArray())?w=c.getArray(e.renderable.getOrientationArray()).getData():ph([`Error setting orientationArray.
`,"You have to specify the stick orientation"]);const x=[0,1,3,0,3,2,2,3,5,2,5,4];let R=0,O=0,b=0,I=0;for(let G=0;G<d;++G){let j=e.renderable.getLength(),F=e.renderable.getRadius();S&&(j=S[G*2],F=S[G*2+1]);for(let $=0;$<x.length;++$)R=G*3,v[b++]=g[R++],v[b++]=g[R++],v[b++]=g[R++],R=G*3,v[b++]=w[R++]*j,v[b++]=w[R++]*j,v[b++]=w[R++]*j,v[b++]=F,C[I++]=255*(x[$]%2),C[I++]=x[$]>=4?255:0,C[I++]=x[$]>=2?255:0,C[I++]=255,O=G*y,m&&(C[I++]=m[O],C[I++]=m[O+1],C[I++]=m[O+2],C[I++]=m[O+3])}s.setElementCount(b/h),s.upload(v,Wc.ARRAY_BUFFER),s.getColorBO().upload(C,Wc.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const eq={};function tq(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eq,n),_p.extend(t,e,n),Jj(t,e)}const sD=An(tq,"vtkOpenGLStickMapper");var nq={newInstance:sD};xi("vtkStickMapper",sD);function R8(t,e){switch(t){case"Float32Array":return Float32Array;case"Uint8Array":return Uint8Array;case"Uint32Array":return Uint32Array;case"Uint16Array":case"Int16Array":return e?(console.debug(`${t} is not supported for volume rendering, switching back to Float32Array`),Float32Array):t==="Uint16Array"?Uint16Array:Int16Array;default:if(t)throw new Error("TargetBuffer should be Float32Array, Uint8Array, Uint16Array, Int16Array, or Uint32Array");return Float32Array}}function cD(t,e,n={}){const{isVolumeBuffer:r=!1}=n,i=R8(t,r),a=i.BYTES_PER_ELEMENT;return{numBytes:e*a,TypedArrayConstructor:i}}function rq(t,e){e.classHierarchy.push("vtkStreamingOpenGLVolumeMapper"),t.buildBufferObjects=(n,r)=>{const i=e.currentInput;if(!i)return;const a=r.getProperty();if(!e.jitterTexture.getHandle()){const v=new Uint8Array(1024);for(let C=0;C<1024;++C)v[C]=255*Math.random();e.jitterTexture.setMinificationFilter(pt.LINEAR),e.jitterTexture.setMagnificationFilter(pt.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,kt.UNSIGNED_CHAR,v)}const{numberOfComponents:o}=i.get("numberOfComponents"),s=t.useIndependentComponents(a),c=a.getScalarOpacity(),u=e._openGLRenderWindow.getGraphicsResourceForObject(c);let d=Fs(c,s,o);if(!u?.oglObject||u.hash!==d){e.opacityTexture=qn.newInstance(),e.opacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const v=1024,C=v*2*o,S=new Float32Array(C),w=new Float32Array(v);for(let x=0;x<o;++x){const R=a.getScalarOpacity(x),O=t.getCurrentSampleDistance(n)/a.getScalarOpacityUnitDistance(x),b=R.getRange();R.getTable(b[0],b[1],v,w,1);for(let I=0;I<v;++I)S[x*v*2+I]=1-(1-w[I])**O,S[x*v*2+I+v]=S[x*v*2+I]}if(e.opacityTexture.resetFormatAndType(),e.opacityTexture.setMinificationFilter(pt.LINEAR),e.opacityTexture.setMagnificationFilter(pt.LINEAR),e._openGLRenderWindow.getWebgl2()&&e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(v,2*o,1,kt.FLOAT,S);else{const x=new Uint8ClampedArray(C);for(let R=0;R<C;++R)x[R]=255*S[R];e.opacityTexture.create2DFromRaw(v,2*o,1,kt.UNSIGNED_CHAR,x)}c&&(e._openGLRenderWindow.setGraphicsResourceForObject(c,e.opacityTexture,d),c!==e._scalarOpacityFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(c,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalarOpacityFunc,t)),e._scalarOpacityFunc=c)}else e.opacityTexture=u.oglObject;const h=a.getRGBTransferFunction();d=Fs(h,s,o);const m=e._openGLRenderWindow.getGraphicsResourceForObject(h);if(!m?.oglObject?.getHandle()||m?.hash!==d){e.colorTexture=qn.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const v=1024,C=v*2*o*3,S=new Uint8ClampedArray(C),w=new Float32Array(v*3);for(let x=0;x<o;++x){const R=a.getRGBTransferFunction(x),O=R.getRange();R.getTable(O[0],O[1],v,w,1);for(let b=0;b<v*3;++b)S[x*v*6+b]=255*w[b],S[x*v*6+b+v*3]=255*w[b]}e.colorTexture.resetFormatAndType(),e.colorTexture.setMinificationFilter(pt.LINEAR),e.colorTexture.setMagnificationFilter(pt.LINEAR),e.colorTexture.create2DFromRaw(v,2*o,3,kt.UNSIGNED_CHAR,S),h&&(e._openGLRenderWindow.setGraphicsResourceForObject(h,e.colorTexture,d),h!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(h,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=h)}else e.colorTexture=m.oglObject;if(t.updateLabelOutlineThicknessTexture(r),d=`${i.getMTime()}-${e.scalarTexture.getMTime()}`,e.scalarTextureString!==d){const v=i.getDimensions();e.scalarTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.scalarTexture.enableUseHalfFloat(!1);const C=e.scalarTexture.getTextureParameters(),S=i.get("dataType").dataType;let w=!0;if(C?.dataType===S&&C?.width===v[0]&&C?.height===v[1]&&C?.depth===v[2]&&(w=!1),w){const x=e.context.getExtension("EXT_texture_norm16");e.scalarTexture.setOglNorm16Ext(DA()?x:null),e.scalarTexture.resetFormatAndType(),e.scalarTexture.setTextureParameters({width:v[0],height:v[1],depth:v[2],numberOfComponents:o,dataType:S}),e.scalarTexture.create3DFromRaw(v[0],v[1],v[2],o,S,null),e.scalarTexture.update3DFromRaw()}else e.scalarTexture.deactivate(),e.scalarTexture.update3DFromRaw();e.scalarTextureString=d}if(!e.tris.getCABO().getElementCount()){const v=new Float32Array(12);for(let x=0;x<4;x++)v[x*3]=x%2*2-1,v[x*3+1]=x>1?1:-1,v[x*3+2]=-1;const C=new Uint16Array(8);C[0]=3,C[1]=0,C[2]=1,C[3]=3,C[4]=3,C[5]=0,C[6]=3,C[7]=2;const S=Pt.newInstance({numberOfComponents:3,values:v});S.setName("points");const w=Pt.newInstance({numberOfComponents:1,values:C});e.tris.getCABO().createVBO(w,"polys",bo.SURFACE,{points:S,cellOffset:0})}e.VBOBuildTime.modified()},t.getNeedToRebuildBufferObjects=(n,r)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<r.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<r.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||e.VBOBuildTime.getMTime()<e.scalarTexture?.getMTime()||e.VBOBuildTime.getMTime()<e.colorTexture?.getMTime()||e.VBOBuildTime.getMTime()<e.labelOutlineThicknessTexture?.getMTime()||!e.scalarTexture?.getHandle()||!e.colorTexture?.getHandle()||!e.labelOutlineThicknessTexture?.getHandle()}const iq={};function aq(t,e,n={}){Object.assign(e,iq,n),lO.extend(t,e,n),e.scalarTexture=n.scalarTexture,e.previousState={},rq(t,e)}const oq=H.newInstance(aq,"vtkStreamingOpenGLVolumeMapper"),sq={newInstance:oq},lD=Object.create(null);function Ti(t,e){lD[t]=e}function cq(t,e){e.classHierarchy.push("vtkStreamingOpenGLViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,i=n.getClassName(r++),a=!1;const o=Object.keys(e.overrides);for(;i&&!a;)o.includes(i)?a=!0:i=n.getClassName(r++);if(!a)return null;const s=e.getModelInitialValues(n),c=e.overrides[i](s);return c.setMyFactory(t),c},e.overrides=lD,e.getModelInitialValues=n=>{const r={};return n.getClassName()==="vtkSharedVolumeMapper"&&(r.scalarTexture=n.getScalarTexture()),r}}const lq={};function uD(t,e,n={}){Object.assign(e,lq,n),h8.extend(t,e,n),cq(t,e),Ti("vtkActor",rj.newInstance),Ti("vtkActor2D",sj.newInstance),Ti("vtkCamera",ck.newInstance),Ti("vtkGlyph3DMapper",Bj.newInstance),Ti("vtkImageMapper",r$.newInstance),Ti("vtkImageCPRMapper",c$.newInstance),Ti("vtkImageSlice",g$.newInstance),Ti("vtkMapper",_p.newInstance),Ti("vtkPixelSpaceCallbackMapper",M$.newInstance),Ti("vtkRenderer",dk.newInstance),Ti("vtkSkybox",Hj.newInstance),Ti("vtkSphereMapper",Zj.newInstance),Ti("vtkStickMapper",nq.newInstance),Ti("vtkTexture",qn.newInstance),Ti("vtkVolume",m$.newInstance),Ti("vtkVolumeMapper",lO.newInstance),Ti("vtkSharedVolumeMapper",sq.newInstance)}const uq=H.newInstance(uD,"vtkStreamingOpenGLViewNodeFactory"),fq={newInstance:uq,extend:uD};function gq(t,e){e.classHierarchy.push("vtkStreamingOpenGLRenderWindow")}function fD(t,e,n={}){Object.assign(e,n),JH.extend(t,e,n),e.myFactory=fq.newInstance(),Ti("vtkRenderWindow",gD),gq(t,e)}const gD=H.newInstance(fD,"vtkStreamingOpenGLRenderWindow"),dq={newInstance:gD,extend:fD},{vtkDebugMacro:mh}=H;function hq(t,e){e.classHierarchy.push("vtkCamera");const n=new Float64Array(3),r=new Float64Array([0,0,-1]),i=new Float64Array([0,1,0]),a=wt(new Float64Array(16)),o=wt(new Float64Array(16)),s=new Float64Array(3),c=new Float64Array(3),u=new Float64Array(3),d=wt(new Float64Array(16)),g=wt(new Float64Array(16)),h=new Float64Array(3),m=new Float64Array(3);function y(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{const v=t.getViewMatrix();e.viewUp[0]=v[4],e.viewUp[1]=v[5],e.viewUp[2]=v[6],t.modified()},t.setPosition=(v,C,S)=>{v===e.position[0]&&C===e.position[1]&&S===e.position[2]||(e.position[0]=v,e.position[1]=C,e.position[2]=S,t.computeDistance(),t.modified())},t.setFocalPoint=(v,C,S)=>{v===e.focalPoint[0]&&C===e.focalPoint[1]&&S===e.focalPoint[2]||(e.focalPoint[0]=v,e.focalPoint[1]=C,e.focalPoint[2]=S,t.computeDistance(),t.modified())},t.setDistance=v=>{if(e.distance===v)return;e.distance=v,e.distance<1e-20&&(e.distance=1e-20,mh("Distance is set to minimum."));const C=e.directionOfProjection;e.focalPoint[0]=e.position[0]+C[0]*e.distance,e.focalPoint[1]=e.position[1]+C[1]*e.distance,e.focalPoint[2]=e.position[2]+C[2]*e.distance,t.modified()},t.computeDistance=()=>{const v=e.focalPoint[0]-e.position[0],C=e.focalPoint[1]-e.position[1],S=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(v*v+C*C+S*S),e.distance<1e-20){e.distance=1e-20,mh("Distance is set to minimum.");const w=e.directionOfProjection;e.focalPoint[0]=e.position[0]+w[0]*e.distance,e.focalPoint[1]=e.position[1]+w[1]*e.distance,e.focalPoint[2]=e.position[2]+w[2]*e.distance}e.directionOfProjection[0]=v/e.distance,e.directionOfProjection[1]=C/e.distance,e.directionOfProjection[2]=S/e.distance,y()},t.dolly=v=>{if(v<=0)return;const C=e.distance/v;t.setPosition(e.focalPoint[0]-C*e.directionOfProjection[0],e.focalPoint[1]-C*e.directionOfProjection[1],e.focalPoint[2]-C*e.directionOfProjection[2])},t.roll=v=>{const C=e.position,S=e.focalPoint,w=e.viewUp,x=new Float64Array([w[0],w[1],w[2],0]);wt(d);const R=new Float64Array([S[0]-C[0],S[1]-C[1],S[2]-C[2]]);Yo(d,d,ur(v),R),bl(x,x,d),e.viewUp[0]=x[0],e.viewUp[1]=x[1],e.viewUp[2]=x[2],t.modified()},t.azimuth=v=>{const C=e.focalPoint;wt(g),Gr(g,g,C),Yo(g,g,ur(v),e.viewUp),Gr(g,g,[-C[0],-C[1],-C[2]]),an(h,e.position,g),t.setPosition(h[0],h[1],h[2])},t.yaw=v=>{const C=e.position;wt(g),Gr(g,g,C),Yo(g,g,ur(v),e.viewUp),Gr(g,g,[-C[0],-C[1],-C[2]]),an(m,e.focalPoint,g),t.setFocalPoint(m[0],m[1],m[2])},t.elevation=v=>{const C=e.focalPoint,S=t.getViewMatrix(),w=[-S[0],-S[1],-S[2]];wt(g),Gr(g,g,C),Yo(g,g,ur(v),w),Gr(g,g,[-C[0],-C[1],-C[2]]),an(h,e.position,g),t.setPosition(h[0],h[1],h[2])},t.pitch=v=>{const C=e.position,S=t.getViewMatrix(),w=[S[0],S[1],S[2]];wt(g),Gr(g,g,C),Yo(g,g,ur(v),w),Gr(g,g,[-C[0],-C[1],-C[2]]),an(m,e.focalPoint,g),t.setFocalPoint(...m)},t.zoom=v=>{v<=0||(e.parallelProjection?e.parallelScale/=v:e.viewAngle/=v,t.modified())},t.translate=(v,C,S)=>{const w=[v,C,S];D2(e.position,w,e.position),D2(e.focalPoint,w,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=v=>{const C=[...e.viewUp,1],S=[],w=[],x=[];C[0]+=e.position[0],C[1]+=e.position[1],C[2]+=e.position[2],bl(S,[...e.position,1],v),bl(w,[...e.focalPoint,1],v),bl(x,C,v),x[0]-=S[0],x[1]-=S[1],x[2]-=S[2],t.setPosition(...S.slice(0,3)),t.setFocalPoint(...w.slice(0,3)),t.setViewUp(...x.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=v=>{let C=v;C<1e-20&&(C=1e-20,mh("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+C)},t.setThicknessFromFocalPoint=v=>{let C=v;C<1e-20&&(C=1e-20,mh("Thickness is set to minimum.")),t.setClippingRange(e.distance-C/2,e.distance+C/2)},t.setRoll=v=>{},t.getRoll=()=>{},t.setObliqueAngles=(v,C)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=v=>{},t.getCameraLightTransformMatrix=v=>(_r(v,e.cameraLightTransform),v),t.computeCameraLightTransform=()=>{_r(a,t.getViewMatrix()),Br(a,a),qv(o,[e.distance,e.distance,e.distance]),zt(a,a,o),wt(e.cameraLightTransform),Gr(e.cameraLightTransform,a,[0,0,-1])},t.deepCopy=v=>{},t.physicalOrientationToWorldDirection=v=>{const C=AT(v[0],v[1],v[2],v[3]),S=Bl(),w=AT(0,0,1,0);return iF(S,C),IT(w,C,w),IT(w,w,S),[w[0],w[1],w[2]]},t.getPhysicalToWorldMatrix=v=>{t.getWorldToPhysicalMatrix(v),Br(v,v)},t.getWorldToPhysicalMatrix=v=>{wt(v);const C=[3];Ns(e.physicalViewNorth,e.physicalViewUp,C),v[0]=C[0],v[1]=C[1],v[2]=C[2],v[4]=e.physicalViewUp[0],v[5]=e.physicalViewUp[1],v[6]=e.physicalViewUp[2],v[8]=-e.physicalViewNorth[0],v[9]=-e.physicalViewNorth[1],v[10]=-e.physicalViewNorth[2],Qt(v,v),gn(s,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),Us(v,v,s),Gr(v,v,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=v=>{Br(a,v),an(s,n,a),t.computeDistance();const C=e.distance;t.setPosition(s[0],s[1],s[2]),an(c,r,a),ei(c,c,s),Sn(c,c),t.setDirectionOfProjection(c[0],c[1],c[2]),an(u,i,a),ei(u,u,s),Sn(u,u),t.setViewUp(u[0],u[1],u[2]),t.setDistance(C)},t.computeViewParametersFromPhysicalMatrix=v=>{t.getWorldToPhysicalMatrix(a),zt(a,v,a),t.computeViewParametersFromViewMatrix(a)},t.setViewMatrix=v=>{e.viewMatrix=v,e.viewMatrix&&(_r(a,e.viewMatrix),t.computeViewParametersFromViewMatrix(a),Qt(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.viewMatrix;yE(a,e.position,e.focalPoint,e.viewUp),Qt(a,a);const v=new Float64Array(16);return _r(v,a),v},t.setProjectionMatrix=v=>{e.projectionMatrix=v},t.getProjectionMatrix=(v,C,S)=>{const w=new Float64Array(16);if(wt(w),e.projectionMatrix){const O=1/e.physicalScale;return gn(s,O,O,O),_r(w,e.projectionMatrix),Us(w,w,s),Qt(w,w),w}wt(a);const x=e.clippingRange[1]-e.clippingRange[0],R=[e.clippingRange[0]+(C+1)*x/2,e.clippingRange[0]+(S+1)*x/2];if(e.parallelProjection){const O=e.parallelScale*v,b=e.parallelScale,I=(e.windowCenter[0]-1)*O,G=(e.windowCenter[0]+1)*O,j=(e.windowCenter[1]-1)*b,F=(e.windowCenter[1]+1)*b;Yv(a,I,G,j,F,R[0],R[1]),Qt(a,a)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const O=Math.tan(ur(e.viewAngle)/2);let b,I;e.useHorizontalViewAngle===!0?(b=e.clippingRange[0]*O,I=e.clippingRange[0]*O/v):(b=e.clippingRange[0]*O*v,I=e.clippingRange[0]*O);const G=(e.windowCenter[0]-1)*b,j=(e.windowCenter[0]+1)*b,F=(e.windowCenter[1]-1)*I,$=(e.windowCenter[1]+1)*I,z=R[0],oe=R[1];a[0]=2*z/(j-G),a[5]=2*z/($-F),a[2]=(G+j)/(j-G),a[6]=(F+$)/($-F),a[10]=-(z+oe)/(oe-z),a[14]=-1,a[11]=-2*z*oe/(oe-z),a[15]=0}}return _r(w,a),w},t.getCompositeProjectionMatrix=(v,C,S)=>{const w=t.getViewMatrix(),x=t.getProjectionMatrix(v,C,S);return zt(x,w,x),x},t.setDirectionOfProjection=(v,C,S)=>{if(e.directionOfProjection[0]===v&&e.directionOfProjection[1]===C&&e.directionOfProjection[2]===S)return;e.directionOfProjection[0]=v,e.directionOfProjection[1]=C,e.directionOfProjection[2]=S;const w=e.directionOfProjection;e.focalPoint[0]=e.position[0]+w[0]*e.distance,e.focalPoint[1]=e.position[1]+w[1]*e.distance,e.focalPoint[2]=e.position[2]+w[2]*e.distance,y()},t.setDeviceAngles=(v,C,S,w)=>{const x=[3];Ns(e.physicalViewNorth,e.physicalViewUp,x);const R=wt(new Float64Array(16));Yo(R,R,ur(v),e.physicalViewUp),Yo(R,R,ur(C),x),Yo(R,R,ur(S),e.physicalViewNorth),Yo(R,R,ur(-w),e.physicalViewUp);const O=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),b=new Float64Array(e.physicalViewNorth);an(O,O,R),an(b,b,R),t.setDirectionOfProjection(O[0],O[1],O[2]),t.setViewUp(b[0],b[1],b[2]),t.modified()},t.setOrientationWXYZ=(v,C,S,w)=>{const x=wt(new Float64Array(16));if(v!==0&&(C!==0||S!==0||w!==0)){const b=ur(v),I=Bl();Xv(I,[C,S,w],b),L2(x,I)}const R=new Float64Array(3);an(R,[0,0,-1],x);const O=new Float64Array(3);an(O,[0,1,0],x),t.setDirectionOfProjection(...R),t.setViewUp(...O),t.modified()},t.computeClippingRange=v=>{let C=null,S=null;C=e.viewPlaneNormal,S=e.position;const w=-C[0],x=-C[1],R=-C[2],O=-(w*S[0]+x*S[1]+R*S[2]),b=[w*v[0]+x*v[2]+R*v[4]+O,1e-18];for(let I=0;I<2;I++)for(let G=0;G<2;G++)for(let j=0;j<2;j++){const F=w*v[j]+x*v[2+G]+R*v[4+I]+O;b[0]=F<b[0]?F:b[0],b[1]=F>b[1]?F:b[1]}return b}}const pq={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,cameraLightTransform:Ps(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function dD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pq,n),H.obj(t,e),H.get(t,e,["distance"]),H.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),H.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),H.setGetArray(t,e,["clippingRange","windowCenter"],2),H.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),hq(t,e)}const mq=H.newInstance(dD,"vtkCamera");var O8={newInstance:mq,extend:dD};function vq(t,e){e.classHierarchy.push("vtkLight");const n=new Float64Array(3);t.getTransformedPosition=()=>(e.transformMatrix?an(n,e.position,e.transformMatrix):gn(n,e.position[0],e.position[1],e.position[2]),n),t.getTransformedFocalPoint=()=>(e.transformMatrix?an(n,e.focalPoint,e.transformMatrix):gn(n,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),n),t.getDirection=()=>(e.directionMTime<e.mtime&&(hn(e.direction,e.focalPoint,e.position),kl(e.direction),e.directionMTime=e.mtime),e.direction),t.setDirection=r=>{const i=new Float64Array(3);hn(i,e.position,r),e.focalPoint=i},t.setDirectionAngle=(r,i)=>{const a=ur(r),o=ur(i);t.setPosition(Math.cos(a)*Math.sin(o),Math.sin(a),Math.cos(a)*Math.cos(o)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=()=>{t.setLightType("HeadLight")},t.setLightTypeToCameraLight=()=>{t.setLightType("CameraLight")},t.setLightTypeToSceneLight=()=>{t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=()=>e.lightType==="HeadLight",t.lightTypeIsSceneLight=()=>e.lightType==="SceneLight",t.lightTypeIsCameraLight=()=>e.lightType==="CameraLight"}const yq={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function Tq(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yq,n),H.obj(t,e),H.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),H.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),vq(t,e)}const Cq=H.newInstance(Tq,"vtkLight");var Sq={newInstance:Cq};const{vtkErrorMacro:r2}=H;function wq(t){return()=>r2(`vtkViewport::${t} - NOT IMPLEMENTED`)}function xq(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=()=>e.props,t.hasViewProp=r=>e.props.includes(r),t.addViewProp=r=>{r&&!t.hasViewProp(r)&&e.props.push(r)},t.removeViewProp=r=>{const i=e.props.filter(a=>a!==r);e.props.length!==i.length&&(e.props=i)},t.removeAllViewProps=()=>{e.props=[]};function n(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];i.push(r);const a=r.getNestedProps();if(a&&a.length)for(let o=0;o<a.length;o++)n(a[o],i);return i}t.getViewPropsWithNestedProps=()=>{const r=[];for(let i=0;i<e.props.length;i++)n(e.props[i],r);return r},t.addActor2D=t.addViewProp,t.removeActor2D=r=>{t.removeViewProp(r)},t.getActors2D=()=>(e.actors2D=[],e.props.forEach(r=>{e.actors2D=e.actors2D.concat(r.getActors2D())}),e.actors2D),t.displayToView=()=>r2("call displayToView on your view instead"),t.viewToDisplay=()=>r2("callviewtodisplay on your view instead"),t.getSize=()=>r2("call getSize on your View instead"),t.normalizedDisplayToProjection=(r,i,a)=>{const o=t.normalizedDisplayToNormalizedViewport(r,i,a);return t.normalizedViewportToProjection(o[0],o[1],o[2])},t.normalizedDisplayToNormalizedViewport=(r,i,a)=>{const o=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(r-e.viewport[0])/o[0],(i-e.viewport[1])/o[1],a]},t.normalizedViewportToProjection=(r,i,a)=>[r*2-1,i*2-1,a*2-1],t.projectionToNormalizedDisplay=(r,i,a)=>{const o=t.projectionToNormalizedViewport(r,i,a);return t.normalizedViewportToNormalizedDisplay(o[0],o[1],o[2])},t.normalizedViewportToNormalizedDisplay=(r,i,a)=>{const o=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[r*o[0]+e.viewport[0],i*o[1]+e.viewport[1],a]},t.projectionToNormalizedViewport=(r,i,a)=>[(r+1)*.5,(i+1)*.5,(a+1)*.5],t.PickPropFrom=wq("PickPropFrom")}const Eq={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function hD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Eq,n),H.obj(t,e),H.event(t,e,"event"),H.setGetArray(t,e,["viewport"],4),H.setGetArray(t,e,["background","background2"],3),xq(t,e)}const Rq=H.newInstance(hD,"vtkViewport");var Oq={newInstance:Rq,extend:hD};const{vtkDebugMacro:xg,vtkErrorMacro:D0,vtkWarningMacro:Dq}=Zi;function wC(t){return()=>D0(`vtkRenderer::${t} - NOT IMPLEMENTED`)}function _q(t,e){e.classHierarchy.push("vtkRenderer");const n={type:"ComputeVisiblePropBoundsEvent",renderer:t},r={type:"ResetCameraClippingRangeEvent",renderer:t},i={type:"ResetCameraEvent",renderer:t};t.updateCamera=()=>(e.activeCamera||(xg("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0),t.updateLightsGeometryToFollowCamera=()=>{const a=t.getActiveCameraAndResetIfCreated();e.lights.forEach(o=>{o.lightTypeIsSceneLight()||(o.lightTypeIsHeadLight()?(o.setPositionFrom(a.getPositionByReference()),o.setFocalPointFrom(a.getFocalPointByReference()),o.modified(a.getMTime())):o.lightTypeIsCameraLight()?o.setTransformMatrix(a.getCameraLightTransformMatrix(Ps())):D0("light has unknown light type",o.get()))})},t.updateLightGeometry=()=>e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0,t.allocateTime=wC("allocateTime"),t.updateGeometry=wC("updateGeometry"),t.getVTKWindow=()=>e._renderWindow,t.setLayer=a=>{xg(t.getClassName(),t,"setting Layer to ",a),e.layer!==a&&(e.layer=a,t.modified()),t.setPreserveColorBuffer(!!a)},t.setActiveCamera=a=>e.activeCamera===a?!1:(e.activeCamera=a,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:a}),!0),t.makeCamera=()=>{const a=O8.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:a}),a},t.getActiveCamera=()=>(e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera),t.getActiveCameraAndResetIfCreated=()=>(e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera),t.getActors=()=>(e.actors=[],e.props.forEach(a=>{e.actors=e.actors.concat(a.getActors())}),e.actors),t.addActor=t.addViewProp,t.removeActor=a=>{e.actors=e.actors.filter(o=>o!==a),t.removeViewProp(a),t.modified()},t.removeAllActors=()=>{t.getActors().forEach(o=>{t.removeViewProp(o)}),e.actors=[],t.modified()},t.getVolumes=()=>(e.volumes=[],e.props.forEach(a=>{e.volumes=e.volumes.concat(a.getVolumes())}),e.volumes),t.addVolume=t.addViewProp,t.removeVolume=a=>{e.volumes=e.volumes.filter(o=>o!==a),t.removeViewProp(a),t.modified()},t.removeAllVolumes=()=>{t.getVolumes().forEach(o=>{t.removeViewProp(o)}),e.volumes=[],t.modified()},t.hasLight=a=>e.lights.includes(a),t.addLight=a=>{a&&!t.hasLight(a)&&(e.lights.push(a),t.modified())},t.removeLight=a=>{e.lights=e.lights.filter(o=>o!==a),t.modified()},t.removeAllLights=()=>{e.lights=[],t.modified()},t.setLightCollection=a=>{e.lights=a,t.modified()},t.makeLight=Sq.newInstance,t.createLight=()=>{e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=(a,o,s,c)=>{let u=t.normalizedDisplayToProjection(a,o,s);return u=t.projectionToView(u[0],u[1],u[2],c),t.viewToWorld(u[0],u[1],u[2])},t.worldToNormalizedDisplay=(a,o,s,c)=>{let u=t.worldToView(a,o,s);return u=t.viewToProjection(u[0],u[1],u[2],c),t.projectionToNormalizedDisplay(u[0],u[1],u[2])},t.viewToWorld=(a,o,s)=>{if(e.activeCamera===null)return D0("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();Br(c,c),Qt(c,c);const u=new Float64Array([a,o,s]);return an(u,u,c),u},t.projectionToView=(a,o,s,c)=>{if(e.activeCamera===null)return D0("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];const u=e.activeCamera.getProjectionMatrix(c,-1,1);Br(u,u),Qt(u,u);const d=new Float64Array([a,o,s]);return an(d,d,u),d},t.worldToView=(a,o,s)=>{if(e.activeCamera===null)return D0("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();Qt(c,c);const u=new Float64Array([a,o,s]);return an(u,u,c),u},t.viewToProjection=(a,o,s,c)=>{if(e.activeCamera===null)return D0("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];const u=e.activeCamera.getProjectionMatrix(c,-1,1);Qt(u,u);const d=new Float64Array([a,o,s]);return an(d,d,u),d},t.computeVisiblePropBounds=()=>{e.allBounds[0]=kn.INIT_BOUNDS[0],e.allBounds[1]=kn.INIT_BOUNDS[1],e.allBounds[2]=kn.INIT_BOUNDS[2],e.allBounds[3]=kn.INIT_BOUNDS[3],e.allBounds[4]=kn.INIT_BOUNDS[4],e.allBounds[5]=kn.INIT_BOUNDS[5];let a=!0;t.invokeEvent(n);for(let o=0;o<e.props.length;++o){const s=e.props[o];if(s.getVisibility()&&s.getUseBounds()){const c=s.getBounds();c&&qh(c)&&(a=!1,c[0]<e.allBounds[0]&&(e.allBounds[0]=c[0]),c[1]>e.allBounds[1]&&(e.allBounds[1]=c[1]),c[2]<e.allBounds[2]&&(e.allBounds[2]=c[2]),c[3]>e.allBounds[3]&&(e.allBounds[3]=c[3]),c[4]<e.allBounds[4]&&(e.allBounds[4]=c[4]),c[5]>e.allBounds[5]&&(e.allBounds[5]=c[5]))}}return a&&(Cf(e.allBounds),xg("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){const o=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds(),s=[0,0,0];if(!qh(o))return xg("Cannot reset camera!"),!1;let c=null;if(t.getActiveCamera())c=e.activeCamera.getViewPlaneNormal();else return D0("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),s[0]=(o[0]+o[1])/2,s[1]=(o[2]+o[3])/2,s[2]=(o[4]+o[5])/2;let u=o[1]-o[0],d=o[3]-o[2],g=o[5]-o[4];u*=u,d*=d,g*=g;let h=u+d+g;h=h===0?1:h,h=Math.sqrt(h)*.5;const m=ur(e.activeCamera.getViewAngle()),y=h,v=h/Math.sin(m*.5),C=e.activeCamera.getViewUp();return Math.abs(Ft(C,c))>.999&&(Dq("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-C[2],C[0],C[1])),e.activeCamera.setFocalPoint(s[0],s[1],s[2]),e.activeCamera.setPosition(s[0]+v*c[0],s[1]+v*c[1],s[2]+v*c[2]),t.resetCameraClippingRange(o),e.activeCamera.setParallelScale(y),e.activeCamera.setPhysicalScale(h),e.activeCamera.setPhysicalTranslation(-s[0],-s[1],-s[2]),t.invokeEvent(i),!0},t.resetCameraClippingRange=function(){const o=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds();if(!qh(o))return xg("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return D0("Trying to reset clipping range of non-existent camera"),!1;const s=e.activeCamera.computeClippingRange(o);let c=0;if(e.activeCamera.getParallelProjection())c=.2*e.activeCamera.getParallelScale();else{const u=ur(e.activeCamera.getViewAngle());c=.2*Math.tan(u/2)*s[1]}return s[1]-s[0]<c&&(c=c-s[1]+s[0],s[1]+=c/2,s[0]-=c/2),s[0]<0&&(s[0]=0),s[0]=.99*s[0]-(s[1]-s[0])*e.clippingRangeExpansion,s[1]=1.01*s[1]+(s[1]-s[0])*e.clippingRangeExpansion,s[0]=s[0]>=s[1]?.01*s[1]:s[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),s[0]<e.nearClippingPlaneTolerance*s[1]&&(s[0]=e.nearClippingPlaneTolerance*s[1]),e.activeCamera.setClippingRange(s[0],s[1]),t.invokeEvent(r),!1},t.setRenderWindow=a=>{a!==e._renderWindow&&(e._vtkWindow=a,e._renderWindow=a)},t.visibleActorCount=()=>e.props.filter(a=>a.getVisibility()).length,t.visibleVolumeCount=t.visibleActorCount,t.getMTime=()=>{let a=e.mtime;const o=e.activeCamera?e.activeCamera.getMTime():0;o>a&&(a=o);const s=e._createdLight?e._createdLight.getMTime():0;return s>a&&(a=s),a},t.getTransparent=()=>!!e.preserveColorBuffer,t.isActiveCameraCreated=()=>!!e.activeCamera}const bq={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:W0(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function pD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,bq,n),Oq.extend(t,e,n),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),ha(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),ri(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),Tf(t,e,["actors","volumes","lights"]),Ov(t,e,["background"],4,1),I1(t,e,["renderWindow"]),_q(t,e)}const Mq=An(pD,"vtkRenderer");var Lq={newInstance:Mq,extend:pD};const Vq={Unknown:0,LeftController:1,RightController:2},Iq={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},Aq={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4};var mD={Device:Vq,Input:Iq,Axis:Aq};const{Device:vh,Input:Sl}=mD,{vtkWarningMacro:yh,vtkErrorMacro:Th,normalizeWheel:Nq,vtkOnceErrorMacro:Pq}=H,bu={ctrlKey:!1,altKey:!1,shiftKey:!1},M3={"xr-standard":[Sl.Trigger,Sl.Grip,Sl.TrackPad,Sl.Thumbstick,Sl.A,Sl.B]},D8=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function Eg(t){t.cancelable&&t.preventDefault()}function Ch(t){const e=Object.create(null);return t.forEach(n=>{let{pointerId:r,position:i}=n;e[r]=i}),e}function Uq(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");const n={...t},r=new Set,i=new Map;let a=1;t.start=()=>{!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=v=>{Th("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=v=>{e.interactorStyle!==v&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=v,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=()=>{e.initialized=!0,t.enable(),t.render()},t.enable=()=>t.setEnabled(!0),t.disable=()=>t.setEnabled(!1),t.startEventLoop=()=>yh("empty event loop");function o(v,C){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(v,C))}t.getCurrentRenderer=()=>(e.currentRenderer||o(0,0),e.currentRenderer);function s(v){const C=e._view.getCanvas(),S=C.getBoundingClientRect(),w=C.width/S.width,x=C.height/S.height,R={x:w*(v.clientX-S.left),y:x*(S.height-v.clientY+S.top),z:0};return(i.size<=1||!e.currentRenderer)&&o(R.x,R.y),R}const c=e._getScreenEventPositionFor||s;function u(v){return{controlKey:v.ctrlKey,altKey:v.altKey,shiftKey:v.shiftKey}}function d(v){const C=u(v);return{key:v.key,keyCode:v.charCode,...C}}function g(v){return v.pointerType||""}const h=()=>{if(e.container===null)return;const{container:v}=e;v.addEventListener("contextmenu",Eg),v.addEventListener("wheel",t.handleWheel),v.addEventListener("DOMMouseScroll",t.handleWheel),v.addEventListener("pointerenter",t.handlePointerEnter),v.addEventListener("pointerleave",t.handlePointerLeave),v.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),v.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),v.addEventListener("pointerup",t.handlePointerUp),v.addEventListener("pointercancel",t.handlePointerCancel),document.addEventListener("keypress",t.handleKeyPress),document.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),v.style.touchAction="none",v.style.userSelect="none",v.style.webkitTapHighlightColor="rgba(0,0,0,0)"};t.bindEvents=v=>{if(v===null)return;n.setContainer(v)&&h()};const m=()=>{clearTimeout(e.moveTimeoutID),clearTimeout(e.wheelTimeoutID),e.moveTimeoutID=0,e.wheelTimeoutID=0,a=1;const{container:v}=e;v&&(v.removeEventListener("contextmenu",Eg),v.removeEventListener("wheel",t.handleWheel),v.removeEventListener("DOMMouseScroll",t.handleWheel),v.removeEventListener("pointerenter",t.handlePointerEnter),v.removeEventListener("pointerleave",t.handlePointerLeave),v.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),v.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),v.removeEventListener("pointerup",t.handlePointerUp),v.removeEventListener("pointercancel",t.handlePointerCancel)),document.removeEventListener("keypress",t.handleKeyPress),document.removeEventListener("keydown",t.handleKeyDown),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),i.clear()};t.unbindEvents=()=>{m(),n.setContainer(null)},t.handleKeyPress=v=>{const C=d(v);t.keyPressEvent(C)},t.handleKeyDown=v=>{const C=d(v);t.keyDownEvent(C)},t.handleKeyUp=v=>{const C=d(v);t.keyUpEvent(C)},t.handlePointerEnter=v=>{const C={...u(v),position:c(v),deviceType:g(v)};t.pointerEnterEvent(C),C.deviceType==="mouse"&&t.mouseEnterEvent(C)},t.handlePointerLeave=v=>{const C={...u(v),position:c(v),deviceType:g(v)};t.pointerLeaveEvent(C),C.deviceType==="mouse"&&t.mouseLeaveEvent(C)},t.handlePointerDown=v=>{if(!(v.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&Eg(v),v.target.hasPointerCapture(v.pointerId)&&v.target.releasePointerCapture(v.pointerId),e.container.setPointerCapture(v.pointerId),i.has(v.pointerId)&&yh("[RenderWindowInteractor] duplicate pointerId detected"),i.set(v.pointerId,{pointerId:v.pointerId,position:c(v)}),v.pointerType){case"pen":case"touch":t.handleTouchStart(v);break;case"mouse":default:t.handleMouseDown(v);break}},t.handlePointerUp=v=>{if(i.has(v.pointerId))switch(e.preventDefaultOnPointerUp&&Eg(v),i.delete(v.pointerId),e.container.releasePointerCapture(v.pointerId),v.pointerType){case"pen":case"touch":t.handleTouchEnd(v);break;case"mouse":default:t.handleMouseUp(v);break}},t.handlePointerCancel=v=>{if(i.has(v.pointerId))switch(i.delete(v.pointerId),v.pointerType){case"pen":case"touch":t.handleTouchEnd(v);break;case"mouse":default:t.handleMouseUp(v);break}},t.handlePointerMove=v=>{if(i.has(v.pointerId)){const C=i.get(v.pointerId);C.position=c(v)}switch(v.pointerType){case"pen":case"touch":t.handleTouchMove(v);break;case"mouse":default:t.handleMouseMove(v);break}},t.handleMouseDown=v=>{const C={...u(v),position:c(v),deviceType:g(v)};switch(v.button){case 0:t.leftButtonPressEvent(C);break;case 1:t.middleButtonPressEvent(C);break;case 2:t.rightButtonPressEvent(C);break;default:Th(`Unknown mouse button pressed: ${v.button}`);break}},t.requestPointerLock=()=>{e.container&&e.container.requestPointerLock()},t.exitPointerLock=()=>document.exitPointerLock?.(),t.isPointerLocked=()=>!!e.container&&document.pointerLockElement===e.container,t.handlePointerLockChange=()=>{t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function y(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=v=>{if(v===void 0){Th("undefined requester, can not start animating");return}if(r.has(v)){yh("requester is already registered for animating");return}r.add(v),!e.animationRequest&&r.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=v=>{const C=Date.now()+v;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,C),!e.animationRequest&&r.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=()=>e.xrAnimation||e.animationRequest!==null,t.cancelAnimation=function(v){let C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!r.has(v)){if(!C){const S=v&&v.getClassName?v.getClassName():v;yh(`${S} did not request an animation`)}return}r.delete(v),e.animationRequest&&r.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=()=>{e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=()=>{e.xrAnimation=!1,r.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=(v,C,S)=>{v.inputSources.forEach(w=>{const x=w.gripSpace==null?null:C.getPose(w.gripSpace,S),R=w.gripSpace==null?null:C.getPose(w.targetRaySpace,S),O=w.gamepad,b=w.handedness;if(O){O.index in e.lastGamepadValues||(e.lastGamepadValues[O.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let I=0;I<O.buttons.length;++I)I in e.lastGamepadValues[O.index][b].buttons||(e.lastGamepadValues[O.index][b].buttons[I]=!1),e.lastGamepadValues[O.index][b].buttons[I]!==O.buttons[I].pressed&&x!=null&&(t.button3DEvent({gamepad:O,position:x.transform.position,orientation:x.transform.orientation,targetPosition:R.transform.position,targetOrientation:R.transform.orientation,pressed:O.buttons[I].pressed,device:w.handedness==="left"?vh.LeftController:vh.RightController,input:M3[O.mapping]&&M3[O.mapping][I]?M3[O.mapping][I]:Sl.Trigger}),e.lastGamepadValues[O.index][b].buttons[I]=O.buttons[I].pressed),e.lastGamepadValues[O.index][b].buttons[I]&&x!=null&&t.move3DEvent({gamepad:O,position:x.transform.position,orientation:x.transform.orientation,targetPosition:R.transform.position,targetOrientation:R.transform.orientation,device:w.handedness==="left"?vh.LeftController:vh.RightController})}})},t.handleMouseMove=v=>{const C={...u(v),position:c(v),deviceType:g(v)};e.moveTimeoutID===0?t.startMouseMoveEvent(C):(t.mouseMoveEvent(C),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(()=>{t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=()=>{const v=Date.now();e._animationFrameCount++,v-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(v-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=v,e._animationFrameCount=1),t.animationEvent(),y(),r.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=v=>{Eg(v);const C={...Nq(v),...u(v),position:c(v),deviceType:g(v)};e.wheelTimeoutID===0&&(Math.abs(C.spinY)>=.3?a=Math.abs(C.spinY):a=1),C.spinY/=a,e.wheelTimeoutID===0?(t.startMouseWheelEvent(C),t.mouseWheelEvent(C)):(t.mouseWheelEvent(C),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(()=>{t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=v=>{const C={...u(v),position:c(v),deviceType:g(v)};switch(v.button){case 0:t.leftButtonReleaseEvent(C);break;case 1:t.middleButtonReleaseEvent(C);break;case 2:t.rightButtonReleaseEvent(C);break;default:Th(`Unknown mouse button released: ${v.button}`);break}},t.handleTouchStart=v=>{const C=[...i.values()];if(e.recognizeGestures&&C.length>1){const S=Ch(i);if(C.length===2){const w={...u(bu),position:C[0].position,deviceType:g(v)};t.leftButtonReleaseEvent(w)}t.recognizeGesture("TouchStart",S)}else if(C.length===1){const S={...u(bu),position:c(v),deviceType:g(v)};t.leftButtonPressEvent(S)}},t.handleTouchMove=v=>{const C=[...i.values()];if(e.recognizeGestures&&C.length>1){const S=Ch(i);t.recognizeGesture("TouchMove",S)}else if(C.length===1){const S={...u(bu),position:C[0].position,deviceType:g(v)};t.mouseMoveEvent(S)}},t.handleTouchEnd=v=>{const C=[...i.values()];if(e.recognizeGestures)if(C.length===0){const S={...u(bu),position:c(v),deviceType:g(v)};t.leftButtonReleaseEvent(S)}else if(C.length===1){const S=Ch(i);t.recognizeGesture("TouchEnd",S);const w={...u(bu),position:C[0].position,deviceType:g(v)};t.leftButtonPressEvent(w)}else{const S=Ch(i);t.recognizeGesture("TouchMove",S)}else if(C.length===1){const S={...u(bu),position:C[0].position,deviceType:g(v)};t.leftButtonReleaseEvent(S)}},t.setView=v=>{e._view!==v&&(e._view=v,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=()=>e._view?.getRenderable()?.getRenderersByReference()?.[0],t.findPokedRenderer=function(){let v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;const S=e._view?.getRenderable()?.getRenderers();if(!S||S.length===0)return null;S.sort((b,I)=>b.getLayer()-I.getLayer());let w=null,x=null,R=null,O=S.length;for(;O--;){const b=S[O];if(e._view.isInViewport(v,C,b)&&b.getInteractive()){R=b;break}w===null&&b.getInteractive()&&(w=b),x===null&&e._view.isInViewport(v,C,b)&&(x=b)}return R===null&&(R=w),R===null&&(R=x),R==null&&(R=S[0]),R},t.render=()=>{!t.isAnimating()&&!e.inRender&&y()},D8.forEach(v=>{const C=v.charAt(0).toLowerCase()+v.slice(1);t[`${C}Event`]=S=>{if(!e.enabled)return;if(!t.getCurrentRenderer()){Pq(`
          Can not forward events without a current renderer on the interactor.
        `);return}const x={type:v,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer(),...S};t[`invoke${v}`](x)}}),t.recognizeGesture=(v,C)=>{if(Object.keys(C).length>2)return;if(e.startingEventPositions||(e.startingEventPositions={}),v==="TouchStart"){Object.keys(C).forEach(F=>{e.startingEventPositions[F]=C[F]}),e.currentGesture="Start";return}if(v==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}let S=0;const w=[],x=[];Object.keys(C).forEach(F=>{w[S]=C[F],x[S]=e.startingEventPositions[F],S++});const R=Math.sqrt((x[0].x-x[1].x)*(x[0].x-x[1].x)+(x[0].y-x[1].y)*(x[0].y-x[1].y)),O=Math.sqrt((w[0].x-w[1].x)*(w[0].x-w[1].x)+(w[0].y-w[1].y)*(w[0].y-w[1].y));let b=O2(Math.atan2(x[1].y-x[0].y,x[1].x-x[0].x)),I=O2(Math.atan2(w[1].y-w[0].y,w[1].x-w[0].x)),G=I-b;I=I+180>=360?I-180:I+180,b=b+180>=360?b-180:b+180,Math.abs(I-b)<Math.abs(G)&&(G=I-b);const j=[];if(j[0]=(w[0].x-x[0].x+w[1].x-x[1].x)/2,j[1]=(w[0].y-x[0].y+w[1].y-x[1].y)/2,v==="TouchMove")if(e.currentGesture==="Start"){let F=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);F<15&&(F=15);const $=Math.abs(O-R),z=O*3.1415926*Math.abs(G)/360,oe=Math.sqrt(j[0]*j[0]+j[1]*j[1]);if($>F&&$>z&&$>oe){e.currentGesture="Pinch";const Q={scale:1,touches:C};t.startPinchEvent(Q)}else if(z>F&&z>oe){e.currentGesture="Rotate";const Q={rotation:0,touches:C};t.startRotateEvent(Q)}else if(oe>F){e.currentGesture="Pan";const Q={translation:[0,0],touches:C};t.startPanEvent(Q)}}else{if(e.currentGesture==="Rotate"){const F={rotation:G,touches:C};t.rotateEvent(F)}if(e.currentGesture==="Pinch"){const F={scale:O/R,touches:C};t.pinchEvent(F)}if(e.currentGesture==="Pan"){const F={translation:j,touches:C};t.panEvent(F)}}},t.handleVisibilityChange=()=>{e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=v=>{e._forcedRenderer=!!v,e.currentRenderer=v},t.setContainer=v=>{m();const C=n.setContainer(v??null);return C&&h(),C},t.delete=()=>{for(;r.size;)t.cancelAnimation(r.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.setContainer(null),n.delete()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}const Fq={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function vD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Fq,n),H.obj(t,e),e._animationExtendedEnd=0,H.event(t,e,"RenderEvent"),D8.forEach(r=>H.event(t,e,r)),H.get(t,e,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),H.setGet(t,e,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),H.moveToProtected(t,e,["view"]),Uq(t,e)}const kq=H.newInstance(vD,"vtkRenderWindowInteractor");var Gq={newInstance:kq,extend:vD,handledEvents:D8,...mD};const{vtkDebugMacro:Bq}=H;function $q(t,e){e.classHierarchy.push("vtkActor");const n={...t};t.getActors=()=>[t],t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let r=e.property.getOpacity()>=1;return r=r&&(!e.texture||!e.texture.isTranslucent()),r=r&&(!e.mapper||e.mapper.getIsOpaque()),r},t.hasTranslucentPolygonalGeometry=()=>e.mapper===null?!1:(e.property===null&&t.setProperty(t.makeProperty()),!t.getIsOpaque()),t.makeProperty=$1.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const r=e.mapper.getBounds();if(!r||r.length!==6)return r;if(r[0]>r[1])return e.mapperBounds=r.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),r;if(!e.mapperBounds||r[0]!==e.mapperBounds[0]||r[1]!==e.mapperBounds[1]||r[2]!==e.mapperBounds[2]||r[3]!==e.mapperBounds[3]||r[4]!==e.mapperBounds[4]||r[5]!==e.mapperBounds[5]||t.getMTime()>e.boundsMTime.getMTime()){Bq("Recomputing bounds..."),e.mapperBounds=r.concat();const i=[];kn.getCorners(r,i),t.computeMatrix();const a=new Float64Array(16);Qt(a,e.matrix),i.forEach(o=>an(o,o,a)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((o,s)=>s%2===0?i.reduce((c,u)=>c>u[s/2]?u[s/2]:c,o):i.reduce((c,u)=>c<u[(s-1)/2]?u[(s-1)/2]:c,o)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let r=n.getMTime();if(e.property!==null){const i=e.property.getMTime();r=i>r?i:r}if(e.backfaceProperty!==null){const i=e.backfaceProperty.getMTime();r=i>r?i:r}return r},t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let i=e.mapper.getMTime();r=i>r?i:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),i=e.mapper.getInput().getMTime(),r=i>r?i:r)}return r},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1,t.processSelectorPixelBuffers=(r,i)=>{e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(r,i)}}const Wq={mapper:null,property:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1,bounds:[1,-1,1,-1,1,-1]};function yD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Wq,n),d8.extend(t,e,n),e.boundsMTime={},H.obj(e.boundsMTime),H.set(t,e,["property"]),H.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),$q(t,e)}const zq=H.newInstance(yD,"vtkActor");var Hq={newInstance:zq,extend:yD};function jq(t,e){const n=t.invokeResize;delete t.invokeResize,e.renderWindow=Kz.newInstance(),e.rendererMap={},e.openGLRenderWindow=dq.newInstance(),e.renderWindow.addView(e.openGLRenderWindow),e.interactor=Gq.newInstance(),e.interactor.setView(e.openGLRenderWindow),e.interactor.initialize(),t.addRenderer=({viewport:r,id:i,background:a})=>{const o=Lq.newInstance({viewport:r,background:a||e.background});e.renderWindow.addRenderer(o),e.rendererMap[i]=o},t.destroy=()=>{e.renderWindow.getInteractor().delete()},t.removeRenderer=r=>{const i=t.getRenderer(r);e.renderWindow.removeRenderer(i),i.delete(),delete e.rendererMap[r]},t.getRenderer=r=>e.rendererMap[r],t.getRenderers=()=>{const{rendererMap:r}=e;return Object.keys(r).map(a=>({id:a,renderer:r[a]}))},t.resize=()=>{if(e.container){const{width:r,height:i}=e.container;e.openGLRenderWindow.setSize(Math.floor(r),Math.floor(i)),n(),e.renderWindow.render()}},t.setContainer=r=>{e.container=r,e.openGLRenderWindow.setContainer(e.container)},t.delete=H.chain(t.setContainer,t.destroy,e.openGLRenderWindow.delete,t.delete),t.resize()}const qq={background:[0,0,0],container:null};function TD(t,e,n={}){Object.assign(e,qq,n),H.obj(t,e),H.get(t,e,["renderWindow","openGLRenderWindow","interactor","container"]),H.event(t,e,"resize"),jq(t,e)}const Kq=H.newInstance(TD),CD={newInstance:Kq,extend:TD},{BlendMode:_0,FilterMode:$g}=Kw;function Yq(t,e,n,r,i){let a=null;return i?(a=i,a.removeAllPoints()):a=Gl.newInstance(),a.addPointLong(-1024,0,1,1),a.addPoint(t,e),a.addPoint(n,r),a}const Xq={createRadonTransferFunction:Yq};function Zq(t,e){e.classHierarchy.push("vtkVolumeMapper");const n={...t};t.getBounds=()=>{const r=t.getInputData();return r?(e.static||t.update(),e.bounds=r.getBounds()):e.bounds=W0(),e.bounds},t.update=()=>{t.getInputData()},t.setBlendModeToComposite=()=>{t.setBlendMode(_0.COMPOSITE_BLEND)},t.setBlendModeToMaximumIntensity=()=>{t.setBlendMode(_0.MAXIMUM_INTENSITY_BLEND)},t.setBlendModeToMinimumIntensity=()=>{t.setBlendMode(_0.MINIMUM_INTENSITY_BLEND)},t.setBlendModeToAverageIntensity=()=>{t.setBlendMode(_0.AVERAGE_INTENSITY_BLEND)},t.setBlendModeToAdditiveIntensity=()=>{t.setBlendMode(_0.ADDITIVE_INTENSITY_BLEND)},t.setBlendModeToRadonTransform=()=>{t.setBlendMode(_0.RADON_TRANSFORM_BLEND)},t.getBlendModeAsString=()=>H.enumToString(_0,e.blendMode),t.setAverageIPScalarRange=(r,i)=>{console.warn("setAverageIPScalarRange is deprecated use setIpScalarRange"),t.setIpScalarRange(r,i)},t.getFilterModeAsString=()=>H.enumToString($g,e.filterMode),t.setFilterModeToOff=()=>{t.setFilterMode($g.OFF)},t.setFilterModeToNormalized=()=>{t.setFilterMode($g.NORMALIZED)},t.setFilterModeToRaw=()=>{t.setFilterMode($g.RAW)},t.setGlobalIlluminationReach=r=>n.setGlobalIlluminationReach(ns(r,0,1)),t.setVolumetricScatteringBlending=r=>n.setVolumetricScatteringBlending(ns(r,0,1)),t.setVolumeShadowSamplingDistFactor=r=>n.setVolumeShadowSamplingDistFactor(r>=1?r:1),t.setAnisotropy=r=>n.setAnisotropy(ns(r,-.99,.99)),t.setLAOKernelSize=r=>n.setLAOKernelSize(Av(ns(r,1,32))),t.setLAOKernelRadius=r=>n.setLAOKernelRadius(r>=1?r:1)}const Qq=t=>({bounds:[1,-1,1,-1,1,-1],sampleDistance:1,imageSampleDistance:1,maximumSamplesPerRay:1e3,autoAdjustSampleDistances:!0,initialInteractionScale:1,interactionSampleDistanceFactor:1,blendMode:_0.COMPOSITE_BLEND,ipScalarRange:[-1e6,1e6],filterMode:$g.OFF,preferSizeOverAccuracy:!1,computeNormalFromOpacity:!1,volumetricScatteringBlending:0,globalIlluminationReach:0,volumeShadowSamplingDistFactor:5,anisotropy:0,localAmbientOcclusion:!1,LAOKernelSize:15,LAOKernelRadius:7,updatedExtents:[],...t});function SD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Qq(n)),E8.extend(t,e,n),H.setGet(t,e,["sampleDistance","imageSampleDistance","maximumSamplesPerRay","autoAdjustSampleDistances","initialInteractionScale","interactionSampleDistanceFactor","blendMode","filterMode","preferSizeOverAccuracy","computeNormalFromOpacity","volumetricScatteringBlending","globalIlluminationReach","volumeShadowSamplingDistFactor","anisotropy","localAmbientOcclusion","LAOKernelSize","LAOKernelRadius","updatedExtents"]),H.setGetArray(t,e,["ipScalarRange"],2),H.event(t,e,"lightingActivated"),Zq(t,e)}const Jq=H.newInstance(SD,"vtkVolumeMapper");var wD={newInstance:Jq,extend:SD,...Xq};function eK(t,e){e.classHierarchy.push("vtkSharedVolumeMapper");const n=t.delete;t.delete=()=>{e.scalarTexture=null,n()}}const tK={scalarTexture:null};function xD(t,e,n={}){Object.assign(e,tK,n),wD.extend(t,e,n),H.setGet(t,e,["scalarTexture"]),eK(t,e)}const nK=H.newInstance(xD,"vtkSharedVolumeMapper"),rK={newInstance:nK,extend:xD};function xC(t,e){const n=R8(e),r=new n(t.length);return r.set(t),r}function iK(t,e){e.classHierarchy.push("vtkStreamingOpenGLTexture"),e.updatedFrames=[],e.volumeId=null;const n=t.create3DFilterableFromRaw;t.create3DFilterableFromRaw=(s,c,u,d,g,h,m)=>{e.inputDataType=g,e.inputNumComps=d,n(s,c,u,d,g,h,m)};const r=t.updateVolumeInfoForGL;t.updateVolumeInfoForGL=(s,c)=>{const u=r(s,c);return e.volumeInfo.dataComputedScale=[1],e.volumeInfo.dataComputedOffset=[0],u},t.update3DFromRaw=()=>{const{volumeId:s}=e;if(!s)return;const c=rt.getVolume(s);if(e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),c.isDynamicVolume()){o();return}return t.hasUpdatedFrames()&&a()};const i=t.modified;t.setUpdatedFrame=s=>{e.updatedFrames[s]=!0,i()},t.modified=()=>{i();const s=rt.getVolume(e.volumeId);if(!s)return;const c=s.imageIds;for(let u=0;u<c.length;u++)e.updatedFrames[u]=!0};function a(){const s=rt.getVolume(e.volumeId),c=s.imageIds;for(let u=0;u<e.updatedFrames.length;u++)if(e.updatedFrames[u]){const d=rt.getImage(c[u]);if(!d)continue;let g=d.voxelManager.getScalarData();const h=e.context;s.dataType!==g.constructor.name&&(g=xC(g,s.dataType));const[m]=t.updateArrayDataTypeForGL(s.dataType,[g]);t.bind();const y=u;h.texSubImage3D(e.target,0,0,0,y,e.width,e.height,1,e.format,e.openGLDataType,m),t.deactivate(),e.updatedFrames[u]=null}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}function o(){const s=rt.getVolume(e.volumeId),c=s.getCurrentDimensionGroupImageIds();if(!c.length)return!1;let u;for(let d=0;d<c.length;d++){const g=c[d],h=rt.getImage(g);let m;h?(m=h.voxelManager.getScalarData(),u=m.constructor):(u=R8(s.dataType,!0),m=new u(e.width*e.height));const y=e.context;s.dataType!==m.constructor.name&&(m=xC(m,s.dataType));const[v]=t.updateArrayDataTypeForGL(s.dataType,[m]);t.bind();let C=d;y.texSubImage3D(e.target,0,0,0,C,e.width,e.height,1,e.format,e.openGLDataType,v),t.deactivate()}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}t.hasUpdatedFrames=()=>!e.updatedFrames.length||e.updatedFrames.some(s=>s),t.getUpdatedFrames=()=>e.updatedFrames,t.setVolumeId=s=>{e.volumeId=s},t.getVolumeId=()=>e.volumeId,t.setTextureParameters=({width:s,height:c,depth:u,numberOfComponents:d,dataType:g})=>{e.width??=s,e.height??=c,e.depth??=u,e.inputNumComps??=d,e.inputDataType??=g},t.getTextureParameters=()=>({width:e.width,height:e.height,depth:e.depth,numberOfComponents:e.inputNumComps,dataType:e.inputDataType})}const aK={updatedFrames:[]};function ED(t,e,n={}){Object.assign(e,aK,n),qn.extend(t,e,n),iK(t,e)}const oK=H.newInstance(ED,"vtkStreamingOpenGLTexture"),sK={newInstance:oK,extend:ED},cK={isPerformingCoordinateTransformation:!1};function RD(t,e,n={}){Object.assign(e,cK,n),O8.extend(t,e,n),H.setGet(t,e,["isPerformingCoordinateTransformation"]),uK(t,e)}const lK=H.newInstance(RD,"vtkSlabCamera");function uK(t,e){e.classHierarchy.push("vtkSlabCamera");const n=wt(new Float64Array(16)),r=new Float64Array(3);t.getProjectionMatrix=(i,a,o)=>{const s=Ps();if(e.projectionMatrix){const h=1/e.physicalScale;return gn(r,h,h,h),_r(s,e.projectionMatrix),Us(s,s,r),Qt(s,s),s}wt(n);let c=e.clippingRange[0],u=e.clippingRange[1];e.isPerformingCoordinateTransformation&&(c=e.distance,u=e.distance+.1);const d=u-c,g=[c+(a+1)*d/2,c+(o+1)*d/2];if(e.parallelProjection){const h=e.parallelScale*i,m=e.parallelScale,y=(e.windowCenter[0]-1)*h,v=(e.windowCenter[0]+1)*h,C=(e.windowCenter[1]-1)*m,S=(e.windowCenter[1]+1)*m;Yv(n,y,v,C,S,g[0],g[1]),Qt(n,n)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const h=Math.tan(_o.radiansFromDegrees(e.viewAngle)/2);let m,y;e.useHorizontalViewAngle===!0?(m=c*h,y=c*h/i):(m=c*h*i,y=c*h);const v=(e.windowCenter[0]-1)*m,C=(e.windowCenter[0]+1)*m,S=(e.windowCenter[1]-1)*y,w=(e.windowCenter[1]+1)*y,x=g[0],R=g[1];n[0]=2*x/(C-v),n[5]=2*x/(w-S),n[2]=(v+C)/(C-v),n[6]=(S+w)/(w-S),n[10]=-(x+R)/(R-x),n[14]=-1,n[11]=-2*x*R/(R-x),n[15]=0}}return _r(s,n),s}}const fK={newInstance:lK,extend:RD};class bp{constructor(e){this._imageIdsIndexMap=new Map,this._imageURIsIndexMap=new Map,this.cornerstoneImageMetaData=null,this.isPreScaled=!1,this.numTimePoints=null,this.numFrames=null;const{imageIds:n,scaling:r,dimensions:i,spacing:a,origin:o,direction:s,dataType:c,volumeId:u,referencedVolumeId:d,metadata:g,referencedImageIds:h,additionalDetails:m,voxelManager:y,numberOfComponents:v}=e;if(!c)throw new Error('Data type is required, please provide a data type as string such as "Uint8Array", "Float32Array", etc.');let{imageData:C}=e;this.suppressWarnings=!0,this.imageIds=n,this.volumeId=u,this.metadata=g,this.dimensions=i,this.spacing=a,this.origin=o,this.direction=s,this.dataType=c,this.vtkOpenGLTexture=sK.newInstance(),this.vtkOpenGLTexture.setVolumeId(u),this.voxelManager=y??Fn.createImageVolumeVoxelManager({dimensions:i,imageIds:n,numberOfComponents:v}),this.numVoxels=this.dimensions[0]*this.dimensions[1]*this.dimensions[2],C||(C=Op.newInstance(),C.setDimensions(i),C.setSpacing(a),C.setDirection(s),C.setOrigin(o)),C.set({dataType:c,voxelManager:this.voxelManager,id:u,numberOfComponents:v||1},this.suppressWarnings),C.set({hasScalarVolume:!1},this.suppressWarnings),this.imageData=C,this.numFrames=this._getNumFrames(),this._reprocessImageIds(),r&&(this.scaling=r),d&&(this.referencedVolumeId=d),h&&(this.referencedImageIds=h),m&&(this.additionalDetails=m)}get sizeInBytes(){return this.voxelManager.sizeInBytes}get imageIds(){return this._imageIds}set imageIds(e){this._imageIds=e,this._reprocessImageIds()}_reprocessImageIds(){this._imageIdsIndexMap.clear(),this._imageURIsIndexMap.clear(),this._imageIds.forEach((e,n)=>{const r=da(e);this._imageIdsIndexMap.set(e,n),this._imageURIsIndexMap.set(r,n)})}isDynamicVolume(){return this.numTimePoints>1}getImageIdIndex(e){return this._imageIdsIndexMap.get(e)}getImageIdByIndex(e){return this._imageIds[e]}getImageURIIndex(e){return this._imageURIsIndexMap.get(e)}load(e){}destroy(){this.imageData.delete(),this.imageData=null,this.voxelManager.clear(),this.vtkOpenGLTexture.releaseGraphicsResources(),this.vtkOpenGLTexture.delete()}invalidate(){for(let e=0;e<this.imageIds.length;e++)this.vtkOpenGLTexture.setUpdatedFrame(e);this.imageData.modified()}modified(){this.imageData.modified(),this.vtkOpenGLTexture.modified(),this.numFrames=this._getNumFrames()}removeFromCache(){rt.removeVolumeLoadObject(this.volumeId)}getScalarDataLength(){return this.voxelManager.getScalarDataLength()}_getNumFrames(){return this.isDynamicVolume()?this.numTimePoints:this.imageIds.length}imageIdIndexToFrameIndex(e){return e%this.numFrames}getCornerstoneImages(){const{imageIds:e}=this;return e.map(n=>rt.getImage(n))}}const Ms=[];function xf(t,e=0){let n;for(n=0;n<Ms.length&&!(Ms[n].priority<=e);n++);Ms.splice(n,0,{priority:e,provider:t})}function gK(t){for(let e=0;e<Ms.length;e++)if(Ms[e].provider===t){Ms.splice(e,1);break}}function dK(){for(;Ms.length>0;)Ms.pop()}function it(t,...e){for(let n=0;n<Ms.length;n++){const r=Ms[n].provider(t,...e);if(r!==void 0)return r}}const hK=Object.freeze(Object.defineProperty({__proto__:null,addProvider:xf,get:it,removeAllProviders:dK,removeProvider:gK},Symbol.toStringTag,{value:"Module"}));let Rg={};const Mp={add:(t,e)=>{Mp.addRaw(t,{...e,metadata:structuredClone(e.metadata)})},addRaw:(t,e)=>{const n=e.type;Rg[t]||(Rg[t]={}),Rg[t][n]=e.metadata},get:(t,e)=>Rg[e]?.[t],clear:()=>{Rg={}}};xf(Mp.get);const ks=new Sv("imageLoadPool");ks.grabDelay=0;ks.setMaxSimultaneousRequests(Nt.Interaction,1e3);ks.setMaxSimultaneousRequests(Nt.Thumbnail,1e3);ks.setMaxSimultaneousRequests(Nt.Prefetch,1e3);const OD={};let pK;function DD(t,e){const n=rt.getImageLoadObject(t);if(n)return EC(n.promise,t),n;const r=t.split(":")[0],i=OD[r]||pK;if(!i)throw new Error(`loadImageFromImageLoader: No image loader found for scheme '${r}'`);const a=i(t,e);return EC(a.promise,t),a}function EC(t,e){Promise.resolve(t).then(n=>{mK(n),je(Ye,We.IMAGE_LOADED,{image:n})}).catch(n=>{const r={imageId:e,error:n};je(Ye,We.IMAGE_LOAD_FAILED,r)})}function mK(t){if(!t.voxelManager){const{width:e,height:n,numberOfComponents:r}=t,i=Fn.createImageVoxelManager({scalarData:t.getPixelData(),width:e,height:n,numberOfComponents:r});t.voxelManager=i,t.getPixelData=()=>i.getScalarData(),delete t.imageFrame.pixelData}}function vK(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadImage: parameter imageId must not be undefined");return DD(t,e).promise}function j0(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const n=DD(t,e);return rt.getImageLoadObject(t)||rt.putImageLoadObject(t,n),n.promise}function yK(t,e){const{scalarData:n,origin:r,direction:i,targetBuffer:a,skipCreateBuffer:o,onCacheAdd:s,frameOfReferenceUID:c,voxelRepresentation:u,referencedImageId:d}=e,g=e.dimensions,h=e.spacing;if(!g||!h)throw new Error("createAndCacheLocalImage: dimensions and spacing are required");const m=g[0],y=g[1],v=h[0],C=h[1],S={frameOfReferenceUID:c,rows:y,columns:m,imageOrientationPatient:i??[1,0,0,0,1,0],rowCosines:i?i.slice(0,3):[1,0,0],columnCosines:i?i.slice(3,6):[0,1,0],imagePositionPatient:r??[0,0,0],pixelSpacing:[C,v],rowPixelSpacing:C,columnPixelSpacing:v},w=m*y,x=n.length/w;let R;if(n){if(!(n instanceof Uint8Array||n instanceof Float32Array||n instanceof Uint16Array||n instanceof Int16Array))throw new Error("createAndCacheLocalImage: scalarData must be of type Uint8Array, Uint16Array, Int16Array or Float32Array");R=n}else if(!o){const{TypedArrayConstructor:le}=cD(a?.type,w);R=new le(w)}let O,b,I;if(R instanceof Uint8Array)O=8,b=8,I=7;else if(R instanceof Uint16Array)O=16,b=16,I=15;else if(R instanceof Int16Array)O=16,b=16,I=15;else if(R instanceof Float32Array)O=32,b=32,I=31;else throw new Error("Unsupported scalarData type");const G={samplesPerPixel:1,photometricInterpretation:R.length>g[0]*g[1]?"RGB":"MONOCHROME2",rows:y,columns:m,bitsAllocated:O,bitsStored:b,highBit:I},j={imagePlaneModule:S,imagePixelModule:G};["imagePlaneModule","imagePixelModule"].forEach(le=>{Mp.add(t,{type:le,metadata:j[le]||{}})});const F=t,$=u===T2.RLE&&Fn.createRLEImageVoxelManager({dimensions:g,id:F})||Fn.createImageVoxelManager({height:y,width:m,numberOfComponents:x,scalarData:R,id:F});let z=R[0],oe=R[0];for(let le=1;le<R.length;le++)R[le]<z&&(z=R[le]),R[le]>oe&&(oe=R[le]);const Q={imageId:t,intercept:0,windowCenter:0,windowWidth:0,color:G.photometricInterpretation==="RGB",numberOfComponents:G.samplesPerPixel,dataType:a?.type,slope:1,minPixelValue:z,maxPixelValue:oe,rows:G.rows,columns:G.columns,getCanvas:void 0,height:G.rows,width:G.columns,rgba:void 0,columnPixelSpacing:S.columnPixelSpacing,rowPixelSpacing:S.rowPixelSpacing,FrameOfReferenceUID:S.frameOfReferenceUID,invert:!1,getPixelData:()=>$.getScalarData(),voxelManager:$,sizeInBytes:n.byteLength,referencedImageId:d};return s?.(Q),rt.putImageSync(Q.imageId,Q),Q}function i2(t,e){OD[t]=e}function _D(t){const e=t[0],{pixelRepresentation:n,bitsAllocated:r,bitsStored:i,highBit:a,photometricInterpretation:o,samplesPerPixel:s}=it("imagePixelModule",e),c=[],u=it("voiLutModule",e);let d;if(u){const{windowWidth:w,windowCenter:x}=u;if(d=u?.voiLUTFunction,Array.isArray(w))for(let R=0;R<w.length;R++)c.push({windowWidth:w[R],windowCenter:x[R]});else c.push({windowWidth:w,windowCenter:x})}else c.push({windowWidth:void 0,windowCenter:void 0});const{modality:g,seriesInstanceUID:h}=it("generalSeriesModule",e),{imageOrientationPatient:m,pixelSpacing:y,frameOfReferenceUID:v,columns:C,rows:S}=it("imagePlaneModule",e);return{BitsAllocated:r,BitsStored:i,SamplesPerPixel:s,HighBit:a,PhotometricInterpretation:o,PixelRepresentation:n,Modality:g,ImageOrientationPatient:m,PixelSpacing:y,FrameOfReferenceUID:v,Columns:C,Rows:S,voiLut:c,VOILUTFunction:d,SeriesInstanceUID:h}}function bD(t){const{imagePositionPatient:e,imageOrientationPatient:n}=it("imagePlaneModule",t[0]),r=on(n[0],n[1],n[2]),i=on(n[3],n[4],n[5]),a=Ke();Cn(a,r,i);const o=on(e[0],e[1],e[2]),s=t[0].split(":")[0]==="wadouri";let c;function u(m){const{imagePositionPatient:y}=it("imagePlaneModule",m),v=Ke(),C=on(y[0],y[1],y[2]);return hn(v,o,C),ft(v,a)}if(s){const m=[t[0],t[Math.floor(t.length/2)]];u(m[0]),u(m[1]);const y=it("imagePlaneModule",m[1]);if(!y)throw new Error("Incomplete metadata required for volume construction.");const v=Ke(),C=on(y.imagePositionPatient[0],y.imagePositionPatient[1],y.imagePositionPatient[2]);hn(v,o,C);const S=ft(v,a);c=Math.abs(S)/Math.floor(t.length/2)}else{const m=t.map(v=>({distance:u(v),imageId:v}));m.sort((v,C)=>C.distance-v.distance);const y=m.length;c=Math.abs(m[y-1].distance-m[0].distance)/(y-1)}const{sliceThickness:d,spacingBetweenSlices:g}=it("imagePlaneModule",t[0]),{strictZSpacingForVolumeViewport:h}=Xl().rendering;return(c===0||isNaN(c))&&!h&&(g?(console.debug("Could not calculate spacing. Using spacingBetweenSlices"),c=g):d?(console.debug("Could not calculate spacing and no spacingBetweenSlices. Using sliceThickness"),c=d):(console.debug("Could not calculate spacing. The VolumeViewport visualization is compromised. Setting spacing to 1 to render"),c=1)),c}function MD(t,e){const{imagePositionPatient:n,imageOrientationPatient:r}=it("imagePlaneModule",t[0]);if(!e){const d=on(r[0],r[1],r[2]),g=on(r[3],r[4],r[5]);e=Ke(),Cn(e,d,g)}const i=t[0].split(":")[0]==="wadouri",a=bD(t);let o;function s(d){const{imagePositionPatient:g}=it("imagePlaneModule",d),h=Ke();return hn(h,n,g),ft(h,e)}if(i){const d=[t[0],t[Math.floor(t.length/2)]];o=t;const g=s(d[0]),h=s(d[1]);g-h<0&&o.reverse()}else{const d=t.map(g=>({distance:s(g),imageId:g}));d.sort((g,h)=>h.distance-g.distance),o=d.map(g=>g.imageId)}const{imagePositionPatient:c}=it("imagePlaneModule",o[0]);return{zSpacing:a,origin:c,sortedImageIds:o}}function LD(t){const e=it("modalityLutModule",t)||{},n=it("generalSeriesModule",t)||{},{modality:r}=n,i={rescaleSlope:e.rescaleSlope||1,rescaleIntercept:e.rescaleIntercept??0,modality:r},a=it("scalingModule",t)||{};return{...i,...r==="PT"&&{suvbw:a.suvbw,suvbsa:a.suvbsa,suvlbm:a.suvlbm},...r==="RTDOSE"&&{doseGridScaling:a.DoseGridScaling,doseSummation:a.DoseSummation,doseType:a.DoseType,doseUnit:a.DoseUnit}}}const _8=t=>Object.values(t).some(n=>typeof n=="number"&&!Number.isInteger(n)),RC={Uint8Array:"Uint8Array",Int16Array:"Int16Array",Uint16Array:"Uint16Array",Float32Array:"Float32Array"};function b8(t,e){const n=_D(t),{ImageOrientationPatient:r,PixelSpacing:i,Columns:a,Rows:o}=n,s=on(r[0],r[1],r[2]),c=on(r[3],r[4],r[5]),u=Ke();Cn(u,s,c);const{zSpacing:d,origin:g,sortedImageIds:h}=MD(t,u),m=t.length,y=[i[1],i[0],d],v=[a,o,m].map(S=>Math.floor(S)),C=[...s,...c,...u];return{dimensions:v,spacing:y,origin:g,dataType:TK(h,n),direction:C,metadata:n,imageIds:h,volumeId:e,voxelManager:null,numberOfComponents:n.PhotometricInterpretation==="RGB"?3:1}}function TK(t,e){const{BitsAllocated:n,PixelRepresentation:r}=e,i=r===1,a=CK(t);if(a)return a;const[o,s,c]=[0,Math.floor(t.length/2),t.length-1],u=[o,s,c].map(m=>LD(t[m])),d=u.some(m=>m.rescaleIntercept<0||m.rescaleSlope<0),g=u.some(m=>_8(m)),h=wv();switch(n){case 8:return"Uint8Array";case 16:return h&&g?"Float32Array":i||d?"Int16Array":!i&&!d?"Uint16Array":"Float32Array";case 24:return"Uint8Array";case 32:return"Float32Array";default:throw new Error(`Bits allocated of ${n} is not defined to generate scalarData for the volume.`)}}function CK(t){const n=[0,Math.floor(t.length/2),t.length-1].map(i=>rt.getImage(t[i]));if(!n.every(Boolean))return null;const r=n[0].getPixelData().constructor.name;return n.every(i=>i.getPixelData().constructor.name===r)&&r in RC?RC[r]:null}let H2=class VD{constructor(e){this.name=e||"unknown"}static as(e){if(e.iterator)return e.iterator;const n=new VD("as iterator");return e.then(r=>{try{n.add(r,!0)}catch(i){n.reject(i)}},r=>{n.reject(r)}),n}add(e,n=!1){this.nextValue=e,this.done||=n,this.waiting&&(this.waiting.resolve(e),this.waiting=void 0)}resolve(){this.done=!0,this.waiting&&(this.waiting.resolve(this.nextValue),this.waiting=void 0)}reject(e){this.rejectReason=e,this.waiting?.reject(e)}getRecent(){if(this.rejectReason)throw this.rejectReason;return this.nextValue}async*[Symbol.asyncIterator](){for(;!this.done;){if(this.rejectReason)throw this.rejectReason;if(this.nextValue!==void 0&&(yield this.nextValue,this.done))break;this.waiting||(this.waiting={},this.waiting.promise=new Promise((e,n)=>{this.waiting.resolve=e,this.waiting.reject=n})),await this.waiting.promise}yield this.nextValue}async forEach(e,n){let r=0;try{for await(const i of this){const{done:a}=this;try{await e(i,a,r),r++}catch(o){if(!a){console.warn("Caught exception in intermediate value",o);continue}if(n)n(o,a);else throw o}}}catch(i){if(n)n(i,!0);else throw i}}generate(e,n){return e(this,this.reject.bind(this)).then(()=>{this.done||this.resolve()},r=>{this.reject(r),n?n(r):console.warn("Couldn't process because",r)})}async nextPromise(){for await(const e of this)if(e)return e;return this.nextValue}async donePromise(){for await(const e of this);return this.nextValue}getNextPromise(){const e=this.nextPromise();return e.iterator=this,e}getDonePromise(){const e=this.donePromise();return e.iterator=this,e}};const Mu=new Map,OC="imageRetrieveConfiguration",sf={IMAGE_RETRIEVE_CONFIGURATION:OC,clear:()=>{Mu.clear()},add:(t,e)=>{Mu.set(t,e)},clone:()=>new Map(Mu),restore:t=>{Mu.clear(),t.forEach((e,n)=>{Mu.set(n,e)})},get:(t,...e)=>{if(t===OC)return e.map(n=>Mu.get(n)).find(n=>n!==void 0)}};xf(sf.get.bind(sf));function M8(t){const e=Hs(),n=[];return e.forEach(r=>{const a=r.getVolumeViewports().filter(o=>o.hasVolumeId(t));n.push(...a)}),n}const z4=t=>{const e=SK(t);e?.length&&e.forEach(({renderingEngine:n,viewportIds:r})=>{n.hasBeenDestroyed||n.renderViewports(r)})};function SK(t){const e=Hs(),n=[];return e.forEach(r=>{const i=M8(t);i.length&&n.push({renderingEngine:r,viewportIds:i.map(a=>a.id)})}),n}const DC=[{id:"initialImages",retrieveType:"single"}],wK=[{id:"lossySequential",retrieveType:"singleFast"},{id:"finalSequential",retrieveType:"singleFinal"}],L3=[{offset:-1,imageQualityStatus:no.ADJACENT_REPLICATE},{offset:1,imageQualityStatus:no.ADJACENT_REPLICATE},{offset:2,imageQualityStatus:no.FAR_REPLICATE}],xK=[{id:"initialImages",positions:[.5,0,-1],retrieveType:"default",requestType:Nt.Thumbnail,priority:5,nearbyFrames:L3},{id:"quarterThumb",decimate:4,offset:3,requestType:Nt.Thumbnail,retrieveType:"multipleFast",priority:6,nearbyFrames:L3},{id:"halfThumb",decimate:4,offset:1,priority:7,requestType:Nt.Thumbnail,retrieveType:"multipleFast",nearbyFrames:L3},{id:"quarterFull",decimate:4,offset:2,priority:8,requestType:Nt.Thumbnail,retrieveType:"multipleFinal"},{id:"halfFull",decimate:4,offset:0,priority:9,requestType:Nt.Thumbnail,retrieveType:"multipleFinal"},{id:"threeQuarterFull",decimate:4,offset:1,priority:10,requestType:Nt.Thumbnail,retrieveType:"multipleFinal"},{id:"finalFull",decimate:4,offset:3,priority:11,requestType:Nt.Thumbnail,retrieveType:"multipleFinal"},{id:"errorRetrieve"}];function ID(t,e,n=0){const r=[];for(let i=n;i<t.length;i+=e)r.push(i);return r}function EK(t,e,n){if(e?.nearbyRequests?.length)for(const r of e.nearbyRequests)try{const{itemId:i,imageQualityStatus:a}=r,o=rt.getImageQuality(i);if(o!==void 0&&o>=a)continue;const s={...n,imageId:i,imageQualityStatus:a};rt.setPartialImage(i,s),t.successCallback(i,s)}catch(i){console.warn("Couldn't fill nearby item ",r.itemId,i)}}const ju=class ju{constructor(e){this.stages=e.stages||DC,this.retrieveOptions=e.retrieveOptions||{}}loadImages(e,n){return new RK(this,e,n).loadImages()}};ju.createProgressive=AD,ju.interleavedRetrieveStages={stages:xK},ju.singleRetrieveStages={stages:DC},ju.sequentialRetrieveStages={stages:wK};let j2=ju;class RK{constructor(e,n,r){this.outstandingRequests=0,this.stageStatusMap=new Map,this.displayedIterator=new H2("displayed"),this.stages=e.stages,this.retrieveOptions=e.retrieveOptions,this.imageIds=n,this.listener=r}async loadImages(){const e=this.createStageRequests();this.outstandingRequests=e.length;for(const n of e)this.addRequest(n);return this.outstandingRequests===0?Promise.resolve(null):this.displayedIterator.getDonePromise()}sendRequest(e,n){const{imageId:r,next:i}=e,a=(d,g)=>{this.listener.errorCallback(r,c||!i,d),g&&this.updateStageStatus(e.stage,d)},o=(n.loader||j0)(r,n),s=H2.as(o);let c=!1;return s.forEach(async(d,g)=>{const h=rt.getImageQuality(r);if(!d){console.warn("No image retrieved",r);return}const{imageQualityStatus:m}=d;if(c||=m===no.FULL_RESOLUTION,h!==void 0&&h>m){this.updateStageStatus(e.stage,null,!0);return}this.listener.successCallback(r,d),this.displayedIterator.add(d),g&&this.updateStageStatus(e.stage),EK(this.listener,e,d)},a).finally(()=>{if(!c&&i)rt.setPartialImage(r),this.addRequest(i,n.streamingData);else{c||this.listener.errorCallback(r,!0,"Couldn't decode"),this.outstandingRequests--;for(let d=i;d;d=d.next)this.updateStageStatus(d.stage,null,!0)}this.outstandingRequests<=0&&this.displayedIterator.resolve()}),s.getDonePromise().catch(d=>null)}addRequest(e,n={}){const{imageId:r,stage:i}=e,a=this.listener.getLoaderImageOptions(r);if(!a)return;const{retrieveType:o="default"}=i,{retrieveOptions:s}=this,c=s[o]||s.default,u={...a,retrieveType:o,retrieveOptions:c,streamingData:n},d=i.priority??-5,g=i.requestType||Nt.Interaction,h={imageId:r};ks.addRequest(this.sendRequest.bind(this,e,u),g,h,d)}updateStageStatus(e,n,r=!1){const{id:i}=e,a=this.stageStatusMap.get(i);if(a&&(a.imageLoadPendingCount--,n?a.imageLoadFailedCount++:r||a.totalImageCount++,!r&&!a.stageStartTime&&(a.stageStartTime=Date.now()),!a.imageLoadPendingCount)){const{imageLoadFailedCount:o,totalImageCount:s,stageStartTime:c=Date.now(),startTime:u}=a,d={stageId:i,numberOfFailures:o,numberOfImages:s,stageDurationInMS:c?Date.now()-c:null,startDurationInMS:Date.now()-u};je(Ye,We.IMAGE_RETRIEVAL_STAGE,d),this.stageStatusMap.delete(i)}}createStageRequests(){const e=new Array,n=new Map,r=(i,a)=>{const o=a<0?this.imageIds.length+a:a<1?Math.floor((this.imageIds.length-1)*a):a,s=this.imageIds[o];if(!s)throw new Error(`No value found to add to requests at ${a}`);const c={imageId:s,stage:i,index:o,nearbyRequests:this.findNearbyRequests(o,i)};this.addStageStatus(i);const u=n.get(s);u?u.next=c:e.push(c),n.set(s,c)};for(const i of this.stages)(i.positions||ID(this.imageIds,i.decimate||1,i.offset??0)).forEach(o=>{r(i,o)});return e}findNearbyRequests(e,n){const r=new Array;if(!n.nearbyFrames)return r;for(const i of n.nearbyFrames){const a=e+i.offset;a<0||a>=this.imageIds.length||r.push({itemId:this.imageIds[a],imageQualityStatus:i.imageQualityStatus,index:a})}return r}addStageStatus(e){const{id:n}=e,r=this.stageStatusMap.get(n)||{stageId:n,startTime:Date.now(),stageStartTime:null,totalImageCount:0,imageLoadFailedCount:0,imageLoadPendingCount:0};return r.imageLoadPendingCount++,this.stageStatusMap.set(n,r),r}}function AD(t){return new j2(t)}const _C=Nt.Prefetch;class OK extends bp{constructor(e,n){super(e),this.framesLoaded=0,this.framesProcessed=0,this.framesUpdated=0,this.autoRenderOnLoad=!0,this.cachedFrames=[],this.reRenderTarget=0,this.reRenderFraction=2,this.imagesLoader=this,this.cancelLoading=()=>{const{loadStatus:r}=this;if(!r||!r.loading)return;r.loading=!1,r.cancelled=!0,this.clearLoadCallbacks();const i=({additionalDetails:a})=>a.volumeId!==this.volumeId;ks.filterRequests(i)},this.loadStatus=n.loadStatus}invalidateVolume(e){const{vtkOpenGLTexture:n}=this,{numFrames:r}=this;for(let i=0;i<r;i++)n.setUpdatedFrame(i);this.modified(),e&&z4(this.volumeId)}clearLoadCallbacks(){this.loadStatus.callbacks=[]}callLoadStatusCallback(e){const{framesUpdated:n,framesProcessed:r,totalNumFrames:i}=e,{volumeId:a,reRenderFraction:o,loadStatus:s,metadata:c}=this,{FrameOfReferenceUID:u}=c;if(this.autoRenderOnLoad&&(n>this.reRenderTarget||r===i)&&(this.reRenderTarget+=o,z4(a)),r===i){s.callbacks.forEach(g=>g(e));const d={FrameOfReferenceUID:u,volumeId:a};je(Ye,We.IMAGE_VOLUME_LOADING_COMPLETED,d)}}updateTextureAndTriggerEvents(e,n,r=no.FULL_RESOLUTION){const i=this.imageIdIndexToFrameIndex(e),{cachedFrames:a,numFrames:o,totalNumFrames:s}=this,{FrameOfReferenceUID:c}=this.metadata;if(a[i]>r||a[i]===no.FULL_RESOLUTION)return;const d=r===no.FULL_RESOLUTION;a[e]=r,this.framesUpdated++,d&&(this.framesLoaded++,this.framesProcessed++);const g={FrameOfReferenceUID:c,volumeId:this.volumeId,numberOfFrames:o,framesProcessed:this.framesProcessed};je(Ye,We.IMAGE_VOLUME_MODIFIED,g),d&&this.framesProcessed===this.totalNumFrames&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!0,imageIdIndex:e,imageId:n,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:o,totalNumFrames:s,complete:d,imageQualityStatus:r}),this.vtkOpenGLTexture.setUpdatedFrame(i),this.loadStatus.loaded&&(this.loadStatus.callbacks=[])}successCallback(e,n){const r=this.getImageIdIndex(e),{imageQualityStatus:i}=n;if(this.loadStatus.cancelled){console.warn("volume load cancelled, returning for imageIdIndex: ",r);return}this.updateTextureAndTriggerEvents(r,e,i),this.isDynamicVolume()&&this.checkDimensionGroupCompletion(r)}errorCallback(e,n,r){if(!n)return;const{totalNumFrames:i,numFrames:a}=this,o=this.getImageIdIndex(e);this.framesProcessed++,this.framesProcessed===i&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!1,imageId:e,imageIdIndex:o,error:r,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:a,totalNumFrames:i}),this.loadStatus.loaded&&(this.loadStatus.callbacks=[]);const s={error:r,imageIdIndex:o,imageId:e};je(Ye,We.IMAGE_LOAD_ERROR,s)}load(e){const{imageIds:n,loadStatus:r,numFrames:i}=this,{transferSyntaxUID:a}=it("transferSyntax",n[0])||{},o=it(sf.IMAGE_RETRIEVE_CONFIGURATION,this.volumeId,a,"volume");if(this.imagesLoader=this.isDynamicVolume()?this:o?(o.create||j2.createProgressive)(o):this,r.loading===!0)return;const{loaded:s}=this.loadStatus,c=n.length;if(s){e&&e({success:!0,framesLoaded:c,framesProcessed:c,numFrames:i,totalNumFrames:c});return}e&&this.loadStatus.callbacks.push(e),this._prefetchImageIds()}getLoaderImageOptions(e){const{transferSyntaxUID:n}=it("transferSyntax",e)||{},r=it("imagePlaneModule",e)||{},{rows:i,columns:a}=r,o=this.getImageIdIndex(e),s=it("modalityLutModule",e)||{},c=it("generalSeriesModule",e)||{},u={rescaleSlope:s.rescaleSlope,rescaleIntercept:s.rescaleIntercept,modality:c.modality},d=u.modality;if(d==="PT"||d==="RTDOSE"){const y=it("scalingModule",e);y&&(this._addScalingToVolume(y),Object.assign(u,y))}const g=_8(u),h=wv();if(this.isPreScaled=!0,u&&u.rescaleSlope!==void 0&&u.rescaleIntercept!==void 0){const{rescaleSlope:y,rescaleIntercept:v}=u;this.isPreScaled=typeof y=="number"&&typeof v=="number"}return!h&&g&&(this.isPreScaled=!1),{targetBuffer:{type:this.dataType,rows:i,columns:a},allowFloatRendering:h,preScale:{enabled:this.isPreScaled,scalingParameters:u},transferPixelData:!0,requestType:_C,transferSyntaxUID:n,additionalDetails:{imageId:e,imageIdIndex:o,volumeId:this.volumeId},retrieveOptions:void 0}}callLoadImage(e,n,r){const{cachedFrames:i}=this;if(i[n]===no.FULL_RESOLUTION)return;const a=s=>{const{image:c}=s.detail;c.imageId===e&&(this.vtkOpenGLTexture.setUpdatedFrame(n),Ye.removeEventListener(We.IMAGE_CACHE_IMAGE_ADDED,a))};return Ye.addEventListener(We.IMAGE_CACHE_IMAGE_ADDED,a),H2.as(j0(e,r)).forEach(s=>{this.successCallback(e,s)},this.errorCallback.bind(this,n,e))}getImageIdsRequests(e,n){this.totalNumFrames=this.imageIds.length;const r=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(r/100),this.reRenderTarget=this.reRenderFraction),e.map(a=>{const o=this.getImageIdIndex(a),s=_C,c=n,u=this.getLoaderImageOptions(a),{retrieveOptions:d={}}=it(sf.IMAGE_RETRIEVE_CONFIGURATION,a,"volume")||{};return u.retrieveOptions={...u.retrieveOptions,...d.default||Object.values(d)?.[0]||{}},{callLoadImage:this.callLoadImage.bind(this),imageId:a,imageIdIndex:o,options:u,priority:c,requestType:s,additionalDetails:{volumeId:this.volumeId}}})}getImageLoadRequests(e){throw new Error("Abstract method")}getImageIdsToLoad(){throw new Error("Abstract method")}loadImages(){return this.loadStatus.loading=!0,this.getImageLoadRequests(5).reverse().forEach(n=>{if(!n)return;const{callLoadImage:r,imageId:i,imageIdIndex:a,options:o,priority:s,requestType:c,additionalDetails:u}=n;ks.addRequest(r.bind(this,i,a,o),c,u,s)}),Promise.resolve(!0)}_prefetchImageIds(){this.loadStatus.loading=!0;const e=[...this.getImageIdsToLoad()];this.totalNumFrames=this.imageIds.length;const n=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(n/100),this.reRenderTarget=this.reRenderFraction),this.imagesLoader.loadImages(e,this).catch(r=>{console.debug("progressive loading failed to complete",r)})}_addScalingToVolume(e){if(this.scaling)return;const{suvbw:n,suvlbm:r,suvbsa:i}=e,a={};r&&(a.suvbwToSuvlbm=r/n),i&&(a.suvbwToSuvbsa=i/n),n&&(a.suvbw=n),this.scaling={PT:a}}checkDimensionGroupCompletion(e){}}class DK extends OK{constructor(e,n){e.imageIds||(e.imageIds=n.imageIds),super(e,n),this.getImageIdsToLoad=()=>{const{imageIds:r}=this;return this.numFrames=r.length,r}}getScalarData(){return this.voxelManager.getScalarData()}getImageLoadRequests(e){const{imageIds:n}=this;return this.getImageIdsRequests(n,e)}}function _K(t,e){if(!e||!e.imageIds||!e.imageIds.length)throw new Error("ImageIds must be provided to create a streaming image volume");async function n(){if(e.imageIds[0].split(":")[0]==="wadouri"){const[y,v]=[Math.floor(e.imageIds.length/2),e.imageIds.length-1],C=[0,y,v];await Promise.all(C.map(S=>rt.isLoaded(e.imageIds[S])?Promise.resolve(!0):new Promise((w,x)=>{const R=e.imageIds[S];ks.addRequest(async()=>{vK(R).then(()=>{console.log(`Prefetched imageId: ${R}`),w(!0)}).catch(O=>{x(O)})},Nt.Prefetch,{volumeId:t},1)}))).catch(console.error)}const i=b8(e.imageIds,t),{dimensions:a,spacing:o,origin:s,direction:c,metadata:u,imageIds:d,dataType:g,numberOfComponents:h}=i;return new DK({volumeId:t,metadata:u,dimensions:a,spacing:o,origin:s,direction:c,imageIds:d,dataType:g,numberOfComponents:h},{imageIds:d,loadStatus:{loaded:!1,loading:!1,cancelled:!1,cachedFrames:[],callbacks:[]}})}const r=n();return{promise:r,decache:()=>{r.then(i=>{i.destroy(),i=null})},cancel:()=>{r.then(i=>{i.cancelLoading()})}}}const ND={};let a2=_K;function PD(t,e){const n=t.indexOf(":"),r=t.substring(0,n);let i=ND[r];if(i==null){if(a2==null||typeof a2!="function")throw new Error(`No volume loader for scheme ${r} has been registered`);i=a2}const a=i(t,e);return a.promise.then(function(o){je(Ye,We.VOLUME_LOADED,{volume:o})},function(o){const s={volumeId:t,error:o};je(Ye,We.VOLUME_LOADED_FAILED,s)}),a}function UD(t,e={imageIds:[]}){if(t===void 0)throw new Error("loadVolume: parameter volumeId must not be undefined");let n=rt.getVolumeLoadObject(t);return n!==void 0?n.promise:(n=PD(t,e),n.promise.then(r=>r))}async function FD(t,e){if(t===void 0)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let n=rt.getVolumeLoadObject(t);return n!==void 0||(n=PD(t,e),rt.putVolumeLoadObject(t,n)),n.promise}async function bK(t,e){if(e===void 0)throw new Error("createAndCacheVolumeFromImages: parameter imageIds must not be undefined");if(t===void 0)throw new Error("createAndCacheVolumeFromImages: parameter volumeId must not be undefined");const n=rt.getVolume(t);return n||(e.filter(a=>!rt.getImage(a)).length===0?MK(t,e):await FD(t,{imageIds:e}))}function MK(t,e){if(e===void 0)throw new Error("createAndCacheVolumeFromImagesSync: parameter imageIds must not be undefined");if(t===void 0)throw new Error("createAndCacheVolumeFromImagesSync: parameter volumeId must not be undefined");const n=rt.getVolume(t);if(n)return n;const r=b8(e,t),i=new bp({volumeId:t,dataType:r.dataType,metadata:structuredClone(r.metadata),dimensions:r.dimensions,spacing:r.spacing,origin:r.origin,direction:r.direction,referencedVolumeId:r.referencedVolumeId,imageIds:r.imageIds,referencedImageIds:r.referencedImageIds});return rt.putVolumeSync(t,i),i}function LK(t,e={}){const{metadata:n,dimensions:r,spacing:i,origin:a,direction:o,scalarData:s,targetBuffer:c,preventCache:u=!1}=e,d=rt.getVolume(t);if(d)return d;const g=r[0]*r[1],h=s?s.constructor.name:c?.type??"Float32Array",m=g*r[2];let y;switch(h){case"Uint8Array":case"Int8Array":y=m;break;case"Uint16Array":case"Int16Array":y=m*2;break;case"Float32Array":y=m*4;break}if(!rt.isCacheable(y))throw new Error(`Cannot created derived volume: Volume with id ${t} is not cacheable.`);const C=[];for(let x=0;x<r[2];x++){const R=`${t}_slice_${x}`;C.push(R);const O=s.subarray(x*g,(x+1)*g);yK(R,{scalarData:O,dimensions:[r[0],r[1]],spacing:[i[0],i[1]],origin:a,direction:o,targetBuffer:{type:h}})}const S=new bp({volumeId:t,metadata:structuredClone(n),dimensions:[r[0],r[1],r[2]],spacing:i,origin:a,direction:o,imageIds:C,dataType:h}),w=Fn.createImageVolumeVoxelManager({imageIds:C,dimensions:r,numberOfComponents:1,id:t});return S.voxelManager=w,u||rt.putVolumeSync(t,S),S}function VK(){return Object.keys(ND)}function IK(){return a2.name}function AK(t,e){const n=rK.newInstance();Xl().rendering.preferSizeOverAccuracy&&n.setPreferSizeOverAccuracy(!0),n.setInputData(t);const r=t.getSpacing(),i=(r[0]+r[1]+r[2])/6;return n.setMaximumSamplesPerRay(4e3),n.setSampleDistance(i),n.setScalarTexture(e),n}function NK(t){const e=wD.newInstance();e.setBlendMode(t.getBlendMode());const n=t.getInputData(),{voxelManager:r}=n.get("voxelManager"),i=r.getCompleteScalarDataArray(),a=Pt.newInstance({name:"Pixels",values:i});return n.getPointData().setScalars(a),e.setInputData(n),e.setMaximumSamplesPerRay(t.getMaximumSamplesPerRay()),e.setSampleDistance(t.getSampleDistance()),e}const PK=0,UK=Nt.Prefetch;async function L8(t,e){let n=kK(e);!n&&e.imageIds.length&&(n=await GK(e),n=FK(e,n)),!(n.lower===0&&n.upper===0||n.lower===void 0||n.upper===void 0)&&t.getProperty().getRGBTransferFunction(0).setMappingRange(n.lower,n.upper)}function FK(t,e){const n=t.imageIds,r=Math.floor(n.length/2),i=n[r],a=it("generalSeriesModule",i)||{};return BK(a.modality,t)?{lower:0,upper:5}:e}function kK(t){const{imageIds:e,metadata:n}=t;let r;if(e?.length){const i=Math.floor(e.length/2),a=e[i],o=it("voiLutModule",a);if(o&&o.windowWidth&&o.windowCenter){o?.voiLUTFunction&&(r={},r.voiLUTFunction=o?.voiLUTFunction);const{windowWidth:s,windowCenter:c}=o,u=Array.isArray(s)?s[0]:s,d=Array.isArray(c)?c[0]:c;u!==0&&(r={windowWidth:u,windowCenter:d})}}else r=n.voiLut[0];if(r&&(r.windowWidth!==0||r.windowCenter!==0)){const{lower:i,upper:a}=Qg(Number(r.windowWidth),Number(r.windowCenter),r.voiLUTFunction);return{lower:i,upper:a}}}async function GK(t){const{imageIds:e}=t,n=Math.floor(e.length/2),r=t.imageIds[n],i=it("generalSeriesModule",r)||{},{modality:a}=i,o=it("modalityLutModule",r)||{},s={rescaleSlope:o.rescaleSlope,rescaleIntercept:o.rescaleIntercept,modality:a};let c;if(a==="PT"){const m=it("scalingModule",r);m&&(c={...s,suvbw:m.suvbw})}const u={priority:PK,requestType:UK,preScale:{scalingParameters:c}};let d=rt.getImage(r);t.referencedImageIds?.length||(d=await j0(r,{...u,ignoreCache:!0}));let{min:g,max:h}=d.voxelManager.getMinMax();return g?.length>1&&(g=Math.min(...g),h=Math.max(...h)),{lower:g,upper:h}}function BK(t,e){return!(t!=="PT"||!e.isPreScaled||!e.scaling?.PT.suvbw)}async function H4(t,e,n,r=!1){const{volumeId:i,callback:a,blendMode:o}=t,s=await UD(i);if(!s)throw new Error(`imageVolume with id: ${s.volumeId} does not exist`);const{imageData:c,vtkOpenGLTexture:u}=s,d=AK(c,u);o&&d.setBlendMode(o);const g=jF.newInstance();g.setMapper(d);const{numberOfComponents:h}=c.get("numberOfComponents");return g.getProperty().set({viewportId:n},!0),h===3&&g.getProperty().setIndependentComponents(!1),await L8(g,s),a&&a({volumeActor:g,volumeId:i}),r||$K(e,n,g,i),g}function $K(t,e,n,r){const i=n.getProperty().getRGBTransferFunction(0).getRange(),a={viewportId:e,range:{lower:i[0],upper:i[1]},volumeId:r};je(t,We.VOI_MODIFIED,a)}function kD(t){const e=t.getMapper().getInputData(),n=e.extentToBounds(e.getExtent());return[[n[0],n[2],n[4]],[n[0],n[2],n[5]],[n[0],n[3],n[4]],[n[0],n[3],n[5]],[n[1],n[2],n[4]],[n[1],n[2],n[5]],[n[1],n[3],n[4]],[n[1],n[3],n[5]]]}const WK=Lo*Lo,V3=t=>Math.abs(Math.abs(t)-1)<WK,I3=(t,e)=>V3(t[e])||V3(t[e+1])||V3(t[e+2]),zK=t=>I3(t,0)&&I3(t,3)&&I3(t,6);function Lp(t,e,n){const r=t.getMapper().getInputData();let i;const a=r.getDirection();if(zK(a))i=kD(t);else{const[g,h,m]=r.getDimensions();i=[[0,0,0],[g-1,0,0],[0,h-1,0],[g-1,h-1,0],[0,0,m-1],[g-1,0,m-1],[0,h-1,m-1],[g-1,h-1,m-1]].map(v=>r.indexToWorld(v))}const o=Ml.buildFromDegree().identity().rotateFromDirections(e,[1,0,0]);i.forEach(g=>o.apply(g));const s=[...n];o.apply(s);const c=s[0];let u=1/0,d=-1/0;for(let g=0;g<8;g++){const h=i[g][0];h>d&&(d=h),h<u&&(u=h)}return{min:u,max:d,current:c,actor:t,viewPlaneNormal:e,focalPoint:n}}function W1(t,e){const{direction:n,spacing:r}=t,i=n.slice(0,3),a=n.slice(3,6),o=n.slice(6,9),s=[ft(i,e),ft(a,e),ft(o,e)],c=Ke();return gn(c,s[0]*r[0],s[1]*r[1],s[2]*r[2]),Gc(c)}const Ef=t=>{const e="volumeId:",n=t.includes(e)?t.substring(e.length):t,r=n.indexOf("sliceIndex=");return r===-1?n:n.substring(0,r-1)},HK=1+Lo,jK=(t,e)=>e===t.substring(0,Math.min(t.length,e.length)),bC=t=>!!VK().find(e=>jK(t.volumeId,e));function z1(t,e,n,r=!1){const{viewPlaneNormal:i}=e,a=t.getActors();if(!a.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const o=a.map(u=>{const d=u.referencedId??u.uid;return rt.getVolume(d)}).filter(u=>!!u);if(n){const u=Ef(n),d=o.findIndex(y=>u.includes(y.volumeId)),g=o[d],{uid:h}=a[d],m=MC(g,i,t,r);return{imageVolume:g,spacingInNormalDirection:m,actorUID:h}}if(!o.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const s={spacingInNormalDirection:1/0,imageVolume:null,actorUID:null},c=o.find(bC);for(let u=0;u<o.length;u++){const d=o[u];if(c&&!bC(d))continue;const g=MC(d,i,t);g*HK<s.spacingInNormalDirection&&(s.spacingInNormalDirection=g,s.imageVolume=d,s.actorUID=a[u].uid)}return s}function MC(t,e,n,r=!1){const{slabThickness:i}=n.getProperties();let a=i;return(!i||!r)&&(a=W1(t,e)),a}function q2(t){const e=t.getCamera(),{spacingInNormalDirection:n,imageVolume:r}=z1(t,e);if(!r)return;const{viewPlaneNormal:i,focalPoint:a}=e,o=t.getActors().find(y=>y.referencedId===r.volumeId||y.uid===r.volumeId);o||console.warn("No actor found for with actorUID of",r.volumeId);const s=o.actor,c=Lp(s,i,a),{min:u,max:d,current:g}=c,h=Math.round((d-u)/n)+1;let m=(g-u)/(d-u)*h;return m=Math.floor(m),m>h-1?m=h-1:m<0&&(m=0),{numberOfSlices:h,imageIndex:m}}const Bu={};function qK(t){Bu[t]!==void 0&&delete Bu[t]}function KK(t){const{renderingEngineId:e,viewportId:n}=t.detail,i=Yc(e).getViewport(n);if(!("setVolumes"in i))throw new Error("volumeNewImageEventDispatcher: viewport does not have setVolumes method");Bu[i.id]===void 0&&(Bu[i.id]=0);const a=q2(i);if(!a){console.warn(`volumeNewImageEventDispatcher: sliceData is undefined for viewport ${i.id}`);return}const{numberOfSlices:o,imageIndex:s}=a;if(Bu[i.id]===s)return;Bu[i.id]=s;const c={imageIndex:s,viewportId:n,renderingEngineId:e,numberOfSlices:o};je(i.element,We.VOLUME_NEW_IMAGE,c)}function GD(t,e,n){const[r,i,a]=t,[o,s,c]=e,[u,d,g,h]=n,m=o-r,y=s-i,v=c-a,C=-1*(u*r+d*i+g*a-h)/(u*m+d*y+g*v),S=m*C+r,w=y*C+i,x=v*C+a;return[S,w,x]}function BD(t,e,n=!1){const[r,i,a]=t,o=r*e[0]+i*e[1]+a*e[2];if(n){const s=Math.sqrt(r*r+i*i+a*a);return[r/s,i/s,a/s,o/s]}return[r,i,a,o]}function YK(t,e,n){const[r,i,a,o]=t,[s,c,u,d]=e,[g,h,m,y]=n,v=Ug(r,s,g,i,c,h,a,u,m),C=Ug(o,d,y,i,c,h,a,u,m),S=Ug(r,s,g,o,d,y,a,u,m),w=Ug(r,s,g,i,c,h,o,d,y),x=Tl(C)/Tl(v),R=Tl(S)/Tl(v),O=Tl(w)/Tl(v);return[x,R,O]}function V8(t,e,n=!1){const[r,i,a,o]=t,[s,c,u]=e,d=r*s+i*c+a*u-o,g=Math.abs(d)/Math.sqrt(r*r+i*i+a*a);return(n?Math.sign(d):1)*g}function XK(t,e,n=Lo){return V8(e,t)<n}const ZK=Object.freeze(Object.defineProperty({__proto__:null,isPointOnPlane:XK,linePlaneIntersection:GD,planeDistanceToPoint:V8,planeEquation:BD,threePlaneIntersection:YK},Symbol.toStringTag,{value:"Module"}));function j4(t){return Array.isArray(t)?t.some(e=>Number.isNaN(e)):Number.isNaN(t)}function es(t){if(t===null||typeof t!="object"||typeof t=="function"||typeof structuredClone=="function")return t;if(Array.isArray(t))return t.map(es);{const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=es(t[n]));return e}}const QK=.95;function $D(t,e){if(!t?.length||!e.FrameOfReferenceUID)return;e.planeRestriction||={FrameOfReferenceUID:e.FrameOfReferenceUID,point:t[0],inPlaneVector1:null,inPlaneVector2:null};const{planeRestriction:n}=e;if(t.length===1)return n.inPlaneVector1=null,n.inPlaneVector2=null,n;const r=hn(Ke(),t[0],t[Math.floor(t.length/2)]);Sn(r,r),n.inPlaneVector1=r,n.inPlaneVector2=null;const i=t.length;if(i>2)for(let a=Math.floor(i/3);a<i;a++){const o=hn(Ke(),t[a],t[0]),s=Gc(o);if(!Tn(s,0)&&ft(o,n.inPlaneVector1)<s*QK)return Sn(o,o),n.inPlaneVector2=o,n}return n}const u1=class u1{constructor(e){this.insetImageMultiplier=1.1,this.flipHorizontal=!1,this.flipVertical=!1,this.viewportStatus=qi.NO_DATA,this._suppressCameraModifiedEvents=!1,this.hasPixelSpacing=!0,this.getProperties=()=>({}),this.setRotation=n=>{},this.viewportWidgets=new Map,this.addWidget=(n,r)=>{this.viewportWidgets.set(n,r)},this.getWidget=n=>this.viewportWidgets.get(n),this.getWidgets=()=>Array.from(this.viewportWidgets.values()),this.removeWidgets=()=>{this.getWidgets().forEach(r=>{if(r.getEnabled()&&r.setEnabled(!1),r.getActor&&r.getRenderer){const i=r.getActor(),a=r.getRenderer();a&&i&&a.removeActor(i)}})},this.id=e.id,this.renderingEngineId=e.renderingEngineId,this.type=e.type,this.element=e.element,this.canvas=e.canvas,this.sx=e.sx,this.sy=e.sy,this.sWidth=e.sWidth,this.sHeight=e.sHeight,this._actors=new Map,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.defaultOptions=es(e.defaultOptions),this.suppressEvents=e.defaultOptions.suppressEvents?e.defaultOptions.suppressEvents:!1,this.options=es(e.defaultOptions),this.isDisabled=!1}static get useCustomRenderingPipeline(){return!1}setRendered(){this.viewportStatus===qi.NO_DATA||this.viewportStatus===qi.LOADING||(this.viewportStatus=qi.RENDERED)}setColorTransform(e,n){let r=null;if(!e&&!n)return;const i=n||[255,255,255],a=Math.max(...i),o=i.map(g=>a/g),{lower:s=0,upper:c=255}=e||{},u=(c-s+1)/255,d=s/255;return r=`url('data:image/svg+xml,      <svg xmlns="http://www.w3.org/2000/svg">        <filter id="colour" color-interpolation-filters="linearRGB">        <feColorMatrix type="matrix"         values="          ${o[0]*u} 0 0 0 ${d}           0 ${o[1]*u} 0 0 ${d}           0 0 ${o[2]*u} 0 ${d}           0 0 0 1 0" />        </filter>      </svg>#colour')`,r}getRenderingEngine(){return p1.get(this.renderingEngineId)}getRenderer(){const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return e.offscreenMultiRenderWindow?.getRenderer(this.id)}render(){this.getRenderingEngine().renderViewport(this.id)}setOptions(e,n=!1){this.options=structuredClone(e),this.options?.displayArea&&this.setDisplayArea(this.options?.displayArea),n&&this.render()}reset(e=!1){this.options=structuredClone(this.defaultOptions),e&&this.render()}getSliceViewInfo(){throw new Error("Method not implemented.")}flip({flipHorizontal:e,flipVertical:n}){const r=this.getDefaultImageData();if(!r)return;const i=this.getCamera(),{viewPlaneNormal:a,viewUp:o,focalPoint:s,position:c}=i,u=Cn(Ke(),a,o);let d=YU(Ke(),o);const g=Bc(Ke(),a),h=y1(c,s),y=r.getDimensions().map(O=>Math.floor(O/2)),v=[y[0],y[1],y[2]],C=r.indexToWorld(v,Ke()),S=this._getFocalPointForResetCamera(C,i,{resetPan:!0,resetToCenter:!1}),w=ei(Ke(),s,S),x=Gc(w),R=O=>{const b=bs(Ke(),O,2*ft(w,O));return ei(b,b,w),Sn(b,b),b};if(e){const O=R(d),b=Si(Ke(),S,O,x),I=Si(Ke(),b,g,h);this.setCamera({viewPlaneNormal:g,position:I,focalPoint:b}),this.flipHorizontal=!this.flipHorizontal}if(n){d=Bc(d,o);const O=R(u),b=Si(Ke(),S,O,x),I=Si(Ke(),b,g,h);this.setCamera({focalPoint:b,viewPlaneNormal:g,viewUp:d,position:I}),this.flipVertical=!this.flipVertical}this.render()}getDefaultImageData(){const e=this.getDefaultActor();if(e&&Jo(e))return e.actor.getMapper().getInputData()}getDefaultActor(){return this.getActors()[0]}getActors(){return Array.from(this._actors.values())}getActorUIDs(){return Array.from(this._actors.keys())}getActor(e){return this._actors.get(e)}getImageActor(e){const n=this.getActors();let r=n[0];return e&&(r=n.find(a=>a.referencedId===e)),!r||!Jo(r)?null:r.actor}getActorUIDByIndex(e){const n=this.getActors()[e];if(n)return n.uid}getActorByIndex(e){return this.getActors()[e]}setActors(e){const n=this.getActors();this.removeAllActors(),this.addActors(e,{resetCamera:!0}),je(this.element,We.ACTORS_CHANGED,{viewportId:this.id,removedActors:n,addedActors:e,currentActors:e})}_removeActor(e){const n=this.getActor(e);if(!n){console.warn(`Actor ${e} does not exist in ${this.id}, can't remove`);return}return this.getRenderer().removeActor(n.actor),this._actors.delete(e),n}removeActors(e){const n=[];e.forEach(i=>{const a=this._removeActor(i);a&&n.push(a)});const r=this.getActors();je(this.element,We.ACTORS_CHANGED,{viewportId:this.id,removedActors:n,addedActors:[],currentActors:r})}addActors(e,n={}){const{resetCamera:r=!1}=n,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn("Viewport::addActors::Rendering engine has not been initialized or has been destroyed");return}e.forEach(s=>{this.addActor(s)});const a=this.getViewPresentation(),o=this.getViewReference();this.resetCamera(),r||(this.setViewReference(o),this.setViewPresentation(a)),je(this.element,We.ACTORS_CHANGED,{viewportId:this.id,removedActors:[],addedActors:e,currentActors:this.getActors()})}addActor(e){const{uid:n,actor:r}=e,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn(`Cannot add actor UID of ${n} Rendering Engine has been destroyed`);return}if(!n||!r)throw new Error("Actors should have uid and vtk Actor properties");if(this.getActor(n)){console.warn(`Actor ${n} already exists for this viewport`);return}this.getRenderer()?.addActor(r),this._actors.set(n,Object.assign({},e)),this.updateCameraClippingPlanesAndRange(),je(this.element,We.ACTORS_CHANGED,{viewportId:this.id,removedActors:[],addedActors:[e],currentActors:this.getActors()})}removeAllActors(){const e=this.getActors();this.getRenderer()?.removeAllViewProps(),this._actors=new Map,je(this.element,We.ACTORS_CHANGED,{viewportId:this.id,removedActors:e,addedActors:[],currentActors:[]})}resetCameraNoEvent(){const e=this._suppressCameraModifiedEvents;this._suppressCameraModifiedEvents=!0,this.resetCamera(),this._suppressCameraModifiedEvents=e}setCameraNoEvent(e){const n=this._suppressCameraModifiedEvents;this._suppressCameraModifiedEvents=!0,this.setCamera(e),this._suppressCameraModifiedEvents=n}_getViewImageDataIntersections(e,n,r){const i=r[0],a=r[1],o=r[2],s=i*n[0]+a*n[1]+o*n[2],c=e.getBounds(),u=this._getEdges(c),d=[];for(const g of u){const[[h,m,y],[v,C,S]]=g;if(i*(v-h)+a*(C-m)+o*(S-y)===0)continue;const w=GD([h,m,y],[v,C,S],[i,a,o,s]);this._isInBounds(w,c)&&d.push(w)}return d}setInterpolationType(e,n){}setDisplayArea(e,n=!1){if(!e)return;const{storeAsInitialCamera:r,type:i}=e;r&&(this.options.displayArea=e);const{_suppressCameraModifiedEvents:a}=this;if(this._suppressCameraModifiedEvents=!0,this.setCamera(this.fitToCanvasCamera),i==="SCALE"?this.setDisplayAreaScale(e):(this.setInterpolationType(this.getProperties()?.interpolationType??Nc.LINEAR),this.setDisplayAreaFit(e)),r&&(this.initialCamera=this.getCamera()),this._suppressCameraModifiedEvents=a,!n&&!a){const o={viewportId:this.id,displayArea:e,storeAsInitialCamera:r};je(this.element,We.DISPLAY_AREA_MODIFIED,o),this.setCamera(this.getCamera())}}setDisplayAreaScale(e){const{scale:n=1}=e,r=this.canvas,i=r.height,a=r.width;if(i<8||a<8)return;const c=this.getDefaultImageData().getSpacing()[1];this.setInterpolationType(Nc.NEAREST),this.setCamera({parallelScale:i*c/(2*n)}),delete e.imageArea,this.setDisplayAreaFit(e);const{focalPoint:u,position:d,viewUp:g,viewPlaneNormal:h}=this.getCamera(),m=Ke();if(r.height%2&&Si(m,m,g,n*.5*c),r.width%2){const y=Cn(Ke(),g,h);Si(m,m,y,n*.5*c)}!m[0]&&!m[1]&&!m[2]||this.setCamera({focalPoint:z0(Ke(),u,m),position:z0(Ke(),d,m)})}setDisplayAreaFit(e){const{imageArea:n,imageCanvasPoint:r}=e,i=window?.devicePixelRatio||1,a=this.getDefaultImageData();if(!a)return;const o=this.sWidth/i,s=this.sHeight/i,c=a.getDimensions(),u=this.worldToCanvas(a.indexToWorld([0,0,0])),d=this.worldToCanvas(a.indexToWorld([c[0],c[1],c[2]])),g=[Math.abs(d[0]-u[0]),Math.abs(d[1]-u[1])],[h,m]=g;let y=this.getZoom()/this.insetImageMultiplier;if(n){const[v,C]=n,S=Math.max(Math.abs(h/o),Math.abs(m/s)),w=Math.abs(v*h/o),x=Math.abs(C*m/s),R=this.getZoom(),O=this.getZoom(this.fitToCanvasCamera);y=(w>x?S/w:S/x)*R/O,this.setZoom(this.insetImageMultiplier*y,!1)}if(r){const{imagePoint:v,canvasPoint:C=v||[.5,.5]}=r,[S,w]=C,x=o*(S-.5),R=s*(w-.5),[O,b]=v||C,I=y,G=this.insetImageMultiplier*I*h*(.5-O),j=this.insetImageMultiplier*I*m*(.5-b),F=G+x,$=j+R,z=[F,$];Zv(z,z,this.getPan()),this.setPan(z,!1)}}getDisplayArea(){return this.options?.displayArea}resetCamera(e){const{resetPan:n=!0,resetZoom:r=!0,resetToCenter:i=!0,storeAsInitialCamera:a=!0}=e||{},o=this.getRenderer();this.setCameraNoEvent({flipHorizontal:!1,flipVertical:!1});const s=this.getCamera();let c;const u=this.getDefaultActor();u&&Jo(u)?c=u.actor.getMapper().getInputData().getBounds():c=o.computeVisiblePropBounds();const d=[0,0,0],g=this.getDefaultImageData();if(g){const Q=g.getSpacing();c[0]=c[0]+Q[0]/2,c[1]=c[1]-Q[0]/2,c[2]=c[2]+Q[1]/2,c[3]=c[3]-Q[1]/2,c[4]=c[4]+Q[2]/2,c[5]=c[5]-Q[2]/2}const h=this.getVtkActiveCamera(),m=h.getViewPlaneNormal(),y=h.getViewUp();if(d[0]=(c[0]+c[1])/2,d[1]=(c[2]+c[3])/2,d[2]=(c[4]+c[5])/2,g){const le=g.getDimensions().map(ie=>Math.floor(ie/2)),X=[le[0],le[1],le[2]];g.indexToWorld(X,d)}const{widthWorld:v,heightWorld:C}=this._getWorldDistanceViewUpAndViewRight(c,y,m),S=[this.sWidth,this.sHeight],w=v/C,x=S[0]/S[1],R=w/x,O=R<1?this.insetImageMultiplier*C/2:this.insetImageMultiplier*C*R/2,b=u1.boundsRadius(c)*(this.type===yn.VOLUME_3D?10:1),I=this.insetImageMultiplier*b,G=Math.abs(_o.dot(y,m))>.999?[-y[2],y[0],y[1]]:y,j=this._getFocalPointForResetCamera(d,s,{resetPan:n,resetToCenter:i}),F=[j[0]+I*m[0],j[1]+I*m[1],j[2]+I*m[2]];o.resetCameraClippingRange(c);const $=[-fr.MAXIMUM_RAY_DISTANCE,fr.MAXIMUM_RAY_DISTANCE];h.setPhysicalScale(b),h.setPhysicalTranslation(-j[0],-j[1],-j[2]),this.setCamera({parallelScale:r?O:s.parallelScale,focalPoint:j,position:F,viewAngle:90,viewUp:G,clippingRange:$});const z=this.getCamera();this.setFitToCanvasCamera(this.getCamera()),a&&this.setInitialCamera(z),r&&this.setZoom(1,a);const oe={type:"ResetCameraEvent",renderer:o};return o.invokeEvent(oe),this.triggerCameraModifiedEventIfNecessary(s,z),g&&this.options.displayArea&&r&&n&&i&&this.setDisplayArea(this.options.displayArea),!0}setInitialCamera(e){this.initialCamera=e}setFitToCanvasCamera(e){this.fitToCanvasCamera=e}getPan(e=this.initialCamera){if(!e)return[0,0];const r=this.getVtkActiveCamera().getFocalPoint(),i=this.canvasToWorld([0,0]),a=this.worldToCanvas(ei([0,0,0],e.focalPoint,i)),o=this.worldToCanvas(ei([0,0,0],r,i));return Ni([0,0],a,o)}getCurrentImageIdIndex(){throw new Error("Not implemented")}getSliceIndex(){throw new Error("Not implemented")}getImageData(){throw new Error("Not implemented")}getViewReferenceId(e){return null}setPan(e,n=!1){const r=this.getCamera(),{focalPoint:i,position:a}=r,o=this.canvasToWorld([0,0]),s=Ni([0,0],e,this.getPan());if(Math.abs(s[0])<1&&Math.abs(s[1])<1&&!n)return;const c=ei(Ke(),this.canvasToWorld(s),o),u=ei(Ke(),i,c),d=ei(Ke(),a,c);this.setCamera({...r,focalPoint:u,position:d},n)}getZoom(e=this.initialCamera){if(!e)return 1;const n=this.getVtkActiveCamera(),{parallelScale:r}=e;return r/n.getParallelScale()}setZoom(e,n=!1){const r=this.getCamera(),{parallelScale:i}=this.initialCamera,a=i/e;r.parallelScale===a&&!n||this.setCamera({...r,parallelScale:a},n)}_getFocalPointForViewPlaneReset(e){const{focalPoint:n,viewPlaneNormal:r}=this.getCamera(),i=this._getViewImageDataIntersections(e,n,r);let a=0,o=0,s=0;return i.forEach(([u,d,g])=>{a+=u,o+=d,s+=g}),[a/i.length,o/i.length,s/i.length]}getCanvas(){return this.canvas}getVtkActiveCamera(){const e=this.getRenderer();return e?e.getActiveCamera():(console.warn("No renderer found for the viewport"),null)}getCameraNoRotation(){const e=this.getVtkActiveCamera(),n=(s,c)=>s.some(u=>isNaN(u))?c:s,r=n([...e.getViewUp()],[0,1,0]),i=n([...e.getViewPlaneNormal()],[0,0,-1]),a=n([...e.getPosition()],[0,0,1]),o=n([...e.getFocalPoint()],[0,0,0]);return{viewUp:r,viewPlaneNormal:i,position:a,focalPoint:o,parallelProjection:e.getParallelProjection(),parallelScale:e.getParallelScale(),viewAngle:e.getViewAngle(),flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}getCamera(){return{...this.getCameraNoRotation(),rotation:this.getRotation()}}setCamera(e,n=!1){const r=this.getVtkActiveCamera(),i=this.getCamera(),a=Object.assign({},i,e),{viewUp:o,viewPlaneNormal:s,position:c,focalPoint:u,parallelScale:d,viewAngle:g,flipHorizontal:h,flipVertical:m,clippingRange:y}=e;if(h!==void 0){const S=h&&!this.flipHorizontal||!h&&this.flipHorizontal;S&&this.flip({flipHorizontal:S})}if(m!==void 0){const S=m&&!this.flipVertical||!m&&this.flipVertical;S&&this.flip({flipVertical:S})}o!==void 0&&r.setViewUp(o),s!==void 0&&r.setDirectionOfProjection(-s[0],-s[1],-s[2]),c!==void 0&&r.setPosition(...c),u!==void 0&&r.setFocalPoint(...u),d!==void 0&&r.setParallelScale(d),g!==void 0&&r.setViewAngle(g),y!==void 0&&r.setClippingRange(y);const v=i.focalPoint,C=i.viewUp;if(v&&u||C&&o){const S=r.getViewPlaneNormal(),w=r.getViewUp();let x=!1,R=!1;if(u){const O=[u[0]-v[0],u[1]-v[1],u[2]-v[2]];x=Math.abs(_o.dot(O,S))>0}if(o&&(R=!Tn(w,C)),x||R){const O=this.getDefaultActor();if(!O?.actor)return;Aa(O,"vtkActor")||this.updateClippingPlanesForActors(a),(Aa(O,"vtkImageSlice")||this.type===yn.VOLUME_3D)&&this.getRenderer().resetCameraClippingRange()}}n&&this.setInitialCamera(a),this.triggerCameraModifiedEventIfNecessary(i,this.getCamera())}triggerCameraModifiedEventIfNecessary(e,n){if(!this._suppressCameraModifiedEvents&&!this.suppressEvents){const r={previousCamera:e,camera:n,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};je(this.element,We.CAMERA_MODIFIED,r)}}updateCameraClippingPlanesAndRange(){const e=this.getCamera();this.updateClippingPlanesForActors(e),this.getRenderer().resetCameraClippingRange()}async updateClippingPlanesForActors(e){this.getActors().map(r=>{if(!r.actor)return;const i=r.actor.getMapper();let a=r?.clippingFilter?r?.clippingFilter.getClippingPlanes():i.getClippingPlanes();a.length===0&&r?.clippingFilter&&(a=[Ki.newInstance(),Ki.newInstance()]);let o=fr.MINIMUM_SLAB_THICKNESS;r.slabThickness&&(o=r.slabThickness);const{viewPlaneNormal:s,focalPoint:c}=e;this.setOrientationOfClippingPlanes(a,o,s,c),je(this.element,We.CLIPPING_PLANES_UPDATED,{actorEntry:r,focalPoint:c,vtkPlanes:a,viewport:this})})}setOrientationOfClippingPlanes(e,n,r,i){if(e.length<2)return;const a=[r[0],r[1],r[2]];_o.multiplyScalar(a,n),e[0].setNormal(r);const o=[0,0,0];_o.subtract(i,a,o),e[0].setOrigin(o),e[1].setNormal(-r[0],-r[1],-r[2]);const s=[0,0,0];_o.add(i,a,s),e[1].setOrigin(s)}getClippingPlanesForActor(e){if(e||(e=this.getDefaultActor()),!e.actor)throw new Error("Invalid actor entry: Actor is undefined");const n=e.actor.getMapper();let r=e?.clippingFilter?e?.clippingFilter.getClippingPlanes():n.getClippingPlanes();return r.length===0&&e?.clippingFilter&&(r=[Ki.newInstance(),Ki.newInstance()]),r}_getWorldDistanceViewUpAndViewRight(e,n,r){const i=this._getCorners(e),a=this._getCorners(e),o=Cn(Ke(),n,r);let s=Ml.buildFromDegree().identity().rotateFromDirections(n,[1,0,0]);i.forEach(h=>s.apply(h));let c=1/0,u=-1/0;for(let h=0;h<8;h++){const m=i[h][0];m>u&&(u=m),m<c&&(c=m)}s=Ml.buildFromDegree().identity().rotateFromDirections([o[0],o[1],o[2]],[1,0,0]),a.forEach(h=>s.apply(h));let d=1/0,g=-1/0;for(let h=0;h<8;h++){const m=a[h][0];m>g&&(g=m),m<d&&(d=m)}return{widthWorld:g-d,heightWorld:u-c}}getViewReference(e){const{focalPoint:n,viewPlaneNormal:r,viewUp:i}=this.getCamera(),a=this.getFrameOfReferenceUID(),o={FrameOfReferenceUID:a,cameraFocalPoint:n,viewPlaneNormal:r,viewUp:i,sliceIndex:e?.sliceIndex??this.getSliceIndex(),planeRestriction:{FrameOfReferenceUID:a,point:e?.points?.[0]||n,inPlaneVector1:i,inPlaneVector2:Cn(Ke(),i,r)}};return e?.points&&$D(e.points,o.planeRestriction),o}isPlaneViewable(e,n){if(e.FrameOfReferenceUID!==this.getFrameOfReferenceUID())return!1;const{focalPoint:r,viewPlaneNormal:i}=this.getCamera(),{point:a,inPlaneVector1:o,inPlaneVector2:s}=e;if(n?.withOrientation)return!0;if(o&&!Tn(0,ft(i,o))||s&&!Tn(0,ft(i,s)))return!1;if(n?.withNavigation)return!0;const c=hn(Ke(),a,r);return Tn(0,ft(c,i))}isReferenceViewable(e,n){if(e.planeRestriction)return this.isPlaneViewable(e.planeRestriction,n);if(e.FrameOfReferenceUID&&e.FrameOfReferenceUID!==this.getFrameOfReferenceUID())return!1;const{viewPlaneNormal:r}=e,i=this.getCamera();return r&&!Tn(r,i.viewPlaneNormal)&&!Tn(Bc(i.viewPlaneNormal,i.viewPlaneNormal),r)?n?.withOrientation:!0}getViewPresentation(e={rotation:!0,displayArea:!0,zoom:!0,pan:!0,flipHorizontal:!0,flipVertical:!0}){const n={},{rotation:r,displayArea:i,zoom:a,pan:o,flipHorizontal:s,flipVertical:c}=e;r&&(n.rotation=this.getRotation()),i&&(n.displayArea=this.getDisplayArea());const u=this.getZoom();return a&&(n.zoom=u),o&&(n.pan=this.getPan(),PT(n.pan,n.pan,1/u)),s&&(n.flipHorizontal=this.flipHorizontal),c&&(n.flipVertical=this.flipVertical),n}setViewReference(e){}setViewPresentation(e){if(!e)return;const{displayArea:n,zoom:r=this.getZoom(),pan:i,rotation:a,flipHorizontal:o=this.flipHorizontal,flipVertical:s=this.flipVertical}=e;n!==this.getDisplayArea()&&this.setDisplayArea(n),this.setZoom(r),i&&this.setPan(PT([0,0],i,r)),o!==void 0&&o!==this.flipHorizontal&&this.flip({flipHorizontal:o}),s!==void 0&&s!==this.flipVertical&&this.flip({flipVertical:s}),a>=0&&this.setRotation(a)}_getCorners(e){return[[e[0],e[2],e[4]],[e[0],e[2],e[5]],[e[0],e[3],e[4]],[e[0],e[3],e[5]],[e[1],e[2],e[4]],[e[1],e[2],e[5]],[e[1],e[3],e[4]],[e[1],e[3],e[5]]]}_getFocalPointForResetCamera(e,n,{resetPan:r=!0,resetToCenter:i=!0}){if(i&&r)return e;if(i&&!r)return j4(n.focalPoint)?e:n.focalPoint;if(!i&&r){const a=n,o=a.focalPoint,s=a.viewPlaneNormal,c=ei(Ke(),e,o),u=ft(c,s),d=Si(Ke(),e,s,-1*u);return[d[0],d[1],d[2]]}if(!r&&!i)return j4(n.focalPoint)?e:n.focalPoint}_isInBounds(e,n){const[r,i,a,o,s,c]=n,[u,d,g]=e;return!(u<r||u>i||d<a||d>o||g<s||g>c)}_getEdges(e){const[n,r,i,a,o,s,c,u]=this._getCorners(e);return[[n,r],[n,o],[n,i],[r,a],[r,s],[i,a],[i,c],[a,u],[o,c],[o,s],[s,u],[c,u]]}static boundsRadius(e){const n=(e[1]-e[0])**2,r=(e[3]-e[2])**2,i=(e[5]-e[4])**2;return Math.sqrt(n+r+i||1)*.5}setDataIds(e,n){throw new Error("Unsupported operatoin setDataIds")}};u1.CameraViewPresentation={rotation:!0,pan:!0,zoom:!0,displayArea:!0},u1.TransferViewPresentation={windowLevel:!0,paletteLut:!0};let cf=u1;function WD(t,e,n=!1){const r=t.getCamera(),{focalPoint:i,viewPlaneNormal:a}=r,{spacingInNormalDirection:o,actorUID:s}=z1(t,r,e,n);if(!s)throw new Error(`Could not find image volume with id ${e} in the viewport`);const c=t.getActor(s);if(!c)return console.warn("No actor found for with actorUID of",s),null;const u=c.actor;return{sliceRange:Lp(u,a,i),spacingInNormalDirection:o,camera:r}}function Xu(t,e,n=!1){const{sliceRange:r,spacingInNormalDirection:i,camera:a}=WD(t,e,n),{min:o,max:s,current:c}=r,u=Math.round((s-o)/i),g=(c-o)/(s-o)*u,h=Math.round(g);return{numScrollSteps:u,currentStepIndex:h,sliceRangeInfo:{sliceRange:r,spacingInNormalDirection:i,camera:a}}}function Zu(t,e,n,r,i,a){const{min:o,max:s,current:c}=n,u=Ke();hn(u,e,t);const d=Math.round((s-o)/i),h=(c-o)/(s-o)*d;let m=Math.round(h),y=[t[0]-r[0]*h*i,t[1]-r[1]*h*i,t[2]-r[2]*h*i];m+=a,m>d?m=d:m<0&&(m=0);const v=m*i;y=[y[0]+r[0]*v,y[1]+r[1]*v,y[2]+r[2]*v];const C=[y[0]+u[0],y[1]+u[1],y[2]+u[2]];return{newFocalPoint:y,newPosition:C}}function zD(t){let e=[];const[n,r]=t.getRange();t.getTable(n,r,1024,e),e=e.filter((m,y)=>y%3===0);const i=[...Array(1024).keys()].map((m,y)=>n+(r-n)/1023*y),a=e[256],o=Math.log((1-a)/a),s=i[256],c=e[256*3],u=Math.log((1-c)/c),d=i[256*3],g=Math.round(4*(d-s)/(o-u)),h=Math.round(s+g*o/4);return[Math.round(h-g/2),Math.round(h+g/2)]}function HD(t,e){const n=e.colorTransfer.split(" ").splice(1).map(parseFloat),{shiftRange:r}=JK(n),i=r[0],a=r[1]-r[0],o=Xc.newInstance(),s=[];for(let R=0;R<n.length;R+=4){let O=n[R];const b=n[R+1],I=n[R+2],G=n[R+3];O=(O-i)/a,s.push([O,b,I,G])}eY(s,r,o),t.getProperty().setRGBTransferFunction(0,o);const c=e.scalarOpacity.split(" ").splice(1).map(parseFloat),u=Gl.newInstance(),d=[];for(let R=0;R<c.length;R+=2){let O=c[R];const b=c[R+1];O=(O-i)/a,d.push([O,b])}tY(d,r,u);const g=t.getProperty();g.setScalarOpacity(0,u);const[h,m,y,v]=e.gradientOpacity.split(" ").splice(1).map(parseFloat);g.setUseGradientOpacity(0,!0),g.setGradientOpacityMinimumValue(0,h),g.setGradientOpacityMinimumOpacity(0,m),g.setGradientOpacityMaximumValue(0,y),g.setGradientOpacityMaximumOpacity(0,v),e.interpolation==="1"&&g.setInterpolationTypeToFastLinear(),g.setShade(e.shade==="1");const C=parseFloat(e.ambient),S=parseFloat(e.diffuse),w=parseFloat(e.specular),x=parseFloat(e.specularPower);g.setAmbient(C),g.setDiffuse(S),g.setSpecular(w),g.setSpecularPower(x)}function JK(t){let e=1/0,n=-1/0;for(let i=0;i<t.length;i+=4)e=Math.min(e,t[i]),n=Math.max(n,t[i]);const r=(n-e)/2;return{shiftRange:[-r,r],min:e,max:n}}function eY(t,e,n){const r=e[1]-e[0],i=t.map(([a,o,s,c])=>[a*r+e[0],o,s,c]);return n.removeAllPoints(),i.forEach(([a,o,s,c])=>n.addRGBPoint(a,o,s,c)),i}function tY(t,e,n){const r=e[1]-e[0],i=t.map(([a,o])=>[a*r+e[0],o]);return n.removeAllPoints(),i.forEach(([a,o])=>n.addPoint(a,o)),i}const{MPR_CAMERA_VALUES:Ja}=Tv,{OrientationAxis:Mc}=zs;function jD(t,e,n,r){let i;switch(r){case Mc.AXIAL:case Mc.AXIAL_REFORMAT:i=Ja.axial;break;case Mc.SAGITTAL:case Mc.SAGITTAL_REFORMAT:i=Ja.sagittal;break;case Mc.CORONAL:case Mc.CORONAL_REFORMAT:i=Ja.coronal;break;default:i=Ja.axial;break}const a=Sn(Ke(),t),o=Sn(Ke(),e),s=Sn(Ke(),n),c=[a,o,s],u=[on(i.viewRight[0],i.viewRight[1],i.viewRight[2]),on(i.viewUp[0],i.viewUp[1],i.viewUp[2]),on(i.viewPlaneNormal[0],i.viewPlaneNormal[1],i.viewPlaneNormal[2])],d=new Set,g=v=>{let C=0,S=-2,w=!1;c.forEach((R,O)=>{if(d.has(O))return;const b=ft(v,R),I=Math.abs(b);I>S&&(S=I,C=O,w=b<0)}),d.add(C);const x=CE(c[C]);return w&&Bc(x,x),x},h=g(u[0]),m=g(u[1]),y=g(u[2]);return{viewPlaneNormal:[y[0],y[1],y[2]],viewUp:[m[0],m[1],m[2]],viewRight:[h[0],h[1],h[2]]}}function qD(t,e){if(!t.getActors()?.length)return;t.type!==yn.ORTHOGRAPHIC&&console.warn("Viewport should be a volume viewport");let n=t.getCurrentImageId();if(n||(n=t.getImageIds()?.[0]),!n)return;const{imageOrientationPatient:r}=it("imagePlaneModule",n),i=on(r[0],r[1],r[2]),a=on(r[3],r[4],r[5]),o=Cn(Ke(),i,a);let{orientation:s}=e||{};const{useViewportNormal:c}=e||{};let u=o;return c&&(u=t.getCamera().viewPlaneNormal),s||(s=nY(u)),jD(i,a,o,s)}function nY(t){const e=Sn(Ke(),t),n=on(Ja.axial.viewPlaneNormal[0],Ja.axial.viewPlaneNormal[1],Ja.axial.viewPlaneNormal[2]),r=on(Ja.sagittal.viewPlaneNormal[0],Ja.sagittal.viewPlaneNormal[1],Ja.sagittal.viewPlaneNormal[2]),i=on(Ja.coronal.viewPlaneNormal[0],Ja.coronal.viewPlaneNormal[1],Ja.coronal.viewPlaneNormal[2]),a=Math.abs(ft(e,n)),o=Math.abs(ft(e,r)),s=Math.abs(ft(e,i));return a>=o&&a>=s?Mc.AXIAL:o>=s?Mc.SAGITTAL:Mc.CORONAL}function KD(){return Xl()?.rendering?.renderingEngineMode===Ul.ContextPool}class Vo extends cf{constructor(e){if(super(e),this.useCPURendering=!1,this.perVolumeIdDefaultProperties=new Map,this.viewportProperties={},this.volumeIds=new Set,this.setRotation=i=>{const a=this.getPan(this.fitToCanvasCamera),o=this.getPan(),s=this.getCamera(),c=N2([0,0],a,o);this.setPan(c,!1);const{flipVertical:u}=this.getCamera(),d=u?Bc([0,0,0],this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:d}),this.rotateCamera(i);const g=this.getPan(),h=this.getPan(this.fitToCanvasCamera),m=N2([0,0],g,h),y=Zv([0,0],a,m);if(this.setPan(y,!1),this._suppressCameraModifiedEvents)return;const v=this.getCamera(),C={previousCamera:s,camera:v,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};je(this.element,We.CAMERA_MODIFIED,C)},this.getDefaultProperties=i=>{let a;return i!==void 0&&(a=this.perVolumeIdDefaultProperties.get(i)),a!==void 0?a:{...this.globalDefaultProperties}},this.getProperties=i=>{if(!this._getApplicableVolumeActor(i))return;const{colormap:o,VOILUTFunction:s,interpolationType:c,invert:u,slabThickness:d,preset:g}=this.viewportProperties;if(i||=this.getVolumeId(),!rt.getVolume(i))return null;const m=this.getActors().find(O=>O.referencedId===i);if(!m)return;const v=m.actor.getProperty().getRGBTransferFunction(0),[C,S]=this.viewportProperties?.VOILUTFunction==="SIGMOID"?zD(v):v.getRange(),w={lower:C,upper:S},x=this.getColormap(i);return{colormap:i&&x?x:o,voiRange:w,VOILUTFunction:s,interpolationType:c,invert:u,slabThickness:d,preset:g}},this.getColormap=i=>{const a=this._getApplicableVolumeActor(i);if(!a)return;const{volumeActor:o}=a,s=this._getOrCreateColorTransferFunction(i),{nodes:c}=s.getState(),u=c.reduce((m,y)=>(m.push(y.x,y.r,y.g,y.b),m),[]),d=e8(u,o)||{},g=n8(o),h=r8(o);return d.threshold=g,d.opacity=h,d},this.getRotation=()=>{const{viewUp:i,viewPlaneNormal:a,flipVertical:o}=this.getCameraNoRotation(),s=o?Bc([0,0,0],this.initialViewUp):this.initialViewUp;if(!s)return 0;const c=wE(s,i)*180/Math.PI,u=Cn([0,0,0],s,i);return ft(u,a)>=0?c:(360-c)%360},this.getFrameOfReferenceUID=()=>this._FrameOfReferenceUID,this.canvasToWorldTiled=i=>{const a=this.getVtkActiveCamera();a.setIsPerformingCoordinateTransformation?.(!0);const o=this.getRenderer(),s=this.getVtkDisplayCoordsTiled(i),d=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow().displayToWorld(s[0],s[1],s[2],o);return a.setIsPerformingCoordinateTransformation?.(!1),[d[0],d[1],d[2]]},this.canvasToWorldContextPool=i=>{const a=this.getVtkActiveCamera();a.setIsPerformingCoordinateTransformation?.(!0);const o=this.getRenderer(),s=window.devicePixelRatio||1,{width:c,height:u}=this.canvas,d=c/u,g=[i[0]*s,i[1]*s],h=[g[0]/c,1-g[1]/u,0],m=o.normalizedDisplayToProjection(h[0],h[1],h[2]),y=o.projectionToView(m[0],m[1],m[2],d),v=o.viewToWorld(y[0],y[1],y[2]);return a.setIsPerformingCoordinateTransformation?.(!1),[v[0],v[1],v[2]]},this.getVtkDisplayCoordsTiled=i=>{const a=window.devicePixelRatio||1,o=[i[0]*a,i[1]*a],u=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow().getSize(),d=[o[0]+this.sx,o[1]+this.sy];return d[1]=u[1]-d[1],[d[0],d[1],0]},this.getVtkDisplayCoordsContextPool=i=>{const a=window.devicePixelRatio||1,o=[i[0]*a,i[1]*a],{height:s}=this.canvas,c=[o[0],s-o[1]];return[c[0],c[1],0]},this.worldToCanvasTiled=i=>{const a=this.getVtkActiveCamera();a.setIsPerformingCoordinateTransformation?.(!0);const o=this.getRenderer(),c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),u=c.getSize(),d=c.worldToDisplay(...i,o);d[1]=u[1]-d[1];const g=[d[0]-this.sx,d[1]-this.sy],h=window.devicePixelRatio||1,m=[g[0]/h,g[1]/h];return a.setIsPerformingCoordinateTransformation(!1),m},this.worldToCanvasContextPool=i=>{const a=this.getVtkActiveCamera();a.setIsPerformingCoordinateTransformation?.(!0);const o=this.getRenderer(),{width:s,height:c}=this.canvas,u=s/c,d=o.worldToView(i[0],i[1],i[2]),g=o.viewToProjection(d[0],d[1],d[2],u),h=o.projectionToNormalizedDisplay(g[0],g[1],g[2]),m=h[0]*s,y=(1-h[1])*c,v=window.devicePixelRatio||1,C=[m/v,y/v];return a.setIsPerformingCoordinateTransformation(!1),C},this.hasImageURI=i=>this.getActors().filter(o=>Aa(o,"vtkVolume")).some(({uid:o,referencedId:s})=>{const c=rt.getVolume(s||o);return c?.getImageIdIndex?c.getImageIdIndex(i)!==void 0||c.getImageURIIndex(i)!==void 0:!1}),this.getImageIds=i=>{const a=this._getApplicableVolumeActor(i);if(!a)throw new Error(`No actor found for the given volumeId: ${i}`);const o=a.volumeId,s=rt.getVolume(o);if(!s)throw new Error(`imageVolume with id: ${o} does not exist in cache`);return s.imageIds},this.renderingPipelineFunctions={worldToCanvas:{tiled:this.worldToCanvasTiled,contextPool:this.worldToCanvasContextPool},canvasToWorld:{tiled:this.canvasToWorldTiled,contextPool:this.canvasToWorldContextPool},getVtkDisplayCoords:{tiled:this.getVtkDisplayCoordsTiled,contextPool:this.getVtkDisplayCoordsContextPool},getRenderer:{tiled:this.getRendererTiled,contextPool:this.getRendererContextPool}},this.useCPURendering=Yg(),this.useCPURendering)throw new Error("VolumeViewports cannot be used whilst CPU Fallback Rendering is enabled.");this._configureRenderingPipeline();const n=this.getRenderer(),r=fK.newInstance();switch(n.setActiveCamera(r),this.type){case yn.ORTHOGRAPHIC:r.setParallelProjection(!0);break;case yn.VOLUME_3D:r.setParallelProjection(!0);break;case yn.PERSPECTIVE:r.setParallelProjection(!1);break;default:throw new Error(`Unrecognized viewport type: ${this.type}`)}this.initializeVolumeNewImageEventDispatcher()}static get useCustomRenderingPipeline(){return!1}getSliceViewInfo(){throw new Error("Method not implemented.")}applyViewOrientation(e,n=!0){const{viewPlaneNormal:r,viewUp:i}=this._getOrientationVectors(e)||{};if(!r||!i)return;const a=this.getVtkActiveCamera();a.setDirectionOfProjection(-r[0],-r[1],-r[2]),a.setViewUpFrom(i),this.initialViewUp=i,n&&this.resetCamera({resetOrientation:!1,resetRotation:!1})}initializeVolumeNewImageEventDispatcher(){const e=r.bind(this),n=i.bind(this);function r(a){const{viewportId:o}=a.detail;o!==this.id||this.isDisabled||!this.getImageData()||KK(a)}function i(a){const{viewportId:o}=a.detail;o===this.id&&(this.element.removeEventListener(We.CAMERA_MODIFIED,e),Ye.removeEventListener(We.ELEMENT_DISABLED,n),qK(o))}this.element.removeEventListener(We.CAMERA_MODIFIED,e),this.element.addEventListener(We.CAMERA_MODIFIED,e),Ye.addEventListener(We.ELEMENT_DISABLED,n)}setVOILUTFunction(e,n,r){Object.values(Pi).includes(e)||(e=Pi.LINEAR);const{voiRange:i}=this.getProperties();this.setVOI(i,n,r),this.viewportProperties.VOILUTFunction=e}setColormap(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i,o=Xc.newInstance();let s=T1(e.name);const{name:c}=e;if(s||(s=v1.getPresetByName(c)),!s)throw new Error(`Colormap ${e} not found`);const u=a.getProperty().getRGBTransferFunction(0).getRange();if(o.applyColorMap(s),o.setMappingRange(u[0],u[1]),a.getProperty().setRGBTransferFunction(0,o),this.viewportProperties.colormap=e,!r){const d=this.getColormap(n),g={viewportId:this.id,colormap:d,volumeId:n};je(this.element,We.VOI_MODIFIED,g),je(this.element,We.COLORMAP_MODIFIED,g)}}setOpacity(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:i}=r,a=Gl.newInstance();typeof e.opacity=="number"?ME(i,e.opacity):(e.opacity.forEach(({opacity:c,value:u})=>{a.addPoint(u,c)}),i.getProperty().setScalarOpacity(0,a)),this.viewportProperties.colormap||(this.viewportProperties.colormap={}),this.viewportProperties.colormap.opacity=e.opacity;const o=this.getColormap(n),s={viewportId:this.id,colormap:o,volumeId:n};je(this.element,We.COLORMAP_MODIFIED,s)}setInvert(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const a=i.volumeId,o=this._getOrCreateColorTransferFunction(a);if(Zg(o),this.viewportProperties.invert=e,!r){const s={...this.getVOIModifiedEventDetail(a),invertStateChanged:!0};je(this.element,We.VOI_MODIFIED,s)}}getVOIModifiedEventDetail(e){const n=this._getApplicableVolumeActor(e);if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);const a=n.volumeActor.getProperty().getRGBTransferFunction(0).getMappingRange(),o=this.getColormap(e),{VOILUTFunction:s,invert:c}=this.getProperties(e);return{viewportId:this.id,range:{lower:a[0],upper:a[1]},volumeId:n.volumeId,VOILUTFunction:s,colormap:o,invert:c}}_getOrCreateColorTransferFunction(e){const n=this._getApplicableVolumeActor(e);if(!n)return null;const{volumeActor:r}=n,i=r.getProperty().getRGBTransferFunction(0);if(i)return i;const a=Xc.newInstance();return r.getProperty().setRGBTransferFunction(0,a),a}setInterpolationType(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:i}=r;i.getProperty().setInterpolationType(e),this.viewportProperties.interpolationType=e}setVOI(e,n,r=!1){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i,o=i.volumeId,s=e;if(typeof s>"u")throw new Error("voiRangeToUse is undefined, need to implement this in the new volume model");const{VOILUTFunction:c}=this.getProperties(o);if(c===Pi.SAMPLED_SIGMOID){const u=i8(s);a.getProperty().setRGBTransferFunction(0,u)}else{const{lower:u,upper:d}=s;a.getProperty().getRGBTransferFunction(0).setRange(u,d)}if(!r){const u={...this.getVOIModifiedEventDetail(o)};je(this.element,We.VOI_MODIFIED,u)}this.viewportProperties.voiRange=s}rotateCamera(e){const n=e-this.getRotation();this.getVtkActiveCamera().roll(-n)}setDefaultProperties(e,n){n==null?this.globalDefaultProperties=e:this.perVolumeIdDefaultProperties.set(n,e)}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perVolumeIdDefaultProperties.delete(e),this.resetToDefaultProperties(e))}getViewReference(e={}){const n=super.getViewReference(e),r=this.getVolumeId(e);if(e?.forFrameOfReference!==!1&&(n.volumeId=r),typeof e?.sliceIndex!="number")return n;const{viewPlaneNormal:i}=n,a=e?.sliceIndex-this.getSliceIndex(),{sliceRangeInfo:o}=Xu(this,r,!0),{sliceRange:s,spacingInNormalDirection:c,camera:u}=o,{focalPoint:d,position:g}=u,{newFocalPoint:h}=Zu(d,g,s,i,c,a);return n.cameraFocalPoint=h,n}isReferenceViewable(e,n){if(!e.FrameOfReferenceUID||!super.isReferenceViewable(e,n))return!1;if(n?.withNavigation){const{referencedImageId:a}=e;return!a||this.hasImageURI(a)}const r=this.getSliceIndex(),{sliceIndex:i}=e;return Array.isArray(i)?i[0]<=r&&r<=i[1]:i===void 0||i===r}scroll(e=1){const n=this.getVolumeId(),{sliceRangeInfo:r}=Xu(this,n,!0);if(!r)return;const{sliceRange:i,spacingInNormalDirection:a,camera:o}=r,{focalPoint:s,viewPlaneNormal:c,position:u}=o,{newFocalPoint:d,newPosition:g}=Zu(s,u,i,c,a,e);this.setCamera({focalPoint:d,position:g}),this.render()}setBestOrentation(e,n){if(!e&&!n)return;const{viewPlaneNormal:r}=this.getCamera();if(Lu(r,n)&&Lu(r,e))return;const i=this._getAcquisitionPlaneOrientation();if(Lu(i.viewPlaneNormal,n)&&Lu(i.viewPlaneNormal,e)){this.setOrientation(i);return}for(const o of Object.values(Pc))if(Lu(o.viewPlaneNormal,n)&&Lu(o.viewPlaneNormal,e)){this.setOrientation(o);return}const a=Cn(Ke(),n||i.viewPlaneNormal,e);Sn(a,a),this.setOrientation({viewPlaneNormal:a})}setViewPlane(e){const{point:n,inPlaneVector1:r,inPlaneVector2:i,FrameOfReferenceUID:a}=e;this.setBestOrentation(r,i),this.setViewReference({FrameOfReferenceUID:a,cameraFocalPoint:n,viewPlaneNormal:this.getCamera().viewPlaneNormal})}setViewReference(e){if(!e)return;const n=this.getVolumeId(),{FrameOfReferenceUID:r,cameraFocalPoint:i,referencedImageId:a,planeRestriction:o,viewPlaneNormal:s,viewUp:c}=e;let{sliceIndex:u}=e;if(o&&!s)return this.setViewPlane(o);const{focalPoint:d,viewPlaneNormal:g,position:h}=this.getCamera(),m=_E(g,s),y=Tn(g,s);if(typeof u=="number"&&n!==void 0&&e.volumeId===n&&(m||y)){const{currentStepIndex:v,sliceRangeInfo:C,numScrollSteps:S}=Xu(this,n,!0),{sliceRange:w,spacingInNormalDirection:x}=C;m&&(u=S-u-1);const R=u-v,{newFocalPoint:O,newPosition:b}=Zu(d,h,w,g,x,R);this.setCamera({focalPoint:O,position:b})}else if(r===this.getFrameOfReferenceUID()){if(s&&!m&&!y){this.setOrientation({viewPlaneNormal:s,viewUp:c}),this.setViewReference(e);return}if(a&&this.isInAcquisitionPlane()){const v=it(ga.IMAGE_PLANE,a),{imagePositionPatient:C}=v,{focalPoint:S}=this.getCamera(),w=ei(Ke(),S,C),x=ft(w,g),R=Si(Ke(),S,[-g[0],-g[1],-g[2]],x);this.setCamera({focalPoint:R}),this.render();return}if(i){const v=ei([0,0,0],i,d),C=s??g,S=ft(v,C);Tn(S,0)||bs(v,C,S);const w=z0([0,0,0],d,v),x=z0([0,0,0],h,v);this.setCamera({focalPoint:w,position:x})}}else throw new Error(`Incompatible view refs: ${r}!==${this.getFrameOfReferenceUID()}`)}setThreshold(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:i}=r;LE(i,e.threshold),this.viewportProperties.colormap||(this.viewportProperties.colormap={}),this.viewportProperties.colormap.threshold=e.threshold;const a=this.getColormap(n),o={viewportId:this.id,colormap:a,volumeId:n};je(this.element,We.COLORMAP_MODIFIED,o)}setProperties({voiRange:e,VOILUTFunction:n,invert:r,colormap:i,preset:a,interpolationType:o,slabThickness:s}={},c,u=!1){this.globalDefaultProperties==null&&this.setDefaultProperties({voiRange:e,VOILUTFunction:n,invert:r,colormap:i,preset:a,slabThickness:s}),r!==void 0&&this.viewportProperties.invert!==r&&this.setInvert(r,c,u),i?.name&&this.setColormap(i,c,u),i?.opacity!=null&&this.setOpacity(i,c),i?.threshold!=null&&this.setThreshold(i,c),e!==void 0&&this.setVOI(e,c,u),typeof o<"u"&&this.setInterpolationType(o),n!==void 0&&this.setVOILUTFunction(n,c,u),a!==void 0&&this.setPreset(a,c,u),s!==void 0&&this.setSlabThickness(s)}resetToDefaultProperties(e){const n=this.globalDefaultProperties;n.colormap?.name&&this.setColormap(n.colormap,e),n.colormap?.opacity!=null&&this.setOpacity(n.colormap,e),n.voiRange!==void 0&&this.setVOI(n.voiRange,e),n.VOILUTFunction!==void 0&&this.setVOILUTFunction(n.VOILUTFunction,e),n.invert!==void 0&&this.setInvert(n.invert,e),n.slabThickness!==void 0&&(this.setSlabThickness(n.slabThickness),this.viewportProperties.slabThickness=n.slabThickness),n.preset!==void 0&&this.setPreset(n.preset,e,!1),n.preset!==void 0&&this.setPreset(n.preset,e,!1),this.render()}setPreset(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i;let o=e;typeof o=="string"&&(o=Xw.find(s=>s.name===e)),o&&(HD(a,o),this.viewportProperties.preset=o,this.render(),r||je(this.element,We.PRESET_MODIFIED,{viewportId:this.id,volumeId:i.volumeId,actor:a,presetName:o.name}))}async setVolumes(e,n=!1,r=!1){const i=e[0].volumeId,a=rt.getVolume(i);if(!a)throw new Error(`imageVolume with id: ${i} does not exist, you need to create/allocate the volume first`);const o=a.metadata.FrameOfReferenceUID;this._isValidVolumeInputArray(e,o),this._FrameOfReferenceUID=o,e.forEach(c=>{this._addVolumeId(c.volumeId)});const s=[];for(let c=0;c<e.length;c++){const{volumeId:u,actorUID:d,slabThickness:g,...h}=e[c],m=await H4(e[c],this.element,this.id,r),y=d||Ui();s.push({uid:y,actor:m,slabThickness:g,referencedId:u,...h})}this._setVolumeActors(s),this.viewportStatus=qi.PRE_RENDER,this.initializeColorTransferFunction(e),je(this.element,We.VOLUME_VIEWPORT_NEW_VOLUME,{viewportId:this.id,volumeActors:s}),n&&this.render()}async addVolumes(e,n=!1,r=!1){const i=rt.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);const a=[];this._isValidVolumeInputArray(e,this._FrameOfReferenceUID),e.forEach(o=>{this._addVolumeId(o.volumeId)});for(let o=0;o<e.length;o++){const{volumeId:s,visibility:c,actorUID:u,slabThickness:d,...g}=e[o],h=await H4(e[o],this.element,this.id,r);c||h.setVisibility(!1);const m=u||Ui();a.push({uid:m,actor:h,slabThickness:d,referencedId:s,...g})}this.addActors(a),this.initializeColorTransferFunction(e),n&&this.render()}removeVolumeActors(e,n=!1){this.removeActors(e),n&&this.render()}setOrientation(e,n=!0){console.warn('Method "setOrientation" needs implementation')}initializeColorTransferFunction(e){const n=e[0].volumeId,r=this._getOrCreateColorTransferFunction(n);!this.initialTransferFunctionNodes&&r&&(this.initialTransferFunctionNodes=P2(r))}_getApplicableVolumeActor(e){const n=this.getActors();if(!n?.length)return;if(e){const i=n.find(a=>a.referencedId===e);return i?{volumeActor:i.actor,volumeId:e,actorUID:i.uid}:void 0}const r=n[0];return{volumeActor:r.actor,volumeId:r.referencedId,actorUID:r.uid}}async _isValidVolumeInputArray(e,n){const r=e.length;for(let i=1;i<r;i++){const a=rt.getVolume(e[i].volumeId);if(n!==a.metadata.FrameOfReferenceUID)throw new Error(`Volumes being added to viewport ${this.id} do not share the same FrameOfReferenceUID. This is not yet supported`)}return!0}getBounds(){return this.getRenderer().computeVisiblePropBounds()}flip(e){super.flip(e)}hasVolumeId(e){return this.volumeIds.has(e)}hasVolumeURI(e){for(const n of this.volumeIds)if(n.includes(e))return!0;return!1}getImageData(e){if(!this.getDefaultActor())return;e||=this.getVolumeId();const r=this.getActors()?.find(s=>s.referencedId===e);if(!Aa(r,"vtkVolume"))return;const i=r.actor,a=rt.getVolume(e),o=i.getMapper().getInputData();return{dimensions:o.getDimensions(),spacing:o.getSpacing(),origin:o.getOrigin(),direction:o.getDirection(),imageData:i.getMapper().getInputData(),metadata:{Modality:a?.metadata?.Modality,FrameOfReferenceUID:a?.metadata?.FrameOfReferenceUID},get scalarData(){return a?.voxelManager?.getScalarData()},scaling:a?.scaling,hasPixelSpacing:!0,voxelManager:a?.voxelManager}}setCameraClippingRange(){throw new Error("Method not implemented.")}getSliceIndex(){throw new Error("Method not implemented.")}setCamera(e,n){super.setCamera(e,n),this.setCameraClippingRange()}_setVolumeActors(e){for(let n=0;n<e.length;n++)this.viewportProperties.invert=!1;this.setActors(e)}getRendererContextPool(){return this.getRenderingEngine().getRenderer(this.id)}getRendererTiled(){const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return e.offscreenMultiRenderWindow?.getRenderer(this.id)}_getViewUp(e){const{viewUp:n}=this.getCamera(),r=ft(n,e);if(Tn(r,0))return n;if(Xh(e[0],1))return[0,0,1];if(Xh(e[1],1))return[0,0,1];if(Xh(e[2],1))return[0,-1,0];const i=Si(Ke(),n,e,-r);return Sn(i,i),i}_getOrientationVectors(e){if(typeof e=="object"){if(e.viewPlaneNormal)return{...e,viewUp:e.viewUp||this._getViewUp(e.viewPlaneNormal)};throw new Error("Invalid orientation object. It must contain viewPlaneNormal")}else if(typeof e=="string"){if(e==="acquisition")return this._getAcquisitionPlaneOrientation();if(e==="reformat"||e.includes("_reformat"))return qD(this,{useViewportNormal:!0});if(Pc[e])return this.viewportProperties.orientation=e,Pc[e]}throw new Error(`Invalid orientation: ${e}. Valid orientations are: ${Object.keys(Pc).join(", ")}`)}_getAcquisitionPlaneOrientation(){if(!this.getDefaultActor())return;const n=this.getVolumeId(),r=rt.getVolume(n);if(!r)throw new Error(`imageVolume with id: ${n} does not exist in cache`);const{direction:i}=r,a=i.slice(6,9).map(s=>-s),o=i.slice(3,6).map(s=>-s);return{viewPlaneNormal:a,viewUp:o}}getSlabThickness(){const e=this.getActors();let n=fr.MINIMUM_SLAB_THICKNESS;return e.forEach(r=>{r.slabThickness>n&&(n=r.slabThickness)}),n}getIntensityFromWorld(e){const n=this.getDefaultActor();if(!Aa(n,"vtkVolume"))return;const{actor:r}=n,i=r.getMapper().getInputData(),a=rt.getVolume(this.getVolumeId()),o=Vc(i,e);return a.voxelManager.getAtIJKPoint(o)}getVolumeId(e){const n=this.getActors();if(!n)return;if(!e?.volumeId){const i=n.find(a=>a.actor.getClassName()==="vtkVolume");return i?.referencedId||i?.uid}const r=n.find(i=>i.actor.getClassName()==="vtkVolume"&&i.referencedId===e?.volumeId);return r?.referencedId||r?.uid}getViewReferenceId(e={}){let{volumeId:n,sliceIndex:r}=e;if(!n){const u=this.getActors();if(!u)return;n=u.find(d=>d.actor.getClassName()==="vtkVolume")?.referencedId}const i=this.getSliceIndex();r??=i;const{viewPlaneNormal:a,focalPoint:o}=this.getCamera(),s=n.includes("?")?"&":"?",c=a.map(u=>u.toFixed(3)).join(",");return`volumeId:${n}${s}sliceIndex=${r}&viewPlaneNormal=${c}`}_addVolumeId(e){this.volumeIds.add(e)}getAllVolumeIds(){return Array.from(this.volumeIds)}_configureRenderingPipeline(){const e=KD();for(const n in this.renderingPipelineFunctions)if(Object.prototype.hasOwnProperty.call(this.renderingPipelineFunctions,n)){const r=this.renderingPipelineFunctions[n];this[n]=e?r.contextPool:r.tiled}}}function Lu(t,e){return!e||Tn(ft(t,e),0)}function rY(t,e){e.classHierarchy.push("vtkAbstractImageMapper"),t.getIsOpaque=()=>!0,t.getCurrentImage=()=>null,t.getBoundsForSlice=()=>(H.vtkErrorMacro("vtkAbstractImageMapper.getBoundsForSlice - NOT IMPLEMENTED"),W0())}const iY={slice:0,customDisplayExtent:[0,0,0,0,0,0],useCustomExtents:!1,backgroundColor:[0,0,0,1]};function aY(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iY,n),E8.extend(t,e,n),H.setGet(t,e,["slice","useCustomExtents"]),H.setGetArray(t,e,["customDisplayExtent"],6),H.setGetArray(t,e,["backgroundColor"],4),rY(t,e)}var oY={extend:aY};function YD(t,e,n){const r=n.getCurrentImage(),i=r.getExtent(),a=[i[0],i[2],i[4]],{ijkMode:o}=n.getClosestIJKAxis();let s=n.isA("vtkImageArrayMapper")?n.getSubSlice():n.getSlice();o!==n.getSlicingMode()&&(s=n.getSliceAtPosition(s)),a[o]+=s;const c=[0,0,0];r.indexToWorld(a,c),a[o]+=1;const u=[0,0,0];r.indexToWorld(a,u),u[0]-=c[0],u[1]-=c[1],u[2]-=c[2],Sn(u,u);const d=Ki.intersectWithLine(t,e,c,u);if(d.intersection){const g=d.x,h=[0,0,0];return r.worldToIndex(g,h),{t:d.t,absoluteIJK:h}}return null}function sY(t,e,n){const r=YD(t,e,n);if(r){const a=n.getCurrentImage().getExtent(),o=[Math.round(r.absoluteIJK[0]),Math.round(r.absoluteIJK[1]),Math.round(r.absoluteIJK[2])];return o[0]<a[0]||o[0]>a[1]||o[1]<a[2]||o[1]>a[3]||o[2]<a[4]||o[2]>a[5]?null:{t:r.t,ijk:o}}return null}function cY(t,e,n){const r=YD(t,e,n);if(r){const a=n.getCurrentImage().getExtent(),o=r.absoluteIJK,s=[Math.floor(o[0]),Math.floor(o[1]),Math.floor(o[2])];if(s[0]<a[0]||s[0]>a[1]-1||s[1]<a[2]||s[1]>a[3]-1||s[2]<a[4]||s[2]>(a[5]?a[5]-1:a[5]))return null;const c=[o[0]-s[0],o[1]-s[1],o[2]-s[2]];return{t:r.t,ijk:s,pCoords:c}}return null}const{staticOffsetAPI:lY,otherStaticMethods:uY}=xp,{SlicingMode:nn}=Ep;function fY(t,e){e.classHierarchy.push("vtkImageMapper"),t.getSliceAtPosition=r=>{const i=t.getCurrentImage();let a;if(r.length===3)a=r;else if(Number.isFinite(r)){const d=i.getBounds();switch(e.slicingMode){case nn.X:a=[r,(d[3]+d[2])/2,(d[5]+d[4])/2];break;case nn.Y:a=[(d[1]+d[0])/2,r,(d[5]+d[4])/2];break;case nn.Z:a=[(d[1]+d[0])/2,(d[3]+d[2])/2,r];break}}const o=[0,0,0];i.worldToIndex(a,o);const s=i.getExtent(),{ijkMode:c}=t.getClosestIJKAxis();let u=0;switch(c){case nn.I:u=ns(o[0],s[0],s[1]);break;case nn.J:u=ns(o[1],s[2],s[3]);break;case nn.K:u=ns(o[2],s[4],s[5]);break;default:return 0}return u},t.setSliceFromCamera=r=>{const i=r.getFocalPoint();switch(e.slicingMode){case nn.I:case nn.J:case nn.K:{const a=t.getSliceAtPosition(i);t.setSlice(a)}break;case nn.X:t.setSlice(i[0]);break;case nn.Y:t.setSlice(i[1]);break;case nn.Z:t.setSlice(i[2]);break}},t.setXSlice=r=>{t.setSlicingMode(nn.X),t.setSlice(r)},t.setYSlice=r=>{t.setSlicingMode(nn.Y),t.setSlice(r)},t.setZSlice=r=>{t.setSlicingMode(nn.Z),t.setSlice(r)},t.setISlice=r=>{t.setSlicingMode(nn.I),t.setSlice(r)},t.setJSlice=r=>{t.setSlicingMode(nn.J),t.setSlice(r)},t.setKSlice=r=>{t.setSlicingMode(nn.K),t.setSlice(r)},t.getSlicingModeNormal=()=>{const r=[0,0,0],i=t.getCurrentImage().getDirection();switch(e.slicingMode){case nn.X:r[0]=1;break;case nn.Y:r[1]=1;break;case nn.Z:r[2]=1;break;case nn.I:Hh(i,[1,0,0],r);break;case nn.J:Hh(i,[0,1,0],r);break;case nn.K:Hh(i,[0,0,1],r);break}return r};function n(){let r;switch(e.slicingMode){case nn.X:r=0;break;case nn.Y:r=1;break;case nn.Z:r=2;break;default:e.closestIJKAxis={ijkMode:e.slicingMode,flip:!1};return}const i=t.getCurrentImage().getDirection(),a=eE(i);let o=0;for(;o<3&&a[r+3*o]===0;++o);const s=a[r+3*o]<0;e.closestIJKAxis={ijkMode:o,flip:s}}t.setSlicingMode=r=>{e.slicingMode!==r&&(e.slicingMode=r,t.getCurrentImage()&&n(),t.modified())},t.getClosestIJKAxis=()=>((e.closestIJKAxis===void 0||e.closestIJKAxis.ijkMode===nn.NONE)&&t.getCurrentImage()&&n(),e.closestIJKAxis),t.getBounds=()=>{const r=t.getCurrentImage();if(!r)return W0();if(!e.useCustomExtents)return r.getBounds();const i=e.customDisplayExtent.slice(),{ijkMode:a}=t.getClosestIJKAxis();let o=e.slice;switch(a!==e.slicingMode&&(o=t.getSliceAtPosition(e.slice)),a){case nn.I:i[0]=o,i[1]=o;break;case nn.J:i[2]=o,i[3]=o;break;case nn.K:i[4]=o,i[5]=o;break}return r.extentToBounds(i)},t.getBoundsForSlice=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.slice,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const a=t.getCurrentImage();if(!a)return W0();const o=a.getSpatialExtent(),{ijkMode:s}=t.getClosestIJKAxis();let c=r;switch(s!==e.slicingMode&&(c=t.getSliceAtPosition(r)),s){case nn.I:o[0]=c-i,o[1]=c+i;break;case nn.J:o[2]=c-i,o[3]=c+i;break;case nn.K:o[4]=c-i,o[5]=c+i;break}return a.extentToBounds(o)},t.intersectWithLineForPointPicking=(r,i)=>sY(r,i,t),t.intersectWithLineForCellPicking=(r,i)=>cY(r,i,t),t.getCurrentImage=()=>t.getInputData()}const gY={slicingMode:nn.NONE,closestIJKAxis:{ijkMode:nn.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1,preferSizeOverAccuracy:!1};function XD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gY,n),oY.extend(t,e,n),H.get(t,e,["slicingMode"]),H.setGet(t,e,["closestIJKAxis","renderToRectangle","sliceAtFocalPoint","preferSizeOverAccuracy"]),xp.implementCoincidentTopologyMethods(t,e),fY(t,e)}const dY=H.newInstance(XD,"vtkImageMapper");var hY={newInstance:dY,extend:XD,...lY,...uY,...Ep};const{InterpolationType:o2}=PB,{vtkErrorMacro:LC}=H,s2=4;function pY(t,e){e.classHierarchy.push("vtkImageProperty"),t.getMTime=()=>{let n=e.mtime,r;for(let i=0;i<s2;i++)e.componentData[i].rGBTransferFunction&&(r=e.componentData[i].rGBTransferFunction.getMTime(),n=n>r?n:r),e.componentData[i].piecewiseFunction&&(r=e.componentData[i].piecewiseFunction.getMTime(),n=n>r?n:r);return n},t.setRGBTransferFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),e.componentData[i].rGBTransferFunction!==a?(e.componentData[i].rGBTransferFunction=a,t.modified(),!0):!1},t.getRGBTransferFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].rGBTransferFunction},t.setPiecewiseFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),e.componentData[i].piecewiseFunction!==a?(e.componentData[i].piecewiseFunction=a,t.modified(),!0):!1},t.getPiecewiseFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].piecewiseFunction},t.setScalarOpacity=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),t.setPiecewiseFunction(i,a)},t.getScalarOpacity=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.getPiecewiseFunction(n)},t.setComponentWeight=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(n<0||n>=s2)return LC("Invalid index"),!1;const i=Math.min(1,Math.max(0,r));return e.componentData[n].componentWeight!==i?(e.componentData[n].componentWeight=i,t.modified(),!0):!1},t.getComponentWeight=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return n<0||n>=s2?(LC("Invalid index"),0):e.componentData[n].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(o2.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(o2.LINEAR),t.getInterpolationTypeAsString=()=>H.enumToString(o2,e.interpolationType)}const mY={independentComponents:!1,interpolationType:o2.LINEAR,colorWindow:255,colorLevel:127.5,ambient:1,diffuse:0,opacity:1,useLookupTableScalarRange:!1,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function vY(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,mY,n),H.obj(t,e),!e.componentData){e.componentData=[];for(let r=0;r<s2;r++)e.componentData.push({rGBTransferFunction:null,piecewiseFunction:null,componentWeight:1})}H.setGet(t,e,["independentComponents","interpolationType","colorWindow","colorLevel","ambient","diffuse","opacity","useLookupTableScalarRange","useLabelOutline","labelOutlineOpacity"]),H.setGetArray(t,e,["labelOutlineThickness"]),pY(t,e)}const yY=H.newInstance(vY,"vtkImageProperty");var TY={newInstance:yY};const{vtkDebugMacro:CY}=H;function SY(t,e){e.classHierarchy.push("vtkImageSlice"),t.getActors=()=>t,t.getImages=()=>t,t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let n=e.property.getOpacity()>=1;return n=n&&(!e.mapper||e.mapper.getIsOpaque()),n},t.hasTranslucentPolygonalGeometry=()=>!1,t.makeProperty=TY.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;const r=i=>i[0].map((a,o)=>i.map(s=>s[o]));if(!e.mapperBounds||!r([n,e.mapperBounds]).reduce((i,a)=>i&&a[0]===a[1],!0)||t.getMTime()>e.boundsMTime.getMTime()){CY("Recomputing bounds..."),e.mapperBounds=n.map(a=>a),t.computeMatrix();const i=new Float64Array(16);Qt(i,e.matrix),kn.transformBounds(n,i,e.bounds),e.boundsMTime.modified()}return e.bounds},t.getBoundsForSlice=(n,r)=>{const i=e.mapper.getBoundsForSlice(n,r);if(!kn.isValid(i))return i;t.computeMatrix();const a=new Float64Array(16);return Qt(a,e.matrix),kn.transformBounds(i,a)},t.getMinXBound=()=>t.getBounds()[0],t.getMaxXBound=()=>t.getBounds()[1],t.getMinYBound=()=>t.getBounds()[2],t.getMaxYBound=()=>t.getBounds()[3],t.getMinZBound=()=>t.getBounds()[4],t.getMaxZBound=()=>t.getBounds()[5],t.getMTime=()=>{let n=e.mtime;if(e.property!==null){const r=e.property.getMTime();n=r>n?r:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}if(e.property!==null){let r=e.property.getMTime();n=r>n?r:n,e.property.getRGBTransferFunction()!==null&&(r=e.property.getRGBTransferFunction().getMTime(),n=r>n?r:n)}return n},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1}const wY={mapper:null,property:null,forceOpaque:!1,forceTranslucent:!1,bounds:[...kn.INIT_BOUNDS]};function ZD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wY,n),d8.extend(t,e,n),e.boundsMTime={},H.obj(e.boundsMTime),H.set(t,e,["property"]),H.setGet(t,e,["mapper","forceOpaque","forceTranslucent"]),H.getArray(t,e,["bounds"],6),SY(t,e)}const xY=H.newInstance(ZD,"vtkImageSlice");var EY={newInstance:xY,extend:ZD};function RY(t){return Object.values(Pi).includes(t)?t:Pi.LINEAR}function QD(t){const n={...it(ga.IMAGE_PLANE,t)};return n.columnPixelSpacing||(n.columnPixelSpacing=1),n.rowPixelSpacing||(n.rowPixelSpacing=1),n.columnCosines||(n.columnCosines=[0,1,0]),n.rowCosines||(n.rowCosines=[1,0,0]),n.imagePositionPatient||(n.imagePositionPatient=[0,0,0]),n.imageOrientationPatient||(n.imageOrientationPatient=new Float32Array([1,0,0,0,1,0])),n}function JD(t){const e=t.imageId,{pixelRepresentation:n,bitsAllocated:r,bitsStored:i,highBit:a,photometricInterpretation:o,samplesPerPixel:s}=it("imagePixelModule",e),{windowWidth:c,windowCenter:u,voiLUTFunction:d}=t,{modality:g}=it("generalSeriesModule",e),h=it("scalingModule",e),m=it(ga.CALIBRATION,e),y=RY(d),v=QD(e);return{calibration:m,scalingFactor:h,voiLUTFunction:y,modality:g,imagePlaneModule:v,imagePixelModule:{bitsAllocated:r,bitsStored:i,samplesPerPixel:s,highBit:a,photometricInterpretation:o,pixelRepresentation:n,windowWidth:c,windowCenter:u,modality:g,voiLUTFunction:y}}}function e_(t){const{imagePlaneModule:e,imagePixelModule:n,voiLUTFunction:r,modality:i,scalingFactor:a,calibration:o}=JD(t);let{rowCosines:s,columnCosines:c}=e;(s==null||c==null)&&(s=[1,0,0],c=[0,1,0]);const u=on(s[0],s[1],s[2]),d=on(c[0],c[1],c[2]),g=Ke();Cn(g,u,d);let h=e.imagePositionPatient;h==null&&(h=[0,0,0]);const m=e.columnPixelSpacing||t.columnPixelSpacing,y=e.rowPixelSpacing||t.rowPixelSpacing,v=t.columns,C=t.rows,S=Lo,w=1;return!n.photometricInterpretation&&t.sizeInBytes===3*t.width*t.height&&(t.numberOfComponents=3),{numberOfComponents:t.numberOfComponents||OY(n.photometricInterpretation),origin:h,direction:[...u,...d,...g],dimensions:[v,C,w],spacing:[m,y,S],numVoxels:v*C*w,imagePlaneModule:e,imagePixelModule:n,bitsAllocated:n.bitsAllocated,voiLUTFunction:r,modality:i,scalingFactor:a,calibration:o,scanAxisNormal:g}}function OY(t){let e=1;return(t==="RGB"||t?.includes("YBR")||t==="PALETTE COLOR")&&(e=3),e}var c2={exports:{}},DY=c2.exports,VC;function _Y(){return VC||(VC=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(DY,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],a={},o=null;function s(v,C){var S=v[C];if(typeof S.bind=="function")return S.bind(v);try{return Function.prototype.bind.call(S,v)}catch{return function(){return Function.prototype.apply.apply(S,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function u(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&r?c:console[v]!==void 0?s(console,v):console.log!==void 0?s(console,"log"):e}function d(){for(var v=this.getLevel(),C=0;C<i.length;C++){var S=i[C];this[S]=C<v?e:this.methodFactory(S,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function g(v){return function(){typeof console!==n&&(d.call(this),this[v].apply(this,arguments))}}function h(v,C,S){return u(v)||g.apply(this,arguments)}function m(v,C){var S=this,w,x,R,O="loglevel";typeof v=="string"?O+=":"+v:typeof v=="symbol"&&(O=void 0);function b($){var z=(i[$]||"silent").toUpperCase();if(!(typeof window===n||!O)){try{window.localStorage[O]=z;return}catch{}try{window.document.cookie=encodeURIComponent(O)+"="+z+";"}catch{}}}function I(){var $;if(!(typeof window===n||!O)){try{$=window.localStorage[O]}catch{}if(typeof $===n)try{var z=window.document.cookie,oe=encodeURIComponent(O),Q=z.indexOf(oe+"=");Q!==-1&&($=/^([^;]+)/.exec(z.slice(Q+oe.length+1))[1])}catch{}return S.levels[$]===void 0&&($=void 0),$}}function G(){if(!(typeof window===n||!O)){try{window.localStorage.removeItem(O)}catch{}try{window.document.cookie=encodeURIComponent(O)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function j($){var z=$;if(typeof z=="string"&&S.levels[z.toUpperCase()]!==void 0&&(z=S.levels[z.toUpperCase()]),typeof z=="number"&&z>=0&&z<=S.levels.SILENT)return z;throw new TypeError("log.setLevel() called with invalid level: "+$)}S.name=v,S.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},S.methodFactory=C||h,S.getLevel=function(){return R??x??w},S.setLevel=function($,z){return R=j($),z!==!1&&b(R),d.call(S)},S.setDefaultLevel=function($){x=j($),I()||S.setLevel($,!1)},S.resetLevel=function(){R=null,G(),d.call(S)},S.enableAll=function($){S.setLevel(S.levels.TRACE,$)},S.disableAll=function($){S.setLevel(S.levels.SILENT,$)},S.rebuild=function(){if(o!==S&&(w=j(o.getLevel())),d.call(S),o===S)for(var $ in a)a[$].rebuild()},w=j(o?o.getLevel():"WARN");var F=I();F!=null&&(R=j(F)),d.call(S)}o=new m,o.getLogger=function(C){if(typeof C!="symbol"&&typeof C!="string"||C==="")throw new TypeError("You must supply a name when creating a logger.");var S=a[C];return S||(S=a[C]=new m(C,o.methodFactory)),S};var y=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=y),o},o.getLoggers=function(){return a},o.default=o,o})}(c2)),c2.exports}var bY=_Y();const MY=$s(bY),t_=MY.noConflict();typeof window<"u"&&(window.log=t_);function Vp(t){const e=t_.getLogger(t[0]);return e.getLogger=(...n)=>Vp(`${t}.${n.join(".")}`),e}function I8(...t){return Vp(t.join("."))}const Rf=Vp("cs3d"),A8=Rf.getLogger("core"),LY=Rf.getLogger("tools"),VY=Rf.getLogger("dicomImageLoader"),IY=Rf.getLogger("ai"),AY=Rf.getLogger("examples"),NY=I8("consistency","dicom"),PY=I8("consistency","image"),UY=Object.freeze(Object.defineProperty({__proto__:null,aiLog:IY,coreLog:A8,cs3dLog:Rf,dicomConsistencyLog:NY,examplesLog:AY,getLogger:I8,getRootLogger:Vp,imageConsistencyLog:PY,loaderLog:VY,toolsLog:LY},Symbol.toStringTag,{value:"Module"}));function n_(t){const e=Xc.newInstance();let n=0,r=1024;return t.lower!==void 0&&t.upper!==void 0&&(n=t.lower,r=t.upper),e.addRGBPoint(n,0,0,0),e.addRGBPoint(r,1,1,1),e}function Ip(t,e){const n=e.voxelManager.getScalarData();if(!t.getPointData)return;const r=t.getPointData().getScalars().getData();if(e.color&&e.rgba){const i=new Uint8Array(e.columns*e.rows*3);for(let a=0;a<e.columns*e.rows;a++)i[a*3]=n[a*4],i[a*3+1]=n[a*4+1],i[a*3+2]=n[a*4+2];e.rgba=!1,e.getPixelData=()=>i,r.set(i)}else r.set(n);t.modified()}function Gt(){return window.performance?performance.now():Date.now()}function FY(t,e){return function(n){const r=((n-(e-.5))/(t-1)+.5)*255;return Math.min(Math.max(r,0),255)}}function kY(t){const n=Math.max(...t.lut).toString(2).length-8,r=t.lut[0]>>n,i=t.lut[t.lut.length-1]>>n,a=t.firstValueMapped+t.lut.length-1;return function(o){return o<t.firstValueMapped?r:o>=a?i:t.lut[o-t.firstValueMapped]>>n}}function r_(t,e,n){return n?kY(n):FY(t,e)}function GY(t,e,n,r,i){const a=t.maxPixelValue,o=t.minPixelValue,s=Math.min(o,0);if(t.cachedLut===void 0){const d=a-s+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(d)}const c=t.cachedLut.lutArray,u=r_(Array.isArray(e)?e[0]:e,Array.isArray(n)?n[0]:n,i);if(r)for(let d=o;d<=a;d++)c[d+-s]=255-u(d);else for(let d=o;d<=a;d++)c[d+-s]=u(d);return c}function BY(t,e,n){let r=Gt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Gt()-r;const a=t.minPixelValue;let o=0,s=0;const c=i.length;if(r=Gt(),a<0)for(;s<c;)n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o++]=255;else for(;s<c;)n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o++]=255;t.stats.lastStoredPixelDataToCanvasImageDataTime=Gt()-r}function $Y(t,e,n){let r=Gt();const i=t.getPixelData();t.stats.lastGetPixelDataTime=Gt()-r;const a=t.minPixelValue;let o=0,s=0;const c=i.length;if(r=Gt(),a<0)for(;s<c;)n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o++]=i[s++];else for(;s<c;)n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o++]=i[s++];t.stats.lastStoredPixelDataToCanvasImageDataTime=Gt()-r}class Of{constructor(){this.reset()}getMatrix(){return this.m}reset(){this.m=[1,0,0,1,0,0]}clone(){const e=new Of;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}multiply(e){const n=this.m[0]*e[0]+this.m[2]*e[1],r=this.m[1]*e[0]+this.m[3]*e[1],i=this.m[0]*e[2]+this.m[2]*e[3],a=this.m[1]*e[2]+this.m[3]*e[3],o=this.m[0]*e[4]+this.m[2]*e[5]+this.m[4],s=this.m[1]*e[4]+this.m[3]*e[5]+this.m[5];this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=a,this.m[4]=o,this.m[5]=s}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),n=this.m[3]*e,r=-this.m[1]*e,i=-this.m[2]*e,a=this.m[0]*e,o=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=a,this.m[4]=o,this.m[5]=s}rotate(e){const n=Math.cos(e),r=Math.sin(e),i=this.m[0]*n+this.m[2]*r,a=this.m[1]*n+this.m[3]*r,o=this.m[0]*-r+this.m[2]*n,s=this.m[1]*-r+this.m[3]*n;this.m[0]=i,this.m[1]=a,this.m[2]=o,this.m[3]=s}translate(e,n){this.m[4]+=this.m[0]*e+this.m[2]*n,this.m[5]+=this.m[1]*e+this.m[3]*n}scale(e,n){this.m[0]*=e,this.m[1]*=e,this.m[2]*=n,this.m[3]*=n}transformPoint(e){const n=e[0],r=e[1];return[n*this.m[0]+r*this.m[2]+this.m[4],n*this.m[1]+r*this.m[3]+this.m[5]]}}function S1(t,e){const n=new Of;if(!t.viewport.displayedArea)return n;n.translate(t.canvas.width/2,t.canvas.height/2);const r=t.viewport.rotation;r!==0&&n.rotate(r*Math.PI/180);let i=t.viewport.scale,a=t.viewport.scale;const o=t.viewport.displayedArea.brhc.x-(t.viewport.displayedArea.tlhc.x-1),s=t.viewport.displayedArea.brhc.y-(t.viewport.displayedArea.tlhc.y-1);if(t.viewport.displayedArea.presentationSizeMode==="NONE")t.image.rowPixelSpacing<t.image.columnPixelSpacing?i*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(a*=t.image.rowPixelSpacing/t.image.columnPixelSpacing);else if(i=t.viewport.displayedArea.columnPixelSpacing,a=t.viewport.displayedArea.rowPixelSpacing,t.viewport.displayedArea.presentationSizeMode==="SCALE TO FIT"){const c=t.canvas.height/(s*a),u=t.canvas.width/(o*i);i=a=Math.min(u,c),t.viewport.displayedArea.rowPixelSpacing<t.viewport.displayedArea.columnPixelSpacing?i*=t.viewport.displayedArea.columnPixelSpacing/t.viewport.displayedArea.rowPixelSpacing:t.viewport.displayedArea.columnPixelSpacing<t.viewport.displayedArea.rowPixelSpacing&&(a*=t.viewport.displayedArea.rowPixelSpacing/t.viewport.displayedArea.columnPixelSpacing)}return n.scale(i,a),r!==0&&n.rotate(-r*Math.PI/180),n.translate(t.viewport.translation.x,t.viewport.translation.y),r!==0&&n.rotate(r*Math.PI/180),t.viewport.hflip&&n.scale(-1,1),t.viewport.vflip&&n.scale(1,-1),n.translate(-o/2,-s/2),n}function N8(t,e,n){if(t===void 0)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(e===void 0)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");const i=S1(t).getMatrix();e.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])}function P8(t,e){const n=t.renderingTools.lastRenderedImageId,r=t.renderingTools.lastRenderedViewport;return e.imageId!==n||!r||r.windowCenter!==t.viewport.voi.windowCenter||r.windowWidth!==t.viewport.voi.windowWidth||r.invert!==t.viewport.invert||r.rotation!==t.viewport.rotation||r.hflip!==t.viewport.hflip||r.vflip!==t.viewport.vflip||r.modalityLUT!==t.viewport.modalityLUT||r.voiLUT!==t.viewport.voiLUT||r.colormap!==t.viewport.colormap}function K2(t,e){const n=t.renderingTools.renderCanvas;n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.fillStyle="white",r.fillRect(0,0,n.width,n.height);const i=r.getImageData(0,0,e.width,e.height);t.renderingTools.renderCanvasContext=r,t.renderingTools.renderCanvasData=i}function U8(t){const e=t.image.imageId,n=t.viewport,r=t.image.color;return t.renderingTools.lastRenderedImageId=e,t.renderingTools.lastRenderedIsColor=r,t.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},t.renderingTools}const i_="viewport-element",a_="cornerstone-canvas",IC=1e-4;function Ap(t,e=512,n=512){const r=document.createElement("canvas");return t&&(r.style.position="absolute",r.style.width="100%",r.style.height="100%",r.style.imageRendering="pixelated",r.classList.add(a_),t.appendChild(r)),r}function WY(t){const e=document.createElement("div");return e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.overflow="hidden",e.classList.add(i_),t.appendChild(e),e}function Mo(t){const e=`canvas.${a_}`,n=`div.${i_}`,r=t.querySelector(n)||WY(t),i=r.querySelector(e);if(i)return i;const a=Ap(r),o=r.getBoundingClientRect(),s=window.devicePixelRatio||1,c=Math.ceil(o.width*s),u=Math.ceil(o.height*s);return a.width=c,a.height=u,a}function zY(t,e){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&t.cachedLut.invert===e.invert||(GY(t,e.voi.windowWidth,e.voi.windowCenter,e.invert),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert),t.cachedLut.lutArray}function HY(t,e,n){const r=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||!r)&&(t.renderingTools.renderCanvas=Ap(null,e.width,e.height));const i=t.renderingTools.renderCanvas,{windowWidth:a,windowCenter:o}=t.viewport.voi;if((a===256||a===255)&&(o===128||o===127)&&!t.viewport.invert&&e.getCanvas&&e.getCanvas())return e.getCanvas();if(!P8(t,e)&&!n)return i;(!t.renderingTools.renderCanvasContext||i.width!==e.width||i.height!==e.height)&&K2(t,e);let s=Gt();const c=zY(e,t.viewport);e.stats=e.stats||{},e.stats.lastLutGenerateTime=Gt()-s;const u=t.renderingTools.renderCanvasData,d=t.renderingTools.renderCanvasContext;return e.rgba?$Y(e,c,u.data):BY(e,c,u.data),s=Gt(),d.putImageData(u,0,0),e.stats.lastPutImageDataTime=Gt()-s,i}function jY(t,e){if(t===void 0)throw new Error("renderColorImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("renderColorImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,N8(t,r);const i=HY(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-a,c=t.viewport.displayedArea.brhc.y-o;r.drawImage(i,a,o,s,c,0,0,s,c),t.renderingTools=U8(t)}function qY(t,e,n){let r=Gt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Gt()-r;const a=i.length,o=t.minPixelValue;let s=3,c=0;if(r=Gt(),i instanceof Int16Array)if(o<0)for(;c<a;)n[s]=e[i[c++]+-o],s+=4;else for(;c<a;)n[s]=e[i[c++]],s+=4;else if(i instanceof Uint16Array)for(;c<a;)n[s]=e[i[c++]],s+=4;else if(o<0)for(;c<a;)n[s]=e[i[c++]+-o],s+=4;else for(;c<a;)n[s]=e[i[c++]],s+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=Gt()-r}function KY(t,e,n){let r=Gt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Gt()-r;const a=i.length;let o=3,s=0;for(r=Gt();s<a;)n[o]=e(i[s++]),o+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=Gt()-r}function YY(t,e,n){let r=Gt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Gt()-r;const a=i.length,o=t.minPixelValue;let s=0,c=0,u;if(r=Gt(),i instanceof Int16Array)if(o<0)for(;c<a;)u=e[i[c++]+-o],n[s++]=u,n[s++]=u,n[s++]=u,n[s++]=255;else for(;c<a;)u=e[i[c++]],n[s++]=u,n[s++]=u,n[s++]=u,n[s++]=255;else if(i instanceof Uint16Array)for(;c<a;)u=e[i[c++]],n[s++]=u,n[s++]=u,n[s++]=u,n[s++]=255;else if(o<0)for(;c<a;)u=e[i[c++]+-o],n[s++]=u,n[s++]=u,n[s++]=u,n[s++]=255;else for(;c<a;)u=e[i[c++]],n[s++]=u,n[s++]=u,n[s++]=u,n[s++]=255;t.stats.lastStoredPixelDataToCanvasImageDataTime=Gt()-r}function XY(t,e){if(ZY(t))return;const n=e.maxPixelValue*e.slope+e.intercept,r=e.minPixelValue*e.slope+e.intercept,i=n-r,a=(n+r)/2;t.voi===void 0?t.voi={windowWidth:i,windowCenter:a,voiLUTFunction:e.voiLUTFunction}:(t.voi.windowWidth=i,t.voi.windowCenter=a)}function ZY(t){return t.voiLUT&&t.voiLUT.lut&&t.voiLUT.lut.length>0||t.voi.windowWidth!==void 0&&t.voi.windowCenter!==void 0}function AC(t,e){return!t&&!e?!0:!t||!e?!1:t.id===e.id}function QY(t,e){return n=>n*t+e}function JY(t){const e=t.lut[0],n=t.lut[t.lut.length-1],r=t.firstValueMapped+t.lut.length;return i=>i<t.firstValueMapped?e:i>=r?n:t.lut[i]}function eX(t,e,n){return n?JY(n):QY(t,e)}function tX(t,e,n,r,i,a){const o=t.maxPixelValue,s=t.minPixelValue,c=Math.min(s,0);if(t.cachedLut===void 0){const h=o-c+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(h)}const u=t.cachedLut.lutArray,d=eX(t.slope,t.intercept,i),g=r_(e,n,a);if(t.isPreScaled)if(r)for(let h=s;h<=o;h++)u[h+-c]=255-g(h);else for(let h=s;h<=o;h++)u[h+-c]=g(h);else if(r)for(let h=s;h<=o;h++)u[h+-c]=255-g(d(h));else for(let h=s;h<=o;h++)u[h+-c]=g(d(h));return u}function o_(t,e,n){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&AC(t.cachedLut.modalityLUT,e.modalityLUT)&&AC(t.cachedLut.voiLUT,e.voiLUT)&&t.cachedLut.invert===e.invert&&!n||(XY(e,t),tX(t,e.voi.windowWidth,e.voi.windowCenter,e.invert,e.modalityLUT,e.voiLUT),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert,t.cachedLut.voiLUT=e.voiLUT,t.cachedLut.modalityLUT=e.modalityLUT),t.cachedLut.lutArray}function nX(t,e,n,r=!0){const i=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||i)&&(t.renderingTools.renderCanvas=Ap(null,e.width,e.height),K2(t,e));const a=t.renderingTools.renderCanvas;if(!P8(t,e)&&!n)return a;(a.width!==e.width||a.height!==e.height)&&K2(t,e),e.stats=e.stats||{};const o=t.renderingTools.renderCanvasData,s=t.renderingTools.renderCanvasContext;let c=Gt();e.stats.lastLutGenerateTime=Gt()-c;const{viewport:u}=t;if(u.modality==="PT"&&e.isPreScaled){const{windowWidth:d,windowCenter:g}=u.voi,h=g-d/2,v=255/(g+d/2-h);let C;u.invert?C=S=>255-(S-h)*v:C=S=>(S-h)*v,KY(e,C,o.data)}else{const d=o_(e,u,n);r?qY(e,d,o.data):YY(e,d,o.data)}return c=Gt(),s.putImageData(o,0,0),e.stats.lastPutImageDataTime=Gt()-c,a}function rX(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,N8(t,r);const i=nX(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-a,c=t.viewport.displayedArea.brhc.y-o;r.drawImage(i,a,o,s,c,0,0,s,c),t.renderingTools=U8(t)}const q4=0,K4=1,iX=2;function aX(t,e,n){if(t>1)throw new Error("HSVToRGB expects hue < 1");const r=[];if(e===0)return r[0]=n,r[1]=n,r[2]=n,r;const i=Math.floor(t*6),a=6*t-i,o=n*(1-e),s=n*(1-e*a),c=n*(1-e*(1-a));switch(i){case 0:case 6:r[0]=n,r[1]=c,r[2]=o;break;case 1:r[0]=s,r[1]=n,r[2]=o;break;case 2:r[0]=o,r[1]=n,r[2]=c;break;case 3:r[0]=o,r[1]=s,r[2]=n;break;case 4:r[0]=c,r[1]=o,r[2]=n;break;case 5:r[0]=n,r[1]=o,r[2]=s;break}return r}function oX(t,e){let n;return t<e.Range[0]?n=e.MaxIndex+q4+1.5:t>e.Range[1]?n=e.MaxIndex+K4+1.5:n=(t+e.Shift)*e.Scale,Math.floor(n)}class F8{constructor(){this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}setNumberOfTableValues(e){this.NumberOfColors=e}setRamp(e){this.Ramp=e}setTableRange(e,n){this.TableRange[0]=e,this.TableRange[1]=n}setHueRange(e,n){this.HueRange[0]=e,this.HueRange[1]=n}setSaturationRange(e,n){this.SaturationRange[0]=e,this.SaturationRange[1]=n}setValueRange(e,n){this.ValueRange[0]=e,this.ValueRange[1]=n}setRange(e,n){this.InputRange[0]=e,this.InputRange[1]=n}setAlphaRange(e,n){this.AlphaRange[0]=e,this.AlphaRange[1]=n}getColor(e){return this.mapValue(e)}build(e){if(this.Table.length>1&&!e)return;this.Table=[];const n=this.NumberOfColors-1;let r,i,a,o;n?(r=(this.HueRange[1]-this.HueRange[0])/n,i=(this.SaturationRange[1]-this.SaturationRange[0])/n,a=(this.ValueRange[1]-this.ValueRange[0])/n,o=(this.AlphaRange[1]-this.AlphaRange[0])/n):r=i=a=o=0;for(let s=0;s<=n;s++){const c=this.HueRange[0]+s*r,u=this.SaturationRange[0]+s*i,d=this.ValueRange[0]+s*a,g=this.AlphaRange[0]+s*o,h=aX(c,u,d),m=[0,0,0,0];switch(this.Ramp){case"scurve":m[0]=Math.floor(127.5*(1+Math.cos((1-h[0])*Math.PI))),m[1]=Math.floor(127.5*(1+Math.cos((1-h[1])*Math.PI))),m[2]=Math.floor(127.5*(1+Math.cos((1-h[2])*Math.PI))),m[3]=Math.floor(g*255);break;case"linear":m[0]=Math.floor(h[0]*255+.5),m[1]=Math.floor(h[1]*255+.5),m[2]=Math.floor(h[2]*255+.5),m[3]=Math.floor(g*255+.5);break;case"sqrt":m[0]=Math.floor(Math.sqrt(h[0])*255+.5),m[1]=Math.floor(Math.sqrt(h[1])*255+.5),m[2]=Math.floor(Math.sqrt(h[2])*255+.5),m[3]=Math.floor(Math.sqrt(g)*255+.5);break;default:throw new Error(`Invalid Ramp value (${this.Ramp})`)}this.Table.push(m)}this.buildSpecialColors()}buildSpecialColors(){const e=this.NumberOfColors,n=e+q4,r=e+K4,i=e+iX;this.UseBelowRangeColor||e===0?this.Table[n]=this.BelowRangeColor:this.Table[n]=this.Table[0],this.UseAboveRangeColor||e===0?this.Table[r]=this.AboveRangeColor:this.Table[r]=this.Table[e-1],this.Table[i]=this.NaNColor}mapValue(e){const n=this.getIndex(e);if(n<0)return this.NaNColor;if(n===0){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(n===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[n]}getIndex(e){const n={Range:[],MaxIndex:this.NumberOfColors-1,Shift:-this.TableRange[0],Scale:1};if(this.TableRange[1]<=this.TableRange[0]?n.Scale=Number.MAX_VALUE:n.Scale=n.MaxIndex/(this.TableRange[1]-this.TableRange[0]),n.Range[0]=this.TableRange[0],n.Range[1]=this.TableRange[1],isNaN(e))return-1;let r=oX(e,n);return r===this.NumberOfColors+q4?r=0:r===this.NumberOfColors+K4&&(r=this.NumberOfColors-1),r}setTableValue(e,n,r,i,a){let o;if(typeof n=="number"&&r!==void 0&&i!==void 0&&a!==void 0)o=[n,r,i,a];else if(Array.isArray(n))o=n;else throw new Error("Invalid arguments for setTableValue");if(e<0)throw new Error(`Can't set the table value for negative index (${e})`);if(e>=this.NumberOfColors)throw new Error(`Index ${e} is greater than the number of colors ${this.NumberOfColors}`);this.Table[e]=o,(e===0||e===this.NumberOfColors-1)&&this.buildSpecialColors()}}const NC=[0,0,0,0];function sX(t,e,n){n=n===null?100:n;const r=(e-t)/(n-1),i=[];for(;n-- >0;)i.push(t),t+=r;return i[i.length-1]=e,i}function cX(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=n+Math.floor((r-n)/2),a=t[i];if(a===e)return i;e<a?r=i-1:n=i+1}return n}function lX(t,e){let n;const r=[],i=e.length;for(t.sort(function(a,o){return a-o}),n=0;n<i;n++)r[n]=cX(t,e[n]);return r}function A3(t,e,n){let r;const i=[],a=[],o=[],s=[];for(n=n===null?1:n,r=0;r<e.length;r++){const d=e[r];i.push((t-1)*d[0]),a.push(d[1]),o.push(d[1])}const c=sX(0,1,t);for(r=0;r<t;r++)c[r]=(t-1)*Math.pow(c[r],n);const u=lX(i,c);for(r=1;r<t-1;r++){const d=u[r],g=(c[r]-i[d-1])/(i[d]-i[d-1]),h=a[d]-o[d-1];s[r]=g*h+o[d-1]}return s[0]=o[0],s[t-1]=a[e.length-1],s}function uX(t,e,n){let r;const i=[];e=e===null?256:e,n=n===null?1:n;const a=A3(e,t.red,n),o=A3(e,t.green,n),s=A3(e,t.blue,n);for(r=0;r<e;r++){const c=Math.round(a[r]*255),u=Math.round(o[r]*255),d=Math.round(s[r]*255),g=[c,u,d,255];i.push(g)}return i}function fX(t,e){let n=m4[t];return n||(n=m4[t]={name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=uX(n.segmentedData,n.numColors,n.gamma)),{getId(){return t},getColorSchemeName(){return n.name},setColorSchemeName(i){n.name=i},getNumberOfColors(){return n.colors.length},setNumberOfColors(i){for(;n.colors.length<i;)n.colors.push(NC);n.colors.length=i},getColor(i){return this.isValidIndex(i)?n.colors[i]:NC},getColorRepeating(i){const a=n.colors.length;return i=a?i%a:0,this.getColor(i)},setColor(i,a){this.isValidIndex(i)&&(n.colors[i]=a)},addColor(i){n.colors.push(i)},insertColor(i,a){this.isValidIndex(i)&&n.colors.splice(i,1,a)},removeColor(i){this.isValidIndex(i)&&n.colors.splice(i,1)},clearColors(){n.colors=[]},buildLookupTable(i){if(!i)return;const a=n.colors.length;i.setNumberOfTableValues(a);for(let o=0;o<a;o++)i.setTableValue(o,n.colors[o])},createLookupTable(){const i=new F8;return this.buildLookupTable(i),i},isValidIndex(i){return i>=0&&i<n.colors.length}}}function gX(t,e,n,r){let i=Gt();const a=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Gt()-i;const o=a.length,s=t.minPixelValue;let c=0,u=0,d,g,h;if(i=Gt(),n instanceof F8?h=n.Table:h=n,s<0)for(;u<o;)d=e[a[u++]+-s],g=h[d],r[c++]=g[0],r[c++]=g[1],r[c++]=g[2],r[c++]=g[3];else for(;u<o;)d=e[a[u++]],g=h[d],r[c++]=g[0],r[c++]=g[1],r[c++]=g[2],r[c++]=g[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=Gt()-i}function dX(t,e,n,r){let i=Gt();const a=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Gt()-i;const o=a.length,s=t.minPixelValue;let c=0,u=0,d,g,h;if(i=Gt(),n instanceof F8?h=n.Table:h=n,s<0)for(;u<o;)d=e(a[u++]+-s),g=h[d],r[c++]=g[0],r[c++]=g[1],r[c++]=g[2],r[c++]=g[3];else for(;u<o;)d=e(a[u++]),g=h[d],r[c++]=g[0],r[c++]=g[1],r[c++]=g[2],r[c++]=g[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=Gt()-i}function Y4(t,e,n){return Math.max(e,Math.min(n,t))}function hX(t,e,n){t.renderingTools.renderCanvas||(t.renderingTools.renderCanvas=Ap(null,e.width,e.height));const r=t.renderingTools.renderCanvas;let i=t.viewport.colormap||t.options.colormap;if(t.options&&t.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),i&&typeof i=="string"&&(i=fX(i)),!i)throw new Error("renderPseudoColorImage: colormap not found.");const a=i.getId();if(!P8(t,e)&&!n&&t.renderingTools.colormapId===a)return r;(!t.renderingTools.renderCanvasContext||r.width!==e.width||r.height!==e.height)&&K2(t,e);let o=Gt();(!t.renderingTools.colorLUT||n||t.renderingTools.colormapId!==a)&&(i.setNumberOfColors(256),t.renderingTools.colorLUT=i.createLookupTable(),t.renderingTools.colormapId=a);const s=t.renderingTools.renderCanvasData,c=t.renderingTools.renderCanvasContext,{viewport:u}=t,d=t.renderingTools.colorLUT;if(u.modality==="PT"){const{windowWidth:g,windowCenter:h}=u.voi,m=h-g/2,C=255/(h+g/2-m);let S;u.invert?S=w=>Y4(Math.floor(255-(w-m)*C),0,255):S=w=>Y4(Math.floor((w-m)*C),0,255),dX(e,S,d,s.data)}else{const g=o_(e,t.viewport,n);e.stats=e.stats||{},e.stats.lastLutGenerateTime=Gt()-o,gX(e,g,d,s.data)}return o=Gt(),c.putImageData(s,0,0),e.stats.lastPutImageDataTime=Gt()-o,r}function pX(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,N8(t,r);const i=hX(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-a,c=t.viewport.displayedArea.brhc.y-o;r.drawImage(i,a,o,s,c,0,0,s,c),t.renderingTools=U8(t)}function s_(t,e){const n=t.image;if(!t.canvas||!t.image)return;const r=Gt();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},n){let a=n.render;a||(t.viewport.colormap?a=pX:n.color?a=jY:a=rX),a(t,e)}const i=Gt()-r;n.stats.lastRenderTime=i,t.invalid=!1,t.needsRedraw=!1}function c_(t){return S1(t)}function Sh(t,e){const n=c_(t);return n.invert(),n.transformPoint(e)}const mX={viewport:{}};function vX(){return{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}}function yX(){const t=vX(),e={scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0,voiLUTFunction:Pi.LINEAR},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:t};return Object.assign({},e,mX.viewport)}function n1(t,e){if(t==null)throw new Error(e)}function TX(t){return!(t==null||t===0||t===180)}function l_(t,e=null){return n1(t,"getImageSize: parameter image must not be undefined"),n1(t.width,"getImageSize: parameter image must have width"),n1(t.height,"getImageSize: parameter image must have height"),TX(e)?{height:t.width,width:t.height}:{width:t.width,height:t.height}}function k8(t,e,n=null){n1(t,"getImageScale: parameter canvas must not be undefined"),n1(e,"getImageScale: parameter image must not be undefined");const r=l_(e,n),i=e.rowPixelSpacing||1,a=e.columnPixelSpacing||1;let o=1,s=1;i<a?s=a/i:o=i/a;const c=t.height/r.height/o,u=t.width/r.width/s;return{verticalScale:c,horizontalScale:u,scaleFactor:Math.min(u,c)}}function u_(t,e,n,r){if(t===void 0)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(e===void 0)return yX();const i=k8(t,e,0).scaleFactor;let a;return n==="PT"&&e.isPreScaled?a={windowWidth:5,windowCenter:2.5}:e.windowWidth!==void 0&&e.windowCenter!==void 0&&(a={windowWidth:Array.isArray(e.windowWidth)?e.windowWidth[0]:e.windowWidth,windowCenter:Array.isArray(e.windowCenter)?e.windowCenter[0]:e.windowCenter}),{scale:i,translation:{x:0,y:0},voi:a,invert:e.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:e.modalityLUT,modality:n,voiLUT:e.voiLUT,colormap:r!==void 0?r:e.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:e.rowPixelSpacing===void 0?1:e.rowPixelSpacing,columnPixelSpacing:e.columnPixelSpacing===void 0?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}}}function PC(t,e){return c_(t).transformPoint(e)}function CX(t){const{image:e}=t;t.viewport.scale=k8(t.canvas,e,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0}function SX(t){const{canvas:e}=t,{clientWidth:n,clientHeight:r}=e;(e.width!==n||e.height!==r)&&(e.width=n,e.height=r)}function wX(t,e,n){const r=t.viewport.scale,i=l_(t.image,t.viewport.rotation),a=Math.round(i.width*r),o=Math.round(i.height*r),s=t.viewport.translation.x,c=t.viewport.translation.y;return a===e&&o<=n||a<=e&&o===n&&s===0&&c===0}function xX(t,e,n){const r=t.viewport.scale,i=t.canvas.width,a=t.canvas.height,o=i/e,s=a/n,c=Math.sqrt(o*s);t.viewport.scale=c*r}function EX(t,e=!1){const n=t.canvas.width,r=t.canvas.height;SX(t),t.image!==void 0&&(e||wX(t,n,r)?CX(t):xX(t,n,r))}function RX(t,e){const{hflip:n,vflip:r,rotation:i}=e;if(t.x*=n?-1:1,t.y*=r?-1:1,i!==0){const a=i*Math.PI/180,o=Math.cos(a),s=Math.sin(a),c=t.x*o-t.y*s,u=t.x*s+t.y*o;t.x=c,t.y=u}return t}function OX(t,e=!0,n=!0){const{canvas:r,image:i,viewport:a}=t,o=k8(r,i,0).scaleFactor;a.vflip=!1,a.hflip=!1,e&&(a.translation.x=0,a.translation.y=0),n&&(a.displayedArea.tlhc.x=1,a.displayedArea.tlhc.y=1,a.displayedArea.brhc.x=i.columns,a.displayedArea.brhc.y=i.rows,a.scale=o)}const UC=A8.getLogger("utilities","getClosestImageId");function w1(t,e,n,r){const{direction:i,spacing:a,imageIds:o}=t,{ignoreSpacing:s=!1}=r||{};if(!o?.length)return;const c=i.slice(6,9),u=ft(c,n);if(Math.abs(u)<1-Lo)return;let d;s||(d=W1({direction:i,spacing:a},n)/2);let g,h=1/0;for(let m=0;m<o.length;m++){const y=o[m],v=it("imagePlaneModule",y);if(!v?.imagePositionPatient){UC.warn(`Missing imagePositionPatient for imageId: ${y}`);continue}const{imagePositionPatient:C}=v,S=Ke();hn(S,e,C);const w=Math.abs(ft(S,n));s?w<h&&(h=w,g=y):w<d&&w<h&&(h=w,g=y)}return g===void 0&&UC.warn("No imageId found within the specified criteria (half spacing or absolute closest)."),g}function DX(t,e){const n=ft(t,e),r=bs(Ke(),e,2*n);return hn(Ke(),t,r)}function FC(t,e,n,r){let i=CE(t);if(n&&Bc(i,i),e){const a=Cn(Ke(),r,i);Sn(a,a),i=DX(i,a)}return i}const kC=A8.getLogger("RenderingEngine","StackViewport");class Na extends cf{constructor(e){super(e),this.imageIds=[],this.imageKeyToIndexMap=new Map,this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.imagesLoader=this,this.globalDefaultProperties={},this.perImageIdDefaultProperties=new Map,this.voiUpdatedWithSetProperties=!1,this.invert=!1,this.initialInvert=!1,this.initialTransferFunctionNodes=null,this.stackInvalidated=!1,this._publishCalibratedEvent=!1,this.updateRenderingPipeline=()=>{this._configureRenderingPipeline()},this.resize=()=>{this.useCPURendering&&this._resizeCPU()},this._resizeCPU=()=>{this._cpuFallbackEnabledElement.viewport&&EX(this._cpuFallbackEnabledElement)},this.getFrameOfReferenceUID=n=>this.getImagePlaneReferenceData(n)?.FrameOfReferenceUID,this.getCornerstoneImage=()=>this.csImage,this.createActorMapper=n=>{const r=hY.newInstance();r.setInputData(n);const i=EY.newInstance();i.setMapper(r);const{preferSizeOverAccuracy:a}=Xl().rendering;return a&&r.setPreferSizeOverAccuracy(!0),n.getPointData().getScalars().getNumberOfComponents()>1&&i.getProperty().setIndependentComponents(!1),i},this.getNumberOfSlices=()=>this.imageIds.length,this.getDefaultProperties=n=>{let r;return n!==void 0&&(r=this.perImageIdDefaultProperties.get(n)),r!==void 0?r:{...this.globalDefaultProperties}},this.getProperties=()=>{const{colormap:n,voiRange:r,VOILUTFunction:i,interpolationType:a,invert:o,voiUpdatedWithSetProperties:s}=this;return{colormap:n,voiRange:r,VOILUTFunction:i,interpolationType:a,invert:o,isComputedVOI:!s}},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,suppressEvents:!0}),this.getRotationCPU=()=>{const{viewport:n}=this._cpuFallbackEnabledElement;return n.rotation},this.getRotationGPU=()=>{const{viewUp:n,viewPlaneNormal:r,flipVertical:i,flipHorizontal:a}=this.getCameraNoRotation(),o=FC(this.initialViewUp,a,i,r),c=wE(o,n)*180/Math.PI,u=Cn(Ke(),o,n);return ft(u,r)>=0?c:(360-c)%360},this.setRotation=n=>{const r=this.getCamera();if(this.useCPURendering?this.setRotationCPU(n):this.setRotationGPU(n),this._suppressCameraModifiedEvents)return;const i=this.getCamera(),a={previousCamera:r,camera:i,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};je(this.element,We.CAMERA_MODIFIED,a)},this.renderImageObject=n=>{this._setCSImage(n),(this.useCPURendering?this._updateToDisplayImageCPU:this._updateActorToDisplayImageId).call(this,n)},this._setCSImage=n=>{n.isPreScaled=n.preScale?.scaled,this.csImage=n},this.canvasToWorldCPU=(n,r=[0,0,0])=>{if(!this._cpuFallbackEnabledElement.image)return;const[i,a]=Sh(this._cpuFallbackEnabledElement,n),{origin:o,spacing:s,direction:c}=this.getImageData(),u=c.slice(0,3),d=c.slice(3,6);return Si(r,o,u,i*s[0]),Si(r,r,d,a*s[1]),r},this.worldToCanvasCPU=n=>{const{spacing:r,direction:i,origin:a}=this.getImageData(),o=i.slice(0,3),s=i.slice(3,6),c=ei(Ke(),n,a),u=[ft(c,o)/r[0],ft(c,s)/r[1]];return PC(this._cpuFallbackEnabledElement,u)},this.canvasToWorldGPUContextPool=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),o=i.getDistance();i.setClippingRange(o,o+.1);const s=window.devicePixelRatio||1,{width:c,height:u}=this.canvas,d=c/u,g=[n[0]*s,n[1]*s],h=[g[0]/c,1-g[1]/u,0],m=r.normalizedDisplayToProjection(h[0],h[1],h[2]),y=r.projectionToView(m[0],m[1],m[2],d),v=r.viewToWorld(y[0],y[1],y[2]);return i.setClippingRange(a[0],a[1]),[v[0],v[1],v[2]]},this.canvasToWorldGPUTiled=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),o=i.getDistance();i.setClippingRange(o,o+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),u=c.getSize(),d=window.devicePixelRatio||1,g=[n[0]*d,n[1]*d],h=[g[0]+this.sx,g[1]+this.sy];h[1]=u[1]-h[1];const m=c.displayToWorld(h[0],h[1],0,r);return i.setClippingRange(a[0],a[1]),[m[0],m[1],m[2]]},this.worldToCanvasGPUContextPool=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),o=i.getDistance();i.setClippingRange(o,o+.1);const s=window.devicePixelRatio||1,{width:c,height:u}=this.canvas,d=c/u,g=r.worldToView(n[0],n[1],n[2]),h=r.viewToProjection(g[0],g[1],g[2],d),m=r.projectionToNormalizedDisplay(h[0],h[1],h[2]),y=m[0]*c,v=(1-m[1])*u;return i.setClippingRange(a[0],a[1]),[y/s,v/s]},this.worldToCanvasGPUTiled=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),o=i.getDistance();i.setClippingRange(o,o+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),u=c.getSize(),d=c.worldToDisplay(...n,r);d[1]=u[1]-d[1];const g=[d[0]-this.sx,d[1]-this.sy];i.setClippingRange(a[0],a[1]);const h=window.devicePixelRatio||1;return[g[0]/h,g[1]/h]},this.getCurrentImageIdIndex=()=>this.currentImageIdIndex,this.getSliceIndex=()=>this.currentImageIdIndex,this.getTargetImageIdIndex=()=>this.targetImageIdIndex,this.getImageIds=()=>this.imageIds,this.getCurrentImageId=(n=this.getCurrentImageIdIndex())=>this.imageIds[n],this.hasImageId=n=>this.imageKeyToIndexMap.has(n),this.hasImageURI=n=>this.imageKeyToIndexMap.has(n),this.customRenderViewportToCanvas=()=>{if(!this.useCPURendering)throw new Error("Custom cpu rendering pipeline should only be hit in CPU rendering mode");return this._cpuFallbackEnabledElement.image?(s_(this._cpuFallbackEnabledElement,this.cpuRenderingInvalidated),this.cpuRenderingInvalidated=!1):this.fillWithBackgroundColor(),{canvas:this.canvas,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,viewportStatus:this.viewportStatus}},this.renderingPipelineFunctions={getImageData:{cpu:this.getImageDataCPU,gpu:this.getImageDataGPU},setColormap:{cpu:this.setColormapCPU,gpu:this.setColormapGPU},getCamera:{cpu:this.getCameraCPU,gpu:super.getCamera},setCamera:{cpu:this.setCameraCPU,gpu:super.setCamera},getPan:{cpu:this.getPanCPU,gpu:super.getPan},setPan:{cpu:this.setPanCPU,gpu:super.setPan},getZoom:{cpu:this.getZoomCPU,gpu:super.getZoom},setZoom:{cpu:this.setZoomCPU,gpu:super.setZoom},setVOI:{cpu:this.setVOICPU,gpu:this.setVOIGPU},getRotation:{cpu:this.getRotationCPU,gpu:this.getRotationGPU},setInterpolationType:{cpu:this.setInterpolationTypeCPU,gpu:this.setInterpolationTypeGPU},setInvertColor:{cpu:this.setInvertColorCPU,gpu:this.setInvertColorGPU},resetCamera:{cpu:(n={})=>{const{resetPan:r=!0,resetZoom:i=!0}=n;return this.resetCameraCPU({resetPan:r,resetZoom:i}),!0},gpu:(n={})=>{const{resetPan:r=!0,resetZoom:i=!0}=n;return this.resetCameraGPU({resetPan:r,resetZoom:i}),!0}},canvasToWorld:{cpu:this.canvasToWorldCPU,gpu:{tiled:this.canvasToWorldGPUTiled,contextPool:this.canvasToWorldGPUContextPool}},worldToCanvas:{cpu:this.worldToCanvasCPU,gpu:{tiled:this.worldToCanvasGPUTiled,contextPool:this.worldToCanvasGPUContextPool}},getRenderer:{cpu:()=>this.getCPUFallbackError("getRenderer"),gpu:{tiled:this.getRendererTiled,contextPool:this.getRendererContextPool}},getDefaultActor:{cpu:()=>this.getCPUFallbackError("getDefaultActor"),gpu:super.getDefaultActor},getActors:{cpu:()=>this.getCPUFallbackError("getActors"),gpu:super.getActors},getActor:{cpu:()=>this.getCPUFallbackError("getActor"),gpu:super.getActor},setActors:{cpu:()=>this.getCPUFallbackError("setActors"),gpu:super.setActors},addActors:{cpu:()=>this.getCPUFallbackError("addActors"),gpu:super.addActors},addActor:{cpu:()=>this.getCPUFallbackError("addActor"),gpu:super.addActor},removeAllActors:{cpu:()=>this.getCPUFallbackError("removeAllActors"),gpu:super.removeAllActors},unsetColormap:{cpu:this.unsetColormapCPU,gpu:this.unsetColormapGPU}},this.scaling={},this.modality=null,this.useCPURendering=Yg(),this._configureRenderingPipeline(),this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport(),this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.resetCamera(),this.initializeElementDisabledHandler()}setUseCPURendering(e){this.useCPURendering=e,this._configureRenderingPipeline(e)}static get useCustomRenderingPipeline(){return Yg()}_configureRenderingPipeline(e){const n=KD();this.useCPURendering=e??Yg();for(const r in this.renderingPipelineFunctions)if(Object.prototype.hasOwnProperty.call(this.renderingPipelineFunctions,r)){const i=this.renderingPipelineFunctions[r];this.useCPURendering?this[r]=i.cpu:typeof i.gpu=="object"&&i.gpu.tiled&&i.gpu.contextPool?this[r]=n?i.gpu.contextPool:i.gpu.tiled:this[r]=i.gpu}this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport()}_resetCPUFallbackElement(){this._cpuFallbackEnabledElement={canvas:this.canvas,renderingTools:{},transform:new Of,viewport:{rotation:0}}}_resetGPUViewport(){const e=this.getRenderer(),n=O8.newInstance();e.setActiveCamera(n),this.initialViewUp=[0,-1,0],n.setDirectionOfProjection(-0,-0,1),n.setViewUp(...this.initialViewUp),n.setParallelProjection(!0),n.setThicknessFromFocalPoint(.1),n.setFreezeFocalPoint(!0)}initializeElementDisabledHandler(){Ye.addEventListener(We.ELEMENT_DISABLED,function e(){clearTimeout(this.debouncedTimeout),Ye.removeEventListener(We.ELEMENT_DISABLED,e)})}getImageDataGPU(){const e=this.getDefaultActor();if(!e||!Jo(e))return;const{actor:n}=e,r=n.getMapper().getInputData(),i=this.csImage;return{dimensions:r.getDimensions(),spacing:r.getSpacing(),origin:r.getOrigin(),direction:r.getDirection(),get scalarData(){return i?.voxelManager.getScalarData()},imageData:n.getMapper().getInputData(),metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,hasPixelSpacing:this.hasPixelSpacing,calibration:{...i?.calibration,...this.calibration},preScale:{...i?.preScale},voxelManager:i?.voxelManager}}getImageDataCPU(){const{metadata:e}=this._cpuFallbackEnabledElement;if(!e)return;const n=e.spacing,r=this.csImage;return{dimensions:e.dimensions,spacing:n,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getScalarData:()=>this.cpuImagePixelData,getSpacing:()=>n,worldToIndex:i=>{const a=this.worldToCanvasCPU(i),o=Sh(this._cpuFallbackEnabledElement,a);return[o[0],o[1],0]},indexToWorld:(i,a)=>{const o=PC(this._cpuFallbackEnabledElement,[i[0],i[1]]);return this.canvasToWorldCPU(o,a)}},scalarData:this.cpuImagePixelData,hasPixelSpacing:this.hasPixelSpacing,calibration:{...r?.calibration,...this.calibration},preScale:{...r?.preScale},voxelManager:r?.voxelManager}}calibrateIfNecessary(e,n){const r=it("calibratedPixelSpacing",e),i=this.calibration!==r,{scale:a}=r||{};return this.hasPixelSpacing=a>0||n.rowPixelSpacing>0,n.calibration=r,i&&(this.calibration=r,this._publishCalibratedEvent=!0,this._calibrationEvent={scale:a,calibration:r}),n}setDefaultProperties(e,n){n==null?this.globalDefaultProperties=e:(this.perImageIdDefaultProperties.set(n,e),this.getCurrentImageId()===n&&this.setProperties(e))}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perImageIdDefaultProperties.delete(e),this.resetToDefaultProperties())}setProperties({colormap:e,voiRange:n,VOILUTFunction:r,invert:i,interpolationType:a}={},o=!1){this.viewportStatus=this.csImage?qi.PRE_RENDER:qi.LOADING,this.globalDefaultProperties={colormap:this.globalDefaultProperties.colormap??e,voiRange:this.globalDefaultProperties.voiRange??n,VOILUTFunction:this.globalDefaultProperties.VOILUTFunction??r,invert:this.globalDefaultProperties.invert??i,interpolationType:this.globalDefaultProperties.interpolationType??a},typeof e<"u"&&this.setColormap(e),typeof n<"u"&&this.setVOI(n,{suppressEvents:o,voiUpdatedWithSetProperties:!0}),typeof r<"u"&&this.setVOILUTFunction(r,o),typeof i<"u"&&this.setInvertColor(i),typeof a<"u"&&this.setInterpolationType(a)}resetProperties(){this.cpuRenderingInvalidated=!0,this.voiUpdatedWithSetProperties=!1,this.viewportStatus=qi.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={}),this._resetProperties(),this.render()}_resetProperties(){let e;if(this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage(),this.setVOI(e),this.setInvertColor(this.initialInvert),this.setInterpolationType(Nc.LINEAR),!this.useCPURendering){const n=this.getTransferFunction();Tp(n,this.initialTransferFunctionNodes);const i=P2(n).reduce((s,c)=>(s.push(c[0],c[1],c[2],c[3]),s),[]),a=this.getDefaultActor(),o=e8(i,a.actor);this.setColormap(o)}}resetToDefaultProperties(){this.cpuRenderingInvalidated=!0,this.viewportStatus=qi.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={});const e=this.getCurrentImageId(),n=this.perImageIdDefaultProperties.get(e)||this.globalDefaultProperties;n.colormap?.name&&this.setColormap(n.colormap);let r;n.voiRange==null?r=this._getVOIRangeForCurrentImage():r=n.voiRange,this.setVOI(r),this.setInterpolationType(Nc.LINEAR),this.setInvertColor(!1),this.render()}_getVOIFromCache(){let e;return this.voiUpdatedWithSetProperties?e=this.voiRange:this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage()??this.voiRange,e}_setPropertiesFromCache(){const e=this._getVOIFromCache(),{interpolationType:n,invert:r}=this;this.setVOI(e),this.setInterpolationType(n),this.setInvertColor(r)}getCameraCPU(){const{metadata:e,viewport:n}=this._cpuFallbackEnabledElement;if(!e)return{};const{direction:r}=e,i=r.slice(6,9).map(g=>-g);let a=r.slice(3,6).map(g=>-g);if(n.rotation){const g=Kv(Ps(),n.rotation*Math.PI/180,i);a=an(Ke(),a,g)}const o=[this.element.clientWidth/2,this.element.clientHeight/2],s=this.canvasToWorld(o),c=this.canvasToWorld([0,0]),u=this.canvasToWorld([0,this.element.clientHeight]),d=y1(c,u)/2;return{parallelProjection:!0,focalPoint:s,position:[0,0,0],parallelScale:d,scale:n.scale,viewPlaneNormal:[i[0],i[1],i[2]],viewUp:[a[0],a[1],a[2]],flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}setCameraCPU(e){const{viewport:n,image:r}=this._cpuFallbackEnabledElement,i=this.getCameraCPU(),{focalPoint:a,parallelScale:o,scale:s,flipHorizontal:c,flipVertical:u}=e,{clientHeight:d}=this.element;if(a){const h=this.worldToCanvasCPU(a),m=Sh(this._cpuFallbackEnabledElement,h),y=this.worldToCanvasCPU(i.focalPoint),v=Sh(this._cpuFallbackEnabledElement,y),C=tr();Ni(C,NT(m[0],m[1]),NT(v[0],v[1]));const S=RX({x:C[0],y:C[1]},n);n.translation.x-=S.x,n.translation.y-=S.y}if(o){const{rowPixelSpacing:h}=r,m=d*h*.5/o;n.scale=m,n.parallelScale=o}if(s){const{rowPixelSpacing:h}=r;n.scale=s,n.parallelScale=d*h*.5/s}(c!==void 0||u!==void 0)&&this.setFlipCPU({flipHorizontal:c,flipVertical:u}),this._cpuFallbackEnabledElement.transform=S1(this._cpuFallbackEnabledElement);const g={previousCamera:i,camera:this.getCamera(),element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};je(this.element,We.CAMERA_MODIFIED,g)}getPanCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return[e.translation.x,e.translation.y]}setPanCPU(e){const n=this.getCameraCPU();this.setCameraCPU({...n,focalPoint:[...e.map(r=>-r),0]})}getZoomCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return e.scale}setZoomCPU(e){const n=this.getCameraCPU();this.setCameraCPU({...n,scale:e})}setFlipCPU({flipHorizontal:e,flipVertical:n}){const{viewport:r}=this._cpuFallbackEnabledElement;e!==void 0&&(r.hflip=e,this.flipHorizontal=r.hflip),n!==void 0&&(r.vflip=n,this.flipVertical=r.vflip)}setVOILUTFunction(e,n){if(this.useCPURendering)throw new Error("VOI LUT function is not supported in CPU rendering");const r=this._getValidVOILUTFunction(e);let i=!1;this.VOILUTFunction!==r&&(i=!0),this.VOILUTFunction=r;const{voiRange:a}=this.getProperties();this.setVOI(a,{suppressEvents:n,forceRecreateLUTFunction:i})}setRotationCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n.rotation=e}setRotationGPU(e){const n=this.getPan(this.fitToCanvasCamera),r=this.getPan(),i=N2([0,0],n,r);this.setPan(i,!1);const{flipVertical:a,flipHorizontal:o,viewPlaneNormal:s}=this.getCamera(),c=FC(this.initialViewUp,o,a,s);this.setCameraNoEvent({viewUp:c}),this.getVtkActiveCamera().roll(-e);const u=this.getPan(),d=this.getPan(this.fitToCanvasCamera),g=N2([0,0],u,d),h=Zv([0,0],n,g);this.setPan(h,!1)}setInterpolationTypeGPU(e){const n=this.getDefaultActor();if(!n||!Jo(n))return;const{actor:r}=n;r.getProperty().setInterpolationType(e),this.interpolationType=e}setInterpolationTypeCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n.pixelReplication=e!==Nc.LINEAR,this.interpolationType=e}setInvertColorCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n&&(n.invert=e,this.invert=e)}setInvertColorGPU(e){const n=this.getDefaultActor();if(n&&Jo(n)){if(Aa(n,"vtkVolume")){const i=n.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&Zg(i),this.invert=e}else if(Aa(n,"vtkImageSlice")){const i=n.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&Zg(i),this.invert=e}}}setVOICPU(e,n={}){const{suppressEvents:r=!1}=n,{viewport:i,image:a}=this._cpuFallbackEnabledElement;if(!i||!a)return;if(typeof e>"u"){const{windowWidth:s,windowCenter:c}=a,u=Array.isArray(s)?s[0]:s,d=Array.isArray(c)?c[0]:c;i.voi={windowWidth:u,windowCenter:d,voiLUTFunction:a.voiLUTFunction};const{lower:g,upper:h}=Qg(u,d,a.voiLUTFunction);e={lower:g,upper:h}}else{const{lower:s,upper:c}=e,{windowCenter:u,windowWidth:d}=yp(s,c);i.voi||(i.voi={windowWidth:0,windowCenter:0,voiLUTFunction:a.voiLUTFunction}),i.voi.windowWidth=d,i.voi.windowCenter=u}this.voiRange=e;const o={viewportId:this.id,range:e};r||je(this.element,We.VOI_MODIFIED,o)}getTransferFunction(){const e=this.getDefaultActor();return!e||!Jo(e)?void 0:e.actor.getProperty().getRGBTransferFunction(0)}setVOIGPU(e,n={}){const{suppressEvents:r=!1,forceRecreateLUTFunction:i=!1,voiUpdatedWithSetProperties:a=!1}=n;if(e&&this.voiRange&&this.voiRange.lower===e.lower&&this.voiRange.upper===e.upper&&!i&&!this.stackInvalidated)return;const o=this.getDefaultActor();if(!o||!Jo(o))return;const s=o.actor;let c=e;if(typeof c>"u"){const m=s.getMapper().getInputData().getPointData().getScalars().getRange();c={lower:m[0],upper:m[1]}}s.getProperty().setUseLookupTableScalarRange(!0);let u=s.getProperty().getRGBTransferFunction(0);const d=this.VOILUTFunction===Pi.SAMPLED_SIGMOID;if((d||!u||i)&&(u=(d?i8:n_)(c),this.invert&&Zg(u),s.getProperty().setRGBTransferFunction(0,u),this.initialTransferFunctionNodes=P2(u)),d||u.setRange(c.lower,c.upper),this.voiRange=c,this.voiUpdatedWithSetProperties||(this.voiUpdatedWithSetProperties=a),r)return;const g={viewportId:this.id,range:c,VOILUTFunction:this.VOILUTFunction};je(this.element,We.VOI_MODIFIED,g)}_addScalingToViewport(e){if(this.scaling.PT)return;const{suvbw:n,suvlbm:r,suvbsa:i}=e,a={};r&&(a.suvbwToSuvlbm=r/n),i&&(a.suvbwToSuvbsa=i/n),this.scaling.PT=a}getImageDataMetadata(e){const n=e.imageId,r=e_(e),{numberOfComponents:i,origin:a,direction:o,dimensions:s,spacing:c,numVoxels:u,imagePixelModule:d,voiLUTFunction:g,modality:h,scalingFactor:m,calibration:y}=r;h==="PT"&&m&&this._addScalingToViewport(m),this.modality=h;const v=this._getValidVOILUTFunction(g);this.VOILUTFunction=v,this.calibration=y;let C=this._getImagePlaneModule(n);return this.useCPURendering||(C=this.calibrateIfNecessary(n,C)),{bitsAllocated:d.bitsAllocated,numberOfComponents:i,origin:a,direction:o,dimensions:s,spacing:c,numVoxels:u,imagePlaneModule:C,imagePixelModule:d}}matchImagesForOverlay(e,n){return(i=>{const a=it(ga.IMAGE_PLANE,n),o=it(ga.IMAGE_PLANE,i),s=a.imageOrientationPatient,c=o.imageOrientationPatient;if(s&&c){if(Tn(a.imageOrientationPatient,o.imageOrientationPatient)){const d=a.imagePositionPatient,g=o.imagePositionPatient;if(d&&g&&Tn(d,g)){const m=a.rows,y=a.columns,v=o.rows,C=o.columns;if(m===v&&y===C)return i}}}else{const u=a.rows,d=a.columns,g=o.rows,h=o.columns;if(u===g&&d===h)return i}})(e)}getImagePlaneReferenceData(e=this.getCurrentImageIdIndex()){const n=this.imageIds[e];if(!n)return;const r=it(ga.IMAGE_PLANE,n);if(!r)return;const{imagePositionPatient:i,frameOfReferenceUID:a}=r;let{rowCosines:o,columnCosines:s}=r;o||=[1,0,0],s||=[0,1,0];const c=Cn([0,0,0],s,o);return{FrameOfReferenceUID:a,viewPlaneNormal:c,cameraFocalPoint:i,referencedImageId:n,sliceIndex:e}}_getCameraOrientation(e){const n=e.slice(6,9).map(i=>-i),r=e.slice(3,6).map(i=>-i);return{viewPlaneNormal:[n[0],n[1],n[2]],viewUp:[r[0],r[1],r[2]]}}createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numberOfComponents:a,pixelArray:o}){const s=new o.constructor(o.length),c=Pt.newInstance({name:"Pixels",numberOfComponents:a,values:s}),u=Op.newInstance();return u.setDimensions(r),u.setSpacing(i),u.setDirection(n),u.setOrigin(e),u.getPointData().setScalars(c),u}_createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numberOfComponents:a,pixelArray:o}){try{this._imageData=this.createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numberOfComponents:a,pixelArray:o})}catch(s){kC.error(s)}}async setStack(e,n=0){if(this._throwIfDestroyed(),this.imageIds=e,n>e.length)throw new Error("Current image index is greater than the number of images in the stack");this.imageKeyToIndexMap.clear(),e.forEach((o,s)=>{this.imageKeyToIndexMap.set(o,s),this.imageKeyToIndexMap.set(da(o),s)}),this.currentImageIdIndex=n,this.targetImageIdIndex=n;const r=it(sf.IMAGE_RETRIEVE_CONFIGURATION,e[n],"stack");this.imagesLoader=r?(r.create||AD)(r):this,this.stackInvalidated=!0,this.flipVertical=!1,this.flipHorizontal=!1,this.voiRange=null,this.interpolationType=Nc.LINEAR,this.invert=!1,this.viewportStatus=qi.LOADING,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={},delete this._cpuFallbackEnabledElement.viewport.colormap);const i=await this._setImageIdIndex(n),a={imageIds:e,viewportId:this.id,element:this.element,currentImageIdIndex:n};return je(this.element,We.VIEWPORT_NEW_IMAGE_SET,a),i}_throwIfDestroyed(){if(this.isDisabled)throw new Error("The stack viewport has been destroyed and is no longer usable. Renderings will not be performed. If you are using the same viewportId and have re-enabled the viewport, you need to grab the new viewport instance using renderingEngine.getViewport(viewportId), instead of using your lexical scoped reference to the viewport instance.")}_checkVTKImageDataMatchesCornerstoneImage(e,n){if(!n)return!1;const[r,i]=n.getSpacing(),[a,o]=n.getDimensions(),s=this._getImagePlaneModule(e.imageId),c=n.getDirection(),u=c.slice(0,3),d=c.slice(3,6),g=n.getPointData().getScalars().getDataType(),h=Tn(r,e.columnPixelSpacing),m=Tn(i,e.rowPixelSpacing),y=h||e.columnPixelSpacing===null&&r===1,v=m||e.rowPixelSpacing===null&&i===1,C=a===e.columns,S=o===e.rows,w=Tn(s.rowCosines,u),x=Tn(s.columnCosines,d),R=g===e.voxelManager.getScalarData().constructor.name;return y&&v&&C&&S&&w&&x&&R}_updateVTKImageDataFromCornerstoneImage(e){let r=this._getImagePlaneModule(e.imageId).imagePositionPatient;r==null&&(r=[0,0,0]),this._imageData.setOrigin(r);const i=this.getActor(this.id);i&&(i.referencedId=e.imageId),Ip(this._imageData,e)}_loadAndDisplayImage(e,n){return this.useCPURendering?this._loadAndDisplayImageCPU(e,n):this._loadAndDisplayImageGPU(e,n)}_loadAndDisplayImageCPU(e,n){return new Promise((r,i)=>{function a(m,y,v){if(this.currentImageIdIndex!==y)return;const C=m.voxelManager.getScalarData(),S=m.preScale,w=S?.scalingParameters,x=S?.scaled&&w?.rescaleIntercept%1!==0||w?.rescaleSlope%1!==0;if(C instanceof Float32Array&&x){const O={min:m.minPixelValue,max:m.maxPixelValue},G=Math.abs(O.max-O.min)/65535,j=O.min,F=C.length,$=new Uint16Array(F);let z=65535,oe=0;for(let Q=0;Q<F;Q++){const le=Math.floor((C[Q]-j)/G);$[Q]=le,z=Math.min(z,le),oe=Math.max(oe,le)}m.minPixelValue=z,m.maxPixelValue=oe,m.slope=G,m.intercept=j,m.voxelManager?m.voxelManager.getScalarData=()=>$:m.getPixelData=()=>$,m.preScale={...m.preScale,scaled:!1}}this._setCSImage(m),this.viewportStatus=qi.PRE_RENDER;const R={image:m,imageId:v,imageIdIndex:y,viewportId:this.id,renderingEngineId:this.renderingEngineId};je(this.element,We.STACK_NEW_IMAGE,R),this._updateToDisplayImageCPU(m),this.render(),this.currentImageIdIndex=y,r(v)}function o(m,y,v){const C={error:m,imageIdIndex:y,imageId:v};this.suppressEvents||je(Ye,We.IMAGE_LOAD_ERROR,C),i(m)}function s(m,y,v){return j0(m,v).then(C=>{a.call(this,C,y,m)},C=>{o.call(this,C,y,m)})}const c=-5,u=Nt.Interaction,d={imageId:e,imageIdIndex:n},g={useRGBA:!0,requestType:u},h={imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};je(this.element,We.PRE_STACK_NEW_IMAGE,h),ks.addRequest(s.bind(this,e,n,g),u,d,c)})}successCallback(e,n){const r=this.imageIds.indexOf(e);if(this.currentImageIdIndex!==r)return;const i=this.csImage?.imageFrame,a=n?.imageFrame,o=i?.photometricInterpretation||this.csImage?.photometricInterpretation,s=a?.photometricInterpretation||n?.photometricInterpretation;o!==s&&(this.stackInvalidated=!0),this._setCSImage(n);const c={image:n,imageId:e,imageIdIndex:r,viewportId:this.id,renderingEngineId:this.renderingEngineId};this._updateActorToDisplayImageId(n),je(this.element,We.STACK_NEW_IMAGE,c),this.render(),this.currentImageIdIndex=r}errorCallback(e,n,r){if(!n)return;const i=this.imageIds.indexOf(e),a={error:r,imageIdIndex:i,imageId:e};je(Ye,We.IMAGE_LOAD_ERROR,a)}getLoaderImageOptions(e){const n=this.imageIds.indexOf(e),{transferSyntaxUID:r}=it("transferSyntax",e)||{};return{useRGBA:!1,transferSyntaxUID:r,priority:5,requestType:Nt.Interaction,additionalDetails:{imageId:e,imageIdIndex:n}}}async loadImages(e,n){const r=await Promise.allSettled(e.map(a=>{const o=this.getLoaderImageOptions(a);return j0(a,o).then(s=>(n.successCallback(a,s),a),s=>(n.errorCallback(a,!0,s),a))})),i=r.filter(a=>a.status==="rejected");if(i&&i.length){const a=new CustomEvent(We.IMAGE_LOAD_ERROR,{detail:i,cancelable:!0});Ye.dispatchEvent(a)}return r}_loadAndDisplayImageGPU(e,n){if(!e){console.warn("No image id set yet to load");return}const r={imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};return je(this.element,We.PRE_STACK_NEW_IMAGE,r),this.imagesLoader.loadImages([e],this).then(i=>e)}_updateToDisplayImageCPU(e){const n=this.getImageDataMetadata(e),r=u_(this.canvas,e,this.modality,this._cpuFallbackEnabledElement.viewport.colormap),{windowCenter:i,windowWidth:a,voiLUTFunction:o}=r.voi;this.voiRange=Qg(a,i,o),this._cpuFallbackEnabledElement.image=e,this._cpuFallbackEnabledElement.metadata={...n},this.cpuImagePixelData=e.voxelManager.getScalarData();const s=Object.assign({},r,this._cpuFallbackEnabledElement.viewport);this._cpuFallbackEnabledElement.viewport=this.stackInvalidated?r:s,this.stackInvalidated=!1,this.cpuRenderingInvalidated=!0,this._cpuFallbackEnabledElement.transform=S1(this._cpuFallbackEnabledElement)}getSliceViewInfo(){throw new Error("Method not implemented.")}addImages(e){const n=[];e.forEach(r=>{const{imageId:i,...a}=r,o=rt.getImage(i),{origin:s,dimensions:c,direction:u,spacing:d,numberOfComponents:g}=this.getImageDataMetadata(o),h=this.createVTKImageData({origin:s,dimensions:c,direction:u,spacing:d,numberOfComponents:g,pixelArray:o.voxelManager.getScalarData()}),m=this.createActorMapper(h);m&&(n.push({uid:r.actorUID??Ui(),actor:m,referencedId:i,...a}),r.callback&&r.callback({imageActor:m,imageId:r.imageId}))}),this.addActors(n)}_updateActorToDisplayImageId(e){const n=this._checkVTKImageDataMatchesCornerstoneImage(e,this._imageData),r=this.getViewPresentation();if(n&&!this.stackInvalidated){this._updateVTKImageDataFromCornerstoneImage(e),this.resetCameraNoEvent(),this.setViewPresentation(r),this._setPropertiesFromCache(),this.stackActorReInitialized=!1;return}const{origin:i,direction:a,dimensions:o,spacing:s,numberOfComponents:c,imagePixelModule:u}=this.getImageDataMetadata(e),d=e.voxelManager.getScalarData();this._createVTKImageData({origin:i,direction:a,dimensions:o,spacing:s,numberOfComponents:c,pixelArray:d}),this._updateVTKImageDataFromCornerstoneImage(e);const g=this.createActorMapper(this._imageData),h=this.getActors();h.length&&h[0].uid===this.id?h[0].actor=g:h.unshift({uid:this.id,actor:g,referencedId:e.imageId}),this.setActors(h);const{viewPlaneNormal:m,viewUp:y}=this._getCameraOrientation(a),v=this.getCamera();this.setCameraNoEvent({viewUp:y,viewPlaneNormal:m}),this.initialViewUp=y,this.resetCameraNoEvent(),this.setViewPresentation(r),this.triggerCameraEvent(this.getCamera(),v);const C=u.photometricInterpretation==="MONOCHROME1";this.stackInvalidated=!0;const S=this._getInitialVOIRange(e);this.setVOI(S,{forceRecreateLUTFunction:!!C}),this.initialInvert=!!C,this.setInvertColor(this.invert||this.initialInvert),this.stackInvalidated=!1,this.stackActorReInitialized=!0,this._publishCalibratedEvent&&this.triggerCalibrationEvent()}_getInitialVOIRange(e){if(this.voiRange&&this.voiUpdatedWithSetProperties)return this.voiRange;const{windowCenter:n,windowWidth:r,voiLUTFunction:i}=e;let a=this._getVOIRangeFromWindowLevel(r,n,i);return a=this._getPTPreScaledRange()||a,a}_getPTPreScaledRange(){if(this._isCurrentImagePTPrescaled())return this._getDefaultPTPrescaledVOIRange()}_isCurrentImagePTPrescaled(){return!(this.modality!=="PT"||!this.csImage.isPreScaled||!this.csImage.preScale?.scalingParameters.suvbw)}_getDefaultPTPrescaledVOIRange(){return{lower:0,upper:5}}_getVOIRangeFromWindowLevel(e,n,r=Pi.LINEAR){let i,a;if(typeof n=="number"&&typeof e=="number"?(i=n,a=e):Array.isArray(n)&&Array.isArray(e)&&(i=n[0],a=e[0]),i!==void 0&&a!==void 0)return Qg(a,i,r)}async _setImageIdIndex(e){if(e>=this.imageIds.length)throw new Error(`ImageIdIndex provided ${e} is invalid, the stack only has ${this.imageIds.length} elements`);this.currentImageIdIndex=e,this.hasPixelSpacing=!0,this.viewportStatus=qi.PRE_RENDER;const n=await this._loadAndDisplayImage(this.imageIds[e],e);if(this.perImageIdDefaultProperties.size>=1){const r=this.perImageIdDefaultProperties.get(n);r!==void 0?this.setProperties(r):this.globalDefaultProperties!==void 0&&this.setProperties(this.globalDefaultProperties)}return n}resetCameraCPU({resetPan:e=!0,resetZoom:n=!0}){const{image:r}=this._cpuFallbackEnabledElement;if(!r)return;OX(this._cpuFallbackEnabledElement,e,n);const{scale:i}=this._cpuFallbackEnabledElement.viewport,{clientWidth:a,clientHeight:o}=this.element,s=[a/2,o/2],c=this.canvasToWorldCPU(s);this.setCameraCPU({focalPoint:c,scale:i})}resetCameraGPU({resetPan:e,resetZoom:n}){return this.setCamera({flipHorizontal:!1,flipVertical:!1,viewUp:this.initialViewUp}),super.resetCamera({resetPan:e,resetZoom:n,resetToCenter:!0})}scroll(e,n=!0,r=!1){const i=this.imageIds;if(isNaN(this.targetImageIdIndex))return;const a=this.targetImageIdIndex,o=i.length;let s=a+e;r?s=(s+o)%o:s=Math.max(0,Math.min(o-1,s)),this.targetImageIdIndex=s;const c=i[s];rt.isLoaded(c)||!n?this.setImageIdIndex(s):(clearTimeout(this.debouncedTimeout),this.debouncedTimeout=window.setTimeout(()=>{this.setImageIdIndex(s)},40));const d={newImageIdIndex:s,imageId:c,direction:e};s!==a&&je(this.element,We.STACK_VIEWPORT_SCROLL,d)}setImageIdIndex(e){if(this._throwIfDestroyed(),this.currentImageIdIndex===e)return Promise.resolve(this.getCurrentImageId());const n=this._setImageIdIndex(e);return this.targetImageIdIndex=e,n}calibrateSpacing(e){const n=this.getImageIds().indexOf(e);this.stackInvalidated=!0,this._loadAndDisplayImage(e,n)}triggerCameraEvent(e,n){const r={previousCamera:n,camera:e,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};this.suppressEvents||je(this.element,We.CAMERA_MODIFIED,r)}triggerCalibrationEvent(){const{imageData:e}=this.getImageData(),n={element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,imageId:this.getCurrentImageId(),imageData:e,worldToIndex:e.getWorldToIndex(),...this._calibrationEvent};this.suppressEvents||je(this.element,We.IMAGE_SPACING_CALIBRATED,n),this._publishCalibratedEvent=!1}jumpToWorld(e){const n=this.getImageIds(),r=this.getImageData(),{direction:i,spacing:a}=r,o=w1({direction:i,spacing:a,imageIds:n},e,this.getCamera().viewPlaneNormal,{ignoreSpacing:!0}),s=n.indexOf(o);return s===-1?!1:(this.setImageIdIndex(s),this.render(),!0)}getRendererContextPool(){return this.getRenderingEngine().getRenderer(this.id)}getRendererTiled(){const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return e.offscreenMultiRenderWindow?.getRenderer(this.id)}_getVOIRangeForCurrentImage(){const{windowCenter:e,windowWidth:n,voiLUTFunction:r}=this.csImage;return this._getVOIRangeFromWindowLevel(n,e,r)}_getValidVOILUTFunction(e){return Object.values(Pi).includes(e)?e:Pi.LINEAR}getSliceInfo(){const e=this.getSliceIndex(),{dimensions:n}=this.getImageData();return{width:n[0],height:n[1],sliceIndex:e,slicePlane:2}}isReferenceViewable(e,n={}){const r=this.getCurrentImageIdIndex(),i=this.imageIds[r];if(!i||!e)return!1;const{referencedImageId:a,multiSliceReference:o}=e;if(a){if(a===i)return!0;e.referencedImageURI||=da(a);const{referencedImageURI:c}=e,u=this.imageKeyToIndexMap.get(c);if(n.asOverlay&&this.matchImagesForOverlay(i,a))return!0;if(u===void 0)return!1;if(n.withNavigation)return!0;const d=o&&this.imageKeyToIndexMap.get(o.referencedImageId);return r<=d&&r>=u}if(!super.isReferenceViewable(e,{...n,withOrientation:n?.asVolume}))return!1;if(e.volumeId||e.FrameOfReferenceUID)return n.asVolume;const{cameraFocalPoint:s}=e;if(n.asNearbyProjection&&s){const{spacing:c,direction:u,origin:d}=this.getImageData(),g=u.slice(6,9),h=W1({direction:u,spacing:c},g),m=ei(Ke(),s,d),y=ft(m,g),v=h/2;if(Math.abs(y)<=v)return!0}return!1}getViewReference(e={}){const{sliceIndex:n=this.getCurrentImageIdIndex()}=e,r=super.getViewReference(e),i=this.getCurrentImageId(n);if(i){if(r.referencedImageId=i,this.getCurrentImageIdIndex()!==n){const a=this.getImagePlaneReferenceData(n);if(!a)return;Object.assign(r,a)}return r}}setViewReference(e){if(!e?.referencedImageId){e?.sliceIndex!==void 0&&this.scroll(e.sliceIndex-this.targetImageIdIndex);return}const{referencedImageId:n}=e;e.referencedImageURI||=da(n);const{referencedImageURI:r}=e,i=this.imageKeyToIndexMap.get(r);if(i===void 0){kC.error(`No image URI found for ${r}`);return}this.scroll(i-this.targetImageIdIndex)}getViewReferenceId(e={}){const{sliceIndex:n=this.currentImageIdIndex}=e;return`imageId:${this.imageIds[n]}`}getSliceIndexForImage(e){if(e){if(typeof e=="string")return this.imageKeyToIndexMap.get(e);if(e.referencedImageId)return this.imageKeyToIndexMap.get(e.referencedImageId)}}getCPUFallbackError(e){return new Error(`method ${e} cannot be used during CPU Fallback mode`)}fillWithBackgroundColor(){const e=this.getRenderingEngine();e&&e.fillCanvasWithBackgroundColor(this.canvas,this.options.background)}unsetColormapCPU(){delete this._cpuFallbackEnabledElement.viewport.colormap,this._cpuFallbackEnabledElement.renderingTools={},this.cpuRenderingInvalidated=!0,this.fillWithBackgroundColor(),this.render()}setColormapCPU(e){this.colormap=e;const n=T1(e.name);this._cpuFallbackEnabledElement.viewport.colormap=n,this._cpuFallbackEnabledElement.renderingTools={},this.fillWithBackgroundColor(),this.cpuRenderingInvalidated=!0,this.render();const r={viewportId:this.id,colormap:e};je(this.element,We.COLORMAP_MODIFIED,r)}setColormapGPU(e){const i=this.getDefaultActor().actor.getProperty(),a=i.getRGBTransferFunction(),o=T1(e.name)||v1.getPresetByName(e.name);if(a)a.applyColorMap(o),a.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,a);else{const c=Xc.newInstance();c.applyColorMap(o),c.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,c)}this.colormap=e,this.render();const s={viewportId:this.id,colormap:e};je(this.element,We.COLORMAP_MODIFIED,s)}unsetColormapGPU(){throw new Error("unsetColormapGPU not implemented.")}_getImagePlaneModule(e){const n=QD(e);return this.hasPixelSpacing=!n.usingDefaultValues||this.calibration?.scale>0||this.calibration?.rowPixelSpacing>0,this.calibration||=n.calibration,n}isInAcquisitionPlane(){return!0}}function I0(t,e){const{imageData:n}=t.getImageData(),r=t.canvasToWorld(e);return Vc(n,r)}function Y2(t,e){return t.indexToWorld(e)}function _X(t,e){const{imageData:n}=t.getImageData(),r=Y2(n,e);return t.worldToCanvas(r)}class Io extends Vo{constructor(e){super(e),this._useAcquisitionPlaneForViewPlane=!1,this.getNumberOfSlices=()=>{const{numberOfSlices:r}=q2(this)||{};return r},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetRotation:!1,suppressEvents:!0}),this.getCurrentImageIdIndex=(r,i=!0)=>{const{currentStepIndex:a}=Xu(this,r||this.getVolumeId(),i);return a},this.getSliceIndex=()=>{const{imageIndex:r}=q2(this)||{};return r},this.getCurrentImageId=()=>{const r=this.getDefaultActor();if(!r||!Aa(r,"vtkVolume"))return;const i=rt.getVolume(this.getVolumeId());if(!i)return;const{viewPlaneNormal:a,focalPoint:o}=this.getCamera();return w1(i,o,a)},this.getSlicePlaneCoordinates=()=>{const r=this.getDefaultActor();if(!r?.actor)return console.warn("No image data found for calculating vtkPlanes."),[];const i=this.getVolumeId(),a=rt.getVolume(i),o=this.getCamera(),{focalPoint:s,position:c,viewPlaneNormal:u}=o,d=W1(a,u),g=Lp(r.actor,u,s),h=Math.round((g.current-g.min)/d),m=Math.round((g.max-g.current)/d),y=this.getSliceIndex(),v=[];for(let C=-h;C<=m;C++){const{newFocalPoint:S}=Zu(s,c,g,u,d,C);v.push({sliceIndex:y+C,point:S})}return v};const{orientation:n}=this.options;if(n&&n!==k0.ACQUISITION){this.applyViewOrientation(n);return}this._useAcquisitionPlaneForViewPlane=!0}async setVolumes(e,n=!1,r=!1){const i=e[0].volumeId,a=rt.getVolume(i);if(!a)throw new Error(`imageVolume with id: ${i} does not exist`);return this._useAcquisitionPlaneForViewPlane?(this._setViewPlaneToAcquisitionPlane(a),this._useAcquisitionPlaneForViewPlane=!1):this.options.orientation&&typeof this.options.orientation=="string"&&this.options.orientation.includes("_reformat")&&this._setViewPlaneToReformatOrientation(this.options.orientation,a),super.setVolumes(e,n,r)}async addVolumes(e,n=!1,r=!1){const i=rt.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane?(this._setViewPlaneToAcquisitionPlane(i),this._useAcquisitionPlaneForViewPlane=!1):this.options.orientation&&typeof this.options.orientation=="string"&&this.options.orientation.includes("_reformat")&&this._setViewPlaneToReformatOrientation(this.options.orientation,i),super.addVolumes(e,n,r)}jumpToWorld(e){const{focalPoint:n}=this.getCamera(),r=[0,0,0];hn(r,e,n);const i=this.getCamera(),a=i.viewPlaneNormal,o=ft(r,a),s=on(a[0],a[1],a[2]);if(bs(s,s,o),Math.abs(s[0])>.001||Math.abs(s[1])>.001||Math.abs(s[2])>.001){const c=[0,0,0],u=[0,0,0];z0(c,i.focalPoint,s),z0(u,i.position,s),this.setCamera({focalPoint:c,position:u}),this.render()}return!0}setOrientation(e,n=!0){let r,i;if(typeof e=="string"){if(e===k0.ACQUISITION)({viewPlaneNormal:r,viewUp:i}=super._getAcquisitionPlaneOrientation());else if(e===k0.REFORMAT||e.includes("_reformat"))({viewPlaneNormal:r,viewUp:i}=qD(this,{useViewportNormal:!0}));else if(Pc[e])({viewPlaneNormal:r,viewUp:i}=Pc[e]);else throw new Error(`Invalid orientation: ${e}. Use Enums.OrientationAxis instead.`);this.setCamera({viewPlaneNormal:r,viewUp:i}),this.viewportProperties.orientation=e,this.resetCamera()}else({viewPlaneNormal:r,viewUp:i}=e),this.applyViewOrientation(e);n&&this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();if(!e){console.warn("No active camera found");return}e.getParallelProjection()?e.setClippingRange(-fr.MAXIMUM_RAY_DISTANCE,fr.MAXIMUM_RAY_DISTANCE):e.setClippingRange(fr.MINIMUM_SLAB_THICKNESS,fr.MAXIMUM_RAY_DISTANCE)}_setViewPlaneToReformatOrientation(e,n){let r,i;if(n){const{direction:a}=n;({viewPlaneNormal:r,viewUp:i}=jD(a.slice(0,3),a.slice(3,6),a.slice(6,9),e))}else({viewPlaneNormal:r,viewUp:i}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:r,viewUp:i}),this.initialViewUp=i,this.resetCamera()}_setViewPlaneToAcquisitionPlane(e){let n,r;if(e){const{direction:i}=e;n=i.slice(6,9).map(a=>-a),r=i.slice(3,6).map(a=>-a)}else({viewPlaneNormal:n,viewUp:r}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:n,viewUp:r}),this.initialViewUp=r,this.resetCamera()}getBlendMode(e){const n=this.getActors(),r=e?.length>0?n.find(i=>e.includes(i.uid)):n[0];return r?.blendMode||r?.actor.getMapper().getBlendMode()}setBlendMode(e,n=[],r=!1){let i=this.getActors();n?.length>0&&(i=i.filter(a=>n.includes(a.uid))),i.forEach(a=>{const{actor:o}=a;o.getMapper().setBlendMode?.(e),a.blendMode=e}),r&&this.render()}resetCamera(e){const{resetPan:n=!0,resetZoom:r=!0,resetRotation:i=!0,resetToCenter:a=!0,suppressEvents:o=!1,resetOrientation:s=!0}=e||{},{orientation:c}=this.viewportProperties;c&&s&&this.applyViewOrientation(c,!1),super.resetCamera({resetPan:n,resetZoom:r,resetToCenter:a});const u=this.getVtkActiveCamera(),d=u.getViewPlaneNormal(),g=u.getFocalPoint();if(this.getActors().forEach(m=>{if(!m.actor)return;const y=m.actor.getMapper();if(y.getClippingPlanes().length===0&&!m?.clippingFilter){const C=Ki.newInstance(),S=Ki.newInstance(),w=[C,S];let x=fr.MINIMUM_SLAB_THICKNESS;m.slabThickness&&(x=m.slabThickness),this.setOrientationOfClippingPlanes(w,x,d,g),y.addClippingPlane(C),y.addClippingPlane(S)}}),i&&Pc[this.viewportProperties.orientation]!==void 0){const m=Pc[this.viewportProperties.orientation];this.setCameraNoEvent({viewUp:m.viewUp,viewPlaneNormal:m.viewPlaneNormal})}if(!o){const m={viewportId:this.id,camera:this.getCamera(),renderingEngineId:this.renderingEngineId,element:this.element};je(this.element,We.CAMERA_RESET,m)}return!0}setSlabThickness(e,n=[]){e<.1&&(e=.1);let r=this.getActors();n?.length>0&&(r=r.filter(a=>n.includes(a.uid))),r.forEach(a=>{Aa(a,"vtkVolume")&&(a.slabThickness=e)});const i=this.getCamera();this.updateClippingPlanesForActors(i),this.triggerCameraModifiedEventIfNecessary(i,i),this.viewportProperties.slabThickness=e}resetSlabThickness(){this.getActors().forEach(r=>{Aa(r,"vtkVolume")&&(r.slabThickness=fr.MINIMUM_SLAB_THICKNESS)});const n=this.getCamera();this.updateClippingPlanesForActors(n),this.triggerCameraModifiedEventIfNecessary(n,n),this.viewportProperties.slabThickness=void 0}isInAcquisitionPlane(){const e=this.getImageData();if(!e)return!1;const{direction:n}=e,{viewPlaneNormal:r}=this.getCamera(),i=[n[6],n[7],n[8]];return Math.abs(ft(r,i))>.99}getSliceViewInfo(){const{width:e,height:n}=this.getCanvas(),r=I0(this,[0,0]),i=I0(this,[e-1,0]),a=I0(this,[0,n-1]),o=hn(Ke(),i,r),s=hn(Ke(),a,r),c=Cn(Ke(),o,s);Sn(o,o),Sn(s,s),Sn(c,c);const{dimensions:u}=this.getImageData(),[d,g,h]=u,v=[[0,0,0],[d-1,0,0],[0,g-1,0],[d-1,g-1,0],[0,0,h-1],[d-1,0,h-1],[0,g-1,h-1],[d-1,g-1,h-1]].map(F=>_X(this,F)).reduce((F,$)=>(F.minX=Math.min(F.minX,$[0]),F.minY=Math.min(F.minY,$[1]),F.maxX=Math.max(F.maxX,$[0]),F.maxY=Math.max(F.maxY,$[1]),F),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),C=I0(this,[v.minX,v.minY]),S=gE(o[0],o[1],o[2],0,s[0],s[1],s[2],0,c[0],c[1],c[2],0,C[0],C[1],C[2],1),w=I0(this,[v.maxX,v.maxY]),x=hn(Ke(),w,C),R=Br(Ps(),S),{viewPlaneNormal:O}=this.getCamera();if(O.filter(F=>Math.abs(F)>Lo).length>1)throw new Error("getSliceInfo is not supported for oblique views");const I=O.findIndex(F=>Math.abs(F)>1-Lo);if(I===-1)throw new Error("Unable to determine slice axis");const G=ft(o,x)+1,j=ft(s,x)+1;return{sliceIndex:this.getSliceIndex(),width:G,height:j,slicePlane:I,sliceToIndexMatrix:S,indexToSliceMatrix:R}}getCurrentSlicePixelData(){const{voxelManager:e}=this.getImageData();return e.getSliceData(this.getSliceViewInfo())}getViewReference(e={}){const n=super.getViewReference(e);if(!n?.volumeId)return;const r=rt.getVolume(n.volumeId);return n.referencedImageId=w1(r,n.cameraFocalPoint,n.viewPlaneNormal),n}resetProperties(e){this._resetProperties(e)}_resetProperties(e){const n=e?this.getActor(e):this.getDefaultActor();if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);n.slabThickness&&(n.slabThickness=fr.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||=this.getVolumeId();const r=rt.getVolume(e);if(!r)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(L8(n.actor,r),Jo(n)){const u=n.actor.getProperty().getRGBTransferFunction(0);Tp(u,this.initialTransferFunctionNodes)}const i={...super.getVOIModifiedEventDetail(e)};this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetCameraRotation:!0}),je(this.element,We.VOI_MODIFIED,i)}getSlicesClippingPlanes(){const e=this.getSlicePlaneCoordinates(),{viewPlaneNormal:n}=this.getCamera(),r=fr.MINIMUM_SLAB_THICKNESS;return e.map(({point:i,sliceIndex:a})=>{const o=[Ki.newInstance(),Ki.newInstance()];return this.setOrientationOfClippingPlanes(o,r,n,i),{sliceIndex:a,planes:o.map(s=>({normal:s.getNormal(),origin:s.getOrigin()}))}})}}class G8 extends Vo{constructor(e){super(e),this.getNumberOfSlices=()=>1,this.getRotation=()=>0,this.getCurrentImageIdIndex=()=>0,this.getCurrentImageId=()=>null,this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0});const{parallelProjection:n,orientation:r}=this.options,i=this.getVtkActiveCamera();n!=null&&i.setParallelProjection(n),r&&r!==k0.ACQUISITION&&this.applyViewOrientation(r)}isInAcquisitionPlane(){return!1}resetCamera({resetPan:e=!0,resetZoom:n=!0,resetToCenter:r=!0}={}){super.resetCamera({resetPan:e,resetZoom:n,resetToCenter:r});const i=this.getVtkActiveCamera();return i.getParallelProjection()?i.setClippingRange(-fr.MAXIMUM_RAY_DISTANCE,fr.MAXIMUM_RAY_DISTANCE):i.setClippingRange(fr.MINIMUM_SLAB_THICKNESS,fr.MAXIMUM_RAY_DISTANCE),this.getRenderer().resetCameraClippingRange(),!0}setSlabThickness(e,n){return null}setBlendMode(e,n,r){return null}resetProperties(e){const n=e?this.getActor(e):this.getDefaultActor();if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);n.slabThickness&&(n.slabThickness=fr.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||=this.getVolumeId();const r=rt.getVolume(e);if(!r)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(L8(n.actor,r),Jo(n)){const i=n.actor.getProperty().getRGBTransferFunction(0);Tp(i,this.initialTransferFunctionNodes)}this.setCamera(this.initialCamera),je(this.element,We.VOI_MODIFIED,super.getVOIModifiedEventDetail(e))}getSliceIndex(){return null}setCamera(e){super.setCamera(e),this.getRenderer().resetCameraClippingRange(),this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();e.getParallelProjection()?e.setClippingRange(-fr.MAXIMUM_RAY_DISTANCE,fr.MAXIMUM_RAY_DISTANCE):e.setClippingRange(fr.MINIMUM_SLAB_THICKNESS,fr.MAXIMUM_RAY_DISTANCE)}resetSlabThickness(){return null}}async function bX(t,e,n,r=!1,i=!1){n.forEach(o=>{const s=t.getViewport(o);if(!s)throw new Error(`Viewport with Id ${o} does not exist`);if(!(s instanceof Vo))throw new Error("setVolumesForViewports only supports VolumeViewport and VolumeViewport3D")});const a=n.map(async o=>{await t.getViewport(o).setVolumes(e,r,i)});await Promise.all(a)}async function MX(t,e,n,r=!1,i=!1){for(const o of n){const s=t.getViewport(o);if(!s)throw new Error(`Viewport with Id ${o} does not exist`);if(!(s instanceof Vo)){console.warn(`Viewport with Id ${o} is not a BaseVolumeViewport. Cannot add volume to this viewport.`);return}}const a=n.map(async o=>{await t.getViewport(o).addVolumes(e,r,i)});await Promise.all(a)}function LX(t,e,n){for(const r of n){const i=t.getViewport(r);if(!i)throw new Error(`Viewport with Id ${r} does not exist`);if(!i.addImages){console.warn(`Viewport with Id ${r} does not have addImages. Cannot add image segmentation to this viewport.`);return}}n.forEach(r=>{t.getViewport(r).addImages(e)})}class VX{constructor(e){this.opacity=.4,this.outlineOpacity=.4,this.transferFunction=[],this.actor=e}setRGBTransferFunction(e,n){this.transferFunction[e]=n}setScalarOpacity(e){}setInterpolationTypeToNearest(){}setUseLabelOutline(){}setLabelOutlineOpacity(e){this.outlineOpacity=e}setLabelOutlineThickness(){}getColor(e){const n=this.transferFunction[0],r=n.getRedValue(e),i=n.getGreenValue(e),a=n.getBlueValue(e);return[r,i,a,this.opacity]}}class IX{constructor(e){this.actor=e}getInputData(){return this.actor.getImage()}}class AX{constructor(e,n){this.canvasProperties=new VX(this),this.visibility=!1,this.mapper=new IX(this),this.className="CanvasActor",this.derivedImage=n,this.viewport=e}renderRLE(e,n,r){const{width:i,height:a}=this.image;let{canvas:o}=this;(!o||o.width!==i||o.height!==a)&&(this.canvas=o=new window.OffscreenCanvas(i,a));const s=o.getContext("2d"),c=s.createImageData(i,a),{data:u}=c;u.fill(0);const{map:d}=r;let g=1/0,h=1/0,m=-1/0,y=-1/0;for(let S=0;S<a;S++){const w=d.getRun(S,0);if(!w)continue;h=Math.min(h,S),y=Math.max(y,S);const x=S*i<<2;let R;for(const O of w){const{start:b,end:I,value:G}=O;if(G===0){R||=[],R.push(w.indexOf(O));continue}g=Math.min(g,b),m=Math.max(m,I);const j=this.canvasProperties.getColor(G).map($=>$*255);let F=x+(b<<2);for(let $=b;$<I;$++)u[F++]=j[0],u[F++]=j[1],u[F++]=j[2],u[F++]=j[3]}}if(g>i)return;const v=m-g,C=y-h;s.putImageData(c,0,0,g-1,h-1,v+2,C+2),n.drawImage(o,g,h,v,C,g,h,v,C)}setMapper(e){this.mapper=e}render(e,n){if(!this.visibility)return;const r=this.image||this.getImage(),{width:i,height:a}=r,o=r.getScalarData();if(!o)return;const{voxelManager:s}=r;if(s&&s.map.getRun){this.renderRLE(e,n,s);return}let{canvas:c}=this;(!c||c.width!==i||c.height!==a)&&(this.canvas=c=new window.OffscreenCanvas(i,a));const u=c.getContext("2d"),d=u.createImageData(i,a),{data:g}=d;let h=0,m=0,y=1/0,v=1/0,C=-1/0,S=-1/0;for(let R=0;R<a;R++)for(let O=0;O<i;O++){const b=o[h++];if(b){y=Math.min(O,y),v=Math.min(R,v),C=Math.max(O,C),S=Math.max(R,S);const I=this.canvasProperties.getColor(b);g[m]=I[0]*255,g[m+1]=I[1]*255,g[m+2]=I[2]*255,g[m+3]=127}m+=4}if(y>i)return;const w=C-y+1,x=S-v+1;u.putImageData(d,0,0,y,v,w,x),n.drawImage(c,y,v,w,x,y,v,w,x)}getClassName(){return this.className}getProperty(){return this.canvasProperties}setVisibility(e){this.visibility=e}getMapper(){return this.mapper}isA(e){return e===this.className}getImage(){if(this.image)return this.image;this.image={...this.derivedImage};const e=this.viewport.getImageData();return Object.assign(this.image,{worldToIndex:n=>e.imageData.worldToIndex(n),indexToWorld:(n,r)=>e.imageData.indexToWorld(n,r),getDimensions:()=>e.dimensions,getScalarData:()=>this.derivedImage?.getPixelData(),getDirection:()=>e.direction,getSpacing:()=>e.spacing,setOrigin:()=>null,setDerivedImage:n=>{this.derivedImage=n,this.image=null},modified:()=>null}),this.image}}const _y=class _y{static imageIdToFrames(e){const n=e.match(this.frameRangeExtractor);if(!n||!n[2])return null;const r=n[2].split("-").map(i=>Number(i));return r.length===1?r[0]:r}static imageIdToFrameEnd(e){const n=this.imageIdToFrames(e);return Array.isArray(n)?n[1]:n}static imageIdToFrameStart(e){const n=this.imageIdToFrames(e);return Array.isArray(n)?n[0]:n}static framesToString(e){return Array.isArray(e)?`${e[0]}-${e[1]}`:String(e)}static framesToImageId(e,n){const r=e.match(this.frameRangeExtractor);if(!r||!r[2])return null;const i=this.framesToString(n);return e.replace(this.frameRangeExtractor,`${r[1]}${i}`)}};_y.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let Qu=_y;const f1=class f1 extends cf{constructor(e){super({...e,canvas:e.canvas||Mo(e.element)}),this.videoWidth=0,this.videoHeight=0,this.loop=!0,this.mute=!0,this.isPlaying=!1,this.scrollSpeed=1,this.playbackRate=1,this.frameRange=[0,0],this.fps=30,this.videoCamera={panWorld:[0,0],parallelScale:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({loop:this.videoElement.loop,muted:this.videoElement.muted,playbackRate:this.playbackRate,scrollSpeed:this.scrollSpeed,voiRange:{...this.voiRange}}),this.getMiddleSliceData=()=>{throw new Error("Method not implemented.")},this.useCustomRenderingPipeline=!0,this.resetCamera=()=>(this.refreshRenderValues(),this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame(),!0),this.getNumberOfSlices=()=>{const n=Math.round(this.videoElement.duration*this.fps/this.scrollSpeed);return isNaN(n)?this.numberOfFrames:n},this.getFrameOfReferenceUID=()=>this.videoElement.src,this.resize=()=>{const n=this.canvas,{clientWidth:r,clientHeight:i}=n;(n.width!==r||n.height!==i)&&(n.width=r,n.height=i),this.refreshRenderValues(),this.isPlaying||this.renderFrame()},this.canvasToWorld=(n,r=[0,0,0])=>{const i=this.videoCamera.panWorld,a=this.getWorldToCanvasRatio(),o=[i[0]*a,i[1]*a],s=[n[0]-o[0],n[1]-o[1]];return r.splice(0,2,s[0]/a,s[1]/a),r},this.worldToCanvas=n=>{const r=this.videoCamera.panWorld,i=this.getWorldToCanvasRatio();return[(n[0]+r[0])*i,(n[1]+r[1])*i]},this.getRotation=()=>0,this.canvasToIndex=n=>{const r=this.getTransform();return r.invert(),r.transformPoint(n.map(i=>i*devicePixelRatio))},this.indexToCanvas=n=>this.getTransform().transformPoint(n).map(i=>i/devicePixelRatio),this.customRenderViewportToCanvas=()=>{this.renderFrame()},this.renderFrame=()=>{const n=window.devicePixelRatio||1,i=this.getTransform().getMatrix(),a=this.canvasContext;a.resetTransform(),a.clearRect(0,0,this.canvas.width,this.canvas.height),a.transform(i[0]/n,i[1]/n,i[2]/n,i[3]/n,i[4]/n,i[5]/n),a.drawImage(this.videoElement,0,0,this.videoWidth,this.videoHeight);for(const s of this.getActors())s.actor.render(this,this.canvasContext);this.canvasContext.resetTransform(),je(this.element,We.STACK_NEW_IMAGE,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),je(this.element,We.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,imageIndex:this.getCurrentImageIdIndex(),numberOfSlices:this.numberOfFrames,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),this.initialRender?.();const o=this.getFrameNumber();this.isPlaying&&(o<this.frameRange[0]?this.setFrameNumber(this.frameRange[0]):o>this.frameRange[1]&&(this.loop?this.setFrameNumber(this.frameRange[0]):this.pause()))},this.renderWhilstPlaying=()=>{this.renderFrame(),this.isPlaying&&requestAnimationFrame(this.renderWhilstPlaying)},this.canvasContext=this.canvas.getContext("2d"),this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.videoElement=document.createElement("video"),this.videoElement.muted=this.mute,this.videoElement.loop=this.loop,this.videoElement.autoplay=!0,this.videoElement.crossOrigin="anonymous",this.addEventListeners(),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(We.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(We.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners(),this.videoElement.remove()}getImageDataMetadata(e){const n=typeof e=="string"?e:e.imageId,r=it(ga.IMAGE_PLANE,n);let i=r.rowCosines,a=r.columnCosines;(r.usingDefaultValues||i==null||a==null)&&(i=[1,0,0],a=[0,1,0]);const s=on(i[0],i[1],i[2]),c=on(a[0],a[1],a[2]),{rows:u,columns:d}=r,g=Ke();Cn(g,s,c);let h=r.imagePositionPatient;h==null&&(h=[0,0,0]);const m=r.columnPixelSpacing||1,y=r.rowPixelSpacing||1,v=r.columns,C=r.rows,S=1,w=1;return this.hasPixelSpacing=!!r.columnPixelSpacing,{bitsAllocated:8,numberOfComponents:3,origin:h,rows:u,columns:d,direction:[...s,...c,...g],dimensions:[v,C,w],spacing:[m,y,S],hasPixelSpacing:this.hasPixelSpacing,numVoxels:v*C*w,imagePlaneModule:r}}setDataIds(e,n){this.setVideo(e[0],(n.viewReference?.sliceIndex||0)+1)}setVideo(e,n){this.imageId=Array.isArray(e)?e[0]:e;const r=it(ga.IMAGE_URL,e);if(!r?.rendered)throw new Error(`Video Image ID ${e} does not have a rendered video view`);const{rendered:i}=r,a=it(ga.GENERAL_SERIES,e);this.modality=a?.Modality,this.metadata=this.getImageDataMetadata(e);let{cineRate:o,numberOfFrames:s}=it(ga.CINE,e);return this.numberOfFrames=s,this.setVideoURL(i).then(()=>((!s||s===1)&&(s=Math.round(this.videoElement.duration*(o||30))),o||(o=Math.round(s/this.videoElement.duration)),this.fps=o,this.numberOfFrames=s,this.setFrameRange([1,s]),this.initialRender=()=>{this.initialRender=null,this.pause(),this.setFrameNumber(n||1)},new Promise(c=>{window.setTimeout(()=>{this.setFrameNumber(n||1),c(this)},25)})))}async setVideoURL(e){return new Promise(n=>{this.videoElement.src=e,this.videoElement.preload="auto";const r=()=>{this.videoWidth=this.videoElement.videoWidth,this.videoHeight=this.videoElement.videoHeight,this.videoElement.removeEventListener("loadedmetadata",r),this.refreshRenderValues(),n(!0)};this.videoElement.addEventListener("loadedmetadata",r)})}getImageIds(){const e=new Array(this.numberOfFrames),n=this.imageId.replace(/[0-9]+$/,"");for(let r=0;r<this.numberOfFrames;r++)e[r]=`${n}${r+1}`;return e}togglePlayPause(){return this.isPlaying?(this.pause(),!1):(this.play(),!0)}async play(){try{this.isPlaying||(this.isPlaying=!0,await this.videoElement.play(),this.renderWhilstPlaying())}catch{}}pause(){try{this.isPlaying=!1,this.videoElement.pause()}catch{}}async scroll(e=1){await this.pause();const n=this.videoElement,r=this.renderFrame,a=n.currentTime+e*this.scrollSpeed/this.fps;n.currentTime=a;const o=s=>{r(),n.removeEventListener("seeked",o)};n.addEventListener("seeked",o)}async start(){const e=this.videoElement,n=this.renderFrame;if(e.currentTime=0,e.paused){const r=i=>{n(),e.removeEventListener("seeked",r)};e.addEventListener("seeked",r)}}async end(){const e=this.videoElement,n=this.renderFrame;if(e.currentTime=e.duration,e.paused){const r=i=>{n(),e.removeEventListener("seeked",r)};e.addEventListener("seeked",r)}}async setTime(e){const n=this.videoElement,r=this.renderFrame;if(n.currentTime=e,n.paused){const i=a=>{r(),n.removeEventListener("seeked",i)};n.addEventListener("seeked",i)}}getSliceViewInfo(){throw new Error("Method not implemented.")}async setFrameNumber(e){this.setTime((e-1)/this.fps)}setFrameRange(e){if(!e){this.frameRange=[1,this.numberOfFrames];return}e.length!==2||e[0]===e[1]||(this.frameRange=[e[0],e[1]])}getSliceIndexForImage(e){if(e){if(typeof e=="string")return Qu.imageIdToFrameStart(e);if(e.referencedImageId)return Qu.imageIdToFrameStart(e.referencedImageId)}}getFrameRange(){return this.frameRange}setProperties(e){e.loop!==void 0&&(this.videoElement.loop=e.loop),e.muted!==void 0&&(this.videoElement.muted=e.muted),e.playbackRate!==void 0&&this.setPlaybackRate(e.playbackRate),e.scrollSpeed!==void 0&&this.setScrollSpeed(e.scrollSpeed),e.voiRange&&this.setVOI(e.voiRange)}setPlaybackRate(e=1){if(this.playbackRate=e,e<.0625){this.pause();return}this.videoElement&&(this.videoElement.playbackRate=e,this.play())}setScrollSpeed(e=1,n=h1.FRAME){this.scrollSpeed=n===h1.SECOND?e*this.fps:e}resetProperties(){this.setProperties({loop:!1,muted:!0,voiRange:{lower:0,upper:255}})}getScalarData(){if(this.scalarData?.frameNumber===this.getFrameNumber())return this.scalarData;if(!this.videoElement||!this.videoElement.videoWidth||!this.videoElement.videoHeight){console.debug("Video not ready yet, returning empty scalar data");const a=new Uint8ClampedArray;return a.getRange=()=>[0,255],a.frameNumber=-1,a}const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");n.drawImage(this.videoElement,0,0);const i=n.getImageData(0,0,e.width,e.height).data;return i.getRange=()=>[0,255],i.frameNumber=this.getFrameNumber(),this.scalarData=i,i}getImageData(){const{metadata:e}=this,n=e.spacing,r={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:a=>{const o=this.worldToCanvas(a),s=this.canvasToIndex(o);return[s[0],s[1],0]},indexToWorld:(a,o)=>{const s=this.indexToCanvas([a[0],a[1]]);return this.canvasToWorld(s,o)}},i={dimensions:e.dimensions,spacing:n,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:e.FrameOfReferenceUID},getScalarData:()=>this.getScalarData(),scalarData:this.getScalarData(),imageData:r,voxelManager:{forEach:(a,o)=>MO(o.imageData,{pointInShapeFn:o.isInObject??(()=>!0),callback:a,boundsIJK:o.boundsIJK,returnPoints:o.returnPoints??!1})},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1}};return Object.defineProperty(r,"scalarData",{get:()=>this.getScalarData(),enumerable:!0}),i}hasImageURI(e){const n=e.match(f1.frameRangeExtractor),r=n?e.substring(0,n.index):e;return this.imageId.includes(r)}setVOI(e){this.voiRange=e;const n=this.setColorTransform(e,this.averageWhite);this.canvas.style.filter=n}setWindowLevel(e=256,n=128){const r=n-e/2,i=n+e/2-1;this.setVOI({lower:r,upper:i}),this.setColorTransform({lower:r,upper:i},this.averageWhite)}setAverageWhite(e){this.averageWhite=e,this.setColorTransform(this.voiRange,e)}setCamera(e){const{parallelScale:n,focalPoint:r}=e;if(n&&(this.videoCamera.parallelScale=this.element.clientHeight/2/n),r!==void 0){const i=this.worldToCanvas(r),a=[this.element.clientWidth/2,this.element.clientHeight/2],o=[(i[0]-a[0])/this.videoCamera.parallelScale,(i[1]-a[1])/this.videoCamera.parallelScale];this.videoCamera.panWorld=[this.videoCamera.panWorld[0]-o[0],this.videoCamera.panWorld[1]-o[1]]}this.canvasContext.fillStyle="rgba(0,0,0,1)",this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame()}getCurrentImageId(e=this.getCurrentImageIdIndex()){return this.imageId?.replace("/frames/1",`/frames/${e+1}`)}getViewReferenceId(e={}){const{sliceIndex:n}=e;return n===void 0?`videoId:${this.getCurrentImageId()}`:Array.isArray(n)?`videoId:${this.imageId.substring(0,this.imageId.length-1)}${n[0]+1}-${n[1]+1}`:`videoId:${this.imageId.replace("/frames/1",`/frames/${1+n}`)}`}isReferenceViewable(e,n={}){let{imageURI:r}=n;const{referencedImageId:i,sliceIndex:a,multiSliceReference:o}=e;if(!super.isReferenceViewable(e))return!1;const s=this.getCurrentImageId();if(!r){const h=s.indexOf(":");r=s.substring(h+1,s.length-1)}if(n.withNavigation)return!0;const c=this.getSliceIndex();if(o){const h=Qu.imageIdToFrameEnd(o.referencedImageId);return c>=a&&c<=h}if(a!==void 0)return c===a;if(!i)return!1;const u=i.match(f1.frameRangeExtractor);if(!u||!u[2])return!0;const d=u[2].split("-").map(h=>Number(h)),g=c+1;return d[0]<=g&&g<=(d[1]??d[0])}setViewReference(e){typeof e.sliceIndex=="number"?this.setFrameNumber(e.sliceIndex+1):Array.isArray(e.sliceIndex)&&this.setFrameRange(e.sliceIndex)}getViewReference(e){const n=e?.sliceIndex??(this.isPlaying?this.frameRange[0]:this.getCurrentImageIdIndex()),r=e?.rangeEndSliceIndex??(this.isPlaying?this.frameRange[1]-1:void 0),i=r>n?{sliceIndex:r,referencedImageId:this.getCurrentImageId(r)}:void 0;return{...super.getViewReference(e),referencedImageId:this.getViewReferenceId(e),sliceIndex:n,multiSliceReference:i}}getFrameNumber(){return 1+this.getCurrentImageIdIndex()}getCurrentImageIdIndex(){return Math.round(this.videoElement.currentTime*this.fps)}getSliceIndex(){return this.getCurrentImageIdIndex()/this.scrollSpeed}getCamera(){const{parallelScale:e}=this.videoCamera,n=[this.element.clientWidth/2,this.element.clientHeight/2];return{parallelProjection:!0,focalPoint:this.canvasToWorld(n),position:[0,0,0],viewUp:[0,-1,0],parallelScale:this.element.clientHeight/2/e,viewPlaneNormal:[0,0,1]}}getFrameRate(){return this.fps}getPan(){const e=this.videoCamera.panWorld;return[e[0],e[1]]}refreshRenderValues(){let e=this.canvas.offsetWidth/this.videoWidth;this.videoHeight*e>this.canvas.height&&(e=this.canvas.offsetHeight/this.videoHeight);const n=Math.floor(this.videoWidth*e),r=Math.floor(this.videoHeight*e),i=(this.canvas.offsetWidth-n)/2,a=(this.canvas.offsetHeight-r)/2,o=i/e,s=a/e;this.videoCamera.panWorld=[o,s],this.videoCamera.parallelScale=e}getWorldToCanvasRatio(){return this.videoCamera.parallelScale}getCanvasToWorldRatio(){return 1/this.videoCamera.parallelScale}getTransform(){const e=this.videoCamera.panWorld,n=window.devicePixelRatio||1,r=this.getWorldToCanvasRatio(),i=this.getCanvasToWorldRatio(),a=[this.canvas.offsetWidth/2,this.canvas.offsetHeight/2],o=[a[0]*i,a[1]*i],s=new Of;return s.scale(n,n),s.translate(a[0],a[1]),s.scale(r,r),s.translate(e[0],e[1]),s.translate(-o[0],-o[1]),s}updateCameraClippingPlanesAndRange(){}addImages(e){const n=this.getActors();e.forEach(r=>{const{imageId:i,...a}=r,o=rt.getImage(i),s=this.createActorMapper(o),c=r.actorUID??Ui();s&&(n.push({uid:c,actor:s,referencedId:i,...a}),r.callback&&r.callback({imageActor:s,imageId:i}))}),this.setActors(n)}createActorMapper(e){return new AX(this,e)}};f1.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let X4=f1;const NX=`
.DicomMicroscopyViewer {
  --ol-partial-background-color: rgba(127, 127, 127, 0.7);
  --ol-foreground-color: #000000;
  --ol-subtle-foreground-color: #000;
  --ol-subtle-background-color: rgba(78, 78, 78, 0.5);
}

.DicomMicroscopyViewer .ol-box {
  box-sizing: border-box;
  border-radius: 2px;
  border: 1.5px solid var(--ol-background-color);
  background-color: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-mouse-position {
  top: 8px;
  right: 8px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line {
  background: var(--ol-partial-background-color);
  border-radius: 4px;
  bottom: 8px;
  left: 8px;
  padding: 2px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line-inner {
  border: 1px solid var(--ol-subtle-foreground-color);
  border-top: none;
  color: var(--ol-foreground-color);
  font-size: 10px;
  text-align: center;
  margin: 1px;
  will-change: contents, width;
  transition: all 0.25s;
}

.DicomMicroscopyViewer .ol-scale-bar {
  position: absolute;
  bottom: 8px;
  left: 8px;
}

.DicomMicroscopyViewer .ol-scale-bar-inner {
  display: flex;
}

.DicomMicroscopyViewer .ol-scale-step-marker {
  width: 1px;
  height: 15px;
  background-color: var(--ol-foreground-color);
  float: right;
  z-index: 10;
}

.DicomMicroscopyViewer .ol-scale-step-text {
  position: absolute;
  bottom: -5px;
  font-size: 10px;
  z-index: 11;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-text {
  position: absolute;
  font-size: 12px;
  text-align: center;
  bottom: 25px;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar {
  position: relative;
  height: 10px;
  z-index: 9;
  box-sizing: border-box;
  border: 1px solid var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-even {
  background-color: var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-odd {
  background-color: var(--ol-background-color);
}

.DicomMicroscopyViewer .ol-unsupported {
  display: none;
}

.DicomMicroscopyViewer .ol-viewport,
.DicomMicroscopyViewer .ol-unselectable {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.DicomMicroscopyViewer .ol-viewport canvas {
  all: unset;
}

.DicomMicroscopyViewer .ol-selectable {
  -webkit-touch-callout: default;
  -webkit-user-select: text;
  -moz-user-select: text;
  user-select: text;
}

.DicomMicroscopyViewer .ol-grabbing {
  cursor: -webkit-grabbing;
  cursor: -moz-grabbing;
  cursor: grabbing;
}

.DicomMicroscopyViewer .ol-grab {
  cursor: move;
  cursor: -webkit-grab;
  cursor: -moz-grab;
  cursor: grab;
}

.DicomMicroscopyViewer .ol-control {
  position: absolute;
  background-color: var(--ol-subtle-background-color);
  border-radius: 4px;
}

.DicomMicroscopyViewer .ol-zoom {
  top: 0.5em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-rotate {
  top: 0.5em;
  right: 0.5em;
  transition:
    opacity 0.25s linear,
    visibility 0s linear;
}

.DicomMicroscopyViewer .ol-rotate.ol-hidden {
  opacity: 0;
  visibility: hidden;
  transition:
    opacity 0.25s linear,
    visibility 0s linear 0.25s;
}

.DicomMicroscopyViewer .ol-zoom-extent {
  top: 4.643em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-full-screen {
  right: 0.5em;
  top: 0.5em;
}

.DicomMicroscopyViewer .ol-control button {
  display: block;
  margin: 1px;
  padding: 0;
  color: var(--ol-subtle-foreground-color);
  font-weight: bold;
  text-decoration: none;
  font-size: inherit;
  text-align: center;
  height: 1.375em;
  width: 1.375em;
  line-height: 0.4em;
  background-color: var(--ol-background-color);
  border: none;
  border-radius: 2px;
}

.DicomMicroscopyViewer .ol-control button::-moz-focus-inner {
  border: none;
  padding: 0;
}

.DicomMicroscopyViewer .ol-zoom-extent button {
  line-height: 1.4em;
}

.DicomMicroscopyViewer .ol-compass {
  display: block;
  font-weight: normal;
  will-change: transform;
}

.DicomMicroscopyViewer .ol-touch .ol-control button {
  font-size: 1.5em;
}

.DicomMicroscopyViewer .ol-touch .ol-zoom-extent {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-control button:hover,
.DicomMicroscopyViewer .ol-control button:focus {
  text-decoration: none;
  outline: 1px solid var(--ol-subtle-foreground-color);
  color: var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-in {
  border-radius: 2px 2px 0 0;
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-out {
  border-radius: 0 0 2px 2px;
}

.DicomMicroscopyViewer .ol-attribution {
  text-align: right;
  bottom: 0.5em;
  right: 0.5em;
  max-width: calc(100% - 1.3em);
  display: flex;
  flex-flow: row-reverse;
  align-items: center;
}

.DicomMicroscopyViewer .ol-attribution a {
  color: var(--ol-subtle-foreground-color);
  text-decoration: none;
}

.DicomMicroscopyViewer .ol-attribution ul {
  margin: 0;
  padding: 1px 0.5em;
  color: var(--ol-foreground-color);
  text-shadow: 0 0 2px var(--ol-background-color);
  font-size: 12px;
}

.DicomMicroscopyViewer .ol-attribution li {
  display: inline;
  list-style: none;
}

.DicomMicroscopyViewer .ol-attribution li:not(:last-child):after {
  content: ' ';
}

.DicomMicroscopyViewer .ol-attribution img {
  max-height: 2em;
  max-width: inherit;
  vertical-align: middle;
}

.DicomMicroscopyViewer .ol-attribution button {
  flex-shrink: 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-collapsed ul {
  display: none;
}

.DicomMicroscopyViewer .ol-attribution:not(.ol-collapsed) {
  background: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible {
  bottom: 0;
  right: 0;
  border-radius: 4px 0 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible img {
  margin-top: -0.2em;
  max-height: 1.6em;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-zoomslider {
  top: 4.5em;
  left: 0.5em;
  height: 200px;
}

.DicomMicroscopyViewer .ol-zoomslider button {
  position: relative;
  height: 10px;
}

.DicomMicroscopyViewer .ol-touch .ol-zoomslider {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-overviewmap {
  left: 0.5em;
  bottom: 0.5em;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible {
  bottom: 0;
  left: 0;
  border-radius: 0 4px 0 0;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap button {
  display: block;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map {
  border: 1px solid var(--ol-subtle-foreground-color);
  height: 150px;
  width: 150px;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) button {
  bottom: 0;
  left: 0;
  position: absolute;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-collapsed .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) {
  background: var(--ol-subtle-background-color);
}

.DicomMicroscopyViewer .ol-overviewmap-box {
  border: 0.5px dotted var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-box:hover {
  cursor: move;
}

@layout-header-background: #007ea3;
@primary-color: #007ea3;
@processing-color: #8cb8c6;
@success-color: #3f9c35;
@warning-color: #eeaf30;
@error-color: #96172e;
@font-size-base: 14px;

.DicomMicroscopyViewer .ol-tooltip {
  font-size: 16px !important;
}
`;let Og=null;const GC=Symbol.for("map"),BC=Symbol.for("affine"),PX="postrender",qu=class qu extends cf{constructor(e){super({...e,canvas:e.canvas||Mo(e.element)}),this.internalCamera={rotation:0,centerIndex:[0,0],extent:[0,-2,1,-1],xSpacing:1,ySpacing:1,resolution:1,zoom:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({voiRange:{...this.voiRange}}),this.resetCamera=()=>!0,this.getNumberOfSlices=()=>1,this.getFrameOfReferenceUID=()=>this.frameOfReferenceUID,this.resize=()=>{const r=this.canvas,{clientWidth:i,clientHeight:a}=r;(r.width!==i||r.height!==a)&&(r.width=i,r.height=a),this.refreshRenderValues()},this.canvasToWorld=r=>{if(!this.metadata)return;const i=this.canvasToIndex(r);return i[1]=-i[1],this.indexToWorld(i)},this.worldToCanvas=r=>{if(!this.metadata)return;const i=this.worldToIndex(r);return i[1]=-i[1],this.indexToCanvas([i[0],i[1],0])},this.postrender=()=>{this.refreshRenderValues(),je(this.element,We.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId})},this.getRotation=()=>0,this.canvasToIndex=r=>{const i=this.getTransform();i.invert();const a=i.transformPoint(r.map(o=>o*devicePixelRatio));return[a[0],a[1],0]},this.indexToCanvas=r=>this.getTransform().transformPoint([r[0],r[1]]).map(a=>a/devicePixelRatio),this.customRenderViewportToCanvas=()=>{},this.getImageIds=()=>[this.imageIds[0]],this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.element.style.position="relative",this.microscopyElement=document.createElement("div"),this.microscopyElement.setAttribute("class","DicomMicroscopyViewer"),this.microscopyElement.id=Ui(),this.microscopyElement.innerText="Initial",this.microscopyElement.style.background="grey",this.microscopyElement.style.width="100%",this.microscopyElement.style.height="100%",this.microscopyElement.style.position="absolute",this.microscopyElement.style.left="0",this.microscopyElement.style.top="0";const n=this.element.firstElementChild;n.insertBefore(this.microscopyElement,n.childNodes[1]),this.addEventListeners(),this.addWidget("DicomMicroscopyViewer",{getEnabled:()=>!!this.viewer,setEnabled:()=>{this.elementDisabledHandler()}}),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(We.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(We.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners(),this.viewer?.cleanup(),this.viewer=null,this.element.firstElementChild.removeChild(this.microscopyElement),this.microscopyElement=null}getImageDataMetadata(e=0){const n=this.metadataDicomweb.reduce((j,F)=>j?.NumberOfFrames<F.NumberOfFrames?F:j),{TotalPixelMatrixColumns:r,TotalPixelMatrixRows:i,ImageOrientationSlide:a,ImagedVolumeWidth:o,ImagedVolumeHeight:s,ImagedVolumeDepth:c}=n,u=it(ga.IMAGE_PLANE,this.imageIds[e]);let d=a.slice(0,3),g=a.slice(3,6);(d==null||g==null)&&(d=[1,0,0],g=[0,1,0]);const h=on(d[0],d[1],d[2]),m=on(g[0],g[1],g[2]),y=Ke();Cn(y,h,m);const{XOffsetInSlideCoordinateSystem:v=0,YOffsetInSlideCoordinateSystem:C=0,ZOffsetInSlideCoordinateSystem:S=0}=n.TotalPixelMatrixOriginSequence?.[0]||{},w=[v,C,S],x=o/r,R=s/i,O=r,b=i,I=c,G=1;return this.hasPixelSpacing=!!(o&&s),{bitsAllocated:8,numberOfComponents:3,origin:w,direction:[...h,...m,...y],dimensions:[O,b,G],spacing:[x,R,I],hasPixelSpacing:this.hasPixelSpacing,numVoxels:O*b*G,imagePlaneModule:u}}async setFrameNumber(e){}setProperties(e){e.voiRange&&this.setVOI(e.voiRange)}resetProperties(){this.setProperties({voiRange:{lower:0,upper:255}})}setVOI(e){this.voiRange=e;const n=this.setColorTransform(e,this.averageWhite);this.map.getViewport().querySelectorAll(".ol-layers canvas").forEach(i=>{i.style.filter=n})}setAverageWhite(e){this.averageWhite=e,this.setColorTransform(this.voiRange,e)}getScalarData(){return null}computeTransforms(){const e=Ps(),n=Ps();return k1(e,this.metadata.origin),e[0]=this.metadata.direction[0],e[1]=this.metadata.direction[1],e[2]=this.metadata.direction[2],e[4]=this.metadata.direction[3],e[5]=this.metadata.direction[4],e[6]=this.metadata.direction[5],e[8]=this.metadata.direction[6],e[9]=this.metadata.direction[7],e[10]=this.metadata.direction[8],Us(e,e,this.metadata.spacing),Br(n,e),{indexToWorld:e,worldToIndex:n}}getImageData(){const{metadata:e}=this;if(!e)return null;const{spacing:n}=e,r={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:a=>this.worldToIndex(a),indexToWorld:a=>this.indexToWorld(a)};return{dimensions:e.dimensions,spacing:n,numberOfComponents:3,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.frameOfReferenceUID},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1},scalarData:this.getScalarData(),imageData:r}}hasImageURI(e){return!0}setCamera(e){const n=this.getCamera(),{parallelScale:r,focalPoint:i}=e,a=this.getView(),{xSpacing:o}=this.internalCamera;if(r){const c=this.element.clientHeight/r,u=1/o/c;a.setResolution(u)}if(i){const c=this.worldToCanvas(i),u=this.canvasToIndex(c);a.setCenter(u)}const s=this.getCamera();this.triggerCameraModifiedEventIfNecessary(n,s)}getCurrentImageId(){return this.imageIds[0]}getFrameNumber(){return 1}getCamera(){this.refreshRenderValues();const{resolution:e,xSpacing:n,centerIndex:r}=this.internalCamera,i=e*n,a=this.indexToCanvas([r[0],r[1],0]),o=this.canvasToWorld(a);return{parallelProjection:!0,focalPoint:o,position:o,viewUp:[0,-1,0],parallelScale:this.element.clientHeight*i,viewPlaneNormal:[0,0,1]}}worldToIndexWSI(e){if(!Og)return;const n=this.viewer[BC],r=Og.applyInverseTransform({coordinate:[e[0],e[1]],affine:n});return[r[0],r[1]]}indexToWorldWSI(e){if(!Og)return;const n=Og.applyTransform({coordinate:[e[0],e[1]],affine:this.viewer[BC]});return[n[0],n[1],0]}worldToIndex(e){const{worldToIndex:n}=this.computeTransforms(),r=Ke();return an(r,e,n),r}indexToWorld(e){const{indexToWorld:n}=this.computeTransforms(),r=Ke(),i=on(...e);return an(r,i,n),[r[0],r[1],r[2]]}setDataIds(e,n){n?.miniNavigationOverlay!==!1&&qu.addMiniNavigationOverlayCss();const r=n?.webClient||it(ga.WADO_WEB_CLIENT,e[0]);if(!r)throw new Error(`To use setDataIds on WSI data, you must provide metaData.webClient for ${e[0]}`);return this.setWSI(e,r)}async setWSI(e,n){this.microscopyElement.style.background="black",this.microscopyElement.innerText="Loading",this.imageIds=e;const r=await qu.getDicomMicroscopyViewer();Og||=r.utils,this.frameOfReferenceUID=null;const i=this.imageIds.map(s=>{const c=n.getDICOMwebMetadata(s);Object.defineProperty(c,"isMultiframe",{value:c.isMultiframe,enumerable:!1}),Object.defineProperty(c,"frameNumber",{value:void 0,enumerable:!1});const u=c["00080008"]?.Value;u?.length===1&&(c["00080008"].Value=u[0].split("\\"));const d=c["00200052"]?.Value?.[0];return this.frameOfReferenceUID?d!==this.frameOfReferenceUID&&(c["00200052"].Value=[this.frameOfReferenceUID]):this.frameOfReferenceUID=d,c}),a=[];i.forEach(s=>{const c=new r.metadata.VLWholeSlideMicroscopyImage({metadata:s}),u=c.ImageType[2];u==="VOLUME"||u==="THUMBNAIL"?a.push(c):console.log("Unknown image type",c.ImageType)}),this.metadataDicomweb=a;const o=new r.viewer.VolumeImageViewer({client:n,metadata:a,controls:["overview","position"],retrieveRendered:!1,bindings:{}});o.render({container:this.microscopyElement}),this.metadata=this.getImageDataMetadata(),o.deactivateDragPanInteraction(),this.viewer=o,this.map=o[GC],this.map.on(PX,this.postrender),this.resize(),this.microscopyElement.innerText="",Object.assign(this.microscopyElement.style,{"--ol-partial-background-color":"rgba(127, 127, 127, 0.7)","--ol-foreground-color":"#000000","--ol-subtle-foreground-color":"#000","--ol-subtle-background-color":"rgba(78, 78, 78, 0.5)",background:"none"})}scroll(e){const n=this.getCamera();this.setCamera({parallelScale:n.parallelScale*(1+.1*e)})}getSliceIndex(){return 0}getView(){if(!this.viewer)return;const e=this.viewer[GC],n=window;return n.map=e,n.viewer=this.viewer,n.view=e?.getView(),n.wsi=this,e?.getView()}refreshRenderValues(){const e=this.getView();if(!e)return;const n=e.getResolution();if(!n||n<Lo)return;const r=e.getCenter(),i=e.getProjection().getExtent(),a=e.getRotation(),o=e.getZoom(),{metadata:{spacing:[s,c]}}=this,u=1/n/s;Object.assign(this.internalCamera,{extent:i,centerIndex:r,worldToCanvasRatio:u,xSpacing:s,ySpacing:c,resolution:n,rotation:a,zoom:o})}getZoom(){return this.getView()?.getZoom()}setZoom(e){this.getView()?.setZoom(e)}getTransform(){this.refreshRenderValues();const{centerIndex:e,resolution:n,rotation:r}=this.internalCamera,i=[this.canvas.width/2,this.canvas.height/2],a=new Of;return a.translate(i[0],i[1]),a.rotate(r),a.scale(1/n,-1/n),a.translate(-e[0],-e[1]),a}getViewReferenceId(){return`imageId:${this.getCurrentImageId()}`}getCurrentImageIdIndex(){return 0}static addMiniNavigationOverlayCss(){if(document.getElementById(this.overlayCssId))return;const e=document.createElement("style");e.innerText=NX,e.setAttribute("id",this.overlayCssId),document.getElementsByTagName("head")[0].append(e)}};qu.getDicomMicroscopyViewer=async()=>bA("dicom-microscopy-viewer"),qu.overlayCssId="overlayCss";let Z4=qu;const f_={[yn.ORTHOGRAPHIC]:Io,[yn.PERSPECTIVE]:Io,[yn.STACK]:Na,[yn.VOLUME_3D]:G8,[yn.VIDEO]:X4,[yn.WHOLE_SLIDE]:Z4};function _s(t){return f_[t].useCustomRenderingPipeline}const Ma={WIDTH:160,HEIGHT:96,TEXT_PADDING:3,TEXT_Y_OFFSET:2,GRAPH_Y_OFFSET:15,GRAPH_WIDTH:150,GRAPH_HEIGHT:70,FONT_SIZE:9,FONT_FAMILY:"Helvetica,Arial,sans-serif",GRAPH_ALPHA:.9},wh={UPDATE_INTERVAL:1e3,MAX_MS_VALUE:200,MAX_FPS_VALUE:300,OVERLAY_STYLES:{position:"fixed",top:"0px",right:"0px",left:"auto",zIndex:"9999",cursor:"pointer",opacity:"0.9"}},N3={BYTES_TO_MB:1048576,MS_PER_SECOND:1e3},xc=[{name:"FPS",foregroundColor:"#0ff",backgroundColor:"#002"},{name:"MS",foregroundColor:"#0f0",backgroundColor:"#020"},{name:"MB",foregroundColor:"#f08",backgroundColor:"#201"}];class P3{constructor(e,n,r){this.minValue=1/0,this.maxValue=0,this.name=e,this.foregroundColor=n,this.backgroundColor=r,this.devicePixelRatio=Math.round(window.devicePixelRatio||1),this.dimensions=this.calculateDimensions(),this.dom=this.createCanvas(),this.context=this.initializeContext(),this.drawInitialPanel()}update(e,n){this.updateMinMax(e),this.clearTextArea(),this.drawText(e),this.scrollGraph(),this.drawNewValue(e,n)}calculateDimensions(){const e=this.devicePixelRatio;return{width:Ma.WIDTH*e,height:Ma.HEIGHT*e,textX:Ma.TEXT_PADDING*e,textY:Ma.TEXT_Y_OFFSET*e,graphX:Ma.TEXT_PADDING*e,graphY:Ma.GRAPH_Y_OFFSET*e,graphWidth:Ma.GRAPH_WIDTH*e,graphHeight:Ma.GRAPH_HEIGHT*e}}createCanvas(){const e=document.createElement("canvas");return e.width=this.dimensions.width,e.height=this.dimensions.height,e.style.cssText=`width:${Ma.WIDTH}px;height:${Ma.HEIGHT}px`,e}initializeContext(){const e=this.dom.getContext("2d");if(!e)throw new Error("Failed to get 2D context");return e.font=`bold ${Ma.FONT_SIZE*this.devicePixelRatio}px ${Ma.FONT_FAMILY}`,e.textBaseline="top",e}drawInitialPanel(){const{width:e,height:n,textX:r,textY:i,graphX:a,graphY:o,graphWidth:s,graphHeight:c}=this.dimensions;this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,e,n),this.context.fillStyle=this.foregroundColor,this.context.fillText(this.name,r,i),this.context.fillRect(a,o,s,c),this.context.fillStyle=this.backgroundColor,this.context.globalAlpha=Ma.GRAPH_ALPHA,this.context.fillRect(a,o,s,c),this.context.globalAlpha=1}updateMinMax(e){this.minValue=Math.min(this.minValue,e),this.maxValue=Math.max(this.maxValue,e)}clearTextArea(){const{width:e,graphY:n}=this.dimensions;this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,e,n)}drawText(e){const{textX:n,textY:r}=this.dimensions,i=this.formatText(e);this.context.fillStyle=this.foregroundColor,this.context.fillText(i,n,r)}formatText(e){const n=Math.round(e),r=Math.round(this.minValue),i=Math.round(this.maxValue);return`${n} ${this.name} (${r}-${i})`}scrollGraph(){const{graphX:e,graphY:n,graphWidth:r,graphHeight:i}=this.dimensions,a=this.devicePixelRatio;this.context.drawImage(this.dom,e+a,n,r-a,i,e,n,r-a,i)}drawNewValue(e,n){const{graphX:r,graphY:i,graphWidth:a,graphHeight:o}=this.dimensions,s=this.devicePixelRatio,c=r+a-s;this.context.fillStyle=this.foregroundColor,this.context.fillRect(c,i,s,o);const u=Math.round((1-e/n)*o);this.context.fillStyle=this.backgroundColor,this.context.globalAlpha=Ma.GRAPH_ALPHA,this.context.fillRect(c,i,s,u),this.context.globalAlpha=1}}var Ci;(function(t){t[t.FPS=0]="FPS",t[t.MS=1]="MS",t[t.MEMORY=2]="MEMORY"})(Ci||(Ci={}));var Ds;let UX=(Ds=class{constructor(){this.dom=null,this.currentMode=0,this.startTime=0,this.lastUpdateTime=0,this.frameCount=0,this.panels=new Map,this.animationFrameId=null,this.isSetup=!1}static getInstance(){return Ds.instance||(Ds.instance=new Ds),Ds.instance}setup(){if(!this.isSetup)try{this.dom=this.createOverlayElement(),this.startTime=performance.now(),this.lastUpdateTime=this.startTime,this.initializePanels(),this.showPanel(Ci.FPS),this.applyOverlayStyles(),document.body.appendChild(this.dom),this.startLoop(),this.isSetup=!0}catch(e){console.warn("Failed to setup stats overlay:",e)}}cleanup(){this.stopLoop(),this.dom&&this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.dom=null,this.panels.clear(),this.isSetup=!1}showPanel(e){Array.from(this.dom.children).forEach((r,i)=>{r.style.display=i===e?"block":"none"}),this.currentMode=e}update(){this.startTime=this.updateStats()}createOverlayElement(){const e=document.createElement("div");return e.addEventListener("click",this.handleClick.bind(this),!1),e}applyOverlayStyles(){Object.assign(this.dom.style,wh.OVERLAY_STYLES)}handleClick(e){e.preventDefault();const n=this.dom.children.length;this.showPanel((this.currentMode+1)%n)}initializePanels(){const e=new P3(xc[Ci.FPS].name,xc[Ci.FPS].foregroundColor,xc[Ci.FPS].backgroundColor);this.addPanel(Ci.FPS,e);const n=new P3(xc[Ci.MS].name,xc[Ci.MS].foregroundColor,xc[Ci.MS].backgroundColor);if(this.addPanel(Ci.MS,n),this.isMemoryAvailable()){const r=new P3(xc[Ci.MEMORY].name,xc[Ci.MEMORY].foregroundColor,xc[Ci.MEMORY].backgroundColor);this.addPanel(Ci.MEMORY,r)}}isMemoryAvailable(){return performance.memory!==void 0}addPanel(e,n){this.dom.appendChild(n.dom),this.panels.set(e,n)}startLoop(){const e=()=>{this.update(),this.animationFrameId=requestAnimationFrame(e)};this.animationFrameId=requestAnimationFrame(e)}stopLoop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}updateStats(){this.frameCount++;const e=performance.now(),n=e-this.startTime,r=this.panels.get(Ci.MS);if(r&&r.update(n,wh.MAX_MS_VALUE),e>=this.lastUpdateTime+wh.UPDATE_INTERVAL){const i=this.frameCount*N3.MS_PER_SECOND/(e-this.lastUpdateTime),a=this.panels.get(Ci.FPS);a&&a.update(i,wh.MAX_FPS_VALUE),this.lastUpdateTime=e,this.frameCount=0,this.updateMemoryPanel()}return e}updateMemoryPanel(){const e=this.panels.get(Ci.MEMORY);if(!e)return;const n=performance;if(n.memory){const r=n.memory.usedJSHeapSize/N3.BYTES_TO_MB,i=n.memory.jsHeapSizeLimit/N3.BYTES_TO_MB;e.update(r,i)}}},Ds.instance=null,Ds);const $C=UX.getInstance(),X2=2;class g_{constructor(e){if(this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this.renderFrameOfReference=r=>{const a=this._getViewportsAsArray().map(o=>{if(o.getFrameOfReferenceUID()===r)return o.id});this.renderViewports(a)},this.id=e||Ui(),this.useCPURendering=Yg(),p1.set(this),!_A())throw new Error("@cornerstonejs/core is not initialized, run init() first");this._viewports=new Map,this.hasBeenDestroyed=!1,Xl()?.debug?.statsOverlay&&$C.setup()}enableElement(e){const n=this._normalizeViewportInputEntry(e);this._throwIfDestroyed();const{element:r,viewportId:i}=n;if(!r)throw new Error("No element provided");this.getViewport(i)&&this.disableElement(i);const{type:o}=n,s=_s(o);!this.useCPURendering&&!s?this.enableVTKjsDrivenViewport(n):this.addCustomViewport(n);const c=Mo(r),{background:u}=n.defaultOptions;this.fillCanvasWithBackgroundColor(c,u)}disableElement(e){this._throwIfDestroyed();const n=this.getViewport(e);if(!n){console.warn(`viewport ${e} does not exist`);return}this._resetViewport(n),!_s(n.type)&&!this.useCPURendering&&this.offscreenMultiRenderWindow&&this.offscreenMultiRenderWindow.removeRenderer(e),this._removeViewport(e),n.isDisabled=!0,this._needsRender.delete(e),this.getViewports().length||this._clearAnimationFrame()}setViewports(e){const n=this._normalizeViewportInputEntries(e);this._throwIfDestroyed(),this._reset();const r=[],i=[];n.forEach(a=>{!this.useCPURendering&&!_s(a.type)?r.push(a):i.push(a)}),this.setVtkjsDrivenViewports(r),this.setCustomViewports(i),n.forEach(a=>{const o=Mo(a.element),{background:s}=a.defaultOptions;this.fillCanvasWithBackgroundColor(o,s)})}resize(e=!0,n=!0){this._throwIfDestroyed();const r=this._getViewportsAsArray(),i=[],a=[];r.forEach(o=>{_s(o.type)?a.push(o):i.push(o)}),i.length&&this._resizeVTKViewports(i,n,e),a.length&&this._resizeUsingCustomResizeHandler(a,n,e)}getViewport(e){return this._viewports?.get(e)}getViewports(){return this._throwIfDestroyed(),this._getViewportsAsArray()}getStackViewport(e){this._throwIfDestroyed();const n=this.getViewport(e);if(!n)throw new Error(`Viewport with Id ${e} does not exist`);if(!(n instanceof Na))throw new Error(`Viewport with Id ${e} is not a StackViewport.`);return n}getStackViewports(){return this._throwIfDestroyed(),this.getViewports().filter(n=>n instanceof Na)}getVolumeViewports(){this._throwIfDestroyed();const e=this.getViewports(),n=r=>r instanceof Vo;return e.filter(n)}render(){const n=this.getViewports().map(r=>r.id);this._setViewportsToBeRenderedNextFrame(n)}renderViewports(e){this._setViewportsToBeRenderedNextFrame(e)}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}destroy(){this.hasBeenDestroyed||($C.cleanup(),this.useCPURendering||(this._getViewportsAsArray().forEach(n=>{this.offscreenMultiRenderWindow&&this.offscreenMultiRenderWindow.removeRenderer(n.id)}),this.offscreenMultiRenderWindow&&this.offscreenMultiRenderWindow.delete(),delete this.offscreenMultiRenderWindow),this._reset(),p1.delete(this.id),this.hasBeenDestroyed=!0)}fillCanvasWithBackgroundColor(e,n){const r=e.getContext("2d");let i;if(n){const a=n.map(o=>Math.floor(255*o));i=`rgb(${a[0]}, ${a[1]}, ${a[2]})`}else i="black";r.fillStyle=i,r.fillRect(0,0,e.width,e.height)}_normalizeViewportInputEntry(e){const{type:n,defaultOptions:r}=e;let i=r;return(!i||Object.keys(i).length===0)&&(i={background:[0,0,0],orientation:null,displayArea:null},n===yn.ORTHOGRAPHIC&&(i={...i,orientation:k0.AXIAL})),{...e,defaultOptions:i}}_normalizeViewportInputEntries(e){const n=[];return e.forEach(r=>{n.push(this._normalizeViewportInputEntry(r))}),n}_resizeUsingCustomResizeHandler(e,n=!0,r=!0){e.forEach(i=>{typeof i.resize=="function"&&i.resize()}),e.forEach(i=>{const a=i.getCamera();i.resetCamera(),n&&i.setCamera(a)}),r&&this.render()}_removeViewport(e){if(!this.getViewport(e)){console.warn(`viewport ${e} does not exist`);return}this._viewports.delete(e)}addCustomViewport(e){const{element:n,viewportId:r,type:i,defaultOptions:a}=e;n.tabIndex=-1;const o=Mo(n),{clientWidth:s,clientHeight:c}=o;(o.width!==s||o.height!==c)&&(o.width=s,o.height=c);const u={id:r,renderingEngineId:this.id,element:n,type:i,canvas:o,sx:0,sy:0,sWidth:s,sHeight:c,defaultOptions:a||{}},d=f_[i],g=new d(u);this._viewports.set(r,g);const h={element:n,viewportId:r,renderingEngineId:this.id};je(Ye,We.ELEMENT_ENABLED,h)}getRenderer(e){return this.offscreenMultiRenderWindow.getRenderer(e)}getOffscreenMultiRenderWindow(e){if(this.useCPURendering)throw new Error("Offscreen multi render window is not available when using CPU rendering.");return this.offscreenMultiRenderWindow}setCustomViewports(e){e.forEach(n=>{this.addCustomViewport(n)})}_getViewportsAsArray(){return Array.from(this._viewports.values())}_setViewportsToBeRenderedNextFrame(e){e.forEach(n=>{this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&!this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_resetViewport(e){const n=this.id,{element:r,canvas:i,id:a}=e,o={element:r,viewportId:a,renderingEngineId:n};e.removeWidgets(),je(Ye,We.ELEMENT_DISABLED,o),r.removeAttribute("data-viewport-uid"),r.removeAttribute("data-rendering-engine-uid"),i.getContext("2d").clearRect(0,0,i.width,i.height)}_clearAnimationFrame(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}_reset(){this._getViewportsAsArray().forEach(n=>{this._resetViewport(n)}),this._clearAnimationFrame(),this._viewports=new Map}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}}class d_ extends g_{constructor(e){super(e),this._renderFlaggedViewports=()=>{this._throwIfDestroyed(),this.useCPURendering||this.performVtkDrawCall();const n=this._getViewportsAsArray(),r=[];for(let i=0;i<n.length;i++){const a=n[i];if(this._needsRender.has(a.id)){const o=this.renderViewportUsingCustomOrVtkPipeline(a);if(r.push(o),a.setRendered(),this._needsRender.delete(a.id),this._needsRender.size===0)break}}this._animationFrameSet=!1,this._animationFrameHandle=null,r.forEach(i=>{i?.element&&je(i.element,We.IMAGE_RENDERED,i)})},this.useCPURendering||(this.offscreenMultiRenderWindow=CD.newInstance(),this.offScreenCanvasContainer=document.createElement("div"),this.offscreenMultiRenderWindow.setContainer(this.offScreenCanvasContainer))}enableVTKjsDrivenViewport(e){const r=this._getViewportsAsArray().filter(d=>_s(d.type)===!1),i=r.map(d=>d.canvas),a=Mo(e.element);i.push(a);const{offScreenCanvasWidth:o,offScreenCanvasHeight:s}=this._resizeOffScreenCanvas(i),c=this._resize(r,o,s),u={...e,canvas:a};this.addVtkjsDrivenViewport(u,{offScreenCanvasWidth:o,offScreenCanvasHeight:s,xOffset:c})}addVtkjsDrivenViewport(e,n){const{element:r,canvas:i,viewportId:a,type:o,defaultOptions:s}=e;r.tabIndex=-1;const{offScreenCanvasWidth:c,offScreenCanvasHeight:u,xOffset:d}=n,{sxStartDisplayCoords:g,syStartDisplayCoords:h,sxEndDisplayCoords:m,syEndDisplayCoords:y,sx:v,sy:C,sWidth:S,sHeight:w}=this._getViewportCoordsOnOffScreenCanvas(e,c,u,d);this.offscreenMultiRenderWindow.addRenderer({viewport:[g,h,m,y],id:a,background:s.background?s.background:[0,0,0]});const x={id:a,element:r,renderingEngineId:this.id,type:o,canvas:i,sx:v,sy:C,sWidth:S,sHeight:w,defaultOptions:s||{}};let R;if(o===yn.STACK)R=new Na(x);else if(o===yn.ORTHOGRAPHIC||o===yn.PERSPECTIVE)R=new Io(x);else if(o===yn.VOLUME_3D)R=new G8(x);else throw new Error(`Viewport Type ${o} is not supported`);this._viewports.set(a,R);const O={element:r,viewportId:a,renderingEngineId:this.id};R.suppressEvents||je(Ye,We.ELEMENT_ENABLED,O)}setVtkjsDrivenViewports(e){if(e.length){const n=e.map(o=>Mo(o.element));n.forEach(o=>{const s=window.devicePixelRatio||1,c=o.getBoundingClientRect();o.width=c.width*s,o.height=c.height*s});const{offScreenCanvasWidth:r,offScreenCanvasHeight:i}=this._resizeOffScreenCanvas(n);let a=0;for(let o=0;o<e.length;o++){const s=e[o],c=n[o],u={...s,canvas:c};this.addVtkjsDrivenViewport(u,{offScreenCanvasWidth:r,offScreenCanvasHeight:i,xOffset:a}),a+=c.width}}}_resizeVTKViewports(e,n=!0,r=!0){const i=e.map(a=>Mo(a.element));if(i.forEach(a=>{const o=window.devicePixelRatio||1;a.width=a.clientWidth*o,a.height=a.clientHeight*o}),i.length){const{offScreenCanvasWidth:a,offScreenCanvasHeight:o}=this._resizeOffScreenCanvas(i);this._resize(e,a,o)}e.forEach(a=>{const o=a.getCamera(),s=a.getRotation(),{flipHorizontal:c}=o;a.resetCameraForResize();const u=a.getDisplayArea();n&&(u?(c&&a.setCamera({flipHorizontal:c}),s&&a.setViewPresentation({rotation:s})):a.setCamera(o))}),r&&this.render()}performVtkDrawCall(){const{offscreenMultiRenderWindow:e}=this,n=e.getRenderWindow(),r=e.getRenderers();if(r.length){for(let i=0;i<r.length;i++){const{renderer:a,id:o}=r[i];this._needsRender.has(o)?a.setDraw(!0):a.setDraw(!1)}n.render();for(let i=0;i<r.length;i++)r[i].renderer.setDraw(!1)}}renderViewportUsingCustomOrVtkPipeline(e){let n;if(e.sWidth<X2||e.sHeight<X2){console.warn("Viewport is too small",e.sWidth,e.sHeight);return}if(_s(e.type)===!0)n=e.customRenderViewportToCanvas();else{if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const{offscreenMultiRenderWindow:r}=this,o=r.getOpenGLRenderWindow().get3DContext().canvas;n=this._renderViewportFromVtkCanvasToOnscreenCanvas(e,o)}return n}_renderViewportFromVtkCanvasToOnscreenCanvas(e,n){const{element:r,canvas:i,sx:a,sy:o,sWidth:s,sHeight:c,id:u,renderingEngineId:d,suppressEvents:g}=e,{width:h,height:m}=i;return i.getContext("2d").drawImage(n,a,o,s,c,0,0,h,m),{element:r,suppressEvents:g,viewportId:u,renderingEngineId:d,viewportStatus:e.viewportStatus}}_resizeOffScreenCanvas(e){const{offScreenCanvasContainer:n,offscreenMultiRenderWindow:r}=this,i=Math.max(...e.map(o=>o.height));let a=0;return e.forEach(o=>{a+=o.width}),n.width=a,n.height=i,r.resize(),{offScreenCanvasWidth:a,offScreenCanvasHeight:i}}_resize(e,n,r){let i=0;for(let a=0;a<e.length;a++){const o=e[a],{sxStartDisplayCoords:s,syStartDisplayCoords:c,sxEndDisplayCoords:u,syEndDisplayCoords:d,sx:g,sy:h,sWidth:m,sHeight:y}=this._getViewportCoordsOnOffScreenCanvas(o,n,r,i);i+=o.canvas.width,o.sx=g,o.sy=h,o.sWidth=m,o.sHeight=y,this.offscreenMultiRenderWindow.getRenderer(o.id).setViewport(s,c,u,d)}return i}_getViewportCoordsOnOffScreenCanvas(e,n,r,i){const{canvas:a}=e,{width:o,height:s}=a,c=i,u=0,d=c/n,g=u+(r-s)/r,h=o/n,m=s/r;return{sxStartDisplayCoords:d,syStartDisplayCoords:g,sxEndDisplayCoords:d+h,syEndDisplayCoords:g+m,sx:c,sy:u,sWidth:o,sHeight:s}}}class FX{constructor(e){this.contexts=[],this.offScreenCanvasContainers=[],this.viewportToContext=new Map;for(let n=0;n<e;n++){const r=CD.newInstance(),i=document.createElement("div");r.setContainer(i),this.contexts.push(r),this.offScreenCanvasContainers.push(i)}}getContextByIndex(e){return e>=0&&e<this.contexts.length?{context:this.contexts[e],container:this.offScreenCanvasContainers[e]}:null}assignViewportToContext(e,n){this.viewportToContext.set(e,n)}getContextIndexForViewport(e){return this.viewportToContext.get(e)}getAllContexts(){return this.contexts}getContextCount(){return this.contexts.length}destroy(){this.contexts.forEach(e=>{e.delete()}),this.contexts=[],this.offScreenCanvasContainers=[],this.viewportToContext.clear()}}class WC extends g_{constructor(e){super(e),this._renderFlaggedViewports=()=>{this._throwIfDestroyed();const a=this._getViewportsAsArray().filter(s=>this._needsRender.has(s.id));if(a.length===0){this._animationFrameSet=!1,this._animationFrameHandle=null;return}const o=a.map(s=>{const c=this.renderViewportUsingCustomOrVtkPipeline(s);return s.setRendered(),this._needsRender.delete(s.id),c});this._animationFrameSet=!1,this._animationFrameHandle=null,o.forEach(s=>{s?.element&&je(s.element,We.IMAGE_RENDERED,s)})};const{rendering:n}=Xl(),{webGlContextCount:r}=n;this.useCPURendering||(this.contextPool=new FX(r))}enableVTKjsDrivenViewport(e){const i=this._getViewportsAsArray().filter(s=>_s(s.type)===!1).map(s=>s.canvas),a=Mo(e.element);i.push(a);const o={...e,canvas:a};this.addVtkjsDrivenViewport(o)}addVtkjsDrivenViewport(e){const{element:n,canvas:r,viewportId:i,type:a,defaultOptions:o}=e;n.tabIndex=-1;let s=0;if(a===yn.STACK){const m=this.contextPool.getAllContexts();s=this._viewports.size%m.length}this.contextPool.assignViewportToContext(i,s);const c=this.contextPool.getContextByIndex(s),{context:u}=c;u.addRenderer({viewport:[0,0,1,1],id:i,background:o.background?o.background:[0,0,0]});const d={id:i,element:n,renderingEngineId:this.id,type:a,canvas:r,sx:0,sy:0,sWidth:r.width,sHeight:r.height,defaultOptions:o||{}};let g;if(a===yn.STACK)g=new Na(d);else if(a===yn.ORTHOGRAPHIC||a===yn.PERSPECTIVE)g=new Io(d);else if(a===yn.VOLUME_3D)g=new G8(d);else throw new Error(`Viewport Type ${a} is not supported`);this._viewports.set(i,g);const h={element:n,viewportId:i,renderingEngineId:this.id};g.suppressEvents||je(Ye,We.ELEMENT_ENABLED,h)}setVtkjsDrivenViewports(e){if(e.length){const n=e.map(r=>Mo(r.element));n.forEach(r=>{const i=window.devicePixelRatio||1,a=r.getBoundingClientRect();r.width=a.width*i,r.height=a.height*i});for(let r=0;r<e.length;r++){const i=e[r],a=n[r],o={...i,canvas:a};this.addVtkjsDrivenViewport(o)}}}_resizeVTKViewports(e,n=!0,r=!0){const i=e.map(a=>Mo(a.element));i.forEach(a=>{const o=window.devicePixelRatio||1;a.width=a.clientWidth*o,a.height=a.clientHeight*o}),i.length&&this._resize(e),e.forEach(a=>{const o=a.getCamera(),s=a.getRotation(),{flipHorizontal:c}=o;a.resetCameraForResize();const u=a.getDisplayArea();n&&(u?(c&&a.setCamera({flipHorizontal:c}),s&&a.setViewPresentation({rotation:s})):a.setCamera(o))}),r&&this.render()}renderViewportUsingCustomOrVtkPipeline(e){if(_s(e.type))return e.customRenderViewportToCanvas();if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const n=this.contextPool.getContextIndexForViewport(e.id),r=this.contextPool.getContextByIndex(n),{context:i,container:a}=r;return this._renderViewportWithContext(e,i,a)}_renderViewportWithContext(e,n,r){if(e.sWidth<X2||e.sHeight<X2){console.warn("Viewport is too small",e.sWidth,e.sHeight);return}if(_s(e.type))return e.customRenderViewportToCanvas();if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");n.getRenderer(e.id)||n.addRenderer({viewport:[0,0,1,1],id:e.id,background:e.defaultOptions?.background||[0,0,0]});const i=n.getRenderWindow();this._resizeOffScreenCanvasForViewport(e.canvas,r,n),n.getRenderer(e.id).setViewport(0,0,1,1);const o=n.getRenderers();o.forEach(({renderer:h,id:m})=>{h.setDraw(m===e.id)});const s=this.getWidgetRenderers();s.forEach((h,m)=>{m.setDraw(h===e.id)}),i.render(),o.forEach(({renderer:h})=>h.setDraw(!1)),s.forEach((h,m)=>{m.setDraw(!1)});const d=n.getOpenGLRenderWindow().get3DContext().canvas;return this._copyToOnscreenCanvas(e,d)}_renderViewportFromVtkCanvasToOnscreenCanvas(e,n){return this._copyToOnscreenCanvas(e,n)}_resizeOffScreenCanvasForViewport(e,n,r){const i=e.width,a=e.height;n.height===a&&n.width===i||(n.width=i,n.height=a,r.resize())}_copyToOnscreenCanvas(e,n){const{element:r,canvas:i,id:a,renderingEngineId:o,suppressEvents:s}=e,{width:c,height:u}=i;return i.getContext("2d").drawImage(n,0,0,c,u,0,0,c,u),{element:r,suppressEvents:s,viewportId:a,renderingEngineId:o,viewportStatus:e.viewportStatus}}_resize(e){for(const n of e){n.sx=0,n.sy=0,n.sWidth=n.canvas.width,n.sHeight=n.canvas.height;const r=this.contextPool.getContextIndexForViewport(n.id),i=this.contextPool.getContextByIndex(r),{context:a}=i;a.getRenderer(n.id).setViewport(0,0,1,1)}}getWidgetRenderers(){const e=this._getViewportsAsArray(),n=new Map;return e.forEach(r=>{(r.getWidgets?r.getWidgets():[]).forEach(a=>{const o=a.getRenderer?a.getRenderer():null;o&&n.set(o,r.id)})}),n}getRenderer(e){const n=this.contextPool?.getContextIndexForViewport(e),r=this.contextPool.getContextByIndex(n),{context:i}=r;return i.getRenderer(e)}disableElement(e){const n=this.getViewport(e);if(n&&(super.disableElement(e),!_s(n.type)&&!this.useCPURendering)){const r=this.contextPool.getContextIndexForViewport(e);if(r!==void 0){const i=this.contextPool.getContextByIndex(r);if(i){const{context:a}=i;a.removeRenderer(e)}}}}destroy(){this.contextPool&&this.contextPool.destroy(),super.destroy()}getOffscreenMultiRenderWindow(e){if(this.useCPURendering)throw new Error("Offscreen multi render window is not available when using CPU rendering.");const n=this.contextPool.getContextIndexForViewport(e);return this.contextPool.getContextByIndex(n).context}}class kX{constructor(e){const r=Xl()?.rendering?.renderingEngineMode;switch(r){case Ul.Tiled:this._implementation=new d_(e);break;case Ul.ContextPool:this._implementation=new WC(e);break;default:console.warn(`RenderingEngine: Unknown rendering engine mode "${r}". Defaulting to Next rendering engine.`),this._implementation=new WC(e);break}}get id(){return this._implementation.id}enableElement(e){return this._implementation.enableElement(e)}disableElement(e){return this._implementation.disableElement(e)}setViewports(e){return this._implementation.setViewports(e)}resize(e=!0,n=!0){return this._implementation.resize(e,n)}getViewport(e){return this._implementation.getViewport(e)}getViewports(){return this._implementation.getViewports()}getStackViewport(e){return this._implementation.getStackViewport(e)}getStackViewports(){return this._implementation.getStackViewports()}getVolumeViewports(){return this._implementation.getVolumeViewports()}getRenderer(e){return this._implementation.getRenderer(e)}fillCanvasWithBackgroundColor(e,n){return this._implementation.fillCanvasWithBackgroundColor(e,n)}render(){return this._implementation.render()}renderViewports(e){return this._implementation.renderViewports(e)}renderViewport(e){return this._implementation.renderViewport(e)}destroy(){return this._implementation.destroy()}getOffscreenMultiRenderWindow(e){return this._implementation.getOffscreenMultiRenderWindow(e)}}var Zo;(function(t){t[t.None=0]="None",t[t.Capture=1]="Capture",t[t.Bubble=2]="Bubble"})(Zo||(Zo={}));class Np{constructor(e){this._eventListeners=new Map,this._children=new Map,this._target=e}get isEmpty(){return this._eventListeners.size===0&&this._children.size===0}addEventListener(e,n,r){const i=e.indexOf(".");if(i!==-1){const o=e.substring(0,i);let s=this._children.get(o);s||(s=new Np(this._target),this._children.set(o,s)),e=e.substring(i+1),s.addEventListener(e,n,r)}else this._addEventListener(e,n,r)}removeEventListener(e,n,r){const i=e.indexOf(".");if(i!==-1){const o=e.substring(0,i),s=this._children.get(o);if(!s)return;e=e.substring(i+1),s.removeEventListener(e,n,r),s.isEmpty&&this._children.delete(o)}else this._removeEventListener(e,n,r)}reset(){Array.from(this._children.entries()).forEach(([e,n])=>{if(n.reset(),n.isEmpty)this._children.delete(e);else throw new Error("Child is not empty and cannot be removed")}),this._unregisterAllEvents()}_addEventListener(e,n,r){let i=this._eventListeners.get(e);i||(i=new Map,this._eventListeners.set(e,i));const o=r?.capture??!1?Zo.Capture:Zo.Bubble,s=i.get(n)??Zo.None;if(s&o){console.warn("A listener is already registered for this phase");return}i.set(n,s|o),this._target.addEventListener(e,n,r)}_removeEventListener(e,n,r){const a=r?.capture??!1?Zo.Capture:Zo.Bubble,o=this._eventListeners.get(e);if(!o)return;(n?[n]:Array.from(o.keys())).forEach(c=>{const u=o.get(c)??Zo.None;if(!!!(u&a))return;this._target.removeEventListener(e,c,r);const g=u^a;g===Zo.None?o.delete(c):o.set(c,g)}),o.size||this._eventListeners.delete(e)}_unregisterAllListeners(e,n){Array.from(n.entries()).forEach(([r,i])=>{const a=Zo.Capture;for(let o=a;i;o<<=1){if(!(i&o))continue;const s=o===Zo.Capture;this.removeEventListener(e,r,{capture:s}),i^=o}})}_unregisterAllEvents(){Array.from(this._eventListeners.entries()).forEach(([e,n])=>{this._unregisterAllListeners(e,n)})}}class GX{constructor(){this._targetsEventListeners=new Map}addEventListener(e,n,r,i){let a=this._targetsEventListeners.get(e);a||(a=new Np(e),this._targetsEventListeners.set(e,a)),a.addEventListener(n,r,i)}removeEventListener(e,n,r,i){const a=this._targetsEventListeners.get(e);a&&(a.removeEventListener(n,r,i),a.isEmpty&&this._targetsEventListeners.delete(e))}reset(){Array.from(this._targetsEventListeners.entries()).forEach(([e,n])=>{n.reset(),this._targetsEventListeners.delete(e)})}}const BX=Object.freeze(Object.defineProperty({__proto__:null,MultiTargetEventListenerManager:GX,TargetEventListeners:Np},Symbol.toStringTag,{value:"Module"}));function $X(t,e){const n=t.getSize();for(let r=0;r<n;r++){const i=[];t.getNodeValue(r,i),i[1]=i[1]*e,i[2]=i[2]*e,i[3]=i[3]*e,t.setNodeValue(r,i)}}function WX(t){let e=t[0],n=t[0],r;const i=t.length;for(let a=1;a<i;a++)r=t[a],e=Math.min(e,r),n=Math.max(n,r);return{min:e,max:n}}const zX=Symbol("LastRuntimeId"),HX={},jX=4294967295,qX="-";function h_(t,e,n){return KX(t!==null&&typeof t=="object"?t:HX,zX,(typeof n=="number"&&n>0?n:jX)>>>0).join(typeof e=="string"?e:qX)}function KX(t,e,n){let r=t[e];r instanceof Array||(r=[0],Object.defineProperty(t,e,{value:r}));for(let i=!0,a=0;i&&a<r.length;++a){let o=r[a]|0;o<n?(i=!1,o=o+1):(o=0,a+1===r.length&&r.push(0)),r[a]=o}return r}const zC={},YX={add:(t,e)=>{const n=da(t);zC[n]=e},get:(t,e)=>{if(t==="calibratedPixelSpacing"){const n=da(e);return zC[n]}}};function XX(t,e,n=1e-5){return Math.abs(t[0]+e[0])<n&&Math.abs(t[1]+e[1])<n&&Math.abs(t[2]+e[2])<n}function ZX(t,e){return!(t[0]<0||t[0]>=e[0]||t[1]<0||t[1]>=e[1]||t[2]<0||t[2]>=e[2])}function QX(t,e){let n;e?n=[Yc(e)]:n=Hs();const r=[];return n.forEach(i=>{const a=t.getActors(),o=i.getVolumeViewports();for(const s of o){const c=s.getActors();if(c.length!==a.length)continue;a.every(({uid:d})=>c.find(g=>d===g.uid))&&r.push(s)}}),r}const p_=t=>t.preScale.scaled&&t.preScale.scalingParameters.suvbw;function m_(t,e,n=void 0,r="_thumbnails",i={displayArea:{imageArea:[1,1]}}){if(!t||!(t instanceof HTMLCanvasElement))throw new Error("canvas element is required");const a=!e.imageId,o=!a&&e,s=a&&e,u=`renderGPUViewport-${o.imageId||s.volumeId}`,d=document.createElement("div"),g=window.devicePixelRatio||1;i.displayArea||(i.displayArea={imageArea:[1,1]});const h=t.width,m=t.height;d.style.width=`${h/g+IC}px`,d.style.height=`${m/g+IC}px`,d.style.visibility="hidden",d.style.position="absolute",document.body.appendChild(d);const y=u.split(":").join("-");d.setAttribute("viewport-id-for-remove",y);const v=Mo(d),C=Yc(r)||new d_(r);let S=C.getViewport(u);if(!S){const w={viewportId:u,type:a?yn.ORTHOGRAPHIC:yn.STACK,element:d,defaultOptions:{...i,suppressEvents:!0}};C.enableElement(w),S=C.getViewport(u)}return new Promise(w=>{let x=!1,{viewReference:R}=i;const O=b=>{if(x)return;if(R){const Q=R;R=null,S.setViewReference(Q),S.render();return}t.getContext("2d").drawImage(v,0,0,v.width,v.height,0,0,t.width,t.height);const G=S.canvasToWorld([0,0]),j=S.canvasToWorld([v.width/g,0]),F=S.canvasToWorld([0,v.height/g]),$=hn([0,0,0],S.canvasToWorld([1/g,0]),G),z=hn([0,0,0],S.canvasToWorld([0,1/g]),G),oe=1;x=!0,d.removeEventListener(We.IMAGE_RENDERED,O),setTimeout(()=>{C.disableElement(u),document.querySelectorAll(`[viewport-id-for-remove="${y}"]`).forEach(le=>{le.remove()})},0),w({origin:G,bottomLeft:F,topRight:j,thicknessMm:oe,rightVector:$,downVector:z})};d.addEventListener(We.IMAGE_RENDERED,O),a?S.setVolumes([s],!1,!0):S.renderImageObject(e),S.resetCamera(),n==="PT"&&!p_(o)&&S.setProperties({voiRange:{lower:o.minPixelValue,upper:o.maxPixelValue}}),S.render()})}function v_(t,e,n,r,i){if(e.volumeId)throw new Error("Unsupported volume rendering for CPU");const o=e,s=u_(t,o,n),c={canvas:t,viewport:s,image:o,renderingTools:{}};c.transform=S1(c);const u=!0;return new Promise((d,g)=>{s_(c,u),d(null)})}function JX(t){const{canvas:e,imageId:n,viewReference:r,requestType:i=Nt.Thumbnail,priority:a=-5,renderingEngineId:o="_thumbnails",useCPURendering:s=!1,thumbnail:c=!1,imageAspect:u=!1,viewportOptions:d}=t,g=r?.volumeId,h=g&&!n,m=r&&d?{...d,viewReference:r}:d,y=s?v_:m_;return new Promise((v,C)=>{function S(O,b){const{modality:I}=it("generalSeriesModule",b)||{},G=!h&&O,j=h&&O;G&&(G.isPreScaled=G.isPreScaled||G.preScale?.scaled),c&&(e.height=256,e.width=256),u&&G&&(e.width=G&&e.height*G.width/G.height),e.style.width=`${e.width/devicePixelRatio}px`,e.style.height=`${e.height/devicePixelRatio}px`,j&&s&&C(new Error("CPU rendering of volume not supported")),y(e,O,I,o,m).then(v)}function w(O,b){console.error(O,b),C(O)}function x(O,b,I){return j0(O,I).then(G=>{S.call(this,G,O)},G=>{w.call(this,G,O)})}const R={useRGBA:!!s,requestType:i};if(g){const O=rt.getVolume(g);O||C(new Error(`Volume id ${g} not found in cache`));const b=O.imageIds[0];S(O,b)}else ks.addRequest(x.bind(null,n,null,R),i,{imageId:n},a)})}function Q4(t){return Array.isArray(t)?t:[t]}const HC={HISTORY_UNDO:"CORNERSTONE_TOOLS_HISTORY_UNDO",HISTORY_REDO:"CORNERSTONE_TOOLS_HISTORY_REDO"};class y_{constructor(e="Tools",n=50){this.position=-1,this.redoAvailable=0,this.undoAvailable=0,this.ring=new Array,this.isRecordingGrouped=!1,this.label=e,this._size=n}get size(){return this._size}set size(e){this.ring=new Array(e),this._size=e,this.position=-1,this.redoAvailable=0,this.undoAvailable=0}get canUndo(){return this.undoAvailable>0}get canRedo(){return this.redoAvailable>0}undo(e=1){for(;e>0&&this.undoAvailable>0;){const n=this.ring[this.position];for(const r of Q4(n).reverse())r.restoreMemo(!0),this.dispatchHistoryEvent({item:r,isUndo:!0});e--,this.redoAvailable++,this.undoAvailable--,this.position=(this.position-1+this.size)%this.size}}undoIf(e){return this.undoAvailable>0&&e(this.ring[this.position])?(this.undo(),!0):!1}dispatchHistoryEvent({item:e,isUndo:n}){e.id&&Ye.dispatchEvent(new CustomEvent(n?HC.HISTORY_UNDO:HC.HISTORY_REDO,{detail:{isUndo:n,id:e.id,operationType:e.operationType||"annotation",memo:e}}))}redo(e=1){for(;e>0&&this.redoAvailable>0;){const n=(this.position+1)%this.size,r=this.ring[n];for(const i of Q4(r).reverse())i.restoreMemo(!1),this.dispatchHistoryEvent({item:i,isUndo:!1});e--,this.position=n,this.undoAvailable++,this.redoAvailable--}}initializeGroupItem(){this.redoAvailable=0,this.undoAvailable<this._size&&this.undoAvailable++,this.position=(this.position+1)%this._size,this.ring[this.position]=[]}startGroupRecording(){this.isRecordingGrouped=!0,this.initializeGroupItem()}rollbackUnusedGroupItem(){this.ring[this.position]=void 0,this.position=(this.position-1)%this._size,this.undoAvailable--}endGroupRecording(){this.isRecordingGrouped=!1;const e=this.ring[this.position];Array.isArray(e)&&e.length===0&&this.rollbackUnusedGroupItem()}pushGrouped(e){const n=this.ring[this.position];if(Array.isArray(n))return n.push(e),e;throw new Error("Last item should be an array for grouped memos.")}push(e){if(!e)return;const n=e.restoreMemo?e:e.createMemo?.();if(n)return this.isRecordingGrouped?this.pushGrouped(n):(this.redoAvailable=0,this.undoAvailable<this._size&&this.undoAvailable++,this.position=(this.position+1)%this._size,this.ring[this.position]=n,n)}}const eZ=new y_,B8=Object.freeze(Object.defineProperty({__proto__:null,DefaultHistoryMemo:eZ,HistoryMemo:y_},Symbol.toStringTag,{value:"Module"}));function tZ(t,e){const n=it("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,rowCosines:i,imagePositionPatient:a}=n;let{columnPixelSpacing:o,rowPixelSpacing:s}=n;o||=1,s||=1;const c=Ke();Si(c,a,r,-o/2),Si(c,c,i,-s/2);const u=Ke();hn(u,e,c);const d=ft(u,i),g=ft(u,r);return[d/s,g/o]}function nZ(t,e){const n=it("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,rowCosines:i,imagePositionPatient:a}=n;let{columnPixelSpacing:o,rowPixelSpacing:s}=n;o||=1,s||=1;const c=Ke();return Si(c,a,i,s*(e[0]-.5)),Si(c,c,r,o*(e[1]-.5)),Array.from(c)}function J4(t){const e=Hs(),n=[];return e.forEach(r=>{r.getViewports().forEach(a=>{a.hasImageURI(t)&&n.push(a)})}),n}function T_(t,e){const n=rZ(t,e);return n?n.index:null}function rZ(t,e){const n=e.getImageIds(),r=e.getCurrentImageIdIndex();if(n.length===0)return null;const i=c=>{const u=iZ(c);if(!u)return null;const d=BD(u.planeNormal,u.imagePositionPatient);return V8(d,t)},a={distance:i(n[r])??1/0,index:r},o=n.slice(r+1);for(let c=0;c<o.length;c++){const u=o[c],d=i(u);if(d!==null)if(d<=a.distance)a.distance=d,a.index=c+r+1;else break}const s=n.slice(0,r);for(let c=s.length-1;c>=0;c--){const u=s[c],d=i(u);if(!(d===null||d===a.distance))if(d<a.distance)a.distance=d,a.index=c;else break}return a.distance===1/0?null:a}function iZ(t){const e=it("imagePlaneModule",t);if(!e||!(e.rowCosines instanceof Array&&e.rowCosines.length===3)||!(e.columnCosines instanceof Array&&e.columnCosines.length===3)||!(e.imagePositionPatient instanceof Array&&e.imagePositionPatient.length===3))return null;const{rowCosines:n,columnCosines:r,imagePositionPatient:i}=e,a=gn(Ke(),...n),o=gn(Ke(),...r),s=Cn(Ke(),a,o);return{rowCosines:n,columnCosines:r,imagePositionPatient:i,planeNormal:s}}function aZ(t){const{width:e,height:n}=t.getCanvas(),{sliceToIndexMatrix:r,indexToSliceMatrix:i}=t.getSliceViewInfo(),a=I0(t,[0,0]),o=I0(t,[e-1,0]),s=I0(t,[0,n-1]),c=hn(Ke(),o,a),u=hn(Ke(),s,a),d=Cn(Ke(),c,u);Sn(c,c),Sn(u,u),Sn(d,d);const g=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2])),h=Math.max(Math.abs(u[0]),Math.abs(u[1]),Math.abs(u[2]));if(!M2(1,g)||!M2(1,h))throw new Error("Livewire is not available for rotate/oblique viewports");const{voxelManager:m}=t.getImageData(),y=t.getSliceViewInfo(),v=m.getSliceData(y);return{width:y.width,height:y.height,scalarData:v,sliceToIndexMatrix:r,indexToSliceMatrix:i}}const ml={},Z2={add:(t,e)=>{const[n,r]=t,i=`${n}_${r}`;ml[i]||(ml[i]={}),ml[i]=e},get:(t,e,n)=>{if(t!=="spatialRegistrationModule")return;const r=`${e}_${n}`;if(ml[r])return ml[r];const i=`${n}_${e}`;if(ml[i])return Br(Ps(),ml[i])}};xf(Z2.get.bind(Z2));const oZ=.05;function sZ(t,e){const n=t.getSliceIndex(),r=e.getSliceIndex(),i=it("imagePlaneModule",n.toString()),a=it("imagePlaneModule",r.toString());if(!i||!a){console.log("Viewport spatial registration requires image plane module");return}const{imageOrientationPatient:o}=a;if(!i.imageOrientationPatient.every((h,m)=>Math.abs(h-o[m])<oZ)){console.log("Viewport spatial registration only supported for same orientation (hence translation only) for now",i?.imageOrientationPatient,a?.imageOrientationPatient);return}const c=i.imagePositionPatient,u=a.imagePositionPatient,d=ei(Ke(),c,u),g=k1(Ps(),d);Z2.add([t.id,e.id],g)}function cZ(t){const{imageData:e,dimensions:n}=t.getImageData()||{};if(!e||!n)return[];const{canvas:r}=t,i=window.devicePixelRatio,a=[0,0],o=[r.width/i,0],s=[r.width/i,r.height/i],c=[0,r.height/i],u=t.canvasToWorld(a),d=t.canvasToWorld(o),g=t.canvasToWorld(s),h=t.canvasToWorld(c),m=e.worldToIndex(u),y=e.worldToIndex(d),v=e.worldToIndex(g),C=e.worldToIndex(h);return lZ({dimensions:n,imageData:e,topLeftImage:m,topRightImage:y,bottomRightImage:v,bottomLeftImage:C,topLeftWorld:u,topRightWorld:d,bottomRightWorld:g,bottomLeftWorld:h})}function lZ({dimensions:t,imageData:e,topLeftImage:n,topRightImage:r,bottomRightImage:i,bottomLeftImage:a,topLeftWorld:o,topRightWorld:s,bottomRightWorld:c,bottomLeftWorld:u}){const d=xh(n,t)?o:e.indexToWorld([0,0,0]),g=xh(r,t)?s:e.indexToWorld([t[0]-1,0,0]),h=xh(i,t)?c:e.indexToWorld([t[0]-1,t[1]-1,0]),m=xh(a,t)?u:e.indexToWorld([0,t[1]-1,0]);return[d,g,m,h]}function xh(t,e){return t[0]>0||t[0]<e[0]-1||t[1]>0||t[1]<e[1]-1||t[2]>0||t[2]<e[2]-1}function mt(t){if(!t)return;const{viewportUid:e,renderingEngineUid:n}=t.dataset;return H1(e,n)}function H1(t,e){if(!e||!t)return;const n=Yc(e);if(!n||n.hasBeenDestroyed)return;const r=n.getViewport(t);if(!r)return;const i=r.getFrameOfReferenceUID();return{viewport:r,renderingEngine:n,viewportId:t,renderingEngineId:e,FrameOfReferenceUID:i}}function ti(t){const e=Hs();for(let n=0;n<e.length;n++){const r=e[n];if(r.getViewport(t))return H1(t,r.id)}}function uZ(){const t=[];return Hs().forEach(n=>{n.getViewports().forEach(({element:i})=>{t.push(mt(i))})}),t}function fZ(t){const e=mt(t);if(!e)return;const{viewport:n}=e;if(!(n instanceof Na))throw new Error(`An image can only be fetched for a stack viewport and not for a viewport of type: ${n.type}`);return n.getCornerstoneImage()}function gZ(t){if(t.length<=1)return!1;const e=t[0],{modality:n,seriesInstanceUID:r}=it("generalSeriesModule",e),{imageOrientationPatient:i,pixelSpacing:a,frameOfReferenceUID:o,columns:s,rows:c,usingDefaultValues:u}=it("imagePlaneModule",e);if(u)return!1;const d={modality:n,imageOrientationPatient:i,pixelSpacing:a,columns:s,rows:c,seriesInstanceUID:r};let g=!0;for(let h=0;h<t.length;h++){const m=t[h],{modality:y,seriesInstanceUID:v}=it("generalSeriesModule",m),{imageOrientationPatient:C,pixelSpacing:S,columns:w,rows:x}=it("imagePlaneModule",m);if(v!==d.seriesInstanceUID){g=!1;break}if(y!==d.modality){g=!1;break}if(w!==d.columns){g=!1;break}if(x!==d.rows){g=!1;break}if(!Tn(C,d.imageOrientationPatient)){g=!1;break}if(!Tn(S,d.pixelSpacing)){g=!1;break}}return g}const dZ=new Set(["1.2.840.10008.1.2.4.100","1.2.840.10008.1.2.4.100.1","1.2.840.10008.1.2.4.101","1.2.840.10008.1.2.4.101.1","1.2.840.10008.1.2.4.102","1.2.840.10008.1.2.4.102.1","1.2.840.10008.1.2.4.103","1.2.840.10008.1.2.4.103.1","1.2.840.10008.1.2.4.104","1.2.840.10008.1.2.4.104.1","1.2.840.10008.1.2.4.105","1.2.840.10008.1.2.4.105.1","1.2.840.10008.1.2.4.106","1.2.840.10008.1.2.4.106.1","1.2.840.10008.1.2.4.107","1.2.840.10008.1.2.4.108"]);function C_(t){return t?(Array.isArray(t)?t:[t]).find(n=>dZ.has(n)):!1}async function hZ({viewport:t,options:e={}}){const n=t.getRenderingEngine();let r=e.volumeId||`${Ui()}`;r.split(":").length===0&&(r=`${IK()}:${r}`);const{id:i,element:a}=t,o=e.viewportId||i,s=t.getImageIds(),c=t.getViewPresentation(),u=t.getViewReference();n.enableElement({viewportId:o,type:yn.ORTHOGRAPHIC,element:a,defaultOptions:{background:e.background,orientation:e.orientation}}),(await FD(r,{imageIds:s})).load();const g=n.getViewport(o);await bX(n,[{volumeId:r}],[o]);const h=()=>{g.render(),a.removeEventListener(We.VOLUME_VIEWPORT_NEW_VOLUME,h)};return(()=>{a.addEventListener(We.VOLUME_VIEWPORT_NEW_VOLUME,h)})(),g.setViewPresentation(c),g.setViewReference(u),g.render(),g}async function pZ({viewport:t,options:e}){const n=t,{id:r,element:i}=n,a=t.getRenderingEngine(),{background:o}=e,s=e.viewportId||r,c=rt.getVolume(n.getVolumeId());if(!(c instanceof bp))throw new Error("Currently, you cannot decache a volume that is not an ImageVolume. So, unfortunately, volumes such as nifti  (which are basic Volume, without imageIds) cannot be decached.");const u={viewportId:s,type:yn.STACK,element:i,defaultOptions:{background:o}},d=n.getViewReference();a.enableElement(u);const g=a.getViewport(s);return await g.setStack(c.imageIds),g.setViewReference(d),g.render(),g}function Dc(t,e=2){if(Array.isArray(t))return t.map(i=>Dc(i,e)).join(", ");if(t==null||t==="")return"NaN";t=Number(t);const n=Math.abs(t);if(n<1e-4)return`${t}`;const r=n>=100?e-2:n>=10?e-1:n>=1?e:n>=.1?e+1:n>=.01?e+2:n>=.001?e+3:e+4;return t.toFixed(r)}function mZ(t){return Math.round(t/Lo)*Lo}function vZ(t,e,n){const r=t.length===e*n*4,i=t.length===e*n*3;if(r||i){const a=new Float32Array(e*n);let o=0,s=0;const c=r?4:3;for(let u=0;u<e;u++)for(let d=0;d<n;d++){const g=t[o],h=t[o+1],m=t[o+2];a[s]=(g+h+m)/3,o+=c,s++}return a}else return t}function yZ(t){if(t instanceof Io)return rt.getVolume(t.getVolumeId()).imageIds;if(t.getImageIds)return t.getImageIds()}function $8(t,e){const n=[...t];return e>=n.length?(jC(n),n):(jC(n),n.slice(0,e))}function jC(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}}function U3(t){const e=t.toString(16);return e.length==1?"0"+e:e}function TZ(t,e,n){return"#"+U3(t)+U3(e)+U3(n)}function CZ(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}const SZ=Object.freeze(Object.defineProperty({__proto__:null,hexToRgb:CZ,rgbToHex:TZ},Symbol.toStringTag,{value:"Module"}));function S_(t,e){if(t===e)return!0;if(t==null||e==null)return!1;try{return JSON.stringify(t)===JSON.stringify(e)}catch(n){return console.debug("Error in JSON.stringify during deep comparison:",n),t===e}}function wZ(t,e,n){if(!n)throw new Error("getVolume is required, use the utilities export instead ");if(t.modality)return t.modality;if(t.setVolumes)return e=e??t.getVolumeId(),!e||!n?void 0:n(e).metadata.Modality;throw new Error("Invalid viewport type")}const xZ=(t,e)=>t.reduce((n,r)=>((n[r[e]]=n[r[e]]||[]).push(r),n),{});function EZ(t){const e=t.map(o=>{const{imagePositionPatient:s}=it("imagePlaneModule",o)||{};return{imageId:o,imagePositionPatient:s}});if(!e.every(o=>o.imagePositionPatient))return null;const n=xZ(e,"imagePositionPatient"),r=Object.keys(n),i=n[r[0]].length;return i===1||!r.every(o=>n[o].length===i)?null:n}function RZ(t,e){const n={};let r=[];const i=Object.keys(t);for(let a=0;a<i.length;a++){const o=new Set,s=t[i[a]];for(let c=0;c<s.length;c++){const u=e(s[c].imageId)||0;if(n[u]=n[u]||[],n[u].push({imageId:s[c].imageId}),o.add(u),o.size-1<c)return}if(a==0)r=Array.from(o);else if(!bZ(r,o))return}return n}function Dg(t,e){const n=it(e,t);try{return parseFloat(n)}catch{return}}function OZ(t){const e=it("20011003",t);try{const{InlineBinary:n}=e;if(n){const r=atob(n),i=new ArrayBuffer(r.length),a=new DataView(i);for(let o=0;o<r.length;o++)a.setUint8(o,r.charCodeAt(o));return new Float32Array(i)[0]}return parseFloat(e)}catch{return}}function DZ(t){let e=it("0019100c",t)||it("0019100C",t);try{const{InlineBinary:n}=e;return n&&(e=atob(n)),parseFloat(e)}catch{return}}function _Z(t){let e=it("00431039",t);try{const{InlineBinary:n}=e;return n&&(e=atob(n).split("//")),parseFloat(e[0])%1e5}catch{return}}function bZ(t,e){if(t.length!=e.size)return!1;for(let n=0;n<t.length;n++)if(!e.has(t[n]))return!1;return!0}function MZ(t){const e=it("petImageModule",t);return e?e.frameReferenceTime:0}function w_(t){const e=EZ(t);if(!e)return{imageIdGroups:[t],splittingTag:null};const n=["TemporalPositionIdentifier","DiffusionBValue","TriggerTime","EchoTime","EchoNumber","PhilipsPrivateBValue","SiemensPrivateBValue","GEPrivateBValue","PetFrameReferenceTime"],r=[i=>Dg(i,n[0]),i=>Dg(i,n[1]),i=>Dg(i,n[2]),i=>Dg(i,n[3]),i=>Dg(i,n[4]),OZ,DZ,_Z,MZ];for(let i=0;i<r.length;i++){const a=RZ(e,r[i]);if(a)return{imageIdGroups:Object.keys(a).map(Number.parseFloat).sort((c,u)=>c-u).map(c=>a[c].map(u=>u.imageId)),splittingTag:n[i]}}return{imageIdGroups:[t],splittingTag:null}}function LZ(t){const{imageIdGroups:e,splittingTag:n}=w_(t);return{isDynamicVolume:e.length>1,timePoints:e,splittingTag:n}}function VZ(t,e){const n=t.length,{rescaleSlope:r,rescaleIntercept:i,suvbw:a}=e;if(e.modality==="PT"&&typeof a=="number")for(let o=0;o<n;o++)t[o]=a*(t[o]*r+i);else for(let o=0;o<n;o++)t[o]=t[o]*r+i;return t}function x_(t,e,n){return Math.min(Math.max(e,t),n)}function E_(t,e){if(!mt(t.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(t instanceof Na&&t.getImageIds().length===0)throw new Error("Scroll::Stack Viewport has no images");const{volumeId:r,delta:i,scrollSlabs:a}=e;if(t instanceof Io)IZ(t,r,i,a);else{const o=t.getCurrentImageIdIndex();if(o+i>t.getImageIds().length-1||o+i<0){const s={imageIdIndex:o,direction:i};je(Ye,We.STACK_SCROLL_OUT_OF_BOUNDS,s)}t.scroll(i,e.debounceLoading,e.loop)}}function IZ(t,e,n,r=!1){const i=r,{numScrollSteps:a,currentStepIndex:o,sliceRangeInfo:s}=Xu(t,e,i);if(!s)return;const{sliceRange:c,spacingInNormalDirection:u,camera:d}=s,{focalPoint:g,viewPlaneNormal:h,position:m}=d,{newFocalPoint:y,newPosition:v}=Zu(g,m,c,h,u,n);t.setCamera({focalPoint:y,position:v}),t.render();const C=o+n,S={volumeId:e,viewport:t,delta:n,desiredStepIndex:C,currentStepIndex:o,numScrollSteps:a,currentImageId:t.getCurrentImageId()};(C>a||C<0)&&t.getCurrentImageId()?je(Ye,We.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS,S):je(Ye,We.VOLUME_VIEWPORT_SCROLL,S)}async function AZ(t,e={}){const{imageIndex:n,debounceLoading:r,volumeId:i}=e,a=mt(t);if(!a)throw new Error("Element has been disabled");const{viewport:o}=a,{imageIndex:s,numberOfSlices:c}=NZ(o,r),d=PZ(c,n)-s;E_(o,{delta:d,debounceLoading:r,volumeId:i})}function NZ(t,e){return t instanceof Na?{numberOfSlices:t.getImageIds().length,imageIndex:e?t.getTargetImageIdIndex():t.getCurrentImageIdIndex()}:{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getSliceIndex()}}function PZ(t,e){const n=t-1;return x_(e,0,n)}function UZ(t,e,n={}){const r=rt.getVolume(t);if(!r)throw new Error(`Referenced volume with id ${t} does not exist.`);const{metadata:i,spacing:a,direction:o,dimensions:s}=r,{minX:c,maxX:u,minY:d,maxY:g,minZ:h,maxZ:m}=e,y=[Math.min(c,u),Math.min(d,g),Math.min(h,m)],v=Y2(r.imageData,y),C=[Math.abs(u-c)+1,Math.abs(g-d)+1,Math.abs(m-h)+1],{targetBuffer:S}=n,w={metadata:i,dimensions:C,spacing:a,origin:v,direction:o,targetBuffer:S,scalarData:S?.type==="Float32Array"?new Float32Array(C[0]*C[1]*C[2]):void 0},x=LK(Ui(),w),R=x.voxelManager.getCompleteScalarDataArray(),O=C[0]*C[1],b=s[0]*s[1],I=r.voxelManager.getCompleteScalarDataArray();for(let G=0;G<C[2];G++)for(let j=0;j<C[1];j++){const F=Y2(x.imageData,[0,j,G]),$=Vc(r.imageData,F),z=$[2]*b+$[1]*s[0]+$[0],oe=I.slice(z,z+C[0]),Q=G*O+j*C[0];R.set(oe,Q)}return x.voxelManager.setCompleteScalarDataArray(R),x}function FZ(t,e){const{viewUp:n,viewPlaneNormal:r}=e,i=Zh(t,[0,0,0]),a=Bc(Ke(),n),o=Bc(Ke(),r),s=Cn(Ke(),a,o),c=hn(Ke(),Zh(t,a),i),u=hn(Ke(),Zh(t,o),i);Sn(c,c),Sn(u,u);const d=Cn(Ke(),c,u);return{worldVecRowDir:s,worldVecColDir:a,worldVecSliceDir:o,ijkVecRowDir:d,ijkVecColDir:c,ijkVecSliceDir:u}}function kZ(t,e,n,r){const[i,a,o]=e,s=i*a;let c=0,u=0,d=0;const[g,h,m]=n.map(Math.round);for(let S=m-r;S<=m+r;S++)if(!(S<0||S>=o)){for(let w=h-r;w<=h+r;w++)if(!(w<0||w>=a))for(let x=g-r;x<=g+r;x++){if(x<0||x>=i)continue;const R=S*s+w*i+x,O=t[R];c+=O,u+=O*O,d++}}if(d===0){const S=m*s+h*i+g;return S>=0&&S<t.length?{mean:t[S],stdDev:0,count:1}:{mean:0,stdDev:0,count:0}}const y=c/d,v=u/d-y*y,C=Math.sqrt(Math.max(0,v));return{mean:y,stdDev:C,count:d}}const GZ=new Set(["1.2.840.10008.5.1.4.1.1.1","1.2.840.10008.5.1.4.1.1.1.1","1.2.840.10008.5.1.4.1.1.1.1.1","1.2.840.10008.5.1.4.1.1.1.2","1.2.840.10008.5.1.4.1.1.1.2.1","1.2.840.10008.5.1.4.1.1.1.3","1.2.840.10008.5.1.4.1.1.1.3.1","1.2.840.10008.5.1.4.1.1.12.1","1.2.840.10008.5.1.4.1.1.12.1.1","1.2.840.10008.5.1.4.1.1.12.2","1.2.840.10008.5.1.4.1.1.12.2.1","1.2.840.10008.5.1.4.1.1.12.3"]);function BZ(t){const{PixelSpacing:e,ImagerPixelSpacing:n,EstimatedRadiographicMagnificationFactor:r,PixelSpacingCalibrationType:i,PixelSpacingCalibrationDescription:a}=t,o=!0;return n?e?Tn(e,n)?{PixelSpacing:e,type:Rs.PROJECTION,isProjection:o}:i||a?{PixelSpacing:e,type:Rs.CALIBRATED,isProjection:o,PixelSpacingCalibrationType:i,PixelSpacingCalibrationDescription:a}:{PixelSpacing:e,type:Rs.UNKNOWN,isProjection:o}:r?{PixelSpacing:n.map(c=>c/r),type:Rs.ERMF,isProjection:o}:(console.warn("EstimatedRadiographicMagnificationFactor was not present. Unable to correct ImagerPixelSpacing."),{PixelSpacing:n,type:Rs.PROJECTION,isProjection:o}):{PixelSpacing:e,type:Rs.UNKNOWN,isProjection:o}}function $Z(t){const{SequenceOfUltrasoundRegions:e}=t,n=Array.isArray(e);if(n&&e.length>1){console.warn("Sequence of Ultrasound Regions > one entry. This is not yet implemented, all measurements will be shown in pixels.");return}const{PhysicalDeltaX:r,PhysicalDeltaY:i}=n?e[0]:e;return{PixelSpacing:[Math.abs(r)*10,Math.abs(i)*10]}}function WZ(t){const{PixelSpacing:e,SOPClassUID:n,SequenceOfUltrasoundRegions:r}=t;return r?$Z(t):GZ.has(n)?BZ(t):{PixelSpacing:e,type:Rs.NOT_APPLICABLE,isProjection:!1}}const zZ=(t,e)=>wZ(t,e,rt.getVolume),js=Object.freeze(Object.defineProperty({__proto__:null,FrameRange:Qu,HistoryMemo:B8,PointsManager:n2,ProgressiveIterator:H2,RLEVoxelMap:L0,VoxelManager:Fn,actorIsA:Aa,applyPreset:HD,asArray:Q4,autoLoad:z4,buildMetadata:JD,calculateNeighborhoodStats:kZ,calculateSpacingBetweenImageIds:bD,calculateViewportsSpatialRegistration:sZ,calibratedPixelSpacingMetadataProvider:YX,clamp:Y4,clip:x_,color:SZ,colormap:fF,convertStackToVolumeViewport:hZ,convertToGrayscale:vZ,convertVolumeToStackViewport:pZ,createLinearRGBTransferFunction:n_,createSigmoidRGBTransferFunction:i8,createSubVolume:UZ,decimate:ID,deepClone:es,deepEqual:S_,deepMerge:Ia,eventListener:BX,fnv1aHash:RE,generateVolumePropsFromImageIds:b8,genericMetadataProvider:Mp,getBufferConfiguration:cD,getClosestImageId:w1,getClosestStackImageIndexForPoint:T_,getCurrentVolumeViewportSlice:aZ,getDynamicVolumeInfo:LZ,getImageDataMetadata:e_,getImageLegacy:fZ,getImageSliceDataForVolumeViewport:q2,getMinMax:WX,getPixelSpacingInformation:WZ,getRandomSampleFromArray:$8,getRuntimeId:h_,getScalingParameters:LD,getSliceRange:Lp,getSpacingInNormalDirection:W1,getTargetVolumeAndSpacingInNormalDir:z1,getViewportImageCornersInWorld:cZ,getViewportImageIds:yZ,getViewportModality:zZ,getViewportsWithImageURI:J4,getViewportsWithVolumeId:M8,getVoiFromSigmoidRGBTransferFunction:zD,getVolumeActorCorners:kD,getVolumeDirectionVectors:FZ,getVolumeId:Ef,getVolumeSliceRangeInfo:WD,getVolumeViewportScrollInfo:Xu,getVolumeViewportsContainingSameVolumes:QX,hasFloatScalingParameters:_8,hasNaNValues:j4,imageIdToURI:da,imageRetrieveMetadataProvider:sf,imageToWorldCoords:nZ,indexWithinDimensions:ZX,invertRgbTransferFunction:Zg,isEqual:Tn,isEqualAbs:Xh,isEqualNegative:_E,isImageActor:Jo,isNumber:Rc,isOpposite:XX,isPTPrescaledWithSUV:p_,isValidVolume:gZ,isVideoTransferSyntax:C_,jumpToSlice:AZ,loadImageToCanvas:JX,logger:UY,makeVolumeMetadata:_D,planar:ZK,pointInShapeCallback:MO,renderToCanvasCPU:v_,renderToCanvasGPU:m_,roundNumber:Dc,roundToPrecision:mZ,scaleArray:VZ,scaleRgbTransferFunction:$X,scroll:E_,snapFocalPointToSlice:Zu,sortImageIdsAndGetSpacing:MD,spatialRegistrationMetadataProvider:Z2,splitImageIdsBy4DTags:w_,transferFunctionUtils:dF,transformIndexToWorld:Y2,transformWorldToIndex:Vc,transformWorldToIndexContinuous:Zh,triggerEvent:je,updatePlaneRestriction:$D,updateVTKImageDataWithCornerstoneImage:Ip,uuidv4:Ui,windowLevel:gF,worldToImageCoords:tZ},Symbol.toStringTag,{value:"Module"})),j1=new Sv("imageRetrievalPool");j1.setMaxSimultaneousRequests(Nt.Interaction,200);j1.setMaxSimultaneousRequests(Nt.Thumbnail,200);j1.setMaxSimultaneousRequests(Nt.Prefetch,200);j1.grabDelay=0;const qC=Symbol("DefaultSettings"),KC=Symbol("RuntimeSettings"),YC=Symbol("ObjectSettingsMap"),Ec=Symbol("Dictionary");class Jn{constructor(e){const n=Object.create(e instanceof Jn&&Ec in e?e[Ec]:null);Object.seal(Object.defineProperty(this,Ec,{value:n}))}set(e,n){return Q2(this[Ec],e,n,null)}get(e){return qZ(this[Ec],e)}unset(e){return HZ(this[Ec],e+"")}forEach(e){XC(this[Ec],e)}extend(){return new Jn(this)}import(e){R_(e)&&Object.keys(e).forEach(n=>{Q2(this[Ec],n,e[n],null)})}dump(){const e={};return XC(this[Ec],(n,r)=>{typeof r<"u"&&O_(e,n,r)}),e}static assert(e){return e instanceof Jn?e:Jn.getRuntimeSettings()}static getDefaultSettings(e=null){let n=Jn[qC];if(n instanceof Jn||(n=new Jn,Jn[qC]=n),e){const r={};return n.forEach(i=>{if(i.startsWith(e)){const a=i.split(`${e}.`)[1];r[a]=n.get(i)}}),r}return n}static getRuntimeSettings(){let e=Jn[KC];return e instanceof Jn||(e=new Jn(Jn.getDefaultSettings()),Jn[KC]=e),e}static getObjectSettings(e,n){let r=null;if(e instanceof Jn)r=e;else if(typeof e=="object"&&e!==null){let i=Jn[YC];i instanceof WeakMap||(i=new WeakMap,Jn[YC]=i),r=i.get(e),r instanceof Jn||(r=new Jn(Jn.assert(Jn.getObjectSettings(n))),i.set(e,r))}return r}static extendRuntimeSettings(){return Jn.getRuntimeSettings().extend()}}function HZ(t,e){if(e.endsWith(".")){let n=0;const r=e,i=r.slice(0,-1),a=i.length===0;for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(a||o.startsWith(r)||o===i)&&(delete t[o],++n);return n>0}return delete t[e]}function XC(t,e){for(const n in t)e(n,t[n])}function jZ(t,e,n,r){let i;if(r.has(n))return Q2(t,e,null,r);r.add(n),i=0;for(const a in n)if(Object.prototype.hasOwnProperty.call(n,a)){const o=a.length===0?e:`${e}.${a}`;Q2(t,o,n[a],r)||++i}return r.delete(n),i===0}function Q2(t,e,n,r){return KZ(e)?R_(n)?jZ(t,e,n,r instanceof WeakSet?r:new WeakSet):(t[e]=n,!0):!1}function qZ(t,e){return t[e]}function KZ(t){let e,n,r;if(typeof t!="string"||(e=t.length-1)<0)return!1;for(r=-1;(n=t.indexOf(".",r+1))>=0;){if(n-r<2||n===e)return!1;r=n}return!0}function R_(t){if(typeof t=="object"&&t!==null){const e=Object.getPrototypeOf(t);if(e===Object.prototype||e===null)return!0}return!1}function O_(t,e,n){const r=e.indexOf(".");if(r>=0){const i=e.slice(0,r);let a=t[i];if(typeof a!="object"||a===null){const o=a;a={},typeof o<"u"&&(a[""]=o),t[i]=a}O_(a,e.slice(r+1,e.length),n)}else t[e]=n}Jn.getDefaultSettings().set("useCursors",!0);function YZ(t,e){let n;if(e===void 0)for(const r of t)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of t)(i=e(i,++r,t))!=null&&(n>i||n===void 0&&i>=i)&&(n=i)}return n}function XZ(t){if(!(a=t.length))return[];for(var e=-1,n=YZ(t,ZZ),r=new Array(n);++e<n;)for(var i=-1,a,o=r[e]=new Array(a);++i<a;)o[i]=t[i][e];return r}function ZZ(t){return t.length}function ZC(){return XZ(arguments)}function QZ(t,e,n,r,i){var a=t*t,o=a*t;return((1-3*t+3*a-o)*e+(4-6*a+3*o)*n+(1+3*t+3*a-3*o)*r+o*i)/6}function F3(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],a=t[r+1],o=r>0?t[r-1]:2*i-a,s=r<e-1?t[r+2]:2*a-i;return QZ((n-r/e)*e,o,i,a,s)}}function _g(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t(r/(e-1));return n}function JZ(t,e,n){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0;if(n){for(let o=0;o<r;o++)e[a++]=t[i++],e[a++]=t[i++],e[a++]=t[i++],e[a++]=255;return}e.set(t)}function eQ(t,e,n){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0,o=r,s=r*2;if(n)for(let c=0;c<r;c++)e[i++]=t[a++],e[i++]=t[o++],e[i++]=t[s++],e[i++]=255;else for(let c=0;c<r;c++)e[i++]=t[a++],e[i++]=t[o++],e[i++]=t[s++]}function tQ(t,e,n){if(t===void 0)throw new Error("convertYBRFullByPixel: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPixel: ybrBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0;if(n){for(let o=0;o<r;o++){const s=t[i++],c=t[i++],u=t[i++];e[a++]=s+1.402*(u-128),e[a++]=s-.34414*(c-128)-.71414*(u-128),e[a++]=s+1.772*(c-128),e[a++]=255}return}for(let o=0;o<r;o++){const s=t[i++],c=t[i++],u=t[i++];e[a++]=s+1.402*(u-128),e[a++]=s-.34414*(c-128)-.71414*(u-128),e[a++]=s+1.772*(c-128)}}function nQ(t,e,n){if(t===void 0)throw new Error("convertYBRFullByPlane: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPlane: ybrBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0,o=r,s=r*2;if(n){for(let c=0;c<r;c++){const u=t[a++],d=t[o++],g=t[s++];e[i++]=u+1.402*(g-128),e[i++]=u-.34414*(d-128)-.71414*(g-128),e[i++]=u+1.772*(d-128),e[i++]=255}return}for(let c=0;c<r;c++){const u=t[a++],d=t[o++],g=t[s++];e[i++]=u+1.402*(g-128),e[i++]=u-.34414*(d-128)-.71414*(g-128),e[i++]=u+1.772*(d-128)}}function rQ(t,e,n){if(t===void 0)throw new Error("convertYBRFull422ByPixel: ybrBuffer must be defined");if(t.length%2!==0)throw new Error(`convertYBRFull422ByPixel: ybrBuffer length ${t.length} must be divisible by 2`);const r=t.length/2;let i=0,a=0;if(n){for(let o=0;o<r;o+=2){const s=t[i++],c=t[i++],u=t[i++],d=t[i++];e[a++]=s+1.402*(d-128),e[a++]=s-.34414*(u-128)-.71414*(d-128),e[a++]=s+1.772*(u-128),e[a++]=255,e[a++]=c+1.402*(d-128),e[a++]=c-.34414*(u-128)-.71414*(d-128),e[a++]=c+1.772*(u-128),e[a++]=255}return}for(let o=0;o<r;o+=2){const s=t[i++],c=t[i++],u=t[i++],d=t[i++];e[a++]=s+1.402*(d-128),e[a++]=s-.34414*(u-128)-.71414*(d-128),e[a++]=s+1.772*(u-128),e[a++]=c+1.402*(d-128),e[a++]=c-.34414*(u-128)-.71414*(d-128),e[a++]=c+1.772*(u-128)}}function k3(t,e){const n=t.length,r=new Uint8ClampedArray(n);for(let i=0;i<n;++i)r[i]=t[i]>>e;return r}function G3(t,e,n){const r=t[`${e}PaletteColorLookupTableData`];if(r)return Promise.resolve(r);const i=it("imagePixelModule",t.imageId);return i&&typeof i.then=="function"?i.then(a=>a?a[`${e}PaletteColorLookupTableData`]:n):Promise.resolve(i?i[`${e}PaletteColorLookupTableData`]:n)}function iQ(t,e,n){const r=t.columns*t.rows,i=t.pixelData;Promise.all([G3(t,"red",null),G3(t,"green",null),G3(t,"blue",null)]).then(([a,o,s])=>{if(!a||!o||!s)throw new Error("The image does not have a complete color palette. R, G, and B palette data are required.");const c=a.length;let u=0,d=0;const g=t.redPaletteColorLookupTableDescriptor[1],h=t.redPaletteColorLookupTableDescriptor[2]===8?0:8,m=k3(a,h),y=k3(o,h),v=k3(s,h);if(n){for(let C=0;C<r;++C){let S=i[u++];S<g?S=0:S>g+c-1?S=c-1:S-=g,e[d++]=m[S],e[d++]=y[S],e[d++]=v[S],e[d++]=255}return}for(let C=0;C<r;++C){let S=i[u++];S<g?S=0:S>g+c-1?S=c-1:S-=g,e[d++]=m[S],e[d++]=y[S],e[d++]=v[S]}})}function B3(t,e){if(!(!t.elements[e]||t.elements[e].length!==6))return[t.uint16(e,0),t.uint16(e,1),t.uint16(e,2)]}function $3(t,e,n){const r=[],i=t.elements[e];for(let a=0;a<n[0];a++)n[2]===16?r[a]=t.uint16(e,a):r[a]=t.byteArray[a+i.dataOffset];return r}function aQ(t,e){e.redPaletteColorLookupTableDescriptor=B3(t,"x00281101"),e.greenPaletteColorLookupTableDescriptor=B3(t,"x00281102"),e.bluePaletteColorLookupTableDescriptor=B3(t,"x00281103"),e.redPaletteColorLookupTableDescriptor[0]===0&&(e.redPaletteColorLookupTableDescriptor[0]=65536,e.greenPaletteColorLookupTableDescriptor[0]=65536,e.bluePaletteColorLookupTableDescriptor[0]=65536);const n=e.redPaletteColorLookupTableDescriptor[0],i=t.elements.x00281201.length===n?8:16;e.redPaletteColorLookupTableDescriptor[2]!==i&&(e.redPaletteColorLookupTableDescriptor[2]=i,e.greenPaletteColorLookupTableDescriptor[2]=i,e.bluePaletteColorLookupTableDescriptor[2]=i),e.redPaletteColorLookupTableData=$3(t,"x00281201",e.redPaletteColorLookupTableDescriptor),e.greenPaletteColorLookupTableData=$3(t,"x00281202",e.greenPaletteColorLookupTableDescriptor),e.bluePaletteColorLookupTableData=$3(t,"x00281203",e.bluePaletteColorLookupTableDescriptor)}function oQ(t,e){t.uint16("x00280103")===0?(e.smallestPixelValue=t.uint16("x00280106"),e.largestPixelValue=t.uint16("x00280107")):(e.smallestPixelValue=t.int16("x00280106"),e.largestPixelValue=t.int16("x00280107"))}function sQ(t){const e={samplesPerPixel:t.uint16("x00280002"),photometricInterpretation:t.string("x00280004"),rows:t.uint16("x00280010"),columns:t.uint16("x00280011"),bitsAllocated:t.uint16("x00280100"),bitsStored:t.uint16("x00280101"),highBit:t.uint16("x00280102"),pixelRepresentation:t.uint16("x00280103"),planarConfiguration:t.uint16("x00280006"),pixelAspectRatio:t.string("x00280034")};return oQ(t,e),e.photometricInterpretation==="PALETTE COLOR"&&t.elements.x00281101&&aQ(t,e),e}function cQ(t,e){let n=e.uint16("x00283002",0);n===0&&(n=65535);let r=0;t===0?r=e.uint16("x00283002",1):r=e.int16("x00283002",1);const i=e.uint16("x00283002",2),a={id:"1",firstValueMapped:r,numBitsPerEntry:i,lut:[]};for(let o=0;o<n;o++)t===0?a.lut[o]=e.uint16("x00283006",o):a.lut[o]=e.int16("x00283006",o);return a}function QC(t,e){if(!e||!e.items||!e.items.length)return;const n=[];for(let r=0;r<e.items.length;r++){const i=e.items[r].dataSet,a=cQ(t,i);a&&n.push(a)}return n}function lQ(t){const e=t.uint16("x00280103"),n=t.uint16("x00280101");return e===0?0:-1<<n-1}function uQ(t){const e=t.string("x00080016");if(e==="1.2.840.10008.5.1.4.1.1.2"||e==="1.2.840.10008.5.1.4.1.1.2.1")return 1;const n=t.floatString("x00281052"),r=t.floatString("x00281053");return n!==void 0&&r!==void 0?lQ(t)*r+n<0?1:0:t.elements.x00283000&&t.elements.x00283000.length>0?0:t.uint16("x00280103")}function Gs(t,e,n){const r=[],i=t.string(e);if(!i)return;const a=i.split("\\");if(!(n&&a.length<n)){for(let o=0;o<a.length;o++)r.push(parseFloat(a[o]));return r}}var l2={exports:{}};/*! dicom-parser - 1.8.12 - 2023-02-20 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/dicomParser */var fQ=l2.exports,JC;function gQ(){return JC||(JC=1,function(t,e){(function(n,r){t.exports=r(As)})(fQ,function(n){return i=[function(o,s){o.exports=n},function(o,s,c){c.r(s),c.d(s,"isStringVr",function(){return d}),c.d(s,"isPrivateTag",function(){return g}),c.d(s,"parsePN",function(){return h}),c.d(s,"parseTM",function(){return m}),c.d(s,"parseDA",function(){return v}),c.d(s,"explicitElementToString",function(){return C}),c.d(s,"explicitDataSetToJS",function(){return S}),c.d(s,"createJPEGBasicOffsetTable",function(){return R}),c.d(s,"parseDicomDataSetExplicit",function(){return fe}),c.d(s,"parseDicomDataSetImplicit",function(){return ue}),c.d(s,"readFixedString",function(){return G}),c.d(s,"alloc",function(){return qe}),c.d(s,"version",function(){return et}),c.d(s,"bigEndianByteArrayParser",function(){return Ze}),c.d(s,"ByteStream",function(){return st}),c.d(s,"sharedCopy",function(){return yt}),c.d(s,"DataSet",function(){return $}),c.d(s,"findAndSetUNElementLength",function(){return I}),c.d(s,"findEndOfEncapsulatedElement",function(){return b}),c.d(s,"findItemDelimitationItemAndSetElementLength",function(){return z}),c.d(s,"littleEndianByteArrayParser",function(){return Bt}),c.d(s,"parseDicom",function(){return bn}),c.d(s,"readDicomElementExplicit",function(){return ae}),c.d(s,"readDicomElementImplicit",function(){return Q}),c.d(s,"readEncapsulatedImageFrame",function(){return Bn}),c.d(s,"readEncapsulatedPixelData",function(){return Vr}),c.d(s,"readEncapsulatedPixelDataFromFragments",function(){return Mn}),c.d(s,"readPart10Header",function(){return pr}),c.d(s,"readSequenceItemsExplicit",function(){return ge}),c.d(s,"readSequenceItemsImplicit",function(){return ie}),c.d(s,"readSequenceItem",function(){return le}),c.d(s,"readTag",function(){return O});var u={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},d=function(Y){return u[Y]},g=function(Y){if(Y=parseInt(Y[4],16),isNaN(Y))throw"dicomParser.isPrivateTag: cannot parse last character of group";return Y%2==1},h=function(Y){if(Y!==void 0)return Y=Y.split("^"),{familyName:Y[0],givenName:Y[1],middleName:Y[2],prefix:Y[3],suffix:Y[4]}};function m(Y,J){if(2<=Y.length){var he=parseInt(Y.substring(0,2),10),Z=4<=Y.length?parseInt(Y.substring(2,4),10):void 0,ve=6<=Y.length?parseInt(Y.substring(4,6),10):void 0,Pe=8<=Y.length?Y.substring(7,13):void 0,Pe=Pe?parseInt(Pe,10)*Math.pow(10,6-Pe.length):void 0;if(J&&(isNaN(he)||Z!==void 0&&isNaN(Z)||ve!==void 0&&isNaN(ve)||Pe!==void 0&&isNaN(Pe)||he<0||23<he||Z&&(Z<0||59<Z)||ve&&(ve<0||59<ve)||Pe&&(Pe<0||999999<Pe)))throw"invalid TM '".concat(Y,"'");return{hours:he,minutes:Z,seconds:ve,fractionalSeconds:Pe}}if(J)throw"invalid TM '".concat(Y,"'")}function y(Y,J,he){return!isNaN(he)&&0<J&&J<=12&&0<Y&&Y<=function(Z,ve){switch(Z){case 2:return ve%4==0&&ve%100||ve%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(J,he)}function v(Y,J){if(Y&&Y.length===8){var he=parseInt(Y.substring(0,4),10),Z=parseInt(Y.substring(4,6),10),ve=parseInt(Y.substring(6,8),10);if(J&&y(ve,Z,he)!==!0)throw"invalid DA '".concat(Y,"'");return{year:he,month:Z,day:ve}}if(J)throw"invalid DA '".concat(Y,"'")}function C(Y,J){if(Y===void 0||J===void 0)throw"dicomParser.explicitElementToString: missing required parameters";if(J.vr===void 0)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var he,Z=J.vr,ve=J.tag;function Pe(Ct,xt){for(var wn="",sn=0;sn<Ct;sn++)sn!==0&&(wn+="/"),wn+=xt.call(Y,ve,sn).toString();return wn}if(d(Z)===!0)he=Y.string(ve);else{if(Z==="AT"){var Je=Y.uint32(ve);return Je===void 0?void 0:"x".concat((Je=Je<0?4294967295+Je+1:Je).toString(16).toUpperCase())}Z==="US"?he=Pe(J.length/2,Y.uint16):Z==="SS"?he=Pe(J.length/2,Y.int16):Z==="UL"?he=Pe(J.length/4,Y.uint32):Z==="SL"?he=Pe(J.length/4,Y.int32):Z==="FD"?he=Pe(J.length/8,Y.double):Z==="FL"&&(he=Pe(J.length/4,Y.float))}return he}function S(Y,J){if(Y===void 0)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";J=J||{omitPrivateAttibutes:!0,maxElementLength:128};var he,Z={};for(he in Y.elements){var ve=Y.elements[he];if(J.omitPrivateAttibutes!==!0||!g(he))if(ve.items){for(var Pe=[],Je=0;Je<ve.items.length;Je++)Pe.push(S(ve.items[Je].dataSet,J));Z[he]=Pe}else{var Ct=void 0;ve.length<J.maxElementLength&&(Ct=C(Y,ve)),Z[he]=Ct!==void 0?Ct:{dataOffset:ve.dataOffset,length:ve.length}}}return Z}function w(Y,J){return Y.byteArray[J]===255&&Y.byteArray[J+1]===217}function x(Y,J,he){for(var Z,ve,Pe=he;Pe<J.fragments.length;Pe++)if(Z=Y,ve=Pe,ve=J.fragments[ve],!(!w(Z,ve.position+ve.length-2)&&!w(Z,ve.position+ve.length-3)))return Pe}function R(Y,J,he){if(Y===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(J===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if(J.tag!=="x7fe00010")throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(J.encapsulatedPixelData!==!0||J.hadUndefinedLength!==!0||J.basicOffsetTable===void 0||J.fragments===void 0||J.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(he&&he.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";he=he||J.fragments;for(var Z=[],ve=0;;){Z.push(J.fragments[ve].offset);var Pe=x(Y,J,ve);if(Pe===void 0||Pe===J.fragments.length-1)return Z;ve=Pe+1}}function O(he){if(he===void 0)throw"dicomParser.readTag: missing required parameter 'byteStream'";var J=256*he.readUint16()*256,he=he.readUint16();return"x".concat("00000000".concat((J+he).toString(16)).substr(-8))}function b(Y,J,he){if(Y===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(J===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(J.encapsulatedPixelData=!0,J.basicOffsetTable=[],J.fragments=[],O(Y)!=="xfffee000")throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var Z=Y.readUint32()/4,ve=0;ve<Z;ve++){var Pe=Y.readUint32();J.basicOffsetTable.push(Pe)}for(var Je=Y.position;Y.position<Y.byteArray.length;){var Ct=O(Y),xt=Y.readUint32();if(Ct==="xfffee0dd")return Y.seek(xt),void(J.length=Y.position-J.dataOffset);if(Ct!=="xfffee000")return he&&he.push("unexpected tag ".concat(Ct," while searching for end of pixel data element with undefined length")),xt>Y.byteArray.length-Y.position&&(xt=Y.byteArray.length-Y.position),J.fragments.push({offset:Y.position-Je-8,position:Y.position,length:xt}),Y.seek(xt),void(J.length=Y.position-J.dataOffset);J.fragments.push({offset:Y.position-Je-8,position:Y.position,length:xt}),Y.seek(xt)}he&&he.push("pixel data element ".concat(J.tag," missing sequence delimiter tag xfffee0dd"))}function I(Y,J){if(Y===void 0)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var he=Y.byteArray.length-8;Y.position<=he;)if(Y.readUint16()===65534){var Z=Y.readUint16();if(Z===57565)return Y.readUint32()!==0&&Y.warnings("encountered non zero length following item delimiter at position ".concat(Y.position-4," while reading element of undefined length with tag ").concat(J.tag)),void(J.length=Y.position-J.dataOffset)}J.length=Y.byteArray.length-J.dataOffset,Y.seek(Y.byteArray.length-Y.position)}function G(Y,J,he){if(he<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(J+he>Y.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var Z,ve="",Pe=0;Pe<he;Pe++){if((Z=Y[J+Pe])===0)return J+=he,ve;ve+=String.fromCharCode(Z)}return ve}function j(Y,J){for(var he=0;he<J.length;he++){var Z=J[he];Z.enumerable=Z.enumerable||!1,Z.configurable=!0,"value"in Z&&(Z.writable=!0),Object.defineProperty(Y,Z.key,Z)}}function F(Y,J){return Y.parser!==void 0?Y.parser:J}var $=function(){function Y(Z,ve,Pe){(function(Je,Ct){if(!(Je instanceof Ct))throw new TypeError("Cannot call a class as a function")})(this,Y),this.byteArrayParser=Z,this.byteArray=ve,this.elements=Pe}var J,he;return J=Y,(he=[{key:"uint16",value:function(Z,ve){if(Z=this.elements[Z],ve=ve!==void 0?ve:0,Z&&Z.length!==0)return F(Z,this.byteArrayParser).readUint16(this.byteArray,Z.dataOffset+2*ve)}},{key:"int16",value:function(Z,ve){if(Z=this.elements[Z],ve=ve!==void 0?ve:0,Z&&Z.length!==0)return F(Z,this.byteArrayParser).readInt16(this.byteArray,Z.dataOffset+2*ve)}},{key:"uint32",value:function(Z,ve){if(Z=this.elements[Z],ve=ve!==void 0?ve:0,Z&&Z.length!==0)return F(Z,this.byteArrayParser).readUint32(this.byteArray,Z.dataOffset+4*ve)}},{key:"int32",value:function(Z,ve){if(Z=this.elements[Z],ve=ve!==void 0?ve:0,Z&&Z.length!==0)return F(Z,this.byteArrayParser).readInt32(this.byteArray,Z.dataOffset+4*ve)}},{key:"float",value:function(Z,ve){if(Z=this.elements[Z],ve=ve!==void 0?ve:0,Z&&Z.length!==0)return F(Z,this.byteArrayParser).readFloat(this.byteArray,Z.dataOffset+4*ve)}},{key:"double",value:function(Z,ve){if(Z=this.elements[Z],ve=ve!==void 0?ve:0,Z&&Z.length!==0)return F(Z,this.byteArrayParser).readDouble(this.byteArray,Z.dataOffset+8*ve)}},{key:"numStringValues",value:function(Z){if(Z=this.elements[Z],Z&&0<Z.length)return Z=G(this.byteArray,Z.dataOffset,Z.length).match(/\\/g),Z===null?1:Z.length+1}},{key:"string",value:function(Z,ve){if(Z=this.elements[Z],Z&&Z.Value)return Z.Value;if(Z&&0<Z.length)return Z=G(this.byteArray,Z.dataOffset,Z.length),0<=ve?Z.split("\\")[ve].trim():Z.trim()}},{key:"text",value:function(Z,ve){if(Z=this.elements[Z],Z&&0<Z.length)return Z=G(this.byteArray,Z.dataOffset,Z.length),0<=ve?Z.split("\\")[ve].replace(/ +$/,""):Z.replace(/ +$/,"")}},{key:"floatString",value:function(Z,ve){var Pe=this.elements[Z];if(Pe&&0<Pe.length&&(ve=this.string(Z,ve=ve!==void 0?ve:0),ve!==void 0))return parseFloat(ve)}},{key:"intString",value:function(Z,ve){var Pe=this.elements[Z];if(Pe&&0<Pe.length&&(ve=this.string(Z,ve=ve!==void 0?ve:0),ve!==void 0))return parseInt(ve)}},{key:"attributeTag",value:function(Z){var ve=this.elements[Z];if(ve&&ve.length===4){var Pe=F(ve,this.byteArrayParser).readUint16,Z=this.byteArray,ve=ve.dataOffset;return"x".concat("00000000".concat((256*Pe(Z,ve)*256+Pe(Z,ve+2)).toString(16)).substr(-8))}}}])&&j(J.prototype,he),Object.defineProperty(J,"prototype",{writable:!1}),Y}();function z(Y,J){if(Y===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var he=Y.byteArray.length-8;Y.position<=he;)if(Y.readUint16()===65534){var Z=Y.readUint16();if(Z===57357)return Y.readUint32()!==0&&Y.warnings("encountered non zero length following item delimiter at position ".concat(Y.position-4," while reading element of undefined length with tag ").concat(J.tag)),void(J.length=Y.position-J.dataOffset)}J.length=Y.byteArray.length-J.dataOffset,Y.seek(Y.byteArray.length-Y.position)}var oe=function(Y,J){return Y.vr!==void 0?Y.vr==="SQ":J.position+4<=J.byteArray.length?(Y=O(J),J.seek(-4),Y==="xfffee000"||Y==="xfffee0dd"):(J.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1)};function Q(Y,J,he){if(Y===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var Z=O(Y),Z={tag:Z,vr:he!==void 0?he(Z):void 0,length:Y.readUint32(),dataOffset:Y.position};return Z.length===4294967295&&(Z.hadUndefinedLength=!0),Z.tag===J||(!oe(Z,Y)||g(Z.tag)&&!Z.hadUndefinedLength?Z.hadUndefinedLength?z(Y,Z):Y.seek(Z.length):(ie(Y,Z,he),g(Z.tag)&&(Z.items=void 0))),Z}function le(Y){if(Y===void 0)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var J={tag:O(Y),length:Y.readUint32(),dataOffset:Y.position};if(J.tag!=="xfffee000")throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat(Y.position);return J}function X(Y,J){var he=le(Y);return he.length===4294967295?(he.hadUndefinedLength=!0,he.dataSet=function(Z,ve){for(var Pe={};Z.position<Z.byteArray.length;){var Je=Q(Z,void 0,ve);if((Pe[Je.tag]=Je).tag==="xfffee00d")return new $(Z.byteArrayParser,Z.byteArray,Pe)}return Z.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new $(Z.byteArrayParser,Z.byteArray,Pe)}(Y,J),he.length=Y.position-he.dataOffset):(he.dataSet=new $(Y.byteArrayParser,Y.byteArray,{}),ue(he.dataSet,Y,Y.position+he.length,{vrCallback:J})),he}function ie(Y,J,he){if(Y===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(J===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";J.items=[],(J.length===4294967295?function(Z,ve,Pe){for(;Z.position+4<=Z.byteArray.length;){var Je=O(Z);if(Z.seek(-4),Je==="xfffee0dd")return ve.length=Z.position-ve.dataOffset,Z.seek(8);Je=X(Z,Pe),ve.items.push(Je)}Z.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),ve.length=Z.byteArray.length-ve.dataOffset}:function(Z,ve,Pe){for(var Je=ve.dataOffset+ve.length;Z.position<Je;){var Ct=X(Z,Pe);ve.items.push(Ct)}})(Y,J,he)}function ye(Y,J){var he=le(Y);return he.length===4294967295?(he.hadUndefinedLength=!0,he.dataSet=function(Z,ve){for(var Pe={};Z.position<Z.byteArray.length;){var Je=ae(Z,ve);if((Pe[Je.tag]=Je).tag==="xfffee00d")return new $(Z.byteArrayParser,Z.byteArray,Pe)}return ve.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new $(Z.byteArrayParser,Z.byteArray,Pe)}(Y,J),he.length=Y.position-he.dataOffset):(he.dataSet=new $(Y.byteArrayParser,Y.byteArray,{}),fe(he.dataSet,Y,Y.position+he.length)),he}function ge(Y,J,he){if(Y===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(J===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";J.items=[],(J.length===4294967295?function(Z,ve,Pe){for(;Z.position+4<=Z.byteArray.length;){var Je=O(Z);if(Z.seek(-4),Je==="xfffee0dd")return ve.length=Z.position-ve.dataOffset,Z.seek(8);Je=ye(Z,Pe),ve.items.push(Je)}Pe.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),ve.length=Z.position-ve.dataOffset}:function(Z,ve,Pe){for(var Je=ve.dataOffset+ve.length;Z.position<Je;){var Ct=ye(Z,Pe);ve.items.push(Ct)}})(Y,J,he)}var W=function(Y){return Y==="OB"||Y==="OD"||Y==="OL"||Y==="OW"||Y==="SQ"||Y==="OF"||Y==="UC"||Y==="UR"||Y==="UT"||Y==="UN"?4:2};function ae(Y,J,he){if(Y===void 0)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var Z={tag:O(Y),vr:Y.readFixedString(2)};return W(Z.vr)===2?Z.length=Y.readUint16():(Y.seek(2),Z.length=Y.readUint32()),Z.dataOffset=Y.position,Z.length===4294967295&&(Z.hadUndefinedLength=!0),Z.tag===he||(Z.vr==="SQ"?ge(Y,Z,J):Z.length===4294967295?Z.tag==="x7fe00010"?b(Y,Z,J):(Z.vr==="UN"?ie:z)(Y,Z):Y.seek(Z.length)),Z}function fe(Y,J,he){var Z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(he=he===void 0?J.byteArray.length:he,J===void 0)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(he<J.position||he>J.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var ve=Y.elements;J.position<he;){var Pe=ae(J,Y.warnings,Z.untilTag);if((ve[Pe.tag]=Pe).tag===Z.untilTag)return}if(J.position>he)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function ue(Y,J,he){var Z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(he=he===void 0?Y.byteArray.length:he,J===void 0)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(he<J.position||he>J.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var ve=Y.elements;J.position<he;){var Pe=Q(J,Z.untilTag,Z.vrCallback);if((ve[Pe.tag]=Pe).tag===Z.untilTag)return}}function qe(Y,J){if(typeof Buffer<"u"&&Y instanceof Buffer)return Buffer.alloc(J);if(Y instanceof Uint8Array)return new Uint8Array(J);throw"dicomParser.alloc: unknown type for byteArray"}var et="1.8.12",Ze={readUint16:function(Y,J){if(J<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(J+2>Y.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(Y[J]<<8)+Y[J+1]},readInt16:function(Y,J){if(J<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(J+2>Y.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return J=(Y[J]<<8)+Y[J+1],J=32768&J?J-65535-1:J},readUint32:function(Y,J){if(J<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(J+4>Y.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*Y[J]+Y[J+1])+Y[J+2])+Y[J+3]},readInt32:function(Y,J){if(J<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(J+4>Y.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(Y[J]<<24)+(Y[J+1]<<16)+(Y[J+2]<<8)+Y[J+3]},readFloat:function(Y,J){if(J<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(J+4>Y.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var he=new Uint8Array(4);return he[3]=Y[J],he[2]=Y[J+1],he[1]=Y[J+2],he[0]=Y[J+3],new Float32Array(he.buffer)[0]},readDouble:function(Y,J){if(J<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(J+8>Y.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var he=new Uint8Array(8);return he[7]=Y[J],he[6]=Y[J+1],he[5]=Y[J+2],he[4]=Y[J+3],he[3]=Y[J+4],he[2]=Y[J+5],he[1]=Y[J+6],he[0]=Y[J+7],new Float64Array(he.buffer)[0]}};function yt(Y,J,he){if(typeof Buffer<"u"&&Y instanceof Buffer)return Y.slice(J,J+he);if(Y instanceof Uint8Array)return new Uint8Array(Y.buffer,Y.byteOffset+J,he);throw"dicomParser.from: unknown type for byteArray"}function tt(Y,J){for(var he=0;he<J.length;he++){var Z=J[he];Z.enumerable=Z.enumerable||!1,Z.configurable=!0,"value"in Z&&(Z.writable=!0),Object.defineProperty(Y,Z.key,Z)}}var st=function(){function Y(Z,ve,Pe){if(function(Je,Ct){if(!(Je instanceof Ct))throw new TypeError("Cannot call a class as a function")}(this,Y),Z===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(ve===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(!(ve instanceof Uint8Array)&&(typeof Buffer>"u"||!(ve instanceof Buffer)))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(Pe<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(Pe>=ve.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=Z,this.byteArray=ve,this.position=Pe||0,this.warnings=[]}var J,he;return J=Y,(he=[{key:"seek",value:function(Z){if(this.position+Z<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=Z}},{key:"readByteStream",value:function(Z){if(this.position+Z>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var ve=yt(this.byteArray,this.position,Z);return this.position+=Z,new Y(this.byteArrayParser,ve)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var Z=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,Z}},{key:"readUint32",value:function(){var Z=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,Z}},{key:"readFixedString",value:function(Z){var ve=G(this.byteArray,this.position,Z);return this.position+=Z,ve}}])&&tt(J.prototype,he),Object.defineProperty(J,"prototype",{writable:!1}),Y}(),Bt={readUint16:function(Y,J){if(J<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(J+2>Y.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return Y[J]+256*Y[J+1]},readInt16:function(Y,J){if(J<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(J+2>Y.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return J=Y[J]+(Y[J+1]<<8),J=32768&J?J-65535-1:J},readUint32:function(Y,J){if(J<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(J+4>Y.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return Y[J]+256*Y[J+1]+256*Y[J+2]*256+256*Y[J+3]*256*256},readInt32:function(Y,J){if(J<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(J+4>Y.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return Y[J]+(Y[J+1]<<8)+(Y[J+2]<<16)+(Y[J+3]<<24)},readFloat:function(Y,J){if(J<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(J+4>Y.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var he=new Uint8Array(4);return he[0]=Y[J],he[1]=Y[J+1],he[2]=Y[J+2],he[3]=Y[J+3],new Float32Array(he.buffer)[0]},readDouble:function(Y,J){if(J<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(J+8>Y.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var he=new Uint8Array(8);return he[0]=Y[J],he[1]=Y[J+1],he[2]=Y[J+2],he[3]=Y[J+3],he[4]=Y[J+4],he[5]=Y[J+5],he[6]=Y[J+6],he[7]=Y[J+7],new Float64Array(he.buffer)[0]}};function pr(Y){var J=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(Y===void 0)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var he=J.TransferSyntaxUID,Z=new st(Bt,Y);return function(){var ve=function(){if(Z.getSize()<=132&&he)return!1;if(Z.seek(128),Z.readFixedString(4)==="DICM")return!0;if(!(J||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return Z.seek(0),!1}(),Pe=[],Je={};if(!ve)return Z.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:he}},warnings:Pe};for(;Z.position<Z.byteArray.length;){var Ct=Z.position,xt=ae(Z,Pe);if("x0002ffff"<xt.tag){Z.position=Ct;break}xt.parser=Bt,Je[xt.tag]=xt}return(ve=new $(Z.byteArrayParser,Z.byteArray,Je)).warnings=Z.warnings,ve.position=Z.position,ve}()}var Lr="1.2.840.10008.1.2.2";function bn(Y){var J=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(Y===void 0)throw new Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var he,Z=function(Pe){if(Pe.elements.x00020010===void 0)throw new Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return Pe=Pe.elements.x00020010,Pe&&Pe.Value||G(Y,Pe.dataOffset,Pe.length)};function ve(xt){var Ct=Z(xt),Je=Ct!=="1.2.840.10008.1.2",Ct=function(wn,sn){var mr=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";if(wn!=="1.2.840.10008.1.2.1.99")return new st(wn===Lr?Ze:Bt,Y,sn);if(J&&J.inflater)return wn=J.inflater(Y,sn),new st(Bt,wn,0);if(mr==!0){var Ut=c(0),Yt=yt(Y,sn,Y.length-sn),Ut=Ut.inflateRawSync(Yt),Yt=qe(Y,Ut.length+sn);return Y.copy(Yt,0,0,sn),Ut.copy(Yt,sn),new st(Bt,Yt,0)}if(typeof pako>"u")throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return Ut=Y.slice(sn),Yt=pako.inflateRaw(Ut),(Ut=qe(Y,Yt.length+sn)).set(Y.slice(0,sn),0),Ut.set(Yt,sn),new st(Bt,Ut,0)}(Ct,xt.position),xt=new $(Ct.byteArrayParser,Ct.byteArray,{});xt.warnings=Ct.warnings;try{(Je?fe:ue)(xt,Ct,Ct.byteArray.length,J)}catch(wn){throw{exception:wn,dataSet:xt}}return xt}return function(Pe,Je){for(var Ct in Pe.elements)Pe.elements.hasOwnProperty(Ct)&&(Je.elements[Ct]=Pe.elements[Ct]);return Pe.warnings!==void 0&&(Je.warnings=Pe.warnings.concat(Je.warnings)),Je}(he=pr(Y,J),ve(he))}var Gn=function(Y,J,he){for(var Z=0,ve=J;ve<J+he;ve++)Z+=Y[ve].length;return Z};function Mn(Y,Je,he,Z,ve){if(ve=ve||Je.fragments,Y===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(Je===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(he===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if((Z=Z||1)===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if(Je.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(Je.encapsulatedPixelData!==!0||Je.hadUndefinedLength!==!0||Je.basicOffsetTable===void 0||Je.fragments===void 0||Je.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(he<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(he>=Je.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(Z<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(he+Z>Je.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var Pe=new st(Y.byteArrayParser,Y.byteArray,Je.dataOffset),Je=le(Pe);if(Je.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";Pe.seek(Je.length);var Ct=Pe.position;if(Z===1)return yt(Pe.byteArray,Ct+ve[he].offset+8,ve[he].length);for(var Je=Gn(ve,he,Z),xt=qe(Pe.byteArray,Je),wn=0,sn=he;sn<he+Z;sn++)for(var mr=Ct+ve[sn].offset+8,Ut=0;Ut<ve[sn].length;Ut++)xt[wn++]=Pe.byteArray[mr++];return xt}var Nn=function(Y,J){for(var he=0;he<Y.length;he++)if(Y[he].offset===J)return he},un=function(Y,J,he,Z){if(Y===J.length-1)return he.length-Z;for(var ve=J[Y+1],Pe=Z+1;Pe<he.length;Pe++)if(he[Pe].offset===ve)return Pe-Z;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function Bn(Y,J,he,Z,ve){if(Z=Z||J.basicOffsetTable,ve=ve||J.fragments,Y===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(J===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(he===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(Z===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if(J.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(J.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(J.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(J.fragments===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(Z.length===0)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(he<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(he>=Z.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var Pe=Z[he],Pe=Nn(ve,Pe);if(Pe===void 0)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return Mn(Y,J,Pe,un(he,Z,ve,Pe),ve)}var nr=!1;function Vr(Y,J,he){if(nr||(nr=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),Y===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(J===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(he===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if(J.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(J.encapsulatedPixelData!==!0||J.hadUndefinedLength!==!0||J.basicOffsetTable===void 0||J.fragments===void 0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(he<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return J.basicOffsetTable.length!==0?Bn(Y,J,he):Mn(Y,J,0,J.fragments.length)}s.default={isStringVr:d,isPrivateTag:g,parsePN:h,parseTM:m,parseDA:v,explicitElementToString:C,explicitDataSetToJS:S,createJPEGBasicOffsetTable:R,parseDicomDataSetExplicit:fe,parseDicomDataSetImplicit:ue,readFixedString:G,alloc:qe,version:et,bigEndianByteArrayParser:Ze,ByteStream:st,sharedCopy:yt,DataSet:$,findAndSetUNElementLength:I,findEndOfEncapsulatedElement:b,findItemDelimitationItemAndSetElementLength:z,littleEndianByteArrayParser:Bt,parseDicom:bn,readDicomElementExplicit:ae,readDicomElementImplicit:Q,readEncapsulatedImageFrame:Bn,readEncapsulatedPixelData:Vr,readEncapsulatedPixelDataFromFragments:Mn,readPart10Header:pr,readSequenceItemsExplicit:ge,readSequenceItemsImplicit:ie,readSequenceItem:le,readTag:O,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],a={},r.m=i,r.c=a,r.d=function(o,s,c){r.o(o,s)||Object.defineProperty(o,s,{enumerable:!0,get:c})},r.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},r.t=function(o,s){if(1&s&&(o=r(o)),8&s||4&s&&typeof o=="object"&&o&&o.__esModule)return o;var c=Object.create(null);if(r.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:o}),2&s&&typeof o!="string")for(var u in o)r.d(c,u,(function(d){return o[d]}).bind(null,u));return c},r.n=function(o){var s=o&&o.__esModule?function(){return o.default}:function(){return o};return r.d(s,"a",s),s},r.o=function(o,s){return Object.prototype.hasOwnProperty.call(o,s)},r.p="",r(r.s=1);function r(o){if(a[o])return a[o].exports;var s=a[o]={i:o,l:!1,exports:{}};return i[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}var i,a})}(l2)),l2.exports}var Dr=gQ();function Pp(t){const e=t.indexOf(":");let n=t.substring(e+1);const r=n.indexOf("frame=");let i;if(r!==-1){const s=n.substring(r+6);i=parseInt(s,10),n=n.substring(0,r-1)}const a=t.substring(0,e),o=i!==void 0?i-1:void 0;return{scheme:a,url:n,frame:i,pixelDataFrame:o}}let ev={open(t,e){t.open("get",e,!0)},beforeSend(){},beforeProcessing(t){return Promise.resolve(t.response)},imageCreated(){},strict:!1};function dQ(t){ev=Object.assign(ev,t)}function Up(){return ev}function W8(t,e,n={},r={}){const i=Up(),a=c=>{if(typeof i.errorInterceptor=="function"){const u=new Error("request failed");u.request=c,u.response=c.response,u.status=c.status,i.errorInterceptor(u)}},o=new XMLHttpRequest,s=new Promise((c,u)=>{i.open(o,t,n,r);const d=i.beforeSend(o,e,n,r);o.responseType="arraybuffer";const g=Object.assign({},n,d);Object.keys(g).forEach(function(h){g[h]!==null&&(h==="Accept"&&t.indexOf("accept=")!==-1||o.setRequestHeader(h,g[h]))}),r.deferred={resolve:c,reject:u},r.url=t,r.imageId=e,o.onloadstart=function(h){i.onloadstart&&i.onloadstart(h,r),je(Ye,"cornerstoneimageloadstart",{url:t,imageId:e})},o.onloadend=function(h){i.onloadend&&i.onloadend(h,r),je(Ye,"cornerstoneimageloadend",{url:t,imageId:e})},o.onreadystatechange=function(h){i.onreadystatechange&&i.onreadystatechange(h,r),o.readyState===4&&(o.status===200||o.status===206?i.beforeProcessing(o).then(c).catch(()=>{a(o),u(o)}):(a(o),u(o)))},o.onprogress=function(h){const m=h.loaded;let y,v;h.lengthComputable&&(y=h.total,v=Math.round(m/y*100)),je(Ye,"cornerstoneimageloadprogress",{url:t,imageId:e,loaded:m,total:y,percentComplete:v}),i.onprogress&&i.onprogress(h,r)},o.onerror=function(){a(o),u(o)},o.onabort=function(){a(o),u(o)},o.send()});return s.xhr=o,s}function hQ(t,e,n){if(n+t.length>e.length)return!1;let r=n;for(let i=0;i<t.length;i++)if(t[i]!==e[r++])return!1;return!0}function pQ(t){const e=new Uint8Array(t.length);for(let n=0,r=t.length;n<r;n++)e[n]=t.charCodeAt(n);return e}function eS(t,e,n){n=n||0;const r=pQ(e);for(let i=n;i<t.length;i++)if(r[0]===t[i]&&hQ(r,t,i))return i;return-1}const{ImageQualityStatus:tS}=zs;function z8(t,e,n){n||={};const r=new Uint8Array(e),i=!!n?.isPartial;if(t.indexOf("multipart")===-1)return{contentType:t,imageQualityStatus:i?tS.SUBRESOLUTION:tS.FULL_RESOLUTION,pixelData:r};let{tokenIndex:a,responseHeaders:o,boundary:s,multipartContentType:c}=n;if(a||=eS(r,`\r
\r
`),a===-1)throw new Error("invalid response - no multipart mime header");if(!s&&(o=yQ(r,0,a).split(`\r
`),s=mQ(o),!s))throw new Error("invalid response - no boundary marker");const u=a+4,d=eS(r,s,u);if(d===-1&&!i)throw new Error("invalid response - terminating boundary not found");return c||=vQ(o),n.tokenIndex=a,n.boundary=s,n.responseHeaders=o,n.multipartContentType=c,n.isPartial=d===-1,{contentType:c,extractDone:!i||d!==-1,tokenIndex:a,responseHeaders:o,boundary:s,multipartContentType:c,pixelData:e.slice(u,d-2)}}function mQ(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,2)==="--")return t[e]}function vQ(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,13)==="Content-Type:")return t[e].substr(13).trim()}function yQ(t,e,n){e=e||0,n=n||t.length-e;let r="";for(let i=e;i<e+n;i++)r+=String.fromCharCode(t[i]);return r}const{ImageQualityStatus:nS}=zs;function H8(t,e=!0){return e?t.imageQualityStatus??nS.FULL_RESOLUTION:nS.SUBRESOLUTION}const{ProgressiveIterator:TQ}=js;function CQ(t,e,n={},r={}){const i=Up(),{retrieveOptions:a={},streamingData:o={}}=r,s=a.minChunkSize||128*1024,c=d=>{if(typeof i.errorInterceptor=="function"){const g=new Error("request failed");i.errorInterceptor(g)}},u=new TQ("streamRequest");return u.generate(async(d,g)=>{const h=i.beforeSend?.(null,t,n,{}),m=Object.assign({},n,h);Object.keys(m).forEach(function(y){m[y]===null&&(m[y]=void 0),y==="Accept"&&t.indexOf("accept=")!==-1&&(m[y]=void 0)});try{const y=await fetch(t,{headers:m,signal:void 0});if(y.status!==200)throw new Error(`Couldn't retrieve ${t} got status ${y.status}`);const v=y.body.getReader(),C=y.headers,S=C.get("content-type"),w=Number(C.get("Content-Length"));let x=!1,R=o.encodedData,O=o.lastSize||0;for(o.isPartial=!0;!x;){const{done:b,value:I}=await v.read();if(R=SQ(R,I),!R){if(x)throw new Error(`Done but no image frame available ${e}`);continue}if(x=b||R.byteLength===w,!x&&R.length<O+s)continue;O=R.length,o.isPartial=!b;const G=z8(S,R,o),j=H8(a,x),F={url:t,imageId:e,...G,percentComplete:b?100:G.pixelData?.length*100/w,imageQualityStatus:j,done:x};d.add(F,x)}}catch(y){c(),console.error(y),g(y)}}),u.getNextPromise()}function SQ(t,e){if(!t)return e;if(!e)return t;const n=new Uint8Array(t.length+e.length);return n.set(t,0),n.set(e,t.length),n}function wQ(t){const e=t.elements.x7fe00010.fragments,n=t.byteArray.length;for(const r of e){const{position:i,length:a}=r;a>n-i&&(console.log(`Truncated fragment, changing fragment length from ${r.length} to ${n-i}`),r.length=n-i)}return t}function xQ(t){let e=Dr.parseDicom(t,{untilTag:"x7fe00010"});e.elements.x7fe00010||console.warn("Pixel data not found!");let n;try{n=Dr.parseDicom(t)}catch(r){console.error(r),console.log("pixel data dataset:",r.dataSet),n=r.dataSet}return e.elements.x7fe00010=n.elements.x7fe00010,e=wQ(e),e}async function D_(t,e,n){const r=xQ(t),{uri:i,imageId:a,fileTotalLength:o}=n;return r.fetchMore=async function(s){const c=Object.assign({uri:i,imageId:a,fetchedLength:t.length,lengthToFetch:o-t.length},s),{fetchedLength:u,lengthToFetch:d}=c,{arrayBuffer:g}=await e(i,a,{byteRange:`${u}-${u+d}`}),h=new Uint8Array(g),m=new Uint8Array(r.byteArray.length+h.length);return m.set(r.byteArray),m.set(h,r.byteArray.length),D_(m,e,n)},r}function EQ(t,e){if(!t)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:i}=b_(t);if(r||n>1){const{shared:a,perFrame:o}=__(r,i,e);return{NumberOfFrames:n,PerFrameFunctionalInformation:o,SharedFunctionalInformation:a}}return{NumberOfFrames:n}}function __(t,e,n){const r={};(e?Object.values(e.items[0].dataSet.elements):[]).map(a=>r[a.tag]=a);const i={};return(t?Object.values(t.items[n-1].dataSet.elements):[]).map(a=>i[a.tag]=a),{shared:r,perFrame:i}}function b_(t){if(!t)return;const{elements:e,...n}=t,{x52009230:r,x52009229:i,...a}=e;return{NumberOfFrames:t.intString("x00280008"),PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:i,otherElements:a,otherAttributtes:n}}function RQ(t,e){if(!e)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:i,otherElements:a}=b_(e);if(r||n>1){const{shared:o,perFrame:s}=__(r,i,t),c={elements:{...a,...o,...s}},u=Object.create(e);return Object.assign(u,c)}return e}let fi={};const OQ=()=>{fi={}};function j8(t){if(fi[t])return fi[t]}function DQ(t){const e=j8(t);return M_(e)}function M_(t){if(!t)return!1;const e=t.intString("x00280008");return e&&e>1}function _Q(t){return t.indexOf("&frame=")}function bQ(t){const e=_Q(t),n=e===-1?t:t.slice(0,e),r=parseInt(t.slice(e+7),10)||1;let i;return fi[n]?i=fi[n].dataSet:i=void 0,{dataSet:i,frame:r}}function MQ(t){const e=[],n=j8(t);if(M_(n)){const r=n.intString("x00280008");for(let i=1;i<=r;i++)e.push(`${t}&frame=${i}`)}else e.push(t);return e}const L_={_get:j8,generateMultiframeWADOURIs:MQ,retrieveMultiframeDataset:bQ,isMultiframeDataset:DQ};let lf=0,wl={};function LQ(t){return fi[t]!==void 0}function VQ(t){let e;if(t.includes("&frame=")){const{frame:n,dataSet:r}=L_.retrieveMultiframeDataset(t);e=RQ(n,r)}else fi[t]&&(e=fi[t].dataSet);return e}function IQ(t,e){const n=fi[t];if(!n){console.error(`No loaded dataSet for uri ${t}`);return}lf-=n.dataSet.byteArray.length,n.dataSet=e,lf+=e.byteArray.length,je(Ye,"datasetscachechanged",{uri:t,action:"updated",cacheInfo:Fp()})}function AQ(t,e=W8,n){if(fi[t])return new Promise(a=>{fi[t].cacheCount++,a(fi[t].dataSet)});if(wl[t])return wl[t].cacheCount++,wl[t];const r=e(t,n),i=new Promise((a,o)=>{r.then(async function(s){const c={isPartialContent:!1,fileTotalLength:null};if(!(s instanceof ArrayBuffer)){if(!s.arrayBuffer)return o(new Error("If not returning ArrayBuffer, must return object with `arrayBuffer` parameter"));c.isPartialContent=s.flags.isPartialContent,c.fileTotalLength=s.flags.fileTotalLength,s=s.arrayBuffer}const u=new Uint8Array(s);let d;try{c.isPartialContent?d=await D_(u,e,{uri:t,imageId:n,fileTotalLength:c.fileTotalLength}):d=Dr.parseDicom(u)}catch(g){return o(g)}fi[t]={dataSet:d,cacheCount:i.cacheCount},lf+=d.byteArray.length,a(d),je(Ye,"datasetscachechanged",{uri:t,action:"loaded",cacheInfo:Fp()})},o).then(()=>{delete wl[t]},()=>{delete wl[t]})});return i.cacheCount=1,wl[t]=i,i}function NQ(t){fi[t]&&(fi[t].cacheCount--,fi[t].cacheCount===0&&(lf-=fi[t].dataSet.byteArray.length,delete fi[t],je(Ye,"datasetscachechanged",{uri:t,action:"unloaded",cacheInfo:Fp()})))}function Fp(){return{cacheSizeInBytes:lf,numberOfDataSetsCached:Object.keys(fi).length}}function PQ(){OQ(),wl={},lf=0}const r1={isLoaded:LQ,load:AQ,unload:NQ,getInfo:Fp,purge:PQ,get:VQ,update:IQ};function UQ(t){const e=[];for(let n=0;n<=30;n+=2){let r=`x60${n.toString(16)}`;r.length===4&&(r=`x600${n.toString(16)}`);const i=t.elements[`${r}3000`];if(!i)continue;const a=[];for(let o=0;o<i.length;o++)for(let s=0;s<8;s++){const c=t.byteArray[i.dataOffset+o];a[o*8+s]=c>>s&1}e.push({rows:t.uint16(`${r}0010`),columns:t.uint16(`${r}0011`),type:t.string(`${r}0040`),x:t.int16(`${r}0050`,1)-1,y:t.int16(`${r}0050`,0)-1,pixelData:a,description:t.string(`${r}0022`),label:t.string(`${r}1500`),roiArea:t.string(`${r}1301`),roiMean:t.string(`${r}1302`),roiStandardDeviation:t.string(`${r}1303`)})}return{overlays:e}}function Df(t){return t==="RECON TOMO"||t==="RECON GATED TOMO"}function q8(t,e){const n=t.string("x00080008");if(n){const r=n.split("\\");if(r.length>e)return r[e]}}function FQ(t){let e;if(t.string("x00080060")?.includes("NM")){const r=q8(t,2);r&&Df(r)&&t.elements.x00540022&&(e=Gs(t.elements.x00540022.items[0].dataSet,"x00200037",6))}return e}function kQ(t){let e;if(t.string("x00080060")?.includes("NM")){const r=q8(t,2);r&&Df(r)&&t.elements.x00540022&&(e=Gs(t.elements.x00540022.items[0].dataSet,"x00200032",3))}return e}function rS(t){let e=Gs(t,"x00200037",6);return!e&&t.elements.x00209116&&(e=Gs(t.elements.x00209116.items[0].dataSet,"x00200037",6)),e||(e=FQ(t)),e}function iS(t){let e=Gs(t,"x00200032",3);return!e&&t.elements.x00209113&&(e=Gs(t.elements.x00209113.items[0].dataSet,"x00200032",3)),e||(e=kQ(t)),e}function aS(t){let e=Gs(t,"x00280030",2);return!e&&t.elements.x00289110&&(e=Gs(t.elements.x00289110.items[0].dataSet,"x00280030",2)),e}function oS(t){let e;return t.elements.x00180050?e=t.floatString("x00180050"):t.elements.x00289110&&t.elements.x00289110.items.length&&t.elements.x00289110.items[0].dataSet.elements.x00180050&&(e=t.elements.x00289110.items[0].dataSet.floatString("x00180050")),e}function V_(t,e,n){const r={};for(const i of n)try{const a=e(i,t);if(a){const o={};for(const s in a)if(s in a){const c=GQ(s);o[c]=a[s]}Object.assign(r,o)}}catch(a){console.error(`Error retrieving ${i} data:`,a)}return r}const GQ=t=>t.charAt(0).toUpperCase()+t.slice(1),I_=["multiframeModule","generalSeriesModule","patientStudyModule","imagePlaneModule","nmMultiframeGeometryModule","imagePixelModule","modalityLutModule","voiLutModule","sopCommonModule","petIsotopeModule","overlayPlaneModule","transferSyntax","petSeriesModule","petImageModule"];function sS(t){const e=t.elements.x00186011;return!e||!e.items?[]:e.items.map(r=>{const i=r.dataSet.double("x0018602c"),a=r.dataSet.double("x0018602e"),o=r.dataSet.uint16("x00186024"),s=r.dataSet.uint16("x00186026"),c=r.dataSet.uint16("x0018601a"),u=r.dataSet.uint16("x0018601e"),d=r.dataSet.uint16("x00186018"),g=r.dataSet.uint16("x0018601c"),h=r.dataSet.int32("x00186020")||null,m=r.dataSet.int32("x00186022")||null,y=r.dataSet.uint16("x0018602a"),v=r.dataSet.uint16("x00186028"),C=r.dataSet.uint16("x00186012"),S=r.dataSet.uint16("x00186014"),w=r.dataSet.uint16("x00186016"),x=r.dataSet.uint16("x00186030");return{regionLocationMinY0:c,regionLocationMaxY1:u,regionLocationMinX0:d,regionLocationMaxX1:g,referencePixelX0:h,referencePixelY0:m,physicalDeltaX:i,physicalDeltaY:a,physicalUnitsXDirection:o,physicalUnitsYDirection:s,referencePhysicalPixelValueY:y,referencePhysicalPixelValueX:v,regionSpatialFormat:C,regionDataType:S,regionFlags:w,transducerFrequency:x}})}function A_(t,e){const{MetadataModules:n}=zs;if(Array.isArray(e))return;const r=Pp(e);if(t===n.MULTIFRAME){const o=L_.retrieveMultiframeDataset(r.url);return o.dataSet?EQ(o.dataSet,o.frame):void 0}let i=r.url;r.frame&&(i=`${i}&frame=${r.frame}`);const a=r1.get(i);if(a)return BQ(t,e,a)}function BQ(t,e,n){const{MetadataModules:r}=zs;if(t===r.GENERAL_STUDY)return{studyDescription:n.string("x00081030"),studyDate:Dr.parseDA(n.string("x00080020")),studyTime:Dr.parseTM(n.string("x00080030")||""),accessionNumber:n.string("x00080050")};if(t===r.GENERAL_SERIES)return{modality:n.string("x00080060"),seriesInstanceUID:n.string("x0020000e"),seriesDescription:n.string("x0008103e"),seriesNumber:n.intString("x00200011"),studyInstanceUID:n.string("x0020000d"),seriesDate:Dr.parseDA(n.string("x00080021")),seriesTime:Dr.parseTM(n.string("x00080031")||""),acquisitionDate:Dr.parseDA(n.string("x00080022")),acquisitionTime:Dr.parseTM(n.string("x00080032")||"")};if(t===r.GENERAL_IMAGE)return{sopInstanceUID:n.string("x00080018"),instanceNumber:n.intString("x00200013"),lossyImageCompression:n.string("x00282110"),lossyImageCompressionRatio:n.floatString("x00282112"),lossyImageCompressionMethod:n.string("x00282114")};if(t===r.PATIENT)return{patientID:n.string("x00100020"),patientName:n.string("x00100010")};if(t===r.PATIENT_STUDY)return{patientAge:n.intString("x00101010"),patientSize:n.floatString("x00101020"),patientSex:n.string("x00100040"),patientWeight:n.floatString("x00101030")};if(t===r.NM_MULTIFRAME_GEOMETRY){const i=n.string("x00080060"),a=q8(n,2);return{modality:i,imageType:n.string("x00080008"),imageSubType:a,imageOrientationPatient:rS(n),imagePositionPatient:iS(n),sliceThickness:oS(n),pixelSpacing:aS(n),numberOfFrames:n.uint16("x00280008"),isNMReconstructable:Df(a)&&i.includes("NM")}}if(t===r.IMAGE_PLANE){const i=rS(n),a=iS(n),o=aS(n),s=oS(n);let c=null,u=null;o&&(u=o[0],c=o[1]);let d=null,g=null;return i&&(d=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])],g=[parseFloat(i[3]),parseFloat(i[4]),parseFloat(i[5])]),{frameOfReferenceUID:n.string("x00200052"),rows:n.uint16("x00280010"),columns:n.uint16("x00280011"),imageOrientationPatient:i,rowCosines:d,columnCosines:g,imagePositionPatient:a,sliceThickness:s,sliceLocation:n.floatString("x00201041"),pixelSpacing:o,rowPixelSpacing:u,columnPixelSpacing:c}}if(t===r.CINE)return{frameTime:n.floatString("x00181063")};if(t===r.IMAGE_PIXEL)return sQ(n);if(t===r.VOI_LUT){const i=uQ(n);return{windowCenter:Gs(n,"x00281050",1),windowWidth:Gs(n,"x00281051",1),voiLUTSequence:QC(i,n.elements.x00283010),voiLUTFunction:n.string("x00281056")}}if(t===r.MODALITY_LUT)return{rescaleIntercept:n.floatString("x00281052"),rescaleSlope:n.floatString("x00281053"),rescaleType:n.string("x00281054"),modalityLUTSequence:QC(n.uint16("x00280103"),n.elements.x00283000)};if(t===r.SOP_COMMON)return{sopClassUID:n.string("x00080016"),sopInstanceUID:n.string("x00080018")};if(t===r.PET_ISOTOPE){const i=n.elements.x00540016;if(i===void 0)return;const a=i.items[0].dataSet;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:Dr.parseTM(a.string("x00181072")||""),radionuclideTotalDose:a.floatString("x00181074"),radionuclideHalfLife:a.floatString("x00181075")}}}if(t===r.OVERLAY_PLANE)return UQ(n);if(t==="transferSyntax"){let i;try{i=n.string("x00020010")}catch{}return{transferSyntaxUID:i}}if(t===r.PET_SERIES)return{correctedImage:n.string("x00280051"),units:n.string("x00541001"),decayCorrection:n.string("x00541102")};if(t===r.PET_IMAGE)return{frameReferenceTime:n.floatString(n.string("x00541300")||""),actualFrameDuration:n.intString(n.string("x00181242"))};if(t===r.ULTRASOUND_ENHANCED_REGION)return sS(n);if(t===r.CALIBRATION&&n.string("x00080060")==="US")return{sequenceOfUltrasoundRegions:sS(n)};if(t==="instance")return V_(e,A_,I_)}let kp=[];function $Q(t){return`dicomfile:${kp.push(t)-1}`}function WQ(t){return kp[t]}function zQ(t){kp[t]=void 0}function HQ(){kp=[]}const jQ={add:$Q,get:WQ,remove:zQ,purge:HQ};function qQ(t){const e=t.intString("x00280008"),n=t.elements.x7fe00010;return e!==n.fragments.length}function KQ(t,e){if(t.elements.x7fe00010&&t.elements.x7fe00010.basicOffsetTable.length)return Dr.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e);if(qQ(t)){const u=Dr.createJPEGBasicOffsetTable(t,t.elements.x7fe00010);return Dr.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e,u)}const n=t.elements.x7fe00010.fragments,r=new Dr.ByteStream(t.byteArrayParser,t.byteArray,t.elements.x7fe00010.dataOffset),i=Dr.readSequenceItem(r);if(i.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";r.seek(i.length);const a=r.position;if(e+1>n.length)throw"dicomParser.readEncapsulatedPixelData: frame exceeds number of fragments";const s=a+n[e].offset+8,c=n[e].length;return new Uint8Array(r.byteArray.buffer.slice(r.byteArray.byteOffset+s,r.byteArray.byteOffset+s+c))}function YQ(t,e){return t&1<<e}function XQ(t,e,n){const r=new Uint8Array(n);for(let i=0;i<n;i++){const a=Math.floor(i/8),o=t[a+e],s=i%8;r[i]=YQ(o,s)?1:0}return r}function ZQ(t,e){const n=t.elements.x7fe00010||t.elements.x7fe00008,r=t.uint16("x00280100"),i=t.uint16("x00280010"),a=t.uint16("x00280011");let o=t.uint16("x00280002");t.string("x00280004")==="YBR_FULL_422"&&(o=2,console.warn(`Using SamplesPerPixel of 2 for YBR_FULL_422 photometric interpretation.
      See http://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.7.6.3.html for more information.`));const c=n.dataOffset,u=i*a*o;let d;if(r===8){if(d=c+e*u,d>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(d,d+u))}else if(r===16){if(d=c+e*u*2,d>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(d,d+u*2))}else if(r===1){if(d=c+e*u*.125,d>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return XQ(t.byteArray,d,u)}else if(r===32){if(d=c+e*u*4,d>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(d,d+u*4))}throw new Error("unsupported pixel format")}function QQ(t){const e=Pp(t),n=parseInt(e.url,10),r=jQ.get(n);return new Promise((i,a)=>{const o=new FileReader;o.onload=s=>{const c=s.target.result;i(c)},o.onerror=a,o.readAsArrayBuffer(r)})}function N_(t,e=0){const n=t.elements.x7fe00010||t.elements.x7fe00008;return n?n.encapsulatedPixelData?KQ(t,e):ZQ(t,e):null}function K8(t){let e=t[0],n=t[0],r;const i=t.length;for(let a=1;a<i;a++)r=t[a],e=Math.min(e,r),n=Math.max(n,r);return{min:e,max:n}}function W3(t,e,n){t.planarConfiguration===0?JZ(t.pixelData,e,n):eQ(t.pixelData,e,n)}function JQ(t,e,n){t.planarConfiguration===0?tQ(t.pixelData,e,n):nQ(t.pixelData,e,n)}function eJ(t,e,n){if(t.photometricInterpretation==="RGB")W3(t,e,n);else if(t.photometricInterpretation==="YBR_RCT")W3(t,e,n);else if(t.photometricInterpretation==="YBR_ICT")W3(t,e,n);else if(t.photometricInterpretation==="PALETTE COLOR")iQ(t,e,n);else if(t.photometricInterpretation==="YBR_FULL_422")rQ(t.pixelData,e,n);else if(t.photometricInterpretation==="YBR_FULL")JQ(t,e,n);else throw new Error(`No color space conversion for photometric interpretation ${t.photometricInterpretation}`)}function tJ(t){if(t===void 0)return!1;const{rows:e,columns:n,photometricInterpretation:r,pixelDataLength:i,planarConfiguration:a}=t;return i===4*n*e?!1:r==="PALETTE COLOR"?!0:r.endsWith("420")?i===(3*Math.ceil(n/2)+Math.floor(n/2))*e:r.endsWith("422")?i===(3*Math.ceil(n/2)+Math.floor(n/2))*Math.ceil(e/2)+Math.floor(e/2)*n:r!=="RGB"||a===1}function nJ(t){return rJ(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(t))))}function rJ(t){let e;try{return decodeURIComponent(escape(t))}catch(n){if(e=n,e instanceof URIError)return t;throw e}}function iJ(t,e,n){const r=new Date().getTime(),i=new Blob([e],{type:"image/jpeg"});return new Promise((a,o)=>{const s=new FileReader;s.readAsBinaryString===void 0?s.readAsArrayBuffer(i):s.readAsBinaryString(i),s.onload=function(){const c=new Image;c.onload=function(){n.height=c.height,n.width=c.width,t.rows=c.height,t.columns=c.width;const u=n.getContext("2d");u.drawImage(this,0,0);const d=u.getImageData(0,0,c.width,c.height),g=new Date().getTime();t.pixelData=new Uint8Array(d.data.buffer),t.imageData=d,t.decodeTimeInMS=g-r;const h=K8(t.pixelData);t.smallestPixelValue=h.min,t.largestPixelValue=h.max,t.pixelDataLength=t.pixelData.length,a(t)},c.onerror=function(u){o(u)},s.readAsBinaryString===void 0?c.src=`data:image/jpeg;base64,${window.btoa(nJ(s.result))}`:c.src=`data:image/jpeg;base64,${window.btoa(s.result)}`},s.onerror=c=>{o(c)}})}function La(t,e,n,r,i){const a={...r};delete a.loader,delete a.streamingData;const o=cx(),s=a.priority||void 0;return a.transferPixelData&&n.buffer,o.executeTask("dicomImageLoader","decodeTask",{imageFrame:t,transferSyntax:e,pixelData:n,options:a,decodeConfig:i},{priority:s,requestType:a?.requestType})}function aJ(t,e,n,r,i={},a){switch(e){case"1.2.840.10008.1.2":return La(t,e,n,i,a);case"1.2.840.10008.1.2.1":return La(t,e,n,i,a);case"1.2.840.10008.1.2.2":return La(t,e,n,i,a);case"1.2.840.10008.1.2.1.99":return La(t,e,n,i,a);case"1.2.840.10008.1.2.5":return La(t,e,n,i,a);case"1.2.840.10008.1.2.4.50":return t.bitsAllocated===8&&(t.samplesPerPixel===3||t.samplesPerPixel===4)?iJ(t,n,r):La(t,e,n,i,a);case"1.2.840.10008.1.2.4.51":return La(t,e,n,i,a);case"1.2.840.10008.1.2.4.57":return La(t,e,n,i,a);case"1.2.840.10008.1.2.4.70":return La(t,e,n,i,a);case"1.2.840.10008.1.2.4.80":return La(t,e,n,i,a);case"1.2.840.10008.1.2.4.81":return La(t,e,n,i,a);case"1.2.840.10008.1.2.4.90":return La(t,e,n,i,a);case"1.2.840.10008.1.2.4.91":return La(t,e,n,i,a);case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":return La(t,e,n,i,a)}return Promise.reject(new Error(`No decoder for transfer syntax ${e}`))}function oJ(t){const e=it("imagePixelModule",t);return{samplesPerPixel:e.samplesPerPixel,photometricInterpretation:e.photometricInterpretation,planarConfiguration:e.planarConfiguration,rows:e.rows,columns:e.columns,bitsAllocated:e.bitsAllocated,bitsStored:e.bitsStored,pixelRepresentation:e.pixelRepresentation,smallestPixelValue:e.smallestPixelValue,largestPixelValue:e.largestPixelValue,redPaletteColorLookupTableDescriptor:e.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:e.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:e.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:e.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:e.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:e.bluePaletteColorLookupTableData,pixelData:void 0,imageId:t}}function sJ(t,e){const n=t.get("modalityLutModule",e)||{},r=t.get("generalSeriesModule",e)||{},{modality:i}=r,a={rescaleSlope:n.rescaleSlope,rescaleIntercept:n.rescaleIntercept,modality:i},o=t.get("scalingModule",e)||{};return{...a,...i==="PT"&&{suvbw:o.suvbw},...i==="RTDOSE"&&{doseGridScaling:o.DoseGridScaling,doseSummation:o.DoseSummation,doseType:o.DoseType,doseUnit:o.DoseUnit}}}function P_(t){return t==="RGB"||t==="PALETTE COLOR"||t==="YBR_FULL"||t==="YBR_FULL_422"||t==="YBR_PARTIAL_422"||t==="YBR_PARTIAL_420"||t==="YBR_RCT"||t==="YBR_ICT"}function cJ(t,e){const n=t.length/4;let r=0,i=0;for(let a=0;a<n;a++)e[i++]=t[r++],e[i++]=t[r++],e[i++]=t[r++],r++;return e}function lJ(t){return t!=="1.2.840.10008.5.1.4.1.1.12.1"&&t!=="1.2.840.10008.5.1.4.1.1.12.2.1"}function Y8(t,e){let n;return Number.isInteger(t)&&Number.isInteger(e)&&(t>=0?e<=255?n=Uint8Array:e<=65535?n=Uint16Array:e<=4294967295&&(n=Uint32Array):t>=-128&&e<=127?n=Int8Array:t>=-32768&&e<=32767&&(n=Int16Array)),n||Float32Array}function uJ(t,e,n){return Y8(t,e)===n}function fJ(t){const e=t.smallestPixelValue,n=t.largestPixelValue,r=Y8(e,n);if(r){const i=new r(t.pixelData);t.pixelData=i}else throw new Error("Could not apply a typed array to the pixel data")}let cS="";function X8(t,e,n,r={}){const i=r.useRGBA;if(r.preScale={enabled:r.preScale&&r.preScale.enabled!==void 0?r.preScale.enabled:!0},!e?.length)return Promise.reject(new Error("The pixel data is missing"));const{MetadataModules:a}=zs,o=document.createElement("canvas"),s=oJ(t);if(s.decodeLevel=r.decodeLevel,r.allowFloatRendering=wv(),r.preScale.enabled){const g=sJ(hK,t);g&&(r.preScale={...r.preScale,scalingParameters:g})}const{decodeConfig:c}=Up();Object.keys(s).forEach(g=>{(typeof s[g]=="function"||s[g]instanceof Promise)&&delete s[g]});const u=aJ(s,n,e,o,r,c),d=P_(s.photometricInterpretation);return new Promise((g,h)=>{u.then(function(m){let y=!1;if(r.targetBuffer&&r.targetBuffer.type&&!d){const{arrayBuffer:j,type:F,offset:$=0,length:z}=r.targetBuffer,oe=m.pixelDataLength,Q=$,le=z??oe-Q,X={Uint8Array,Uint16Array,Int16Array,Float32Array,Uint32Array};if(le!==m.pixelDataLength)throw new Error(`target array for image does not have the same length (${le}) as the decoded image length (${m.pixelDataLength}).`);const ie=X[F],ye=j?new ie(j,Q,le):new ie(m.pixelData);if(le!==m.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");m.pixelData=ye,y=!0}y||fJ(m);const v=it(a.IMAGE_PLANE,t)||{},C=it(a.VOI_LUT,t)||{},S=it(a.MODALITY_LUT,t)||{},w=it(a.SOP_COMMON,t)||{},x=it(a.CALIBRATION,t)||{},{rows:R,columns:O}=m;if(d){if(tJ(m)){o.height=m.rows,o.width=m.columns;let $=o.getContext("2d").createImageData(m.columns,m.rows);i||($={...$,data:new Uint8ClampedArray(3*m.columns*m.rows)}),eJ(m,$.data,i),m.imageData=$,m.pixelData=$.data,m.pixelDataLength=$.data.length}else if(!i&&m.pixelDataLength===4*R*O){const F=new Uint8Array(m.pixelData.length/4*3);m.pixelData=cJ(m.pixelData,F),m.pixelDataLength=m.pixelData.length}const j=K8(m.pixelData);m.smallestPixelValue=j.min,m.largestPixelValue=j.max}let b=m.samplesPerPixel;m.photometricInterpretation==="PALETTE COLOR"&&(b=i?4:3);const I=Fn.createImageVoxelManager({scalarData:m.pixelData,width:m.columns,height:m.rows,numberOfComponents:b}),G={imageId:t,dataType:m.pixelData.constructor.name,color:d,calibration:x,columnPixelSpacing:v.columnPixelSpacing,columns:m.columns,height:m.rows,preScale:m.preScale,intercept:S.rescaleIntercept?S.rescaleIntercept:0,slope:S.rescaleSlope?S.rescaleSlope:1,invert:m.photometricInterpretation==="MONOCHROME1",minPixelValue:m.smallestPixelValue,maxPixelValue:m.largestPixelValue,rowPixelSpacing:v.rowPixelSpacing,rows:m.rows,sizeInBytes:m.pixelData.byteLength,width:m.columns,windowCenter:C.windowCenter?C.windowCenter[0]:void 0,windowWidth:C.windowWidth?C.windowWidth[0]:void 0,voiLUTFunction:C.voiLUTFunction?C.voiLUTFunction:void 0,decodeTimeInMS:m.decodeTimeInMS,floatPixelData:void 0,imageFrame:m,voxelManager:I,rgba:d&&i,getPixelData:()=>m.pixelData,getCanvas:void 0,numberOfComponents:b};if(G.color&&(G.getCanvas=function(){if(cS===t)return o;const j=G.columns,F=G.rows;o.height=F,o.width=j;const $=o.getContext("2d"),z=$.createImageData(j,F),oe=m.pixelData;if(oe.length===j*F*4)for(let Q=0;Q<oe.length;Q++)z.data[Q]=oe[Q];else if(oe.length===j*F*3){let Q=0;for(let le=0;le<oe.length;le+=3)z.data[Q++]=oe[le],z.data[Q++]=oe[le+1],z.data[Q++]=oe[le+2],z.data[Q++]=255}return m.pixelData=z.data,m.pixelDataLength=z.data.length,m.imageData=z,$.putImageData(m.imageData,0,0),cS=t,o}),S.modalityLUTSequence&&S.modalityLUTSequence.length>0&&lJ(w.sopClassUID)&&(G.modalityLUT=S.modalityLUTSequence[0]),C.voiLUTSequence&&C.voiLUTSequence.length>0&&(G.voiLUT=C.voiLUTSequence[0]),G.color&&(G.windowWidth=256,G.windowCenter=128),G.windowCenter===void 0||G.windowWidth===void 0){const j=yp(G.imageFrame.smallestPixelValue,G.imageFrame.largestPixelValue);G.windowWidth=j.windowWidth,G.windowCenter=j.windowCenter}g(G)},h)})}const{ImageQualityStatus:U_}=zs;function gJ(t,e){t.decache=function(){const n=Pp(e);r1.unload(n.url)}}function dJ(t,e,n=0,r,i,a){const o=new Date().getTime(),s={cancelFn:void 0,promise:void 0};return s.promise=new Promise((c,u)=>{t.then(d=>{const g=N_(d,n),h=d.string("x00020010"),m=new Date().getTime(),y=X8(e,g,h,i);gJ(s,e),y.then(v=>{v=v,v.data=d,v.sharedCacheKey=r;const C=new Date().getTime();v.loadTimeInMS=m-o,v.totalTimeInMS=C-o,v.imageQualityStatus=U_.FULL_RESOLUTION,a!==void 0&&a.imageDoneCallback!==void 0&&a.imageDoneCallback(v),c(v)},function(v){u({error:v,dataSet:d})})},function(d){u({error:d})})}),s}function hJ(t,e,n=0,r,i){const a=new Date().getTime();return{promise:new Promise((s,c)=>{const u=new Date().getTime();let d;try{const g=N_(t,n),h=t.string("x00020010");d=X8(e,g,h,i)}catch(g){c({error:g,dataSet:t});return}d.then(g=>{g=g,g.data=t;const h=new Date().getTime();g.loadTimeInMS=u-a,g.totalTimeInMS=h-a,g.imageQualityStatus=U_.FULL_RESOLUTION,s(g)},c)}),cancelFn:void 0}}function pJ(t){if(t==="dicomweb"||t==="wadouri")return W8;if(t==="dicomfile")return QQ}function z3(t,e={}){const n=Pp(t);e=Object.assign({},e),delete e.loader;const r=pJ(n.scheme);if(r1.isLoaded(n.url)){const a=r1.get(n.url,r,t);return hJ(a,t,n.pixelDataFrame,n.url,e)}const i=r1.load(n.url,r,t);return dJ(i,t,n.frame,n.url,e)}function mJ(){i2("dicomweb",z3),i2("wadouri",z3),i2("dicomfile",z3),xf(A_)}function It(t,e,n){return e=e||0,!t||!t.Value||Array.isArray(t.Value)&&t.Value.length<=e?n:t.Value[e]}function fn(t,e){const n=It(t,e);if(n!==void 0)return parseFloat(n)}function la(t,e){if(!t||!t.Value||!Array.isArray(t.Value)||e&&t.Value.length<e)return;const n=[];for(let r=0;r<t.Value.length;r++)n.push(parseFloat(t.Value[r]));return n}function vJ(t){const e=[];for(let n=0;n<=30;n+=2){let r=`x60${n.toString(16)}`;r.length===4&&(r=`x600${n.toString(16)}`);const i=It(t[`${r}3000`]);if(!i)continue;const a=[];for(let o=0;o<i.length;o++)for(let s=0;s<8;s++){const c=t.Value[i.dataOffset+o];a[o*8+s]=c>>s&1}e.push({rows:fn(t[`${r}0010`]),columns:fn(t[`${r}0011`]),type:It(t[`${r}0040`]),x:fn(t[`${r}0050`],1)-1,y:fn(t[`${r}0050`],0)-1,pixelData:a,description:It(t[`${r}0022`]),label:It(t[`${r}1500`]),roiArea:It(t[`${r}1301`]),roiMean:It(t[`${r}1302`]),roiStandardDeviation:It(t[`${r}1303`])})}return{overlays:e}}function Gp(t){const e=t.indexOf(":");return t.substring(e+1)}function Ju(t,e=!0){return t&&t.Value?t.Value[0]&&e?t.Value[0]:t.Value:t}function F_(t,e,n){const r=(e?Object.values(e[0]):[]).map(a=>a.Value?.[0]).filter(a=>a!==void 0&&typeof a=="object"),i=(t?Object.values(t[n-1]):[]).map(a=>a.Value?.[0]).filter(a=>a!==void 0&&typeof a=="object");return{shared:r,perFrame:i}}function k_(t){let{52009230:e,52009229:n,"00280008":r,...i}=t;return e=Ju(e,!1),n=Ju(n,!1),r=Ju(r),{PerFrameFunctionalGroupsSequence:e,SharedFunctionalGroupsSequence:n,NumberOfFrames:r,rest:i}}function yJ(t,e){const{PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:r,NumberOfFrames:i,rest:a}=k_(e);if(n||i>1){const{shared:o,perFrame:s}=F_(n,r,t),c=Object.assign(e,{frameNumber:t});return[...o,...s].forEach(u=>{Object.entries(u).forEach(([d,g])=>{c[d]=g})}),Object.assign(a,{"00280008":i},c)}return e}let q1=[],J2={};function G_(t){const e=t.indexOf("/frames/")+8,n=t.slice(0,e),r=parseInt(t.slice(e),10);return{metadata:q1[`${n}1`],frame:r}}function TJ(t){const e=Gp(t);return G_(e)}function CJ(t){if(t[52009230]!==void 0||t[52009229]!==void 0)return!0;const e=It(t["00280008"]);return e&&e>1}function SJ(t,e){const n=Gp(t);Object.defineProperty(e,"isMultiframe",{value:CJ(e),enumerable:!1}),q1[n]=e}function wJ(t){const e=Gp(t),n=q1[e];if(n&&!n?.isMultiframe)return n;const r=J2[e];if(r)return r;const i=G_(e);if(!i||!i.metadata)return;const{metadata:a,frame:o}=i;if(a){const s=yJ(o,a);return J2[e]=s,s}}function xJ(t){const e=Gp(t);q1[e]=void 0,J2[e]=void 0}function EJ(){q1=[],J2={}}const B_={add:SJ,get:wJ,remove:xJ,purge:EJ};function $_(t){return It(t["00080060"]).includes("NM")}function Z8(t,e){const n=Ju(t["00080008"],!1);if(n)return n[e]}function RJ(t){let e;const n=Z8(t,2);if(n&&Df(n)){const r=Ju(t["00540022"]);r&&(e=la(r["00200037"],6))}return e}function OJ(t){let e;const n=Z8(t,2);if(n&&Df(n)){const r=Ju(t["00540022"]);r&&(e=la(r["00200032"],3))}return e}function lS(t){let e=la(t["00200037"],6);return!e&&$_(t)&&(e=RJ(t)),e}function uS(t){let e=la(t["00200032"],3);return!e&&$_(t)&&(e=OJ(t)),e}function Hi(t,e){const n=la(t[e]);return n?n[0]:null}function DJ(t){return t?.Value?.length?Array.isArray(t.Value)?t.Value:typeof t.Value=="object"?(console.warn("Warning: Value should be an array, but an object was found. Encapsulating the object in an array."),[t.Value]):[]:[]}function fS(t){const e=DJ(t["00186011"]);return!e||!e.length?null:e.map(r=>{const i=Hi(r,"0018602C"),a=Hi(r,"0018602E"),o=Hi(r,"00186024"),s=Hi(r,"00186026"),c=Hi(r,"0018601A"),u=Hi(r,"0018601E"),d=Hi(r,"00186018"),g=Hi(r,"0018601C"),h=Hi(r,"00186020"),m=Hi(r,"00186022"),y=Hi(r,"0018602A"),v=Hi(r,"00186028"),C=Hi(r,"00186012"),S=Hi(r,"00186014"),w=Hi(r,"00186016"),x=Hi(r,"00186030");return{regionLocationMinY0:c,regionLocationMaxY1:u,regionLocationMinX0:d,regionLocationMaxX1:g,referencePixelX0:h,referencePixelY0:m,physicalDeltaX:i,physicalDeltaY:a,physicalUnitsXDirection:o,physicalUnitsYDirection:s,referencePhysicalPixelValueY:y,referencePhysicalPixelValueX:v,regionSpatialFormat:C,regionDataType:S,regionFlags:w,transducerFrequency:x}})}function W_(t,e){const{MetadataModules:n}=zs;if(t===n.MULTIFRAME){const{metadata:i,frame:a}=TJ(e);if(!i)return;const{PerFrameFunctionalGroupsSequence:o,SharedFunctionalGroupsSequence:s,NumberOfFrames:c}=k_(i);if(o||c>1){const{shared:u,perFrame:d}=F_(o,s,a);return{NumberOfFrames:c,PerFrameFunctionalInformation:d,SharedFunctionalInformation:u}}return{NumberOfFrames:c}}const r=B_.get(e);if(r){if(t===n.GENERAL_STUDY)return{studyDescription:It(r["00081030"]),studyDate:Dr.parseDA(It(r["00080020"])),studyTime:Dr.parseTM(It(r["00080030"],0,"")),accessionNumber:It(r["00080050"])};if(t===n.GENERAL_SERIES)return{modality:It(r["00080060"]),seriesInstanceUID:It(r["0020000E"]),seriesDescription:It(r["0008103E"]),seriesNumber:fn(r["00200011"]),studyInstanceUID:It(r["0020000D"]),seriesDate:Dr.parseDA(It(r["00080021"])),seriesTime:Dr.parseTM(It(r["00080031"],0,"")),acquisitionDate:Dr.parseDA(It(r["00080022"])),acquisitionTime:Dr.parseTM(It(r["00080032"],0,""))};if(t===n.GENERAL_IMAGE)return{sopInstanceUID:It(r["00080018"]),instanceNumber:fn(r["00200013"]),lossyImageCompression:It(r["00282110"]),lossyImageCompressionRatio:fn(r["00282112"]),lossyImageCompressionMethod:It(r["00282114"])};if(t===n.PATIENT)return{patientID:It(r["00100020"]),patientName:It(r["00100010"])};if(t===n.PATIENT_STUDY)return{patientAge:fn(r["00101010"]),patientSize:fn(r["00101020"]),patientSex:It(r["00100040"]),patientWeight:fn(r["00101030"])};if(t===n.NM_MULTIFRAME_GEOMETRY){const i=It(r["00080060"]),a=Z8(r,2);return{modality:i,imageType:It(r["00080008"]),imageSubType:a,imageOrientationPatient:lS(r),imagePositionPatient:uS(r),sliceThickness:fn(r["00180050"]),spacingBetweenSlices:fn(r["00180088"]),pixelSpacing:la(r["00280030"],2),numberOfFrames:fn(r["00280008"]),isNMReconstructable:Df(a)&&i.includes("NM")}}if(t===n.IMAGE_PLANE){let i=lS(r),a=uS(r);const o=la(r["00280030"],2);let s=null,c=null,u=null,d=null,g=!1;return o?(c=o[0],s=o[1]):(g=!0,c=1,s=1),i?(u=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])],d=[parseFloat(i[3]),parseFloat(i[4]),parseFloat(i[5])]):(u=[1,0,0],d=[0,1,0],g=!0,i=[...u,...d]),a||(a=[0,0,0],g=!0),{frameOfReferenceUID:It(r["00200052"]),rows:fn(r["00280010"]),columns:fn(r["00280011"]),imageOrientationPatient:i,rowCosines:u,columnCosines:d,imagePositionPatient:a,sliceThickness:fn(r["00180050"]),sliceLocation:fn(r["00201041"]),pixelSpacing:o,rowPixelSpacing:c,columnPixelSpacing:s,usingDefaultValues:g}}if(t===n.ULTRASOUND_ENHANCED_REGION)return fS(r);if(t===n.CALIBRATION&&It(r["00080060"])==="US")return{sequenceOfUltrasoundRegions:fS(r)};if(t===n.IMAGE_URL)return _J(e,r);if(t===n.CINE)return bJ(e,r);if(t===n.IMAGE_PIXEL)return{samplesPerPixel:fn(r["00280002"]),photometricInterpretation:It(r["00280004"]),rows:fn(r["00280010"]),columns:fn(r["00280011"]),bitsAllocated:fn(r["00280100"]),bitsStored:fn(r["00280101"]),highBit:It(r["00280102"]),pixelRepresentation:fn(r["00280103"]),planarConfiguration:fn(r["00280006"]),pixelAspectRatio:It(r["00280034"]),smallestPixelValue:fn(r["00280106"]),largestPixelValue:fn(r["00280107"]),redPaletteColorLookupTableDescriptor:la(r["00281101"]),greenPaletteColorLookupTableDescriptor:la(r["00281102"]),bluePaletteColorLookupTableDescriptor:la(r["00281103"]),redPaletteColorLookupTableData:la(r["00281201"]),greenPaletteColorLookupTableData:la(r["00281202"]),bluePaletteColorLookupTableData:la(r["00281203"])};if(t===n.VOI_LUT)return{windowCenter:la(r["00281050"],1),windowWidth:la(r["00281051"],1),voiLUTFunction:It(r["00281056"])};if(t===n.MODALITY_LUT)return{rescaleIntercept:fn(r["00281052"]),rescaleSlope:fn(r["00281053"]),rescaleType:It(r["00281054"])};if(t===n.SOP_COMMON)return{sopClassUID:It(r["00080016"]),sopInstanceUID:It(r["00080018"])};if(t===n.PET_ISOTOPE){const i=It(r["00540016"]);return i===void 0?void 0:{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:Dr.parseTM(It(i["00181072"],0,"")),radiopharmaceuticalStartDateTime:It(i["00181078"],0,""),radionuclideTotalDose:fn(i["00181074"]),radionuclideHalfLife:fn(i["00181075"])}}}if(t===n.OVERLAY_PLANE)return vJ(r);if(t==="transferSyntax")return z_(e,r);if(t===n.PET_SERIES)return{correctedImage:It(r["00280051"]),units:It(r["00541001"]),decayCorrection:It(r["00541102"])};if(t===n.PET_IMAGE)return{frameReferenceTime:fn(r["00541300"]),actualFrameDuration:fn(r["00181242"])};if(t==="instance")return V_(e,W_,I_)}}function _J(t,e){const{transferSyntaxUID:n}=z_(t,e),r=C_(n),i=t.substring(7),a=i.replace("/frames/","/thumbnail/");let o=i.replace("/frames/","/rendered/");return r&&(o=o.replace("/rendered/1","/rendered")),{isVideo:r,rendered:o,thumbnail:a}}function bJ(t,e){return{cineRate:It(e["00180040"]),numberOfFrames:fn(e["00280008"])}}function z_(t,e){return{transferSyntaxUID:It(e["00020010"])||It(e["00083002"])}}function MJ(t,e,n={},r={}){const i=Up(),{retrieveOptions:a={},streamingData:o}=r,s=o.chunkSize||VJ(e,a,"chunkSize")||65536,c=d=>{if(typeof i.errorInterceptor=="function"){const g=new Error("request failed");i.errorInterceptor(g)}else console.warn("rangeRequest:Caught",d)};return new Promise(async(d,g)=>{const h=Object.assign({},n);Object.keys(h).forEach(function(m){(h[m]===null||h[m]===void 0)&&delete h[m]});try{o.encodedData||(o.chunkSize=s,o.rangesFetched=0);const m=IJ(o,a),{encodedData:y,responseHeaders:v}=await LJ(t,h,m,o),C=v.get("content-type"),{totalBytes:S}=o,w=S===y.byteLength,x=z8(C,y,{isPartial:!0}),R=H8(a,w||x.extractDone);d({...x,imageQualityStatus:R,percentComplete:x.extractDone?100:s*100/S})}catch(m){c(m),console.error(m),g(m)}})}async function LJ(t,e,n,r){n&&(e=Object.assign(e,{Range:`bytes=${n[0]}-${n[1]}`}));let{encodedData:i}=r;if(n[1]&&i?.byteLength>n[1])return r;const a=await fetch(t,{headers:e,signal:void 0}),o=await a.arrayBuffer(),s=new Uint8Array(o),{status:c}=a;let u;i?(u=new Uint8Array(i.length+s.length),u.set(i,0),u.set(s,i.length),r.rangesFetched=1):(u=new Uint8Array(s.length),u.set(s,0),r.rangesFetched++),r.encodedData=i=u,r.responseHeaders=a.headers;const d=a.headers.get("Content-Range");return d?r.totalBytes=Number(d.split("/")[1]):c!==206||!n?r.totalBytes=i?.byteLength:n[1]===""||i?.length<n[1]?r.totalBytes=i.byteLength:r.totalBytes=Number.MAX_SAFE_INTEGER,r}function VJ(t,e,n){const r=e[n];if(typeof r!="function")return r;const i=B_.get(t);return r(i,t)}function IJ(t,e){const{totalBytes:n,encodedData:r,chunkSize:i=65536}=t,{rangeIndex:a=0}=e;return a===-1&&(!n||!r)?[0,""]:a===-1||r?.byteLength>n-i?[r?.byteLength||0,""]:[r?.byteLength||0,i*(a+1)-1]}function AJ(t,e,n="application/octet-stream",r){const{streamingData:i,retrieveOptions:a={}}=r||{},o={Accept:n};let s=a.urlArguments?`${t}${t.indexOf("?")===-1?"?":"&"}${a.urlArguments}`:t;if(a.framesPath&&(s=s.replace("/frames/",a.framesPath)),i?.url!==s&&(r.streamingData={url:s}),a.rangeIndex!==void 0)return MJ(s,e,o,r);if(a.streaming)return CQ(s,e,o,r);const c=W8(s,e,o),{xhr:u}=c;return c.then(function(d){const g=u.getResponseHeader("Content-Type")||"application/octet-stream",h=z8(g,new Uint8Array(d));return h.imageQualityStatus=H8(a,!0),h})}const{ProgressiveIterator:gS}=js,{ImageQualityStatus:dS}=zs,NJ=new Set(["3.2.840.10008.1.2.4.96","1.2.840.10008.1.2.4.202","1.2.840.10008.1.2.4.203"]);function PJ(t){const e="1.2.840.10008.1.2";if(!t)return e;const n=t.split(";"),r={};n.forEach(a=>{const o=a.split("=");if(o.length!==2)return;const s=o[1].trim().replace(/"/g,"");r[o[0].trim()]=s});const i={"image/jpeg":"1.2.840.10008.1.2.4.50","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jls":"1.2.840.10008.1.2.4.80","image/jll":"1.2.840.10008.1.2.4.70","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92","image/jphc":"3.2.840.10008.1.2.4.96","image/jxl":"1.2.840.10008.1.2.4.140"};return r["transfer-syntax"]?r["transfer-syntax"]:t&&!Object.keys(r).length&&i[t]?i[t]:r.type&&i[r.type]?i[r.type]:i[t]?i[t]:e}function UJ(){return j1}const FJ="multipart/related; type=application/octet-stream; transfer-syntax=*";function kJ(t,e={}){const n=UJ(),r=new Date().getTime(),i=new gS("decompress");async function a(d,g,h){i.generate(async m=>{const y=gS.as(AJ(d,g,h,e));let v=10;for await(const C of y){const{pixelData:S,imageQualityStatus:w=dS.FULL_RESOLUTION,percentComplete:x,done:R=!0,extractDone:O=!0}=C,b=PJ(C.contentType);if(!O&&!NJ.has(b))continue;const I=C.decodeLevel??(w===dS.FULL_RESOLUTION?0:GJ(x,e.retrieveOptions?.decodeLevel));if(!(!R&&v<=I))try{const G={...e,decodeLevel:I},j=await X8(g,S,b,G),F=new Date().getTime();j.loadTimeInMS=F-r,j.transferSyntaxUID=b,j.imageQualityStatus=w,m.add(j,R),v=I}catch(G){if(O)throw console.warn("Couldn't decode",G),G}}})}const o=e.requestType||Nt.Interaction,s=e.additionalDetails||{imageId:t},c=e.priority===void 0?5:e.priority,u=t.substring(7);return n.addRequest(a.bind(this,u,t,FJ),o,s,c),{promise:i.getDonePromise(),cancelFn:void 0}}function GJ(t,e=4){const n=t/100-.02;return n>1/4?Math.min(e,0):n>1/16?Math.min(e,1):n>1/64?Math.min(e,2):Math.min(e,3)}function BJ(){i2("wadors",kJ),xf(W_)}function $J(){BJ(),mJ()}const WJ=()=>new Worker(new URL("/dicom-reader/assets/decodeImageFrameWorker-PuxSH-yv.js",import.meta.url),{type:"module"});function zJ(t={}){dQ(t),$J();const e=cx(),n=t?.maxWebWorkers||HJ();e.registerWorker("dicomImageLoader",WJ,{maxWorkerInstances:n})}function HJ(){return typeof navigator<"u"&&navigator.hardwareConcurrency?Math.max(1,Math.floor(navigator.hardwareConcurrency/2)):1}function jJ(t,e){const{rows:n,columns:r,data:i}=t,{rows:a,columns:o,data:s}=e,c=[],u=[],d=[];for(let g=0;g<o;g++){const h=g*(r-1)/(o-1);c[g]=Math.floor(h),u[g]=Math.min(c[g]+1,r-1),d[g]=h-c[g]}for(let g=0;g<a;g++){const h=g*(n-1)/(a-1),m=Math.floor(h)*r,y=Math.min(m+r,(n-1)*r),v=h-Math.floor(h),C=1-v,S=g*o;for(let w=0;w<o;w++){const x=i[m+c[w]],R=i[m+u[w]],O=i[y+c[w]],b=i[y+u[w]],I=1-d[w];s[S+w]=(x*I+R*d[w])*C+(O*I+b*d[w])*v}}return s}function qJ(t,e){const{rows:n,columns:r,pixelData:i,samplesPerPixel:a=1}=t,{rows:o,columns:s,pixelData:c}=e,u=[];for(let d=0;d<s;d++){const g=d*(r-1)/(s-1);u[d]=Math.floor(g)*a}for(let d=0;d<o;d++){const g=d*(n-1)/(o-1),h=Math.floor(g)*r*a,m=d*s;for(let y=0;y<s;y++)for(let v=0;v<a;v++)c[m+y+v]=i[h+u[y]+v]}return c}async function hS(t,e){let n=e.buffer,r=e.byteOffset;const i=e.length;if(t.bitsAllocated===16)r%2&&(n=n.slice(r),r=0),t.pixelRepresentation===0?t.pixelData=new Uint16Array(n,r,i/2):t.pixelData=new Int16Array(n,r,i/2);else if(t.bitsAllocated===8||t.bitsAllocated===1)t.pixelData=e;else if(t.bitsAllocated===32){if(r%2&&(n=n.slice(r),r=0),t.floatPixelData||t.doubleFloatPixelData)throw new Error("Float pixel data is not supported for parsing into ImageFrame");t.pixelRepresentation===0?t.pixelData=new Uint32Array(n,r,i/4):t.pixelRepresentation===1?t.pixelData=new Int32Array(n,r,i/4):t.pixelData=new Float32Array(n,r,i/4)}return t}function KJ(t){return(t&255)<<8|t>>8&255}async function YJ(t,e){if(t.bitsAllocated===16){let n=e.buffer,r=e.byteOffset;const i=e.length;r%2&&(n=n.slice(r),r=0),t.pixelRepresentation===0?t.pixelData=new Uint16Array(n,r,i/2):t.pixelData=new Int16Array(n,r,i/2);for(let a=0;a<t.pixelData.length;a++)t.pixelData[a]=KJ(t.pixelData[a])}else t.bitsAllocated===8&&(t.pixelData=e);return t}async function XJ(t,e){if(t.bitsAllocated===8)return t.planarConfiguration?QJ(t,e):ZJ(t,e);if(t.bitsAllocated===16)return JJ(t,e);throw new Error("unsupported pixel format for RLE")}function ZJ(t,e){const n=e,r=t.rows*t.columns,i=new ArrayBuffer(r*t.samplesPerPixel),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i);let c=0;const u=a.getInt32(0,!0);for(let d=0;d<u;++d){c=d;let g=a.getInt32((d+1)*4,!0),h=a.getInt32((d+2)*4,!0);h===0&&(h=n.length);const m=r*u;for(;g<h;){const y=o[g++];if(y>=0&&y<=127)for(let v=0;v<y+1&&c<m;++v)s[c]=o[g++],c+=t.samplesPerPixel;else if(y<=-1&&y>=-127){const v=o[g++];for(let C=0;C<-y+1&&c<m;++C)s[c]=v,c+=t.samplesPerPixel}}}return t.pixelData=new Uint8Array(i),t}function QJ(t,e){const n=e,r=t.rows*t.columns,i=new ArrayBuffer(r*t.samplesPerPixel),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i);let c=0;const u=a.getInt32(0,!0);for(let d=0;d<u;++d){c=d*r;let g=a.getInt32((d+1)*4,!0),h=a.getInt32((d+2)*4,!0);h===0&&(h=n.length);const m=r*u;for(;g<h;){const y=o[g++];if(y>=0&&y<=127)for(let v=0;v<y+1&&c<m;++v)s[c]=o[g++],c++;else if(y<=-1&&y>=-127){const v=o[g++];for(let C=0;C<-y+1&&c<m;++C)s[c]=v,c++}}}return t.pixelData=new Uint8Array(i),t}function JJ(t,e){const n=e,r=t.rows*t.columns,i=new ArrayBuffer(r*t.samplesPerPixel*2),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i),c=a.getInt32(0,!0);for(let u=0;u<c;++u){let d=0;const g=u===0?1:0;let h=a.getInt32((u+1)*4,!0),m=a.getInt32((u+2)*4,!0);for(m===0&&(m=n.length);h<m;){const y=o[h++];if(y>=0&&y<=127)for(let v=0;v<y+1&&d<r;++v)s[d*2+g]=o[h++],d++;else if(y<=-1&&y>=-127){const v=o[h++];for(let C=0;C<-y+1&&d<r;++C)s[d*2+g]=v,d++}}}return t.pixelRepresentation===0?t.pixelData=new Uint16Array(i):t.pixelData=new Int16Array(i),t}var H3={exports:{}},pS;function eee(){return pS||(pS=1,function(t,e){var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(i){i=i||{};var a=typeof i<"u"?i:{},o,s;a.ready=new Promise(function(_,M){o=_,s=M});var c=Object.assign({},a),u="./this.program",d=(_,M)=>{throw M},g=typeof window=="object",h=typeof importScripts=="function",m=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",y="";function v(_){return a.locateFile?a.locateFile(_,y):y+_}var C,S,w;if(m){var x=As,R=As;h?y=R.dirname(y)+"/":y=__dirname+"/",C=(_,M)=>(_=Z(_)?new URL(_):R.normalize(_),x.readFileSync(_,M?void 0:"utf8")),w=_=>{var M=C(_,!0);return M.buffer||(M=new Uint8Array(M)),M},S=(_,M,A)=>{_=Z(_)?new URL(_):R.normalize(_),x.readFile(_,function(K,te){K?A(K):M(te.buffer)})},process.argv.length>1&&(u=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(_){if(!(_ instanceof xt))throw _}),process.on("unhandledRejection",function(_){throw _}),d=(_,M)=>{throw process.exitCode=_,M},a.inspect=function(){return"[Emscripten Module object]"}}else(g||h)&&(h?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),r&&(y=r),y.indexOf("blob:")!==0?y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):y="",C=_=>{var M=new XMLHttpRequest;return M.open("GET",_,!1),M.send(null),M.responseText},h&&(w=_=>{var M=new XMLHttpRequest;return M.open("GET",_,!1),M.responseType="arraybuffer",M.send(null),new Uint8Array(M.response)}),S=(_,M,A)=>{var K=new XMLHttpRequest;K.open("GET",_,!0),K.responseType="arraybuffer",K.onload=()=>{if(K.status==200||K.status==0&&K.response){M(K.response);return}A()},K.onerror=A,K.send(null)});var O=a.print||console.log.bind(console),b=a.printErr||console.warn.bind(console);Object.assign(a,c),c=null,a.arguments&&a.arguments,a.thisProgram&&(u=a.thisProgram),a.quit&&(d=a.quit);var I;a.wasmBinary&&(I=a.wasmBinary),a.noExitRuntime,typeof WebAssembly!="object"&&Y("no native wasm support detected");var G,j=!1;function F(_,M){_||Y(M)}var $=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function z(_,M,A){for(var K=M+A,te=M;_[te]&&!(te>=K);)++te;if(te-M>16&&_.buffer&&$)return $.decode(_.subarray(M,te));for(var re="";M<te;){var se=_[M++];if(!(se&128)){re+=String.fromCharCode(se);continue}var de=_[M++]&63;if((se&224)==192){re+=String.fromCharCode((se&31)<<6|de);continue}var we=_[M++]&63;if((se&240)==224?se=(se&15)<<12|de<<6|we:se=(se&7)<<18|de<<12|we<<6|_[M++]&63,se<65536)re+=String.fromCharCode(se);else{var Ie=se-65536;re+=String.fromCharCode(55296|Ie>>10,56320|Ie&1023)}}return re}function oe(_,M){return _?z(ge,_,M):""}function Q(_,M,A,K){if(!(K>0))return 0;for(var te=A,re=A+K-1,se=0;se<_.length;++se){var de=_.charCodeAt(se);if(de>=55296&&de<=57343){var we=_.charCodeAt(++se);de=65536+((de&1023)<<10)|we&1023}if(de<=127){if(A>=re)break;M[A++]=de}else if(de<=2047){if(A+1>=re)break;M[A++]=192|de>>6,M[A++]=128|de&63}else if(de<=65535){if(A+2>=re)break;M[A++]=224|de>>12,M[A++]=128|de>>6&63,M[A++]=128|de&63}else{if(A+3>=re)break;M[A++]=240|de>>18,M[A++]=128|de>>12&63,M[A++]=128|de>>6&63,M[A++]=128|de&63}}return M[A]=0,A-te}function le(_,M,A){return Q(_,ge,M,A)}function X(_){for(var M=0,A=0;A<_.length;++A){var K=_.charCodeAt(A);K<=127?M++:K<=2047?M+=2:K>=55296&&K<=57343?(M+=4,++A):M+=3}return M}var ie,ye,ge,W,ae,fe,ue,qe,et;function Ze(_){ie=_,a.HEAP8=ye=new Int8Array(_),a.HEAP16=W=new Int16Array(_),a.HEAP32=fe=new Int32Array(_),a.HEAPU8=ge=new Uint8Array(_),a.HEAPU16=ae=new Uint16Array(_),a.HEAPU32=ue=new Uint32Array(_),a.HEAPF32=qe=new Float32Array(_),a.HEAPF64=et=new Float64Array(_)}a.INITIAL_MEMORY;var yt,tt=[],st=[],Bt=[];function pr(){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)Gn(a.preRun.shift());wn(tt)}function Lr(){wn(st)}function bn(){if(a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;)Nn(a.postRun.shift());wn(Bt)}function Gn(_){tt.unshift(_)}function Mn(_){st.unshift(_)}function Nn(_){Bt.unshift(_)}var un=0,Bn=null;function nr(_){un++,a.monitorRunDependencies&&a.monitorRunDependencies(un)}function Vr(_){if(un--,a.monitorRunDependencies&&a.monitorRunDependencies(un),un==0&&Bn){var M=Bn;Bn=null,M()}}function Y(_){a.onAbort&&a.onAbort(_),_="Aborted("+_+")",b(_),j=!0,_+=". Build with -sASSERTIONS for more info.";var M=new WebAssembly.RuntimeError(_);throw s(M),M}var J="data:application/octet-stream;base64,";function he(_){return _.startsWith(J)}function Z(_){return _.startsWith("file://")}var ve;ve="libjpegturbowasm_decode.wasm",he(ve)||(ve=v(ve));function Pe(_){try{if(_==ve&&I)return new Uint8Array(I);if(w)return w(_);throw"both async and sync fetching of the wasm failed"}catch(M){Y(M)}}function Je(){if(!I&&(g||h)){if(typeof fetch=="function"&&!Z(ve))return fetch(ve,{credentials:"same-origin"}).then(function(_){if(!_.ok)throw"failed to load wasm binary file at '"+ve+"'";return _.arrayBuffer()}).catch(function(){return Pe(ve)});if(S)return new Promise(function(_,M){S(ve,function(A){_(new Uint8Array(A))},M)})}return Promise.resolve().then(function(){return Pe(ve)})}function Ct(){var _={a:Me};function M(se,de){var we=se.exports;a.asm=we,G=a.asm.K,Ze(G.buffer),yt=a.asm.M,Mn(a.asm.L),Vr()}nr();function A(se){M(se.instance)}function K(se){return Je().then(function(de){return WebAssembly.instantiate(de,_)}).then(function(de){return de}).then(se,function(de){b("failed to asynchronously prepare wasm: "+de),Y(de)})}function te(){return!I&&typeof WebAssembly.instantiateStreaming=="function"&&!he(ve)&&!Z(ve)&&!m&&typeof fetch=="function"?fetch(ve,{credentials:"same-origin"}).then(function(se){var de=WebAssembly.instantiateStreaming(se,_);return de.then(A,function(we){return b("wasm streaming compile failed: "+we),b("falling back to ArrayBuffer instantiation"),K(A)})}):K(A)}if(a.instantiateWasm)try{var re=a.instantiateWasm(_,M);return re}catch(se){b("Module.instantiateWasm callback failed with error: "+se),s(se)}return te().catch(s),{}}function xt(_){this.name="ExitStatus",this.message="Program terminated with exit("+_+")",this.status=_}function wn(_){for(;_.length>0;)_.shift()(a)}function sn(_){this.excPtr=_,this.ptr=_-24,this.set_type=function(M){ue[this.ptr+4>>2]=M},this.get_type=function(){return ue[this.ptr+4>>2]},this.set_destructor=function(M){ue[this.ptr+8>>2]=M},this.get_destructor=function(){return ue[this.ptr+8>>2]},this.set_refcount=function(M){fe[this.ptr>>2]=M},this.set_caught=function(M){M=M?1:0,ye[this.ptr+12>>0]=M},this.get_caught=function(){return ye[this.ptr+12>>0]!=0},this.set_rethrown=function(M){M=M?1:0,ye[this.ptr+13>>0]=M},this.get_rethrown=function(){return ye[this.ptr+13>>0]!=0},this.init=function(M,A){this.set_adjusted_ptr(0),this.set_type(M),this.set_destructor(A),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var M=fe[this.ptr>>2];fe[this.ptr>>2]=M+1},this.release_ref=function(){var M=fe[this.ptr>>2];return fe[this.ptr>>2]=M-1,M===1},this.set_adjusted_ptr=function(M){ue[this.ptr+16>>2]=M},this.get_adjusted_ptr=function(){return ue[this.ptr+16>>2]},this.get_exception_ptr=function(){var M=ee(this.get_type());if(M)return ue[this.excPtr>>2];var A=this.get_adjusted_ptr();return A!==0?A:this.excPtr}}function mr(_,M,A){var K=new sn(_);throw K.init(M,A),_}var Ut={};function Yt(_){for(;_.length;){var M=_.pop(),A=_.pop();A(M)}}function Ht(_){return this.fromWireType(fe[_>>2])}var Ee={},ze={},ut={},qt=48,Wr=57;function vr(_){if(_===void 0)return"_unknown";_=_.replace(/[^a-zA-Z0-9_]/g,"$");var M=_.charCodeAt(0);return M>=qt&&M<=Wr?"_"+_:_}function rr(_,M){return _=vr(_),new Function("body","return function "+_+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(M)}function Ir(_,M){var A=rr(M,function(K){this.name=M,this.message=K;var te=new Error(K).stack;te!==void 0&&(this.stack=this.toString()+`
`+te.replace(/^Error(:[^\n]*)?\n/,""))});return A.prototype=Object.create(_.prototype),A.prototype.constructor=A,A.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},A}var Ji=void 0;function yr(_){throw new Ji(_)}function ir(_,M,A){_.forEach(function(de){ut[de]=M});function K(de){var we=A(de);we.length!==_.length&&yr("Mismatched type converter count");for(var Ie=0;Ie<_.length;++Ie)zr(_[Ie],we[Ie])}var te=new Array(M.length),re=[],se=0;M.forEach((de,we)=>{ze.hasOwnProperty(de)?te[we]=ze[de]:(re.push(de),Ee.hasOwnProperty(de)||(Ee[de]=[]),Ee[de].push(()=>{te[we]=ze[de],++se,se===re.length&&K(te)}))}),re.length===0&&K(te)}function Ei(_){var M=Ut[_];delete Ut[_];var A=M.rawConstructor,K=M.rawDestructor,te=M.fields,re=te.map(se=>se.getterReturnType).concat(te.map(se=>se.setterArgumentType));ir([_],re,se=>{var de={};return te.forEach((we,Ie)=>{var Xe=we.fieldName,at=se[Ie],nt=we.getter,Rt=we.getterContext,_t=se[Ie+te.length],Jt=we.setter,On=we.setterContext;de[Xe]={read:Pn=>at.fromWireType(nt(Rt,Pn)),write:(Pn,Ho)=>{var oa=[];Jt(On,Pn,_t.toWireType(oa,Ho)),Yt(oa)}}}),[{name:M.name,fromWireType:function(we){var Ie={};for(var Xe in de)Ie[Xe]=de[Xe].read(we);return K(we),Ie},toWireType:function(we,Ie){for(var Xe in de)if(!(Xe in Ie))throw new TypeError('Missing field:  "'+Xe+'"');var at=A();for(Xe in de)de[Xe].write(at,Ie[Xe]);return we!==null&&we.push(K,at),at},argPackAdvance:8,readValueFromPointer:Ht,destructorFunction:K}]})}function Fi(_,M,A,K,te){}function $n(_){switch(_){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+_)}}function Tr(){for(var _=new Array(256),M=0;M<256;++M)_[M]=String.fromCharCode(M);ot=_}var ot=void 0;function Ot(_){for(var M="",A=_;ge[A];)M+=ot[ge[A++]];return M}var Et=void 0;function Dt(_){throw new Et(_)}function zr(_,M,A={}){if(!("argPackAdvance"in M))throw new TypeError("registerType registeredInstance requires argPackAdvance");var K=M.name;if(_||Dt('type "'+K+'" must have a positive integer typeid pointer'),ze.hasOwnProperty(_)){if(A.ignoreDuplicateRegistrations)return;Dt("Cannot register type '"+K+"' twice")}if(ze[_]=M,delete ut[_],Ee.hasOwnProperty(_)){var te=Ee[_];delete Ee[_],te.forEach(re=>re())}}function Ri(_,M,A,K,te){var re=$n(A);M=Ot(M),zr(_,{name:M,fromWireType:function(se){return!!se},toWireType:function(se,de){return de?K:te},argPackAdvance:8,readValueFromPointer:function(se){var de;if(A===1)de=ye;else if(A===2)de=W;else if(A===4)de=fe;else throw new TypeError("Unknown boolean type size: "+M);return this.fromWireType(de[se>>re])},destructorFunction:null})}function io(_){if(!(this instanceof di)||!(_ instanceof di))return!1;for(var M=this.$$.ptrType.registeredClass,A=this.$$.ptr,K=_.$$.ptrType.registeredClass,te=_.$$.ptr;M.baseClass;)A=M.upcast(A),M=M.baseClass;for(;K.baseClass;)te=K.upcast(te),K=K.baseClass;return M===K&&A===te}function ki(_){return{count:_.count,deleteScheduled:_.deleteScheduled,preservePointerOnDelete:_.preservePointerOnDelete,ptr:_.ptr,ptrType:_.ptrType,smartPtr:_.smartPtr,smartPtrType:_.smartPtrType}}function Oi(_){function M(A){return A.$$.ptrType.registeredClass.name}Dt(M(_)+" instance already deleted")}var gi=!1;function Di(_){}function Rn(_){_.smartPtr?_.smartPtrType.rawDestructor(_.smartPtr):_.ptrType.registeredClass.rawDestructor(_.ptr)}function Ar(_){_.count.value-=1;var M=_.count.value===0;M&&Rn(_)}function vt(_,M,A){if(M===A)return _;if(A.baseClass===void 0)return null;var K=vt(_,M,A.baseClass);return K===null?null:A.downcast(K)}var ar={};function ao(){return Object.keys(qr).length}function or(){var _=[];for(var M in qr)qr.hasOwnProperty(M)&&_.push(qr[M]);return _}var Hr=[];function _i(){for(;Hr.length;){var _=Hr.pop();_.$$.deleteScheduled=!1,_.delete()}}var jr=void 0;function No(_){jr=_,Hr.length&&jr&&jr(_i)}function Ua(){a.getInheritedInstanceCount=ao,a.getLiveInheritedInstances=or,a.flushPendingDeletes=_i,a.setDelayFunction=No}var qr={};function Fa(_,M){for(M===void 0&&Dt("ptr should not be undefined");_.baseClass;)M=_.upcast(M),_=_.baseClass;return M}function Xn(_,M){return M=Fa(_,M),qr[M]}function ma(_,M){(!M.ptrType||!M.ptr)&&yr("makeClassHandle requires ptr and ptrType");var A=!!M.smartPtrType,K=!!M.smartPtr;return A!==K&&yr("Both smartPtrType and smartPtr must be specified"),M.count={value:1},Cr(Object.create(_,{$$:{value:M}}))}function va(_){var M=this.getPointee(_);if(!M)return this.destructor(_),null;var A=Xn(this.registeredClass,M);if(A!==void 0){if(A.$$.count.value===0)return A.$$.ptr=M,A.$$.smartPtr=_,A.clone();var K=A.clone();return this.destructor(_),K}function te(){return this.isSmartPointer?ma(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:M,smartPtrType:this,smartPtr:_}):ma(this.registeredClass.instancePrototype,{ptrType:this,ptr:_})}var re=this.registeredClass.getActualType(M),se=ar[re];if(!se)return te.call(this);var de;this.isConst?de=se.constPointerType:de=se.pointerType;var we=vt(M,this.registeredClass,de.registeredClass);return we===null?te.call(this):this.isSmartPointer?ma(de.registeredClass.instancePrototype,{ptrType:de,ptr:we,smartPtrType:this,smartPtr:_}):ma(de.registeredClass.instancePrototype,{ptrType:de,ptr:we})}function Cr(_){return typeof FinalizationRegistry>"u"?(Cr=M=>M,_):(gi=new FinalizationRegistry(M=>{Ar(M.$$)}),Cr=M=>{var A=M.$$,K=!!A.smartPtr;if(K){var te={$$:A};gi.register(M,te,M)}return M},Di=M=>gi.unregister(M),Cr(_))}function ka(){if(this.$$.ptr||Oi(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var _=Cr(Object.create(Object.getPrototypeOf(this),{$$:{value:ki(this.$$)}}));return _.$$.count.value+=1,_.$$.deleteScheduled=!1,_}function ea(){this.$$.ptr||Oi(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Dt("Object already scheduled for deletion"),Di(this),Ar(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Gi(){return!this.$$.ptr}function Po(){return this.$$.ptr||Oi(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Dt("Object already scheduled for deletion"),Hr.push(this),Hr.length===1&&jr&&jr(_i),this.$$.deleteScheduled=!0,this}function pn(){di.prototype.isAliasOf=io,di.prototype.clone=ka,di.prototype.delete=ea,di.prototype.isDeleted=Gi,di.prototype.deleteLater=Po}function di(){}function oo(_,M,A){if(_[M].overloadTable===void 0){var K=_[M];_[M]=function(){return _[M].overloadTable.hasOwnProperty(arguments.length)||Dt("Function '"+A+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+_[M].overloadTable+")!"),_[M].overloadTable[arguments.length].apply(this,arguments)},_[M].overloadTable=[],_[M].overloadTable[K.argCount]=K}}function ta(_,M,A){a.hasOwnProperty(_)?(Dt("Cannot register public name '"+_+"' twice"),oo(a,_,_),a.hasOwnProperty(A)&&Dt("Cannot register multiple overloads of a function with the same number of arguments ("+A+")!"),a[_].overloadTable[A]=M):a[_]=M}function so(_,M,A,K,te,re,se,de){this.name=_,this.constructor=M,this.instancePrototype=A,this.rawDestructor=K,this.baseClass=te,this.getActualType=re,this.upcast=se,this.downcast=de,this.pureVirtualFunctions=[]}function hi(_,M,A){for(;M!==A;)M.upcast||Dt("Expected null or instance of "+A.name+", got an instance of "+M.name),_=M.upcast(_),M=M.baseClass;return _}function Xs(_,M){if(M===null)return this.isReference&&Dt("null is not a valid "+this.name),0;M.$$||Dt('Cannot pass "'+$i(M)+'" as a '+this.name),M.$$.ptr||Dt("Cannot pass deleted object as a pointer of type "+this.name);var A=M.$$.ptrType.registeredClass,K=hi(M.$$.ptr,A,this.registeredClass);return K}function Kr(_,M){var A;if(M===null)return this.isReference&&Dt("null is not a valid "+this.name),this.isSmartPointer?(A=this.rawConstructor(),_!==null&&_.push(this.rawDestructor,A),A):0;M.$$||Dt('Cannot pass "'+$i(M)+'" as a '+this.name),M.$$.ptr||Dt("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&M.$$.ptrType.isConst&&Dt("Cannot convert argument of type "+(M.$$.smartPtrType?M.$$.smartPtrType.name:M.$$.ptrType.name)+" to parameter type "+this.name);var K=M.$$.ptrType.registeredClass;if(A=hi(M.$$.ptr,K,this.registeredClass),this.isSmartPointer)switch(M.$$.smartPtr===void 0&&Dt("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:M.$$.smartPtrType===this?A=M.$$.smartPtr:Dt("Cannot convert argument of type "+(M.$$.smartPtrType?M.$$.smartPtrType.name:M.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:A=M.$$.smartPtr;break;case 2:if(M.$$.smartPtrType===this)A=M.$$.smartPtr;else{var te=M.clone();A=this.rawShare(A,Mi.toHandle(function(){te.delete()})),_!==null&&_.push(this.rawDestructor,A)}break;default:Dt("Unsupporting sharing policy")}return A}function Uo(_,M){if(M===null)return this.isReference&&Dt("null is not a valid "+this.name),0;M.$$||Dt('Cannot pass "'+$i(M)+'" as a '+this.name),M.$$.ptr||Dt("Cannot pass deleted object as a pointer of type "+this.name),M.$$.ptrType.isConst&&Dt("Cannot convert argument of type "+M.$$.ptrType.name+" to parameter type "+this.name);var A=M.$$.ptrType.registeredClass,K=hi(M.$$.ptr,A,this.registeredClass);return K}function as(_){return this.rawGetPointee&&(_=this.rawGetPointee(_)),_}function ii(_){this.rawDestructor&&this.rawDestructor(_)}function Sr(_){_!==null&&_.delete()}function ai(){wr.prototype.getPointee=as,wr.prototype.destructor=ii,wr.prototype.argPackAdvance=8,wr.prototype.readValueFromPointer=Ht,wr.prototype.deleteObject=Sr,wr.prototype.fromWireType=va}function wr(_,M,A,K,te,re,se,de,we,Ie,Xe){this.name=_,this.registeredClass=M,this.isReference=A,this.isConst=K,this.isSmartPointer=te,this.pointeeType=re,this.sharingPolicy=se,this.rawGetPointee=de,this.rawConstructor=we,this.rawShare=Ie,this.rawDestructor=Xe,!te&&M.baseClass===void 0?K?(this.toWireType=Xs,this.destructorFunction=null):(this.toWireType=Uo,this.destructorFunction=null):this.toWireType=Kr}function na(_,M,A){a.hasOwnProperty(_)||yr("Replacing nonexistant public symbol"),a[_].overloadTable!==void 0&&A!==void 0||(a[_]=M,a[_].argCount=A)}function ya(_,M,A){var K=a["dynCall_"+_];return A&&A.length?K.apply(null,[M].concat(A)):K.call(null,M)}var Ta=[];function Wn(_){var M=Ta[_];return M||(_>=Ta.length&&(Ta.length=_+1),Ta[_]=M=yt.get(_)),M}function co(_,M,A){if(_.includes("j"))return ya(_,M,A);var K=Wn(M).apply(null,A);return K}function oi(_,M){var A=[];return function(){return A.length=0,Object.assign(A,arguments),co(_,M,A)}}function xr(_,M){_=Ot(_);function A(){return _.includes("j")?oi(_,M):Wn(M)}var K=A();return typeof K!="function"&&Dt("unknown function pointer with signature "+_+": "+M),K}var Ca=void 0;function Bi(_){var M=ct(_),A=Ot(M);return Qe(M),A}function Nr(_,M){var A=[],K={};function te(re){if(!K[re]&&!ze[re]){if(ut[re]){ut[re].forEach(te);return}A.push(re),K[re]=!0}}throw M.forEach(te),new Ca(_+": "+A.map(Bi).join([", "]))}function pi(_,M,A,K,te,re,se,de,we,Ie,Xe,at,nt){Xe=Ot(Xe),re=xr(te,re),de&&(de=xr(se,de)),Ie&&(Ie=xr(we,Ie)),nt=xr(at,nt);var Rt=vr(Xe);ta(Rt,function(){Nr("Cannot construct "+Xe+" due to unbound types",[K])}),ir([_,M,A],K?[K]:[],function(_t){_t=_t[0];var Jt,On;K?(Jt=_t.registeredClass,On=Jt.instancePrototype):On=di.prototype;var Pn=rr(Rt,function(){if(Object.getPrototypeOf(this)!==Ho)throw new Et("Use 'new' to construct "+Xe);if(oa.constructor_body===void 0)throw new Et(Xe+" has no accessible constructor");var Lf=oa.constructor_body[arguments.length];if(Lf===void 0)throw new Et("Tried to invoke ctor of "+Xe+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(oa.constructor_body).toString()+") parameters instead!");return Lf.apply(this,arguments)}),Ho=Object.create(On,{constructor:{value:Pn}});Pn.prototype=Ho;var oa=new so(Xe,Pn,Ho,nt,Jt,re,de,Ie),mo=new wr(Xe,oa,!0,!1,!1),Jc=new wr(Xe+"*",oa,!1,!1,!1),Mf=new wr(Xe+" const*",oa,!1,!0,!1);return ar[_]={pointerType:Jc,constPointerType:Mf},na(Rt,Pn),[mo,Jc,Mf]})}function ra(_,M){for(var A=[],K=0;K<_;K++)A.push(ue[M+K*4>>2]);return A}function Fo(_,M){if(!(_ instanceof Function))throw new TypeError("new_ called with constructor type "+typeof _+" which is not a function");var A=rr(_.name||"unknownFunctionName",function(){});A.prototype=_.prototype;var K=new A,te=_.apply(K,M);return te instanceof Object?te:K}function Sa(_,M,A,K,te){var re=M.length;re<2&&Dt("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var se=M[1]!==null&&A!==null,de=!1,we=1;we<M.length;++we)if(M[we]!==null&&M[we].destructorFunction===void 0){de=!0;break}for(var Ie=M[0].name!=="void",Xe="",at="",we=0;we<re-2;++we)Xe+=(we!==0?", ":"")+"arg"+we,at+=(we!==0?", ":"")+"arg"+we+"Wired";var nt="return function "+vr(_)+"("+Xe+`) {
if (arguments.length !== `+(re-2)+`) {
throwBindingError('function `+_+" called with ' + arguments.length + ' arguments, expected "+(re-2)+` args!');
}
`;de&&(nt+=`var destructors = [];
`);var Rt=de?"destructors":"null",_t=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Jt=[Dt,K,te,Yt,M[0],M[1]];se&&(nt+="var thisWired = classParam.toWireType("+Rt+`, this);
`);for(var we=0;we<re-2;++we)nt+="var arg"+we+"Wired = argType"+we+".toWireType("+Rt+", arg"+we+"); // "+M[we+2].name+`
`,_t.push("argType"+we),Jt.push(M[we+2]);if(se&&(at="thisWired"+(at.length>0?", ":"")+at),nt+=(Ie?"var rv = ":"")+"invoker(fn"+(at.length>0?", ":"")+at+`);
`,de)nt+=`runDestructors(destructors);
`;else for(var we=se?1:2;we<M.length;++we){var On=we===1?"thisWired":"arg"+(we-2)+"Wired";M[we].destructorFunction!==null&&(nt+=On+"_dtor("+On+"); // "+M[we].name+`
`,_t.push(On+"_dtor"),Jt.push(M[we].destructorFunction))}Ie&&(nt+=`var ret = retType.fromWireType(rv);
return ret;
`),nt+=`}
`,_t.push(nt);var Pn=Fo(Function,_t).apply(null,Jt);return Pn}function xn(_,M,A,K,te,re){F(M>0);var se=ra(M,A);te=xr(K,te),ir([],[_],function(de){de=de[0];var we="constructor "+de.name;if(de.registeredClass.constructor_body===void 0&&(de.registeredClass.constructor_body=[]),de.registeredClass.constructor_body[M-1]!==void 0)throw new Et("Cannot register multiple constructors with identical number of parameters ("+(M-1)+") for class '"+de.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return de.registeredClass.constructor_body[M-1]=()=>{Nr("Cannot construct "+de.name+" due to unbound types",se)},ir([],se,function(Ie){return Ie.splice(1,0,null),de.registeredClass.constructor_body[M-1]=Sa(we,Ie,null,te,re),[]}),[]})}function bi(_,M,A,K,te,re,se,de){var we=ra(A,K);M=Ot(M),re=xr(te,re),ir([],[_],function(Ie){Ie=Ie[0];var Xe=Ie.name+"."+M;M.startsWith("@@")&&(M=Symbol[M.substring(2)]),de&&Ie.registeredClass.pureVirtualFunctions.push(M);function at(){Nr("Cannot call "+Xe+" due to unbound types",we)}var nt=Ie.registeredClass.instancePrototype,Rt=nt[M];return Rt===void 0||Rt.overloadTable===void 0&&Rt.className!==Ie.name&&Rt.argCount===A-2?(at.argCount=A-2,at.className=Ie.name,nt[M]=at):(oo(nt,M,Xe),nt[M].overloadTable[A-2]=at),ir([],we,function(_t){var Jt=Sa(Xe,_t,Ie,re,se);return nt[M].overloadTable===void 0?(Jt.argCount=A-2,nt[M]=Jt):nt[M].overloadTable[A-2]=Jt,[]}),[]})}var En=[],Zn=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function wa(_){_>4&&--Zn[_].refcount===0&&(Zn[_]=void 0,En.push(_))}function Qn(){for(var _=0,M=5;M<Zn.length;++M)Zn[M]!==void 0&&++_;return _}function ko(){for(var _=5;_<Zn.length;++_)if(Zn[_]!==void 0)return Zn[_];return null}function sr(){a.count_emval_handles=Qn,a.get_first_emval=ko}var Mi={toValue:_=>(_||Dt("Cannot use deleted val. handle = "+_),Zn[_].value),toHandle:_=>{switch(_){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var M=En.length?En.pop():Zn.length;return Zn[M]={refcount:1,value:_},M}}}};function xa(_,M){M=Ot(M),zr(_,{name:M,fromWireType:function(A){var K=Mi.toValue(A);return wa(A),K},toWireType:function(A,K){return Mi.toHandle(K)},argPackAdvance:8,readValueFromPointer:Ht,destructorFunction:null})}function $i(_){if(_===null)return"null";var M=typeof _;return M==="object"||M==="array"||M==="function"?_.toString():""+_}function Yr(_,M){switch(M){case 2:return function(A){return this.fromWireType(qe[A>>2])};case 3:return function(A){return this.fromWireType(et[A>>3])};default:throw new TypeError("Unknown float type: "+_)}}function cr(_,M,A){var K=$n(A);M=Ot(M),zr(_,{name:M,fromWireType:function(te){return te},toWireType:function(te,re){return re},argPackAdvance:8,readValueFromPointer:Yr(M,K),destructorFunction:null})}function ia(_,M,A){switch(M){case 0:return A?function(te){return ye[te]}:function(te){return ge[te]};case 1:return A?function(te){return W[te>>1]}:function(te){return ae[te>>1]};case 2:return A?function(te){return fe[te>>2]}:function(te){return ue[te>>2]};default:throw new TypeError("Unknown integer type: "+_)}}function lo(_,M,A,K,te){M=Ot(M);var re=$n(A),se=at=>at;if(K===0){var de=32-8*A;se=at=>at<<de>>>de}var we=M.includes("unsigned"),Ie=(at,nt)=>{},Xe;we?Xe=function(at,nt){return Ie(nt,this.name),nt>>>0}:Xe=function(at,nt){return Ie(nt,this.name),nt},zr(_,{name:M,fromWireType:se,toWireType:Xe,argPackAdvance:8,readValueFromPointer:ia(M,re,K!==0),destructorFunction:null})}function Ea(_,M,A){var K=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],te=K[M];function re(se){se=se>>2;var de=ue,we=de[se],Ie=de[se+1];return new te(ie,Ie,we)}A=Ot(A),zr(_,{name:A,fromWireType:re,argPackAdvance:8,readValueFromPointer:re},{ignoreDuplicateRegistrations:!0})}function Ga(_,M){M=Ot(M);var A=M==="std::string";zr(_,{name:M,fromWireType:function(K){var te=ue[K>>2],re=K+4,se;if(A)for(var de=re,we=0;we<=te;++we){var Ie=re+we;if(we==te||ge[Ie]==0){var Xe=Ie-de,at=oe(de,Xe);se===void 0?se=at:(se+="\0",se+=at),de=Ie+1}}else{for(var nt=new Array(te),we=0;we<te;++we)nt[we]=String.fromCharCode(ge[re+we]);se=nt.join("")}return Qe(K),se},toWireType:function(K,te){te instanceof ArrayBuffer&&(te=new Uint8Array(te));var re,se=typeof te=="string";se||te instanceof Uint8Array||te instanceof Uint8ClampedArray||te instanceof Int8Array||Dt("Cannot pass non-string to std::string"),A&&se?re=X(te):re=te.length;var de=ke(4+re+1),we=de+4;if(ue[de>>2]=re,A&&se)le(te,we,re+1);else if(se)for(var Ie=0;Ie<re;++Ie){var Xe=te.charCodeAt(Ie);Xe>255&&(Qe(we),Dt("String has UTF-16 code units that do not fit in 8 bits")),ge[we+Ie]=Xe}else for(var Ie=0;Ie<re;++Ie)ge[we+Ie]=te[Ie];return K!==null&&K.push(Qe,de),de},argPackAdvance:8,readValueFromPointer:Ht,destructorFunction:function(K){Qe(K)}})}var uo=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Ba(_,M){for(var A=_,K=A>>1,te=K+M/2;!(K>=te)&&ae[K];)++K;if(A=K<<1,A-_>32&&uo)return uo.decode(ge.subarray(_,A));for(var re="",se=0;!(se>=M/2);++se){var de=W[_+se*2>>1];if(de==0)break;re+=String.fromCharCode(de)}return re}function $a(_,M,A){if(A===void 0&&(A=2147483647),A<2)return 0;A-=2;for(var K=M,te=A<_.length*2?A/2:_.length,re=0;re<te;++re){var se=_.charCodeAt(re);W[M>>1]=se,M+=2}return W[M>>1]=0,M-K}function fo(_){return _.length*2}function os(_,M){for(var A=0,K="";!(A>=M/4);){var te=fe[_+A*4>>2];if(te==0)break;if(++A,te>=65536){var re=te-65536;K+=String.fromCharCode(55296|re>>10,56320|re&1023)}else K+=String.fromCharCode(te)}return K}function Zs(_,M,A){if(A===void 0&&(A=2147483647),A<4)return 0;for(var K=M,te=K+A-4,re=0;re<_.length;++re){var se=_.charCodeAt(re);if(se>=55296&&se<=57343){var de=_.charCodeAt(++re);se=65536+((se&1023)<<10)|de&1023}if(fe[M>>2]=se,M+=4,M+4>te)break}return fe[M>>2]=0,M-K}function Qs(_){for(var M=0,A=0;A<_.length;++A){var K=_.charCodeAt(A);K>=55296&&K<=57343&&++A,M+=4}return M}function Js(_,M,A){A=Ot(A);var K,te,re,se,de;M===2?(K=Ba,te=$a,se=fo,re=()=>ae,de=1):M===4&&(K=os,te=Zs,se=Qs,re=()=>ue,de=2),zr(_,{name:A,fromWireType:function(we){for(var Ie=ue[we>>2],Xe=re(),at,nt=we+4,Rt=0;Rt<=Ie;++Rt){var _t=we+4+Rt*M;if(Rt==Ie||Xe[_t>>de]==0){var Jt=_t-nt,On=K(nt,Jt);at===void 0?at=On:(at+="\0",at+=On),nt=_t+M}}return Qe(we),at},toWireType:function(we,Ie){typeof Ie!="string"&&Dt("Cannot pass non-string to C++ string type "+A);var Xe=se(Ie),at=ke(4+Xe+M);return ue[at>>2]=Xe>>de,te(Ie,at+4,Xe+M),we!==null&&we.push(Qe,at),at},argPackAdvance:8,readValueFromPointer:Ht,destructorFunction:function(we){Qe(we)}})}function Go(_,M,A,K,te,re){Ut[_]={name:Ot(M),rawConstructor:xr(A,K),rawDestructor:xr(te,re),fields:[]}}function ss(_,M,A,K,te,re,se,de,we,Ie){Ut[_].fields.push({fieldName:Ot(M),getterReturnType:A,getter:xr(K,te),getterContext:re,setterArgumentType:se,setter:xr(de,we),setterContext:Ie})}function ec(_,M){M=Ot(M),zr(_,{isVoid:!0,name:M,argPackAdvance:0,fromWireType:function(){},toWireType:function(A,K){}})}function cs(){throw 1/0}var ls={};function tc(_){var M=ls[_];return M===void 0?Ot(_):M}function go(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function us(_){return _===0?Mi.toHandle(go()):(_=tc(_),Mi.toHandle(go()[_]))}function fs(_){_>4&&(Zn[_].refcount+=1)}function Bo(_,M){var A=ze[_];return A===void 0&&Dt(M+" has unknown type "+Bi(_)),A}function nc(_){for(var M="",A=0;A<_;++A)M+=(A!==0?", ":"")+"arg"+A;for(var K=()=>ue,te="return function emval_allocator_"+_+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,A=0;A<_;++A)te+="var argType"+A+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+A+`');
var arg`+A+" = argType"+A+`.readValueFromPointer(args);
args += argType`+A+`['argPackAdvance'];
argTypes += 4;
`;return te+="var obj = new constructor("+M+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",te)(Bo,a,Mi.toHandle,K)}var ho={};function rc(_,M,A,K){_=Mi.toValue(_);var te=ho[M];return te||(te=nc(M),ho[M]=te),te(_,A,K)}function gs(_,M){_=Bo(_,"_emval_take_value");var A=_.readValueFromPointer(M);return Mi.toHandle(A)}function ic(){Y("")}function ds(_,M,A){ge.copyWithin(_,M,M+A)}function ac(){return 2147483648}function oc(_){try{return G.grow(_-ie.byteLength+65535>>>16),Ze(G.buffer),1}catch{}}function $o(_){var M=ge.length;_=_>>>0;var A=ac();if(_>A)return!1;let K=(we,Ie)=>we+(Ie-we%Ie)%Ie;for(var te=1;te<=4;te*=2){var re=M*(1+.2/te);re=Math.min(re,_+100663296);var se=Math.min(A,K(Math.max(_,re),65536)),de=oc(se);if(de)return!0}return!1}var Wo={};function aa(){return u||"./this.program"}function Ra(){if(!Ra.strings){var _=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",M={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:_,_:aa()};for(var A in Wo)Wo[A]===void 0?delete M[A]:M[A]=Wo[A];var K=[];for(var A in M)K.push(A+"="+M[A]);Ra.strings=K}return Ra.strings}function Li(_,M,A){for(var K=0;K<_.length;++K)ye[M++>>0]=_.charCodeAt(K);ye[M>>0]=0}function hs(_,M){var A=0;return Ra().forEach(function(K,te){var re=M+A;ue[_+te*4>>2]=re,Li(K,re),A+=K.length+1}),0}function ps(_,M){var A=Ra();ue[_>>2]=A.length;var K=0;return A.forEach(function(te){K+=te.length+1}),ue[M>>2]=K,0}function Wa(_){d(_,new xt(_))}function Oa(_,M){Wa(_)}var po=Oa;function zo(_){return 52}function k(_,M,A,K,te){return 70}var B=[null,[],[]];function ne(_,M){var A=B[_];M===0||M===10?((_===1?O:b)(z(A,0)),A.length=0):A.push(M)}function Se(_,M,A,K){for(var te=0,re=0;re<A;re++){var se=ue[M>>2],de=ue[M+4>>2];M+=8;for(var we=0;we<de;we++)ne(_,ge[se+we]);te+=de}return ue[K>>2]=te,0}function _e(_){var M=a["_"+_];return M}function Ue(_,M){ye.set(_,M)}function Fe(_,M,A,K,te){var re={string:_t=>{var Jt=0;if(_t!=null&&_t!==0){var On=(_t.length<<2)+1;Jt=N(On),le(_t,Jt,On)}return Jt},array:_t=>{var Jt=N(_t.length);return Ue(_t,Jt),Jt}};function se(_t){return M==="string"?oe(_t):M==="boolean"?!!_t:_t}var de=_e(_),we=[],Ie=0;if(K)for(var Xe=0;Xe<K.length;Xe++){var at=re[A[Xe]];at?(Ie===0&&(Ie=St()),we[Xe]=at(K[Xe])):we[Xe]=K[Xe]}var nt=de.apply(null,we);function Rt(_t){return Ie!==0&&P(Ie),se(_t)}return nt=Rt(nt),nt}Ji=a.InternalError=Ir(Error,"InternalError"),Tr(),Et=a.BindingError=Ir(Error,"BindingError"),pn(),Ua(),ai(),Ca=a.UnboundTypeError=Ir(Error,"UnboundTypeError"),sr();var Me={g:mr,A:Ei,w:Fi,F:Ri,u:pi,t:xn,c:bi,E:xa,m:cr,b:lo,a:Ea,l:Ga,h:Js,J:Go,d:ss,G:ec,x:cs,i:wa,r:us,p:fs,q:rc,s:gs,j:ic,D:ds,y:$o,z:hs,B:ps,I:po,C:zo,v:k,k:Se,o:Oe,n:Ve,H:Ne,f:pe,e:Be};Ct(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.L).apply(null,arguments)};var ke=a._malloc=function(){return(ke=a._malloc=a.asm.N).apply(null,arguments)},Qe=a._free=function(){return(Qe=a._free=a.asm.O).apply(null,arguments)},ct=a.___getTypeName=function(){return(ct=a.___getTypeName=a.asm.P).apply(null,arguments)};a.__embind_initialize_bindings=function(){return(a.__embind_initialize_bindings=a.asm.Q).apply(null,arguments)};var dt=a._setThrew=function(){return(dt=a._setThrew=a.asm.R).apply(null,arguments)},St=a.stackSave=function(){return(St=a.stackSave=a.asm.S).apply(null,arguments)},P=a.stackRestore=function(){return(P=a.stackRestore=a.asm.T).apply(null,arguments)},N=a.stackAlloc=function(){return(N=a.stackAlloc=a.asm.U).apply(null,arguments)},ee=a.___cxa_is_pointer_type=function(){return(ee=a.___cxa_is_pointer_type=a.asm.V).apply(null,arguments)};a.dynCall_jiji=function(){return(a.dynCall_jiji=a.asm.W).apply(null,arguments)};function pe(_,M){var A=St();try{Wn(_)(M)}catch(K){if(P(A),K!==K+0)throw K;dt(1,0)}}function Oe(_,M){var A=St();try{return Wn(_)(M)}catch(K){if(P(A),K!==K+0)throw K;dt(1,0)}}function Be(_,M,A,K){var te=St();try{Wn(_)(M,A,K)}catch(re){if(P(te),re!==re+0)throw re;dt(1,0)}}function Ne(_,M,A,K){var te=St();try{return Wn(_)(M,A,K)}catch(re){if(P(te),re!==re+0)throw re;dt(1,0)}}function Ve(_,M,A){var K=St();try{return Wn(_)(M,A)}catch(te){if(P(K),te!==te+0)throw te;dt(1,0)}}a.ccall=Fe;var L;Bn=function _(){L||V(),L||(Bn=_)};function V(_){if(un>0||(pr(),un>0))return;function M(){L||(L=!0,a.calledRun=!0,!j&&(Lr(),o(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),bn()))}a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),M()},1)):M()}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return V(),i.ready}})();t.exports=n}(H3)),H3.exports}var tee=eee();const nee=$s(tee),ree=new URL("/dicom-reader/assets/libjpegturbowasm_decode-daqMmuVl.wasm",import.meta.url),u2={codec:void 0,decoder:void 0};function iee(){if(u2.codec)return Promise.resolve();const t=nee({locateFile:e=>e.endsWith(".wasm")?ree.toString():e});return new Promise((e,n)=>{t.then(r=>{u2.codec=r,u2.decoder=new r.JPEGDecoder,e()},n)})}async function aee(t,e){await iee();const n=u2.decoder;n.getEncodedBuffer(t.length).set(t),n.decode();const i=n.getFrameInfo(),a=n.getDecodedBuffer(),o={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:e.signed,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},s=oee(i,a),c={frameInfo:i};return{...e,pixelData:s,imageInfo:o,encodeOptions:c,...c,...o}}function oee(t,e){return t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}const see="modulepreload",cee=function(t){return"/dicom-reader/"+t},mS={},H_=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let c=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),s=o?.nonce||o?.getAttribute("nonce");i=c(n.map(u=>{if(u=cee(u),u in mS)return;mS[u]=!0;const d=u.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${g}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":see,d||(h.as="script"),h.crossOrigin="",h.href=u,s&&h.setAttribute("nonce",s),document.head.appendChild(h),d)return new Promise((m,y)=>{h.addEventListener("load",m),h.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${u}`)))})}))}function a(o){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=o,window.dispatchEvent(s),!s.defaultPrevented)throw o}return i.then(o=>{for(const s of o||[])s.status==="rejected"&&a(s.reason);return e().catch(a)})},i1={JpegImage:void 0,decodeConfig:{}};function lee(t){return i1.decodeConfig=t,i1.JpegImage?Promise.resolve():new Promise((e,n)=>{H_(()=>import("./jpeg-B-x1txLf.js"),[]).then(r=>{i1.JpegImage=r.default,e()}).catch(n)})}async function uee(t,e){if(await lee(),typeof i1.JpegImage>"u")throw new Error("No JPEG Baseline decoder loaded");const n=new i1.JpegImage;if(n.parse(e),n.colorTransform=!1,t.bitsAllocated===8)return t.pixelData=n.getData(t.columns,t.rows),t;if(t.bitsAllocated===16)return t.pixelData=n.getData16(t.columns,t.rows),t}const a1={jpeg:void 0,decodeConfig:{}};function fee(t){return a1.decodeConfig=t,a1.jpeg?Promise.resolve():new Promise((e,n)=>{H_(async()=>{const{Decoder:r}=await import("./lossless-B7-WQiXn.js");return{Decoder:r}},[]).then(({Decoder:r})=>{const i=new r;a1.jpeg=i,e()},n)})}async function vS(t,e){if(await fee(),typeof a1.jpeg>"u")throw new Error("No JPEG Lossless decoder loaded");const n=t.bitsAllocated<=8?1:2,r=e.buffer,i=a1.jpeg.decode(r,e.byteOffset,e.length,n);return t.pixelRepresentation===0?t.bitsAllocated===16?(t.pixelData=new Uint16Array(i.buffer),t):(t.pixelData=new Uint8Array(i.buffer),t):(t.pixelData=new Int16Array(i.buffer),t)}var j3={exports:{}},yS;function gee(){return yS||(yS=1,function(t,e){var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(i){i=i||{};var a=typeof i<"u"?i:{},o,s;a.ready=new Promise(function(k,B){o=k,s=B});var c=Object.assign({},a),u=typeof window=="object",d=typeof importScripts=="function",g=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",h="";function m(k){return a.locateFile?a.locateFile(k,h):h+k}var y,v,C;if(g){var S=As,w=As;d?h=w.dirname(h)+"/":h=__dirname+"/",y=(k,B)=>(k=Y(k)?new URL(k):w.normalize(k),S.readFileSync(k,B?void 0:"utf8")),C=k=>{var B=y(k,!0);return B.buffer||(B=new Uint8Array(B)),B},v=(k,B,ne)=>{k=Y(k)?new URL(k):w.normalize(k),S.readFile(k,function(Se,_e){Se?ne(Se):B(_e.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(k){if(!(k instanceof Pe))throw k}),process.on("unhandledRejection",function(k){throw k}),a.inspect=function(){return"[Emscripten Module object]"}}else(u||d)&&(d?h=self.location.href:typeof document<"u"&&document.currentScript&&(h=document.currentScript.src),r&&(h=r),h.indexOf("blob:")!==0?h=h.substr(0,h.replace(/[?#].*/,"").lastIndexOf("/")+1):h="",y=k=>{var B=new XMLHttpRequest;return B.open("GET",k,!1),B.send(null),B.responseText},d&&(C=k=>{var B=new XMLHttpRequest;return B.open("GET",k,!1),B.responseType="arraybuffer",B.send(null),new Uint8Array(B.response)}),v=(k,B,ne)=>{var Se=new XMLHttpRequest;Se.open("GET",k,!0),Se.responseType="arraybuffer",Se.onload=()=>{if(Se.status==200||Se.status==0&&Se.response){B(Se.response);return}ne()},Se.onerror=ne,Se.send(null)});a.print||console.log.bind(console);var x=a.printErr||console.warn.bind(console);Object.assign(a,c),c=null,a.arguments&&a.arguments,a.thisProgram&&a.thisProgram,a.quit&&a.quit;var R;a.wasmBinary&&(R=a.wasmBinary),a.noExitRuntime,typeof WebAssembly!="object"&&Bn("no native wasm support detected");var O,b=!1;function I(k,B){k||Bn(B)}var G=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function j(k,B,ne){for(var Se=B+ne,_e=B;k[_e]&&!(_e>=Se);)++_e;if(_e-B>16&&k.buffer&&G)return G.decode(k.subarray(B,_e));for(var Ue="";B<_e;){var Fe=k[B++];if(!(Fe&128)){Ue+=String.fromCharCode(Fe);continue}var Me=k[B++]&63;if((Fe&224)==192){Ue+=String.fromCharCode((Fe&31)<<6|Me);continue}var ke=k[B++]&63;if((Fe&240)==224?Fe=(Fe&15)<<12|Me<<6|ke:Fe=(Fe&7)<<18|Me<<12|ke<<6|k[B++]&63,Fe<65536)Ue+=String.fromCharCode(Fe);else{var Qe=Fe-65536;Ue+=String.fromCharCode(55296|Qe>>10,56320|Qe&1023)}}return Ue}function F(k,B){return k?j(X,k,B):""}function $(k,B,ne,Se){if(!(Se>0))return 0;for(var _e=ne,Ue=ne+Se-1,Fe=0;Fe<k.length;++Fe){var Me=k.charCodeAt(Fe);if(Me>=55296&&Me<=57343){var ke=k.charCodeAt(++Fe);Me=65536+((Me&1023)<<10)|ke&1023}if(Me<=127){if(ne>=Ue)break;B[ne++]=Me}else if(Me<=2047){if(ne+1>=Ue)break;B[ne++]=192|Me>>6,B[ne++]=128|Me&63}else if(Me<=65535){if(ne+2>=Ue)break;B[ne++]=224|Me>>12,B[ne++]=128|Me>>6&63,B[ne++]=128|Me&63}else{if(ne+3>=Ue)break;B[ne++]=240|Me>>18,B[ne++]=128|Me>>12&63,B[ne++]=128|Me>>6&63,B[ne++]=128|Me&63}}return B[ne]=0,ne-_e}function z(k,B,ne){return $(k,X,B,ne)}function oe(k){for(var B=0,ne=0;ne<k.length;++ne){var Se=k.charCodeAt(ne);Se<=127?B++:Se<=2047?B+=2:Se>=55296&&Se<=57343?(B+=4,++ne):B+=3}return B}var Q,le,X,ie,ye,ge,W,ae,fe;function ue(k){Q=k,a.HEAP8=le=new Int8Array(k),a.HEAP16=ie=new Int16Array(k),a.HEAP32=ge=new Int32Array(k),a.HEAPU8=X=new Uint8Array(k),a.HEAPU16=ye=new Uint16Array(k),a.HEAPU32=W=new Uint32Array(k),a.HEAPF32=ae=new Float32Array(k),a.HEAPF64=fe=new Float64Array(k)}a.INITIAL_MEMORY;var qe,et=[],Ze=[],yt=[];function tt(){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)pr(a.preRun.shift());Je(et)}function st(){Je(Ze)}function Bt(){if(a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;)bn(a.postRun.shift());Je(yt)}function pr(k){et.unshift(k)}function Lr(k){Ze.unshift(k)}function bn(k){yt.unshift(k)}var Gn=0,Mn=null;function Nn(k){Gn++,a.monitorRunDependencies&&a.monitorRunDependencies(Gn)}function un(k){if(Gn--,a.monitorRunDependencies&&a.monitorRunDependencies(Gn),Gn==0&&Mn){var B=Mn;Mn=null,B()}}function Bn(k){a.onAbort&&a.onAbort(k),k="Aborted("+k+")",x(k),b=!0,k+=". Build with -sASSERTIONS for more info.";var B=new WebAssembly.RuntimeError(k);throw s(B),B}var nr="data:application/octet-stream;base64,";function Vr(k){return k.startsWith(nr)}function Y(k){return k.startsWith("file://")}var J;J="charlswasm_decode.wasm",Vr(J)||(J=m(J));function he(k){try{if(k==J&&R)return new Uint8Array(R);if(C)return C(k);throw"both async and sync fetching of the wasm failed"}catch(B){Bn(B)}}function Z(){if(!R&&(u||d)){if(typeof fetch=="function"&&!Y(J))return fetch(J,{credentials:"same-origin"}).then(function(k){if(!k.ok)throw"failed to load wasm binary file at '"+J+"'";return k.arrayBuffer()}).catch(function(){return he(J)});if(v)return new Promise(function(k,B){v(J,function(ne){k(new Uint8Array(ne))},B)})}return Promise.resolve().then(function(){return he(J)})}function ve(){var k={a:Wo};function B(Fe,Me){var ke=Fe.exports;a.asm=ke,O=a.asm.z,ue(O.buffer),qe=a.asm.C,Lr(a.asm.A),un()}Nn();function ne(Fe){B(Fe.instance)}function Se(Fe){return Z().then(function(Me){return WebAssembly.instantiate(Me,k)}).then(function(Me){return Me}).then(Fe,function(Me){x("failed to asynchronously prepare wasm: "+Me),Bn(Me)})}function _e(){return!R&&typeof WebAssembly.instantiateStreaming=="function"&&!Vr(J)&&!Y(J)&&!g&&typeof fetch=="function"?fetch(J,{credentials:"same-origin"}).then(function(Fe){var Me=WebAssembly.instantiateStreaming(Fe,k);return Me.then(ne,function(ke){return x("wasm streaming compile failed: "+ke),x("falling back to ArrayBuffer instantiation"),Se(ne)})}):Se(ne)}if(a.instantiateWasm)try{var Ue=a.instantiateWasm(k,B);return Ue}catch(Fe){x("Module.instantiateWasm callback failed with error: "+Fe),s(Fe)}return _e().catch(s),{}}function Pe(k){this.name="ExitStatus",this.message="Program terminated with exit("+k+")",this.status=k}function Je(k){for(;k.length>0;)k.shift()(a)}function Ct(k){this.excPtr=k,this.ptr=k-24,this.set_type=function(B){W[this.ptr+4>>2]=B},this.get_type=function(){return W[this.ptr+4>>2]},this.set_destructor=function(B){W[this.ptr+8>>2]=B},this.get_destructor=function(){return W[this.ptr+8>>2]},this.set_refcount=function(B){ge[this.ptr>>2]=B},this.set_caught=function(B){B=B?1:0,le[this.ptr+12>>0]=B},this.get_caught=function(){return le[this.ptr+12>>0]!=0},this.set_rethrown=function(B){B=B?1:0,le[this.ptr+13>>0]=B},this.get_rethrown=function(){return le[this.ptr+13>>0]!=0},this.init=function(B,ne){this.set_adjusted_ptr(0),this.set_type(B),this.set_destructor(ne),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var B=ge[this.ptr>>2];ge[this.ptr>>2]=B+1},this.release_ref=function(){var B=ge[this.ptr>>2];return ge[this.ptr>>2]=B-1,B===1},this.set_adjusted_ptr=function(B){W[this.ptr+16>>2]=B},this.get_adjusted_ptr=function(){return W[this.ptr+16>>2]},this.get_exception_ptr=function(){var B=Oa(this.get_type());if(B)return W[this.excPtr>>2];var ne=this.get_adjusted_ptr();return ne!==0?ne:this.excPtr}}function xt(k,B,ne){var Se=new Ct(k);throw Se.init(B,ne),k}var wn={};function sn(k){for(;k.length;){var B=k.pop(),ne=k.pop();ne(B)}}function mr(k){return this.fromWireType(ge[k>>2])}var Ut={},Yt={},Ht={},Ee=48,ze=57;function ut(k){if(k===void 0)return"_unknown";k=k.replace(/[^a-zA-Z0-9_]/g,"$");var B=k.charCodeAt(0);return B>=Ee&&B<=ze?"_"+k:k}function qt(k,B){return k=ut(k),new Function("body","return function "+k+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(B)}function Wr(k,B){var ne=qt(B,function(Se){this.name=B,this.message=Se;var _e=new Error(Se).stack;_e!==void 0&&(this.stack=this.toString()+`
`+_e.replace(/^Error(:[^\n]*)?\n/,""))});return ne.prototype=Object.create(k.prototype),ne.prototype.constructor=ne,ne.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},ne}var vr=void 0;function rr(k){throw new vr(k)}function Ir(k,B,ne){k.forEach(function(Me){Ht[Me]=B});function Se(Me){var ke=ne(Me);ke.length!==k.length&&rr("Mismatched type converter count");for(var Qe=0;Qe<k.length;++Qe)Ot(k[Qe],ke[Qe])}var _e=new Array(B.length),Ue=[],Fe=0;B.forEach((Me,ke)=>{Yt.hasOwnProperty(Me)?_e[ke]=Yt[Me]:(Ue.push(Me),Ut.hasOwnProperty(Me)||(Ut[Me]=[]),Ut[Me].push(()=>{_e[ke]=Yt[Me],++Fe,Fe===Ue.length&&Se(_e)}))}),Ue.length===0&&Se(_e)}function Ji(k){var B=wn[k];delete wn[k];var ne=B.rawConstructor,Se=B.rawDestructor,_e=B.fields,Ue=_e.map(Fe=>Fe.getterReturnType).concat(_e.map(Fe=>Fe.setterArgumentType));Ir([k],Ue,Fe=>{var Me={};return _e.forEach((ke,Qe)=>{var ct=ke.fieldName,dt=Fe[Qe],St=ke.getter,P=ke.getterContext,N=Fe[Qe+_e.length],ee=ke.setter,pe=ke.setterContext;Me[ct]={read:Oe=>dt.fromWireType(St(P,Oe)),write:(Oe,Be)=>{var Ne=[];ee(pe,Oe,N.toWireType(Ne,Be)),sn(Ne)}}}),[{name:B.name,fromWireType:function(ke){var Qe={};for(var ct in Me)Qe[ct]=Me[ct].read(ke);return Se(ke),Qe},toWireType:function(ke,Qe){for(var ct in Me)if(!(ct in Qe))throw new TypeError('Missing field:  "'+ct+'"');var dt=ne();for(ct in Me)Me[ct].write(dt,Qe[ct]);return ke!==null&&ke.push(Se,dt),dt},argPackAdvance:8,readValueFromPointer:mr,destructorFunction:Se}]})}function yr(k,B,ne,Se,_e){}function ir(k){switch(k){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+k)}}function Ei(){for(var k=new Array(256),B=0;B<256;++B)k[B]=String.fromCharCode(B);Fi=k}var Fi=void 0;function $n(k){for(var B="",ne=k;X[ne];)B+=Fi[X[ne++]];return B}var Tr=void 0;function ot(k){throw new Tr(k)}function Ot(k,B,ne={}){if(!("argPackAdvance"in B))throw new TypeError("registerType registeredInstance requires argPackAdvance");var Se=B.name;if(k||ot('type "'+Se+'" must have a positive integer typeid pointer'),Yt.hasOwnProperty(k)){if(ne.ignoreDuplicateRegistrations)return;ot("Cannot register type '"+Se+"' twice")}if(Yt[k]=B,delete Ht[k],Ut.hasOwnProperty(k)){var _e=Ut[k];delete Ut[k],_e.forEach(Ue=>Ue())}}function Et(k,B,ne,Se,_e){var Ue=ir(ne);B=$n(B),Ot(k,{name:B,fromWireType:function(Fe){return!!Fe},toWireType:function(Fe,Me){return Me?Se:_e},argPackAdvance:8,readValueFromPointer:function(Fe){var Me;if(ne===1)Me=le;else if(ne===2)Me=ie;else if(ne===4)Me=ge;else throw new TypeError("Unknown boolean type size: "+B);return this.fromWireType(Me[Fe>>Ue])},destructorFunction:null})}function Dt(k){if(!(this instanceof Gi)||!(k instanceof Gi))return!1;for(var B=this.$$.ptrType.registeredClass,ne=this.$$.ptr,Se=k.$$.ptrType.registeredClass,_e=k.$$.ptr;B.baseClass;)ne=B.upcast(ne),B=B.baseClass;for(;Se.baseClass;)_e=Se.upcast(_e),Se=Se.baseClass;return B===Se&&ne===_e}function zr(k){return{count:k.count,deleteScheduled:k.deleteScheduled,preservePointerOnDelete:k.preservePointerOnDelete,ptr:k.ptr,ptrType:k.ptrType,smartPtr:k.smartPtr,smartPtrType:k.smartPtrType}}function Ri(k){function B(ne){return ne.$$.ptrType.registeredClass.name}ot(B(k)+" instance already deleted")}var io=!1;function ki(k){}function Oi(k){k.smartPtr?k.smartPtrType.rawDestructor(k.smartPtr):k.ptrType.registeredClass.rawDestructor(k.ptr)}function gi(k){k.count.value-=1;var B=k.count.value===0;B&&Oi(k)}function Di(k,B,ne){if(B===ne)return k;if(ne.baseClass===void 0)return null;var Se=Di(k,B,ne.baseClass);return Se===null?null:ne.downcast(Se)}var Rn={};function Ar(){return Object.keys(jr).length}function vt(){var k=[];for(var B in jr)jr.hasOwnProperty(B)&&k.push(jr[B]);return k}var ar=[];function ao(){for(;ar.length;){var k=ar.pop();k.$$.deleteScheduled=!1,k.delete()}}var or=void 0;function Hr(k){or=k,ar.length&&or&&or(ao)}function _i(){a.getInheritedInstanceCount=Ar,a.getLiveInheritedInstances=vt,a.flushPendingDeletes=ao,a.setDelayFunction=Hr}var jr={};function No(k,B){for(B===void 0&&ot("ptr should not be undefined");k.baseClass;)B=k.upcast(B),k=k.baseClass;return B}function Ua(k,B){return B=No(k,B),jr[B]}function qr(k,B){(!B.ptrType||!B.ptr)&&rr("makeClassHandle requires ptr and ptrType");var ne=!!B.smartPtrType,Se=!!B.smartPtr;return ne!==Se&&rr("Both smartPtrType and smartPtr must be specified"),B.count={value:1},Xn(Object.create(k,{$$:{value:B}}))}function Fa(k){var B=this.getPointee(k);if(!B)return this.destructor(k),null;var ne=Ua(this.registeredClass,B);if(ne!==void 0){if(ne.$$.count.value===0)return ne.$$.ptr=B,ne.$$.smartPtr=k,ne.clone();var Se=ne.clone();return this.destructor(k),Se}function _e(){return this.isSmartPointer?qr(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:B,smartPtrType:this,smartPtr:k}):qr(this.registeredClass.instancePrototype,{ptrType:this,ptr:k})}var Ue=this.registeredClass.getActualType(B),Fe=Rn[Ue];if(!Fe)return _e.call(this);var Me;this.isConst?Me=Fe.constPointerType:Me=Fe.pointerType;var ke=Di(B,this.registeredClass,Me.registeredClass);return ke===null?_e.call(this):this.isSmartPointer?qr(Me.registeredClass.instancePrototype,{ptrType:Me,ptr:ke,smartPtrType:this,smartPtr:k}):qr(Me.registeredClass.instancePrototype,{ptrType:Me,ptr:ke})}function Xn(k){return typeof FinalizationRegistry>"u"?(Xn=B=>B,k):(io=new FinalizationRegistry(B=>{gi(B.$$)}),Xn=B=>{var ne=B.$$,Se=!!ne.smartPtr;if(Se){var _e={$$:ne};io.register(B,_e,B)}return B},ki=B=>io.unregister(B),Xn(k))}function ma(){if(this.$$.ptr||Ri(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var k=Xn(Object.create(Object.getPrototypeOf(this),{$$:{value:zr(this.$$)}}));return k.$$.count.value+=1,k.$$.deleteScheduled=!1,k}function va(){this.$$.ptr||Ri(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ot("Object already scheduled for deletion"),ki(this),gi(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Cr(){return!this.$$.ptr}function ka(){return this.$$.ptr||Ri(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ot("Object already scheduled for deletion"),ar.push(this),ar.length===1&&or&&or(ao),this.$$.deleteScheduled=!0,this}function ea(){Gi.prototype.isAliasOf=Dt,Gi.prototype.clone=ma,Gi.prototype.delete=va,Gi.prototype.isDeleted=Cr,Gi.prototype.deleteLater=ka}function Gi(){}function Po(k,B,ne){if(k[B].overloadTable===void 0){var Se=k[B];k[B]=function(){return k[B].overloadTable.hasOwnProperty(arguments.length)||ot("Function '"+ne+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+k[B].overloadTable+")!"),k[B].overloadTable[arguments.length].apply(this,arguments)},k[B].overloadTable=[],k[B].overloadTable[Se.argCount]=Se}}function pn(k,B,ne){a.hasOwnProperty(k)?((ne===void 0||a[k].overloadTable!==void 0&&a[k].overloadTable[ne]!==void 0)&&ot("Cannot register public name '"+k+"' twice"),Po(a,k,k),a.hasOwnProperty(ne)&&ot("Cannot register multiple overloads of a function with the same number of arguments ("+ne+")!"),a[k].overloadTable[ne]=B):(a[k]=B,ne!==void 0&&(a[k].numArguments=ne))}function di(k,B,ne,Se,_e,Ue,Fe,Me){this.name=k,this.constructor=B,this.instancePrototype=ne,this.rawDestructor=Se,this.baseClass=_e,this.getActualType=Ue,this.upcast=Fe,this.downcast=Me,this.pureVirtualFunctions=[]}function oo(k,B,ne){for(;B!==ne;)B.upcast||ot("Expected null or instance of "+ne.name+", got an instance of "+B.name),k=B.upcast(k),B=B.baseClass;return k}function ta(k,B){if(B===null)return this.isReference&&ot("null is not a valid "+this.name),0;B.$$||ot('Cannot pass "'+sr(B)+'" as a '+this.name),B.$$.ptr||ot("Cannot pass deleted object as a pointer of type "+this.name);var ne=B.$$.ptrType.registeredClass,Se=oo(B.$$.ptr,ne,this.registeredClass);return Se}function so(k,B){var ne;if(B===null)return this.isReference&&ot("null is not a valid "+this.name),this.isSmartPointer?(ne=this.rawConstructor(),k!==null&&k.push(this.rawDestructor,ne),ne):0;B.$$||ot('Cannot pass "'+sr(B)+'" as a '+this.name),B.$$.ptr||ot("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&B.$$.ptrType.isConst&&ot("Cannot convert argument of type "+(B.$$.smartPtrType?B.$$.smartPtrType.name:B.$$.ptrType.name)+" to parameter type "+this.name);var Se=B.$$.ptrType.registeredClass;if(ne=oo(B.$$.ptr,Se,this.registeredClass),this.isSmartPointer)switch(B.$$.smartPtr===void 0&&ot("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:B.$$.smartPtrType===this?ne=B.$$.smartPtr:ot("Cannot convert argument of type "+(B.$$.smartPtrType?B.$$.smartPtrType.name:B.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:ne=B.$$.smartPtr;break;case 2:if(B.$$.smartPtrType===this)ne=B.$$.smartPtr;else{var _e=B.clone();ne=this.rawShare(ne,Qn.toHandle(function(){_e.delete()})),k!==null&&k.push(this.rawDestructor,ne)}break;default:ot("Unsupporting sharing policy")}return ne}function hi(k,B){if(B===null)return this.isReference&&ot("null is not a valid "+this.name),0;B.$$||ot('Cannot pass "'+sr(B)+'" as a '+this.name),B.$$.ptr||ot("Cannot pass deleted object as a pointer of type "+this.name),B.$$.ptrType.isConst&&ot("Cannot convert argument of type "+B.$$.ptrType.name+" to parameter type "+this.name);var ne=B.$$.ptrType.registeredClass,Se=oo(B.$$.ptr,ne,this.registeredClass);return Se}function Xs(k){return this.rawGetPointee&&(k=this.rawGetPointee(k)),k}function Kr(k){this.rawDestructor&&this.rawDestructor(k)}function Uo(k){k!==null&&k.delete()}function as(){ii.prototype.getPointee=Xs,ii.prototype.destructor=Kr,ii.prototype.argPackAdvance=8,ii.prototype.readValueFromPointer=mr,ii.prototype.deleteObject=Uo,ii.prototype.fromWireType=Fa}function ii(k,B,ne,Se,_e,Ue,Fe,Me,ke,Qe,ct){this.name=k,this.registeredClass=B,this.isReference=ne,this.isConst=Se,this.isSmartPointer=_e,this.pointeeType=Ue,this.sharingPolicy=Fe,this.rawGetPointee=Me,this.rawConstructor=ke,this.rawShare=Qe,this.rawDestructor=ct,!_e&&B.baseClass===void 0?Se?(this.toWireType=ta,this.destructorFunction=null):(this.toWireType=hi,this.destructorFunction=null):this.toWireType=so}function Sr(k,B,ne){a.hasOwnProperty(k)||rr("Replacing nonexistant public symbol"),a[k].overloadTable!==void 0&&ne!==void 0?a[k].overloadTable[ne]=B:(a[k]=B,a[k].argCount=ne)}function ai(k,B,ne){var Se=a["dynCall_"+k];return ne&&ne.length?Se.apply(null,[B].concat(ne)):Se.call(null,B)}var wr=[];function na(k){var B=wr[k];return B||(k>=wr.length&&(wr.length=k+1),wr[k]=B=qe.get(k)),B}function ya(k,B,ne){if(k.includes("j"))return ai(k,B,ne);var Se=na(B).apply(null,ne);return Se}function Ta(k,B){var ne=[];return function(){return ne.length=0,Object.assign(ne,arguments),ya(k,B,ne)}}function Wn(k,B){k=$n(k);function ne(){return k.includes("j")?Ta(k,B):na(B)}var Se=ne();return typeof Se!="function"&&ot("unknown function pointer with signature "+k+": "+B),Se}var co=void 0;function oi(k){var B=Ra(k),ne=$n(B);return Li(B),ne}function xr(k,B){var ne=[],Se={};function _e(Ue){if(!Se[Ue]&&!Yt[Ue]){if(Ht[Ue]){Ht[Ue].forEach(_e);return}ne.push(Ue),Se[Ue]=!0}}throw B.forEach(_e),new co(k+": "+ne.map(oi).join([", "]))}function Ca(k,B,ne,Se,_e,Ue,Fe,Me,ke,Qe,ct,dt,St){ct=$n(ct),Ue=Wn(_e,Ue),Me&&(Me=Wn(Fe,Me)),Qe&&(Qe=Wn(ke,Qe)),St=Wn(dt,St);var P=ut(ct);pn(P,function(){xr("Cannot construct "+ct+" due to unbound types",[Se])}),Ir([k,B,ne],Se?[Se]:[],function(N){N=N[0];var ee,pe;Se?(ee=N.registeredClass,pe=ee.instancePrototype):pe=Gi.prototype;var Oe=qt(P,function(){if(Object.getPrototypeOf(this)!==Be)throw new Tr("Use 'new' to construct "+ct);if(Ne.constructor_body===void 0)throw new Tr(ct+" has no accessible constructor");var _=Ne.constructor_body[arguments.length];if(_===void 0)throw new Tr("Tried to invoke ctor of "+ct+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Ne.constructor_body).toString()+") parameters instead!");return _.apply(this,arguments)}),Be=Object.create(pe,{constructor:{value:Oe}});Oe.prototype=Be;var Ne=new di(ct,Oe,Be,St,ee,Ue,Me,Qe),Ve=new ii(ct,Ne,!0,!1,!1),L=new ii(ct+"*",Ne,!1,!1,!1),V=new ii(ct+" const*",Ne,!1,!0,!1);return Rn[k]={pointerType:L,constPointerType:V},Sr(P,Oe),[Ve,L,V]})}function Bi(k,B){for(var ne=[],Se=0;Se<k;Se++)ne.push(W[B+Se*4>>2]);return ne}function Nr(k,B){if(!(k instanceof Function))throw new TypeError("new_ called with constructor type "+typeof k+" which is not a function");var ne=qt(k.name||"unknownFunctionName",function(){});ne.prototype=k.prototype;var Se=new ne,_e=k.apply(Se,B);return _e instanceof Object?_e:Se}function pi(k,B,ne,Se,_e){var Ue=B.length;Ue<2&&ot("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var Fe=B[1]!==null&&ne!==null,Me=!1,ke=1;ke<B.length;++ke)if(B[ke]!==null&&B[ke].destructorFunction===void 0){Me=!0;break}for(var Qe=B[0].name!=="void",ct="",dt="",ke=0;ke<Ue-2;++ke)ct+=(ke!==0?", ":"")+"arg"+ke,dt+=(ke!==0?", ":"")+"arg"+ke+"Wired";var St="return function "+ut(k)+"("+ct+`) {
if (arguments.length !== `+(Ue-2)+`) {
throwBindingError('function `+k+" called with ' + arguments.length + ' arguments, expected "+(Ue-2)+` args!');
}
`;Me&&(St+=`var destructors = [];
`);var P=Me?"destructors":"null",N=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],ee=[ot,Se,_e,sn,B[0],B[1]];Fe&&(St+="var thisWired = classParam.toWireType("+P+`, this);
`);for(var ke=0;ke<Ue-2;++ke)St+="var arg"+ke+"Wired = argType"+ke+".toWireType("+P+", arg"+ke+"); // "+B[ke+2].name+`
`,N.push("argType"+ke),ee.push(B[ke+2]);if(Fe&&(dt="thisWired"+(dt.length>0?", ":"")+dt),St+=(Qe?"var rv = ":"")+"invoker(fn"+(dt.length>0?", ":"")+dt+`);
`,Me)St+=`runDestructors(destructors);
`;else for(var ke=Fe?1:2;ke<B.length;++ke){var pe=ke===1?"thisWired":"arg"+(ke-2)+"Wired";B[ke].destructorFunction!==null&&(St+=pe+"_dtor("+pe+"); // "+B[ke].name+`
`,N.push(pe+"_dtor"),ee.push(B[ke].destructorFunction))}Qe&&(St+=`var ret = retType.fromWireType(rv);
return ret;
`),St+=`}
`,N.push(St);var Oe=Nr(Function,N).apply(null,ee);return Oe}function ra(k,B,ne,Se,_e,Ue){I(B>0);var Fe=Bi(B,ne);_e=Wn(Se,_e),Ir([],[k],function(Me){Me=Me[0];var ke="constructor "+Me.name;if(Me.registeredClass.constructor_body===void 0&&(Me.registeredClass.constructor_body=[]),Me.registeredClass.constructor_body[B-1]!==void 0)throw new Tr("Cannot register multiple constructors with identical number of parameters ("+(B-1)+") for class '"+Me.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return Me.registeredClass.constructor_body[B-1]=()=>{xr("Cannot construct "+Me.name+" due to unbound types",Fe)},Ir([],Fe,function(Qe){return Qe.splice(1,0,null),Me.registeredClass.constructor_body[B-1]=pi(ke,Qe,null,_e,Ue),[]}),[]})}function Fo(k,B,ne,Se,_e,Ue,Fe,Me){var ke=Bi(ne,Se);B=$n(B),Ue=Wn(_e,Ue),Ir([],[k],function(Qe){Qe=Qe[0];var ct=Qe.name+"."+B;B.startsWith("@@")&&(B=Symbol[B.substring(2)]),Me&&Qe.registeredClass.pureVirtualFunctions.push(B);function dt(){xr("Cannot call "+ct+" due to unbound types",ke)}var St=Qe.registeredClass.instancePrototype,P=St[B];return P===void 0||P.overloadTable===void 0&&P.className!==Qe.name&&P.argCount===ne-2?(dt.argCount=ne-2,dt.className=Qe.name,St[B]=dt):(Po(St,B,ct),St[B].overloadTable[ne-2]=dt),Ir([],ke,function(N){var ee=pi(ct,N,Qe,Ue,Fe);return St[B].overloadTable===void 0?(ee.argCount=ne-2,St[B]=ee):St[B].overloadTable[ne-2]=ee,[]}),[]})}var Sa=[],xn=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function bi(k){k>4&&--xn[k].refcount===0&&(xn[k]=void 0,Sa.push(k))}function En(){for(var k=0,B=5;B<xn.length;++B)xn[B]!==void 0&&++k;return k}function Zn(){for(var k=5;k<xn.length;++k)if(xn[k]!==void 0)return xn[k];return null}function wa(){a.count_emval_handles=En,a.get_first_emval=Zn}var Qn={toValue:k=>(k||ot("Cannot use deleted val. handle = "+k),xn[k].value),toHandle:k=>{switch(k){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var B=Sa.length?Sa.pop():xn.length;return xn[B]={refcount:1,value:k},B}}}};function ko(k,B){B=$n(B),Ot(k,{name:B,fromWireType:function(ne){var Se=Qn.toValue(ne);return bi(ne),Se},toWireType:function(ne,Se){return Qn.toHandle(Se)},argPackAdvance:8,readValueFromPointer:mr,destructorFunction:null})}function sr(k){if(k===null)return"null";var B=typeof k;return B==="object"||B==="array"||B==="function"?k.toString():""+k}function Mi(k,B){switch(B){case 2:return function(ne){return this.fromWireType(ae[ne>>2])};case 3:return function(ne){return this.fromWireType(fe[ne>>3])};default:throw new TypeError("Unknown float type: "+k)}}function xa(k,B,ne){var Se=ir(ne);B=$n(B),Ot(k,{name:B,fromWireType:function(_e){return _e},toWireType:function(_e,Ue){return Ue},argPackAdvance:8,readValueFromPointer:Mi(B,Se),destructorFunction:null})}function $i(k,B,ne,Se,_e,Ue){var Fe=Bi(B,ne);k=$n(k),_e=Wn(Se,_e),pn(k,function(){xr("Cannot call "+k+" due to unbound types",Fe)},B-1),Ir([],Fe,function(Me){var ke=[Me[0],null].concat(Me.slice(1));return Sr(k,pi(k,ke,null,_e,Ue),B-1),[]})}function Yr(k,B,ne){switch(B){case 0:return ne?function(_e){return le[_e]}:function(_e){return X[_e]};case 1:return ne?function(_e){return ie[_e>>1]}:function(_e){return ye[_e>>1]};case 2:return ne?function(_e){return ge[_e>>2]}:function(_e){return W[_e>>2]};default:throw new TypeError("Unknown integer type: "+k)}}function cr(k,B,ne,Se,_e){B=$n(B);var Ue=ir(ne),Fe=dt=>dt;if(Se===0){var Me=32-8*ne;Fe=dt=>dt<<Me>>>Me}var ke=B.includes("unsigned"),Qe=(dt,St)=>{},ct;ke?ct=function(dt,St){return Qe(St,this.name),St>>>0}:ct=function(dt,St){return Qe(St,this.name),St},Ot(k,{name:B,fromWireType:Fe,toWireType:ct,argPackAdvance:8,readValueFromPointer:Yr(B,Ue,Se!==0),destructorFunction:null})}function ia(k,B,ne){var Se=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],_e=Se[B];function Ue(Fe){Fe=Fe>>2;var Me=W,ke=Me[Fe],Qe=Me[Fe+1];return new _e(Q,Qe,ke)}ne=$n(ne),Ot(k,{name:ne,fromWireType:Ue,argPackAdvance:8,readValueFromPointer:Ue},{ignoreDuplicateRegistrations:!0})}function lo(k,B){B=$n(B);var ne=B==="std::string";Ot(k,{name:B,fromWireType:function(Se){var _e=W[Se>>2],Ue=Se+4,Fe;if(ne)for(var Me=Ue,ke=0;ke<=_e;++ke){var Qe=Ue+ke;if(ke==_e||X[Qe]==0){var ct=Qe-Me,dt=F(Me,ct);Fe===void 0?Fe=dt:(Fe+="\0",Fe+=dt),Me=Qe+1}}else{for(var St=new Array(_e),ke=0;ke<_e;++ke)St[ke]=String.fromCharCode(X[Ue+ke]);Fe=St.join("")}return Li(Se),Fe},toWireType:function(Se,_e){_e instanceof ArrayBuffer&&(_e=new Uint8Array(_e));var Ue,Fe=typeof _e=="string";Fe||_e instanceof Uint8Array||_e instanceof Uint8ClampedArray||_e instanceof Int8Array||ot("Cannot pass non-string to std::string"),ne&&Fe?Ue=oe(_e):Ue=_e.length;var Me=aa(4+Ue+1),ke=Me+4;if(W[Me>>2]=Ue,ne&&Fe)z(_e,ke,Ue+1);else if(Fe)for(var Qe=0;Qe<Ue;++Qe){var ct=_e.charCodeAt(Qe);ct>255&&(Li(ke),ot("String has UTF-16 code units that do not fit in 8 bits")),X[ke+Qe]=ct}else for(var Qe=0;Qe<Ue;++Qe)X[ke+Qe]=_e[Qe];return Se!==null&&Se.push(Li,Me),Me},argPackAdvance:8,readValueFromPointer:mr,destructorFunction:function(Se){Li(Se)}})}var Ea=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Ga(k,B){for(var ne=k,Se=ne>>1,_e=Se+B/2;!(Se>=_e)&&ye[Se];)++Se;if(ne=Se<<1,ne-k>32&&Ea)return Ea.decode(X.subarray(k,ne));for(var Ue="",Fe=0;!(Fe>=B/2);++Fe){var Me=ie[k+Fe*2>>1];if(Me==0)break;Ue+=String.fromCharCode(Me)}return Ue}function uo(k,B,ne){if(ne===void 0&&(ne=2147483647),ne<2)return 0;ne-=2;for(var Se=B,_e=ne<k.length*2?ne/2:k.length,Ue=0;Ue<_e;++Ue){var Fe=k.charCodeAt(Ue);ie[B>>1]=Fe,B+=2}return ie[B>>1]=0,B-Se}function Ba(k){return k.length*2}function $a(k,B){for(var ne=0,Se="";!(ne>=B/4);){var _e=ge[k+ne*4>>2];if(_e==0)break;if(++ne,_e>=65536){var Ue=_e-65536;Se+=String.fromCharCode(55296|Ue>>10,56320|Ue&1023)}else Se+=String.fromCharCode(_e)}return Se}function fo(k,B,ne){if(ne===void 0&&(ne=2147483647),ne<4)return 0;for(var Se=B,_e=Se+ne-4,Ue=0;Ue<k.length;++Ue){var Fe=k.charCodeAt(Ue);if(Fe>=55296&&Fe<=57343){var Me=k.charCodeAt(++Ue);Fe=65536+((Fe&1023)<<10)|Me&1023}if(ge[B>>2]=Fe,B+=4,B+4>_e)break}return ge[B>>2]=0,B-Se}function os(k){for(var B=0,ne=0;ne<k.length;++ne){var Se=k.charCodeAt(ne);Se>=55296&&Se<=57343&&++ne,B+=4}return B}function Zs(k,B,ne){ne=$n(ne);var Se,_e,Ue,Fe,Me;B===2?(Se=Ga,_e=uo,Fe=Ba,Ue=()=>ye,Me=1):B===4&&(Se=$a,_e=fo,Fe=os,Ue=()=>W,Me=2),Ot(k,{name:ne,fromWireType:function(ke){for(var Qe=W[ke>>2],ct=Ue(),dt,St=ke+4,P=0;P<=Qe;++P){var N=ke+4+P*B;if(P==Qe||ct[N>>Me]==0){var ee=N-St,pe=Se(St,ee);dt===void 0?dt=pe:(dt+="\0",dt+=pe),St=N+B}}return Li(ke),dt},toWireType:function(ke,Qe){typeof Qe!="string"&&ot("Cannot pass non-string to C++ string type "+ne);var ct=Fe(Qe),dt=aa(4+ct+B);return W[dt>>2]=ct>>Me,_e(Qe,dt+4,ct+B),ke!==null&&ke.push(Li,dt),dt},argPackAdvance:8,readValueFromPointer:mr,destructorFunction:function(ke){Li(ke)}})}function Qs(k,B,ne,Se,_e,Ue){wn[k]={name:$n(B),rawConstructor:Wn(ne,Se),rawDestructor:Wn(_e,Ue),fields:[]}}function Js(k,B,ne,Se,_e,Ue,Fe,Me,ke,Qe){wn[k].fields.push({fieldName:$n(B),getterReturnType:ne,getter:Wn(Se,_e),getterContext:Ue,setterArgumentType:Fe,setter:Wn(Me,ke),setterContext:Qe})}function Go(k,B){B=$n(B),Ot(k,{isVoid:!0,name:B,argPackAdvance:0,fromWireType:function(){},toWireType:function(ne,Se){}})}var ss={};function ec(k){var B=ss[k];return B===void 0?$n(k):B}function cs(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function ls(k){return k===0?Qn.toHandle(cs()):(k=ec(k),Qn.toHandle(cs()[k]))}function tc(k){k>4&&(xn[k].refcount+=1)}function go(k,B){var ne=Yt[k];return ne===void 0&&ot(B+" has unknown type "+oi(k)),ne}function us(k){for(var B="",ne=0;ne<k;++ne)B+=(ne!==0?", ":"")+"arg"+ne;for(var Se=()=>W,_e="return function emval_allocator_"+k+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,ne=0;ne<k;++ne)_e+="var argType"+ne+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+ne+`');
var arg`+ne+" = argType"+ne+`.readValueFromPointer(args);
args += argType`+ne+`['argPackAdvance'];
argTypes += 4;
`;return _e+="var obj = new constructor("+B+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",_e)(go,a,Qn.toHandle,Se)}var fs={};function Bo(k,B,ne,Se){k=Qn.toValue(k);var _e=fs[B];return _e||(_e=us(B),fs[B]=_e),_e(k,ne,Se)}function nc(k,B){k=go(k,"_emval_take_value");var ne=k.readValueFromPointer(B);return Qn.toHandle(ne)}function ho(){Bn("")}function rc(k,B,ne){X.copyWithin(k,B,B+ne)}function gs(){return 2147483648}function ic(k){try{return O.grow(k-Q.byteLength+65535>>>16),ue(O.buffer),1}catch{}}function ds(k){var B=X.length;k=k>>>0;var ne=gs();if(k>ne)return!1;let Se=(ke,Qe)=>ke+(Qe-ke%Qe)%Qe;for(var _e=1;_e<=4;_e*=2){var Ue=B*(1+.2/_e);Ue=Math.min(Ue,k+100663296);var Fe=Math.min(ne,Se(Math.max(k,Ue),65536)),Me=ic(Fe);if(Me)return!0}return!1}function ac(k){var B=a["_"+k];return B}function oc(k,B){le.set(k,B)}function $o(k,B,ne,Se,_e){var Ue={string:N=>{var ee=0;if(N!=null&&N!==0){var pe=(N.length<<2)+1;ee=Wa(pe),z(N,ee,pe)}return ee},array:N=>{var ee=Wa(N.length);return oc(N,ee),ee}};function Fe(N){return B==="string"?F(N):B==="boolean"?!!N:N}var Me=ac(k),ke=[],Qe=0;if(Se)for(var ct=0;ct<Se.length;ct++){var dt=Ue[ne[ct]];dt?(Qe===0&&(Qe=hs()),ke[ct]=dt(Se[ct])):ke[ct]=Se[ct]}var St=Me.apply(null,ke);function P(N){return Qe!==0&&ps(Qe),Fe(N)}return St=P(St),St}vr=a.InternalError=Wr(Error,"InternalError"),Ei(),Tr=a.BindingError=Wr(Error,"BindingError"),ea(),_i(),as(),co=a.UnboundTypeError=Wr(Error,"UnboundTypeError"),wa();var Wo={h:xt,q:Ji,r:yr,w:Et,p:Ca,o:ra,c:Fo,v:ko,k:xa,e:$i,b:cr,a:ia,j:lo,g:Zs,u:Qs,d:Js,x:Go,i:bi,m:ls,l:tc,y:Bo,n:nc,f:ho,t:rc,s:ds};ve(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.A).apply(null,arguments)};var aa=a._malloc=function(){return(aa=a._malloc=a.asm.B).apply(null,arguments)},Ra=a.___getTypeName=function(){return(Ra=a.___getTypeName=a.asm.D).apply(null,arguments)};a.__embind_initialize_bindings=function(){return(a.__embind_initialize_bindings=a.asm.E).apply(null,arguments)};var Li=a._free=function(){return(Li=a._free=a.asm.F).apply(null,arguments)},hs=a.stackSave=function(){return(hs=a.stackSave=a.asm.G).apply(null,arguments)},ps=a.stackRestore=function(){return(ps=a.stackRestore=a.asm.H).apply(null,arguments)},Wa=a.stackAlloc=function(){return(Wa=a.stackAlloc=a.asm.I).apply(null,arguments)},Oa=a.___cxa_is_pointer_type=function(){return(Oa=a.___cxa_is_pointer_type=a.asm.J).apply(null,arguments)};a.ccall=$o;var po;Mn=function k(){po||zo(),po||(Mn=k)};function zo(k){if(Gn>0||(tt(),Gn>0))return;function B(){po||(po=!0,a.calledRun=!0,!b&&(st(),o(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),Bt()))}a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),B()},1)):B()}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return zo(),i.ready}})();t.exports=n}(j3)),j3.exports}var dee=gee();const hee=$s(dee),pee=new URL("/dicom-reader/assets/charlswasm_decode-484ovEoR.wasm",import.meta.url),$u={codec:void 0,decoder:void 0,decodeConfig:{}};function mee(t){return typeof t=="number"?$u.codec.getExceptionMessage(t):t}function vee(t){if($u.decodeConfig=t,$u.codec)return Promise.resolve();const e=hee({locateFile:n=>n.endsWith(".wasm")?pee.toString():n});return new Promise((n,r)=>{e.then(i=>{$u.codec=i,$u.decoder=new i.JpegLSDecoder,n()},r)})}async function TS(t,e){try{await vee();const n=$u.decoder;n.getEncodedBuffer(t.length).set(t),n.decode();const i=n.getFrameInfo(),a=n.getInterleaveMode(),o=n.getNearLossless(),s=n.getDecodedBuffer(),c={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:e.signed,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},u=yee(i,s,e.signed),d={nearLossless:o,interleaveMode:a,frameInfo:i};return{...e,pixelData:u,imageInfo:c,encodeOptions:d,...d,...c}}catch(n){throw mee(n)}}function yee(t,e,n){return t.bitsPerSample>8?n?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):n?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}var q3={exports:{}},CS;function Tee(){return CS||(CS=1,function(t,e){var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(i){i=i||{};var a=typeof i<"u"?i:{},o,s;a.ready=new Promise(function(P,N){o=P,s=N});var c=Object.assign({},a),u="./this.program",d=typeof window=="object",g=typeof importScripts=="function",h=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",m="";function y(P){return a.locateFile?a.locateFile(P,m):m+P}var v,C,S;if(h){var w=As,x=As;g?m=x.dirname(m)+"/":m=__dirname+"/",v=(P,N)=>(P=he(P)?new URL(P):x.normalize(P),w.readFileSync(P,N?void 0:"utf8")),S=P=>{var N=v(P,!0);return N.buffer||(N=new Uint8Array(N)),N},C=(P,N,ee)=>{P=he(P)?new URL(P):x.normalize(P),w.readFile(P,function(pe,Oe){pe?ee(pe):N(Oe.buffer)})},process.argv.length>1&&(u=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(P){if(!(P instanceof Ct))throw P}),process.on("unhandledRejection",function(P){throw P}),a.inspect=function(){return"[Emscripten Module object]"}}else(d||g)&&(g?m=self.location.href:typeof document<"u"&&document.currentScript&&(m=document.currentScript.src),r&&(m=r),m.indexOf("blob:")!==0?m=m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1):m="",v=P=>{var N=new XMLHttpRequest;return N.open("GET",P,!1),N.send(null),N.responseText},g&&(S=P=>{var N=new XMLHttpRequest;return N.open("GET",P,!1),N.responseType="arraybuffer",N.send(null),new Uint8Array(N.response)}),C=(P,N,ee)=>{var pe=new XMLHttpRequest;pe.open("GET",P,!0),pe.responseType="arraybuffer",pe.onload=()=>{if(pe.status==200||pe.status==0&&pe.response){N(pe.response);return}ee()},pe.onerror=ee,pe.send(null)});var R=a.print||console.log.bind(console),O=a.printErr||console.warn.bind(console);Object.assign(a,c),c=null,a.arguments&&a.arguments,a.thisProgram&&(u=a.thisProgram),a.quit&&a.quit;var b;a.wasmBinary&&(b=a.wasmBinary),a.noExitRuntime,typeof WebAssembly!="object"&&Vr("no native wasm support detected");var I,G=!1;function j(P,N){P||Vr(N)}var F=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function $(P,N,ee){for(var pe=N+ee,Oe=N;P[Oe]&&!(Oe>=pe);)++Oe;if(Oe-N>16&&P.buffer&&F)return F.decode(P.subarray(N,Oe));for(var Be="";N<Oe;){var Ne=P[N++];if(!(Ne&128)){Be+=String.fromCharCode(Ne);continue}var Ve=P[N++]&63;if((Ne&224)==192){Be+=String.fromCharCode((Ne&31)<<6|Ve);continue}var L=P[N++]&63;if((Ne&240)==224?Ne=(Ne&15)<<12|Ve<<6|L:Ne=(Ne&7)<<18|Ve<<12|L<<6|P[N++]&63,Ne<65536)Be+=String.fromCharCode(Ne);else{var V=Ne-65536;Be+=String.fromCharCode(55296|V>>10,56320|V&1023)}}return Be}function z(P,N){return P?$(ye,P,N):""}function oe(P,N,ee,pe){if(!(pe>0))return 0;for(var Oe=ee,Be=ee+pe-1,Ne=0;Ne<P.length;++Ne){var Ve=P.charCodeAt(Ne);if(Ve>=55296&&Ve<=57343){var L=P.charCodeAt(++Ne);Ve=65536+((Ve&1023)<<10)|L&1023}if(Ve<=127){if(ee>=Be)break;N[ee++]=Ve}else if(Ve<=2047){if(ee+1>=Be)break;N[ee++]=192|Ve>>6,N[ee++]=128|Ve&63}else if(Ve<=65535){if(ee+2>=Be)break;N[ee++]=224|Ve>>12,N[ee++]=128|Ve>>6&63,N[ee++]=128|Ve&63}else{if(ee+3>=Be)break;N[ee++]=240|Ve>>18,N[ee++]=128|Ve>>12&63,N[ee++]=128|Ve>>6&63,N[ee++]=128|Ve&63}}return N[ee]=0,ee-Oe}function Q(P,N,ee){return oe(P,ye,N,ee)}function le(P){for(var N=0,ee=0;ee<P.length;++ee){var pe=P.charCodeAt(ee);pe<=127?N++:pe<=2047?N+=2:pe>=55296&&pe<=57343?(N+=4,++ee):N+=3}return N}var X,ie,ye,ge,W,ae,fe,ue,qe;function et(P){X=P,a.HEAP8=ie=new Int8Array(P),a.HEAP16=ge=new Int16Array(P),a.HEAP32=ae=new Int32Array(P),a.HEAPU8=ye=new Uint8Array(P),a.HEAPU16=W=new Uint16Array(P),a.HEAPU32=fe=new Uint32Array(P),a.HEAPF32=ue=new Float32Array(P),a.HEAPF64=qe=new Float64Array(P)}a.INITIAL_MEMORY;var Ze,yt=[],tt=[],st=[];function Bt(){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)bn(a.preRun.shift());xt(yt)}function pr(){xt(tt)}function Lr(){if(a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;)Mn(a.postRun.shift());xt(st)}function bn(P){yt.unshift(P)}function Gn(P){tt.unshift(P)}function Mn(P){st.unshift(P)}var Nn=0,un=null;function Bn(P){Nn++,a.monitorRunDependencies&&a.monitorRunDependencies(Nn)}function nr(P){if(Nn--,a.monitorRunDependencies&&a.monitorRunDependencies(Nn),Nn==0&&un){var N=un;un=null,N()}}function Vr(P){a.onAbort&&a.onAbort(P),P="Aborted("+P+")",O(P),G=!0,P+=". Build with -sASSERTIONS for more info.";var N=new WebAssembly.RuntimeError(P);throw s(N),N}var Y="data:application/octet-stream;base64,";function J(P){return P.startsWith(Y)}function he(P){return P.startsWith("file://")}var Z;Z="openjpegwasm_decode.wasm",J(Z)||(Z=y(Z));function ve(P){try{if(P==Z&&b)return new Uint8Array(b);if(S)return S(P);throw"both async and sync fetching of the wasm failed"}catch(N){Vr(N)}}function Pe(){if(!b&&(d||g)){if(typeof fetch=="function"&&!he(Z))return fetch(Z,{credentials:"same-origin"}).then(function(P){if(!P.ok)throw"failed to load wasm binary file at '"+Z+"'";return P.arrayBuffer()}).catch(function(){return ve(Z)});if(C)return new Promise(function(P,N){C(Z,function(ee){P(new Uint8Array(ee))},N)})}return Promise.resolve().then(function(){return ve(Z)})}function Je(){var P={a:Se};function N(Ne,Ve){var L=Ne.exports;a.asm=L,I=a.asm.E,et(I.buffer),Ze=a.asm.G,Gn(a.asm.F),nr()}Bn();function ee(Ne){N(Ne.instance)}function pe(Ne){return Pe().then(function(Ve){return WebAssembly.instantiate(Ve,P)}).then(function(Ve){return Ve}).then(Ne,function(Ve){O("failed to asynchronously prepare wasm: "+Ve),Vr(Ve)})}function Oe(){return!b&&typeof WebAssembly.instantiateStreaming=="function"&&!J(Z)&&!he(Z)&&!h&&typeof fetch=="function"?fetch(Z,{credentials:"same-origin"}).then(function(Ne){var Ve=WebAssembly.instantiateStreaming(Ne,P);return Ve.then(ee,function(L){return O("wasm streaming compile failed: "+L),O("falling back to ArrayBuffer instantiation"),pe(ee)})}):pe(ee)}if(a.instantiateWasm)try{var Be=a.instantiateWasm(P,N);return Be}catch(Ne){O("Module.instantiateWasm callback failed with error: "+Ne),s(Ne)}return Oe().catch(s),{}}function Ct(P){this.name="ExitStatus",this.message="Program terminated with exit("+P+")",this.status=P}function xt(P){for(;P.length>0;)P.shift()(a)}function wn(P){this.excPtr=P,this.ptr=P-24,this.set_type=function(N){fe[this.ptr+4>>2]=N},this.get_type=function(){return fe[this.ptr+4>>2]},this.set_destructor=function(N){fe[this.ptr+8>>2]=N},this.get_destructor=function(){return fe[this.ptr+8>>2]},this.set_refcount=function(N){ae[this.ptr>>2]=N},this.set_caught=function(N){N=N?1:0,ie[this.ptr+12>>0]=N},this.get_caught=function(){return ie[this.ptr+12>>0]!=0},this.set_rethrown=function(N){N=N?1:0,ie[this.ptr+13>>0]=N},this.get_rethrown=function(){return ie[this.ptr+13>>0]!=0},this.init=function(N,ee){this.set_adjusted_ptr(0),this.set_type(N),this.set_destructor(ee),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var N=ae[this.ptr>>2];ae[this.ptr>>2]=N+1},this.release_ref=function(){var N=ae[this.ptr>>2];return ae[this.ptr>>2]=N-1,N===1},this.set_adjusted_ptr=function(N){fe[this.ptr+16>>2]=N},this.get_adjusted_ptr=function(){return fe[this.ptr+16>>2]},this.get_exception_ptr=function(){var N=ct(this.get_type());if(N)return fe[this.excPtr>>2];var ee=this.get_adjusted_ptr();return ee!==0?ee:this.excPtr}}function sn(P,N,ee){var pe=new wn(P);throw pe.init(N,ee),P}var mr={};function Ut(P){for(;P.length;){var N=P.pop(),ee=P.pop();ee(N)}}function Yt(P){return this.fromWireType(ae[P>>2])}var Ht={},Ee={},ze={},ut=48,qt=57;function Wr(P){if(P===void 0)return"_unknown";P=P.replace(/[^a-zA-Z0-9_]/g,"$");var N=P.charCodeAt(0);return N>=ut&&N<=qt?"_"+P:P}function vr(P,N){return P=Wr(P),new Function("body","return function "+P+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(N)}function rr(P,N){var ee=vr(N,function(pe){this.name=N,this.message=pe;var Oe=new Error(pe).stack;Oe!==void 0&&(this.stack=this.toString()+`
`+Oe.replace(/^Error(:[^\n]*)?\n/,""))});return ee.prototype=Object.create(P.prototype),ee.prototype.constructor=ee,ee.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},ee}var Ir=void 0;function Ji(P){throw new Ir(P)}function yr(P,N,ee){P.forEach(function(Ve){ze[Ve]=N});function pe(Ve){var L=ee(Ve);L.length!==P.length&&Ji("Mismatched type converter count");for(var V=0;V<P.length;++V)Dt(P[V],L[V])}var Oe=new Array(N.length),Be=[],Ne=0;N.forEach((Ve,L)=>{Ee.hasOwnProperty(Ve)?Oe[L]=Ee[Ve]:(Be.push(Ve),Ht.hasOwnProperty(Ve)||(Ht[Ve]=[]),Ht[Ve].push(()=>{Oe[L]=Ee[Ve],++Ne,Ne===Be.length&&pe(Oe)}))}),Be.length===0&&pe(Oe)}function ir(P){var N=mr[P];delete mr[P];var ee=N.rawConstructor,pe=N.rawDestructor,Oe=N.fields,Be=Oe.map(Ne=>Ne.getterReturnType).concat(Oe.map(Ne=>Ne.setterArgumentType));yr([P],Be,Ne=>{var Ve={};return Oe.forEach((L,V)=>{var _=L.fieldName,M=Ne[V],A=L.getter,K=L.getterContext,te=Ne[V+Oe.length],re=L.setter,se=L.setterContext;Ve[_]={read:de=>M.fromWireType(A(K,de)),write:(de,we)=>{var Ie=[];re(se,de,te.toWireType(Ie,we)),Ut(Ie)}}}),[{name:N.name,fromWireType:function(L){var V={};for(var _ in Ve)V[_]=Ve[_].read(L);return pe(L),V},toWireType:function(L,V){for(var _ in Ve)if(!(_ in V))throw new TypeError('Missing field:  "'+_+'"');var M=ee();for(_ in Ve)Ve[_].write(M,V[_]);return L!==null&&L.push(pe,M),M},argPackAdvance:8,readValueFromPointer:Yt,destructorFunction:pe}]})}function Ei(P,N,ee,pe,Oe){}function Fi(P){switch(P){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+P)}}function $n(){for(var P=new Array(256),N=0;N<256;++N)P[N]=String.fromCharCode(N);Tr=P}var Tr=void 0;function ot(P){for(var N="",ee=P;ye[ee];)N+=Tr[ye[ee++]];return N}var Ot=void 0;function Et(P){throw new Ot(P)}function Dt(P,N,ee={}){if(!("argPackAdvance"in N))throw new TypeError("registerType registeredInstance requires argPackAdvance");var pe=N.name;if(P||Et('type "'+pe+'" must have a positive integer typeid pointer'),Ee.hasOwnProperty(P)){if(ee.ignoreDuplicateRegistrations)return;Et("Cannot register type '"+pe+"' twice")}if(Ee[P]=N,delete ze[P],Ht.hasOwnProperty(P)){var Oe=Ht[P];delete Ht[P],Oe.forEach(Be=>Be())}}function zr(P,N,ee,pe,Oe){var Be=Fi(ee);N=ot(N),Dt(P,{name:N,fromWireType:function(Ne){return!!Ne},toWireType:function(Ne,Ve){return Ve?pe:Oe},argPackAdvance:8,readValueFromPointer:function(Ne){var Ve;if(ee===1)Ve=ie;else if(ee===2)Ve=ge;else if(ee===4)Ve=ae;else throw new TypeError("Unknown boolean type size: "+N);return this.fromWireType(Ve[Ne>>Be])},destructorFunction:null})}function Ri(P){if(!(this instanceof pn)||!(P instanceof pn))return!1;for(var N=this.$$.ptrType.registeredClass,ee=this.$$.ptr,pe=P.$$.ptrType.registeredClass,Oe=P.$$.ptr;N.baseClass;)ee=N.upcast(ee),N=N.baseClass;for(;pe.baseClass;)Oe=pe.upcast(Oe),pe=pe.baseClass;return N===pe&&ee===Oe}function io(P){return{count:P.count,deleteScheduled:P.deleteScheduled,preservePointerOnDelete:P.preservePointerOnDelete,ptr:P.ptr,ptrType:P.ptrType,smartPtr:P.smartPtr,smartPtrType:P.smartPtrType}}function ki(P){function N(ee){return ee.$$.ptrType.registeredClass.name}Et(N(P)+" instance already deleted")}var Oi=!1;function gi(P){}function Di(P){P.smartPtr?P.smartPtrType.rawDestructor(P.smartPtr):P.ptrType.registeredClass.rawDestructor(P.ptr)}function Rn(P){P.count.value-=1;var N=P.count.value===0;N&&Di(P)}function Ar(P,N,ee){if(N===ee)return P;if(ee.baseClass===void 0)return null;var pe=Ar(P,N,ee.baseClass);return pe===null?null:ee.downcast(pe)}var vt={};function ar(){return Object.keys(Ua).length}function ao(){var P=[];for(var N in Ua)Ua.hasOwnProperty(N)&&P.push(Ua[N]);return P}var or=[];function Hr(){for(;or.length;){var P=or.pop();P.$$.deleteScheduled=!1,P.delete()}}var _i=void 0;function jr(P){_i=P,or.length&&_i&&_i(Hr)}function No(){a.getInheritedInstanceCount=ar,a.getLiveInheritedInstances=ao,a.flushPendingDeletes=Hr,a.setDelayFunction=jr}var Ua={};function qr(P,N){for(N===void 0&&Et("ptr should not be undefined");P.baseClass;)N=P.upcast(N),P=P.baseClass;return N}function Fa(P,N){return N=qr(P,N),Ua[N]}function Xn(P,N){(!N.ptrType||!N.ptr)&&Ji("makeClassHandle requires ptr and ptrType");var ee=!!N.smartPtrType,pe=!!N.smartPtr;return ee!==pe&&Ji("Both smartPtrType and smartPtr must be specified"),N.count={value:1},va(Object.create(P,{$$:{value:N}}))}function ma(P){var N=this.getPointee(P);if(!N)return this.destructor(P),null;var ee=Fa(this.registeredClass,N);if(ee!==void 0){if(ee.$$.count.value===0)return ee.$$.ptr=N,ee.$$.smartPtr=P,ee.clone();var pe=ee.clone();return this.destructor(P),pe}function Oe(){return this.isSmartPointer?Xn(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:N,smartPtrType:this,smartPtr:P}):Xn(this.registeredClass.instancePrototype,{ptrType:this,ptr:P})}var Be=this.registeredClass.getActualType(N),Ne=vt[Be];if(!Ne)return Oe.call(this);var Ve;this.isConst?Ve=Ne.constPointerType:Ve=Ne.pointerType;var L=Ar(N,this.registeredClass,Ve.registeredClass);return L===null?Oe.call(this):this.isSmartPointer?Xn(Ve.registeredClass.instancePrototype,{ptrType:Ve,ptr:L,smartPtrType:this,smartPtr:P}):Xn(Ve.registeredClass.instancePrototype,{ptrType:Ve,ptr:L})}function va(P){return typeof FinalizationRegistry>"u"?(va=N=>N,P):(Oi=new FinalizationRegistry(N=>{Rn(N.$$)}),va=N=>{var ee=N.$$,pe=!!ee.smartPtr;if(pe){var Oe={$$:ee};Oi.register(N,Oe,N)}return N},gi=N=>Oi.unregister(N),va(P))}function Cr(){if(this.$$.ptr||ki(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var P=va(Object.create(Object.getPrototypeOf(this),{$$:{value:io(this.$$)}}));return P.$$.count.value+=1,P.$$.deleteScheduled=!1,P}function ka(){this.$$.ptr||ki(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Et("Object already scheduled for deletion"),gi(this),Rn(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function ea(){return!this.$$.ptr}function Gi(){return this.$$.ptr||ki(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Et("Object already scheduled for deletion"),or.push(this),or.length===1&&_i&&_i(Hr),this.$$.deleteScheduled=!0,this}function Po(){pn.prototype.isAliasOf=Ri,pn.prototype.clone=Cr,pn.prototype.delete=ka,pn.prototype.isDeleted=ea,pn.prototype.deleteLater=Gi}function pn(){}function di(P,N,ee){if(P[N].overloadTable===void 0){var pe=P[N];P[N]=function(){return P[N].overloadTable.hasOwnProperty(arguments.length)||Et("Function '"+ee+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+P[N].overloadTable+")!"),P[N].overloadTable[arguments.length].apply(this,arguments)},P[N].overloadTable=[],P[N].overloadTable[pe.argCount]=pe}}function oo(P,N,ee){a.hasOwnProperty(P)?(Et("Cannot register public name '"+P+"' twice"),di(a,P,P),a.hasOwnProperty(ee)&&Et("Cannot register multiple overloads of a function with the same number of arguments ("+ee+")!"),a[P].overloadTable[ee]=N):a[P]=N}function ta(P,N,ee,pe,Oe,Be,Ne,Ve){this.name=P,this.constructor=N,this.instancePrototype=ee,this.rawDestructor=pe,this.baseClass=Oe,this.getActualType=Be,this.upcast=Ne,this.downcast=Ve,this.pureVirtualFunctions=[]}function so(P,N,ee){for(;N!==ee;)N.upcast||Et("Expected null or instance of "+ee.name+", got an instance of "+N.name),P=N.upcast(P),N=N.baseClass;return P}function hi(P,N){if(N===null)return this.isReference&&Et("null is not a valid "+this.name),0;N.$$||Et('Cannot pass "'+xa(N)+'" as a '+this.name),N.$$.ptr||Et("Cannot pass deleted object as a pointer of type "+this.name);var ee=N.$$.ptrType.registeredClass,pe=so(N.$$.ptr,ee,this.registeredClass);return pe}function Xs(P,N){var ee;if(N===null)return this.isReference&&Et("null is not a valid "+this.name),this.isSmartPointer?(ee=this.rawConstructor(),P!==null&&P.push(this.rawDestructor,ee),ee):0;N.$$||Et('Cannot pass "'+xa(N)+'" as a '+this.name),N.$$.ptr||Et("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&N.$$.ptrType.isConst&&Et("Cannot convert argument of type "+(N.$$.smartPtrType?N.$$.smartPtrType.name:N.$$.ptrType.name)+" to parameter type "+this.name);var pe=N.$$.ptrType.registeredClass;if(ee=so(N.$$.ptr,pe,this.registeredClass),this.isSmartPointer)switch(N.$$.smartPtr===void 0&&Et("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:N.$$.smartPtrType===this?ee=N.$$.smartPtr:Et("Cannot convert argument of type "+(N.$$.smartPtrType?N.$$.smartPtrType.name:N.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:ee=N.$$.smartPtr;break;case 2:if(N.$$.smartPtrType===this)ee=N.$$.smartPtr;else{var Oe=N.clone();ee=this.rawShare(ee,sr.toHandle(function(){Oe.delete()})),P!==null&&P.push(this.rawDestructor,ee)}break;default:Et("Unsupporting sharing policy")}return ee}function Kr(P,N){if(N===null)return this.isReference&&Et("null is not a valid "+this.name),0;N.$$||Et('Cannot pass "'+xa(N)+'" as a '+this.name),N.$$.ptr||Et("Cannot pass deleted object as a pointer of type "+this.name),N.$$.ptrType.isConst&&Et("Cannot convert argument of type "+N.$$.ptrType.name+" to parameter type "+this.name);var ee=N.$$.ptrType.registeredClass,pe=so(N.$$.ptr,ee,this.registeredClass);return pe}function Uo(P){return this.rawGetPointee&&(P=this.rawGetPointee(P)),P}function as(P){this.rawDestructor&&this.rawDestructor(P)}function ii(P){P!==null&&P.delete()}function Sr(){ai.prototype.getPointee=Uo,ai.prototype.destructor=as,ai.prototype.argPackAdvance=8,ai.prototype.readValueFromPointer=Yt,ai.prototype.deleteObject=ii,ai.prototype.fromWireType=ma}function ai(P,N,ee,pe,Oe,Be,Ne,Ve,L,V,_){this.name=P,this.registeredClass=N,this.isReference=ee,this.isConst=pe,this.isSmartPointer=Oe,this.pointeeType=Be,this.sharingPolicy=Ne,this.rawGetPointee=Ve,this.rawConstructor=L,this.rawShare=V,this.rawDestructor=_,!Oe&&N.baseClass===void 0?pe?(this.toWireType=hi,this.destructorFunction=null):(this.toWireType=Kr,this.destructorFunction=null):this.toWireType=Xs}function wr(P,N,ee){a.hasOwnProperty(P)||Ji("Replacing nonexistant public symbol"),a[P].overloadTable!==void 0&&ee!==void 0||(a[P]=N,a[P].argCount=ee)}function na(P,N,ee){var pe=a["dynCall_"+P];return ee&&ee.length?pe.apply(null,[N].concat(ee)):pe.call(null,N)}var ya=[];function Ta(P){var N=ya[P];return N||(P>=ya.length&&(ya.length=P+1),ya[P]=N=Ze.get(P)),N}function Wn(P,N,ee){if(P.includes("j"))return na(P,N,ee);var pe=Ta(N).apply(null,ee);return pe}function co(P,N){var ee=[];return function(){return ee.length=0,Object.assign(ee,arguments),Wn(P,N,ee)}}function oi(P,N){P=ot(P);function ee(){return P.includes("j")?co(P,N):Ta(N)}var pe=ee();return typeof pe!="function"&&Et("unknown function pointer with signature "+P+": "+N),pe}var xr=void 0;function Ca(P){var N=Fe(P),ee=ot(N);return Ue(N),ee}function Bi(P,N){var ee=[],pe={};function Oe(Be){if(!pe[Be]&&!Ee[Be]){if(ze[Be]){ze[Be].forEach(Oe);return}ee.push(Be),pe[Be]=!0}}throw N.forEach(Oe),new xr(P+": "+ee.map(Ca).join([", "]))}function Nr(P,N,ee,pe,Oe,Be,Ne,Ve,L,V,_,M,A){_=ot(_),Be=oi(Oe,Be),Ve&&(Ve=oi(Ne,Ve)),V&&(V=oi(L,V)),A=oi(M,A);var K=Wr(_);oo(K,function(){Bi("Cannot construct "+_+" due to unbound types",[pe])}),yr([P,N,ee],pe?[pe]:[],function(te){te=te[0];var re,se;pe?(re=te.registeredClass,se=re.instancePrototype):se=pn.prototype;var de=vr(K,function(){if(Object.getPrototypeOf(this)!==we)throw new Ot("Use 'new' to construct "+_);if(Ie.constructor_body===void 0)throw new Ot(_+" has no accessible constructor");var Rt=Ie.constructor_body[arguments.length];if(Rt===void 0)throw new Ot("Tried to invoke ctor of "+_+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Ie.constructor_body).toString()+") parameters instead!");return Rt.apply(this,arguments)}),we=Object.create(se,{constructor:{value:de}});de.prototype=we;var Ie=new ta(_,de,we,A,re,Be,Ve,V),Xe=new ai(_,Ie,!0,!1,!1),at=new ai(_+"*",Ie,!1,!1,!1),nt=new ai(_+" const*",Ie,!1,!0,!1);return vt[P]={pointerType:at,constPointerType:nt},wr(K,de),[Xe,at,nt]})}function pi(P,N){for(var ee=[],pe=0;pe<P;pe++)ee.push(fe[N+pe*4>>2]);return ee}function ra(P,N){if(!(P instanceof Function))throw new TypeError("new_ called with constructor type "+typeof P+" which is not a function");var ee=vr(P.name||"unknownFunctionName",function(){});ee.prototype=P.prototype;var pe=new ee,Oe=P.apply(pe,N);return Oe instanceof Object?Oe:pe}function Fo(P,N,ee,pe,Oe){var Be=N.length;Be<2&&Et("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var Ne=N[1]!==null&&ee!==null,Ve=!1,L=1;L<N.length;++L)if(N[L]!==null&&N[L].destructorFunction===void 0){Ve=!0;break}for(var V=N[0].name!=="void",_="",M="",L=0;L<Be-2;++L)_+=(L!==0?", ":"")+"arg"+L,M+=(L!==0?", ":"")+"arg"+L+"Wired";var A="return function "+Wr(P)+"("+_+`) {
if (arguments.length !== `+(Be-2)+`) {
throwBindingError('function `+P+" called with ' + arguments.length + ' arguments, expected "+(Be-2)+` args!');
}
`;Ve&&(A+=`var destructors = [];
`);var K=Ve?"destructors":"null",te=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],re=[Et,pe,Oe,Ut,N[0],N[1]];Ne&&(A+="var thisWired = classParam.toWireType("+K+`, this);
`);for(var L=0;L<Be-2;++L)A+="var arg"+L+"Wired = argType"+L+".toWireType("+K+", arg"+L+"); // "+N[L+2].name+`
`,te.push("argType"+L),re.push(N[L+2]);if(Ne&&(M="thisWired"+(M.length>0?", ":"")+M),A+=(V?"var rv = ":"")+"invoker(fn"+(M.length>0?", ":"")+M+`);
`,Ve)A+=`runDestructors(destructors);
`;else for(var L=Ne?1:2;L<N.length;++L){var se=L===1?"thisWired":"arg"+(L-2)+"Wired";N[L].destructorFunction!==null&&(A+=se+"_dtor("+se+"); // "+N[L].name+`
`,te.push(se+"_dtor"),re.push(N[L].destructorFunction))}V&&(A+=`var ret = retType.fromWireType(rv);
return ret;
`),A+=`}
`,te.push(A);var de=ra(Function,te).apply(null,re);return de}function Sa(P,N,ee,pe,Oe,Be){j(N>0);var Ne=pi(N,ee);Oe=oi(pe,Oe),yr([],[P],function(Ve){Ve=Ve[0];var L="constructor "+Ve.name;if(Ve.registeredClass.constructor_body===void 0&&(Ve.registeredClass.constructor_body=[]),Ve.registeredClass.constructor_body[N-1]!==void 0)throw new Ot("Cannot register multiple constructors with identical number of parameters ("+(N-1)+") for class '"+Ve.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return Ve.registeredClass.constructor_body[N-1]=()=>{Bi("Cannot construct "+Ve.name+" due to unbound types",Ne)},yr([],Ne,function(V){return V.splice(1,0,null),Ve.registeredClass.constructor_body[N-1]=Fo(L,V,null,Oe,Be),[]}),[]})}function xn(P,N,ee,pe,Oe,Be,Ne,Ve){var L=pi(ee,pe);N=ot(N),Be=oi(Oe,Be),yr([],[P],function(V){V=V[0];var _=V.name+"."+N;N.startsWith("@@")&&(N=Symbol[N.substring(2)]),Ve&&V.registeredClass.pureVirtualFunctions.push(N);function M(){Bi("Cannot call "+_+" due to unbound types",L)}var A=V.registeredClass.instancePrototype,K=A[N];return K===void 0||K.overloadTable===void 0&&K.className!==V.name&&K.argCount===ee-2?(M.argCount=ee-2,M.className=V.name,A[N]=M):(di(A,N,_),A[N].overloadTable[ee-2]=M),yr([],L,function(te){var re=Fo(_,te,V,Be,Ne);return A[N].overloadTable===void 0?(re.argCount=ee-2,A[N]=re):A[N].overloadTable[ee-2]=re,[]}),[]})}var bi=[],En=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Zn(P){P>4&&--En[P].refcount===0&&(En[P]=void 0,bi.push(P))}function wa(){for(var P=0,N=5;N<En.length;++N)En[N]!==void 0&&++P;return P}function Qn(){for(var P=5;P<En.length;++P)if(En[P]!==void 0)return En[P];return null}function ko(){a.count_emval_handles=wa,a.get_first_emval=Qn}var sr={toValue:P=>(P||Et("Cannot use deleted val. handle = "+P),En[P].value),toHandle:P=>{switch(P){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var N=bi.length?bi.pop():En.length;return En[N]={refcount:1,value:P},N}}}};function Mi(P,N){N=ot(N),Dt(P,{name:N,fromWireType:function(ee){var pe=sr.toValue(ee);return Zn(ee),pe},toWireType:function(ee,pe){return sr.toHandle(pe)},argPackAdvance:8,readValueFromPointer:Yt,destructorFunction:null})}function xa(P){if(P===null)return"null";var N=typeof P;return N==="object"||N==="array"||N==="function"?P.toString():""+P}function $i(P,N){switch(N){case 2:return function(ee){return this.fromWireType(ue[ee>>2])};case 3:return function(ee){return this.fromWireType(qe[ee>>3])};default:throw new TypeError("Unknown float type: "+P)}}function Yr(P,N,ee){var pe=Fi(ee);N=ot(N),Dt(P,{name:N,fromWireType:function(Oe){return Oe},toWireType:function(Oe,Be){return Be},argPackAdvance:8,readValueFromPointer:$i(N,pe),destructorFunction:null})}function cr(P,N,ee){switch(N){case 0:return ee?function(Oe){return ie[Oe]}:function(Oe){return ye[Oe]};case 1:return ee?function(Oe){return ge[Oe>>1]}:function(Oe){return W[Oe>>1]};case 2:return ee?function(Oe){return ae[Oe>>2]}:function(Oe){return fe[Oe>>2]};default:throw new TypeError("Unknown integer type: "+P)}}function ia(P,N,ee,pe,Oe){N=ot(N);var Be=Fi(ee),Ne=M=>M;if(pe===0){var Ve=32-8*ee;Ne=M=>M<<Ve>>>Ve}var L=N.includes("unsigned"),V=(M,A)=>{},_;L?_=function(M,A){return V(A,this.name),A>>>0}:_=function(M,A){return V(A,this.name),A},Dt(P,{name:N,fromWireType:Ne,toWireType:_,argPackAdvance:8,readValueFromPointer:cr(N,Be,pe!==0),destructorFunction:null})}function lo(P,N,ee){var pe=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Oe=pe[N];function Be(Ne){Ne=Ne>>2;var Ve=fe,L=Ve[Ne],V=Ve[Ne+1];return new Oe(X,V,L)}ee=ot(ee),Dt(P,{name:ee,fromWireType:Be,argPackAdvance:8,readValueFromPointer:Be},{ignoreDuplicateRegistrations:!0})}function Ea(P,N){N=ot(N);var ee=N==="std::string";Dt(P,{name:N,fromWireType:function(pe){var Oe=fe[pe>>2],Be=pe+4,Ne;if(ee)for(var Ve=Be,L=0;L<=Oe;++L){var V=Be+L;if(L==Oe||ye[V]==0){var _=V-Ve,M=z(Ve,_);Ne===void 0?Ne=M:(Ne+="\0",Ne+=M),Ve=V+1}}else{for(var A=new Array(Oe),L=0;L<Oe;++L)A[L]=String.fromCharCode(ye[Be+L]);Ne=A.join("")}return Ue(pe),Ne},toWireType:function(pe,Oe){Oe instanceof ArrayBuffer&&(Oe=new Uint8Array(Oe));var Be,Ne=typeof Oe=="string";Ne||Oe instanceof Uint8Array||Oe instanceof Uint8ClampedArray||Oe instanceof Int8Array||Et("Cannot pass non-string to std::string"),ee&&Ne?Be=le(Oe):Be=Oe.length;var Ve=_e(4+Be+1),L=Ve+4;if(fe[Ve>>2]=Be,ee&&Ne)Q(Oe,L,Be+1);else if(Ne)for(var V=0;V<Be;++V){var _=Oe.charCodeAt(V);_>255&&(Ue(L),Et("String has UTF-16 code units that do not fit in 8 bits")),ye[L+V]=_}else for(var V=0;V<Be;++V)ye[L+V]=Oe[V];return pe!==null&&pe.push(Ue,Ve),Ve},argPackAdvance:8,readValueFromPointer:Yt,destructorFunction:function(pe){Ue(pe)}})}var Ga=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function uo(P,N){for(var ee=P,pe=ee>>1,Oe=pe+N/2;!(pe>=Oe)&&W[pe];)++pe;if(ee=pe<<1,ee-P>32&&Ga)return Ga.decode(ye.subarray(P,ee));for(var Be="",Ne=0;!(Ne>=N/2);++Ne){var Ve=ge[P+Ne*2>>1];if(Ve==0)break;Be+=String.fromCharCode(Ve)}return Be}function Ba(P,N,ee){if(ee===void 0&&(ee=2147483647),ee<2)return 0;ee-=2;for(var pe=N,Oe=ee<P.length*2?ee/2:P.length,Be=0;Be<Oe;++Be){var Ne=P.charCodeAt(Be);ge[N>>1]=Ne,N+=2}return ge[N>>1]=0,N-pe}function $a(P){return P.length*2}function fo(P,N){for(var ee=0,pe="";!(ee>=N/4);){var Oe=ae[P+ee*4>>2];if(Oe==0)break;if(++ee,Oe>=65536){var Be=Oe-65536;pe+=String.fromCharCode(55296|Be>>10,56320|Be&1023)}else pe+=String.fromCharCode(Oe)}return pe}function os(P,N,ee){if(ee===void 0&&(ee=2147483647),ee<4)return 0;for(var pe=N,Oe=pe+ee-4,Be=0;Be<P.length;++Be){var Ne=P.charCodeAt(Be);if(Ne>=55296&&Ne<=57343){var Ve=P.charCodeAt(++Be);Ne=65536+((Ne&1023)<<10)|Ve&1023}if(ae[N>>2]=Ne,N+=4,N+4>Oe)break}return ae[N>>2]=0,N-pe}function Zs(P){for(var N=0,ee=0;ee<P.length;++ee){var pe=P.charCodeAt(ee);pe>=55296&&pe<=57343&&++ee,N+=4}return N}function Qs(P,N,ee){ee=ot(ee);var pe,Oe,Be,Ne,Ve;N===2?(pe=uo,Oe=Ba,Ne=$a,Be=()=>W,Ve=1):N===4&&(pe=fo,Oe=os,Ne=Zs,Be=()=>fe,Ve=2),Dt(P,{name:ee,fromWireType:function(L){for(var V=fe[L>>2],_=Be(),M,A=L+4,K=0;K<=V;++K){var te=L+4+K*N;if(K==V||_[te>>Ve]==0){var re=te-A,se=pe(A,re);M===void 0?M=se:(M+="\0",M+=se),A=te+N}}return Ue(L),M},toWireType:function(L,V){typeof V!="string"&&Et("Cannot pass non-string to C++ string type "+ee);var _=Ne(V),M=_e(4+_+N);return fe[M>>2]=_>>Ve,Oe(V,M+4,_+N),L!==null&&L.push(Ue,M),M},argPackAdvance:8,readValueFromPointer:Yt,destructorFunction:function(L){Ue(L)}})}function Js(P,N,ee,pe,Oe,Be){mr[P]={name:ot(N),rawConstructor:oi(ee,pe),rawDestructor:oi(Oe,Be),fields:[]}}function Go(P,N,ee,pe,Oe,Be,Ne,Ve,L,V){mr[P].fields.push({fieldName:ot(N),getterReturnType:ee,getter:oi(pe,Oe),getterContext:Be,setterArgumentType:Ne,setter:oi(Ve,L),setterContext:V})}function ss(P,N){N=ot(N),Dt(P,{isVoid:!0,name:N,argPackAdvance:0,fromWireType:function(){},toWireType:function(ee,pe){}})}var ec={};function cs(P){var N=ec[P];return N===void 0?ot(P):N}function ls(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function tc(P){return P===0?sr.toHandle(ls()):(P=cs(P),sr.toHandle(ls()[P]))}function go(P){P>4&&(En[P].refcount+=1)}function us(P,N){var ee=Ee[P];return ee===void 0&&Et(N+" has unknown type "+Ca(P)),ee}function fs(P){for(var N="",ee=0;ee<P;++ee)N+=(ee!==0?", ":"")+"arg"+ee;for(var pe=()=>fe,Oe="return function emval_allocator_"+P+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,ee=0;ee<P;++ee)Oe+="var argType"+ee+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+ee+`');
var arg`+ee+" = argType"+ee+`.readValueFromPointer(args);
args += argType`+ee+`['argPackAdvance'];
argTypes += 4;
`;return Oe+="var obj = new constructor("+N+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",Oe)(us,a,sr.toHandle,pe)}var Bo={};function nc(P,N,ee,pe){P=sr.toValue(P);var Oe=Bo[N];return Oe||(Oe=fs(N),Bo[N]=Oe),Oe(P,ee,pe)}function ho(P,N){P=us(P,"_emval_take_value");var ee=P.readValueFromPointer(N);return sr.toHandle(ee)}function rc(){Vr("")}function gs(){return 2147483648}function ic(){return gs()}function ds(P,N,ee){ye.copyWithin(P,N,N+ee)}function ac(P){try{return I.grow(P-X.byteLength+65535>>>16),et(I.buffer),1}catch{}}function oc(P){var N=ye.length;P=P>>>0;var ee=gs();if(P>ee)return!1;let pe=(L,V)=>L+(V-L%V)%V;for(var Oe=1;Oe<=4;Oe*=2){var Be=N*(1+.2/Oe);Be=Math.min(Be,P+100663296);var Ne=Math.min(ee,pe(Math.max(P,Be),65536)),Ve=ac(Ne);if(Ve)return!0}return!1}var $o={};function Wo(){return u||"./this.program"}function aa(){if(!aa.strings){var P=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",N={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:P,_:Wo()};for(var ee in $o)$o[ee]===void 0?delete N[ee]:N[ee]=$o[ee];var pe=[];for(var ee in N)pe.push(ee+"="+N[ee]);aa.strings=pe}return aa.strings}function Ra(P,N,ee){for(var pe=0;pe<P.length;++pe)ie[N++>>0]=P.charCodeAt(pe);ie[N>>0]=0}function Li(P,N){var ee=0;return aa().forEach(function(pe,Oe){var Be=N+ee;fe[P+Oe*4>>2]=Be,Ra(pe,Be),ee+=pe.length+1}),0}function hs(P,N){var ee=aa();fe[P>>2]=ee.length;var pe=0;return ee.forEach(function(Oe){pe+=Oe.length+1}),fe[N>>2]=pe,0}function ps(P){return 52}function Wa(P,N,ee,pe,Oe){return 70}var Oa=[null,[],[]];function po(P,N){var ee=Oa[P];N===0||N===10?((P===1?R:O)($(ee,0)),ee.length=0):ee.push(N)}function zo(P,N,ee,pe){for(var Oe=0,Be=0;Be<ee;Be++){var Ne=fe[N>>2],Ve=fe[N+4>>2];N+=8;for(var L=0;L<Ve;L++)po(P,ye[Ne+L]);Oe+=Ve}return fe[pe>>2]=Oe,0}function k(P){var N=a["_"+P];return N}function B(P,N){ie.set(P,N)}function ne(P,N,ee,pe,Oe){var Be={string:te=>{var re=0;if(te!=null&&te!==0){var se=(te.length<<2)+1;re=Qe(se),Q(te,re,se)}return re},array:te=>{var re=Qe(te.length);return B(te,re),re}};function Ne(te){return N==="string"?z(te):N==="boolean"?!!te:te}var Ve=k(P),L=[],V=0;if(pe)for(var _=0;_<pe.length;_++){var M=Be[ee[_]];M?(V===0&&(V=Me()),L[_]=M(pe[_])):L[_]=pe[_]}var A=Ve.apply(null,L);function K(te){return V!==0&&ke(V),Ne(te)}return A=K(A),A}Ir=a.InternalError=rr(Error,"InternalError"),$n(),Ot=a.BindingError=rr(Error,"BindingError"),Po(),No(),Sr(),xr=a.UnboundTypeError=rr(Error,"UnboundTypeError"),ko();var Se={D:sn,e:ir,t:Ei,B:zr,r:Nr,q:Sa,b:xn,A:Mi,l:Yr,d:ia,a:lo,k:Ea,f:Qs,g:Js,c:Go,C:ss,h:Zn,o:tc,m:go,n:nc,p:ho,i:rc,v:ic,z:ds,u:oc,w:Li,x:hs,y:ps,s:Wa,j:zo};Je(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.F).apply(null,arguments)};var _e=a._malloc=function(){return(_e=a._malloc=a.asm.H).apply(null,arguments)},Ue=a._free=function(){return(Ue=a._free=a.asm.I).apply(null,arguments)},Fe=a.___getTypeName=function(){return(Fe=a.___getTypeName=a.asm.J).apply(null,arguments)};a.__embind_initialize_bindings=function(){return(a.__embind_initialize_bindings=a.asm.K).apply(null,arguments)};var Me=a.stackSave=function(){return(Me=a.stackSave=a.asm.L).apply(null,arguments)},ke=a.stackRestore=function(){return(ke=a.stackRestore=a.asm.M).apply(null,arguments)},Qe=a.stackAlloc=function(){return(Qe=a.stackAlloc=a.asm.N).apply(null,arguments)},ct=a.___cxa_is_pointer_type=function(){return(ct=a.___cxa_is_pointer_type=a.asm.O).apply(null,arguments)};a.dynCall_iji=function(){return(a.dynCall_iji=a.asm.P).apply(null,arguments)},a.dynCall_jji=function(){return(a.dynCall_jji=a.asm.Q).apply(null,arguments)},a.dynCall_iiji=function(){return(a.dynCall_iiji=a.asm.R).apply(null,arguments)},a.dynCall_jiji=function(){return(a.dynCall_jiji=a.asm.S).apply(null,arguments)},a.ccall=ne;var dt;un=function P(){dt||St(),dt||(un=P)};function St(P){if(Nn>0||(Bt(),Nn>0))return;function N(){dt||(dt=!0,a.calledRun=!0,!G&&(pr(),o(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),Lr()))}a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),N()},1)):N()}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return St(),i.ready}})();t.exports=n}(q3)),q3.exports}var Cee=Tee();const See=$s(Cee),wee=new URL("/dicom-reader/assets/openjpegwasm_decode-C4nnCcr6.wasm",import.meta.url),Wg={codec:void 0,decoder:void 0,decodeConfig:{}};function xee(t){if(Wg.decodeConfig=t,Wg.codec)return Promise.resolve();const e=See({locateFile:n=>n.endsWith(".wasm")?wee.toString():n});return new Promise((n,r)=>{e.then(i=>{Wg.codec=i,Wg.decoder=new i.J2KDecoder,n()},r)})}async function SS(t,e){await xee();const n=Wg.decoder,r=n.getEncodedBuffer(t.length);r.set(t),n.decode();const i=n.getFrameInfo(),a=n.getDecodedBuffer();new Uint8Array(a.length).set(a);const s=`x: ${n.getImageOffset().x}, y: ${n.getImageOffset().y}`,c=n.getNumDecompositions(),u=n.getNumLayers(),d=["unknown","LRCP","RLCP","RPCL","PCRL","CPRL"][n.getProgressionOrder()+1],g=n.getIsReversible(),h=`${n.getBlockDimensions().width} x ${n.getBlockDimensions().height}`,m=`${n.getTileSize().width} x ${n.getTileSize().height}`,y=`${n.getTileOffset().x}, ${n.getTileOffset().y}`,v=n.getColorSpace(),C=`${a.length.toLocaleString()} bytes`,S=`${(a.length/r.length).toFixed(2)}:1`,w={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:i.isSigned,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},x=Eee(i,a),R={imageOffset:s,numDecompositions:c,numLayers:u,progessionOrder:d,reversible:g,blockDimensions:h,tileSize:m,tileOffset:y,colorTransform:v,decodedSize:C,compressionRatio:S};return{...e,pixelData:x,imageInfo:w,encodeOptions:R,...R,...w}}function Eee(t,e){return t.bitsPerSample>8?t.isSigned?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}var K3={exports:{}},wS;function Ree(){return wS||(wS=1,function(t,e){var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(a){a=a||{};var a=typeof a<"u"?a:{},o,s;a.ready=new Promise(function(L,V){o=L,s=V});var c=Object.assign({},a),u=typeof window=="object",d=typeof importScripts=="function",g=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",h="";function m(L){return a.locateFile?a.locateFile(L,h):h+L}var y,v,C;if(g){var S=As,w=As;d?h=w.dirname(h)+"/":h=__dirname+"/",y=(L,V)=>(L=J(L)?new URL(L):w.normalize(L),S.readFileSync(L,V?void 0:"utf8")),C=L=>{var V=y(L,!0);return V.buffer||(V=new Uint8Array(V)),V},v=(L,V,_)=>{L=J(L)?new URL(L):w.normalize(L),S.readFile(L,function(M,A){M?_(M):V(A.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(L){if(!(L instanceof Je))throw L}),process.on("unhandledRejection",function(L){throw L}),a.inspect=function(){return"[Emscripten Module object]"}}else(u||d)&&(d?h=self.location.href:typeof document<"u"&&document.currentScript&&(h=document.currentScript.src),r&&(h=r),h.indexOf("blob:")!==0?h=h.substr(0,h.replace(/[?#].*/,"").lastIndexOf("/")+1):h="",y=L=>{var V=new XMLHttpRequest;return V.open("GET",L,!1),V.send(null),V.responseText},d&&(C=L=>{var V=new XMLHttpRequest;return V.open("GET",L,!1),V.responseType="arraybuffer",V.send(null),new Uint8Array(V.response)}),v=(L,V,_)=>{var M=new XMLHttpRequest;M.open("GET",L,!0),M.responseType="arraybuffer",M.onload=()=>{if(M.status==200||M.status==0&&M.response){V(M.response);return}_()},M.onerror=_,M.send(null)});var x=a.print||console.log.bind(console),R=a.printErr||console.warn.bind(console);Object.assign(a,c),c=null,a.arguments&&a.arguments,a.thisProgram&&a.thisProgram,a.quit&&a.quit;var O;a.wasmBinary&&(O=a.wasmBinary),a.noExitRuntime,typeof WebAssembly!="object"&&nr("no native wasm support detected");var b,I=!1;function G(L,V){L||nr(V)}var j=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function F(L,V,_){for(var M=V+_,A=V;L[A]&&!(A>=M);)++A;if(A-V>16&&L.buffer&&j)return j.decode(L.subarray(V,A));for(var K="";V<A;){var te=L[V++];if(!(te&128)){K+=String.fromCharCode(te);continue}var re=L[V++]&63;if((te&224)==192){K+=String.fromCharCode((te&31)<<6|re);continue}var se=L[V++]&63;if((te&240)==224?te=(te&15)<<12|re<<6|se:te=(te&7)<<18|re<<12|se<<6|L[V++]&63,te<65536)K+=String.fromCharCode(te);else{var de=te-65536;K+=String.fromCharCode(55296|de>>10,56320|de&1023)}}return K}function $(L,V){return L?F(ie,L,V):""}function z(L,V,_,M){if(!(M>0))return 0;for(var A=_,K=_+M-1,te=0;te<L.length;++te){var re=L.charCodeAt(te);if(re>=55296&&re<=57343){var se=L.charCodeAt(++te);re=65536+((re&1023)<<10)|se&1023}if(re<=127){if(_>=K)break;V[_++]=re}else if(re<=2047){if(_+1>=K)break;V[_++]=192|re>>6,V[_++]=128|re&63}else if(re<=65535){if(_+2>=K)break;V[_++]=224|re>>12,V[_++]=128|re>>6&63,V[_++]=128|re&63}else{if(_+3>=K)break;V[_++]=240|re>>18,V[_++]=128|re>>12&63,V[_++]=128|re>>6&63,V[_++]=128|re&63}}return V[_]=0,_-A}function oe(L,V,_){return z(L,ie,V,_)}function Q(L){for(var V=0,_=0;_<L.length;++_){var M=L.charCodeAt(_);M<=127?V++:M<=2047?V+=2:M>=55296&&M<=57343?(V+=4,++_):V+=3}return V}var le,X,ie,ye,ge,W,ae,fe,ue;function qe(L){le=L,a.HEAP8=X=new Int8Array(L),a.HEAP16=ye=new Int16Array(L),a.HEAP32=W=new Int32Array(L),a.HEAPU8=ie=new Uint8Array(L),a.HEAPU16=ge=new Uint16Array(L),a.HEAPU32=ae=new Uint32Array(L),a.HEAPF32=fe=new Float32Array(L),a.HEAPF64=ue=new Float64Array(L)}a.INITIAL_MEMORY;var et,Ze=[],yt=[],tt=[];function st(){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)Lr(a.preRun.shift());Ct(Ze)}function Bt(){Ct(yt)}function pr(){if(a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;)Gn(a.postRun.shift());Ct(tt)}function Lr(L){Ze.unshift(L)}function bn(L){yt.unshift(L)}function Gn(L){tt.unshift(L)}var Mn=0,Nn=null;function un(L){Mn++,a.monitorRunDependencies&&a.monitorRunDependencies(Mn)}function Bn(L){if(Mn--,a.monitorRunDependencies&&a.monitorRunDependencies(Mn),Mn==0&&Nn){var V=Nn;Nn=null,V()}}function nr(L){a.onAbort&&a.onAbort(L),L="Aborted("+L+")",R(L),I=!0,L+=". Build with -sASSERTIONS for more info.";var V=new WebAssembly.RuntimeError(L);throw s(V),V}var Vr="data:application/octet-stream;base64,";function Y(L){return L.startsWith(Vr)}function J(L){return L.startsWith("file://")}var he;he="openjphjs.wasm",Y(he)||(he=m(he));function Z(L){try{if(L==he&&O)return new Uint8Array(O);if(C)return C(L);throw"both async and sync fetching of the wasm failed"}catch(V){nr(V)}}function ve(){if(!O&&(u||d)){if(typeof fetch=="function"&&!J(he))return fetch(he,{credentials:"same-origin"}).then(function(L){if(!L.ok)throw"failed to load wasm binary file at '"+he+"'";return L.arrayBuffer()}).catch(function(){return Z(he)});if(v)return new Promise(function(L,V){v(he,function(_){L(new Uint8Array(_))},V)})}return Promise.resolve().then(function(){return Z(he)})}function Pe(){var L={env:k,wasi_snapshot_preview1:k};function V(te,re){var se=te.exports;a.asm=se,b=a.asm.memory,qe(b.buffer),et=a.asm.__indirect_function_table,bn(a.asm.__wasm_call_ctors),Bn()}un();function _(te){V(te.instance)}function M(te){return ve().then(function(re){return WebAssembly.instantiate(re,L)}).then(function(re){return re}).then(te,function(re){R("failed to asynchronously prepare wasm: "+re),nr(re)})}function A(){return!O&&typeof WebAssembly.instantiateStreaming=="function"&&!Y(he)&&!J(he)&&!g&&typeof fetch=="function"?fetch(he,{credentials:"same-origin"}).then(function(te){var re=WebAssembly.instantiateStreaming(te,L);return re.then(_,function(se){return R("wasm streaming compile failed: "+se),R("falling back to ArrayBuffer instantiation"),M(_)})}):M(_)}if(a.instantiateWasm)try{var K=a.instantiateWasm(L,V);return K}catch(te){R("Module.instantiateWasm callback failed with error: "+te),s(te)}return A().catch(s),{}}function Je(L){this.name="ExitStatus",this.message="Program terminated with exit("+L+")",this.status=L}function Ct(L){for(;L.length>0;)L.shift()(a)}function xt(L,V,_,M){nr("Assertion failed: "+$(L)+", at: "+[V?$(V):"unknown filename",_,M?$(M):"unknown function"])}var wn=[];function sn(L){L.add_ref()}function mr(L){var V=new ut(L);return V.get_caught()||V.set_caught(!0),V.set_rethrown(!1),wn.push(V),sn(V),V.get_exception_ptr()}var Ut=0,Yt=[];function Ht(L){var V=Yt[L];return V||(L>=Yt.length&&(Yt.length=L+1),Yt[L]=V=et.get(L)),V}function Ee(L){if(L.release_ref()&&!L.get_rethrown()){var V=L.get_destructor();V&&Ht(V)(L.excPtr),Se(L.excPtr)}}function ze(){_setThrew(0);var L=wn.pop();Ee(L),Ut=0}function ut(L){this.excPtr=L,this.ptr=L-24,this.set_type=function(V){ae[this.ptr+4>>2]=V},this.get_type=function(){return ae[this.ptr+4>>2]},this.set_destructor=function(V){ae[this.ptr+8>>2]=V},this.get_destructor=function(){return ae[this.ptr+8>>2]},this.set_refcount=function(V){W[this.ptr>>2]=V},this.set_caught=function(V){V=V?1:0,X[this.ptr+12>>0]=V},this.get_caught=function(){return X[this.ptr+12>>0]!=0},this.set_rethrown=function(V){V=V?1:0,X[this.ptr+13>>0]=V},this.get_rethrown=function(){return X[this.ptr+13>>0]!=0},this.init=function(V,_){this.set_adjusted_ptr(0),this.set_type(V),this.set_destructor(_),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var V=W[this.ptr>>2];W[this.ptr>>2]=V+1},this.release_ref=function(){var V=W[this.ptr>>2];return W[this.ptr>>2]=V-1,V===1},this.set_adjusted_ptr=function(V){ae[this.ptr+16>>2]=V},this.get_adjusted_ptr=function(){return ae[this.ptr+16>>2]},this.get_exception_ptr=function(){var V=ct(this.get_type());if(V)return ae[this.excPtr>>2];var _=this.get_adjusted_ptr();return _!==0?_:this.excPtr}}function qt(L){throw Ut||(Ut=L),L}function Wr(){var L=Ut;if(!L)return Ue(0),0;var V=new ut(L);V.set_adjusted_ptr(L);var _=V.get_type();if(!_)return Ue(0),L;for(var M=0;M<arguments.length;M++){var A=arguments[M];if(A===0||A===_)break;var K=V.ptr+16;if(Qe(A,_,K))return Ue(A),L}return Ue(_),L}function vr(){var L=Ut;if(!L)return Ue(0),0;var V=new ut(L);V.set_adjusted_ptr(L);var _=V.get_type();if(!_)return Ue(0),L;for(var M=0;M<arguments.length;M++){var A=arguments[M];if(A===0||A===_)break;var K=V.ptr+16;if(Qe(A,_,K))return Ue(A),L}return Ue(_),L}function rr(L,V,_){var M=new ut(L);throw M.init(V,_),Ut=L,L}var Ir={};function Ji(L){for(;L.length;){var V=L.pop(),_=L.pop();_(V)}}function yr(L){return this.fromWireType(W[L>>2])}var ir={},Ei={},Fi={},$n=48,Tr=57;function ot(L){if(L===void 0)return"_unknown";L=L.replace(/[^a-zA-Z0-9_]/g,"$");var V=L.charCodeAt(0);return V>=$n&&V<=Tr?"_"+L:L}function Ot(L,V){return L=ot(L),new Function("body","return function "+L+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(V)}function Et(L,V){var _=Ot(V,function(M){this.name=V,this.message=M;var A=new Error(M).stack;A!==void 0&&(this.stack=this.toString()+`
`+A.replace(/^Error(:[^\n]*)?\n/,""))});return _.prototype=Object.create(L.prototype),_.prototype.constructor=_,_.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},_}var Dt=void 0;function zr(L){throw new Dt(L)}function Ri(L,V,_){L.forEach(function(re){Fi[re]=V});function M(re){var se=_(re);se.length!==L.length&&zr("Mismatched type converter count");for(var de=0;de<L.length;++de)ar(L[de],se[de])}var A=new Array(V.length),K=[],te=0;V.forEach((re,se)=>{Ei.hasOwnProperty(re)?A[se]=Ei[re]:(K.push(re),ir.hasOwnProperty(re)||(ir[re]=[]),ir[re].push(()=>{A[se]=Ei[re],++te,te===K.length&&M(A)}))}),K.length===0&&M(A)}function io(L){var V=Ir[L];delete Ir[L];var _=V.rawConstructor,M=V.rawDestructor,A=V.fields,K=A.map(te=>te.getterReturnType).concat(A.map(te=>te.setterArgumentType));Ri([L],K,te=>{var re={};return A.forEach((se,de)=>{var we=se.fieldName,Ie=te[de],Xe=se.getter,at=se.getterContext,nt=te[de+A.length],Rt=se.setter,_t=se.setterContext;re[we]={read:Jt=>Ie.fromWireType(Xe(at,Jt)),write:(Jt,On)=>{var Pn=[];Rt(_t,Jt,nt.toWireType(Pn,On)),Ji(Pn)}}}),[{name:V.name,fromWireType:function(se){var de={};for(var we in re)de[we]=re[we].read(se);return M(se),de},toWireType:function(se,de){for(var we in re)if(!(we in de))throw new TypeError('Missing field:  "'+we+'"');var Ie=_();for(we in re)re[we].write(Ie,de[we]);return se!==null&&se.push(M,Ie),Ie},argPackAdvance:8,readValueFromPointer:yr,destructorFunction:M}]})}function ki(L,V,_,M,A){}function Oi(L){switch(L){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+L)}}function gi(){for(var L=new Array(256),V=0;V<256;++V)L[V]=String.fromCharCode(V);Di=L}var Di=void 0;function Rn(L){for(var V="",_=L;ie[_];)V+=Di[ie[_++]];return V}var Ar=void 0;function vt(L){throw new Ar(L)}function ar(L,V,_={}){if(!("argPackAdvance"in V))throw new TypeError("registerType registeredInstance requires argPackAdvance");var M=V.name;if(L||vt('type "'+M+'" must have a positive integer typeid pointer'),Ei.hasOwnProperty(L)){if(_.ignoreDuplicateRegistrations)return;vt("Cannot register type '"+M+"' twice")}if(Ei[L]=V,delete Fi[L],ir.hasOwnProperty(L)){var A=ir[L];delete ir[L],A.forEach(K=>K())}}function ao(L,V,_,M,A){var K=Oi(_);V=Rn(V),ar(L,{name:V,fromWireType:function(te){return!!te},toWireType:function(te,re){return re?M:A},argPackAdvance:8,readValueFromPointer:function(te){var re;if(_===1)re=X;else if(_===2)re=ye;else if(_===4)re=W;else throw new TypeError("Unknown boolean type size: "+V);return this.fromWireType(re[te>>K])},destructorFunction:null})}function or(L){if(!(this instanceof Sr)||!(L instanceof Sr))return!1;for(var V=this.$$.ptrType.registeredClass,_=this.$$.ptr,M=L.$$.ptrType.registeredClass,A=L.$$.ptr;V.baseClass;)_=V.upcast(_),V=V.baseClass;for(;M.baseClass;)A=M.upcast(A),M=M.baseClass;return V===M&&_===A}function Hr(L){return{count:L.count,deleteScheduled:L.deleteScheduled,preservePointerOnDelete:L.preservePointerOnDelete,ptr:L.ptr,ptrType:L.ptrType,smartPtr:L.smartPtr,smartPtrType:L.smartPtrType}}function _i(L){function V(_){return _.$$.ptrType.registeredClass.name}vt(V(L)+" instance already deleted")}var jr=!1;function No(L){}function Ua(L){L.smartPtr?L.smartPtrType.rawDestructor(L.smartPtr):L.ptrType.registeredClass.rawDestructor(L.ptr)}function qr(L){L.count.value-=1;var V=L.count.value===0;V&&Ua(L)}function Fa(L,V,_){if(V===_)return L;if(_.baseClass===void 0)return null;var M=Fa(L,V,_.baseClass);return M===null?null:_.downcast(M)}var Xn={};function ma(){return Object.keys(pn).length}function va(){var L=[];for(var V in pn)pn.hasOwnProperty(V)&&L.push(pn[V]);return L}var Cr=[];function ka(){for(;Cr.length;){var L=Cr.pop();L.$$.deleteScheduled=!1,L.delete()}}var ea=void 0;function Gi(L){ea=L,Cr.length&&ea&&ea(ka)}function Po(){a.getInheritedInstanceCount=ma,a.getLiveInheritedInstances=va,a.flushPendingDeletes=ka,a.setDelayFunction=Gi}var pn={};function di(L,V){for(V===void 0&&vt("ptr should not be undefined");L.baseClass;)V=L.upcast(V),L=L.baseClass;return V}function oo(L,V){return V=di(L,V),pn[V]}function ta(L,V){(!V.ptrType||!V.ptr)&&zr("makeClassHandle requires ptr and ptrType");var _=!!V.smartPtrType,M=!!V.smartPtr;return _!==M&&zr("Both smartPtrType and smartPtr must be specified"),V.count={value:1},hi(Object.create(L,{$$:{value:V}}))}function so(L){var V=this.getPointee(L);if(!V)return this.destructor(L),null;var _=oo(this.registeredClass,V);if(_!==void 0){if(_.$$.count.value===0)return _.$$.ptr=V,_.$$.smartPtr=L,_.clone();var M=_.clone();return this.destructor(L),M}function A(){return this.isSmartPointer?ta(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:V,smartPtrType:this,smartPtr:L}):ta(this.registeredClass.instancePrototype,{ptrType:this,ptr:L})}var K=this.registeredClass.getActualType(V),te=Xn[K];if(!te)return A.call(this);var re;this.isConst?re=te.constPointerType:re=te.pointerType;var se=Fa(V,this.registeredClass,re.registeredClass);return se===null?A.call(this):this.isSmartPointer?ta(re.registeredClass.instancePrototype,{ptrType:re,ptr:se,smartPtrType:this,smartPtr:L}):ta(re.registeredClass.instancePrototype,{ptrType:re,ptr:se})}function hi(L){return typeof FinalizationRegistry>"u"?(hi=V=>V,L):(jr=new FinalizationRegistry(V=>{qr(V.$$)}),hi=V=>{var _=V.$$,M=!!_.smartPtr;if(M){var A={$$:_};jr.register(V,A,V)}return V},No=V=>jr.unregister(V),hi(L))}function Xs(){if(this.$$.ptr||_i(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var L=hi(Object.create(Object.getPrototypeOf(this),{$$:{value:Hr(this.$$)}}));return L.$$.count.value+=1,L.$$.deleteScheduled=!1,L}function Kr(){this.$$.ptr||_i(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&vt("Object already scheduled for deletion"),No(this),qr(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Uo(){return!this.$$.ptr}function as(){return this.$$.ptr||_i(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&vt("Object already scheduled for deletion"),Cr.push(this),Cr.length===1&&ea&&ea(ka),this.$$.deleteScheduled=!0,this}function ii(){Sr.prototype.isAliasOf=or,Sr.prototype.clone=Xs,Sr.prototype.delete=Kr,Sr.prototype.isDeleted=Uo,Sr.prototype.deleteLater=as}function Sr(){}function ai(L,V,_){if(L[V].overloadTable===void 0){var M=L[V];L[V]=function(){return L[V].overloadTable.hasOwnProperty(arguments.length)||vt("Function '"+_+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+L[V].overloadTable+")!"),L[V].overloadTable[arguments.length].apply(this,arguments)},L[V].overloadTable=[],L[V].overloadTable[M.argCount]=M}}function wr(L,V,_){a.hasOwnProperty(L)?((_===void 0||a[L].overloadTable!==void 0&&a[L].overloadTable[_]!==void 0)&&vt("Cannot register public name '"+L+"' twice"),ai(a,L,L),a.hasOwnProperty(_)&&vt("Cannot register multiple overloads of a function with the same number of arguments ("+_+")!"),a[L].overloadTable[_]=V):(a[L]=V,_!==void 0&&(a[L].numArguments=_))}function na(L,V,_,M,A,K,te,re){this.name=L,this.constructor=V,this.instancePrototype=_,this.rawDestructor=M,this.baseClass=A,this.getActualType=K,this.upcast=te,this.downcast=re,this.pureVirtualFunctions=[]}function ya(L,V,_){for(;V!==_;)V.upcast||vt("Expected null or instance of "+_.name+", got an instance of "+V.name),L=V.upcast(L),V=V.baseClass;return L}function Ta(L,V){if(V===null)return this.isReference&&vt("null is not a valid "+this.name),0;V.$$||vt('Cannot pass "'+Ba(V)+'" as a '+this.name),V.$$.ptr||vt("Cannot pass deleted object as a pointer of type "+this.name);var _=V.$$.ptrType.registeredClass,M=ya(V.$$.ptr,_,this.registeredClass);return M}function Wn(L,V){var _;if(V===null)return this.isReference&&vt("null is not a valid "+this.name),this.isSmartPointer?(_=this.rawConstructor(),L!==null&&L.push(this.rawDestructor,_),_):0;V.$$||vt('Cannot pass "'+Ba(V)+'" as a '+this.name),V.$$.ptr||vt("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&V.$$.ptrType.isConst&&vt("Cannot convert argument of type "+(V.$$.smartPtrType?V.$$.smartPtrType.name:V.$$.ptrType.name)+" to parameter type "+this.name);var M=V.$$.ptrType.registeredClass;if(_=ya(V.$$.ptr,M,this.registeredClass),this.isSmartPointer)switch(V.$$.smartPtr===void 0&&vt("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:V.$$.smartPtrType===this?_=V.$$.smartPtr:vt("Cannot convert argument of type "+(V.$$.smartPtrType?V.$$.smartPtrType.name:V.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:_=V.$$.smartPtr;break;case 2:if(V.$$.smartPtrType===this)_=V.$$.smartPtr;else{var A=V.clone();_=this.rawShare(_,Ga.toHandle(function(){A.delete()})),L!==null&&L.push(this.rawDestructor,_)}break;default:vt("Unsupporting sharing policy")}return _}function co(L,V){if(V===null)return this.isReference&&vt("null is not a valid "+this.name),0;V.$$||vt('Cannot pass "'+Ba(V)+'" as a '+this.name),V.$$.ptr||vt("Cannot pass deleted object as a pointer of type "+this.name),V.$$.ptrType.isConst&&vt("Cannot convert argument of type "+V.$$.ptrType.name+" to parameter type "+this.name);var _=V.$$.ptrType.registeredClass,M=ya(V.$$.ptr,_,this.registeredClass);return M}function oi(L){return this.rawGetPointee&&(L=this.rawGetPointee(L)),L}function xr(L){this.rawDestructor&&this.rawDestructor(L)}function Ca(L){L!==null&&L.delete()}function Bi(){Nr.prototype.getPointee=oi,Nr.prototype.destructor=xr,Nr.prototype.argPackAdvance=8,Nr.prototype.readValueFromPointer=yr,Nr.prototype.deleteObject=Ca,Nr.prototype.fromWireType=so}function Nr(L,V,_,M,A,K,te,re,se,de,we){this.name=L,this.registeredClass=V,this.isReference=_,this.isConst=M,this.isSmartPointer=A,this.pointeeType=K,this.sharingPolicy=te,this.rawGetPointee=re,this.rawConstructor=se,this.rawShare=de,this.rawDestructor=we,!A&&V.baseClass===void 0?M?(this.toWireType=Ta,this.destructorFunction=null):(this.toWireType=co,this.destructorFunction=null):this.toWireType=Wn}function pi(L,V,_){a.hasOwnProperty(L)||zr("Replacing nonexistant public symbol"),a[L].overloadTable!==void 0&&_!==void 0?a[L].overloadTable[_]=V:(a[L]=V,a[L].argCount=_)}function ra(L,V,_){var M=a["dynCall_"+L];return _&&_.length?M.apply(null,[V].concat(_)):M.call(null,V)}function Fo(L,V,_){if(L.includes("j"))return ra(L,V,_);var M=Ht(V).apply(null,_);return M}function Sa(L,V){var _=[];return function(){return _.length=0,Object.assign(_,arguments),Fo(L,V,_)}}function xn(L,V){L=Rn(L);function _(){return L.includes("j")?Sa(L,V):Ht(V)}var M=_();return typeof M!="function"&&vt("unknown function pointer with signature "+L+": "+V),M}var bi=void 0;function En(L){var V=_e(L),_=Rn(V);return ne(V),_}function Zn(L,V){var _=[],M={};function A(K){if(!M[K]&&!Ei[K]){if(Fi[K]){Fi[K].forEach(A);return}_.push(K),M[K]=!0}}throw V.forEach(A),new bi(L+": "+_.map(En).join([", "]))}function wa(L,V,_,M,A,K,te,re,se,de,we,Ie,Xe){we=Rn(we),K=xn(A,K),re&&(re=xn(te,re)),de&&(de=xn(se,de)),Xe=xn(Ie,Xe);var at=ot(we);wr(at,function(){Zn("Cannot construct "+we+" due to unbound types",[M])}),Ri([L,V,_],M?[M]:[],function(nt){nt=nt[0];var Rt,_t;M?(Rt=nt.registeredClass,_t=Rt.instancePrototype):_t=Sr.prototype;var Jt=Ot(at,function(){if(Object.getPrototypeOf(this)!==On)throw new Ar("Use 'new' to construct "+we);if(Pn.constructor_body===void 0)throw new Ar(we+" has no accessible constructor");var Jc=Pn.constructor_body[arguments.length];if(Jc===void 0)throw new Ar("Tried to invoke ctor of "+we+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Pn.constructor_body).toString()+") parameters instead!");return Jc.apply(this,arguments)}),On=Object.create(_t,{constructor:{value:Jt}});Jt.prototype=On;var Pn=new na(we,Jt,On,Xe,Rt,K,re,de),Ho=new Nr(we,Pn,!0,!1,!1),oa=new Nr(we+"*",Pn,!1,!1,!1),mo=new Nr(we+" const*",Pn,!1,!0,!1);return Xn[L]={pointerType:oa,constPointerType:mo},pi(at,Jt),[Ho,oa,mo]})}function Qn(L,V){for(var _=[],M=0;M<L;M++)_.push(ae[V+M*4>>2]);return _}function ko(L,V){if(!(L instanceof Function))throw new TypeError("new_ called with constructor type "+typeof L+" which is not a function");var _=Ot(L.name||"unknownFunctionName",function(){});_.prototype=L.prototype;var M=new _,A=L.apply(M,V);return A instanceof Object?A:M}function sr(L,V,_,M,A){var K=V.length;K<2&&vt("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var te=V[1]!==null&&_!==null,re=!1,se=1;se<V.length;++se)if(V[se]!==null&&V[se].destructorFunction===void 0){re=!0;break}for(var de=V[0].name!=="void",we="",Ie="",se=0;se<K-2;++se)we+=(se!==0?", ":"")+"arg"+se,Ie+=(se!==0?", ":"")+"arg"+se+"Wired";var Xe="return function "+ot(L)+"("+we+`) {
if (arguments.length !== `+(K-2)+`) {
throwBindingError('function `+L+" called with ' + arguments.length + ' arguments, expected "+(K-2)+` args!');
}
`;re&&(Xe+=`var destructors = [];
`);var at=re?"destructors":"null",nt=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Rt=[vt,M,A,Ji,V[0],V[1]];te&&(Xe+="var thisWired = classParam.toWireType("+at+`, this);
`);for(var se=0;se<K-2;++se)Xe+="var arg"+se+"Wired = argType"+se+".toWireType("+at+", arg"+se+"); // "+V[se+2].name+`
`,nt.push("argType"+se),Rt.push(V[se+2]);if(te&&(Ie="thisWired"+(Ie.length>0?", ":"")+Ie),Xe+=(de?"var rv = ":"")+"invoker(fn"+(Ie.length>0?", ":"")+Ie+`);
`,re)Xe+=`runDestructors(destructors);
`;else for(var se=te?1:2;se<V.length;++se){var _t=se===1?"thisWired":"arg"+(se-2)+"Wired";V[se].destructorFunction!==null&&(Xe+=_t+"_dtor("+_t+"); // "+V[se].name+`
`,nt.push(_t+"_dtor"),Rt.push(V[se].destructorFunction))}de&&(Xe+=`var ret = retType.fromWireType(rv);
return ret;
`),Xe+=`}
`,nt.push(Xe);var Jt=ko(Function,nt).apply(null,Rt);return Jt}function Mi(L,V,_,M,A,K){G(V>0);var te=Qn(V,_);A=xn(M,A),Ri([],[L],function(re){re=re[0];var se="constructor "+re.name;if(re.registeredClass.constructor_body===void 0&&(re.registeredClass.constructor_body=[]),re.registeredClass.constructor_body[V-1]!==void 0)throw new Ar("Cannot register multiple constructors with identical number of parameters ("+(V-1)+") for class '"+re.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return re.registeredClass.constructor_body[V-1]=()=>{Zn("Cannot construct "+re.name+" due to unbound types",te)},Ri([],te,function(de){return de.splice(1,0,null),re.registeredClass.constructor_body[V-1]=sr(se,de,null,A,K),[]}),[]})}function xa(L,V,_,M,A,K,te,re){var se=Qn(_,M);V=Rn(V),K=xn(A,K),Ri([],[L],function(de){de=de[0];var we=de.name+"."+V;V.startsWith("@@")&&(V=Symbol[V.substring(2)]),re&&de.registeredClass.pureVirtualFunctions.push(V);function Ie(){Zn("Cannot call "+we+" due to unbound types",se)}var Xe=de.registeredClass.instancePrototype,at=Xe[V];return at===void 0||at.overloadTable===void 0&&at.className!==de.name&&at.argCount===_-2?(Ie.argCount=_-2,Ie.className=de.name,Xe[V]=Ie):(ai(Xe,V,we),Xe[V].overloadTable[_-2]=Ie),Ri([],se,function(nt){var Rt=sr(we,nt,de,K,te);return Xe[V].overloadTable===void 0?(Rt.argCount=_-2,Xe[V]=Rt):Xe[V].overloadTable[_-2]=Rt,[]}),[]})}var $i=[],Yr=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function cr(L){L>4&&--Yr[L].refcount===0&&(Yr[L]=void 0,$i.push(L))}function ia(){for(var L=0,V=5;V<Yr.length;++V)Yr[V]!==void 0&&++L;return L}function lo(){for(var L=5;L<Yr.length;++L)if(Yr[L]!==void 0)return Yr[L];return null}function Ea(){a.count_emval_handles=ia,a.get_first_emval=lo}var Ga={toValue:L=>(L||vt("Cannot use deleted val. handle = "+L),Yr[L].value),toHandle:L=>{switch(L){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var V=$i.length?$i.pop():Yr.length;return Yr[V]={refcount:1,value:L},V}}}};function uo(L,V){V=Rn(V),ar(L,{name:V,fromWireType:function(_){var M=Ga.toValue(_);return cr(_),M},toWireType:function(_,M){return Ga.toHandle(M)},argPackAdvance:8,readValueFromPointer:yr,destructorFunction:null})}function Ba(L){if(L===null)return"null";var V=typeof L;return V==="object"||V==="array"||V==="function"?L.toString():""+L}function $a(L,V){switch(V){case 2:return function(_){return this.fromWireType(fe[_>>2])};case 3:return function(_){return this.fromWireType(ue[_>>3])};default:throw new TypeError("Unknown float type: "+L)}}function fo(L,V,_){var M=Oi(_);V=Rn(V),ar(L,{name:V,fromWireType:function(A){return A},toWireType:function(A,K){return K},argPackAdvance:8,readValueFromPointer:$a(V,M),destructorFunction:null})}function os(L,V,_,M,A,K){var te=Qn(V,_);L=Rn(L),A=xn(M,A),wr(L,function(){Zn("Cannot call "+L+" due to unbound types",te)},V-1),Ri([],te,function(re){var se=[re[0],null].concat(re.slice(1));return pi(L,sr(L,se,null,A,K),V-1),[]})}function Zs(L,V,_){switch(V){case 0:return _?function(A){return X[A]}:function(A){return ie[A]};case 1:return _?function(A){return ye[A>>1]}:function(A){return ge[A>>1]};case 2:return _?function(A){return W[A>>2]}:function(A){return ae[A>>2]};default:throw new TypeError("Unknown integer type: "+L)}}function Qs(L,V,_,M,A){V=Rn(V);var K=Oi(_),te=Ie=>Ie;if(M===0){var re=32-8*_;te=Ie=>Ie<<re>>>re}var se=V.includes("unsigned"),de=(Ie,Xe)=>{},we;se?we=function(Ie,Xe){return de(Xe,this.name),Xe>>>0}:we=function(Ie,Xe){return de(Xe,this.name),Xe},ar(L,{name:V,fromWireType:te,toWireType:we,argPackAdvance:8,readValueFromPointer:Zs(V,K,M!==0),destructorFunction:null})}function Js(L,V,_){var M=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],A=M[V];function K(te){te=te>>2;var re=ae,se=re[te],de=re[te+1];return new A(le,de,se)}_=Rn(_),ar(L,{name:_,fromWireType:K,argPackAdvance:8,readValueFromPointer:K},{ignoreDuplicateRegistrations:!0})}function Go(L,V){V=Rn(V);var _=V==="std::string";ar(L,{name:V,fromWireType:function(M){var A=ae[M>>2],K=M+4,te;if(_)for(var re=K,se=0;se<=A;++se){var de=K+se;if(se==A||ie[de]==0){var we=de-re,Ie=$(re,we);te===void 0?te=Ie:(te+="\0",te+=Ie),re=de+1}}else{for(var Xe=new Array(A),se=0;se<A;++se)Xe[se]=String.fromCharCode(ie[K+se]);te=Xe.join("")}return ne(M),te},toWireType:function(M,A){A instanceof ArrayBuffer&&(A=new Uint8Array(A));var K,te=typeof A=="string";te||A instanceof Uint8Array||A instanceof Uint8ClampedArray||A instanceof Int8Array||vt("Cannot pass non-string to std::string"),_&&te?K=Q(A):K=A.length;var re=B(4+K+1),se=re+4;if(ae[re>>2]=K,_&&te)oe(A,se,K+1);else if(te)for(var de=0;de<K;++de){var we=A.charCodeAt(de);we>255&&(ne(se),vt("String has UTF-16 code units that do not fit in 8 bits")),ie[se+de]=we}else for(var de=0;de<K;++de)ie[se+de]=A[de];return M!==null&&M.push(ne,re),re},argPackAdvance:8,readValueFromPointer:yr,destructorFunction:function(M){ne(M)}})}var ss=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function ec(L,V){for(var _=L,M=_>>1,A=M+V/2;!(M>=A)&&ge[M];)++M;if(_=M<<1,_-L>32&&ss)return ss.decode(ie.subarray(L,_));for(var K="",te=0;!(te>=V/2);++te){var re=ye[L+te*2>>1];if(re==0)break;K+=String.fromCharCode(re)}return K}function cs(L,V,_){if(_===void 0&&(_=2147483647),_<2)return 0;_-=2;for(var M=V,A=_<L.length*2?_/2:L.length,K=0;K<A;++K){var te=L.charCodeAt(K);ye[V>>1]=te,V+=2}return ye[V>>1]=0,V-M}function ls(L){return L.length*2}function tc(L,V){for(var _=0,M="";!(_>=V/4);){var A=W[L+_*4>>2];if(A==0)break;if(++_,A>=65536){var K=A-65536;M+=String.fromCharCode(55296|K>>10,56320|K&1023)}else M+=String.fromCharCode(A)}return M}function go(L,V,_){if(_===void 0&&(_=2147483647),_<4)return 0;for(var M=V,A=M+_-4,K=0;K<L.length;++K){var te=L.charCodeAt(K);if(te>=55296&&te<=57343){var re=L.charCodeAt(++K);te=65536+((te&1023)<<10)|re&1023}if(W[V>>2]=te,V+=4,V+4>A)break}return W[V>>2]=0,V-M}function us(L){for(var V=0,_=0;_<L.length;++_){var M=L.charCodeAt(_);M>=55296&&M<=57343&&++_,V+=4}return V}function fs(L,V,_){_=Rn(_);var M,A,K,te,re;V===2?(M=ec,A=cs,te=ls,K=()=>ge,re=1):V===4&&(M=tc,A=go,te=us,K=()=>ae,re=2),ar(L,{name:_,fromWireType:function(se){for(var de=ae[se>>2],we=K(),Ie,Xe=se+4,at=0;at<=de;++at){var nt=se+4+at*V;if(at==de||we[nt>>re]==0){var Rt=nt-Xe,_t=M(Xe,Rt);Ie===void 0?Ie=_t:(Ie+="\0",Ie+=_t),Xe=nt+V}}return ne(se),Ie},toWireType:function(se,de){typeof de!="string"&&vt("Cannot pass non-string to C++ string type "+_);var we=te(de),Ie=B(4+we+V);return ae[Ie>>2]=we>>re,A(de,Ie+4,we+V),se!==null&&se.push(ne,Ie),Ie},argPackAdvance:8,readValueFromPointer:yr,destructorFunction:function(se){ne(se)}})}function Bo(L,V,_,M,A,K){Ir[L]={name:Rn(V),rawConstructor:xn(_,M),rawDestructor:xn(A,K),fields:[]}}function nc(L,V,_,M,A,K,te,re,se,de){Ir[L].fields.push({fieldName:Rn(V),getterReturnType:_,getter:xn(M,A),getterContext:K,setterArgumentType:te,setter:xn(re,se),setterContext:de})}function ho(L,V){V=Rn(V),ar(L,{isVoid:!0,name:V,argPackAdvance:0,fromWireType:function(){},toWireType:function(_,M){}})}function rc(L){L>4&&(Yr[L].refcount+=1)}function gs(L,V){var _=Ei[L];return _===void 0&&vt(V+" has unknown type "+En(L)),_}function ic(L,V){L=gs(L,"_emval_take_value");var _=L.readValueFromPointer(V);return Ga.toHandle(_)}function ds(){nr("")}function ac(L,V,_){ie.copyWithin(L,V,V+_)}function oc(){return 2147483648}function $o(L){try{return b.grow(L-le.byteLength+65535>>>16),qe(b.buffer),1}catch{}}function Wo(L){var V=ie.length;L=L>>>0;var _=oc();if(L>_)return!1;let M=(se,de)=>se+(de-se%de)%de;for(var A=1;A<=4;A*=2){var K=V*(1+.2/A);K=Math.min(K,L+100663296);var te=Math.min(_,M(Math.max(L,K),65536)),re=$o(te);if(re)return!0}return!1}function aa(L){return 52}function Ra(L,V,_,M,A){return 70}var Li=[null,[],[]];function hs(L,V){var _=Li[L];V===0||V===10?((L===1?x:R)(F(_,0)),_.length=0):_.push(V)}function ps(L,V,_,M){for(var A=0,K=0;K<_;K++){var te=ae[V>>2],re=ae[V+4>>2];V+=8;for(var se=0;se<re;se++)hs(L,ie[te+se]);A+=re}return ae[M>>2]=A,0}function Wa(L){return L}function Oa(L){var V=a["_"+L];return V}function po(L,V){X.set(L,V)}function zo(L,V,_,M,A){var K={string:nt=>{var Rt=0;if(nt!=null&&nt!==0){var _t=(nt.length<<2)+1;Rt=ke(_t),oe(nt,Rt,_t)}return Rt},array:nt=>{var Rt=ke(nt.length);return po(nt,Rt),Rt}};function te(nt){return V==="string"?$(nt):V==="boolean"?!!nt:nt}var re=Oa(L),se=[],de=0;if(M)for(var we=0;we<M.length;we++){var Ie=K[_[we]];Ie?(de===0&&(de=Fe()),se[we]=Ie(M[we])):se[we]=M[we]}var Xe=re.apply(null,se);function at(nt){return de!==0&&Me(de),te(nt)}return Xe=at(Xe),Xe}Dt=a.InternalError=Et(Error,"InternalError"),gi(),Ar=a.BindingError=Et(Error,"BindingError"),ii(),Po(),Bi(),bi=a.UnboundTypeError=Et(Error,"UnboundTypeError"),Ea();var k={__assert_fail:xt,__cxa_begin_catch:mr,__cxa_end_catch:ze,__cxa_find_matching_catch_2:Wr,__cxa_find_matching_catch_3:vr,__cxa_throw:rr,__resumeException:qt,_embind_finalize_value_object:io,_embind_register_bigint:ki,_embind_register_bool:ao,_embind_register_class:wa,_embind_register_class_constructor:Mi,_embind_register_class_function:xa,_embind_register_emval:uo,_embind_register_float:fo,_embind_register_function:os,_embind_register_integer:Qs,_embind_register_memory_view:Js,_embind_register_std_string:Go,_embind_register_std_wstring:fs,_embind_register_value_object:Bo,_embind_register_value_object_field:nc,_embind_register_void:ho,_emval_decref:cr,_emval_incref:rc,_emval_take_value:ic,abort:ds,emscripten_memcpy_big:ac,emscripten_resize_heap:Wo,fd_close:aa,fd_seek:Ra,fd_write:ps,invoke_i:pe,invoke_ii:dt,invoke_iii:Be,invoke_iiii:ee,invoke_v:N,invoke_vi:St,invoke_viiii:P,invoke_viiiiii:Oe,llvm_eh_typeid_for:Wa};Pe(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.__wasm_call_ctors).apply(null,arguments)};var B=a._malloc=function(){return(B=a._malloc=a.asm.malloc).apply(null,arguments)},ne=a._free=function(){return(ne=a._free=a.asm.free).apply(null,arguments)},Se=a.___cxa_free_exception=function(){return(Se=a.___cxa_free_exception=a.asm.__cxa_free_exception).apply(null,arguments)},_e=a.___getTypeName=function(){return(_e=a.___getTypeName=a.asm.__getTypeName).apply(null,arguments)};a.__embind_initialize_bindings=function(){return(a.__embind_initialize_bindings=a.asm._embind_initialize_bindings).apply(null,arguments)},a.___errno_location=function(){return(a.___errno_location=a.asm.__errno_location).apply(null,arguments)};var Ue=a.setTempRet0=function(){return(Ue=a.setTempRet0=a.asm.setTempRet0).apply(null,arguments)},Fe=a.stackSave=function(){return(Fe=a.stackSave=a.asm.stackSave).apply(null,arguments)},Me=a.stackRestore=function(){return(Me=a.stackRestore=a.asm.stackRestore).apply(null,arguments)},ke=a.stackAlloc=function(){return(ke=a.stackAlloc=a.asm.stackAlloc).apply(null,arguments)},Qe=a.___cxa_can_catch=function(){return(Qe=a.___cxa_can_catch=a.asm.__cxa_can_catch).apply(null,arguments)},ct=a.___cxa_is_pointer_type=function(){return(ct=a.___cxa_is_pointer_type=a.asm.__cxa_is_pointer_type).apply(null,arguments)};a.dynCall_ji=function(){return(a.dynCall_ji=a.asm.dynCall_ji).apply(null,arguments)},a.dynCall_iiji=function(){return(a.dynCall_iiji=a.asm.dynCall_iiji).apply(null,arguments)},a.dynCall_jiji=function(){return(a.dynCall_jiji=a.asm.dynCall_jiji).apply(null,arguments)};function dt(L,V){var _=Fe();try{return Ht(L)(V)}catch(M){if(Me(_),M!==M+0)throw M;_setThrew(1,0)}}function St(L,V){var _=Fe();try{Ht(L)(V)}catch(M){if(Me(_),M!==M+0)throw M;_setThrew(1,0)}}function P(L,V,_,M,A){var K=Fe();try{Ht(L)(V,_,M,A)}catch(te){if(Me(K),te!==te+0)throw te;_setThrew(1,0)}}function N(L){var V=Fe();try{Ht(L)()}catch(_){if(Me(V),_!==_+0)throw _;_setThrew(1,0)}}function ee(L,V,_,M){var A=Fe();try{return Ht(L)(V,_,M)}catch(K){if(Me(A),K!==K+0)throw K;_setThrew(1,0)}}function pe(L){var V=Fe();try{return Ht(L)()}catch(_){if(Me(V),_!==_+0)throw _;_setThrew(1,0)}}function Oe(L,V,_,M,A,K,te){var re=Fe();try{Ht(L)(V,_,M,A,K,te)}catch(se){if(Me(re),se!==se+0)throw se;_setThrew(1,0)}}function Be(L,V,_){var M=Fe();try{return Ht(L)(V,_)}catch(A){if(Me(M),A!==A+0)throw A;_setThrew(1,0)}}a.ccall=zo;var Ne;Nn=function L(){Ne||Ve(),Ne||(Nn=L)};function Ve(L){if(Mn>0||(st(),Mn>0))return;function V(){Ne||(Ne=!0,a.calledRun=!0,!I&&(Bt(),o(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),pr()))}a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),V()},1)):V()}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return Ve(),a.ready}})();t.exports=n}(K3)),K3.exports}var Oee=Ree();const Dee=$s(Oee),_ee=new URL("/dicom-reader/assets/openjphjs-C-BUUy4a.wasm",import.meta.url),zg={codec:void 0,decoder:void 0,decodeConfig:{}};function bee(t,e,n){const r={width:e,height:n};for(;t>0;)r.width=Math.ceil(r.width/2),r.height=Math.ceil(r.height/2),t--;return r}function Mee(t){if(zg.decodeConfig=t,zg.codec)return Promise.resolve();const e=Dee({locateFile:n=>n.endsWith(".wasm")?_ee.toString():n});return new Promise((n,r)=>{e.then(i=>{zg.codec=i,zg.decoder=new i.HTJ2KDecoder,n()},r)})}async function Lee(t,e){await Mee();const n=new zg.codec.HTJ2KDecoder,r=n.getEncodedBuffer(t.length);r.set(t);const i=e.decodeLevel||0;n.decodeSubResolution(i);const a=n.getFrameInfo();if(e.decodeLevel>0){const{width:j,height:F}=bee(e.decodeLevel,a.width,a.height);a.width=j,a.height=F}const o=n.getDecodedBuffer();new Uint8Array(o.length).set(o);const c=`x: ${n.getImageOffset().x}, y: ${n.getImageOffset().y}`,u=n.getNumDecompositions(),d=n.getNumLayers(),g=["unknown","LRCP","RLCP","RPCL","PCRL","CPRL"][n.getProgressionOrder()+1],h=n.getIsReversible(),m=`${n.getBlockDimensions().width} x ${n.getBlockDimensions().height}`,y=`${n.getTileSize().width} x ${n.getTileSize().height}`,v=`${n.getTileOffset().x}, ${n.getTileOffset().y}`,C=`${o.length.toLocaleString()} bytes`,S=`${(o.length/r.length).toFixed(2)}:1`,w={columns:a.width,rows:a.height,bitsPerPixel:a.bitsPerSample,signed:a.isSigned,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:a.componentCount};let x=Vee(a,o);const{buffer:R,byteOffset:O,byteLength:b}=x,I=R.slice(O,O+b);x=new x.constructor(I);const G={imageOffset:c,numDecompositions:u,numLayers:d,progessionOrder:g,reversible:h,blockDimensions:m,tileSize:y,tileOffset:v,decodedSize:C,compressionRatio:S};return{...e,pixelData:x,imageInfo:w,encodeOptions:G,...G,...w}}function Vee(t,e){return t.bitsPerSample>8?t.isSigned?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function Iee(t,e){const n=t.length,{rescaleSlope:r,rescaleIntercept:i,suvbw:a,doseGridScaling:o}=e;if(e.modality==="PT"&&typeof a=="number"&&!isNaN(a))for(let s=0;s<n;s++)t[s]=a*(t[s]*r+i);else if(e.modality==="RTDOSE"&&typeof o=="number"&&!isNaN(o))for(let s=0;s<n;s++)t[s]=t[s]*o;else for(let s=0;s<n;s++)t[s]=t[s]*r+i;return!0}const Aee={bilinear:jJ,replicate:qJ},xS={Uint8Array,Uint16Array,Int16Array,Float32Array,Uint32Array};function Nee(t,e,n,r){const i=t.pixelRepresentation!==void 0&&t.pixelRepresentation===1,a=i&&t.bitsStored!==void 0?32-t.bitsStored:void 0;if(i&&a!==void 0)for(let w=0;w<t.pixelData.length;w++)t.pixelData[w]=t.pixelData[w]<<a>>a;let o=t.pixelData;t.pixelDataLength=t.pixelData.length;const{min:s,max:c}=K8(t.pixelData),u=typeof e.allowFloatRendering<"u"?e.allowFloatRendering:!0;let d=P_(t.photometricInterpretation)&&e.targetBuffer?.offset===void 0;const h=e.preScale?.enabled&&Object.values(e.preScale.scalingParameters).some(w=>typeof w=="number"&&!Number.isInteger(w)),m=!e.preScale.enabled||!u&&h,y=e.targetBuffer?.type;if(y&&e.preScale.enabled&&!m){const w=e.preScale.scalingParameters,x=tv(s,c,w);d=!uJ(x.min,x.max,xS[y])}y&&!d?o=Uee(e,t,xS,o):e.preScale.enabled&&!m?o=Fee(e,s,c,t):o=j_(s,c,t);let v=s,C=c;if(e.preScale.enabled&&!m){const w=e.preScale.scalingParameters;if(q_(w),Pee(w)){Iee(o,w),t.preScale={...e.preScale,scaled:!0};const R=tv(s,c,w);v=R.min,C=R.max}}else m&&(t.preScale={enabled:!0,scaled:!1},v=s,C=c);t.pixelData=o,t.smallestPixelValue=v,t.largestPixelValue=C;const S=new Date().getTime();return t.decodeTimeInMS=S-n,t}function Pee(t){const{rescaleSlope:e,rescaleIntercept:n,modality:r,doseGridScaling:i,suvbw:a}=t;return typeof e=="number"&&typeof n=="number"||r==="RTDOSE"&&typeof i=="number"||r==="PT"&&typeof a=="number"}function Uee(t,e,n,r){const{arrayBuffer:i,type:a,offset:o=0,length:s,rows:c}=t.targetBuffer,u=n[a];if(!u)throw new Error(`target array ${a} is not supported, or doesn't exist.`);c&&c!=e.rows&&Gee(e,t.targetBuffer,u);const d=e.pixelDataLength,g=o,h=s??d-g,m=e.pixelData;if(h!==m.length)throw new Error(`target array for image does not have the same length (${h}) as the decoded image length (${m.length}).`);const y=i?new u(i,g,h):new u(h);return y.set(m,0),r=y,r}function Fee(t,e,n,r){const i=t.preScale.scalingParameters;q_(i);const a=tv(e,n,i);return j_(a.min,a.max,r)}function j_(t,e,n){const r=Y8(t,e),i=new r(n.pixelData.length);return i.set(n.pixelData,0),i}function tv(t,e,n){const{rescaleSlope:r,rescaleIntercept:i,modality:a,doseGridScaling:o,suvbw:s}=n;return a==="PT"&&typeof s=="number"&&!isNaN(s)?{min:s*(t*r+i),max:s*(e*r+i)}:a==="RTDOSE"&&typeof o=="number"&&!isNaN(o)?{min:t*o,max:e*o}:typeof r=="number"&&typeof i=="number"?{min:r*t+i,max:r*e+i}:{min:t,max:e}}function q_(t){if(!t)throw new Error("options.preScale.scalingParameters must be defined if preScale.enabled is true, and scalingParameters cannot be derived from the metadata providers.")}function kee(t,e,n){const{samplesPerPixel:r}=t,{rows:i,columns:a}=e,o=i*a*r,s=new n(o),c=s.byteLength/o;return{pixelData:s,rows:i,columns:a,frameInfo:{...t.frameInfo,rows:i,columns:a},imageInfo:{...t.imageInfo,rows:i,columns:a,bytesPerPixel:c}}}function Gee(t,e,n){const r=kee(t,e,n),{scalingType:i="replicate"}=e;return Aee[i](t,r),Object.assign(t,r),t.pixelDataLength=t.pixelData.length,t}async function Bee(t,e,n,r,i,a){const o=new Date().getTime();let s=null,c;switch(e){case"1.2.840.10008.1.2":case"1.2.840.10008.1.2.1":s=hS(t,n);break;case"1.2.840.10008.1.2.2":s=YJ(t,n);break;case"1.2.840.10008.1.2.1.99":s=hS(t,n);break;case"1.2.840.10008.1.2.5":s=XJ(t,n);break;case"1.2.840.10008.1.2.4.50":c={...t},s=aee(n,c);break;case"1.2.840.10008.1.2.4.51":s=uee(t,n);break;case"1.2.840.10008.1.2.4.57":s=vS(t,n);break;case"1.2.840.10008.1.2.4.70":s=vS(t,n);break;case"1.2.840.10008.1.2.4.80":c={signed:t.pixelRepresentation===1,bytesPerPixel:t.bitsAllocated<=8?1:2,...t},s=TS(n,c);break;case"1.2.840.10008.1.2.4.81":c={signed:t.pixelRepresentation===1,bytesPerPixel:t.bitsAllocated<=8?1:2,...t},s=TS(n,c);break;case"1.2.840.10008.1.2.4.90":c={...t},s=SS(n,c);break;case"1.2.840.10008.1.2.4.91":c={...t},s=SS(n,c);break;case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":c={...t},s=Lee(n,c);break;default:throw new Error(`no decoder for transfer syntax ${e}`)}if(!s)throw new Error("decodePromise not defined");const u=await s,d=Nee(u,i,o);return a?.(d),d}const $ee={decodeTask({imageFrame:t,transferSyntax:e,decodeConfig:n,options:r,pixelData:i,callbackFn:a}){return Bee(t,e,i,n,r,a)}};Cv($ee);var zc;(function(t){t[t.Primary=1]="Primary",t[t.Secondary=2]="Secondary",t[t.Primary_And_Secondary=3]="Primary_And_Secondary",t[t.Auxiliary=4]="Auxiliary",t[t.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",t[t.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",t[t.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",t[t.Fourth_Button=8]="Fourth_Button",t[t.Fifth_Button=16]="Fifth_Button",t[t.Wheel=524288]="Wheel",t[t.Wheel_Primary=524289]="Wheel_Primary"})(zc||(zc={}));var Qa;(function(t){t[t.Shift=16]="Shift",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.Meta=91]="Meta",t[t.ShiftCtrl=1617]="ShiftCtrl",t[t.ShiftAlt=1618]="ShiftAlt",t[t.ShiftMeta=1691]="ShiftMeta",t[t.CtrlAlt=1718]="CtrlAlt",t[t.CtrlMeta=1791]="CtrlMeta",t[t.AltMeta=1891]="AltMeta"})(Qa||(Qa={}));var Kn;(function(t){t.Active="Active",t.Passive="Passive",t.Enabled="Enabled",t.Disabled="Disabled"})(Kn||(Kn={}));var A0;(function(t){t.Default="",t.Highlighted="Highlighted",t.Selected="Selected",t.Locked="Locked",t.AutoGenerated="AutoGenerated"})(A0||(A0={}));var Le;(function(t){t.TOOL_ACTIVATED="CORNERSTONE_TOOLS_TOOL_ACTIVATED",t.TOOLGROUP_VIEWPORT_ADDED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_ADDED",t.TOOLGROUP_VIEWPORT_REMOVED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_REMOVED",t.TOOL_MODE_CHANGED="CORNERSTONE_TOOLS_TOOL_MODE_CHANGED",t.CROSSHAIR_TOOL_CENTER_CHANGED="CORNERSTONE_TOOLS_CROSSHAIR_TOOL_CENTER_CHANGED",t.VOLUMECROPPINGCONTROL_TOOL_CHANGED="CORNERSTONE_TOOLS_VOLUMECROPPINGCONTROL_TOOL_CHANGED",t.VOLUMECROPPING_TOOL_CHANGED="CORNERSTONE_TOOLS_VOLUMECROPPING_TOOL_CHANGED",t.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",t.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",t.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",t.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",t.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",t.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",t.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",t.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",t.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_CUT_MERGE_PROCESS_COMPLETED",t.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_INTERPOLATION_PROCESS_COMPLETED",t.INTERPOLATED_ANNOTATIONS_REMOVED="CORNERSTONE_TOOLS_INTERPOLATED_ANNOTATIONS_REMOVED",t.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",t.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",t.SEGMENTATION_REPRESENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_ADDED",t.SEGMENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_ADDED",t.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",t.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",t.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",t.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",t.HISTORY_UNDO="CORNERSTONE_TOOLS_HISTORY_UNDO",t.HISTORY_REDO="CORNERSTONE_TOOLS_HISTORY_REDO",t.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",t.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",t.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",t.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",t.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",t.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",t.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",t.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",t.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",t.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",t.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",t.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",t.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",t.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",t.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",t.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",t.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE"})(Le||(Le={}));var At;(function(t){t.Labelmap="Labelmap",t.Contour="Contour",t.Surface="Surface"})(At||(At={}));var Wu;(function(t){t.UP="UP",t.DOWN="DOWN",t.LEFT="LEFT",t.RIGHT="RIGHT"})(Wu||(Wu={}));var Bs;(function(t){t.Interaction="Interaction",t.HandlesUpdated="HandlesUpdated",t.StatsUpdated="StatsUpdated",t.InitialSetup="InitialSetup",t.Completed="Completed",t.InterpolationUpdated="InterpolationUpdated",t.History="History",t.MetadataReferenceModified="MetadataReferenceModified",t.LabelChange="LabelChange"})(Bs||(Bs={}));let Wee={},ht={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:Wee,enabledElements:[]};var Y3,ES;function zee(){if(ES)return Y3;ES=1;var t="Expected a function",e="__lodash_hash_undefined__",n="[object Function]",r="[object GeneratorFunction]",i="[object Symbol]",a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/,s=/^\./,c=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,u=/[\\^$.*+?()[\]{}|]/g,d=/\\(\\)?/g,g=/^\[object .+?Constructor\]$/,h=typeof Lc=="object"&&Lc&&Lc.Object===Object&&Lc,m=typeof self=="object"&&self&&self.Object===Object&&self,y=h||m||Function("return this")();function v(Ee,ze){return Ee?.[ze]}function C(Ee){var ze=!1;if(Ee!=null&&typeof Ee.toString!="function")try{ze=!!(Ee+"")}catch{}return ze}var S=Array.prototype,w=Function.prototype,x=Object.prototype,R=y["__core-js_shared__"],O=function(){var Ee=/[^.]+$/.exec(R&&R.keys&&R.keys.IE_PROTO||"");return Ee?"Symbol(src)_1."+Ee:""}(),b=w.toString,I=x.hasOwnProperty,G=x.toString,j=RegExp("^"+b.call(I).replace(u,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),F=y.Symbol,$=S.splice,z=Vr(y,"Map"),oe=Vr(Object,"create"),Q=F?F.prototype:void 0,le=Q?Q.toString:void 0;function X(Ee){var ze=-1,ut=Ee?Ee.length:0;for(this.clear();++ze<ut;){var qt=Ee[ze];this.set(qt[0],qt[1])}}function ie(){this.__data__=oe?oe(null):{}}function ye(Ee){return this.has(Ee)&&delete this.__data__[Ee]}function ge(Ee){var ze=this.__data__;if(oe){var ut=ze[Ee];return ut===e?void 0:ut}return I.call(ze,Ee)?ze[Ee]:void 0}function W(Ee){var ze=this.__data__;return oe?ze[Ee]!==void 0:I.call(ze,Ee)}function ae(Ee,ze){var ut=this.__data__;return ut[Ee]=oe&&ze===void 0?e:ze,this}X.prototype.clear=ie,X.prototype.delete=ye,X.prototype.get=ge,X.prototype.has=W,X.prototype.set=ae;function fe(Ee){var ze=-1,ut=Ee?Ee.length:0;for(this.clear();++ze<ut;){var qt=Ee[ze];this.set(qt[0],qt[1])}}function ue(){this.__data__=[]}function qe(Ee){var ze=this.__data__,ut=Gn(ze,Ee);if(ut<0)return!1;var qt=ze.length-1;return ut==qt?ze.pop():$.call(ze,ut,1),!0}function et(Ee){var ze=this.__data__,ut=Gn(ze,Ee);return ut<0?void 0:ze[ut][1]}function Ze(Ee){return Gn(this.__data__,Ee)>-1}function yt(Ee,ze){var ut=this.__data__,qt=Gn(ut,Ee);return qt<0?ut.push([Ee,ze]):ut[qt][1]=ze,this}fe.prototype.clear=ue,fe.prototype.delete=qe,fe.prototype.get=et,fe.prototype.has=Ze,fe.prototype.set=yt;function tt(Ee){var ze=-1,ut=Ee?Ee.length:0;for(this.clear();++ze<ut;){var qt=Ee[ze];this.set(qt[0],qt[1])}}function st(){this.__data__={hash:new X,map:new(z||fe),string:new X}}function Bt(Ee){return nr(this,Ee).delete(Ee)}function pr(Ee){return nr(this,Ee).get(Ee)}function Lr(Ee){return nr(this,Ee).has(Ee)}function bn(Ee,ze){return nr(this,Ee).set(Ee,ze),this}tt.prototype.clear=st,tt.prototype.delete=Bt,tt.prototype.get=pr,tt.prototype.has=Lr,tt.prototype.set=bn;function Gn(Ee,ze){for(var ut=Ee.length;ut--;)if(Ct(Ee[ut][0],ze))return ut;return-1}function Mn(Ee,ze){ze=Y(ze,Ee)?[ze]:Bn(ze);for(var ut=0,qt=ze.length;Ee!=null&&ut<qt;)Ee=Ee[ve(ze[ut++])];return ut&&ut==qt?Ee:void 0}function Nn(Ee){if(!sn(Ee)||he(Ee))return!1;var ze=wn(Ee)||C(Ee)?j:g;return ze.test(Pe(Ee))}function un(Ee){if(typeof Ee=="string")return Ee;if(Ut(Ee))return le?le.call(Ee):"";var ze=Ee+"";return ze=="0"&&1/Ee==-1/0?"-0":ze}function Bn(Ee){return xt(Ee)?Ee:Z(Ee)}function nr(Ee,ze){var ut=Ee.__data__;return J(ze)?ut[typeof ze=="string"?"string":"hash"]:ut.map}function Vr(Ee,ze){var ut=v(Ee,ze);return Nn(ut)?ut:void 0}function Y(Ee,ze){if(xt(Ee))return!1;var ut=typeof Ee;return ut=="number"||ut=="symbol"||ut=="boolean"||Ee==null||Ut(Ee)?!0:o.test(Ee)||!a.test(Ee)||ze!=null&&Ee in Object(ze)}function J(Ee){var ze=typeof Ee;return ze=="string"||ze=="number"||ze=="symbol"||ze=="boolean"?Ee!=="__proto__":Ee===null}function he(Ee){return!!O&&O in Ee}var Z=Je(function(Ee){Ee=Yt(Ee);var ze=[];return s.test(Ee)&&ze.push(""),Ee.replace(c,function(ut,qt,Wr,vr){ze.push(Wr?vr.replace(d,"$1"):qt||ut)}),ze});function ve(Ee){if(typeof Ee=="string"||Ut(Ee))return Ee;var ze=Ee+"";return ze=="0"&&1/Ee==-1/0?"-0":ze}function Pe(Ee){if(Ee!=null){try{return b.call(Ee)}catch{}try{return Ee+""}catch{}}return""}function Je(Ee,ze){if(typeof Ee!="function"||ze&&typeof ze!="function")throw new TypeError(t);var ut=function(){var qt=arguments,Wr=ze?ze.apply(this,qt):qt[0],vr=ut.cache;if(vr.has(Wr))return vr.get(Wr);var rr=Ee.apply(this,qt);return ut.cache=vr.set(Wr,rr),rr};return ut.cache=new(Je.Cache||tt),ut}Je.Cache=tt;function Ct(Ee,ze){return Ee===ze||Ee!==Ee&&ze!==ze}var xt=Array.isArray;function wn(Ee){var ze=sn(Ee)?G.call(Ee):"";return ze==n||ze==r}function sn(Ee){var ze=typeof Ee;return!!Ee&&(ze=="object"||ze=="function")}function mr(Ee){return!!Ee&&typeof Ee=="object"}function Ut(Ee){return typeof Ee=="symbol"||mr(Ee)&&G.call(Ee)==i}function Yt(Ee){return Ee==null?"":un(Ee)}function Ht(Ee,ze,ut){var qt=Ee==null?void 0:Mn(Ee,ze);return qt===void 0?ut:qt}return Y3=Ht,Y3}var Hee=zee();const jee=$s(Hee),RS=Symbol("DefinedCursors"),K_=new Set(["alias","all-scroll","auto","cell","col-resize","context-menu","copy","crosshair","default","e-resize","ew-resize","grab","grabbing","help","move","ne-resize","nesw-resize","no-drop","none","not-allowed","n-resize","ns-resize","nw-resize","nwse-resize","pointer","progress","row-resize","se-resize","s-resize","sw-resize","text","vertical-text","wait","w-resize","zoom-in","zoom-out"]);class eo{constructor(e,n){this.name=e+"",this.fallback=n}getName(){return this.name+""}addFallbackStyleProperty(e){const{fallback:n}=this;return n instanceof eo?`${e}, ${n.getStyleProperty()}`:e+""}getStyleProperty(){return this.addFallbackStyleProperty(this.name)+""}static getDefinedCursor(e){const n=OS(eo,RS);let r=n.get(e);if(r instanceof eo)return r;if(K_.has(e))return r=new eo(e),n.set(e,r),r}static setDefinedCursor(e,n){return n instanceof eo?(OS(eo,RS).set(e,n),!0):!1}}function OS(t,e){let n=t[e];return n instanceof Map||(n=new Map,Object.defineProperty(t,e,{value:n})),n}const qee=K_.values(),Kee="image-cursor";class ep extends eo{constructor(e,n,r,i,a){super(i||ep.getUniqueInstanceName(Kee),a),this.url=e,this.x=Number(n)||0,this.y=Number(r)||0}getStyleProperty(){const{url:e,x:n,y:r}=this;let i=`url('${e}')`;return n>=0&&r>=0&&(n>0||r>0)&&(i+=` ${n} ${r}`),this.addFallbackStyleProperty(i)}static getUniqueInstanceName(e){return`${e}-${h_(ep)}`}}const en={iconContent:"",iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:`
    <path stroke="{{color}}" d="M8 16L8 0"></path>
    <path stroke="{{color}}" d="M16 8L0 8"></path>
  `},Va={x:127,y:60},Vu=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
`,R0=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
<rect fill="{{color}}" x="95.84" y="9.38" width="15.85" height="47.14"/>
`,Eh='<path fill="{{color}}" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',Iu='<path fill="{{color}}" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',Rh='<path fill="{{color}}" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',Y_={Angle:tn(en,{name:"Angle",iconContent:`<path fill="{{color}}" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50
    50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23
    10l50 50q10 10 10 23z" />`,viewBox:{x:1792,y:1792}}),ArrowAnnotate:tn(en,{name:"ArrowAnnotate",iconContent:`<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />
  </g>`,viewBox:{x:24,y:24}}),Bidirectional:tn(en,{name:"Bidirectional",iconContent:`<g fill="{{color}}" stroke-width="3" stroke="{{color}}">
    <path d="M27.63 3.21L3.12 28.81"></path>
    <path d="M27.63 15.75L15.27 4.43"></path>
    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>
    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>
    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>
    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>
  </g>`,viewBox:{x:48,y:48}}),CobbAngle:tn(en,{name:"CobbAngle",iconContent:`<g stroke="{{color}}" stroke-width="3">
    <path d="M28.59 2.34L3.82 12.32"></path>
    <path d="M28.59 29.66L3.82 19.68"></path>
    <path stroke-dasharray="2" fill-opacity="0" d="M12.37
      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15
      9.33C13.11 9.24 13.02 9 12.88 8.63">
    </path>
  </g>`,viewBox:{x:32,y:32}}),CircleROI:tn(en,{name:"CircleROI",iconContent:'<circle stroke="{{color}}" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',viewBox:{x:32,y:32}}),EllipticalROI:tn(en,{name:"EllipticalROI",iconContent:`<path stroke="{{color}}" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16
    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14
    6.3 30.74 10.54 30.74 15.76Z" />`,viewBox:{x:32,y:32}}),FreehandROI:tn(en,{name:"FreehandROI",iconContent:`<g fill="{{color}}" stroke="{{color}}" stroke-width="2">
    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>
    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>
    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>
    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>
    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>
    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>
    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>
    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>
    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>
    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>
    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>
    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>
    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>
    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>
    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>
    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>
    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>
    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>
    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>
    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>
    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>
    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>
    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>
    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>
    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>
    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>
    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>
    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>
    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>
    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>
  </g>`,viewBox:{x:18,y:18}}),FreehandROISculptor:tn(en,{name:"FreehandROISculptor",iconContent:`<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>
    <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>
    <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>
    <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>
    <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>
    <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>
    <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>
    <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>
    <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>
    <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>
    <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>
    <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>
    <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>
    <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>
    <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>
    <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>
    <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>
    <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>
    <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>
    <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>
    <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>
    <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>
    <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>
    <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>
    <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>
    <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>
    <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>
    <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>
    <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>
    <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>
    <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>
    <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>
  </g>`,viewBox:{x:18,y:18}}),Length:tn(en,{name:"Length",iconContent:`<g id="length-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />
  </g>`,viewBox:{x:24,y:24}}),Height:tn(en,{name:"Height",iconContent:'<path d="m 6 22 l 8.5 0 v -16 h 8" stroke-width="3" fill="none" stroke="{{color}}" />',viewBox:{x:24,y:24}}),Probe:tn(en,{name:"Probe",iconContent:`<path fill="{{color}}" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75
    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73
    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5
    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5
    385.5-103 385.5 103 279.5 279.5 103 385.5z" />`,viewBox:{x:1792,y:1792}}),RectangleROI:tn(en,{name:"RectangleROI",iconContent:`<path fill="{{color}}" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47
    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0
    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119
    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),Label:tn(en,{name:"Label",iconContent:`<path fill="{{color}}" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0
    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29
    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15
    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5
    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0
    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11
    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0
    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58
    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z" />`,viewBox:{x:1792,y:1792}}),Crosshairs:tn(en,{name:"Crosshairs",iconContent:`<path fill="{{color}}" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26
    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45
    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26
    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5
    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32
    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5
    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26
    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26
    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161
    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161
    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z" />`,viewBox:{x:1792,y:1792}}),Eraser:tn(en,{name:"Eraser",iconContent:`<path transform="translate(0,1792) scale(1,-1)" fill="{{color}}" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15
    34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38
    0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38
    0 69.5 20.5t47.5 54.5z" />`,viewBox:{x:2048,y:1792}}),Magnify:tn(en,{name:"Magnify",iconContent:`<path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />`,viewBox:{x:512,y:512}}),Pan:tn(en,{name:"Pan",iconContent:`<path fill="{{color}}" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17
    39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355
    355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59
    39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12
    0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144
    144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19
    45v448q0 42-39 59-13 5-25 5-26 0-45-19z" />`,viewBox:{x:1792,y:1792}}),Rotate:tn(en,{name:"Rotate",iconContent:`<path fill="{{color}}" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39
    14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5
    163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0
    225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109
    132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298
    164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14
    39 17 39 59z" />`,viewBox:{x:1792,y:1792}}),StackScroll:tn(en,{name:"StackScroll",iconContent:`<path fill="{{color}}" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0
    0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547
    0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z" />`,viewBox:{x:24,y:28}}),WindowLevelRegion:tn(en,{name:"WindowLevelRegion",iconContent:`<path fill="{{color}}" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119
    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5
    84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),WindowLevel:tn(en,{name:"WindowLevel",iconContent:`
    <path fill="{{color}}" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />
    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="{{color}}" />`,viewBox:{x:18,y:18}}),Zoom:tn(en,{name:"Zoom",iconContent:`
  <path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />
  <path fill="{{color}}" transform="scale(0.22,0.22) translate(1400,0)" d="M1216
    320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19
    19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26
    0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z" />`,viewBox:{x:640,y:512}}),SegmentationFreeHandEraseInside:tn(en,{name:"SegmentationFreeHandEraseInside",iconContent:`${Eh} ${Vu}`,viewBox:Va}),SegmentationFreeHandFillInside:tn(en,{name:"SegmentationFreeHandFillInside",iconContent:`${Eh} ${R0}`,viewBox:Va}),SegmentationFreeHandEraseOutside:tn(en,{name:"SegmentationFreeHandEraseOutside",iconContent:`${Eh} ${Vu}`,viewBox:Va}),SegmentationFreeHandFillOutside:tn(en,{name:"SegmentationFreeHandFillOutside",iconContent:`${Eh} ${R0}`,viewBox:Va}),SegmentationRectangleEraseInside:tn(en,{name:"SegmentationRectangleEraseInside",iconContent:`${Iu} ${Vu}`,viewBox:Va}),RectangleScissor:tn(en,{name:"RectangleScissor",iconContent:`${Iu} ${R0}`,viewBox:Va}),"RectangleScissor.FILL_INSIDE":tn(en,{name:"RectangleScissor.FILL_INSIDE",iconContent:`${Iu} ${R0}`,viewBox:Va}),"RectangleScissor.FILL_OUTSIDE":tn(en,{name:"RectangleScissor.FILL_OUTSIDE",iconContent:`${Iu} ${R0}`,viewBox:Va}),"RectangleScissor.ERASE_OUTSIDE":tn(en,{name:"RectangleScissor.ERASE_OUTSIDE",iconContent:`${Iu} ${Vu}`,viewBox:Va}),"RectangleScissor.ERASE_INSIDE":tn(en,{name:"RectangleScissor.ERASE_INSIDE",iconContent:`${Iu} ${Vu}`,viewBox:Va}),CircleScissor:tn(en,{name:"CircleScissor",iconContent:`${Rh} ${R0}`,viewBox:Va}),"CircleScissor.FILL_INSIDE":tn(en,{name:"CircleScissor.FILL_INSIDE",iconContent:`${Rh} ${R0}`,viewBox:Va}),"CircleScissor.ERASE_OUTSIDE":tn(en,{name:"CircleScissor.ERASE_OUTSIDE",iconContent:`${Rh} ${Vu}`,viewBox:Va}),"CircleScissor.FILL_OUTSIDE":tn(en,{name:"CircleScissor.FILL_OUTSIDE",iconContent:`${Rh} ${R0}`,viewBox:Va})};function tn(t,e){return Object.assign(Object.create(t),{...e,name:e.name||t.name})}function Yee(t){return Y_[t]}const Xee=Object.keys(Y_);class Zee{constructor(){const e={color:"rgb(255, 255, 0)",colorHighlighted:"rgb(0, 255, 0)",colorSelected:"rgb(0, 220, 0)",colorLocked:"rgb(209, 193, 90)",lineWidth:"1",lineDash:"",shadow:!0,textBoxVisibility:!0,textBoxFontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",textBoxFontSize:"14px",textBoxColor:"rgb(255, 255, 0)",textBoxColorHighlighted:"rgb(0, 255, 0)",textBoxColorSelected:"rgb(0, 255, 0)",textBoxColorLocked:"rgb(209, 193, 90)",textBoxBackground:"",textBoxLinkLineWidth:"1",textBoxLinkLineDash:"2,3",textBoxShadow:!0,markerSize:"10",angleArcLineDash:""};this._initializeConfig(e)}getAnnotationToolStyles(e){return this.config.annotations&&this.config.annotations[e]}getViewportToolStyles(e){return this.config.viewports&&this.config.viewports[e]}getToolGroupToolStyles(e){return this.config.toolGroups&&this.config.toolGroups[e]}getDefaultToolStyles(){return this.config.default}setAnnotationStyles(e,n){let r=this.config.annotations;r||(this.config={...this.config,annotations:{}},r=this.config.annotations),r[e]=n}setViewportToolStyles(e,n){let r=this.config.viewports;r||(this.config={...this.config,viewports:{}},r=this.config.viewports),r[e]=n}setToolGroupToolStyles(e,n){let r=this.config.toolGroups;r||(this.config={...this.config,toolGroups:{}},r=this.config.toolGroups),r[e]=n}setDefaultToolStyles(e){this.config.default=e}getStyleProperty(e,n){const{annotationUID:r,viewportId:i,toolGroupId:a,toolName:o}=n;return this._getToolStyle(e,r,i,a,o)}_getToolStyle(e,n,r,i,a){if(n){const s=this.getAnnotationToolStyles(n);if(s&&s[e]!==void 0)return s[e]}if(r){const s=this.getViewportToolStyles(r);if(s){if(s[a]&&s[a][e]!==void 0)return s[a][e];if(s.global&&s.global[e]!==void 0)return s.global[e]}}if(i){const s=this.getToolGroupToolStyles(i);if(s){if(s[a]&&s[a][e]!==void 0)return s[a][e];if(s.global&&s.global[e]!==void 0)return s.global[e]}}const o=this.getDefaultToolStyles();if(o[a]&&o[a][e]!==void 0)return o[a][e];if(o.global&&o.global[e]!==void 0)return o.global[e]}_initializeConfig(e){const n={};for(const r in e)n[r]=e[r];this.config={default:{global:n}}}}const Qee=new Zee;function Jee(t,e,n){const r=[`${t}`];return e&&r.push(`${r[0]}${e}`),n&&r.push(`${r[r.length-1]}${n}`),r}function X_(t,e,n,r){const i=Jee(t,n,r);for(let a=i.length-1;a>=0;--a){const o=Qee.getStyleProperty(i[a],e);if(o!==void 0)return o}}const ete="color",tte=A0.Highlighted,nte=Kn.Active;class f2 extends ep{constructor(e,n,r,i,a){super(e,n,r,i,a)}static getDefinedCursor(e,n=!1,r){r||(r=X_(ete,{},tte,nte));const i=rte(e,n,r);let a=super.getDefinedCursor(i);if(!a){const o=Yee(e);o&&(a=ite(o,i,n,r,super.getDefinedCursor("default")),super.setDefinedCursor(i,a))}return a}}function Z_(t,e){const n=Object(e),r=Object.prototype.hasOwnProperty.bind(n);return(t+"").replace(/\{\{(\w+)\}\}/g,(i,a)=>r(a)?n[a]+"":"")}function rte(t,e,n){return`${e?"pointer":"cursor"}:${t}/${n}`}function ite(t,e,n,r,i){const{x:a,y:o}=t.mousePoint;return new f2(ate(t,n,{color:r}),a,o,e,i)}function ate(t,e,n){const r=ote(t,e,n);return`${URL.createObjectURL(r)}#${t.name||"unknown"}-${e?"pointer":"cursor"}`}function ote(t,e,n){const r=(e?cte:ste)(t,n);return new Blob([r],{type:"image/svg+xml"})}function ste(t,e){const{iconContent:n,iconSize:r,viewBox:i}=t,a=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${r}" height="${r}" viewBox="0 0
      ${i.x} ${i.y}">
      ${n}
    </svg>`;return Z_(a,e)}function cte(t,e){const{iconContent:n,iconSize:r,viewBox:i,mousePointerGroupString:a}=t,o=r/Math.max(i.x,i.y,1),s=16+r,c=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${s}" height="${s}" viewBox="0 0 ${s} ${s}">
      <g>${a}</g>
      <g transform="translate(16, 16) scale(${o})">${n}</g>
    </svg>`;return Z_(c,e)}const DS=Symbol("ElementCursorsMap");function lte(t,e){x1(t)[0]=e,Q8(t,e)}function Q8(t,e){const n=x1(t);n[1]=n[0],n[0]=e,t.style.cursor=(e instanceof eo?e:eo.getDefinedCursor("auto")).getStyleProperty()}function J8(t){Q8(t,x1(t)[1])}function Bp(t){Q8(t,eo.getDefinedCursor("none"))}function x1(t){let e=x1[DS];e instanceof WeakMap||(e=new WeakMap,Object.defineProperty(x1,DS,{value:e}));let n=e.get(t);return n||(n=[null,null],e.set(t,n)),n}[...Xee,...qee];function Q_(t){return ht.toolGroups.find(e=>e.id===t)}const{Active:bg,Passive:X3,Enabled:Z3,Disabled:Q3}=Kn,ute=[{mouseButton:zc.Primary}];class ey{constructor(e){this.viewportsInfo=[],this.toolOptions={},this.currentActivePrimaryToolName=null,this.prevActivePrimaryToolName=null,this.restoreToolOptions={},this._toolInstances={},this.id=e}getViewportIds(){return this.viewportsInfo.map(({viewportId:e})=>e)}getViewportsInfo(){return this.viewportsInfo.slice()}getToolInstance(e){const n=this._toolInstances[e];if(!n){console.warn(`'${e}' is not registered with this toolGroup (${this.id}).`);return}return n}getToolInstances(){return this._toolInstances}hasTool(e){return!!this._toolInstances[e]}addTool(e,n={}){const r=ht.tools[e],i=typeof e<"u"&&e!=="",a=this.toolOptions[e];if(!i){console.warn("Tool with configuration did not produce a toolName: ",n);return}if(!r){console.warn(`'${e}' is not registered with the library. You need to use cornerstoneTools.addTool to register it.`);return}if(a){console.warn(`'${e}' is already registered for ToolGroup ${this.id}.`);return}const{toolClass:o}=r,s={name:e,toolGroupId:this.id,configuration:n},c=new o(s);this._toolInstances[e]=c}addToolInstance(e,n,r={}){let i=ht.tools[e]?.toolClass;if(!i){const a=ht.tools[n].toolClass;class o extends a{}o.toolName=e,i=o,ht.tools[e]={toolClass:o}}this.addTool(i.toolName,r)}addViewport(e,n){if(typeof e!="string")throw new Error("viewportId must be defined and be a string");const r=this._findRenderingEngine(e,n);this.viewportsInfo.some(({viewportId:o})=>o===e)||this.viewportsInfo.push({viewportId:e,renderingEngineId:r});const i=this.getActivePrimaryMouseButtonTool();this.setViewportsCursorByToolName(i);const a={toolGroupId:this.id,viewportId:e,renderingEngineId:r};je(Ye,Le.TOOLGROUP_VIEWPORT_ADDED,a)}removeViewports(e,n){const r=[];if(this.viewportsInfo.forEach((a,o)=>{let s=!1;a.renderingEngineId===e&&(s=!0,n&&a.viewportId!==n&&(s=!1)),s&&r.push(o)}),r.length)for(let a=r.length-1;a>=0;a--)this.viewportsInfo.splice(r[a],1);const i={toolGroupId:this.id,viewportId:n,renderingEngineId:e};je(Ye,Le.TOOLGROUP_VIEWPORT_REMOVED,i)}setActiveStrategy(e,n){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool configuration.`);return}r.setActiveStrategy(n)}setToolMode(e,n,r={}){if(!e){console.warn("setToolMode: toolName must be defined");return}if(n===Kn.Active){this.setToolActive(e,r||this.restoreToolOptions[e]);return}if(n===Kn.Passive){this.setToolPassive(e);return}if(n===Kn.Enabled){this.setToolEnabled(e);return}if(n===Kn.Disabled){this.setToolDisabled(e);return}console.warn("setToolMode: mode must be defined")}setToolActive(e,n={}){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}if(!r){console.warn(`'${e}' instance ${r} is not registered with this toolGroup, can't set tool mode.`);return}const i=this.toolOptions[e]?this.toolOptions[e].bindings:[],a=n.bindings?n.bindings:[],s={bindings:[...i,...a].reduce((u,d)=>{const g=d.numTouchPoints!==void 0,h=d.mouseButton!==void 0;return!u.some(m=>J3(m,d))&&(g||h)&&u.push(d),u},[]),mode:bg};if(this.toolOptions[e]=s,this._toolInstances[e].mode=bg,this._hasMousePrimaryButtonBinding(n))this.setViewportsCursorByToolName(e);else if(!this.getActivePrimaryMouseButtonTool()){const d=eo.getDefinedCursor("default");this._setCursorForViewports(d)}this._hasMousePrimaryButtonBinding(n)&&(this.prevActivePrimaryToolName===null?this.prevActivePrimaryToolName=e:this.prevActivePrimaryToolName=this.currentActivePrimaryToolName,this.currentActivePrimaryToolName=e),typeof r.onSetToolActive=="function"&&r.onSetToolActive(),this._renderViewports();const c={toolGroupId:this.id,toolName:e,toolBindingsOptions:n};je(Ye,Le.TOOL_ACTIVATED,c),this._triggerToolModeChangedEvent(e,bg,n)}setToolPassive(e,n){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const i=this.getToolOptions(e),a=Object.assign({bindings:i?i.bindings:[]},i,{mode:X3}),o=Array.isArray(n?.removeAllBindings)?n.removeAllBindings:this.getDefaultPrimaryBindings();a.bindings=a.bindings.filter(c=>n?.removeAllBindings!==!0&&!o.some(u=>J3(c,u)));let s=X3;a.bindings.length!==0&&(s=bg,a.mode=s),this.toolOptions[e]=a,r.mode=s,typeof r.onSetToolPassive=="function"&&r.onSetToolPassive(),this._renderViewports(),this._triggerToolModeChangedEvent(e,X3)}setToolEnabled(e){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const r={bindings:[],mode:Z3};this.toolOptions[e]=r,n.mode=Z3,typeof n.onSetToolEnabled=="function"&&n.onSetToolEnabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,Z3)}setToolDisabled(e){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const r={bindings:[],mode:Q3};this.restoreToolOptions[e]=this.toolOptions[e],this.toolOptions[e]=r,n.mode=Q3,typeof n.onSetToolDisabled=="function"&&n.onSetToolDisabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,Q3)}getToolOptions(e){const n=this.toolOptions[e];if(n!==void 0)return n}getActivePrimaryMouseButtonTool(){return Object.keys(this.toolOptions).find(e=>{const n=this.toolOptions[e];return n.mode===bg&&this._hasMousePrimaryButtonBinding(n)})}setViewportsCursorByToolName(e,n){const r=this._getCursor(e,n);this._setCursorForViewports(r)}_getCursor(e,n){let r,i;return n&&(r=`${e}.${n}`,i=f2.getDefinedCursor(r,!0),i)||(r=`${e}`,i=f2.getDefinedCursor(r,!0),i)||(r=e,i=f2.getDefinedCursor(r,!0),i)?i:eo.getDefinedCursor("default")}_setCursorForViewports(e){Jn.getRuntimeSettings().get("useCursors")&&this.viewportsInfo.forEach(({renderingEngineId:r,viewportId:i})=>{const a=H1(i,r);if(!a)return;const{viewport:o}=a;lte(o.element,e)})}setToolConfiguration(e,n,r){const i=this._toolInstances[e];if(i===void 0)return console.warn(`Tool ${e} not present, can't set tool configuration.`),!1;let a;return r?a=n:a=Object.assign(i.configuration,n),i.configuration=a,typeof i.onSetToolConfiguration=="function"&&i.onSetToolConfiguration(),this._renderViewports(),!0}getDefaultMousePrimary(){return zc.Primary}getDefaultPrimaryBindings(){return ute}getToolConfiguration(e,n){if(this._toolInstances[e]===void 0){console.warn(`Tool ${e} not present, can't set tool configuration.`);return}const r=jee(this._toolInstances[e].configuration,n)||this._toolInstances[e].configuration;return es(r)}getPrevActivePrimaryToolName(){return this.prevActivePrimaryToolName}setActivePrimaryTool(e){const n=this.getCurrentActivePrimaryToolName();this.setToolDisabled(n),this.setToolActive(e,{bindings:[{mouseButton:zc.Primary}]})}getCurrentActivePrimaryToolName(){return this.currentActivePrimaryToolName}clone(e,n=null){let r=Q_(e);return r?(console.debug(`ToolGroup ${e} already exists`),r):(r=new ey(e),ht.toolGroups.push(r),n=n??(()=>!0),Object.keys(this._toolInstances).filter(n).forEach(i=>{const a=this._toolInstances[i],o=this.toolOptions[i],s=a.mode;r.addTool(i),r.setToolMode(i,s,{bindings:o.bindings??[]})}),r)}_hasMousePrimaryButtonBinding(e){const n=this.getDefaultPrimaryBindings();return e?.bindings?.some(r=>n.some(i=>J3(r,i)))}_renderViewports(){this.viewportsInfo.forEach(({renderingEngineId:e,viewportId:n})=>{Yc(e).renderViewport(n)})}_triggerToolModeChangedEvent(e,n,r){const i={toolGroupId:this.id,toolName:e,mode:n,toolBindingsOptions:r};je(Ye,Le.TOOL_MODE_CHANGED,i)}_findRenderingEngine(e,n){const r=Hs();if(r?.length===0)throw new Error("No rendering engines found.");if(n)return n;const i=r.filter(a=>a.getViewport(e));if(i.length===0){if(r.length===1)return r[0].id;throw new Error("No rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.")}if(i.length>1)throw new Error("Multiple rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.");return i[0].id}}function J3(t,e){return t.mouseButton!==e.mouseButton||t.numTouchPoints!==e.numTouchPoints?!1:t.modifierKey===e.modifierKey}function fte(t){if(ht.toolGroups.some(r=>r.id===t)){console.warn(`'${t}' already exists.`);return}const n=new ey(t);return ht.toolGroups.push(n),n}function _S(t){const e=ht.toolGroups.findIndex(n=>n.id===t);e>-1&&ht.toolGroups.splice(e,1)}function Qi(t,e){e||(e=Hs().find(r=>r.getViewports().find(i=>i.id===t))?.id);const n=ht.toolGroups.filter(r=>r.viewportsInfo.some(i=>i.renderingEngineId===e&&(!i.viewportId||i.viewportId===t)));if(n.length){if(n.length>1)throw new Error(`Multiple tool groups found for renderingEngineId: ${e} and viewportId: ${t}. You should only
      have one tool group per viewport in a renderingEngine.`);return n[0]}}const gte=[Kn.Active,Kn.Passive,Kn.Enabled];function dte(t){return ht.toolGroups.filter(({toolOptions:e})=>{const n=Object.keys(e);for(let r=0;r<n.length;r++)if(t===n[r]&&e[t]&&gte.includes(e[t].mode))return!0;return!1})}function J_(t,e){const n=mt(e),{renderingEngine:r,viewportId:i}=n,a=Le.ANNOTATION_ADDED,o={annotation:t,viewportId:i,renderingEngineId:r.id};je(Ye,a,o)}function eb(t){const{toolName:e}=t.metadata,n=dte(e);if(!n.length)return;const r=[];n.forEach(o=>{o.viewportsInfo.forEach(s=>{const{renderingEngineId:c,viewportId:u}=s,{FrameOfReferenceUID:d}=H1(u,c);t.metadata.FrameOfReferenceUID===d&&r.push(s)})});const i=Le.ANNOTATION_ADDED,a={annotation:t};if(!r.length){je(Ye,i,a);return}r.forEach(({renderingEngineId:o,viewportId:s})=>{a.viewportId=s,a.renderingEngineId=o,je(Ye,i,a)})}function $p(t){const e=Le.ANNOTATION_REMOVED;je(Ye,e,t)}function Ao(t,e,n=Bs.HandlesUpdated){const r=e&&mt(e),{viewportId:i,renderingEngineId:a}=r||{},o=Le.ANNOTATION_MODIFIED;je(Ye,o,{annotation:t,viewportId:i,renderingEngineId:a,changeType:n})}function hte(t){tb({annotation:t})}function ty(t,e=!1){tb({annotation:t,contourHoleProcessingEnabled:e})}function tb(t){const e=Le.ANNOTATION_COMPLETED;je(Ye,e,t)}const pte=Object.freeze(Object.defineProperty({__proto__:null,triggerAnnotationAddedForElement:J_,triggerAnnotationAddedForFOR:eb,triggerAnnotationCompleted:hte,triggerAnnotationModified:Ao,triggerAnnotationRemoved:$p,triggerContourAnnotationCompleted:ty},Symbol.toStringTag,{value:"Module"}));let nb;function qs(){return nb}function ny(t){nb=t}function E1(t,e){const n=qs(),r=n.getGroupKey(e);return n.getAnnotations(r,t)}function Xi(t){return qs().getAnnotation(t)}function rb(){return qs().getAllAnnotations()}function Wp(t){const{annotationUID:e,parentAnnotationUID:n}=t;if(!n)return;const r=Xi(n),i=r.childAnnotationUIDs.indexOf(e);r.childAnnotationUIDs.splice(i,1),t.parentAnnotationUID=void 0}function K1(t,e){const{annotationUID:n}=t,{annotationUID:r}=e;Wp(e),t.childAnnotationUIDs||(t.childAnnotationUIDs=[]),!t.childAnnotationUIDs.includes(r)&&(t.childAnnotationUIDs.push(r),e.parentAnnotationUID=n)}function ib(t){return t.parentAnnotationUID?Xi(t.parentAnnotationUID):void 0}function zp(t){return t.childAnnotationUIDs?.map(e=>Xi(e))??[]}function Wl(t,e){t.annotationUID||(t.annotationUID=Ui());const n=qs();if(e instanceof HTMLDivElement){const r=n.getGroupKey(e);n.addAnnotation(t,r),J_(t,e)}else n.addAnnotation(t,void 0),eb(t);return t.annotationUID}function mte(t,e){const n=qs(),r=n.getGroupKey(e);return n.getNumberOfAnnotations(r,t)}function q0(t){if(!t)return;const e=qs(),n=e.getAnnotation(t);n&&(n.childAnnotationUIDs?.forEach(r=>q0(r)),e.removeAnnotation(t),$p({annotation:n,annotationManagerUID:e.uid}))}function vte(){const t=qs(),e=t.removeAllAnnotations();for(const n of e)$p({annotation:n,annotationManagerUID:t.uid})}function yte(t,e){const n=qs(),r=n.getGroupKey(e),i=n.removeAnnotations(r,t);for(const a of i)$p({annotation:a,annotationManagerUID:n.uid})}function ab(t){let e=t;for(;e;)e.invalidated=!0,e=e.parentAnnotationUID?Xi(e.parentAnnotationUID):void 0}const Tte=Object.freeze(Object.defineProperty({__proto__:null,addAnnotation:Wl,addChildAnnotation:K1,clearParentAnnotation:Wp,getAllAnnotations:rb,getAnnotation:Xi,getAnnotationManager:qs,getAnnotations:E1,getChildAnnotations:zp,getNumberOfAnnotations:mte,getParentAnnotation:ib,invalidateAnnotation:ab,removeAllAnnotations:vte,removeAnnotation:q0,removeAnnotations:yte,setAnnotationManager:ny},Symbol.toStringTag,{value:"Module"}));function Hg(t){const e=t.toolName;if(!e)throw new Error(`No Tool Found for the ToolClass ${t.name}`);ht.tools[e]||(ht.tools[e]={toolClass:t})}function Hp(t){return!!(t&&ht.tools[t])}function Zl(t,e){const n=e||t.currentTarget,{viewport:r}=mt(n)||{};if(!r)return;const i=wte(t),a=Ste(t),o=Cte(n,a),s=r.canvasToWorld(o);return{page:a,client:i,canvas:o,world:s}}function Cte(t,e){const n=t.getBoundingClientRect();return[e[0]-n.left-window.pageXOffset,e[1]-n.top-window.pageYOffset]}function Ste(t){return[t.pageX,t.pageY]}function wte(t){return[t.clientX,t.clientY]}function ob(t){const e=t.currentTarget,{viewportId:n,renderingEngineId:r}=mt(e),i=Zl(t,e),a={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},o={event:t,eventName:Le.MOUSE_DOUBLE_CLICK,viewportId:n,renderingEngineId:r,camera:{},element:e,startPoints:i,lastPoints:i,currentPoints:i,deltaPoints:a};!je(e,Le.MOUSE_DOUBLE_CLICK,o)&&(t.stopImmediatePropagation(),t.preventDefault())}const bS=Le.MOUSE_MOVE;function Y1(t){const e=t.currentTarget,n=mt(e);if(!n)return;const{renderingEngineId:r,viewportId:i}=n,a=Zl(t);!je(e,bS,{renderingEngineId:r,viewportId:i,camera:{},element:e,currentPoints:a,eventName:bS,event:t})&&(t.stopImmediatePropagation(),t.preventDefault())}const{MOUSE_DOWN:MS,MOUSE_DOWN_ACTIVATE:xte,MOUSE_CLICK:Ete,MOUSE_UP:Rte,MOUSE_DRAG:LS}=Le,Ote=400,Dte=150,_te=3,bte={mouseButton:void 0,element:null,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};let Mt={mouseButton:void 0,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,element:null,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};const ni={doubleClickTimeout:null,mouseDownEvent:null,mouseUpEvent:null,ignoreDoubleClick:!1};function sb(t){if(ni.doubleClickTimeout){if(t.buttons===ni.mouseDownEvent.buttons)return;ni.mouseDownEvent=t,tp();return}ni.doubleClickTimeout=setTimeout(tp,t.buttons===1?Ote:Dte),ni.mouseDownEvent=t,ni.ignoreDoubleClick=!1,Mt.element=t.currentTarget,Mt.mouseButton=t.buttons;const e=mt(Mt.element),{renderingEngineId:n,viewportId:r}=e;Mt.renderingEngineId=n,Mt.viewportId=r,Mt.preventClickTimeout=setTimeout(Lte,Mt.clickDelay),Mt.element.removeEventListener("mousemove",Y1);const i=Zl(t,Mt.element);Mt.startPoints=G0(i),Mt.lastPoints=G0(i),document.addEventListener("mouseup",ry),document.addEventListener("mousemove",cb)}function Mte(t){const e=jp(Mt.startPoints,Mt.startPoints),n={event:t,eventName:MS,element:Mt.element,mouseButton:Mt.mouseButton,renderingEngineId:Mt.renderingEngineId,viewportId:Mt.viewportId,camera:{},startPoints:Mt.startPoints,lastPoints:Mt.startPoints,currentPoints:Mt.startPoints,deltaPoints:e};Mt.lastPoints=G0(n.lastPoints),je(n.element,MS,n)&&je(n.element,xte,n)}function cb(t){if(!mt(Mt.element)?.viewport)return;const n=Zl(t,Mt.element),r=gb(Mt.element,Mt.lastPoints),i=jp(n,r);if(ni.doubleClickTimeout)if(ub(i.canvas))tp();else return;const a={event:t,eventName:LS,mouseButton:Mt.mouseButton,renderingEngineId:Mt.renderingEngineId,viewportId:Mt.viewportId,camera:{},element:Mt.element,startPoints:G0(Mt.startPoints),lastPoints:G0(r),currentPoints:n,deltaPoints:i};!je(Mt.element,LS,a)&&(t.stopImmediatePropagation(),t.preventDefault()),Mt.lastPoints=G0(n)}function ry(t){if(clearTimeout(Mt.preventClickTimeout),ni.doubleClickTimeout)ni.mouseUpEvent?nv():(ni.mouseUpEvent=t,Mt.element.addEventListener("mousemove",lb));else{const e=Mt.isClickEvent?Ete:Rte,n=Zl(t,Mt.element),r=jp(n,Mt.lastPoints),i={event:t,eventName:e,mouseButton:Mt.mouseButton,element:Mt.element,renderingEngineId:Mt.renderingEngineId,viewportId:Mt.viewportId,camera:{},startPoints:G0(Mt.startPoints),lastPoints:G0(Mt.lastPoints),currentPoints:n,deltaPoints:r};je(i.element,e,i),nv()}document.removeEventListener("mousemove",cb)}function lb(t){const e=Zl(t,Mt.element),n=gb(Mt.element,Mt.lastPoints),r=jp(e,n);ub(r.canvas)&&(tp(),Y1(t))}function ub(t){return Math.abs(t[0])+Math.abs(t[1])>_te}function Lte(){Mt.isClickEvent=!1}function tp(){ni.ignoreDoubleClick=!0;const t=ni.mouseDownEvent,e=ni.mouseUpEvent;fb(),Mte(t),e&&ry(e)}function fb(){ni.doubleClickTimeout&&(clearTimeout(ni.doubleClickTimeout),ni.doubleClickTimeout=null),ni.mouseDownEvent=null,ni.mouseUpEvent=null}function nv(){document.removeEventListener("mouseup",ry),Mt.element?.removeEventListener("mousemove",lb),Mt.element?.addEventListener("mousemove",Y1),fb(),Mt=JSON.parse(JSON.stringify(bte))}function G0(t){return JSON.parse(JSON.stringify(t))}function gb(t,e){const{viewport:n}=mt(t)||{};if(!n)return e;const r=n.canvasToWorld(e.canvas);return{page:e.page,client:e.client,canvas:e.canvas,world:r}}function jp(t,e){return!t||!e?{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}:{page:e4(t.page,e.page),client:e4(t.client,e.client),canvas:e4(t.canvas,e.canvas),world:Vte(t.world,e.world)}}function e4(t,e){return[t[0]-e[0],t[1]-e[1]]}function Vte(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function Ite(){return Mt.mouseButton}function db(t){ni.ignoreDoubleClick?(ni.ignoreDoubleClick=!1,t.stopImmediatePropagation(),t.preventDefault()):nv()}function hb(t){t.removeEventListener("dblclick",ob),t.removeEventListener("mousedown",sb),t.removeEventListener("mousemove",Y1),t.removeEventListener("dblclick",db,{capture:!0})}function Ate(t){hb(t),t.addEventListener("dblclick",ob),t.addEventListener("mousedown",sb),t.addEventListener("mousemove",Y1),t.addEventListener("dblclick",db,{capture:!0})}const pb={enable:Ate,disable:hb},Nte=2e3,uf={mouse:0,touch:1};let VS,IS;function mb(t,e){const n=Date.now();if(t!==VS){if(n-IS<=Nte)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1;VS=t}IS=n}const vb=mb.bind(null,uf.mouse),yb=mb.bind(null,uf.touch);function AS(t,e,n){const r=n?vb:yb;e.forEach(function(i){t.addEventListener(i,r,{passive:!1})})}function NS(t,e,n){const r=n?vb:yb;e.forEach(function(i){t.removeEventListener(i,r)})}const Tb=["mousedown","mouseup","mousemove"],Cb=["touchstart","touchend"];function Sb(t){NS(t,Tb,uf.mouse),NS(t,Cb,uf.touch)}function Pte(t){Sb(t),AS(t,Tb,uf.mouse),AS(t,Cb,uf.touch)}const wb={enable:Pte,disable:Sb};function qp(t,e){const n=e||t.currentTarget,r=t.type==="touchend"?t.changedTouches:t.touches;return Object.keys(r).map(i=>{const a=kte(r[i]),o=Fte(r[i]),s=Ute(n,o),{viewport:c}=mt(n),u=c.canvasToWorld(s);return{page:o,client:a,canvas:s,world:u,touch:{identifier:i,radiusX:r[i].radiusX,radiusY:r[i].radiusY,force:r[i].force,rotationAngle:r[i].rotationAngle}}})}function Ute(t,e){const n=t.getBoundingClientRect();return[e[0]-n.left-window.pageXOffset,e[1]-n.top-window.pageYOffset]}function Fte(t){return[t.pageX,t.pageY]}function kte(t){return[t.clientX,t.clientY]}function rv(t,e){const n=np(t),r=np(e);return{page:t4(n.page,r.page),client:t4(n.client,r.client),canvas:t4(n.canvas,r.canvas),world:Gte(n.world,r.world)}}function xb(t,e){const n=np(t),r=np(e);return{page:ef(n.page,r.page),client:ef(n.client,r.client),canvas:ef(n.canvas,r.canvas),world:Eb(n.world,r.world)}}function iv(t,e){const n=US(t),r=US(e);return{page:n.page-r.page,client:n.client-r.client,canvas:n.canvas-r.canvas,world:n.world-r.world}}function Hc(t){return JSON.parse(JSON.stringify(t))}function PS(t){return JSON.parse(JSON.stringify(t))}function np(t){return t.reduce((e,n)=>({page:[e.page[0]+n.page[0]/t.length,e.page[1]+n.page[1]/t.length],client:[e.client[0]+n.client[0]/t.length,e.client[1]+n.client[1]/t.length],canvas:[e.canvas[0]+n.canvas[0]/t.length,e.canvas[1]+n.canvas[1]/t.length],world:[e.world[0]+n.world[0]/t.length,e.world[1]+n.world[1]/t.length,e.world[2]+n.world[2]/t.length]}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]})}function Ls(t){return t.reduce((e,n)=>({page:[e.page[0]+n.page[0]/t.length,e.page[1]+n.page[1]/t.length],client:[e.client[0]+n.client[0]/t.length,e.client[1]+n.client[1]/t.length],canvas:[e.canvas[0]+n.canvas[0]/t.length,e.canvas[1]+n.canvas[1]/t.length],world:[e.world[0]+n.world[0]/t.length,e.world[1]+n.world[1]/t.length,e.world[2]+n.world[2]/t.length],touch:{identifier:null,radiusX:e.touch.radiusX+n.touch.radiusX/t.length,radiusY:e.touch.radiusY+n.touch.radiusY/t.length,force:e.touch.force+n.touch.force/t.length,rotationAngle:e.touch.rotationAngle+n.touch.rotationAngle/t.length}}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0],touch:{identifier:null,radiusX:0,radiusY:0,force:0,rotationAngle:0}})}function t4(t,e){return[t[0]-e[0],t[1]-e[1]]}function Gte(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function US(t){const e=[];for(let n=0;n<t.length;n++)for(let r=0;r<t.length;r++)n<r&&e.push({page:ef(t[n].page,t[r].page),client:ef(t[n].client,t[r].client),canvas:ef(t[n].canvas,t[r].canvas),world:Eb(t[n].world,t[r].world)});return e.reduce((n,r)=>({page:n.page+r.page/e.length,client:n.client+r.client/e.length,canvas:n.canvas+r.canvas/e.length,world:n.world+r.world/e.length}),{page:0,client:0,canvas:0,world:0})}function ef(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function Eb(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}Jn.getRuntimeSettings();const{TOUCH_START:FS,TOUCH_START_ACTIVATE:Bte,TOUCH_PRESS:kS,TOUCH_DRAG:GS,TOUCH_END:BS,TOUCH_TAP:$S,TOUCH_SWIPE:n4}=Le,R1={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},rp={page:0,client:0,canvas:0,world:0},Rb={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...R1,touch:null}],lastPointsList:[{...R1,touch:null}],isTouchStart:!1,startTime:null,pressTimeout:null,pressDelay:700,pressMaxDistance:5,accumulatedDistance:rp,swipeDistanceThreshold:48,swiped:!1,swipeToleranceMs:300},Ob={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...R1,touch:null}],taps:0,tapTimeout:null,tapMaxDistance:24,tapToleranceMs:300};let lt=JSON.parse(JSON.stringify(Rb)),Or=JSON.parse(JSON.stringify(Ob));function K0(t,e,n){return je(t,e,n)}function Db(t){lt.element=t.currentTarget;const e=mt(lt.element),{renderingEngineId:n,viewportId:r}=e;lt.renderingEngineId=n,lt.viewportId=r,!lt.isTouchStart&&(clearTimeout(lt.pressTimeout),lt.pressTimeout=setTimeout(()=>$te(t),lt.pressDelay),Wte(t),document.addEventListener("touchmove",_b),document.addEventListener("touchend",bb))}function $te(t){if(lt.accumulatedDistance.canvas>lt.pressMaxDistance)return;const n={event:t,eventName:kS,renderingEngineId:lt.renderingEngineId,viewportId:lt.viewportId,camera:{},element:lt.element,startPointsList:Hc(lt.startPointsList),lastPointsList:Hc(lt.lastPointsList),startPoints:PS(Ls(lt.startPointsList)),lastPoints:PS(Ls(lt.lastPointsList))};K0(n.element,kS,n)}function Wte(t){lt.isTouchStart=!0,lt.startTime=new Date;const e=qp(t,lt.element),n=Ls(e),r=R1,i=rp,a={event:t,eventName:FS,element:lt.element,renderingEngineId:lt.renderingEngineId,viewportId:lt.viewportId,camera:{},startPointsList:e,lastPointsList:e,currentPointsList:e,startPoints:n,lastPoints:n,currentPoints:n,deltaPoints:r,deltaDistance:i};lt.startPointsList=Hc(a.startPointsList),lt.lastPointsList=Hc(a.lastPointsList),K0(a.element,FS,a)&&K0(a.element,Bte,a)}function _b(t){const e=qp(t,lt.element),n=Mb(lt.element,lt.lastPointsList),r=e.length===n.length?rv(e,n):R1,i=e.length===n.length?iv(e,n):rp,a=e.length===n.length?xb(e,lt.lastPointsList):rp;lt.accumulatedDistance={page:lt.accumulatedDistance.page+a.page,client:lt.accumulatedDistance.client+a.client,canvas:lt.accumulatedDistance.canvas+a.canvas,world:lt.accumulatedDistance.world+a.world};const o={event:t,eventName:GS,renderingEngineId:lt.renderingEngineId,viewportId:lt.viewportId,camera:{},element:lt.element,startPoints:Ls(lt.startPointsList),lastPoints:Ls(n),currentPoints:Ls(e),startPointsList:Hc(lt.startPointsList),lastPointsList:Hc(n),currentPointsList:e,deltaPoints:r,deltaDistance:i};K0(lt.element,GS,o),Hte(t,r),lt.lastPointsList=Hc(e)}function bb(t){clearTimeout(lt.pressTimeout);const e=qp(t,lt.element),n=Mb(lt.element,lt.lastPointsList),r=e.length===n.length?rv(e,n):rv(e,e),i=e.length===n.length?iv(e,n):iv(e,e),a={event:t,eventName:BS,element:lt.element,renderingEngineId:lt.renderingEngineId,viewportId:lt.viewportId,camera:{},startPointsList:Hc(lt.startPointsList),lastPointsList:Hc(n),currentPointsList:e,startPoints:Ls(lt.startPointsList),lastPoints:Ls(n),currentPoints:Ls(e),deltaPoints:r,deltaDistance:i};K0(a.element,BS,a),zte(t),lt=JSON.parse(JSON.stringify(Rb)),document.removeEventListener("touchmove",_b),document.removeEventListener("touchend",bb)}function zte(t){const e=new Date().getTime(),n=lt.startTime.getTime();if(e-n>Or.tapToleranceMs||(Or.taps===0&&(Or.element=lt.element,Or.renderingEngineId=lt.renderingEngineId,Or.viewportId=lt.viewportId,Or.startPointsList=lt.startPointsList),Or.taps>0&&!(Or.element==lt.element&&Or.renderingEngineId==lt.renderingEngineId&&Or.viewportId==lt.viewportId)))return;const r=qp(t,Or.element);xb(r,Or.startPointsList).canvas>Or.tapMaxDistance||(clearTimeout(Or.tapTimeout),Or.taps+=1,Or.tapTimeout=setTimeout(()=>{const a={event:t,eventName:$S,element:Or.element,renderingEngineId:Or.renderingEngineId,viewportId:Or.viewportId,camera:{},currentPointsList:r,currentPoints:Ls(r),taps:Or.taps};K0(a.element,$S,a),Or=JSON.parse(JSON.stringify(Ob))},Or.tapToleranceMs))}function Hte(t,e){const n=new Date().getTime(),r=lt.startTime.getTime();if(lt.swiped||n-r>lt.swipeToleranceMs)return;const[i,a]=e.canvas,o={event:t,eventName:n4,renderingEngineId:lt.renderingEngineId,viewportId:lt.viewportId,camera:{},element:lt.element,swipe:null};Math.abs(i)>lt.swipeDistanceThreshold&&(o.swipe=i>0?Wu.RIGHT:Wu.LEFT,K0(o.element,n4,o),lt.swiped=!0),Math.abs(a)>lt.swipeDistanceThreshold&&(o.swipe=a>0?Wu.DOWN:Wu.UP,K0(o.element,n4,o),lt.swiped=!0)}function Mb(t,e){const{viewport:n}=mt(t);return e.map(r=>{const i=n.canvasToWorld(r.canvas);return{page:r.page,client:r.client,canvas:r.canvas,world:i,touch:r.touch}})}function Lb(t){wb.disable(t),t.removeEventListener("touchstart",Db)}function jte(t){Lb(t),wb.enable(t),t.addEventListener("touchstart",Db,{passive:!1})}const Vb={enable:jte,disable:Lb},WS=10,zS=40,HS=800;function qte(t){let e=0,n=0,r=0,i=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),r=e*WS,i=n*WS,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||i)&&t.deltaMode&&(t.deltaMode===1?(r*=zS,i*=zS):(r*=HS,i*=HS)),r&&!e&&(e=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:e,spinY:n,pixelX:r,pixelY:i}}function Ib(t){const e=t.currentTarget,n=mt(e),{renderingEngineId:r,viewportId:i}=n;if(t.deltaY>-1&&t.deltaY<1)return;t.preventDefault();const{spinX:a,spinY:o,pixelX:s,pixelY:c}=qte(t),u=o<0?-1:1,d={event:t,eventName:Le.MOUSE_WHEEL,renderingEngineId:r,viewportId:i,element:e,camera:{},detail:t,wheel:{spinX:a,spinY:o,pixelX:s,pixelY:c,direction:u},points:Zl(t)};je(e,Le.MOUSE_WHEEL,d)}function Kte(t){Ab(t),t.addEventListener("wheel",Ib,{passive:!1})}function Ab(t){t.removeEventListener("wheel",Ib)}const Nb={enable:Kte,disable:Ab},Yte={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};let kr={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};function Kp(t){kr.element=t.currentTarget;const e=mt(kr.element),{renderingEngineId:n,viewportId:r}=e;kr.renderingEngineId=n,kr.viewportId=r,kr.key=t.key,kr.keyCode=t.keyCode,t.preventDefault();const i={renderingEngineId:kr.renderingEngineId,viewportId:kr.viewportId,element:kr.element,key:kr.key,keyCode:kr.keyCode};je(i.element,Le.KEY_DOWN,i),document.addEventListener("keyup",Pb),document.addEventListener("visibilitychange",iy),kr.element.removeEventListener("keydown",Kp)}function iy(){document.removeEventListener("visibilitychange",iy),document.visibilityState==="hidden"&&Ub()}function Pb(t){const e={renderingEngineId:kr.renderingEngineId,viewportId:kr.viewportId,element:kr.element,key:kr.key,keyCode:kr.keyCode};document.removeEventListener("keyup",Pb),document.removeEventListener("visibilitychange",iy),kr.element.addEventListener("keydown",Kp),kr=structuredClone(Yte),je(e.element,Le.KEY_UP,e)}function Xte(){return kr.keyCode}function Ub(){kr.keyCode=void 0}function Zte(t){Fb(t),t.addEventListener("keydown",Kp)}function Fb(t){t.removeEventListener("keydown",Kp)}const _f={enable:Zte,disable:Fb,getModifierKey:Xte},ay=new Map,Qte=t=>{const e=ay.get(t);e&&(e.isDirty=!0)},Jte=t=>{const e=ay.get(t);return e&&!e.isDirty?e.indices:null},ene=(t,e)=>{ay.set(t,{indices:e,isDirty:!1})};function Yp(t,e,n){const r={segmentationId:t,modifiedSlicesToUse:e,segmentIndex:n};Qte(t),je(Ye,Le.SEGMENTATION_DATA_MODIFIED,r)}function Xp(t){const e={segmentationId:t};je(Ye,Le.SEGMENTATION_MODIFIED,e)}function tne(t){const e={segmentationId:t};je(Ye,Le.SEGMENTATION_REMOVED,e)}function Oh(t,e,n){const r={segmentationId:e,type:n,viewportId:t};je(Ye,Le.SEGMENTATION_REPRESENTATION_MODIFIED,r)}function jS(t,e,n){const r={viewportId:t,segmentationId:e,type:n};je(Ye,Le.SEGMENTATION_REPRESENTATION_REMOVED,r)}const nne={renderOutline:!0,outlineWidthAutoGenerated:3,outlineWidth:1,outlineWidthInactive:1,outlineOpacity:1,outlineOpacityInactive:.85,outlineDash:void 0,outlineDashInactive:void 0,outlineDashAutoGenerated:"5,3",activeSegmentOutlineWidthDelta:0,renderFill:!0,fillAlpha:.5,fillAlphaInactive:.3,fillAlphaAutoGenerated:.3};function rne(){return nne}const ine={renderOutline:!0,renderOutlineInactive:!0,outlineWidth:3,outlineWidthInactive:2,activeSegmentOutlineWidthDelta:0,renderFill:!0,renderFillInactive:!0,fillAlpha:.5,fillAlphaInactive:.4,outlineOpacity:1,outlineOpacityInactive:.85};function ane(){return ine}class one{constructor(){this.config={global:{},segmentations:{},viewportsStyle:{}}}setStyle(e,n){const{viewportId:r,segmentationId:i,type:a,segmentIndex:o}=e,s=this.getStyle(e);let c;if(!r&&!i?c={...s,...n}:c=this.copyActiveToInactiveIfNotProvided({...s,...n},a),!a)throw new Error("Type is required to set a style");if(r){this.config.viewportsStyle[r]||(this.config.viewportsStyle[r]={renderInactiveSegmentations:!1,representations:{}});const u=this.config.viewportsStyle[r].representations;if(i){u[i]||(u[i]={}),u[i][a]||(u[i][a]={});const d=u[i][a];o!==void 0?(d.perSegment||(d.perSegment={}),d.perSegment[o]=c):d.allSegments=c}else{const d="__allSegmentations__";u[d]||(u[d]={}),u[d][a]||(u[d][a]={}),u[d][a].allSegments=c}}else if(i){this.config.segmentations[i]||(this.config.segmentations[i]={}),this.config.segmentations[i][a]||(this.config.segmentations[i][a]={});const u=this.config.segmentations[i][a];o!==void 0?(u.perSegment||(u.perSegment={}),u.perSegment[o]=c):u.allSegments=c}else this.config.global[a]=c}copyActiveToInactiveIfNotProvided(e,n){const r={...e};if(n===At.Labelmap){const i=r;i.renderOutlineInactive??=i.renderOutline,i.outlineWidthInactive??=i.outlineWidth,i.renderFillInactive??=i.renderFill,i.fillAlphaInactive??=i.fillAlpha,i.outlineOpacityInactive??=i.outlineOpacity}else if(n===At.Contour){const i=r;i.outlineWidthInactive??=i.outlineWidth,i.outlineOpacityInactive??=i.outlineOpacity,i.outlineDashInactive??=i.outlineDash,i.renderOutlineInactive??=i.renderOutline,i.renderFillInactive??=i.renderFill,i.fillAlphaInactive??=i.fillAlpha}return r}getStyle(e){const{viewportId:n,segmentationId:r,type:i,segmentIndex:a}=e;let o=this.getDefaultStyle(i);if(this.config.global[i]&&(o={...o,...this.config.global[i]}),this.config.segmentations[r]?.[i]&&(o={...o,...this.config.segmentations[r][i].allSegments},a!==void 0&&this.config.segmentations[r][i].perSegment?.[a]&&(o={...o,...this.config.segmentations[r][i].perSegment[a]})),n&&this.config.viewportsStyle[n]){this.config.viewportsStyle[n].renderInactiveSegmentations;const s="__allSegmentations__";this.config.viewportsStyle[n].representations[s]?.[i]&&(o={...o,...this.config.viewportsStyle[n].representations[s][i].allSegments}),r&&this.config.viewportsStyle[n].representations[r]?.[i]&&(o={...o,...this.config.viewportsStyle[n].representations[r][i].allSegments},a!==void 0&&this.config.viewportsStyle[n].representations[r][i].perSegment?.[a]&&(o={...o,...this.config.viewportsStyle[n].representations[r][i].perSegment[a]}))}return o}getRenderInactiveSegmentations(e){return this.config.viewportsStyle[e]?.renderInactiveSegmentations}setRenderInactiveSegmentations(e,n){this.config.viewportsStyle[e]||(this.config.viewportsStyle[e]={renderInactiveSegmentations:!1,representations:{}}),this.config.viewportsStyle[e].renderInactiveSegmentations=n}getDefaultStyle(e){switch(e){case At.Labelmap:return ane();case At.Contour:return rne();case At.Surface:return{};default:throw new Error(`Unknown representation type: ${e}`)}}clearSegmentationStyle(e){this.config.segmentations[e]&&delete this.config.segmentations[e]}clearAllSegmentationStyles(){this.config.segmentations={}}clearViewportStyle(e){this.config.viewportsStyle[e]&&delete this.config.viewportsStyle[e]}clearAllViewportStyles(){for(const e in this.config.viewportsStyle){const r=this.config.viewportsStyle[e].renderInactiveSegmentations;this.config.viewportsStyle[e]={renderInactiveSegmentations:r,representations:{}}}}resetToGlobalStyle(){this.clearAllSegmentationStyles(),this.clearAllViewportStyles()}hasCustomStyle(e){const{type:n}=e,r=this.getStyle(e),i=this.getDefaultStyle(n);return!S_(r,i)}}const tf=new one;function sne(t){const e={segmentationId:t};je(Ye,Le.SEGMENTATION_ADDED,e)}const qS={colorLUT:[],segmentations:[],viewportSegRepresentations:{}};class cne{constructor(e){this._stackLabelmapImageIdReferenceMap=new Map,this._labelmapImageIdReferenceMap=new Map,e||=Ui(),this.state=Object.freeze(es(qS)),this.uid=e}getState(){return this.state}updateState(e){const n=es(this.state);e(n),this.state=Object.freeze(n)}getColorLUT(e){return this.state.colorLUT[e]}getNextColorLUTIndex(){return this.state.colorLUT.length}resetState(){this._stackLabelmapImageIdReferenceMap.clear(),this._labelmapImageIdReferenceMap.clear(),this.state=Object.freeze(es(qS))}getSegmentation(e){return this.state.segmentations.find(n=>n.segmentationId===e)}updateSegmentation(e,n){this.updateState(r=>{const i=r.segmentations.find(a=>a.segmentationId===e);if(!i){console.warn(`Segmentation with id ${e} not found. Update aborted.`);return}Object.assign(i,n)}),Xp(e)}addSegmentation(e){if(this.getSegmentation(e.segmentationId))throw new Error(`Segmentation with id ${e.segmentationId} already exists`);this.updateState(n=>{const r=es(e);if(r.representationData.Labelmap&&"volumeId"in r.representationData.Labelmap&&!("imageIds"in r.representationData.Labelmap)){const i=this.getLabelmapImageIds(r.representationData);r.representationData.Labelmap.imageIds=i}n.segmentations.push(r)}),sne(e.segmentationId)}removeSegmentation(e){this.updateState(n=>{const r=n.segmentations.filter(i=>i.segmentationId!==e);n.segmentations.splice(0,n.segmentations.length,...r)}),tne(e)}addSegmentationRepresentation(e,n,r,i){if(!ti(e))return;if(this.getSegmentationRepresentations(e,{type:r,segmentationId:n}).length>0){console.debug("A segmentation representation of type",r,"already exists in viewport",e,"for segmentation",n);return}this.updateState(s=>{s.viewportSegRepresentations[e]||(s.viewportSegRepresentations[e]=[],tf.setRenderInactiveSegmentations(e,!0)),r!==At.Labelmap?this.addDefaultSegmentationRepresentation(s,e,n,r,i):this.addLabelmapRepresentation(s,e,n,i)}),Oh(e,n,r)}addDefaultSegmentationRepresentation(e,n,r,i,a){const o=e.segmentations.find(c=>c.segmentationId===r);if(!o)return;const s={};Object.keys(o.segments).forEach(c=>{s[Number(c)]={visible:!0}}),e.viewportSegRepresentations[n].push({segmentationId:r,type:i,active:!0,visible:!0,colorLUTIndex:a?.colorLUTIndex||0,segments:s,config:{...KS(i),...a}}),this._setActiveSegmentation(e,n,r)}addLabelmapRepresentation(e,n,r,i=KS(At.Labelmap)){if(!ti(n))return;const o=this.getSegmentation(r);if(!o)return;const{representationData:s}=o;if(!s.Labelmap)return this.addDefaultSegmentationRepresentation(e,n,r,At.Labelmap,i);this.processLabelmapRepresentationAddition(n,r),this.addDefaultSegmentationRepresentation(e,n,r,At.Labelmap,i)}async processLabelmapRepresentationAddition(e,n){const r=ti(e);if(!r)return;const i=this.getSegmentation(n);if(!i)return;const a=r.viewport instanceof Vo,{representationData:o}=i,s="volumeId"in o.Labelmap;r.viewport,!a&&!s&&this.updateLabelmapSegmentationImageReferences(e,i.segmentationId)}_updateLabelmapSegmentationReferences(e,n,r,i){const a=n.getCurrentImageId();let o=!1;for(const s of r)n.isReferenceViewable({referencedImageId:s},{asOverlay:!0})&&(o=!0,this._stackLabelmapImageIdReferenceMap.get(e).set(a,s),this._updateLabelmapImageIdReferenceMap({segmentationId:e,referenceImageId:a,labelmapImageId:s}));return i&&i(n,e,r),o?this._stackLabelmapImageIdReferenceMap.get(e).get(a):void 0}updateLabelmapSegmentationImageReferences(e,n){const r=this.getSegmentation(n);if(!r)return;this._stackLabelmapImageIdReferenceMap.has(n)||this._stackLabelmapImageIdReferenceMap.set(n,new Map);const{representationData:i}=r;if(!i.Labelmap)return;const a=this.getLabelmapImageIds(i),s=ti(e).viewport;return this._updateLabelmapSegmentationReferences(n,s,a,null)}_updateAllLabelmapSegmentationImageReferences(e,n){const r=this.getSegmentation(n);if(!r)return;this._stackLabelmapImageIdReferenceMap.has(n)||this._stackLabelmapImageIdReferenceMap.set(n,new Map);const{representationData:i}=r;if(!i.Labelmap)return;const a=this.getLabelmapImageIds(i),s=ti(e).viewport;this._updateLabelmapSegmentationReferences(n,s,a,(c,u,d)=>{c.getImageIds().forEach((h,m)=>{for(const y of d)c.isReferenceViewable({referencedImageId:y,sliceIndex:m},{asOverlay:!0,withNavigation:!0})&&(this._stackLabelmapImageIdReferenceMap.get(u).set(h,y),this._updateLabelmapImageIdReferenceMap({segmentationId:u,referenceImageId:h,labelmapImageId:y}))})})}getLabelmapImageIds(e){const n=e.Labelmap;let r;if(n.imageIds)r=n.imageIds;else if(!r&&n.volumeId){const i=n.volumeId;r=rt.getVolume(i).imageIds}return r}getLabelmapImageIdsForImageId(e,n){const r=this._generateMapKey({segmentationId:n,referenceImageId:e});return this._labelmapImageIdReferenceMap.get(r)}getCurrentLabelmapImageIdsForViewport(e,n){const r=ti(e);if(!r)return;const a=r.viewport.getCurrentImageId();return this.getLabelmapImageIdsForImageId(a,n)}getCurrentLabelmapImageIdForViewport(e,n){const r=ti(e);if(!r||!this._stackLabelmapImageIdReferenceMap.has(n))return;const a=r.viewport.getCurrentImageId();return this._stackLabelmapImageIdReferenceMap.get(n).get(a)}getStackSegmentationImageIdsForViewport(e,n){if(!this.getSegmentation(n))return[];this._updateAllLabelmapSegmentationImageReferences(e,n);const{viewport:i}=ti(e),a=i.getImageIds(),o=this._stackLabelmapImageIdReferenceMap.get(n);return a.map(s=>o.get(s))}removeSegmentationRepresentationsInternal(e,n){const r=[];return this.updateState(i=>{if(!i.viewportSegRepresentations[e])return;const a=i.viewportSegRepresentations[e];let o=!1;if(!n||Object.values(n).every(s=>s===void 0))r.push(...a),delete i.viewportSegRepresentations[e];else{const{segmentationId:s,type:c}=n;i.viewportSegRepresentations[e]=a.filter(u=>{const d=s&&c&&u.segmentationId===s&&u.type===c||s&&!c&&u.segmentationId===s||!s&&c&&u.type===c;return d&&(r.push(u),u.active&&(o=!0)),!d}),i.viewportSegRepresentations[e].length===0?delete i.viewportSegRepresentations[e]:o&&(i.viewportSegRepresentations[e][0].active=!0)}}),r}removeSegmentationRepresentations(e,n){const r=this.removeSegmentationRepresentationsInternal(e,n);r.forEach(a=>{jS(e,a.segmentationId,a.type)});const i=this.getSegmentationRepresentations(e);return i.length>0&&i[0].active&&Oh(e,i[0].segmentationId,i[0].type),r}removeSegmentationRepresentation(e,n,r){const i=this.removeSegmentationRepresentationsInternal(e,n);return r||i.forEach(({segmentationId:a,type:o})=>{jS(e,a,o)}),i}_updateLabelmapImageIdReferenceMap({segmentationId:e,referenceImageId:n,labelmapImageId:r}){const i=this._generateMapKey({segmentationId:e,referenceImageId:n});if(!this._labelmapImageIdReferenceMap.has(i)){this._labelmapImageIdReferenceMap.set(i,[r]);return}const a=this._labelmapImageIdReferenceMap.get(i),o=Array.from(new Set([...a,r]));this._labelmapImageIdReferenceMap.set(i,o)}_setActiveSegmentation(e,n,r){const i=e.viewportSegRepresentations[n];i&&i.forEach(a=>{a.active=a.segmentationId===r})}setActiveSegmentation(e,n){this.updateState(r=>{const i=r.viewportSegRepresentations[e];i&&i.forEach(a=>{a.active=a.segmentationId===n})}),Oh(e,n)}getActiveSegmentation(e){if(!this.state.viewportSegRepresentations[e])return;const n=this.state.viewportSegRepresentations[e].find(r=>r.active);if(n)return this.getSegmentation(n.segmentationId)}getSegmentationRepresentations(e,n={}){const r=this.state.viewportSegRepresentations[e];return r?!n.type&&!n.segmentationId?r:r.filter(i=>{const a=n.type?i.type===n.type:!0,o=n.segmentationId?i.segmentationId===n.segmentationId:!0;return a&&o}):[]}getSegmentationRepresentation(e,n){return this.getSegmentationRepresentations(e,n)[0]}getSegmentationRepresentationVisibility(e,n){return this.getSegmentationRepresentation(e,n)?.visible}setSegmentationRepresentationVisibility(e,n,r){this.updateState(i=>{const a=this.getSegmentationRepresentations(e,n);a&&a.forEach(o=>{o.visible=r,Object.entries(o.segments).forEach(([s,c])=>{c.visible=r})})}),Oh(e,n.segmentationId,n.type)}addColorLUT(e,n){this.updateState(r=>{r.colorLUT[n]&&console.warn("Color LUT table already exists, overwriting"),r.colorLUT[n]=es(e)})}removeColorLUT(e){this.updateState(n=>{delete n.colorLUT[e]})}_getStackIdForImageIds(e){return e.map(n=>n.slice(-Math.round(n.length*.15))).join("_")}getAllViewportSegmentationRepresentations(){return Object.entries(this.state.viewportSegRepresentations).map(([e,n])=>({viewportId:e,representations:n}))}getSegmentationRepresentationsBySegmentationId(e){const n=[];return Object.entries(this.state.viewportSegRepresentations).forEach(([r,i])=>{const a=i.filter(o=>o.segmentationId===e);a.length>0&&n.push({viewportId:r,representations:a})}),n}_generateMapKey({segmentationId:e,referenceImageId:n}){return`${e}-${n}`}}function KS(t){const e=Xc.newInstance(),n=Gl.newInstance();return n.addPoint(0,0),t===At.Labelmap?{cfun:e,ofun:n}:{}}const Ks=new cne("DEFAULT");function Al(t,e={}){return Ks.getSegmentationRepresentations(t,e)}function lne(t,e){const n=Ks;if(!e.segmentationId||!e.type)throw new Error("getSegmentationRepresentation: No segmentationId or type provided, you need to provide at least one of them");return n.getSegmentationRepresentations(t,e)?.[0]}function une(t,e){const n=mt(t),{viewport:r}=n,a=r.getActors().filter(o=>o.representationUID&&typeof o.representationUID=="string"&&o.representationUID.startsWith(e));r.removeActors(a.map(o=>o.uid))}function kb(t,e,n){const r=ti(t);if(!r)return;const{renderingEngine:i,viewport:a}=r;if(!i||!a)return;const s=a.getActors().filter(n);return s.length>0?s[0]:void 0}function fne(t,e){const n=ti(t);if(!n)return;const{renderingEngine:r,viewport:i}=n;if(!r||!i)return;const o=i.getActors().filter(e);return o.length>0?o:void 0}function gne(t,e){return dne(t,e)?.uid}function o1(t,e){return fne(t,n=>n.representationUID?.startsWith(`${e}-${At.Labelmap}`))}function dne(t,e){return kb(t,e,n=>n.representationUID?.startsWith(`${e}-${At.Labelmap}`))}function hne(t,e,n){return kb(t,e,r=>r.representationUID===Gb(e,n))}function Gb(t,e){return`${t}-${At.Surface}-${e}`}function pne(t,e,n){const r=mt(t),{viewport:i}=r,o=hne(i.id,n,e.segmentIndex)?.actor,s=e.visible;if(o){if(o.setVisibility(s),!s)return;const S=o.getMapper(),w=S.getInputData(),x=e.points,R=e.polys,O=w.getPoints().getData(),b=w.getPolys().getData();if(x.length===O.length&&R.length===b.length)return;const I=$c.newInstance();I.getPoints().setData(x,3);const G=$l.newInstance({values:Float32Array.from(R)});I.setPolys(G),S.setInputData(I),S.modified(),i.getRenderer().resetCameraClippingRange();return}const c=e.points,u=e.polys,d=e.color,g=$c.newInstance();g.getPoints().setData(c,3);const h=$l.newInstance({values:Float32Array.from(u)});g.setPolys(h);const m=tD.newInstance({});let y;m.setInputData(g);const v=Hq.newInstance();v.setMapper(m),v.getProperty().setColor(d[0]/255,d[1]/255,d[2]/255),v.getProperty().setLineWidth(2);const C=Gb(n,e.segmentIndex);i.addActor({uid:Ui(),actor:v,clippingFilter:y,representationUID:C}),i.resetCamera(),i.getRenderer().resetCameraClippingRange(),i.render()}function Pa(t){return Ks.getSegmentation(t)}function oy(t){return Ks.getColorLUT(t)}let av={};function mne(t){av=t}let YS=!1;function jc(){if(!av.addons?.polySeg)return console.warn("PolySeg add-on not configured. This will prevent automatic conversion between segmentation representations (labelmap, contour, surface). To enable these features, install @cornerstonejs/polymorphic-segmentation and register it during initialization: cornerstoneTools.init({ addons: { polySeg } })."),null;const t=av.addons.polySeg;return YS||(t.init(),YS=!0),t}function vne({segmentationId:t,type:e,data:n}){const r=Pa(t);if(!r)throw new Error(`Segmentation ${t} not found`);switch(r.representationData[e]&&console.warn(`Representation data of type ${e} already exists for segmentation ${t}, overwriting it.`),e){case At.Labelmap:n&&(r.representationData[e]=n);break;case At.Contour:n&&(r.representationData[e]=n);break;case At.Surface:n&&(r.representationData[e]=n);break;default:throw new Error(`Invalid representation type ${e}`)}}function Bb(t){const e=typeof t;return t!==null&&(e==="object"||e==="function")}function $b(t,e,n){let r,i,a,o,s,c,u=0,d=!1,g=!1,h=!0;const m=!e&&e!==0&&typeof window.requestAnimationFrame=="function";if(typeof t!="function")throw new TypeError("Expected a function");e=Number(e)||0,Bb(n)&&(d=!!n.leading,g="maxWait"in n,a=g?Math.max(Number(n.maxWait)||0,e):a,h="trailing"in n?!!n.trailing:h);function y(F){const $=r,z=i;return r=i=void 0,u=F,o=t.apply(z,$),o}function v(F,$){return m?window.requestAnimationFrame(F):setTimeout(F,$)}function C(F){if(m)return window.cancelAnimationFrame(F);clearTimeout(F)}function S(F){return u=F,s=v(R,e),d?y(F):o}function w(F){const $=F-c,z=F-u,oe=e-$;return g?Math.min(oe,a-z):oe}function x(F){const $=F-c,z=F-u;return c===void 0||$>=e||$<0||g&&z>=a}function R(){const F=Date.now();if(x(F))return O(F);s=v(R,w(F))}function O(F){return s=void 0,h&&r?y(F):(r=i=void 0,o)}function b(){s!==void 0&&C(s),u=0,r=c=i=s=void 0}function I(){return s===void 0?o:O(Date.now())}function G(){return s!==void 0}function j(...F){const $=Date.now(),z=x($);if(r=F,i=this,c=$,z){if(s===void 0)return S(c);if(g)return s=v(R,e),y(c)}return s===void 0&&(s=v(R,e)),o}return j.cancel=b,j.flush=I,j.pending=G,j}const g2=new Map;async function sy(t,e,n,r,i){const a=await n();vne({segmentationId:t,type:e,data:a}),i?.(),g2.has(t)||g2.set(t,[]);const o=g2.get(t);return o.includes(e)||o.push(e),yne(r),Xp(t),a}function yne(t){const e=n=>{Tne(n,t)};t._debouncedUpdateFunction=e,Ye.removeEventListener(Le.SEGMENTATION_DATA_MODIFIED,t._debouncedUpdateFunction),Ye.addEventListener(Le.SEGMENTATION_DATA_MODIFIED,t._debouncedUpdateFunction)}const Tne=$b((t,e)=>{const n=t.detail.segmentationId,r=g2.get(n);!r||!r.length||(e(n),r.length&&Xp(n))},300);function cy(t,e){const n=lne(t,e);return n?Object.entries(n.segments).reduce((i,[a,o])=>(o.visible||i.add(Number(a)),i),new Set):new Set}function Cne(t,e,n=!1){const r=ti(t);if(!r)return;const{viewport:i}=r;une(i.element,e),n&&i.render()}async function Sne(t,e){const{segmentationId:n,type:r}=e,i=Pa(n);if(!i)return;let a=i.representationData[At.Surface];if(!a&&jc()?.canComputeRequestedRepresentation(n,At.Surface)){const u=jc();if(a=await sy(n,At.Surface,()=>u.computeSurfaceData(n,{viewport:t}),()=>u.updateSurfaceData(n,{viewport:t})),!a)throw new Error(`No Surface data found for segmentationId ${n} even we tried to compute it`)}else!a&&!jc()&&console.debug(`No surface data found for segmentationId ${n} and PolySeg add-on is not configured. Unable to convert from other representations to surface. Please register PolySeg using cornerstoneTools.init({ addons: { polySeg } }) to enable automatic conversion.`);if(!a){console.warn(`No Surface data found for segmentationId ${n}. Skipping render.`);return}const{geometryIds:o}=a;o?.size||console.warn(`No Surfaces found for segmentationId ${n}. Skipping render.`);const{colorLUTIndex:s}=e,c=oy(s);o.forEach(u=>{const d=rt.getGeometry(u);if(!d?.data){console.warn(`No Surfaces found for geometryId ${u}. Skipping render.`);return}const{segmentIndex:g}=d.data,m=cy(t.id,{segmentationId:n,type:r}).has(g),y=d.data,v=c[g];y.color=v.slice(0,3),y.visible=!m,pne(t.element,y,n)}),t.render()}const wne={render:Sne,removeRepresentation:Cne};function xne(t,e,n){const r=t.getImageIds();if(!r||!r.length)return;const i=r.map(a=>{const{imagePositionPatient:o}=it("imagePlaneModule",a),s=Ene(e,o,n);return{imageId:a,distance:s}});return i.sort((a,o)=>a.distance-o.distance),i[0].imageId}function Ene(t,e,n){const r=Ke();hn(r,t,e);const i=ft(r,n);return Math.abs(i)}function Rne(t,e){const{segmentation:n}=t.data,{segmentation:r}=e.data;return n.segmentationId===r.segmentationId&&n.segmentIndex===r.segmentIndex}class One{constructor(e){this.getGroupKey=n=>{if(typeof n=="string")return n;const i=mt(n);if(!i)throw new Error("Element not enabled, you must have an enabled element if you are not providing a FrameOfReferenceUID");return i.FrameOfReferenceUID},this._imageVolumeModifiedHandler=n=>{const r=n.detail,{FrameOfReferenceUID:i}=r,o=this.annotations[i];o&&Object.keys(o).forEach(s=>{o[s].forEach(u=>{u.invalidated!==void 0&&(u.invalidated=!0)})})},this.getFramesOfReference=()=>Object.keys(this.annotations),this.getAnnotations=(n,r)=>{const i=this.annotations;return i[n]?r?i[n][r]?i[n][r]:[]:i[n]:[]},this.getAnnotation=n=>{const r=this.annotations;for(const i in r){const a=r[i];for(const o in a){const s=a[o];for(const c of s)if(n===c.annotationUID)return c}}},this.getNumberOfAnnotations=(n,r)=>{const i=this.getAnnotations(n,r);if(!i.length)return 0;if(r)return i.length;let a=0;for(const o in i)a+=i[o].length;return a},this.addAnnotation=(n,r)=>{const{metadata:i}=n,{FrameOfReferenceUID:a,toolName:o}=i;r=r||a;const s=this.annotations;let c=s[r];c||(s[r]={},c=s[r]);let u=c[o];u||(c[o]=[],u=c[o]),this.preprocessingFn&&(n=this.preprocessingFn(n)),u.push(n)},this.removeAnnotation=n=>{const{annotations:r}=this;for(const i in r){const a=r[i];for(const o in a){const s=a[o],c=s.findIndex(u=>u.annotationUID===n);c!==-1&&(s.splice(c,1),s.length===0&&delete a[o])}Object.keys(a).length===0&&delete r[i]}},this.removeAnnotations=(n,r)=>{const i=this.annotations,a=[];if(!i[n])return a;if(r){const o=i[n][r];for(const s of o)this.removeAnnotation(s.annotationUID),a.push(s)}else for(const o in i[n]){const s=i[n][o];for(const c of s)this.removeAnnotation(c.annotationUID),a.push(c)}return a},this.saveAnnotations=(n,r)=>{const i=this.annotations;if(n&&r){const a=i[n];if(!a)return;const o=a[r];return structuredClone(o)}else if(n){const a=i[n];return structuredClone(a)}return structuredClone(i)},this.restoreAnnotations=(n,r,i)=>{const a=this.annotations;if(r&&i){let o=a[r];o||(a[r]={},o=a[r]),o[i]=n}else r?a[r]=n:this.annotations=structuredClone(n)},this.getAllAnnotations=()=>Object.values(this.annotations).map(n=>Object.values(n)).flat(2),this.getNumberOfAllAnnotations=()=>{let n=0;const r=this.annotations;for(const i in r){const a=r[i];for(const o in a){const s=a[o];n+=s.length}}return n},this.removeAllAnnotations=()=>{const n=[];for(const r of this.getAllAnnotations())this.removeAnnotation(r.annotationUID),n.push(r);return n},e||(e=Ui()),this.annotations={},this.uid=e,Ye.addEventListener(We.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedHandler)}setPreprocessingFn(e){this.preprocessingFn=e}}const Dne=new One("DEFAULT"),d2=new Set;function _ne(t,e=!0){const n=Mne();t&&(e?Lne(t,d2,n):Vne(t,d2,n)),Ine(n,d2)}function ff(t){return d2.has(t)}function bne(t){const e=ff(t);return _ne(t,e),e}function Mne(){return Object.freeze({added:[],removed:[],locked:[]})}function Lne(t,e,n){if(!e.has(t)){e.add(t),n.added.push(t);const r=Xi(t);r&&(r.isLocked=!0)}}function Vne(t,e,n){if(e.delete(t)){n.removed.push(t);const r=Xi(t);r&&(r.isLocked=!1)}}function Ine(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(n=>void t.locked.push(n)),je(Ye,Le.ANNOTATION_LOCK_CHANGE,t))}const U0=new Set;function Vs(t,e=!0,n=!1){e?Ane(t,n):Wb(t)}function Ane(t,e=!1){const n=zb();if(!e){Hb(U0,n);const r=Xi(t);r&&(r.isSelected=!0)}if(t&&!U0.has(t)){U0.add(t),n.added.push(t);const r=Xi(t);r&&(r.isSelected=!0)}jb(n,U0)}function Wb(t){const e=zb();if(t){if(U0.delete(t)){e.removed.push(t);const n=Xi(t);n.isSelected=!1}}else Hb(U0,e);jb(e,U0)}function Zp(t){return U0.has(t)}function zb(){return Object.freeze({added:[],removed:[],selection:[]})}function Hb(t,e){t.forEach(n=>{if(t.delete(n)){e.removed.push(n);const r=Xi(n);r&&(r.isSelected=!1)}})}function jb(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(n=>void t.selection.push(n)),je(Ye,Le.ANNOTATION_SELECTION_CHANGE,t))}const Nne=t=>(t.data||(t.data={}),t.data.handles||(t.data.handles={}),t.data.handles.textBox||(t.data.handles.textBox={}),t),Pne=t=>(t.data||(t.data={}),t.data.cachedStats||(t.data.cachedStats={}),t),O1=new Set;function Une(t,e=!0){const n=Fne();t&&(e?kne(t,O1,n):Gne(t,O1,n)),Bne(n)}function ip(t){if(Xi(t))return!O1.has(t)}function Fne(){return Object.freeze({lastVisible:[],lastHidden:[],hidden:[]})}function kne(t,e,n){if(e.delete(t)){n.lastVisible.push(t);const r=Xi(t);r.isVisible=!0}}function Gne(t,e,n){e.has(t)||(e.add(t),Zp(t)&&Wb(t),n.lastHidden.push(t))}function Bne(t){(t.lastHidden.length>0||t.lastVisible.length>0)&&(O1.forEach(e=>void t.hidden.push(e)),je(Ye,Le.ANNOTATION_VISIBILITY_CHANGE,t))}function $ne(t){const e=!O1.has(t);return Une(t,e),e}const ly=Dne,Wne=t=>{t=Nne(t),t=Pne(t);const e=t.annotationUID,n=bne(e);t.isLocked=n;const r=$ne(e);return t.isVisible=r,t};ly.setPreprocessingFn(Wne);ny(ly);function zne(){ny(ly)}function zl(t){if(!t.data.segmentation)throw new Error("removeContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:e,segmentIndex:n}=t.data.segmentation,r=Pa(e),{annotationUIDsMap:i}=r?.representationData.Contour||{},a=i?.get(n);a&&(a.delete(t.annotationUID),a.size||i.delete(n))}function Hl(t){if(t.parentAnnotationUID)return;if(!t.data.segmentation)throw new Error("addContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:e,segmentIndex:n}=t.data.segmentation,r=Pa(e);r.representationData.Contour||(r.representationData.Contour={annotationUIDsMap:new Map});let{annotationUIDsMap:i}=r.representationData.Contour;i||(i=new Map);let a=i?.get(n);a||(a=new Set,i.set(n,a)),i.set(n,a.add(t.annotationUID))}function qb(t){const r=Ks.getState().viewportSegRepresentations;return Object.entries(r).filter(([,a])=>a.some(o=>o.segmentationId===t)).map(([a])=>a)}var ro;(function(t){t[t.CounterClockwise=-1]="CounterClockwise",t[t.Unknown=0]="Unknown",t[t.Clockwise=1]="Clockwise"})(ro||(ro={}));function Hne(t,e){return t.minX<=e.maxX&&t.maxX>=e.minX&&t.minY<=e.maxY&&t.maxY>=e.minY}class jne{}const{PointsManager:qne}=js;function ov(t){return{max:[-1/0],min:[1/0],sum:[0],count:0,maxIJK:null,maxLPS:null,minIJK:null,minLPS:null,runMean:[0],m2:[0],m3:[0],m4:[0],allValues:[[]],pointsInShape:t?qne.create3(1024):null,sumLPS:[0,0,0]}}function Kne(t,e,n=null,r=null){Array.isArray(e)&&e.length>1&&t.max.length===1&&(t.max.push(t.max[0],t.max[0]),t.min.push(t.min[0],t.min[0]),t.sum.push(t.sum[0],t.sum[0]),t.runMean.push(0,0),t.m2.push(t.m2[0],t.m2[0]),t.m3.push(t.m3[0],t.m3[0]),t.m4.push(t.m4[0],t.m4[0]),t.allValues.push([],[])),t?.pointsInShape&&n&&t.pointsInShape.push(n);const i=Array.isArray(e)?e:[e];t.count+=1,n&&(t.sumLPS[0]+=n[0],t.sumLPS[1]+=n[1],t.sumLPS[2]+=n[2]),t.max.forEach((a,o)=>{const s=i[o];t.allValues[o].push(s);const c=t.count,u=s-t.runMean[o],d=u/c,g=u*d*(c-1);t.sum[o]+=s,t.runMean[o]+=d,t.m4[o]+=g*d*d*(c*c-3*c+3)+6*d*d*t.m2[o]-4*d*t.m3[o],t.m3[o]+=g*d*(c-2)-3*d*t.m2[o],t.m2[o]+=g,s<t.min[o]&&(t.min[o]=s,o===0&&(t.minIJK=r?[...r]:null,t.minLPS=n?[...n]:null)),s>t.max[o]&&(t.max[o]=s,o===0&&(t.maxIJK=r?[...r]:null,t.maxLPS=n?[...n]:null))})}function Yne(t){if(t.length===0)return 0;const e=[...t].sort((r,i)=>r-i),n=Math.floor(e.length/2);return e.length%2===0?(e[n-1]+e[n])/2:e[n]}function Xne(t,e){const n=t.sum.map(g=>g/t.count),r=t.m2.map(g=>Math.sqrt(g/t.count)),i=t.sumLPS.map(g=>g/t.count),a=t.m3.map((g,h)=>{const m=t.m2[h]/t.count;return m===0?0:g/(t.count*Math.pow(m,1.5))}),o=t.m4.map((g,h)=>{const m=t.m2[h]/t.count;return m===0?0:g/(t.count*m*m)-3}),s=t.allValues.map(g=>Yne(g)),c={max:{name:"max",label:"Max Pixel",value:t.max.length===1?t.max[0]:t.max,unit:e,pointIJK:t.maxIJK?[...t.maxIJK]:null,pointLPS:t.maxLPS?[...t.maxLPS]:null},min:{name:"min",label:"Min Pixel",value:t.min.length===1?t.min[0]:t.min,unit:e,pointIJK:t.minIJK?[...t.minIJK]:null,pointLPS:t.minLPS?[...t.minLPS]:null},mean:{name:"mean",label:"Mean Pixel",value:n.length===1?n[0]:n,unit:e},stdDev:{name:"stdDev",label:"Standard Deviation",value:r.length===1?r[0]:r,unit:e},count:{name:"count",label:"Voxel Count",value:t.count,unit:null},median:{name:"median",label:"Median",value:s.length===1?s[0]:s,unit:e},skewness:{name:"skewness",label:"Skewness",value:a.length===1?a[0]:a,unit:null},kurtosis:{name:"kurtosis",label:"Kurtosis",value:o.length===1?o[0]:o,unit:null},maxLPS:{name:"maxLPS",label:"Max LPS",value:t.maxLPS?Array.from(t.maxLPS):null,unit:null},minLPS:{name:"minLPS",label:"Min LPS",value:t.minLPS?Array.from(t.minLPS):null,unit:null},pointsInShape:t.pointsInShape,center:{name:"center",label:"Center",value:i?[...i]:null,unit:null},array:[]};c.array.push(c.min,c.max,c.mean,c.stdDev,c.median,c.skewness,c.kurtosis,c.count,c.maxLPS,c.minLPS),c.center.value&&c.array.push(c.center);const u=t.pointsInShape!==null,d=ov(u);return t.max=d.max,t.min=d.min,t.sum=d.sum,t.count=d.count,t.maxIJK=d.maxIJK,t.maxLPS=d.maxLPS,t.minIJK=d.minIJK,t.minLPS=d.minLPS,t.runMean=d.runMean,t.m2=d.m2,t.m3=d.m3,t.m4=d.m4,t.allValues=d.allValues,t.pointsInShape=d.pointsInShape,t.sumLPS=d.sumLPS,c}const Dl=class Dl extends jne{static statsInit(e){e.storePointData||(this.state.pointsInShape=null),this.state=ov(e.storePointData)}};Dl.state=ov(!0),Dl.statsCallback=({value:e,pointLPS:n=null,pointIJK:r=null})=>{Kne(Dl.state,e,n,r)},Dl.getStatistics=e=>Xne(Dl.state,e?.unit);let sv=Dl;function jl(t,e){if(t.length!==e.length)throw Error("Both points should have the same dimensionality");const[n,r,i=0]=t,[a,o,s=0]=e,c=a-n,u=o-r,d=s-i;return c*c+u*u+d*d}function Kb(t,e){return Math.sqrt(jl(t,e))}function Zne(t,e,n){let r;const i=jl(t,e);if(t[0]===e[0]&&t[1]===e[1]&&(r=t),!r){const a=((n[0]-t[0])*(e[0]-t[0])+(n[1]-t[1])*(e[1]-t[1]))/i;a<0?r=t:a>1?r=e:r=[t[0]+a*(e[0]-t[0]),t[1]+a*(e[1]-t[1])]}return{point:[...r],distanceSquared:jl(n,r)}}function Qne(t,e,n){return Zne(t,e,n).distanceSquared}const Mg=.01;function r4(t,e,n){const r=t[0]<=e[0]?t[0]:e[0],i=t[0]>=e[0]?t[0]:e[0],a=t[1]<=e[1]?t[1]:e[1],o=t[1]>=e[1]?t[1]:e[1];if(!(n[0]>=r-Mg&&n[0]<=i+Mg&&n[1]>=a-Mg&&n[1]<=o+Mg))return!1;const c=(e[1]-t[1])*(n[0]-e[0])-(e[0]-t[0])*(n[1]-e[1]);return(c>=0?c:-c)<=Mg}function Yb(t){if(t.length<3)return!1;const e=t.length,n=t[0],r=t[e-1],i=jl(n,r);return M2(0,i)}function fa(t,e,n={closed:void 0}){if(t.length<3)return!1;const r=t.length;let i=0;const{closed:a,holes:o}=n;if(o?.length){for(const u of o)if(fa(u,e))return!1}const s=!(a===void 0?Yb(t):a),c=t.length-(s?1:2);for(let u=0;u<=c;u++){const d=t[u],g=u===r-1?0:u+1,h=t[g],m=d[0]>=h[0]?d[0]:h[0],y=d[1]>=h[1]?d[1]:h[1],v=d[1]<=h[1]?d[1]:h[1];if(e[0]<=m&&e[1]>=v&&e[1]<y){let w=d[0]===h[0];if(!w){const x=(e[1]-d[1])*(h[0]-d[0])/(h[1]-d[1])+d[0];w=e[0]<=x}i+=w?1:0}}return!!(i%2)}function X1(t,e){for(let n=0,r=e.length;n<r;n++)if(!fa(t,e[n]))return!1;return!0}function ap(t,e){let n=t;const r=e?.numDimensions||2,i=r===3;if(!Array.isArray(t[0])){const g=t,h=g.length/r;n=new Array(g.length/r);for(let m=0,y=h;m<y;m++)n[m]=[g[m*r],g[m*r+1]],i&&n[m].push(g[m*r+2])}let a=1/0,o=1/0,s=-1/0,c=-1/0,u=1/0,d=-1/0;n=n;for(let g=0,h=n.length;g<h;g++){const[m,y,v]=n[g];a=a<m?a:m,o=o<y?o:y,s=s>m?s:m,c=c>y?c:y,i&&(u=u<v?u:v,d=d>v?d:v)}return i?{minX:a,maxX:s,minY:o,maxY:c,minZ:u,maxZ:d}:{minX:a,maxX:s,minY:o,maxY:c}}function uy(t){const e=t.length;let n=0,r=e-1;for(let i=0;i<e;i++)n+=(t[r][0]+t[i][0])*(t[r][1]-t[i][1]),r=i;return Math.abs(n/2)}function B0(t){if(t.length<3)return 0;const e=t[0];let n=0;for(let r=0,i=t.length;r<i;r++){const a=t[r],o=r===i-1?0:r+1,s=t[o],c=a[0]-e[0],u=a[1]-e[1],d=s[0]-e[0],g=s[1]-e[1];n+=c*g-u*d}return n*=.5,n}function h2(t){return B0(t)>=0?1:-1}function Jne(t){const e=Ke(),n=t[0];for(let r=0,i=t.length;r<i;r++){const a=t[r],o=r===i-1?0:r+1,s=t[o],c=a[0]-n[0],u=a[1]-n[1],d=a[2]-n[2],g=s[0]-n[0],h=s[1]-n[1],m=s[2]-n[2];e[0]+=u*m-d*h,e[1]+=d*g-c*m,e[2]+=c*h-u*g}return bs(e,e,.5),e}function ere(t){const e=Jne(t);return Sn(e,e)}function cv(t){const e=B0(t);return[0,0,e/Math.abs(e)]}const Jr=1e-7;function i4(t,e){return t[0]*e[1]-t[1]*e[0]}function dr(t,e){return Tn(t,e,Jr)}function Xb(t,e,n,r){const i=Ni(tr(),e,t),a=Ni(tr(),r,n),o=i4(i,a),s=Ni(tr(),n,t),c=i4(s,i);if(Math.abs(o)<Jr){if(Math.abs(c)<Jr){const g=Cl(i,i),h=Cl(a,a);if(g<Jr||h<Jr)return dr(t,n)||dr(t,r)?t:dr(e,n)||dr(e,r)?e:null;const m=Cl(Ni(tr(),n,t),i)/g,y=Cl(Ni(tr(),r,t),i)/g,v=Cl(Ni(tr(),t,n),a)/h,C=Cl(Ni(tr(),e,n),a)/h,S=w=>w>=-Jr&&w<=1+Jr;if(S(m)){const w=ah(tr(),t,i,m);if(dr(n,w))return n}if(S(y)){const w=ah(tr(),t,i,y);if(dr(r,w))return r}if(S(v)){const w=ah(tr(),n,a,v);if(dr(t,w))return t}if(S(C)){const w=ah(tr(),n,a,C);if(dr(e,w))return e}}return null}const u=i4(s,a)/o,d=c/o;return u>=-Jr&&u<=1+Jr&&d>=-Jr&&d<=1+Jr?[t[0]+u*i[0],t[1]+u*i[1]]:null}var Ac;(function(t){t[t.Vertex=0]="Vertex",t[t.Intersection=1]="Intersection"})(Ac||(Ac={}));var ji;(function(t){t[t.Entering=0]="Entering",t[t.Exiting=1]="Exiting",t[t.Unknown=2]="Unknown"})(ji||(ji={}));function Zb(t,e){if(t.length!==e.length)return!1;const n=t.length;if(n===0)return!0;let r=!0;for(let a=0;a<n;a++)if(!dr(t[a],e[a])){r=!1;break}if(r)return!0;let i=!0;for(let a=0;a<n;a++)if(!dr(t[a],e[n-1-a])){i=!1;break}if(i)return!0;for(let a=1;a<n;a++){let o=!0;for(let c=0;c<n;c++)if(!dr(t[c],e[(c+a)%n])){o=!1;break}if(o)return!0;let s=!0;for(let c=0;c<n;c++)if(!dr(t[c],e[(n-1-c+a)%n])){s=!1;break}if(s)return!0}return!1}function fy(t,e){if(t.length<3)return[];if(e.length<3)return[t.slice()];const n=e.slice();if(Zb(t,e))return[];const r=B0(t),i=B0(n);Math.sign(r)===Math.sign(i)&&Math.abs(i)>Jr&&n.reverse();const a=[];for(let d=0;d<t.length;d++){const g=t[d],h=t[(d+1)%t.length];for(let m=0;m<n.length;m++){const y=n[m],v=n[(m+1)%n.length],C=Xb(g,h,y,v);if(C){const S=Math.sqrt(P0(g,h)),w=Math.sqrt(P0(y,v));a.push({coord:C,seg1Idx:d,seg2Idx:m,alpha1:S<Jr?0:Math.sqrt(P0(g,C))/S,alpha2:w<Jr?0:Math.sqrt(P0(y,C))/w})}}}const o=(d,g,h)=>{const m=[];let y=0;for(let C=0;C<d.length;C++){const S=d[C];m.push({id:`${g}_v${y++}`,coordinates:S,type:Ac.Vertex,originalPolyIndex:g,originalVertexIndex:C,next:null,prev:null,isIntersection:!1,visited:!1});const w=h.filter(x=>(g===0?x.seg1Idx:x.seg2Idx)===C).sort((x,R)=>(g===0?x.alpha1:x.alpha2)-(g===0?R.alpha1:R.alpha2));for(const x of w){if(m.length>0&&dr(m[m.length-1].coordinates,x.coord)){m[m.length-1].isIntersection||(m[m.length-1].isIntersection=!0,m[m.length-1].intersectionInfo=x,m[m.length-1].alpha=g===0?x.alpha1:x.alpha2);continue}m.push({id:`${g}_i${y++}`,coordinates:x.coord,type:Ac.Intersection,originalPolyIndex:g,next:null,prev:null,isIntersection:!0,visited:!1,alpha:g===0?x.alpha1:x.alpha2,intersectionInfo:x})}}const v=[];if(m.length>0){v.push(m[0]);for(let C=1;C<m.length;C++)dr(m[C].coordinates,v[v.length-1].coordinates)?m[C].isIntersection&&(v[v.length-1].isIntersection=!0,v[v.length-1].intersectionInfo=m[C].intersectionInfo,v[v.length-1].alpha=m[C].alpha):v.push(m[C])}if(v.length>0)for(let C=0;C<v.length;C++)v[C].next=v[(C+1)%v.length],v[C].prev=v[(C-1+v.length)%v.length];return v},s=o(t,0,a),c=o(n,1,a);s.forEach(d=>{if(d.isIntersection){const g=d.intersectionInfo,h=c.find(m=>m.isIntersection&&dr(m.coordinates,d.coordinates)&&m.intersectionInfo.seg1Idx===g.seg1Idx&&m.intersectionInfo.seg2Idx===g.seg2Idx);if(h){d.partnerNode=h,h.partnerNode=d;const m=d.prev.coordinates,y=d.coordinates,v=h.next.coordinates;Ni(tr(),y,m),Ni(tr(),v,y);const C=[(d.prev.coordinates[0]+d.coordinates[0])/2,(d.prev.coordinates[1]+d.coordinates[1])/2];fa(e,C)?d.intersectionDir=ji.Exiting:d.intersectionDir=ji.Entering}else d.isIntersection=!1}}),s.forEach(d=>delete d.intersectionInfo),c.forEach(d=>delete d.intersectionInfo);const u=[];for(let d=0;d<s.length;d++){const g=s[d];if(g.visited||g.isIntersection||fa(e,g.coordinates))continue;const h=[];let m=g,y=!0,v=0;const C=(s.length+c.length)*2;do{if(v++>C){console.warn("Subtraction: Max iterations reached, possible infinite loop.");break}m.visited=!0,(h.length===0||!dr(h[h.length-1],m.coordinates))&&h.push(m.coordinates),m.isIntersection&&(y?m.intersectionDir===ji.Entering&&m.partnerNode&&(m=m.partnerNode,y=!1):m.partnerNode?(m=m.partnerNode,y=!0):console.warn("Subtraction: Intersection on source without partner.")),m=m.next}while(m!==g||!y);h.length>=3&&(dr(h[0],h[h.length-1])&&h.pop(),h.length>=3&&u.push(h))}return u}function tre(t,e){if(t.length<3||e.length<3)return[];let n=e.slice();const r=B0(t),i=B0(n);if(Math.abs(r)<Jr||Math.abs(i)<Jr)return[];r<0&&(t=t.slice().reverse()),i<0&&(n=n.slice().reverse());const a=n,o=[];for(let g=0;g<t.length;g++){const h=t[g],m=t[(g+1)%t.length];for(let y=0;y<n.length;y++){const v=n[y],C=n[(y+1)%n.length],S=Xb(h,m,v,C);if(S){const w=Math.sqrt(P0(h,m)),x=Math.sqrt(P0(v,C));o.push({coord:[...S],seg1Idx:g,seg2Idx:y,alpha1:w<Jr?0:Math.sqrt(P0(h,S))/w,alpha2:x<Jr?0:Math.sqrt(P0(v,S))/x})}}}if(o.length===0)return fa(a,t[0])&&t.every(g=>fa(a,g))?[[...t.map(g=>[...g])]]:fa(t,n[0])&&n.every(g=>fa(t,g))?[[...n.map(g=>[...g])]]:[];const s=(g,h,m)=>{const y=[];let v=0;for(let S=0;S<g.length;S++){const w=g[S];y.push({id:`${h}_v${v++}`,coordinates:[...w],type:Ac.Vertex,originalPolyIndex:h,originalVertexIndex:S,next:null,prev:null,isIntersection:!1,visited:!1,processedInPath:!1,intersectionDir:ji.Unknown});const x=m.filter(R=>(h===0?R.seg1Idx:R.seg2Idx)===S).sort((R,O)=>(h===0?R.alpha1:R.alpha2)-(h===0?O.alpha1:O.alpha2));for(const R of x){if(y.length>0&&dr(y[y.length-1].coordinates,R.coord)){const O=y[y.length-1];O.isIntersection||(O.isIntersection=!0,O.intersectionInfo=R,O.alpha=h===0?R.alpha1:R.alpha2,O.type=Ac.Intersection);continue}y.push({id:`${h}_i${v++}`,coordinates:[...R.coord],type:Ac.Intersection,originalPolyIndex:h,next:null,prev:null,isIntersection:!0,visited:!1,processedInPath:!1,alpha:h===0?R.alpha1:R.alpha2,intersectionInfo:R,intersectionDir:ji.Unknown})}}const C=[];if(y.length>0){C.push(y[0]);for(let S=1;S<y.length;S++)if(!dr(y[S].coordinates,C[C.length-1].coordinates))C.push(y[S]);else{const w=C[C.length-1];y[S].isIntersection&&y[S].intersectionInfo&&(w.isIntersection=!0,w.intersectionInfo=y[S].intersectionInfo,w.alpha=y[S].alpha,w.type=Ac.Intersection)}}if(C.length>1&&dr(C[0].coordinates,C[C.length-1].coordinates)){const S=C[0],w=C.pop();w.isIntersection&&!S.isIntersection&&w.intersectionInfo&&(S.isIntersection=!0,S.intersectionInfo=w.intersectionInfo,S.alpha=w.alpha,S.type=Ac.Intersection)}if(C.length>0)for(let S=0;S<C.length;S++)C[S].next=C[(S+1)%C.length],C[S].prev=C[(S-1+C.length)%C.length];return C},c=s(t,0,o),u=s(n,1,o);if(c.length===0||u.length===0)return[];c.forEach(g=>{if(g.isIntersection&&g.intersectionInfo){const h=g.intersectionInfo,m=u.find(y=>y.isIntersection&&y.intersectionInfo&&dr(y.coordinates,g.coordinates)&&y.intersectionInfo.seg1Idx===h.seg1Idx&&y.intersectionInfo.seg2Idx===h.seg2Idx);if(m){g.partnerNode=m,m.partnerNode=g;const y=Ni(tr(),g.coordinates,g.prev.coordinates),v=Ni(tr(),m.next.coordinates,m.coordinates),C=y[0]*v[1]-y[1]*v[0];if(C>Jr)g.intersectionDir=ji.Entering,m.intersectionDir=ji.Exiting;else if(C<-Jr)g.intersectionDir=ji.Exiting,m.intersectionDir=ji.Entering;else{const S=[(g.prev.coordinates[0]+g.coordinates[0])/2,(g.prev.coordinates[1]+g.coordinates[1])/2];fa(a,S)?(g.intersectionDir=ji.Exiting,m.intersectionDir=ji.Entering):(g.intersectionDir=ji.Entering,m.intersectionDir=ji.Exiting)}}else g.isIntersection=!1,g.intersectionInfo=void 0}});const d=[];for(const g of c){if(!g.isIntersection||g.visited||g.intersectionDir!==ji.Entering)continue;let h=[],m=g,y=!0;const v=g;let C=0;const S=(c.length+u.length)*2;c.forEach(w=>w.processedInPath=!1),u.forEach(w=>w.processedInPath=!1);do{if(C++>S){console.warn("Intersection: Max iterations in path tracing.",v.id,m.id),h=[];break}if(m.processedInPath&&m!==v){console.warn("Intersection: Path processing loop detected, discarding path segment.",v.id,m.id),h=[];break}m.processedInPath=!0,m.visited=!0,(h.length===0||!dr(h[h.length-1],m.coordinates))&&h.push([...m.coordinates]);let w=!1;m.isIntersection&&m.partnerNode&&(y?(m=m.partnerNode,y=!1,w=!0):(m=m.partnerNode,y=!0,w=!0)),m=m.next}while(m!==v||y&&m.originalPolyIndex!==0||!y&&m.originalPolyIndex!==1);if(C>S||h.length===0||h.length>0&&dr(h[0],h[h.length-1])&&h.pop(),h.length>=3){const w=B0(h);(r>0&&w<0||r<0&&w>0)&&h.reverse(),d.push(h.map(x=>[...x]))}}return d}function gy(t,e,n,r){let i=!1;const a=t[0]<e[0]?t[0]:e[0],o=t[1]<e[1]?t[1]:e[1],s=t[0]>e[0]?t[0]:e[0],c=t[1]>e[1]?t[1]:e[1],u=n[0]<r[0]?n[0]:r[0],d=n[1]<r[1]?n[1]:r[1],g=n[0]>r[0]?n[0]:r[0],h=n[1]>r[1]?n[1]:r[1];if(a>g||s<u||o>h||c<d)return!1;const m=[Dh(t,e,n),Dh(t,e,r),Dh(n,r,t),Dh(n,r,e)];return m[0]!==m[1]&&m[2]!==m[3]?!0:((m[0]===0&&_h(t,n,e)||m[1]===0&&_h(t,r,e)||m[2]===0&&_h(n,t,r)||m[3]===0&&_h(n,e,r))&&(i=!0),i)}function Dh(t,e,n){const r=(e[1]-t[1])*(n[0]-e[0])-(e[0]-t[0])*(n[1]-e[1]);return r===0?0:r>0?1:2}function _h(t,e,n){return e[0]<=Math.max(t[0],n[0])&&e[0]>=Math.min(t[0],n[0])&&e[1]<=Math.max(t[1],n[1])&&e[1]>=Math.min(t[1],n[1])}function dy(t,e,n,r=!0){const i=[],a=t.length,o=a-(r?1:2);for(let s=0;s<=o;s++){const c=t[s],u=s===a-1?0:s+1,d=t[u];gy(e,n,c,d)&&i.push([s,u])}return i}function Qb(t,e,n,r=!0){let i,a;r?(a=t.length-1,i=0):(a=0,i=1);for(let o=i;o<t.length;o++){const s=t[a],c=t[o];if(gy(e,n,s,c))return[a,o];a=o}}function hy(t,e){for(let n=0,r=t.length;n<r;n++){const i=t[n],a=n===r-1?0:n+1,o=t[a];if(Qb(e,i,o)?.length===2)return!0}return!1}const nre=.01;function Jb(t,e,n,r){const i=[e[0]-t[0],e[1]-t[1]],a=[r[0]-n[0],r[1]-n[1]],o=a[1]*i[0]-a[0]*i[1];if((o>=0?o:-o)<nre){const y=[t[0]<e[0]?t[0]:e[0],t[0]>e[0]?t[0]:e[0],t[1]<e[1]?t[1]:e[1],t[1]>e[1]?t[1]:e[1]],v=[n[0]<r[0]?n[0]:r[0],n[0]>r[0]?n[0]:r[0],n[1]<r[1]?n[1]:r[1],n[1]>r[1]?n[1]:r[1]];if(!(y[0]<=v[1]&&y[1]>=v[0]&&y[2]<=v[3]&&y[3]>=v[2])||!(r4(t,e,n)||r4(t,e,r)||r4(n,r,t)))return;const w=y[0]>v[0]?y[0]:v[0],x=y[1]<v[1]?y[1]:v[1],R=y[2]>v[2]?y[2]:v[2],O=y[3]<v[3]?y[3]:v[3],b=(w+x)*.5,I=(R+O)*.5;return[b,I]}let c=t[1]-n[1],u=t[0]-n[0];const d=a[0]*c-a[1]*u,g=i[0]*c-i[1]*u;c=d/o,u=g/o;const h=t[0]+c*i[0],m=t[1]+c*i[1];return[h,m]}var Nl;(function(t){t[t.Vertex=0]="Vertex",t[t.Intersection=1]="Intersection"})(Nl||(Nl={}));var Pl;(function(t){t[t.Outside=-1]="Outside",t[t.Edge=0]="Edge",t[t.Inside=1]="Inside"})(Pl||(Pl={}));var zu;(function(t){t[t.Exiting=-1]="Exiting",t[t.Unknown=0]="Unknown",t[t.Entering=1]="Entering"})(zu||(zu={}));function XS(t){for(let e=0,n=t.length;e<n;e++){const r=t[e];r.next||(r.next=t[e===n-1?0:e+1])}}function rre(t,e){const n=[],r=[],i=new Map;let o=fa(e,t[0])?zu.Exiting:zu.Entering;for(let s=0,c=t.length;s<c;s++){const u=t[s],d=fa(e,u),g={type:Nl.Vertex,coordinates:u,position:d?Pl.Inside:Pl.Outside,visited:!1,next:null};n.push(g);const h=t[s===c-1?0:s+1],m=dy(e,u,h).map(y=>{const v=y[0],C=e[y[0]],S=e[y[1]],w=Jb(u,h,C,S),x=jl(u,w);return{sourceLineSegmentId:v,coordinate:w,targetStartPointDistSquared:x}});m.sort((y,v)=>y.targetStartPointDistSquared-v.targetStartPointDistSquared),m.forEach(y=>{const{sourceLineSegmentId:v,coordinate:C}=y,S={type:Nl.Intersection,coordinates:C,position:Pl.Edge,direction:o,visited:!1,next:null},w={...S,direction:zu.Unknown,cloned:!0};o===zu.Entering?S.next=w:w.next=S;let x=i.get(v);x||(x=[],i.set(v,x)),n.push(S),x.push(w),o*=-1})}for(let s=0,c=e.length;s<c;s++){const u=s,d=e[s],g={type:Nl.Vertex,coordinates:d,visited:!1,next:null};r.push(g);const h=i.get(u);h?.length&&h.map(m=>({intersectionPoint:m,lineSegStartDistSquared:jl(d,m.coordinates)})).sort((m,y)=>m.lineSegStartDistSquared-y.lineSegStartDistSquared).map(({intersectionPoint:m})=>m).forEach(m=>r.push(m))}return XS(n),XS(r),{targetPolylinePoints:n,sourcePolylinePoints:r}}function ire(t){for(let e=0,n=t.length;e<n;e++){const r=t[e];if(!r.visited&&r.position===Pl.Outside&&r.type===Nl.Vertex)return r}for(let e=0,n=t.length;e<n;e++){const r=t[e];if(!r.visited&&r.position===Pl.Outside)return r}}function py(t,e){const n=cv(t),r=cv(e),i=ft(r,n);if(M2(1,i)||(e=e.slice().reverse()),!hy(e,t)&&X1(e,t))return e.slice();const{targetPolylinePoints:s}=rre(t,e),c=ire(s);if(!c)return t.slice();const u=[c.coordinates];let d=c.next,g=0;const h=t.length+e.length+1e3;for(;d!==c&&g<h;){if(g++,d.type===Nl.Intersection&&d.cloned){d=d.next;continue}if(u.push(d.coordinates),d=d.next,!d){console.warn("Broken linked list detected in mergePolylines, breaking loop");break}}return g>=h&&console.warn("Maximum iterations reached in mergePolylines, possible infinite loop detected"),u}const are=.1;function eM(t,e=are){const n=t.length;if(n<3)return t;const r=e*e,i=[[0,n-1]],a=new Array(n).fill(!1);let o=2;for(a[0]=!0,a[n-1]=!0;i.length;){const[c,u]=i.pop();if(u-c===1)continue;const d=t[c],g=t[u];let h=-1/0,m=-1;for(let y=c+1;y<u;y++){const v=t[y],C=Qne(d,g,v);C>h&&(h=C,m=y)}h<r||(a[m]=!0,o++,i.push([m,u]),i.push([c,m]))}const s=new Array(o);for(let c=0,u=0;c<n;c++)a[c]&&(s[u++]=t[c]);return s}function tM(t,e,n,r=!0){const i=[],a=dy(t,e,n,r);for(let o=0;o<a.length;o++){const s=t[a[o][0]],c=t[a[o][1]],u=Jb(e,n,s,c);i.push(u)}return i}function ore(t,e,n,r=!0){let i,a;r?(a=t.length-1,i=0):(a=0,i=1);const o=[];for(let d=i;d<t.length;d++){const g=t[a],h=t[d];gy(e,n,g,h)&&o.push([a,d]),a=d}if(o.length===0)return;const s=[];o.forEach(d=>{const g=[t[d[0]],t[d[1]]],h=[(g[0][0]+g[1][0])/2,(g[0][1]+g[1][1])/2];s.push(wi(h,e))});const c=Math.min(...s),u=s.indexOf(c);return{segment:o[u],distance:c}}const Au=.001,sre=(t,e)=>{let n,r,i;if(t instanceof Na){const o=t.getImageData();if(!o)return;r=o.direction.slice(0,3),i=o.direction.slice(3,6),n=o.spacing}else{const o=t.getImageData(),{direction:s,spacing:c}=o,{viewPlaneNormal:u,viewUp:d}=t.getCamera(),g=s.slice(0,3),h=s.slice(3,6),m=s.slice(6,9),y=Ke();Cn(y,d,u);const v=Math.abs(ft(y,g)),C=Math.abs(ft(y,h)),S=Math.abs(ft(y,m));let w;if(Math.abs(1-v)<Au)w=c[0],r=g;else if(Math.abs(1-C)<Au)w=c[1],r=h;else if(Math.abs(1-S)<Au)w=c[2],r=m;else throw new Error("No support yet for oblique plane planar contours");const x=Math.abs(ft(d,g)),R=Math.abs(ft(d,h)),O=Math.abs(ft(d,m));let b;if(Math.abs(1-x)<Au)b=c[0],i=g;else if(Math.abs(1-R)<Au)b=c[1],i=h;else if(Math.abs(1-O)<Au)b=c[2],i=m;else throw new Error("No support yet for oblique plane planar contours");n=[w,b]}return{spacing:[n[0]/e,n[1]/e],xDir:r,yDir:i}},cre=(t,e,n)=>Qv(t,e)<n,lre=(t,e,n,r)=>{const{xDir:i,yDir:a,spacing:o}=r,s=mt(t),{viewport:c}=s;if(!e.length)return e.push(n),console.log(">>>>> !canvasPoints. :: RETURN"),1;const u=c.canvasToWorld(e[e.length-1]),d=c.canvasToWorld(n),g=Ke();ei(g,d,u);const h=Math.abs(ft(g,i)),m=Math.abs(ft(g,a)),y=Math.max(Math.floor(h/o[0]),Math.floor(m/o[0]));if(y>1){const v=e[e.length-1],C=Qv(v,n),S=tr();Ni(S,n,v),Yu(S,S[0]/C,S[1]/C);const w=C/y;for(let x=1;x<=y;x++)e.push([v[0]+w*S[0]*x,v[1]+w*S[1]*x])}else e.push(n);return y},ure=(t,e,n,r)=>{const i=[t[0]-e[0],t[1]-e[1]],a=[n[0]-e[0],n[1]-e[1]],o=i[0]*a[0]+i[1]*a[1];if(o<0)return!1;const s=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(s===0)return!1;const c=o/s,u=[a[0]/s,a[1]/s],d=[u[0]*c,u[1]*c],g=[e[0]+d[0],e[1]+d[1]];return!(wi(t,g)>r||wi(e,g)>wi(e,n))},fre=1e-6;function nM(t){let e;const n=$8(t,50);for(let o=0;o<3;o++)if(n.every((s,c,u)=>Math.abs(s[o]-u[0][o])<fre)){e=o;break}if(e===void 0)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const r=[],i=(e+1)%3,a=(e+2)%3;for(let o=0;o<t.length;o++)r.push([t[o][i],t[o][a]]);return{sharedDimensionIndex:e,projectedPolyline:r}}function gre(t,e,n={}){const{sharedDimensionIndex:r,projectedPolyline:i}=nM(e),{holes:a}=n,o=[];if(a)for(let c=0;c<a.length;c++){const u=a[c],d=[];for(let g=0;g<u.length;g++)d.push([u[g][(r+1)%3],u[g][(r+2)%3]]);o.push(d)}const s=[t[(r+1)%3],t[(r+2)%3]];return fa(i,s,{holes:o})}function dre(t){if(t.length<3)return t.slice();const e=t.map(a=>[a[0],a[1]]).sort((a,o)=>a[0]===o[0]?a[1]-o[1]:a[0]-o[0]);function n(a,o,s){return(o[0]-a[0])*(s[1]-a[1])-(o[1]-a[1])*(s[0]-a[0])}const r=[];for(const a of e){for(;r.length>=2&&n(r[r.length-2],r[r.length-1],a)<=0;)r.pop();r.push(a)}const i=[];for(let a=e.length-1;a>=0;a--){const o=e[a];for(;i.length>=2&&n(i[i.length-2],i[i.length-1],o)<=0;)i.pop();i.push(o)}return r.pop(),i.pop(),r.concat(i)}const Ql=Object.freeze(Object.defineProperty({__proto__:null,addCanvasPointsToArray:lre,arePolylinesIdentical:Zb,containsPoint:fa,containsPoints:X1,convexHull:dre,decimate:eM,getAABB:ap,getArea:uy,getClosestLineSegmentIntersection:ore,getFirstLineSegmentIntersectionIndexes:Qb,getLineSegmentIntersectionsCoordinates:tM,getLineSegmentIntersectionsIndexes:dy,getNormal2:cv,getNormal3:ere,getSignedArea:B0,getSubPixelSpacingAndXYDirections:sre,getWindingDirection:h2,intersectPolyline:hy,intersectPolylines:tre,isClosed:Yb,isPointInsidePolyline3D:gre,mergePolylines:py,pointCanProjectOnLine:ure,pointsAreWithinCloseContourProximity:cre,projectTo2D:nM,subtractPolylines:fy},Symbol.toStringTag,{value:"Module"}));function ZS(t,e){let n=[0,0],r=Number.MAX_SAFE_INTEGER;return t.forEach(function(i){const a=hre(e,i);a<r&&(r=a,n=[...i])}),n}function hre(t,e){const[n,r]=t,[i,a]=e;return Math.sqrt(Math.pow(n-i,2)+Math.pow(r-a,2))}function Ys(t,e,n,r){const{canvasToWorld:i,worldToCanvas:a}=n,{data:o}=t,{targetWindingDirection:s}=e;let{points:c}=e,u=h2(c);r?.decimate?.enabled&&(c=eM(e.points,r?.decimate?.epsilon));let{closed:d}=e;const g=c.length,h=new Array(g);h2(c);const m=ib(t);if(d===void 0){let y=!1;if(c.length>3){const v=jl(c[0],c[g-1]);y=Tn(0,v)}d=y}if(r?.updateWindingDirection!==!1){let y=m?m.data.contour.windingDirection*-1:s;y===void 0&&(y=u),y!==u&&c.reverse();const v=(o.handles?.points??[]).map(a);v.length>2&&h2(v)!==y&&o.handles.points.reverse(),u=y}for(let y=0;y<g;y++)h[y]=i(c[y]);o.contour.polyline=h,o.contour.closed=d,o.contour.windingDirection=u,ab(t)}const pre="viewport-element";function mre(t){const e=mt(t),{viewportId:n,renderingEngineId:r}=e,i=`${n}:${r}`,a=vre(t);return Object.keys(ht.svgNodeCache[i]).forEach(o=>{ht.svgNodeCache[i][o].touched=!1}),{svgLayerElement:a,svgNodeCacheForCanvas:ht.svgNodeCache,getSvgNode:yre.bind(this,i),appendNode:Tre.bind(this,a,i),setNodeTouched:Cre.bind(this,i),clearUntouched:Sre.bind(this,a,i)}}function vre(t){const e=`.${pre}`;return t.querySelector(e)?.querySelector(":scope > .svg-layer")}function yre(t,e){if(ht.svgNodeCache[t]&&ht.svgNodeCache[t][e])return ht.svgNodeCache[t][e].domRef}function Tre(t,e,n,r){if(!ht.svgNodeCache[e])return null;ht.svgNodeCache[e][r]={touched:!0,domRef:n},t.appendChild(n)}function Cre(t,e){ht.svgNodeCache[t]&&ht.svgNodeCache[t][e]&&(ht.svgNodeCache[t][e].touched=!0)}function Sre(t,e){ht.svgNodeCache[e]&&Object.keys(ht.svgNodeCache[e]).forEach(n=>{const r=ht.svgNodeCache[e][n];!r.touched&&r.domRef&&(t.removeChild(r.domRef),delete ht.svgNodeCache[e][n])})}function wre(t,e){const n=mre(t);e(n),n.clearUntouched()}function Z1(t,e,n){return`${t}::${e}::${n}`}function ql(t,e){Object.keys(t).forEach(n=>{const r=e.getAttribute(n),i=t[n];i===void 0||i===""?e.removeAttribute(n):r!==i&&e.setAttribute(n,i)})}function Qp(t,e){Object.keys(t).forEach(n=>{const r=t[n];r!==void 0&&r!==""&&e.setAttribute(n,r)})}function xre(t,e,n,r,i={},a){const{color:o,handleRadius:s,width:c,lineWidth:u,fill:d,type:g,opacity:h}=Object.assign({color:"rgb(0, 255, 0)",handleRadius:"6",width:"2",lineWidth:void 0,fill:"transparent",type:"circle",opacity:1},i),m=u||c,y="http://www.w3.org/2000/svg",v=Z1(e,"handle",`hg-${n}-index-${a}`);let C;if(g==="circle")C={cx:`${r[0]}`,cy:`${r[1]}`,r:s,stroke:o,fill:d,"stroke-width":m,opacity:h};else if(g==="rect"){const x=parseFloat(s)*1.5,R=r[0]-x*.5,O=r[1]-x*.5;C={x:`${R}`,y:`${O}`,width:`${x}`,height:`${x}`,stroke:o,fill:d,"stroke-width":m,rx:`${x*.1}`,opacity:h}}else throw new Error(`Unsupported handle type: ${g}`);const S=t.getSvgNode(v);if(S)ql(C,S),t.setNodeTouched(v);else{const w=document.createElementNS(y,g);Qp(C,w),t.appendNode(w,v)}}function lv(t,e,n,r,i={}){r.forEach((a,o)=>{xre(t,e,n,a,i,o)})}function Ere(t,e,n,r,i,a={},o=""){if(isNaN(r[0])||isNaN(r[1])||isNaN(i[0])||isNaN(i[1]))return;const{color:s="rgb(0, 255, 0)",width:c=10,lineWidth:u,lineDash:d,markerStartId:g=null,markerEndId:h=null,shadow:m=!1,strokeOpacity:y=1}=a,v=u||c,C="http://www.w3.org/2000/svg",S=Z1(e,"line",n),w=t.getSvgNode(S),x=t.svgLayerElement.id,R=m?`filter:url(#shadow-${x});`:"",O={x1:`${r[0]}`,y1:`${r[1]}`,x2:`${i[0]}`,y2:`${i[1]}`,stroke:s,style:R,"stroke-width":v,"stroke-dasharray":d,"marker-start":g?`url(#${g})`:"","marker-end":h?`url(#${h})`:"","stroke-opacity":y};if(w)ql(O,w),t.setNodeTouched(S);else{const b=document.createElementNS(C,"line");o!==""&&b.setAttribute("data-id",o),Qp(O,b),t.appendNode(b,S)}}function gf(t,e,n,r,i){if(r.length<2)return;const{color:a="rgb(0, 255, 0)",width:o=10,fillColor:s="none",fillOpacity:c=0,lineWidth:u,lineDash:d,closePath:g=!1,markerStartId:h=null,markerEndId:m=null}=i,y=u||o,v="http://www.w3.org/2000/svg",C=Z1(e,"polyline",n),S=t.getSvgNode(C);let w="";for(const R of r)w+=`${R[0].toFixed(1)}, ${R[1].toFixed(1)} `;if(g){const R=r[0];w+=`${R[0]}, ${R[1]}`}const x={points:w,stroke:a,fill:s,"fill-opacity":c,"stroke-width":y,"stroke-dasharray":d,"marker-start":h?`url(#${h})`:"","marker-end":m?`url(#${m})`:""};if(S)ql(x,S),t.setNodeTouched(C);else{const R=document.createElementNS(v,"polyline");Qp(x,R),t.appendNode(R,C)}}function nf(t,e,n,r,i){const o=r.length&&r[0].length&&Array.isArray(r[0][0])?r:[r],{color:s="rgb(0, 255, 0)",width:c=10,fillColor:u="none",fillOpacity:d=0,lineWidth:g,lineDash:h,closePath:m=!1}=i,y=g||c,v="http://www.w3.org/2000/svg",C=Z1(e,"path",n),S=t.getSvgNode(C);let w="";for(let R=0,O=o.length;R<O;R++){const b=o[R],I=b.length;if(!(I<2)){for(let G=0;G<I;G++){const j=b[G];w+=`${G?"L":"M"} ${j[0].toFixed(1)}, ${j[1].toFixed(1)} `}m&&(w+="Z ")}}if(!w)return;const x={d:w,stroke:s,fill:u,"fill-opacity":d,"stroke-width":y,"stroke-dasharray":h};if(S)ql(x,S),t.setNodeTouched(C);else{const R=document.createElementNS(v,"path");Qp(x,R),t.appendNode(R,C)}}function Rre(t,e,n,r,i,a={}){const o=Object.assign({fontFamily:"Helvetica, Arial, sans-serif",fontSize:"14px",color:"rgb(255, 255, 0)",background:"",padding:25,centerX:!1,centerY:!0},a);return Ore(t,e,n,r,i,o)}function Ore(t,e,n,r=[""],i,a){const{padding:o,color:s,fontFamily:c,fontSize:u,background:d}=a;let g;const[h,m]=[i[0]+o,i[1]+o],y="http://www.w3.org/2000/svg",v=Z1(e,"text",n),C=t.getSvgNode(v);if(C){const S=C.querySelector("text"),w=Array.from(S.children);for(let O=0;O<w.length;O++){const b=w[O],I=r[O]||"";b.textContent=I}if(r.length>w.length){for(let O=0;O<r.length-w.length;O++){const b=r[O+w.length],I=QS(b);S.appendChild(I)}C.appendChild(S),t.appendNode(C,v)}const x={fill:s,"font-size":u,"font-family":c},R={transform:`translate(${h} ${m})`};ql(x,S),ql(R,C),C.setAttribute("data-annotation-uid",e),g=JS(C,d),t.setNodeTouched(v)}else{const S=document.createElementNS(y,"g");S.setAttribute("data-annotation-uid",e),S.setAttribute("transform",`translate(${h} ${m})`);const w=Dre(t,a);for(let x=0;x<r.length;x++){const R=r[x],O=QS(R);w.appendChild(O)}S.appendChild(w),t.appendNode(S,v),g=JS(S,d)}return Object.assign({},g,{x:h,y:m,height:g.height+o,width:g.width+o})}function Dre(t,e){const{color:n,fontFamily:r,fontSize:i}=e,o=document.createElementNS("http://www.w3.org/2000/svg","text"),s="user-select: none; pointer-events: none; -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);",c=`filter:url(#shadow-${t.svgLayerElement.id});`,u=`${s}${c}`;return o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("fill",n),o.setAttribute("font-family",r),o.setAttribute("font-size",i),o.setAttribute("style",u),o.setAttribute("pointer-events","visible"),o}function QS(t){const n=document.createElementNS("http://www.w3.org/2000/svg","tspan");return n.setAttribute("x","0"),n.setAttribute("dy","1.2em"),n.textContent=t,n}function JS(t,e){let n=t.querySelector("rect.background");if(!e)return n&&t.removeChild(n),t.getBBox();n||(n=document.createElementNS("http://www.w3.org/2000/svg","rect"),n.setAttribute("class","background"),t.insertBefore(n,t.firstChild));const r=t.getBBox(),i={x:`${r.x}`,y:`${r.y}`,width:`${r.width}`,height:`${r.height}`,fill:e};return ql(i,n),r}function _re(t,e,n,r,i,a,o={}){const s=r.length>0?ZS(r,i):i,c=bre(a),u=ZS(c,s),d=Object.assign({color:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"2,3"},o);Ere(t,e,`link-${n}`,s,u,d)}function bre(t){const{x:e,y:n,height:r,width:i}=t,a=i/2,o=r/2,s=[e+a,n],c=[e,n+o],u=[e+a,n+r],d=[e+i,n+o];return[s,c,u,d]}function Mre(t,e,n,r,i,a,o,s={}){const c=Object.assign({handleRadius:"6",centering:{x:!1,y:!0}},s),u=Rre(t,e,n,r,i,c);return _re(t,e,n,a,i,u,c),u}function Lre(t,e){const n=mt(t),{renderingEngineId:r,viewportId:i}=n,a=Qi(i,r);if(!a)return[];const o=[],s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const u=s[c],d=a.toolOptions[u];if(d&&e.includes(d.mode)){const g=a.getToolInstance(u);o.push(g)}}return o}const{Active:Vre,Passive:Ire,Enabled:Are}=Kn;class Nre{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._renderFlaggedViewports=()=>{this._throwIfDestroyed();const e=Array.from(this._viewportElements.values());for(let n=0;n<e.length;n++){const r=e[n];if(this._needsRender.has(r)&&(this._triggerRender(r),this._needsRender.delete(r),this._needsRender.size===0))break}this._animationFrameSet=!1,this._animationFrameHandle=null,this._render()},this._viewportElements=new Map}addViewportElement(e,n){this._viewportElements.set(e,n)}removeViewportElement(e,n){this._viewportElements.delete(e),this._needsRender.delete(n),this._reset()}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setAllViewportsToBeRenderedNextFrame(){[...this._viewportElements.values()].forEach(n=>{this._needsRender.add(n)}),this._renderFlaggedViewports()}_setViewportsToBeRenderedNextFrame(e){const n=[...this._viewportElements.values()];e.forEach(r=>{n.indexOf(r)!==-1&&this._needsRender.add(r)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_triggerRender(e){const n=mt(e);if(!n)return;if(!Yc(n.renderingEngineId)){console.warn("rendering Engine has been destroyed");return}const i=Lre(e,[Vre,Ire,Are]),{renderingEngineId:a,viewportId:o}=n,s={element:e,renderingEngineId:a,viewportId:o};wre(e,c=>{let u=!1;const d=g=>{if(g.renderAnnotation){const h=g.renderAnnotation(n,c);u=u||h}};i.forEach(d),u&&je(e,Le.ANNOTATION_RENDERED,{...s})})}_reset(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._setAllViewportsToBeRenderedNextFrame()}}const my=new Nre;function Q1(t){my.renderViewport(t)}function pa(t){t.length&&t.forEach(e=>{const n=ti(e);if(!n){console.warn(`Viewport not available for ${e}`);return}const{viewport:r}=n;if(!r){console.warn(`Viewport not available for ${e}`);return}const i=r.element;Q1(i)})}function Pre(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const a=t[i];a.getFrameOfReferenceUID()===e&&r.push(a)}return r}const{Active:Ure,Passive:Fre,Enabled:kre}=Kn;function Gre(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const a=t[i],o=Qi(a.id,a.renderingEngineId);if(!o)continue;Bre(o,e)&&r.push(a)}return r}function Bre(t,e){const{toolOptions:n}=t,r=n[e];if(!r)return!1;const i=r.mode;return i===Ure||i===Fre||i===kre}function $re(t,e,n=.999){return t.filter(r=>{const i=r.getCamera();return Math.abs(ft(i.viewPlaneNormal,e.viewPlaneNormal))>n})}function s1(t,e,n=!0){const r=mt(t),{renderingEngine:i,FrameOfReferenceUID:a}=r;let o=i.getViewports();o=Pre(o,a),o=Gre(o,e);const s=i.getViewport(r.viewportId);return n&&(o=$re(o,s.getCamera())),o.map(u=>u.id)}const op="PlanarFreehandContourSegmentationTool";function vy(t,e){const n=t.length,r=new Array(n);for(let i=0;i<n;i++)r[i]=e.worldToCanvas(t[i]);return r}function Wre(t,e){return zp(e).map(n=>{const r=n,i=vy(r.data.contour.polyline,t);return{annotation:r,polyline:i}})}function rM(t,e,n){K1(e,n),zl(n);const{contour:r}=n.data,i=vy(r.polyline,t);Ys(n,{points:i,closed:r.closed,targetWindingDirection:e.data.contour.windingDirection===ro.Clockwise?ro.CounterClockwise:ro.Clockwise},t);const{element:a}=t;iM(t,[e,n])}function zre(t,e,n,r,i){if(!Hp(op)){console.warn(`${op} is not registered in cornerstone. Cannot combine polylines.`);return}const a=i[0],o=fa(n,a),s=Wre(t,e),c=new Set(s),u=new Map,d=(w,x)=>{let R=u.get(w);R||(R=[],u.set(w,R)),R.push(x),c.delete(x)},g=[];if(o){const w=py(n,i);g.push(w),Array.from(c.keys()).forEach(x=>d(w,x))}else fy(n,i).forEach(x=>{g.push(x),Array.from(c.keys()).forEach(R=>{X1(x,R.polyline)&&d(x,R)})});Array.from(u.values()).forEach(w=>w.forEach(x=>Wp(x.annotation)));const{element:h}=t,{metadata:m,data:y}=e,{handles:v,segmentation:C}=y,{textBox:S}=v;q0(r.annotationUID),q0(e.annotationUID),zl(r),zl(e);for(let w=0;w<g.length;w++){const x=g[w];if(!x||x.length<3){console.warn("Skipping creation of new annotation due to invalid polyline:",x);continue}const R=Hre(t,e,x);Wl(R,h),Hl(R),Ao(R,t.element),u.get(x)?.forEach(O=>K1(R,O.annotation))}iM(t,[e,r])}function Hre(t,e,n){const r=t.canvasToWorld(n[0]),i=t.canvasToWorld(n[n.length-1]),a={metadata:{...e.metadata,toolName:op,originalToolName:e.metadata.originalToolName||e.metadata.toolName},data:{cachedStats:{},handles:{points:[r,i],textBox:e.data.handles.textBox?{...e.data.handles.textBox}:void 0},contour:{polyline:[],closed:!0},spline:e.data.spline,segmentation:{...e.data.segmentation}},annotationUID:Ui(),highlighted:!0,invalidated:!0,isLocked:!1,isVisible:void 0,interpolationUID:e.interpolationUID,interpolationCompleted:e.interpolationCompleted};return Ys(a,{points:n,closed:!0,targetWindingDirection:ro.Clockwise},t),a}function iM(t,e){const{element:n}=t,r=new Set([op]);e.forEach(i=>{r.add(i.metadata.toolName)});for(const i of r.values())if(Hp(i)){const a=s1(n,i);pa(a)}}function Jp(t){return!!t.data?.segmentation}function jre(t,e,n){const r=[],i=ap(e);for(let a=0;a<n.length;a++){const o=n[a],s=qre(o.data.contour.polyline,t),c=ap(s);if(!Hne(i,c))continue;const d=hy(e,s),g=!d&&X1(s,e);(d||g)&&r.push({targetAnnotation:o,targetPolyline:s,isContourHole:g})}return r}function qre(t,e){const n=t.length,r=new Array(n);for(let i=0;i<n;i++)r[i]=e.worldToCanvas(t[i]);return r}const sp="PlanarFreehandContourSegmentationTool";function Kre(t,e,n,r){const i=r.filter(o=>o.isContourHole),a=r.filter(o=>!o.isContourHole);if(i.length>0){const o=i[0];Jre(t,o.targetAnnotation,e),aM(t,[e,o.targetAnnotation]);return}if(a.length!==0){if(!Hp(sp)){console.warn(`${sp} is not registered in cornerstone. Cannot process multiple intersections.`);return}Yre(t,e,n,a)}}function Yre(t,e,n,r){const{element:i}=t,a=[e],o=[],s=[];r.forEach(({targetAnnotation:h})=>{const m=Qre(t,h);s.push(...m),a.push(h)});const c=n[0];if(r.some(({targetPolyline:h})=>fa(h,c))){let h=n;r.forEach(({targetPolyline:m})=>{h=py(h,m)}),o.push(h)}else r.forEach(({targetPolyline:h})=>{const m=fy(h,n);o.push(...m)});a.forEach(h=>{q0(h.annotationUID),zl(h)}),s.forEach(h=>Wp(h.annotation));const d=r[0].targetAnnotation,g=[];o.forEach(h=>{if(!h||h.length<3){console.warn("Skipping creation of new annotation due to invalid polyline:",h);return}const m=Xre(t,d,h);Wl(m,i),Hl(m),Ao(m,t.element),g.push(m)}),Zre(t,s,g),aM(t,a)}function Xre(t,e,n){const r=t.canvasToWorld(n[0]),i=t.canvasToWorld(n[n.length-1]),a={metadata:{...e.metadata,toolName:sp,originalToolName:e.metadata.originalToolName||e.metadata.toolName},data:{cachedStats:{},handles:{points:[r,i],textBox:e.data.handles.textBox?{...e.data.handles.textBox}:void 0},contour:{polyline:[],closed:!0},spline:e.data.spline,segmentation:{...e.data.segmentation}},annotationUID:Ui(),highlighted:!0,invalidated:!0,isLocked:!1,isVisible:void 0,interpolationUID:e.interpolationUID,interpolationCompleted:e.interpolationCompleted};return Ys(a,{points:n,closed:!0,targetWindingDirection:ro.Clockwise},t),a}function Zre(t,e,n){e.forEach(r=>{const i=n.find(a=>{const o=yy(a.data.contour.polyline,t);return X1(o,r.polyline)});i&&K1(i,r.annotation)})}function Qre(t,e){return zp(e).map(n=>{const r=n,i=yy(r.data.contour.polyline,t);return{annotation:r,polyline:i}})}function Jre(t,e,n){K1(e,n),zl(n);const{contour:r}=n.data,i=yy(r.polyline,t);Ys(n,{points:i,closed:r.closed,targetWindingDirection:e.data.contour.windingDirection===ro.Clockwise?ro.CounterClockwise:ro.Clockwise},t)}function yy(t,e){const n=t.length,r=new Array(n);for(let i=0;i<n;i++)r[i]=e.worldToCanvas(t[i]);return r}function aM(t,e){const{element:n}=t,r=new Set([sp]);e.forEach(i=>{r.add(i.metadata.toolName)});for(const i of r.values())if(Hp(i)){const a=s1(n,i);pa(a)}}const{isEqual:ew}=js;function oM(t){const{metadata:e}=t;return uZ().filter(n=>{if(n.FrameOfReferenceUID===e.FrameOfReferenceUID){const r=n.viewport,{viewPlaneNormal:i,viewUp:a}=r.getCamera();return ew(i,e.viewPlaneNormal)&&(!e.viewUp||ew(a,e.viewUp))}}).map(n=>n.viewport)}function eie(t){if(!t)throw new Error(`No contours found for geometryId ${t.id}`);const e=t.id;if(t.type!==y2.CONTOUR)throw new Error(`Geometry type ${t.type} not supported for rendering.`);if(!t.data){console.warn(`No contours found for geometryId ${e}. Skipping render.`);return}}function tie(t,e,n,r){n.size?t.render():nie(t,e,r)}function nie(t,e,n){const{segmentationId:r}=n,i=new Map;e.forEach(a=>{const o=rt.getGeometry(a);if(!o){console.warn(`No geometry found for geometryId ${a}. Skipping render.`);return}const s=o.data.segmentIndex;eie(o);const c=tf.getStyle({viewportId:t.id,segmentationId:r,type:At.Contour,segmentIndex:s}),u=o.data,d=t.getCamera().viewPlaneNormal;u.contours.forEach(g=>{const{points:h,color:m,id:y}=g,v=xne(t,h[0],d),C={annotationUID:Ui(),data:{contour:{closed:!0,polyline:h},segmentation:{segmentationId:r,segmentIndex:s,color:m,id:y},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!0,isVisible:!0,metadata:{referencedImageId:v,toolName:"PlanarFreehandContourSegmentationTool",FrameOfReferenceUID:t.getFrameOfReferenceUID(),viewPlaneNormal:t.getCamera().viewPlaneNormal}},S=t.element;Wl(C,S),Hl(C)}),c&&i.set(s,c)}),t.render()}function rie(t,e,n=!1){const r=Pa(e),{annotationUIDsMap:i}=r.representationData.Contour;i.forEach(a=>{a.forEach(o=>{q0(o)})})}function iie(t){const e=Jte(t);if(e)return e;const n=Pa(t);if(!n)throw new Error(`No segmentation found for segmentationId ${t}`);let r;if(n.representationData.Labelmap)r=aie(n,t);else if(n.representationData.Contour)r=cie(n);else if(n.representationData.Surface)r=lie(n);else throw new Error(`Unsupported segmentation type: ${n.representationData}`);return ene(t,r),r}function aie(t,e){const n=t.representationData[At.Labelmap],r=new Set;return n.imageIds?sie(r,n.imageIds):oie(r,e),Array.from(r).map(Number).sort((i,a)=>i-a)}function oie(t,e){rt.getVolume(e).voxelManager.forEach(({value:r})=>{r!==0&&t.add(r)})}function sie(t,e){e.forEach(n=>{rt.getImage(n).voxelManager.getScalarData().forEach(a=>{a!==0&&t.add(a)})})}function cie(t){const{annotationUIDsMap:e,geometryIds:n}=t.representationData.Contour||{};if(!n)throw new Error(`No geometryIds found for segmentationId ${t.segmentationId}`);const r=new Set([...e.keys()]);return n.forEach(i=>{const a=rt.getGeometry(i);r.add(a.data.segmentIndex)}),Array.from(r).sort((i,a)=>i-a)}function lie(t){const e=t.representationData.Surface?.geometryIds??[];return Array.from(e.keys()).map(Number).sort((n,r)=>n-r)}const Nu=new Map,tw=new Map;function uie(t,e,n=!1){const r=ti(t);if(!r)return;const{viewport:i}=r;rie(t,e),n&&i.render()}async function fie(t,e){const{segmentationId:n}=e,r=Pa(n);if(!r)return;let i=r.representationData[At.Contour];const a=jc();if(!i&&jc()?.canComputeRequestedRepresentation(n,At.Contour)&&!Nu.get(t.id)?(Nu.set(t.id,!0),i=await sy(n,At.Contour,()=>a.computeContourData(n,{viewport:t}),()=>{}),Nu.set(t.id,!1)):!i&&!jc()&&console.debug(`No contour data found for segmentationId ${n} and PolySeg add-on is not configured. Unable to convert from other representations to contour. Please register PolySeg using cornerstoneTools.init({ addons: { polySeg } }) to enable automatic conversion.`),!i||!i.geometryIds?.length)return;let o=!1;const s=t.getCamera().viewPlaneNormal;i.annotationUIDsMap&&(o=!die(i.annotationUIDsMap,s)),i.geometryIds.length>0&&(o=!gie(i.geometryIds,s));const c=tw.get(t.id)||new Set;if(o&&!Nu.get(t.id)&&!c.has(n)&&t.viewportStatus===qi.RENDERED){Nu.set(t.id,!0);const u=iie(n),g=(await a.computeSurfaceData(n,{segmentIndices:u,viewport:t})).geometryIds,h=[];for(const C of g.values()){const w=rt.getGeometry(C).data;h.push({points:w.points,polys:w.polys,segmentIndex:w.segmentIndex,id:w.segmentIndex})}const m=await a.clipAndCacheSurfacesForViewport(h,t),y=a.extractContourData(m),v=a.createAndAddContourSegmentationsFromClippedSurfaces(y,t,n);i.annotationUIDsMap=new Map([...i.annotationUIDsMap,...v]),c.add(n),tw.set(t.id,c),Nu.set(t.id,!1)}tie(t,i.geometryIds,i.annotationUIDsMap,e)}function gie(t,e){let n=null,r=null;for(const g of t){const h=rt.getGeometry(g);if(!h)continue;const m=h.data;if(m.contours?.[0]?.points?.length>=3){n=h,r=m;break}}if(!n||!r)return!1;const a=r.contours[0].points,o=a[0],s=a[1],c=a[2];let u=Cn(Ke(),hn(Ke(),s,o),hn(Ke(),c,o));u=Sn(Ke(),u);const d=ft(u,e);return Math.abs(d)>.9}function die(t,e){const n=Array.from(t.values()).flat().map(i=>Array.from(i)).flat(),r=$8(n,3);for(const i of r){const a=Xi(i);if(a?.metadata){if(!a.metadata.viewPlaneNormal)continue;const o=a.metadata.viewPlaneNormal,s=Math.abs(e[0]*o[0]+e[1]*o[1]+e[2]*o[2]);if(Math.abs(s-1)>.01)return!1}}return!0}const hie={render:fie,removeRepresentation:uie};function D1(t,e){return Ks.getCurrentLabelmapImageIdsForViewport(t,e)}const nw=new Map,pie=({cfun:t,ofun:e,actor:n})=>{n.getProperty().setRGBTransferFunction(1,t),n.getProperty().setScalarOpacity(1,e)};async function mie({viewport:t,volumeInputs:e,segmentationId:n}){const r=t.getDefaultActor(),{actor:i}=r,{uid:a,callback:o}=r,s=t.getVolumeId();if(nw.get(a)?.added)return{uid:a,actor:i};const c=e,u=rt.getVolume(c[0].volumeId);if(!u)throw new Error(`imageVolume with id: ${u.volumeId} does not exist`);const{volumeId:d}=c[0],g=await UD(d);if(!g)throw new Error(`segImageVolume with id: ${g.volumeId} does not exist`);const m=g.voxelManager.getCompleteScalarDataArray(),{imageData:y}=g,v=rt.getVolume(s),S=v.voxelManager.getCompleteScalarDataArray(),w=2,x=new Float32Array(w*v.voxelManager.getScalarDataLength()),R=y.getDimensions();for(let j=0;j<R[2];++j)for(let F=0;F<R[1];++F)for(let $=0;$<R[0];++$){const z=$+R[0]*(F+R[1]*j);x[z*w+0]=S[z],x[z*w+1]=m[z]}t.removeActors([a]);const O=i.getMapper(),b=NK(O);i.setMapper(b),b.setBlendMode(F0.LABELMAP_EDGE_PROJECTION_BLEND);const I=b.getInputData().getPointData().getArray(0);I.setData(x),I.setNumberOfComponents(2),i.getProperty().setColorMixPreset(1),i.getProperty().setForceNearestInterpolation(1,!0),i.getProperty().setIndependentComponents(!0),t.addActor({actor:i,uid:a,callback:o,referencedId:s,representationUID:`${n}-${At.Labelmap}`}),nw.set(a,{added:!0,segmentationRepresentationUID:`${n}`,originalBlendMode:t.getBlendMode()}),i.set({preLoad:pie});function G(j){const{segmentationId:F}=j.detail,{representationData:$}=Pa(F),{volumeId:z}=$.Labelmap;if(z!==g.volumeId)return;const Q=rt.getVolume(z).voxelManager,le=b.getInputData(),X=le.getPointData().getArray(0),ie=X.getData(),ye=2,ge=y.getDimensions(),W=Array.from({length:ge[2]},(ae,fe)=>fe);for(const ae of W)for(let fe=0;fe<ge[1];++fe)for(let ue=0;ue<ge[0];++ue){const qe=ue+ge[0]*(fe+ge[1]*ae);ie[qe*ye+1]=Q.getAtIndex(qe)}X.setData(ie),le.modified(),t.render()}return Ye.addEventListenerDebounced(Le.SEGMENTATION_DATA_MODIFIED,G,200),Ye.addEventListener(Le.SEGMENTATION_REPRESENTATION_REMOVED,async j=>{Ye.removeEventListener(Le.SEGMENTATION_DATA_MODIFIED,G);const F=t.getActor(a),{element:$,id:z}=t;t.removeActors([a]);const oe=await H4({volumeId:a,blendMode:F0.MAXIMUM_INTENSITY_BLEND,callback:({volumeActor:Q})=>{F.callback&&F.callback({volumeActor:Q,volumeId:d})}},$,z);t.addActor({actor:oe,uid:a}),t.render()}),{uid:a,actor:i}}const{uuidv4:sM}=js;async function vie(t,e,n,r){const i=mt(t),{renderingEngine:a,viewport:o}=i,{id:s}=o,c=!0,u=!1,d=!0;if(o instanceof Vo){const h=yie(e,n);rt.getVolume(h)||await Tie(e);let m=r?.blendMode??F0.MAXIMUM_INTENSITY_BLEND,y=m===F0.LABELMAP_EDGE_PROJECTION_BLEND;if(y){const C=o.getVolumeId(),S=rt.getVolume(C),x=rt.getVolume(h).dimensions,R=S.dimensions;(x[0]!==R[0]||x[1]!==R[1]||x[2]!==R[2])&&(y=!1,m=F0.MAXIMUM_INTENSITY_BLEND,console.debug("Dimensions mismatch - falling back to regular volume addition"))}const v=[{volumeId:h,visibility:c,representationUID:`${n}-${At.Labelmap}`,useIndependentComponents:y,blendMode:m}];if(!v[0].useIndependentComponents)await MX(a,v,[s],u,d);else return await mie({viewport:o,volumeInputs:v,segmentationId:n})}else{const h=D1(o.id,n).map(m=>({imageId:m,representationUID:`${n}-${At.Labelmap}-${m}`}));LX(a,h,[s])}Yp(n)}function yie(t,e){let{volumeId:n}=t;if(!n){n=sM();const r=Pa(e);r.representationData.Labelmap={...r.representationData.Labelmap,volumeId:n},t.volumeId=n,Xp(e)}return n}async function Tie(t){const e=t;if(!(e.imageIds.length>0))throw new Error("cannot create labelmap, no imageIds found for the volume labelmap");return await bK(t.volumeId||sM(),e.imageIds)}function Cie(t,e){const n=mt(t),{viewport:r}=n;r.removeActors([gne(r.id,e)])}function Ty(t){return Ks.getActiveSegmentation(t)}function Sie(t){return Ty(t)}function Cy(t){const e=Pa(t);if(e){const n=Object.keys(e.segments).find(r=>e.segments[r].active);return n?Number(n):void 0}}const a4=255,c1=new Map;let o4=!1;function wie(t,e,n=!1){const r=ti(t);if(c1.forEach((a,o)=>{o.includes(e)&&c1.delete(o)}),!r)return;const{viewport:i}=r;Cie(i.element,e),n&&i.render()}async function xie(t,e){const{segmentationId:n,config:r}=e,i=Pa(n);if(!i){console.warn("No segmentation found for segmentationId: ",n);return}let a=i.representationData[At.Labelmap],o=o1(t.id,n);if(!a&&jc()?.canComputeRequestedRepresentation(n,At.Labelmap)&&!o4){o4=!0;const s=jc();if(a=await sy(n,At.Labelmap,()=>s.computeLabelmapData(n,{viewport:t}),()=>null,()=>{Ks.processLabelmapRepresentationAddition(t.id,n),setTimeout(()=>{Yp(n)},0)}),!a)throw new Error(`No labelmap data found for segmentationId ${n}.`);o4=!1}else!a&&!jc()&&console.debug(`No labelmap data found for segmentationId ${n} and PolySeg add-on is not configured. Unable to convert from other representations to labelmap. Please register PolySeg using cornerstoneTools.init({ addons: { polySeg } }) to enable automatic conversion.`);if(a){if(t instanceof Io)o?.length||await iw(t,a,n,r),o=o1(t.id,n);else{if(!D1(t.id,n)?.length)return;o||await iw(t,a,n,r),o=o1(t.id,n)}if(o?.length)for(const s of o)Eie(t.id,s,e)}}function Eie(t,e,n){const{segmentationId:r}=n,{cfun:i,ofun:a}=n.config,{colorLUTIndex:o}=n,c=Sie(t)?.segmentationId===r,u=tf.getStyle({viewportId:t,type:At.Labelmap,segmentationId:r}),d=tf.getRenderInactiveSegmentations(t),g=oy(o),h=Math.min(256,g.length),{outlineWidth:m,renderOutline:y,outlineOpacity:v,activeSegmentOutlineWidthDelta:C}=rw(u,c),S=cy(t,{segmentationId:r,type:At.Labelmap});for(let O=0;O<h;O++){const b=O,I=g[b],j=tf.getStyle({viewportId:t,type:At.Labelmap,segmentationId:r,segmentIndex:b}),{fillAlpha:F,outlineWidth:$,renderFill:z,renderOutline:oe}=rw(u,c,j),{forceOpacityUpdate:Q,forceColorUpdate:le}=Rie(t,r,b,{fillAlpha:F,renderFill:z,renderOutline:oe,segmentColor:I,outlineWidth:$,segmentsHidden:S,cfun:i,ofun:a});if(le&&i.addRGBPoint(b,I[0]/a4,I[1]/a4,I[2]/a4),Q)if(z){const X=S.has(b)?0:I[3]/255*F;a.removePoint(b),a.addPointLong(b,X,.5,1)}else a.addPointLong(b,.01,.5,1)}a.setClamping(!1);const w=e.actor,{preLoad:x}=w.get?.("preLoad")||{preLoad:null};if(x?x({cfun:i,ofun:a,actor:w}):(w.getProperty().setRGBTransferFunction(0,i),w.getProperty().setScalarOpacity(0,a),w.getProperty().setInterpolationTypeToNearest()),y){w.getProperty().setUseLabelOutline(y),w.getProperty().setLabelOutlineOpacity(v);const O=Cy(n.segmentationId),b=new Array(h-1);for(let I=1;I<h;I++){if(S.has(I)){b[I-1]=0;continue}b[I-1]=I===O?m+C:m}w.getProperty().setLabelOutlineThickness(b),w.modified(),w.getProperty().modified(),w.getMapper().modified()}else w.getProperty().setLabelOutlineThickness(new Array(h-1).fill(0));const R=c||d;w.setVisibility(R)}function rw(t,e,n){const i={...t,...n||{}},a=e?i.fillAlpha:i.fillAlphaInactive,o=e?i.outlineWidth:i.outlineWidthInactive,s=e?i.renderFill:i.renderFillInactive,c=e?i.renderOutline:i.renderOutlineInactive,u=e?i.outlineOpacity:i.outlineOpacityInactive,d=i.activeSegmentOutlineWidthDelta;return{fillAlpha:a,outlineWidth:o,renderFill:s,renderOutline:c,outlineOpacity:u,activeSegmentOutlineWidthDelta:d}}function Rie(t,e,n,{fillAlpha:r,renderFill:i,renderOutline:a,segmentColor:o,outlineWidth:s,segmentsHidden:c,cfun:u,ofun:d}){const g=`${t}-${e}-${n}`,h=c1.get(g);if(!h)return c1.set(g,{fillAlpha:r,renderFill:i,renderOutline:a,outlineWidth:s,segmentColor:o.slice(),segmentsHidden:new Set(c),cfunMTime:u.getMTime(),ofunMTime:d.getMTime()}),{forceOpacityUpdate:!0,forceColorUpdate:!0};const{fillAlpha:m,renderFill:y,renderOutline:v,outlineWidth:C,segmentColor:S,segmentsHidden:w,cfunMTime:x,ofunMTime:R}=h,O=S[0]!==o[0]||S[1]!==o[1]||S[2]!==o[2],b=S[3]!==o[3]||m!==r||y!==i||v!==a||C!==s||w!==c;return(b||O)&&c1.set(g,{fillAlpha:r,renderFill:i,renderOutline:a,outlineWidth:s,segmentColor:o.slice(),segmentsHidden:new Set(c),cfunMTime:u.getMTime(),ofunMTime:d.getMTime()}),{forceOpacityUpdate:b,forceColorUpdate:O}}async function iw(t,e,n,r){return await vie(t.element,e,n,r)||void 0}const Oie={render:xie,removeRepresentation:wie},{DefaultHistoryMemo:Pu}=B8,g1=class g1{constructor(e,n){const r=g1.mergeDefaultProps(g1.defaults,n),i=Ia(r,e),{configuration:a={},supportedInteractionTypes:o,toolGroupId:s}=i;this.toolGroupId=s,this.supportedInteractionTypes=o||[],this.configuration=Object.assign({},a),this.mode=Kn.Disabled}static mergeDefaultProps(e={},n){return n?Ia(e,n):e}get toolName(){return this.getToolName()}getToolName(){return this.constructor.toolName}applyActiveStrategy(e,n){const{strategies:r,activeStrategy:i}=this.configuration;return r[i]?.call(this,e,n)}applyActiveStrategyCallback(e,n,r,...i){const{strategies:a,activeStrategy:o}=this.configuration;if(!a[o])throw new Error(`applyActiveStrategyCallback: active strategy ${o} not found, check tool configuration or spellings`);return a[o][r]?.call(this,e,n,...i)}setConfiguration(e){this.configuration=Ia(this.configuration,e)}setActiveStrategy(e){this.setConfiguration({activeStrategy:e})}getTargetImageData(e){if(e.startsWith("imageId:")){const n=e.split("imageId:")[1],r=da(n);let i=J4(r);return!i||!i.length||(i=i.filter(a=>a.getCurrentImageId()===n),!i||!i.length)?void 0:i[0].getImageData()}else if(e.startsWith("volumeId:")){const n=Ef(e),r=M8(n);return!r||!r.length?void 0:r[0].getImageData()}else if(e.startsWith("videoId:")){const n=da(e),r=J4(n);return!r||!r.length?void 0:r[0].getImageData()}else throw new Error('getTargetIdImage: targetId must start with "imageId:" or "volumeId:"')}getTargetId(e){const n=e.getViewReferenceId?.();if(n)return n;throw new Error("getTargetId: viewport must have a getViewReferenceId method")}undo(){this.doneEditMemo(),Pu.undo()}redo(){Pu.redo()}static createZoomPanMemo(e){const n={pan:e.getPan(),zoom:e.getZoom()},r={restoreMemo:()=>{const i=e.getPan(),a=e.getZoom();e.setZoom(n.zoom),e.setPan(n.pan),e.render(),n.pan=i,n.zoom=a}};return Pu.push(r),r}doneEditMemo(){this.memo?.commitMemo?.()&&Pu.push(this.memo),this.memo=null}static startGroupRecording(){Pu.startGroupRecording()}static endGroupRecording(){Pu.endGroupRecording()}};g1.defaults={configuration:{strategies:{},defaultStrategy:void 0,activeStrategy:void 0,strategyOptions:{}}};let df=g1;df.toolName="BaseTool";const{isEqual:s4}=js,{EPSILON:Die}=Tv,_ie=1-Die;function bie(t,e,n){const{viewPlaneNormal:r}=e,i=t.filter(c=>{const{planeRestriction:u,referencedImageId:d}=c.metadata;let{viewPlaneNormal:g}=c.metadata;if(u){const{inPlaneVector1:m,inPlaneVector2:y}=u;return!(m&&!s4(0,ft(r,m))||y&&!s4(0,ft(r,y)))}if(!c.metadata.referencedImageId&&!g&&c.metadata.FrameOfReferenceUID){for(const m of c.data.handles.points){const y=hn(Ke(),m,e.focalPoint),v=ft(y,r);if(!s4(v,0))return!1}return c.metadata.viewPlaneNormal=r,c.metadata.cameraFocalPoint=e.focalPoint,!0}if(!g&&d){const{imageOrientationPatient:m}=it("imagePlaneModule",d),y=on(m[0],m[1],m[2]),v=on(m[3],m[4],m[5]);g=Ke(),Cn(g,y,v),c.metadata.viewPlaneNormal=g}const h=Math.abs(ft(r,g))>_ie;return g&&h});if(!i.length)return[];const a=n/2,{focalPoint:o}=e,s=[];for(const c of i){const u=c.data,d=u.handles.points[0]||u.contour?.polyline[0];if(!c.isVisible)continue;const g=Ke();if(!d){s.push(c);continue}hn(g,o,d);const h=ft(g,r);Math.abs(h)<a&&s.push(c)}return s}function cM(t,e,n={}){if(t instanceof Io){const r=t.getCamera(),{spacingInNormalDirection:i}=z1(t,r);return bie(e,r,i)}if(t instanceof Na){const r=t.getCurrentImageId();if(!r)return[];const i=r.indexOf(":");n.imageURI=r.substring(i+1)}return e.filter(r=>r.isVisible?r.data.isCanvasAnnotation?!0:t.isReferenceViewable(r.metadata,n):!1)}function Mie(t){if(t){if(t.data&&t.highlighted)return A0.Highlighted;if(Zp(t.annotationUID))return A0.Selected;if(ff(t.annotationUID))return A0.Locked;if(t.data&&t.autoGenerated)return A0.AutoGenerated}return A0.Default}class lM extends df{constructor(){super(...arguments),this.onImageSpacingCalibrated=e=>{const{element:n,imageId:r}=e.detail,i=da(r),a=qs();a.getFramesOfReference().forEach(s=>{const u=a.getAnnotations(s)[this.getToolName()];!u||!u.length||(u.forEach(d=>{if(!d.metadata?.referencedImageId)return;da(d.metadata.referencedImageId)===i&&(d.invalidated=!0,d.data.cachedStats={})}),Q1(n))})}}filterInteractableAnnotationsForElement(e,n){if(!n?.length)return[];const r=mt(e),{viewport:i}=r;return cM(i,n)}createAnnotation(e){const n=e.detail,{currentPoints:r,element:i}=n,{world:a}=r,o=mt(i),{viewport:s}=o,c=s.getCamera(),{viewPlaneNormal:u,viewUp:d,position:g}=c,h=this.getReferencedImageId(s,a,u,d),m=s.getViewReference({points:[a]});return{highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),...m,referencedImageId:h,viewUp:d,cameraPosition:g},data:{cachedStats:{},handles:{points:[],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}}}}}getReferencedImageId(e,n,r,i){const a=this.getTargetId(e);let o=a.split(/^[a-zA-Z]+:/)[1];if(e instanceof Vo){const s=Ef(a),c=rt.getVolume(s);o=w1(c,n,r)}return o}getStyle(e,n,r){return X_(e,n,Mie(r),this.mode)}}lM.toolName="AnnotationDisplayTool";const{DefaultHistoryMemo:Lie}=B8,{PointsManager:Vie}=js;class Ll extends lM{static createAnnotation(...e){let n={annotationUID:null,highlighted:!0,invalidated:!0,metadata:{toolName:this.toolName},data:{text:"",handles:{points:new Array,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""}};for(const r of e)n=Ia(n,r);return n}static createAnnotationForViewport(e,...n){return this.createAnnotation({metadata:e.getViewReference()},...n)}static createAndAddAnnotation(e,...n){const r=this.createAnnotationForViewport(e,...n);Wl(r,e.element),Ao(r,e.element)}constructor(e,n){super(e,n),this.mouseMoveCallback=(r,i)=>{if(!i)return!1;const{element:a,currentPoints:o}=r.detail,s=o.canvas;let c=!1;for(const u of i){if(ff(u.annotationUID)||!ip(u.annotationUID))continue;const{data:d}=u,g=d.handles?d.handles.activeHandleIndex:void 0,h=this._imagePointNearToolOrHandle(a,u,s,6),m=h&&!u.highlighted,y=!h&&u.highlighted;m||y?(u.highlighted=!u.highlighted,c=!0):d.handles&&d.handles.activeHandleIndex!==g&&(c=!0)}return c},this.isSuvScaled=Ll.isSuvScaled,e.configuration?.getTextLines&&(this.configuration.getTextLines=e.configuration.getTextLines),e.configuration?.statsCalculator&&(this.configuration.statsCalculator=e.configuration.statsCalculator)}getHandleNearImagePoint(e,n,r,i){const a=mt(e),{viewport:o}=a,{data:s}=n,{isCanvasAnnotation:c}=s,{points:u,textBox:d}=s.handles;if(d){const{worldBoundingBox:g}=d;if(g){const h={topLeft:o.worldToCanvas(g.topLeft),topRight:o.worldToCanvas(g.topRight),bottomLeft:o.worldToCanvas(g.bottomLeft),bottomRight:o.worldToCanvas(g.bottomRight)};if(r[0]>=h.topLeft[0]&&r[0]<=h.bottomRight[0]&&r[1]>=h.topLeft[1]&&r[1]<=h.bottomRight[1])return s.handles.activeHandleIndex=null,d}}for(let g=0;g<u?.length;g++){const h=u[g],m=c?h.slice(0,2):o.worldToCanvas(h);if(wi(r,m)<i===!0)return s.handles.activeHandleIndex=g,h}s.handles.activeHandleIndex=null}getLinkedTextBoxStyle(e,n){return{visibility:this.getStyle("textBoxVisibility",e,n),fontFamily:this.getStyle("textBoxFontFamily",e,n),fontSize:this.getStyle("textBoxFontSize",e,n),color:this.getStyle("textBoxColor",e,n),shadow:this.getStyle("textBoxShadow",e,n),background:this.getStyle("textBoxBackground",e,n),lineWidth:this.getStyle("textBoxLinkLineWidth",e,n),lineDash:this.getStyle("textBoxLinkLineDash",e,n)}}static isSuvScaled(e,n,r){if(e instanceof Vo){const a=Ef(n);return rt.getVolume(a)?.scaling?.PT!==void 0}return typeof(r&&it("scalingModule",r))?.suvbw=="number"}getAnnotationStyle(e){const{annotation:n,styleSpecifier:r}=e,i=v=>this.getStyle(v,r,n),{annotationUID:a}=n,o=ip(a),s=ff(a),c=i("lineWidth"),u=i("lineDash"),d=i("angleArcLineDash"),g=i("color"),h=i("markerSize"),m=i("shadow"),y=this.getLinkedTextBoxStyle(r,n);return{visibility:o,locked:s,color:g,lineWidth:c,lineDash:u,lineOpacity:1,fillColor:g,fillOpacity:0,shadow:m,textbox:y,markerSize:h,angleArcLineDash:d}}_imagePointNearToolOrHandle(e,n,r,i){if(this.getHandleNearImagePoint(e,n,r,i)||this.isPointNearTool(e,n,r,i,"mouse"))return!0}static createAnnotationState(e,n){const{data:r,annotationUID:i}=e,a={...r,cachedStats:{}};delete a.contour,delete a.spline;const o={annotationUID:i,data:structuredClone(a),deleting:n},s=r.contour;return s&&(o.data.contour={...s,polyline:null,pointsManager:Vie.create3(s.polyline.length,s.polyline)}),o}static createAnnotationMemo(e,n,r){if(!n)return;const{newAnnotation:i,deleting:a=i?!1:void 0}=r||{},{annotationUID:o}=n,s=Ll.createAnnotationState(n,a),c={restoreMemo:()=>{const u=Ll.createAnnotationState(n,a),{viewport:d}=mt(e)||{};if(d?.setViewReference(n.metadata),s.deleting===!0){if(s.deleting=!1,Object.assign(n.data,s.data),n.data.contour){const h=n.data;h.contour.polyline=s.data.contour.pointsManager.points,delete s.data.contour.pointsManager,h.segmentation&&Hl(n)}s.data=u.data,Wl(n,e),Vs(n.annotationUID,!0),d?.render();return}if(s.deleting===!1){s.deleting=!0,s.data=u.data,Vs(n.annotationUID),q0(n.annotationUID),d?.render();return}const g=Xi(o);if(!g){console.warn("No current annotation");return}Object.assign(g.data,s.data),g.data.contour&&(g.data.contour.polyline=s.data.contour.pointsManager.points),s.data=u.data,g.invalidated=!0,Ao(g,e,Bs.History)},id:o,operationType:"annotation"};return Lie.push(c),c}createMemo(e,n,r){this.memo||=Ll.createAnnotationMemo(e,n,r)}static hydrateBase(e,n,r,i={}){if(!n)return null;const{viewport:a}=n,o=a.getFrameOfReferenceUID(),s=a.getCamera(),c=i.viewplaneNormal??s.viewPlaneNormal,u=i.viewUp??s.viewUp,d=i.toolInstance||new e;let g,h=c,m=u;if(i.referencedImageId)g=i.referencedImageId,h=void 0,m=void 0;else if(a instanceof Na){const y=T_(r[0],a);y!==void 0&&(g=a.getImageIds()[y])}else if(a instanceof Vo)g=d.getReferencedImageId(a,r[0],c,u);else throw new Error("Unsupported viewport type");return{FrameOfReferenceUID:o,referencedImageId:g,viewPlaneNormal:h,viewUp:m,instance:d,viewport:a}}}Ll.toolName="AnnotationTool";const{CalibrationTypes:vl}=zs,yl="px",bh="voxels",Iie=[1,2,3,4],Aie=["3,3","4,7"],Nie={0:"px",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm²",9:"cm²/s",12:"degrees"},Pie=.001,Lg="²",Uie=(t,e)=>{const{calibration:n,hasPixelSpacing:r}=t;let i=r?"mm":yl;const a=r?"mm³":bh;let o=i+Lg,s=1,c="";if(!n||!n.type&&!n.sequenceOfUltrasoundRegions)return{unit:i,areaUnit:o,scale:s,volumeUnit:a};if(n.type===vl.UNCALIBRATED)return{unit:yl,areaUnit:yl+Lg,scale:s,volumeUnit:bh};if(n.sequenceOfUltrasoundRegions){let d,g;if(Array.isArray(e)&&e.length===2)[d,g]=e;else if(typeof e=="function"){const S=e();d=S[0],g=S[1]}let h=n.sequenceOfUltrasoundRegions.filter(S=>d[0]>=S.regionLocationMinX0&&d[0]<=S.regionLocationMaxX1&&d[1]>=S.regionLocationMinY0&&d[1]<=S.regionLocationMaxY1&&g[0]>=S.regionLocationMinX0&&g[0]<=S.regionLocationMaxX1&&g[1]>=S.regionLocationMinY0&&g[1]<=S.regionLocationMaxY1);if(!h?.length)return{unit:i,areaUnit:o,scale:s,volumeUnit:a};if(h=h.filter(S=>Iie.includes(S.regionDataType)&&Aie.includes(`${S.physicalUnitsXDirection},${S.physicalUnitsYDirection}`)),!h.length)return{unit:yl,areaUnit:yl+Lg,scale:s,volumeUnit:bh};const m=h[0],y=Math.abs(m.physicalDeltaX),v=Math.abs(m.physicalDeltaY);if(Tn(y,v,Pie))s=1/y,c="US Region",i=Nie[m.physicalUnitsXDirection]||"unknown",o=i+Lg;else return{unit:yl,areaUnit:yl+Lg,scale:s,volumeUnit:bh}}else n.scale&&(s=n.scale);return[vl.ERMF,vl.USER,vl.ERROR,vl.PROJECTION,vl.CALIBRATED,vl.UNKNOWN].includes(n?.type)&&(c=n.type),{unit:i+(c?` ${c}`:""),areaUnit:o+(c?` ${c}`:""),scale:s,volumeUnit:a+(c?` ${c}`:"")}};function Fie(t,e,n){let r=!0,i=!0;if(typeof t!="function")throw new TypeError("Expected a function");return Bb(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),$b(t,e,{leading:r,trailing:i,maxWait:e})}function kie(t){return t[0]?.length===3}function Gie(t,e){if(!e||e.length===0||e.length===t.length)return t;const n=e[e.length-1]-e[0]+1,r=F3(e.map(a=>t[a][0])),i=F3(e.map(a=>t[a][1]));if(kie(t)){const a=F3(e.map(o=>t[o][2]));return ZC(_g(r,n),_g(i,n),_g(a,n))}else return ZC(_g(r,n),_g(i,n))}function Bie(t,e){const n=[],[r,i]=e,a=i-r+1,o=Math.floor(a/t);let s=0,c=Math.round((a-1)/(o-1)*s)+r;for(;c<=i;)n.push(c),s++,c=Math.round((a-1)/(o-1)*s)+r;return n}function $ie(t,e,n,r){const i=n-e+1,a=Math.floor(r/100*i)??1,o=Math.floor(i/a)??1;if(isNaN(i)||!i||!o||i/o<2)return t;const s=Math.max(0,e),c=Math.min(t.length-1,n),u=t.slice(0,s),d=t.slice(c+1,t.length),g=Bie(o,[s,c]),h=Gie(t,g);return[...u,...h,...d]}function e5(t,e){return e?.autoGenerated?!1:t?.smoothing?.smoothOnAdd===!0||t?.smoothing?.smoothOnEdit===!0}function Wie(t,e){return Kb(t,e)<.001}function zie(t,e){return Kb(t,e)===0}function Hie(t,e){for(let n=0;n<t.length;n++)for(let r=0;r<e.length;r++)if(zie(t[n],e[r]))return[n,r]}function Hu(t,e,n){return(t+e+n)%e}function aw(t,e,n,r){const[,i,a]=t,[,o,s]=e,c=a.length,u=s.length;let d=t[0],g=e[0];if(!a[d]||!s[g]||!a[i]||!s[o])return[void 0,void 0];for(;d!==i&&g!==o;){if(n(s[g],a[d]))return[d,g];d=Hu(d,c,r),g=Hu(g,u,r)}return[void 0,void 0]}function jie(t,e){const[n,r]=Hie(t,e)||[],i=(c,u)=>Wie(c,u)===!1,[a,o]=aw([Hu(n,t.length,1),n,t],[Hu(r,e.length,1),r,e],i,1),[s]=aw([Hu(a,t.length,-1),a,t],[Hu(o,e.length,-1),o,e],i,-1);return[a,s]}function t5(t,e,n){const{interpolation:r,smoothing:i}=t,a=e;if(r){const{knotsRatioPercentageOnAdd:o,knotsRatioPercentageOnEdit:s,smoothOnAdd:c=!1,smoothOnEdit:u=!1}=i,d=n?s:o;if(n?u:c){const[h,m]=n?jie(e,n):[0,e.length-1];return!e[h]||!e[m]?e:$ie(e,h,m,d)}}return a}const n5=t=>{if(t.shiftKey)return t.ctrlKey?Qa.ShiftCtrl:t.altKey?Qa.ShiftAlt:t.metaKey?Qa.ShiftMeta:Qa.Shift;if(t.ctrlKey)return t.altKey?Qa.CtrlAlt:t.metaKey?Qa.CtrlMeta:Qa.Ctrl;if(t.altKey)return t.metaKey&&Qa.AltMeta||Qa.Alt;if(t.metaKey)return Qa.Meta};function Sy(t,e){const n=t[0],r=t[t.length-1],i=tr();Yu(i,r[0]-n[0],r[1]-n[1]),EE(i,i);const a=tr(),o=tr();Yu(a,-i[1],i[0]),Yu(o,i[1],-i[0]);const s=[(n[0]+r[0])/2,(n[1]+r[1])/2],c={dist:0,index:null};for(let g=0;g<t.length;g++){const h=t[g],m=Qv(h,s);m>c.dist&&(c.dist=m,c.index=g)}return[t[c.index],s].map(e.canvasToWorld)}function qie(t,e){const{viewport:n}=t,r=e.data.contour.polyline.map(n.worldToCanvas);return Sy(r,n)}const{addCanvasPointsToArray:wy,pointsAreWithinCloseContourProximity:uM,getFirstLineSegmentIntersectionIndexes:fM,getSubPixelSpacingAndXYDirections:Kie}=Ql;function Yie(t,e,n){this.isDrawing=!0;const r=t.detail,{currentPoints:i,element:a}=r,o=i.canvas,s=mt(a),{viewport:c}=s,u=n5(t.detail.event)===this.configuration.contourHoleAdditionModifierKey,{spacing:d,xDir:g,yDir:h}=Kie(c,this.configuration.subPixelResolution)||{};!d||!g||!h||(this.drawData={canvasPoints:[o],polylineIndex:0,contourHoleProcessingEnabled:u,newAnnotation:!0},this.commonData={annotation:e,viewportIdsToRender:n,spacing:d,xDir:g,yDir:h,movingTextBox:!1},ht.isInteractingWithTool=!0,a.addEventListener(Le.MOUSE_UP,this.mouseUpDrawCallback),a.addEventListener(Le.MOUSE_DRAG,this.mouseDragDrawCallback),a.addEventListener(Le.MOUSE_CLICK,this.mouseUpDrawCallback),a.addEventListener(Le.TOUCH_END,this.mouseUpDrawCallback),a.addEventListener(Le.TOUCH_DRAG,this.mouseDragDrawCallback),a.addEventListener(Le.TOUCH_TAP,this.mouseUpDrawCallback),Bp(a))}function Xie(t){ht.isInteractingWithTool=!1,t.removeEventListener(Le.MOUSE_UP,this.mouseUpDrawCallback),t.removeEventListener(Le.MOUSE_DRAG,this.mouseDragDrawCallback),t.removeEventListener(Le.MOUSE_CLICK,this.mouseUpDrawCallback),t.removeEventListener(Le.TOUCH_END,this.mouseUpDrawCallback),t.removeEventListener(Le.TOUCH_DRAG,this.mouseDragDrawCallback),t.removeEventListener(Le.TOUCH_TAP,this.mouseUpDrawCallback),J8(t)}function Zie(t){const e=t.detail,{currentPoints:n,element:r}=e,i=n.world,a=n.canvas,o=mt(r),{viewport:s}=o,{annotation:c,viewportIdsToRender:u,xDir:d,yDir:g,spacing:h,movingTextBox:m}=this.commonData,{polylineIndex:y,canvasPoints:v,newAnnotation:C}=this.drawData;this.createMemo(r,c,{newAnnotation:C});const S=v[v.length-1],w=s.canvasToWorld(S),x=Ke();ei(x,i,w);const R=Math.abs(ft(x,d)),O=Math.abs(ft(x,g));if(!(R<=h[0]&&O<=h[1])){if(m){this.isDrawing=!1;const{deltaPoints:b}=e,I=b.world,{textBox:G}=c.data.handles,{worldPosition:j}=G;j[0]+=I[0],j[1]+=I[1],j[2]+=I[2],G.hasMoved=!0}else{const b=this.findCrossingIndexDuringCreate(t);if(b!==void 0)this.applyCreateOnCross(t,b);else{const I=wy(r,v,a,this.commonData);this.drawData.polylineIndex=y+I}c.invalidated=!0}pa(u),c.invalidated&&Ao(c,r,Bs.HandlesUpdated)}}function Qie(t){const{allowOpenContours:e}=this.configuration,{canvasPoints:n,contourHoleProcessingEnabled:r}=this.drawData,i=n[0],a=n[n.length-1],o=t.detail,{element:s}=o;this.doneEditMemo(),this.drawData.newAnnotation=!1,e&&!uM(i,a,this.configuration.closeContourProximity)?this.completeDrawOpenContour(s,{contourHoleProcessingEnabled:r}):this.completeDrawClosedContour(s,{contourHoleProcessingEnabled:r})}function Jie(t,e){this.removeCrossedLinesOnCompleteDraw();const{canvasPoints:n}=this.drawData,{contourHoleProcessingEnabled:r,minPointsToSave:i}=e??{};if(i&&n.length<i||this.haltDrawing(t,n))return!1;const{annotation:a,viewportIdsToRender:o}=this.commonData,s=mt(t),{viewport:c,renderingEngine:u}=s;wy(t,n,n[0],this.commonData),n.pop();const d=e5(this.configuration,a)?t5(this.configuration,n):n;this.updateContourPolyline(a,{points:d,closed:!0,targetWindingDirection:ro.Clockwise},c);const{textBox:g}=a.data.handles;return g?.hasMoved||ty(a,r),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,pa(o),this.deactivateDraw(t),!0}function eae(){const{canvasPoints:t}=this.drawData,e=t.length,n=[t[0],t[e-1]],r=t.slice(0,-1).slice(1),i=fM(r,n[0],n[1],!1);if(i){const a=i[1];a===1?this.drawData.canvasPoints=t.splice(1):this.drawData.canvasPoints=t.splice(0,a)}}function tae(t,e){const{canvasPoints:n}=this.drawData,{contourHoleProcessingEnabled:r}=e??{};if(this.haltDrawing(t,n))return!1;const{annotation:i,viewportIdsToRender:a}=this.commonData,o=mt(t),{viewport:s,renderingEngine:c}=o,u=e5(this.configuration,i)?t5(this.configuration,n):n;this.updateContourPolyline(i,{points:u,closed:!1},s);const{textBox:d}=i.data.handles,g=i.data.contour.polyline;return i.data.handles.points=[g[0],g[g.length-1]],i.data.isOpenUShapeContour&&(i.data.openUShapeContourVectorToPeak=Sy(n,s)),d.hasMoved||ty(i,r),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,pa(a),this.deactivateDraw(t),!0}function nae(t){const e=t.detail,{currentPoints:n,lastPoints:r}=e,i=n.canvas,a=r.canvas,{canvasPoints:o}=this.drawData,s=o.slice(0,-1),c=fM(s,i,a,!1);return c===void 0?void 0:c[0]}function rae(t,e){const n=t.detail,{element:r}=n,{canvasPoints:i,contourHoleProcessingEnabled:a}=this.drawData,{annotation:o,viewportIdsToRender:s}=this.commonData;wy(r,i,i[e],this.commonData),i.pop();const c=i.slice(e),u=uy(c);if(Tn(u,0)){i.splice(e+1);return}i.splice(0,e);const d={contourHoleProcessingEnabled:a,minPointsToSave:3};this.completeDrawClosedContour(r,d)&&this.activateClosedContourEdit(t,o,s)}function iae(t){const{allowOpenContours:e}=this.configuration,{canvasPoints:n,contourHoleProcessingEnabled:r}=this.drawData,i=n[0],a=n[n.length-1];e&&!uM(i,a,this.configuration.closeContourProximity)?this.completeDrawOpenContour(t,{contourHoleProcessingEnabled:r}):this.completeDrawClosedContour(t,{contourHoleProcessingEnabled:r})}function aae(t,e){const n=Math.max(e*3,3);return t.length<n}function oae(t,e){const{subPixelResolution:n}=this.configuration;if(aae(e,n)){const{annotation:r,viewportIdsToRender:i}=this.commonData,a=mt(t),{renderingEngine:o}=a;return q0(r.annotationUID),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,pa(i),this.deactivateDraw(t),!0}return!1}function sae(t){t.activateDraw=Yie.bind(t),t.deactivateDraw=Xie.bind(t),t.applyCreateOnCross=rae.bind(t),t.findCrossingIndexDuringCreate=nae.bind(t),t.completeDrawOpenContour=tae.bind(t),t.removeCrossedLinesOnCompleteDraw=eae.bind(t),t.mouseDragDrawCallback=Zie.bind(t),t.mouseUpDrawCallback=Qie.bind(t),t.completeDrawClosedContour=Jie.bind(t),t.cancelDrawing=iae.bind(t),t.haltDrawing=oae.bind(t)}const{addCanvasPointsToArray:cae,getFirstLineSegmentIntersectionIndexes:Kl}=Ql;function lae(t,e){const n=t.detail,{element:r,currentPoints:i,lastPoints:a}=n,o=i.canvas,s=a.canvas,{editCanvasPoints:c,prevCanvasPoints:u}=this.editData,d=Kl(u,o,s,e);if(d)this.editData.startCrossingIndex=d[0],this.removePointsUpUntilFirstCrossing(e);else if(u.length>=2)if(c.length>this.configuration.checkCanvasEditFallbackProximity){const g=c[0],h=[];for(let v=0;v<u.length;v++){const C=u[v],S=wi(C,g);h.push({distance:S,index:v})}h.sort((v,C)=>v.distance-C.distance);const m=[h[0],h[1]],y=Math.min(m[0].index,m[1].index);this.editData.startCrossingIndex=y}else{const g=tr();Ni(g,c[1],c[0]),EE(g,g);const h=6,m=[c[0][0]-g[0]*h,c[0][1]-g[1]*h],y=Kl(u,m,c[0],e);if(y){const v=[m];cae(r,v,c[0],this.commonData),c.unshift(...v),this.removePointsUpUntilFirstCrossing(e),this.editData.editIndex=c.length-1,this.editData.startCrossingIndex=y[0]}}}function uae(t){const{editCanvasPoints:e,prevCanvasPoints:n}=this.editData;let r=0;for(let i=0;i<e.length-1;i++){const a=[e[i],e[i+1]],o=!!Kl(n,a[0],a[1],t);if(r++,o)break}e.splice(0,r),this.editData.editIndex=e.length-1}function fae(t,e){const n=t.detail,{currentPoints:r,lastPoints:i}=n,a=r.canvas,o=i.canvas,{prevCanvasPoints:s}=this.editData;return!!Kl(s,a,o,e)}function gae(t){const{prevCanvasPoints:e,editCanvasPoints:n}=this.editData;for(let r=n.length-1;r>0;r--){const i=[n[r],n[r-1]],a=!!Kl(e,i[0],i[1],t);if(n.pop(),a)break}}function dae(){const{editCanvasPoints:t,prevCanvasPoints:e,startCrossingIndex:n}=this.editData;if(n===void 0)return;const r=t[t.length-1],i=[];for(let o=0;o<e.length;o++){const s=e[o],c=wi(s,r);i.push({distance:c,index:o})}i.sort((o,s)=>o.distance-s.distance);const a=t.slice(0,-1);for(let o=0;o<i.length;o++){const{index:s}=i[o],c=e[s],u=t[t.length-1];if(!Kl(a,c,u,!1))return s}return-1}function hae(t){const e=t.detail,{currentPoints:n,lastPoints:r}=e,i=n.canvas,a=r.canvas,{editCanvasPoints:o}=this.editData,s=o.slice(0,-2),c=Kl(s,i,a,!1);if(!c)return;const u=c[0],d=o.length-u;for(let g=0;g<d;g++)o.pop()}function pae(t){t.checkForFirstCrossing=lae.bind(t),t.removePointsUpUntilFirstCrossing=uae.bind(t),t.checkForSecondCrossing=fae.bind(t),t.findSnapIndex=dae.bind(t),t.removePointsAfterSecondCrossing=gae.bind(t),t.checkAndRemoveCrossesOnEditLine=hae.bind(t)}const{getSubPixelSpacingAndXYDirections:mae,addCanvasPointsToArray:gM,getArea:ow}=Ql;function vae(t,e,n){this.isEditingClosed=!0;const r=t.detail,{currentPoints:i,element:a}=r,o=i.canvas,s=mt(a);if(!s)return;const{viewport:c}=s,u=e.data.contour.polyline.map(c.worldToCanvas),{spacing:d,xDir:g,yDir:h}=mae(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:u,editCanvasPoints:[o],startCrossingIndex:void 0,editIndex:0,annotation:e},this.commonData={annotation:e,viewportIdsToRender:n,spacing:d,xDir:g,yDir:h,movingTextBox:!1},ht.isInteractingWithTool=!0,a.addEventListener(Le.MOUSE_UP,this.mouseUpClosedContourEditCallback),a.addEventListener(Le.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),a.addEventListener(Le.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),a.addEventListener(Le.TOUCH_END,this.mouseUpClosedContourEditCallback),a.addEventListener(Le.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),a.addEventListener(Le.TOUCH_TAP,this.mouseUpClosedContourEditCallback),Bp(a)}function yae(t){ht.isInteractingWithTool=!1,t.removeEventListener(Le.MOUSE_UP,this.mouseUpClosedContourEditCallback),t.removeEventListener(Le.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),t.removeEventListener(Le.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),t.removeEventListener(Le.TOUCH_END,this.mouseUpClosedContourEditCallback),t.removeEventListener(Le.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),t.removeEventListener(Le.TOUCH_TAP,this.mouseUpClosedContourEditCallback),J8(t)}function Tae(t){const e=t.detail,{currentPoints:n,element:r}=e,i=n.world,a=n.canvas,o=mt(r),{viewport:s}=o,{viewportIdsToRender:c,xDir:u,yDir:d,spacing:g}=this.commonData,{editIndex:h,editCanvasPoints:m,startCrossingIndex:y,annotation:v}=this.editData;this.createMemo(r,v);const C=m[m.length-1],S=s.canvasToWorld(C),w=Ke();ei(w,i,S);const x=Math.abs(ft(w,u)),R=Math.abs(ft(w,d));if(x<=g[0]&&R<=g[1])return;y!==void 0&&this.checkAndRemoveCrossesOnEditLine(t);const O=gM(r,m,a,this.commonData),b=h+O;if(this.editData.editIndex=b,y===void 0&&m.length>1&&this.checkForFirstCrossing(t,!0),this.editData.snapIndex=this.findSnapIndex(),this.editData.snapIndex===-1){this.finishEditAndStartNewEdit(t);return}this.editData.fusedCanvasPoints=this.fuseEditPointsWithClosedContour(t),y!==void 0&&this.checkForSecondCrossing(t,!0)&&(this.removePointsAfterSecondCrossing(!0),this.finishEditAndStartNewEdit(t)),pa(c)}function Cae(t){const e=t.detail,{element:n}=e,r=mt(n),{viewport:i,renderingEngine:a}=r,{annotation:o,viewportIdsToRender:s}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:u}=this.editData;Ys(o,{points:c,closed:!0,targetWindingDirection:ro.Clockwise},i),o.autoGenerated&&(o.autoGenerated=!1),Ao(o,n);const d=u.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[d],startCrossingIndex:void 0,editIndex:0,snapIndex:void 0,annotation:o},pa(s)}function Sae(t){const{prevCanvasPoints:e,editCanvasPoints:n,startCrossingIndex:r,snapIndex:i}=this.editData;if(r===void 0||i===void 0)return;const a=t.detail,{element:o}=a,s=[...n];gM(o,s,e[i],this.commonData),s.length>n.length&&s.pop();let c,u;r>i?(c=i,u=r):(c=r,u=i);const d=wi(e[c],s[0]),g=wi(e[c],s[s.length-1]),h=wi(e[u],s[0]),m=wi(e[u],s[s.length-1]),y=[];for(let O=0;O<c;O++){const b=e[O];y.push([b[0],b[1]])}let v=d+m,C=g+h;if(v<C)for(let O=0;O<s.length;O++){const b=s[O];y.push([b[0],b[1]])}else for(let O=s.length-1;O>=0;O--){const b=s[O];y.push([b[0],b[1]])}for(let O=u;O<e.length;O++){const b=e[O];y.push([b[0],b[1]])}const S=[];for(let O=c;O<u;O++){const b=e[O];S.push([b[0],b[1]])}if(v=h+g,C=m+d,v<C)for(let O=0;O<s.length;O++){const b=s[O];S.push([b[0],b[1]])}else for(let O=s.length-1;O>=0;O--){const b=s[O];S.push([b[0],b[1]])}const w=ow(y),x=ow(S);return w>x?y:S}function wae(t){const e=t.detail,{element:n}=e;this.completeClosedContourEdit(n)}function xae(t){const e=mt(t),{viewport:n}=e,{annotation:r,viewportIdsToRender:i}=this.commonData;this.doneEditMemo();const{fusedCanvasPoints:a,prevCanvasPoints:o}=this.editData;if(a){const s=e5(this.configuration,r)?t5(this.configuration,a,o):a,c=this.configuration?.decimate||{};Ys(r,{points:s,closed:!0,targetWindingDirection:ro.Clockwise},n,{decimate:{enabled:!!c.enabled,epsilon:c.epsilon}}),r.autoGenerated&&(r.autoGenerated=!1),Ao(r,t)}this.isEditingClosed=!1,this.editData=void 0,this.commonData=void 0,pa(i),this.deactivateClosedContourEdit(t)}function Eae(t){this.completeClosedContourEdit(t)}function Rae(t){t.activateClosedContourEdit=vae.bind(t),t.deactivateClosedContourEdit=yae.bind(t),t.mouseDragClosedContourEditCallback=Tae.bind(t),t.mouseUpClosedContourEditCallback=wae.bind(t),t.finishEditAndStartNewEdit=Cae.bind(t),t.fuseEditPointsWithClosedContour=Sae.bind(t),t.cancelClosedContourEdit=Eae.bind(t),t.completeClosedContourEdit=xae.bind(t)}const{addCanvasPointsToArray:dM,getSubPixelSpacingAndXYDirections:Oae}=Ql;function Dae(t,e,n){this.isEditingOpen=!0;const r=t.detail,{currentPoints:i,element:a}=r,o=i.canvas,s=mt(a),{viewport:c}=s;this.doneEditMemo();const u=e.data.contour.polyline.map(c.worldToCanvas),{spacing:d,xDir:g,yDir:h}=Oae(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:u,editCanvasPoints:[o],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:e,viewportIdsToRender:n,spacing:d,xDir:g,yDir:h,movingTextBox:!1},ht.isInteractingWithTool=!0,a.addEventListener(Le.MOUSE_UP,this.mouseUpOpenContourEditCallback),a.addEventListener(Le.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),a.addEventListener(Le.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),a.addEventListener(Le.TOUCH_END,this.mouseUpOpenContourEditCallback),a.addEventListener(Le.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),a.addEventListener(Le.TOUCH_TAP,this.mouseUpOpenContourEditCallback),Bp(a)}function _ae(t){ht.isInteractingWithTool=!1,t.removeEventListener(Le.MOUSE_UP,this.mouseUpOpenContourEditCallback),t.removeEventListener(Le.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),t.removeEventListener(Le.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),t.removeEventListener(Le.TOUCH_END,this.mouseUpOpenContourEditCallback),t.removeEventListener(Le.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),t.removeEventListener(Le.TOUCH_TAP,this.mouseUpOpenContourEditCallback),J8(t)}function bae(t){const e=t.detail,{currentPoints:n,element:r}=e,i=n.world,a=n.canvas,o=mt(r),{viewport:s}=o,{viewportIdsToRender:c,xDir:u,yDir:d,spacing:g}=this.commonData,{editIndex:h,editCanvasPoints:m,startCrossingIndex:y}=this.editData,v=m[m.length-1],C=s.canvasToWorld(v),S=Ke();this.createMemo(r,this.commonData.annotation),ei(S,i,C);const w=Math.abs(ft(S,u)),x=Math.abs(ft(S,d));if(w<=g[0]&&x<=g[1])return;y!==void 0&&this.checkAndRemoveCrossesOnEditLine(t);const R=dM(r,m,a,this.commonData),O=h+R;this.editData.editIndex=O,y===void 0&&m.length>1&&this.checkForFirstCrossing(t,!1),this.editData.snapIndex=this.findSnapIndex(),this.editData.fusedCanvasPoints=this.fuseEditPointsWithOpenContour(t),y!==void 0&&this.checkForSecondCrossing(t,!1)?(this.removePointsAfterSecondCrossing(!1),this.finishEditOpenOnSecondCrossing(t)):this.checkIfShouldOverwriteAnEnd(t)&&this.openContourEditOverwriteEnd(t),pa(c)}function Mae(t){const e=t.detail,{element:n}=e,r=mt(n),{viewport:i}=r,{annotation:a,viewportIdsToRender:o}=this.commonData,s=this.fuseEditPointsForOpenContourEndEdit();Ys(a,{points:s,closed:!1},i);const c=a.data.contour.polyline;a.data.handles.points=[c[0],c[c.length-1]],a.data.handles.activeHandleIndex=1,Ao(a,n),this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,this.doneEditMemo(),this.deactivateOpenContourEdit(n),this.activateOpenContourEndEdit(t,a,o,null)}function Lae(t){const e=t.detail,{currentPoints:n,lastPoints:r}=e,i=n.canvas,a=r.canvas,{snapIndex:o,prevCanvasPoints:s,startCrossingIndex:c}=this.editData;if(c===void 0||o===void 0)return!1;if(o===-1)return!0;if(o!==0&&o!==s.length-1)return!1;const u=i,d=a,g=s[o],h=tr(),m=tr();Yu(h,u[0]-d[0],u[1]-d[1]),Yu(m,u[0]-g[0],u[1]-g[1]);const y=Cl(h,m),v=Math.sqrt(h[0]*h[0]+h[1]*h[1]),C=Math.sqrt(m[0]*m[0]+m[1]*m[1]);return Math.acos(y/(v*C))<Math.PI/2}function Vae(){const{snapIndex:t,prevCanvasPoints:e,editCanvasPoints:n,startCrossingIndex:r}=this.editData,i=[];if(t===0)for(let s=e.length-1;s>=r;s--){const c=e[s];i.push([c[0],c[1]])}else for(let s=0;s<r;s++){const c=e[s];i.push([c[0],c[1]])}const a=wi(e[r],n[0]),o=wi(e[r],n[n.length-1]);if(a<o)for(let s=0;s<n.length;s++){const c=n[s];i.push([c[0],c[1]])}else for(let s=n.length-1;s>=0;s--){const c=n[s];i.push([c[0],c[1]])}return i}function Iae(t){const{prevCanvasPoints:e,editCanvasPoints:n,startCrossingIndex:r,snapIndex:i}=this.editData;if(r===void 0||i===void 0)return;const a=t.detail,{element:o}=a,s=[...n];dM(o,s,e[i],this.commonData),s.length>n.length&&s.pop();let c,u;r>i?(c=i,u=r):(c=r,u=i);const d=wi(e[c],s[0]),g=wi(e[c],s[s.length-1]),h=wi(e[u],s[0]),m=wi(e[u],s[s.length-1]),y=[];for(let S=0;S<c;S++){const w=e[S];y.push([w[0],w[1]])}const v=d+m,C=g+h;if(v<C)for(let S=0;S<s.length;S++){const w=s[S];y.push([w[0],w[1]])}else for(let S=s.length-1;S>=0;S--){const w=s[S];y.push([w[0],w[1]])}for(let S=u;S<e.length;S++){const w=e[S];y.push([w[0],w[1]])}return y}function Aae(t){const e=t.detail,{element:n}=e,r=mt(n),{viewport:i,renderingEngine:a}=r,{annotation:o,viewportIdsToRender:s}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:u}=this.editData;Ys(o,{points:c,closed:!1},i);const d=o.data.contour.polyline;o.data.handles.points=[d[0],d[d.length-1]],Ao(o,n);const g=u.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[g],startCrossingIndex:void 0,editIndex:0},pa(s)}function Nae(t){const e=t.detail,{element:n}=e;this.completeOpenContourEdit(n)}function Pae(t){const e=mt(t),{viewport:n}=e,{annotation:r,viewportIdsToRender:i}=this.commonData;this.doneEditMemo();const{fusedCanvasPoints:a,prevCanvasPoints:o}=this.editData;if(a){const s=e5(this.configuration)?t5(this.configuration,a,o):a,c=this.configuration?.decimate||{};Ys(r,{points:s,closed:!1},n,{decimate:{enabled:!!c.enabled,epsilon:c.epsilon}});const u=r.data.contour.polyline;r.data.handles.points=[u[0],u[u.length-1]],r.data.isOpenUShapeContour&&(r.data.openUShapeContourVectorToPeak=Sy(a,n)),Ao(r,t)}this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,pa(i),this.deactivateOpenContourEdit(t)}function Uae(t){this.completeOpenContourEdit(t)}function Fae(t){t.activateOpenContourEdit=Dae.bind(t),t.deactivateOpenContourEdit=_ae.bind(t),t.mouseDragOpenContourEditCallback=bae.bind(t),t.mouseUpOpenContourEditCallback=Nae.bind(t),t.fuseEditPointsWithOpenContour=Iae.bind(t),t.finishEditOpenOnSecondCrossing=Aae.bind(t),t.checkIfShouldOverwriteAnEnd=Lae.bind(t),t.fuseEditPointsForOpenContourEndEdit=Vae.bind(t),t.openContourEditOverwriteEnd=Mae.bind(t),t.cancelOpenContourEdit=Uae.bind(t),t.completeOpenContourEdit=Pae.bind(t)}const{getSubPixelSpacingAndXYDirections:kae}=Ql;function Gae(t,e,n,r){this.isDrawing=!0;const i=t.detail,{element:a}=i,o=mt(a),{viewport:s}=o,{spacing:c,xDir:u,yDir:d}=kae(s,this.configuration.subPixelResolution),g=e.data.contour.polyline.map(s.worldToCanvas);e.data.handles.activeHandleIndex===0&&g.reverse();let m=!1;r?.worldPosition&&(m=!0),this.drawData={canvasPoints:g,polylineIndex:g.length-1},this.commonData={annotation:e,viewportIdsToRender:n,spacing:c,xDir:u,yDir:d,movingTextBox:m},ht.isInteractingWithTool=!0,a.addEventListener(Le.MOUSE_UP,this.mouseUpDrawCallback),a.addEventListener(Le.MOUSE_DRAG,this.mouseDragDrawCallback),a.addEventListener(Le.MOUSE_CLICK,this.mouseUpDrawCallback),a.addEventListener(Le.TOUCH_END,this.mouseUpDrawCallback),a.addEventListener(Le.TOUCH_DRAG,this.mouseDragDrawCallback),a.addEventListener(Le.TOUCH_TAP,this.mouseUpDrawCallback),Bp(a)}function Bae(t){t.activateOpenContourEndEdit=Gae.bind(t)}function $ae(t){return(t.childAnnotationUIDs??[]).map(n=>Xi(n).data.contour.polyline)}function r5(t,e){const n=$ae(t),r=[];return n.forEach(i=>{const a=i.length,o=new Array(a);for(let s=0;s<a;s++)o[s]=e.worldToCanvas(i[s]);r.push(o)}),r}const{pointsAreWithinCloseContourProximity:Wae}=Ql;function zae(t,e){const n={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:t.viewport.id,annotationUID:e.annotationUID},{lineWidth:r,lineDash:i,color:a,fillColor:o,fillOpacity:s}=this.getAnnotationStyle({annotation:e,styleSpecifier:n}),{closed:c}=e.data.contour;return{color:a,width:r,lineDash:i,fillColor:o,fillOpacity:s,closePath:c}}function Hae(t,e,n){t?.viewport?.getImageData()&&(n.data.contour.closed?this.renderClosedContour(t,e,n):n.data.isOpenUShapeContour?(jae(t,n),this.renderOpenUShapedContour(t,e,n)):this.renderOpenContour(t,e,n))}function jae(t,e){e.data.openUShapeContourVectorToPeak||(e.data.openUShapeContourVectorToPeak=qie(t,e))}function qae(t,e,n){if(n.parentAnnotationUID)return;const{viewport:r}=t,i=this._getRenderingOptions(t,n),a=n.data.contour.polyline.map(u=>r.worldToCanvas(u)),o=r5(n,r),s=[a,...o];nf(e,n.annotationUID,"1",s,i)}function Kae(t,e,n){const{viewport:r}=t,i=this._getRenderingOptions(t,n),a=n.data.contour.polyline.map(c=>r.worldToCanvas(c));gf(e,n.annotationUID,"1",a,i);const s=n.data.handles.activeHandleIndex;if(this.configuration.alwaysRenderOpenContourHandles?.enabled===!0){const c=this.configuration.alwaysRenderOpenContourHandles.radius,u="0",d=[a[0],a[a.length-1]];s===0?d.shift():s===1&&d.pop(),lv(e,n.annotationUID,u,d,{color:i.color,handleRadius:c})}if(s!==null){const u=s===0?0:a.length-1,d=a[u];lv(e,n.annotationUID,"1",[d],{color:i.color})}}function Yae(t,e,n){const{viewport:r}=t,{openUShapeContourVectorToPeak:i}=n.data,{polyline:a}=n.data.contour;if(this.renderOpenContour(t,e,n),!i)return;const o=r.worldToCanvas(a[0]),s=r.worldToCanvas(a[a.length-1]),c=[r.worldToCanvas(i[0]),r.worldToCanvas(i[1])],u=this._getRenderingOptions(t,n);gf(e,n.annotationUID,"first-to-last",[o,s],{color:u.color,width:u.width,closePath:!1,lineDash:"2,2"}),gf(e,n.annotationUID,"midpoint-to-open-contour",[c[0],c[1]],{color:u.color,width:u.width,closePath:!1,lineDash:"2,2"})}function Xae(t,e,n){const r=this._getRenderingOptions(t,n),{allowOpenContours:i}=this.configuration,{canvasPoints:a}=this.drawData;if(r.closePath=!1,gf(e,n.annotationUID,"1",a,r),i){const o=a[0],s=a[a.length-1];Wae(o,s,this.configuration.closeContourProximity)?gf(e,n.annotationUID,"2",[s,o],r):lv(e,n.annotationUID,"0",[o],{color:r.color,handleRadius:2})}}function Zae(t,e,n){const{viewport:r}=t,{fusedCanvasPoints:i}=this.editData;if(i===void 0){this.renderClosedContour(t,e,n);return}const a=r5(n,r),o=[i,...a],s=this._getRenderingOptions(t,n),c="preview-1";n.parentAnnotationUID&&s.fillOpacity&&(s.fillOpacity=0),nf(e,n.annotationUID,c,o,s)}function Qae(t,e,n){const{fusedCanvasPoints:r}=this.editData;if(r===void 0){this.renderOpenContour(t,e,n);return}const i=this._getRenderingOptions(t,n);gf(e,n.annotationUID,"preview-1",r,i)}function Jae(t,e,n){if(n.parentAnnotationUID)return;const{viewport:r}=t,i=this._getRenderingOptions(t,n),a=n.data.contour.polyline.map(y=>r.worldToCanvas(y)),o=r5(n,r),s="1",c=a[0],u=6,d=100,g=[];for(let y=0;y<d;y++){const v=y/d*2*Math.PI,C=c[0]+u*Math.cos(v),S=c[1]+u*Math.sin(v);g.push([C,S])}const h=[[c[0]-u*2,c[1]],[c[0]+u*2,c[1]],[c[0],c[1]-u*2],[c[0],c[1]+u*2]];nf(e,n.annotationUID,s+"-crosshair_v",[h[0],h[1]],i),nf(e,n.annotationUID,s+"-crosshair_h",[h[2],h[3]],i);const m=[g,...o];nf(e,n.annotationUID,s,m,i)}function eoe(t){t.renderContour=Hae.bind(t),t.renderClosedContour=qae.bind(t),t.renderOpenContour=Kae.bind(t),t.renderPointContourWithMarker=Jae.bind(t),t.renderOpenUShapedContour=Yae.bind(t),t.renderContourBeingDrawn=Xae.bind(t),t.renderClosedContourBeingEdited=Zae.bind(t),t.renderOpenContourBeingEdited=Qae.bind(t),t._getRenderingOptions=zae.bind(t)}function toe(t){const e=noe(t),n=(e.top[1]+e.bottom[1])/2;return[e.right[0],n]}function noe(t){const e=[t[0],t[1]].sort(o),n=[t[0],t[1]].sort(s),r=e[e.length-1],i=n[0],a=n[n.length-1];return{top:i,bottom:a,right:r};function o(c,u){return c[0]<u[0]?-1:1}function s(c,u){return c[1]<u[1]?-1:1}}function roe(t,e){if(t instanceof Vo){const n=Ef(e),r=rt.getVolume(n);return!!r?.scaling&&Object.keys(r.scaling).length>0}else if(t instanceof Na){const{preScale:n}=t.getImageData()||{};return!!n?.scaled}else return!1}function sw(t,e){let n=0;for(let r=0;r<t.length-1;r++){const i=t[r],a=t[r+1];n+=Math.sqrt(Math.pow(a[0]-i[0],2)+Math.pow(a[1]-i[1],2))}if(e){const r=t[0],i=t[t.length-1];n+=Math.sqrt(Math.pow(i[0]-r[0],2)+Math.pow(i[1]-r[1],2))}return n}class ioe extends Ll{constructor(e,n){super(e,n)}renderAnnotation(e,n){let r=!1;const{viewport:i}=e,{element:a}=i;if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),r;let o=E1(this.getToolName(),a);if(!o?.length||(o=this.filterInteractableAnnotationsForElement(a,o),!o?.length))return r;const s=this.getTargetId(i),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let u=0;u<o.length;u++){const d=o[u];c.annotationUID=d.annotationUID;const g=this.getAnnotationStyle({annotation:d,styleSpecifier:c});if(!g.visibility)continue;const h=this.renderAnnotationInstance({enabledElement:e,targetId:s,annotation:d,annotationStyle:g,svgDrawingHelper:n});r||=h,d.invalidated=!1}return r}createAnnotation(e){const n=super.createAnnotation(e);return Object.assign(n.data,{contour:{polyline:[],closed:!1}}),Object.assign(n,{interpolationUID:"",autoGenerated:!1}),n}addAnnotation(e,n){return Wl(e,n)}cancelAnnotation(e){}moveAnnotation(e,n){const{points:r}=e.data.handles;for(let i=0,a=r.length;i<a;i++){const o=r[i];o[0]+=n[0],o[1]+=n[1],o[2]+=n[2]}e.invalidated=!0,zp(e).forEach(i=>this.moveAnnotation(i,n))}updateContourPolyline(e,n,r,i){const a=this.configuration?.decimate||{};Ys(e,n,r,{decimate:{enabled:!!a.enabled,epsilon:a.epsilon},updateWindingDirection:i?.updateWindingDirection})}getPolylinePoints(e){return e.data.contour?.polyline??e.data.polyline}renderAnnotationInstance(e){const{enabledElement:n,annotationStyle:r,svgDrawingHelper:i}=e,a=e.annotation;if(a.parentAnnotationUID)return;const{annotationUID:o}=a,{viewport:s}=n,{worldToCanvas:c}=s,u=this.getPolylinePoints(a).map(S=>c(S)),{lineWidth:d,lineDash:g,color:h,fillColor:m,fillOpacity:y}=r,v=r5(a,s),C=[u,...v];return nf(i,o,"contourPolyline",C,{color:h,lineDash:g,lineWidth:Math.max(.1,d),fillColor:m,fillOpacity:y}),!0}}const hf={...Tte,...pte,resetAnnotationManager:zne},cw="PlanarFreehandContourSegmentationTool";function xy(t,e=[]){const{viewport:n,sliceData:r,annotation:i}=t,a=new Map,{toolName:o,originalToolName:s}=i.metadata,c=s||o,u=(E1(c,n.element)||[]).filter(d=>!d.metadata.originalToolName||d.metadata.originalToolName===c);if(c!==cw){const d=E1(cw,n.element);d?.length&&d.forEach(g=>{const{metadata:h}=g;h.originalToolName===c&&h.originalToolName!==h.toolName&&u.push(g)})}if(!u?.length)return a;for(let d=0;d<r.numberOfSlices;d++){const g=u.filter(m=>m.metadata.sliceIndex===d);if(!g?.length)continue;const h=g.filter(m=>e.every(y=>{const C=(y.parentKey?y.parentKey(m):m)?.[y.key];return Array.isArray(C)?C.every((S,w)=>S===y.value[w]):C===y.value}));h.length&&a.set(d,h)}return a}function aoe(t,e){const n=xy(t,e),r=[];if(!n?.size)return r;for(const i of n.values())i.forEach(a=>{r.push(a)});return r}function hM(t,e,n){const r=Ia({data:{},metadata:{}},n);return Object.assign(r,{highlighted:!1,invalidated:!0,autoGenerated:!0,annotationUID:void 0,cachedStats:{},childAnnotationUIDs:[],parentAnnotationUID:void 0}),Object.assign(r.data,{handles:{points:e.points||e||[],interpolationSources:e.sources,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},contour:{...n.data.contour,polyline:t}}),r}function ooe(t,e){const n=xy(e,[{key:"interpolationUID",value:e.interpolationUID}]),r=soe(n);if(!r){console.warn("No annotations found to interpolate",n);return}const i=coe(n,t.annotationUID),a=[];for(let o=r[0]+1;o<r[1];o++)if(loe(n,o)){const s=foe(o,r,n);(s?.[0]===i||s?.[1]===i)&&uoe(s,a,o)}return{interpolationData:n,interpolationList:a}}function soe(t){let e=1/0,n=-1/0,r=!1;for(const[i,a]of t.entries())a.length&&(e=Math.min(i,e),n=Math.max(i,n),r=!0);if(r)return[e,n]}function coe(t,e){for(const[n,r]of t)for(let i=0;i<r.length;i++)if(r[i].annotationUID===e)return n}function loe(t,e){const n=t.get(e);return!n?.length||n.length===1&&n[0].autoGenerated}function uoe(t,e,n){const[r]=t;e[r]||={pair:t,list:[]},e[r].list.push(n)}function foe(t,e,n){const r=[];let i=!0;for(let a=t-1;a>=e[0];a--){const o=n.get(a);if(o?.length){if(o[0].autoGenerated)continue;o.length>1&&(i=!1),r.push(a);break}}if(!(!i||!r.length)){for(let a=t+1;a<=e[1];a++){const o=n.get(a);if(o?.length){if(o[0].autoGenerated)continue;o.length>1&&(i=!1),r.push(a);break}}if(!(!i||r.length<2))return r}}const{PointsManager:lw}=js;function goe(t,e=12){const n=lw.create3(e);n.sources=[];const{sources:r}=n,{length:i,sources:a=[]}=t,o=5;if(i<o*3)return t.subselect(e);const s=Math.floor(Math.max(2*i/e,o*2));a.forEach(()=>r.push(lw.create3(e)));const c=doe(t,o),u=hoe(c,e),d=[];if(u?.length>2){let g=-1;const h=s/3;u.forEach(v=>{const[C,,S]=v,w=Math.ceil((C+S)/2);S-g<h||(w-C>2*h?(Uu(d,g,C,s,i),g=Uu(d,C,w,s,i)):g=Uu(d,g,w,s,i),S-g>h&&(g=Uu(d,g,S,s,i)))});const m=d[0];uv(m+i-g,i)>2*h&&Uu(d,g,m-h,s,i)}else{const g=Math.floor(i/e);Uu(d,-1,i-g,g,i)}return d.forEach(g=>{const h=t.getPointArray(g);n.push(h),a.forEach((m,y)=>r[y].push(m.getPoint(g)))}),n}function doe(t,e=6){const{length:n}=t,r=Ke(),i=Ke(),a=new Float32Array(n);for(let o=0;o<n;o++){const s=t.getPoint(o),c=t.getPoint(o-e),u=t.getPoint((o+e)%n);hn(r,s,c),hn(i,u,s);const d=ft(r,i)/(A2(r)*A2(i));a[o]=d}return a}function hoe(t,e){const{max:n,deviation:r}=poe(t),{length:i}=t;if(r<.01||i<e*3)return[];const a=[];let o=null,s,c=0;for(let u=0;u<i;u++){const d=t[u];d<n-r?o?(o[2]=u,d<s&&(s=d,c=u),o[1]=c):(s=d,c=u,o=[u,u,u]):o&&(a.push(o),o=null)}return o&&(a[0][0]===0?a[0][0]=o[0]:(o[1]=c,o[2]=i-1,a.push(o))),a}function Uu(t,e,n,r,i){n<e&&(n+=i);const a=n-e,o=Math.ceil(a/r);if(o<=0)return t[t.length-1]!==n&&t.push(uv(n,i)),n;for(let s=1;s<=o;s++){const c=uv(e+s*a/o,i);t.push(c)}return t[t.length-1]}function uv(t,e){return(Math.round(t)+e)%e}function poe(t){const{length:e}=t;let n=0,r=1/0,i=-1/0,a=0;for(let s=0;s<e;s++){const c=t[s];n+=c,r=Math.min(r,c),i=Math.max(i,c)}const o=n/e;for(let s=0;s<e;s++){const c=t[s]-o;a+=c*c}return{mean:o,max:i,min:r,sumSq:a,deviation:Math.sqrt(a/e)}}function moe(t){const{parentAnnotationUID:e,annotationUID:n}=t;if(!e)return t.interpolationUID;const r=hf.getAnnotation(e),{interpolationUID:i}=r,a=r.childAnnotationUIDs.indexOf(n);return t.interpolationUID=`${i}-${a}`,t.interpolationUID}const{PointsManager:Vg}=js,uw=.2;function p2(t){if(!t.annotation)return;const{isInterpolationUpdate:e,annotation:n}=t;queueMicrotask(()=>{try{e&&(n.isInterpolationUpdate=!0,n.autoGenerated=!1),voe(t)}finally{e&&(n.autoGenerated=!0)}})}function voe(t){const{annotation:e}=t;moe(e);const{interpolationData:n,interpolationList:r}=ooe(e,t)||{};if(!n||!r)return;const i={toolName:e.metadata.toolName,toolType:e.metadata.toolName,viewport:t.viewport};for(let u=0;u<r.length;u++)r[u]&&yoe(r[u].list,r[u].pair,n,i);const{id:a,renderingEngineId:o,element:s}=t.viewport,c={annotation:e,element:s,viewportId:a,renderingEngineId:o};r.length&&je(t.viewport.element,Le.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED,c)}function yoe(t,e,n,r){const i=n.get(e[0])[0],a=n.get(e[1])[0],o=vw(i.data.contour.polyline),s=vw(a.data.contour.polyline),{c1Interp:c,c2Interp:u}=xoe(o,s);c.kIndex=e[0],u.kIndex=e[1],t.forEach(function(d){Toe(c,u,d,e,n,o.x.length>s.x.length,r)})}function Toe(t,e,n,r,i,a,o){const[s,c]=r,u=(n-s)/(c-s),d=i.get(s)[0],g=i.get(c)[0],h=woe(t,e,u,a),m=u>.5?g:d,y=goe(h);i.has(n)?Soe(h,y,n,m,o):Coe(h,y,n,m,o)}function Coe(t,e,n,r,i){const a=t.points,{viewport:o}=i,s=hM(a,e,r),c=o.getViewReference({sliceIndex:n});if(!c)throw new Error(`Can't find slice ${n}`);Object.assign(s.metadata,c),hf.addAnnotation(s,o.element),r.onInterpolationComplete?.(s,r);const{parentAnnotationUID:u}=r;if(u){const d=hf.getAnnotation(u),g=pM(d,n,i);rM(o,g,s)}}function pM(t,e,n){const{viewport:r}=n,i=hf.getAnnotations(t.metadata.toolName,r.element);for(let a=0;a<i.length;a++){const o=i[a];if(o.interpolationUID===t.interpolationUID&&o.metadata.sliceIndex===e)return o}}function Soe(t,e,n,r,i){const a=pM(r,n,i),o=t.points,s=hM(o,e,a);Object.assign(a,{metadata:s.metadata,data:s.data})}function woe(t,e,n,r){const i=r?t.I:e.I,a=Vg.fromXYZ(t),o=Vg.fromXYZ(e),{length:s}=a,c=Vg.create3(s),u=Ke(),d=Ke(),g=Vg.create3(s);g.kIndex=t.kIndex;const h=Vg.create3(s);h.kIndex=e.kIndex;for(let m=0;m<t.x.length;m++)if(i[m]){const y=a.getPoint(m),v=o.getPoint(m);g.push(y),h.push(v),hn(u,v,y),c.push(Si(d,y,u,n))}return c.sources=[g,h],c}function xoe(t,e){const n=mw(t),r=mw(e),i=Math.max(Math.ceil(n[n.length-1]/uw),Math.ceil(r[r.length-1]/uw)),a=pw(n),o=pw(r),s=i+e.x.length,c=i+t.x.length,u=hw(s,a),d=hw(c,o),g=dw(s-2,t.x.length),h=dw(c-2,e.x.length),m=gw(u,g),y=gw(d,h),v=fw(t,m),C=fw(e,y);return Roe(v,C),Eoe(v,C)}function Eoe(t,e){const n={x:[],y:[],z:[],I:[]},r={x:[],y:[],z:[],I:[]};for(let i=0;i<t.x.length;i++)(t.I[i]||e.I[i])&&(n.x.push(t.x[i]),n.y.push(t.y[i]),n.z.push(t.z[i]),n.I.push(t.I[i]),r.x.push(e.x[i]),r.y.push(e.y[i]),r.z.push(e.z[i]),r.I.push(e.I[i]));return{c1Interp:n,c2Interp:r}}function Roe(t,e){const n=t.x.length,r={startingNode:0,totalSquaredXYLengths:1/0};for(let a=0;a<n;a++){let o=a,s=0;for(let c=0;c<n;c++)s+=(t.x[o]-e.x[c])**2+(t.y[o]-e.y[c])**2+(t.z[o]-e.z[c])**2,o++,o===n&&(o=0);s<r.totalSquaredXYLengths&&(r.totalSquaredXYLengths=s,r.startingNode=a)}const i=r.startingNode;Mh(t.x,i),Mh(t.y,i),Mh(t.z,i),Mh(t.I,i)}function Mh(t,e){e-=t.length*Math.floor(e/t.length);const n=t.splice(0,e);return t.push(...n),t}function fw(t,e){const n={x:[],y:[],z:[],I:[]};for(let r=0;r<t.x.length-1;r++){n.x.push(t.x[r]),n.y.push(t.y[r]),n.z.push(t.z[r]),n.I.push(!0);const i=(t.x[r+1]-t.x[r])/(e[r]+1),a=(t.y[r+1]-t.y[r])/(e[r]+1),o=(t.z[r+1]-t.z[r])/(e[r]+1);for(let s=0;s<e[r]-1;s++)n.x.push(n.x[n.x.length-1]+i),n.y.push(n.y[n.y.length-1]+a),n.z.push(n.z[n.z.length-1]+o),n.I.push(!1)}return n}function gw(t,e){const n=[];for(let o=0;o<t.length;++o)n[o]=o;n.sort(function(o,s){return t[o]<t[s]?-1:1});const r=[];for(let o=0;o<e.length;o++)r.push(e[n[o]]);const i=r.reduce(function(o,s,c){return s&&o.push(c),o},[]),a=[];for(let o=0;o<i.length-1;o++)a.push(i[o+1]-i[o]);return a}function dw(t,e){const n=new Array(t+e);return n.fill(!1,0,t),n.fill(!0,t,t+e),n}function hw(t,e){const n=1/(t-1),r=[n];for(let i=1;i<t-2;i++)r.push(r[r.length-1]+n);return r.concat(e)}function pw(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n]/t[t.length-1]);return e}function mw(t){const e=[0];for(let n=1;n<t.x.length;n++){const r=Math.sqrt((t.x[n]-t.x[n-1])**2+(t.y[n]-t.y[n-1])**2+(t.z[n]-t.z[n-1])**2);e.push(e[n-1]+r)}return e}function vw(t){const e={x:[],y:[],z:[]};for(let n=0;n<t.length;n++)e.x[n]=t[n][0],e.y[n]=t[n][1],e.z[n]=t[n][2];return e.x.push(e.x[0]),e.y.push(e.y[0]),e.z.push(e.z[0]),e}function yw(t){const{annotation:e}=t,n=xy(t,[{key:"interpolationUID",value:t.interpolationUID}]),r=e.metadata.sliceIndex;let i=-1,a=t.sliceData.numberOfSlices;for(const[s,c]of n.entries())s===r||!c.find(d=>!d.autoGenerated)||(s<r?i=Math.max(s,i):a=Math.min(s,a));const o=[];for(const[s,c]of n.entries())s<=i||s>=a||s===r||c.forEach(u=>{u.autoGenerated&&(hf.removeAnnotation(u.annotationUID),o.push(u))});if(o.length){const s={annotations:o,element:t.viewport.element,viewportId:t.viewport.id,renderingEngineId:t.viewport.getRenderingEngine().id};je(t.viewport.element,Le.INTERPOLATED_ANNOTATIONS_REMOVED,s)}if(i>=0&&a<t.sliceData.numberOfSlices){const s=n.get(a)[0],c={viewport:t.viewport,sliceData:{numberOfSlices:t.sliceData.numberOfSlices,imageIndex:s.metadata.sliceIndex},annotation:s,interpolationUID:s.interpolationUID};p2(c)}}function c4(t){const e=oM(t);return e.length?e[0]:void 0}const{uuidv4:Ooe}=js,Doe=[Bs.HandlesUpdated,Bs.InterpolationUpdated],Do=class Do{static addTool(e){this.toolNames.includes(e)||this.toolNames.push(e)}static acceptAutoGenerated(e,n={}){const{toolNames:r,segmentationId:i,segmentIndex:a,sliceIndex:o}=n;for(const s of r||Do.toolNames){const c=hf.getAnnotations(s,e);if(c?.length)for(const u of c){const{interpolationUID:d,data:g,autoGenerated:h,metadata:m}=u;d&&(u.interpolationCompleted=!0),h&&(a&&a!==g.segmentation.segmentIndex||o!==void 0&&m&&o!==m.sliceIndex||i&&i!==g.segmentation.segmentationId||(Hl(u),u.autoGenerated=!1))}}}};Do.toolNames=[],Do.handleAnnotationCompleted=e=>{const n=e.detail.annotation;if(!n?.metadata)return;const{toolName:r,originalToolName:i}=n.metadata;if(!Do.toolNames.includes(r)&&!Do.toolNames.includes(i))return;const a=c4(n);if(!a){console.warn("Unable to find viewport for",n);return}const o=l4(a),s={viewport:a,sliceData:o,annotation:n,interpolationUID:n.interpolationUID},c=!!n.interpolationUID;if(n.autoGenerated=!1,c){yw(s),p2(s);return}const u=[{key:"segmentIndex",value:n.data.segmentation.segmentIndex,parentKey:m=>m.data.segmentation},{key:"viewPlaneNormal",value:n.metadata.viewPlaneNormal,parentKey:m=>m.metadata},{key:"viewUp",value:n.metadata.viewUp,parentKey:m=>m.metadata}];let d=aoe(s,u);const{sliceIndex:g}=n.metadata,h=new Set;d.forEach(m=>{if(m.interpolationCompleted||m.metadata.sliceIndex===g){const{interpolationUID:y}=m;h.add(y)}}),d=d.filter(m=>!h.has(m.interpolationUID)),n.interpolationUID=d[0]?.interpolationUID||Ooe(),s.interpolationUID=n.interpolationUID,p2(s)},Do.handleAnnotationUpdate=e=>{const n=e.detail.annotation,{changeType:r=Bs.HandlesUpdated}=e.detail;if(!n?.metadata)return;const{toolName:i,originalToolName:a}=n.metadata;if(!Do.toolNames.includes(i)&&!Do.toolNames.includes(a)||!Doe.includes(r))return;const o=c4(n);if(!o){console.warn("Unable to find matching viewport for annotation interpolation",n);return}n.autoGenerated&&(Hl(n),n.autoGenerated=!1);const s=l4(o),c={viewport:o,sliceData:s,annotation:n,interpolationUID:n.interpolationUID,isInterpolationUpdate:r===Bs.InterpolationUpdated};p2(c)},Do.handleAnnotationDelete=e=>{const n=e.detail.annotation;if(!n?.metadata)return;const{toolName:r}=n.metadata;if(!Do.toolNames.includes(r)||n.autoGenerated)return;const i=c4(n);if(!i){console.warn("No viewport, can't delete interpolated results",n);return}const a=l4(i),o={viewport:i,sliceData:a,annotation:n,interpolationUID:n.interpolationUID};n.autoGenerated=!1,yw(o)};let qc=Do;function l4(t){return{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getCurrentImageIdIndex()}}function _oe(t){t.forEach(e=>{const n=Q_(e);if(!n){console.warn(`ToolGroup not available for ${e}`);return}n.getViewportsInfo().forEach(i=>{const{renderingEngineId:a,viewportId:o}=i,s=Yc(a);if(!s){console.warn(`RenderingEngine not available for ${a}`);return}const c=s.getViewport(o);Q1(c.element)})})}function boe(t){const e=Pa(t);if(!e)throw new Error(`No segmentation state found for ${t}`);const{segments:n}=e;return Object.keys(n).filter(i=>n[i].locked).map(i=>parseInt(i))}function Moe(t,e,n){const r=Al(t,{segmentationId:e});if(!r||r.length===0)return null;const i=r[0],{colorLUTIndex:a}=i,o=oy(a);let s=o[n];if(!s){if(typeof n!="number")return console.warn(`Can't create colour for LUT index ${n}`),null;s=o[n]=[0,0,0,0]}return s}function Loe(t,e){return Ks.getSegmentationRepresentationVisibility(t,e)}function Voe({segmentationId:t,segmentIndex:e,viewportId:n,autoGenerated:r=!1}){const i=Moe(n,t,e),a=Loe(n,{segmentationId:t,type:At.Contour}),s=Ty(n)?.segmentationId===t,u=tf.getStyle({viewportId:n,segmentationId:t,type:At.Contour,segmentIndex:e});let d=1,g,h=1,m=0;r?(d=u.outlineWidthAutoGenerated??d,g=u.outlineDashAutoGenerated??g,h=u.outlineOpacity??h,m=u.fillAlphaAutoGenerated??m):s?(d=u.outlineWidth??d,g=u.outlineDash??g,h=u.outlineOpacity??h,m=u.fillAlpha??m):(d=u.outlineWidthInactive??d,g=u.outlineDashInactive??g,h=u.outlineOpacityInactive??h,m=u.fillAlphaInactive??m),Cy(t)===e&&(d+=u.activeSegmentOutlineWidthDelta),d=u.renderOutline?d:0,m=u.renderFill?m:0;const y=`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${h})`,v=`rgb(${i[0]}, ${i[1]}, ${i[2]})`,S=!cy(n,{segmentationId:t,type:At.Contour}).has(e);return{color:y,fillColor:v,lineWidth:d,fillOpacity:m,lineDash:g,textbox:{color:y},visibility:a&&S}}const by=class by extends ioe{constructor(e,n){super(e,n),this.configuration.interpolation?.enabled&&qc.addTool(this.getToolName())}isContourSegmentationTool(){return!0}createAnnotation(e){const n=e.detail,{element:r}=n,i=mt(r);if(!i)return;const{viewport:a}=i,o=super.createAnnotation(e);if(!this.isContourSegmentationTool())return o;const s=Ty(a.id);if(!s)throw new Error("No active segmentation detected, create one before using scissors tool");if(!s.representationData.Contour)throw new Error("A contour segmentation must be active");const{segmentationId:c}=s,u=Cy(c);return Ia(o,{data:{segmentation:{segmentationId:c,segmentIndex:u}}})}addAnnotation(e,n){const r=super.addAnnotation(e,n);return this.isContourSegmentationTool()&&Hl(e),r}cancelAnnotation(e){this.isContourSegmentationTool()&&zl(e),super.cancelAnnotation(e)}getAnnotationStyle(e){const n=super.getAnnotationStyle(e);if(!this.isContourSegmentationTool())return n;const r=this._getContourSegmentationStyle(e);return Ia(n,r)}renderAnnotationInstance(e){const{annotation:n}=e,{invalidated:r}=n,i=super.renderAnnotationInstance(e);if(r&&this.isContourSegmentationTool()){const{segmentationId:a}=n.data.segmentation;Yp(a);const s=qb(a).map(c=>Qi(c).id);_oe(s)}return i}_getContourSegmentationStyle(e){const n=e.annotation,{segmentationId:r,segmentIndex:i}=n.data.segmentation,{viewportId:a}=e.styleSpecifier,o=Al(a,{segmentationId:r});if(!o?.length)return{};o.length>1?o.find(C=>C.segmentationId===r&&C.type===At.Contour):o[0];const{autoGenerated:s}=n,u=boe(r).includes(i),{color:d,fillColor:g,lineWidth:h,fillOpacity:m,lineDash:y,visibility:v}=Voe({segmentationId:r,segmentIndex:i,viewportId:a,autoGenerated:s});return{color:d,fillColor:g,lineWidth:h,fillOpacity:m,lineDash:y,textbox:{color:d},visibility:v,locked:u}}};by.PreviewSegmentIndex=255;let fv=by;function Ioe(t,e,n){return t==="CT"?"HU":t==="PT"?Aoe(e,n):""}function Aoe(t,e){return e.isPreScaled?e.isSuvScaled?"SUV":it("generalSeriesModule",t)?.modality==="PT"?it("petSeriesModule",t)?.units||"unitless":"unknown":"raw"}const{pointCanProjectOnLine:Tw}=Ql,{EPSILON:Noe}=Tv,Poe=1-Noe,My=class My extends fv{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:Qa.Shift,alwaysRenderOpenContourHandles:{enabled:!1,radius:2},allowOpenContours:!0,closeContourProximity:10,checkCanvasEditFallbackProximity:6,makeClockWise:!0,subPixelResolution:4,smoothing:{smoothOnAdd:!1,smoothOnEdit:!1,knotsRatioPercentageOnAdd:40,knotsRatioPercentageOnEdit:40},interpolation:{enabled:!1,onInterpolationComplete:null},decimate:{enabled:!1,epsilon:.1},displayOnePointAsCrosshairs:!1,calculateStats:!0,getTextLines:Uoe,statsCalculator:sv}}){super(e,n),this.isDrawing=!1,this.isEditingClosed=!1,this.isEditingOpen=!1,this.addNewAnnotation=r=>{const i=r.detail,{element:a}=i,o=this.createAnnotation(r);this.addAnnotation(o,a);const s=s1(a,this.getToolName());return this.activateDraw(r,o,s),r.preventDefault(),pa(s),o},this.handleSelectedCallback=(r,i,a)=>{const o=r.detail,{element:s}=o,c=s1(s,this.getToolName());this.activateOpenContourEndEdit(r,i,c,a)},this.toolSelectedCallback=(r,i)=>{const a=r.detail,{element:o}=a,s=s1(o,this.getToolName());i.data.contour.closed?this.activateClosedContourEdit(r,i,s):this.activateOpenContourEdit(r,i,s),r.preventDefault()},this.isPointNearTool=(r,i,a,o)=>{const s=mt(r),{viewport:c}=s,{polyline:u}=i.data.contour;let d=c.worldToCanvas(u[0]);for(let m=1;m<u.length;m++){const y=d,v=c.worldToCanvas(u[m]);if(Tw(a,y,v,o))return!0;d=v}if(!i.data.contour.closed)return!1;const g=c.worldToCanvas(u[0]),h=c.worldToCanvas(u[u.length-1]);return Tw(a,g,h,o)},this.cancel=r=>{const i=this.isDrawing,a=this.isEditingOpen,o=this.isEditingClosed;i?this.cancelDrawing(r):a?this.cancelOpenContourEdit(r):o&&this.cancelClosedContourEdit(r)},this._calculateCachedStats=(r,i,a,o)=>{const{data:s}=r,{cachedStats:c}=s,{polyline:u,closed:d}=s.contour,g=Object.keys(c);for(let m=0;m<g.length;m++){const y=g[m],v=this.getTargetImageData(y);if(!v)continue;const{imageData:C,metadata:S}=v,w=u.map(z=>i.worldToCanvas(z)),x={isPreScaled:roe(i,y),isSuvScaled:this.isSuvScaled(i,y,r.metadata.referencedImageId)},R=Ioe(S.Modality,r.metadata.referencedImageId,x),O=Uie(v,()=>{const z=s.contour.polyline,oe=z.length,Q=new Array(oe);for(let ue=0;ue<oe;ue++)Q[ue]=i.worldToCanvas(z[ue]);const{maxX:le,maxY:X,minX:ie,minY:ye}=ap(Q),ge=i.canvasToWorld([ie,ye]),W=Vc(C,ge),ae=i.canvasToWorld([le,X]),fe=Vc(C,ae);return[W,fe]}),b=w[0],I=i.canvasToWorld(b),G=i.canvasToWorld([b[0]+1,b[1]]),j=i.canvasToWorld([b[0],b[1]+1]),F=y1(I,G),$=y1(I,j);d?this.updateClosedCachedStats({targetId:y,viewport:i,canvasCoordinates:w,points:u,imageData:C,metadata:S,cachedStats:c,modalityUnit:R,calibratedScale:O,deltaInX:F,deltaInY:$}):this.updateOpenCachedStats({metadata:S,canvasCoordinates:w,targetId:y,cachedStats:c,modalityUnit:R,calibratedScale:O,deltaInX:F,deltaInY:$})}const h=r.invalidated;return r.invalidated=!1,h&&Ao(r,o.viewport.element,Bs.StatsUpdated),c},this._renderStats=(r,i,a,o)=>{const{data:s}=r,c=this.getTargetId(i),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:a.viewport.id,annotationUID:r.annotationUID},d=this.getLinkedTextBoxStyle(u,r);if(!d.visibility)return;const g=this.configuration.getTextLines(s,c);if(!g||g.length===0)return;const h=s.contour.polyline.map(R=>i.worldToCanvas(R));if(!s.handles.textBox.hasMoved){const R=toe(h);s.handles.textBox.worldPosition=i.canvasToWorld(R)}const m=i.worldToCanvas(s.handles.textBox.worldPosition),v=Mre(o,r.annotationUID??"","1",g,m,h,{},d),{x:C,y:S,width:w,height:x}=v;s.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([C,S]),topRight:i.canvasToWorld([C+w,S]),bottomLeft:i.canvasToWorld([C,S+x]),bottomRight:i.canvasToWorld([C+w,S+x])}},sae(this),pae(this),Rae(this),Fae(this),Bae(this),eoe(this),this._throttledCalculateCachedStats=Fie(this._calculateCachedStats,100,{trailing:!0})}filterInteractableAnnotationsForElement(e,n){if(!n||!n.length)return;const r=mt(e),{viewport:i}=r;let a;if(i instanceof Io){const o=i.getCamera(),{spacingInNormalDirection:s}=z1(i,o);a=this.filterAnnotationsWithinSlice(n,o,s)}else a=cM(i,n);return a}filterAnnotationsWithinSlice(e,n,r){const{viewPlaneNormal:i}=n,a=e.filter(u=>{let d=u.metadata.viewPlaneNormal;if(!u.metadata.referencedImageId&&!d&&u.metadata.FrameOfReferenceUID){for(const h of u.data.contour.polyline){const m=hn(Ke(),h,n.focalPoint),y=ft(m,n.viewPlaneNormal);if(!Tn(y,0))return!1}return u.metadata.viewPlaneNormal=n.viewPlaneNormal,u.metadata.cameraFocalPoint=n.focalPoint,!0}if(!d){const{referencedImageId:h}=u.metadata,{imageOrientationPatient:m}=it("imagePlaneModule",h),y=on(m[0],m[1],m[2]),v=on(m[3],m[4],m[5]);d=Ke(),Cn(d,y,v),u.metadata.viewPlaneNormal=d}const g=Math.abs(ft(i,d))>Poe;return d&&g});if(!a.length)return[];const o=r/2,{focalPoint:s}=n,c=[];for(const u of a){const g=u.data.contour.polyline[0];if(!u.isVisible)continue;const h=Ke();hn(h,s,g);const m=ft(h,i);Math.abs(m)<o&&c.push(u)}return c}isContourSegmentationTool(){return!1}createAnnotation(e){const n=e.detail.currentPoints.world,r=super.createAnnotation(e),i=o=>{o.data.handles.points.length=0};return Ia(r,{data:{contour:{polyline:[[...n]]},label:"",cachedStats:{}},onInterpolationComplete:i})}getAnnotationStyle(e){return super.getAnnotationStyle(e)}renderAnnotationInstance(e){const{enabledElement:n,targetId:r,svgDrawingHelper:i}=e,a=e.annotation;let o=!1;const{viewport:s,renderingEngine:c}=n,u=this.isDrawing,d=this.isEditingOpen,g=this.isEditingClosed;if(!(u||d||g))this.configuration.displayOnePointAsCrosshairs&&a.data.contour.polyline.length===1?this.renderPointContourWithMarker(n,i,a):this.renderContour(n,i,a);else{const h=this.commonData.annotation.annotationUID;if(a.annotationUID===h)if(u)this.renderContourBeingDrawn(n,i,a);else if(g)this.renderClosedContourBeingEdited(n,i,a);else if(d)this.renderOpenContourBeingEdited(n,i,a);else throw new Error(`Unknown ${this.getToolName()} annotation rendering state`);else this.configuration.displayOnePointAsCrosshairs&&a.data.contour.polyline.length===1?this.renderPointContourWithMarker(n,i,a):this.renderContour(n,i,a);o=!0}if(this.configuration.calculateStats)return this._calculateStatsIfActive(a,r,s,c,n),this._renderStats(a,s,n,i),o}_calculateStatsIfActive(e,n,r,i,a){const o=this.commonData?.annotation.annotationUID;if(!(e.annotationUID===o&&!this.commonData?.movingTextBox)&&!this.commonData?.movingTextBox){const{data:s}=e;s.cachedStats[n]?.unit?e.invalidated&&this._throttledCalculateCachedStats(e,r,i,a):(s.cachedStats[n]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null,unit:null},this._calculateCachedStats(e,r,i,a))}}updateClosedCachedStats({viewport:e,points:n,imageData:r,metadata:i,cachedStats:a,targetId:o,modalityUnit:s,canvasCoordinates:c,calibratedScale:u,deltaInX:d,deltaInY:g}){const{scale:h,areaUnit:m,unit:y}=u,{voxelManager:v}=e.getImageData(),C=Vc(r,n[0]);C[0]=Math.floor(C[0]),C[1]=Math.floor(C[1]),C[2]=Math.floor(C[2]);let S=C[0],w=C[0],x=C[1],R=C[1],O=C[2],b=C[2];for(let ae=1;ae<n.length;ae++){const fe=Vc(r,n[ae]);fe[0]=Math.floor(fe[0]),fe[1]=Math.floor(fe[1]),fe[2]=Math.floor(fe[2]),S=Math.min(S,fe[0]),w=Math.max(w,fe[0]),x=Math.min(x,fe[1]),R=Math.max(R,fe[1]),O=Math.min(O,fe[2]),b=Math.max(b,fe[2])}const I=Vc(r,n[1]);I[0]=Math.floor(I[0]),I[1]=Math.floor(I[1]),I[2]=Math.floor(I[2]);let G=uy(c)/h/h;G*=d*g;let j=sw(c,closed)/h;j*=Math.sqrt(Math.pow(d,2)+Math.pow(g,2));const F=.01*(w-S),$=.01*(R-x),z=.01*(b-O);S=Math.floor(S-F),w=Math.ceil(w+F),x=Math.floor(x-$),R=Math.ceil(R+$),O=Math.floor(O-z),b=Math.ceil(b+z);const oe=[[S,w],[x,R],[O,b]],Q=r.indexToWorld([w,R,b]),le=e.worldToCanvas(Q);let X=0,ie=[],ye=0,ge;v&&(ge=v.forEach(this.configuration.statsCalculator.statsCallback,{imageData:r,isInObject:(ae,fe)=>{let ue=!0;const qe=e.worldToCanvas(ae);return qe[1]!=X&&(ye=0,X=qe[1],ie=tM(c,qe,[le[0],qe[1]]),ie.sort(function(et){return function(Ze,yt){return Ze[et]===yt[et]?0:Ze[et]<yt[et]?-1:1}}(0))),ie.length&&qe[0]>ie[0][0]&&(ie.shift(),ye++),ye%2===0&&(ue=!1),ue},boundsIJK:oe,returnPoints:this.configuration.storePointData}));const W=this.configuration.statsCalculator.getStatistics();a[o]={Modality:i.Modality,area:G,perimeter:j,mean:W.mean?.value,max:W.max?.value,min:W.min?.value,stdDev:W.stdDev?.value,statsArray:W.array,pointsInShape:ge,areaUnit:m,modalityUnit:s,unit:y}}updateOpenCachedStats({targetId:e,metadata:n,canvasCoordinates:r,cachedStats:i,modalityUnit:a,calibratedScale:o,deltaInX:s,deltaInY:c}){const{scale:u,unit:d}=o;let g=sw(r,closed)/u;g*=Math.sqrt(Math.pow(s,2)+Math.pow(c,2)),i[e]={Modality:n.Modality,length:g,modalityUnit:a,unit:d}}};My.toolName="PlanarFreehandROI";let gv=My;function Uoe(t,e){const n=t.cachedStats[e],{area:r,mean:i,stdDev:a,length:o,perimeter:s,max:c,min:u,isEmptyArea:d,unit:g,areaUnit:h,modalityUnit:m}=n||{},y=[];if(Rc(r)){const v=d?"Area: Oblique not supported":`Area: ${Dc(r)} ${h}`;y.push(v)}return Rc(i)&&y.push(`Mean: ${Dc(i)} ${m}`),Rc(c)&&y.push(`Max: ${Dc(c)} ${m}`),Rc(u)&&y.push(`Min: ${Dc(u)} ${m}`),Rc(a)&&y.push(`Std Dev: ${Dc(a)} ${m}`),Rc(s)&&y.push(`Perimeter: ${Dc(s)} ${g}`),Rc(o)&&y.push(`${Dc(o)} ${g}`),y}const Ly=class Ly extends gv{constructor(e){const n=Ia({configuration:{calculateStats:!1,allowOpenContours:!1}},e);super(n)}isContourSegmentationTool(){return!0}renderAnnotationInstance(e){const n=e.annotation,{invalidated:r}=n,i=super.renderAnnotationInstance(e);if(r){const{segmentationId:a}=n.data.segmentation;Yp(a)}return i}};Ly.toolName="PlanarFreehandContourSegmentationTool";let cp=Ly;const Foe={[At.Labelmap]:Oie,[At.Contour]:hie,[At.Surface]:wne},Lh=cp.toolName;class koe{constructor(){this._needsRender=new Set,this._pendingRenderQueue=[],this._animationFrameSet=!1,this._animationFrameHandle=null,this._getAllViewports=()=>Hs().flatMap(n=>n.getViewports()),this._renderFlaggedSegmentations=()=>{if(this._throwIfDestroyed(),Array.from(this._needsRender).forEach(n=>{this._triggerRender(n)}),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._pendingRenderQueue.length>0){const n=this._pendingRenderQueue.shift();n&&n.length>0&&this._setViewportsToBeRenderedNextFrame(n)}}}renderSegmentationsForViewport(e){const n=e?[e]:this._getViewportIdsForSegmentation();this._setViewportsToBeRenderedNextFrame(n)}renderSegmentation(e){const n=this._getViewportIdsForSegmentation(e);this._setViewportsToBeRenderedNextFrame(n)}_getViewportIdsForSegmentation(e){const n=this._getAllViewports(),r=[];for(const i of n){const a=i.id;e?Al(a,{segmentationId:e})?.length>0&&r.push(a):Al(a)?.length>0&&r.push(a)}return r}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setViewportsToBeRenderedNextFrame(e){if(this._animationFrameSet){this._pendingRenderQueue.push(e);return}e.forEach(n=>{this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedSegmentations),this._animationFrameSet=!0)}_triggerRender(e){const n=Al(e);if(!n?.length)return;const{viewport:r}=ti(e)||{};if(!r)return;const i=[],a=n.map(o=>{o.type===At.Contour&&this._addPlanarFreeHandToolIfAbsent(r);const s=Foe[o.type];try{const c=s.render(r,o);i.push(c)}catch(c){console.error(c)}return Promise.resolve({segmentationId:o.segmentationId,type:o.type})});Promise.allSettled(a).then(o=>{const s=o.filter(d=>d.status==="fulfilled").map(d=>d.value);function c(d){const{element:g,viewportId:h}=d.detail;g.removeEventListener(We.IMAGE_RENDERED,c),s.forEach(m=>{const y={viewportId:h,segmentationId:m.segmentationId,type:m.type};je(Ye,Le.SEGMENTATION_RENDERED,{...y})})}r.element.addEventListener(We.IMAGE_RENDERED,c),r.render()})}_addPlanarFreeHandToolIfAbsent(e){Lh in ht.tools||Hg(cp);const n=Qi(e.id);n.hasTool(Lh)||(n.addTool(Lh),n.setToolPassive(Lh))}}function mM(t){yM.renderSegmentationsForViewport(t)}function vM(t){yM.renderSegmentation(t)}const yM=new koe;function Goe({modifiedSlicesToUse:t,representationData:e,type:n}){const r=rt.getVolume(e[n].volumeId);if(!r){console.warn("segmentation not found in cache");return}const{imageData:i,vtkOpenGLTexture:a}=r;let o;if(t?.length>0)o=t;else{const s=i.getDimensions()[2];o=[...Array(s).keys()]}o.forEach(s=>{a.setUpdatedFrame(s)}),i.modified()}function Boe({viewportIds:t,segmentationId:e}){t.forEach(n=>{let r=Al(n,{segmentationId:e});r=r.filter(i=>i.type===At.Labelmap),r.forEach(i=>{if(i.segmentationId!==e)return;const a=ti(n);if(!a)return;const{viewport:o}=a;if(o instanceof Io)return;const s=o1(n,e);s?.length&&s.forEach((c,u)=>{const d=c.actor.getMapper().getInputData(),g=D1(n,e),h=rt.getImage(g[u]);d.modified(),Ip(d,h)})})})}const $oe=function(t){const{segmentationId:e,modifiedSlicesToUse:n}=t.detail,{representationData:r}=Pa(e),i=qb(e),a=i.some(c=>{const{viewport:u}=ti(c);return u instanceof Io}),o=i.some(c=>{const{viewport:u}=ti(c);return u instanceof Na}),s=a&&o;i.forEach(c=>{const{viewport:u}=ti(c);u instanceof Io&&Goe({modifiedSlicesToUse:s?[]:n,representationData:r,type:At.Labelmap}),u instanceof Na&&Boe({viewportIds:i,segmentationId:e})})},TM=function(t){const{segmentationId:e}=t.detail,{representationData:n}=Pa(e);n.Labelmap&&$oe(t),vM(e)},CM=function(t){const{segmentationId:e}=t.detail;vM(e)};function Woe(t,e){return Ks.updateLabelmapSegmentationImageReferences(t,e)}const zoe=function(t){if(!t)return;const e=mt(t);if(!e)return;const{viewport:n}=e;n instanceof Vo||(t.addEventListener(We.PRE_STACK_NEW_IMAGE,_1),t.addEventListener(We.IMAGE_RENDERED,_1))},Hoe=function(t){t.removeEventListener(We.PRE_STACK_NEW_IMAGE,_1),t.removeEventListener(We.IMAGE_RENDERED,_1)};function _1(t){const e=t.detail,{viewportId:n,renderingEngineId:r}=e,{viewport:i}=H1(n,r),a=Al(n);if(!a?.length)return;const o=a.filter(u=>u.type===At.Labelmap),s=i.getActors();o.forEach(u=>{const{segmentationId:d}=u;Woe(n,d)});const c=o.flatMap(u=>o1(n,u.segmentationId)).filter(u=>u!==void 0);c.length&&(c.forEach(u=>{o.find(g=>D1(n,g.segmentationId)?.includes(u.referencedId))||i.removeActors([u.uid])}),o.forEach(u=>{const{segmentationId:d}=u,g=i.getCurrentImageId(),h=D1(n,d);if(!h)return;let m=!1;const y=v=>{const C=rt.getImage(v);if(!C){console.warn("No derived image found in the cache for segmentation representation",u);return}const S=s.find(w=>w.referencedId===v);if(S){const w=S.actor.getMapper().getInputData();w.setDerivedImage?w.setDerivedImage(C):Ip(w,C)}else{const{dimensions:w,spacing:x,direction:R}=i.getImageDataMetadata(C),O=rt.getImage(g)||{imageId:g},{origin:b}=i.getImageDataMetadata(O),I=b,G=C.voxelManager.getConstructor(),j=C.voxelManager.getScalarData(),F=Pt.newInstance({name:"Pixels",numberOfComponents:1,values:new G(j)}),$=Op.newInstance();$.setDimensions(w[0],w[1],1),$.setSpacing(x),$.setDirection(R),$.setOrigin(I),$.getPointData().setScalars(F),$.modified(),i.addImages([{imageId:v,representationUID:`${d}-${At.Labelmap}-${C.imageId}`,callback:({imageActor:z})=>{z.getMapper().setInputData($)}}]),m=!0;return}};h.forEach(y),m&&mM(n),i.render(),t.type===We.IMAGE_RENDERED&&i.element.removeEventListener(We.IMAGE_RENDERED,_1)}))}const SM={enable:zoe,disable:Hoe};async function joe(t){const e=t.detail.annotation;if(!Jp(e))return;const n=Koe(e),r=Yoe(n,e);if(!r.length){je(Ye,Le.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED,{element:n.element,sourceAnnotation:e});return}const i=vy(e.data.contour.polyline,n),a=jre(n,i,r);if(!a.length){je(Ye,Le.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED,{element:n.element,sourceAnnotation:e});return}if(a.length>1){Kre(n,e,i,a);return}const{targetAnnotation:o,targetPolyline:s,isContourHole:c}=a[0];if(c){const{contourHoleProcessingEnabled:u=!1}=t.detail;if(!u)return;rM(n,o,e)}else zre(n,o,s,e,i)}function qoe(t,e=!1){const n="PlanarFreehandContourSegmentationTool",r=Qi(t.id,t.renderingEngineId);let i;return r?r.hasTool(n)?r.getToolOptions(n)||(i=`Tool ${n} must be in active/passive state in ${r.id} toolGroup`):i=`Tool ${n} not added to ${r.id} toolGroup`:i=`ToolGroup not found for viewport ${t.id}`,i&&!e&&console.warn(i),!i}function Koe(t){const e=oM(t);return e.find(r=>qoe(r,!0))??e[0]}function Yoe(t,e){const{annotationUID:n}=e;return rb().filter(i=>i.annotationUID&&i.annotationUID!==n&&Jp(i)&&Rne(i,e)&&t.isReferenceViewable(i.metadata))}function Xoe(t){const e=t.detail.annotation;zl(e)}function wM(t){const e=t.detail.annotation;Jp(e)&&joe(t)}function lp(t){if(!t.detail.removed.length)return;Hs().forEach(r=>{const a=r.getViewports().map(o=>o.id);pa(a)})}function xM(t){const{viewportId:e}=t.detail;pa([e])}function Zoe(t){const e=t.detail.annotation;Jp(e)&&Xoe(t)}const EM=function(t){Q1(t.detail.element)},Qoe=function(t){t.addEventListener(We.IMAGE_RENDERED,EM)},Joe=function(t){t.removeEventListener(We.IMAGE_RENDERED,EM)},RM={enable:Qoe,disable:Joe},{Active:ese}=Kn;function bf(t,e,n){if(ht.isInteractingWithTool)return!1;const{renderingEngineId:r,viewportId:i}=n.detail,a=Qi(i,r);if(!a)return!1;let o;const s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const u=s[c],d=a.toolOptions[u],g=a.getToolInstance(u);if(d.mode===ese&&typeof g[e]=="function"){o=a.getToolInstance(u);break}}o&&o[e](n)}const OM=bf.bind(null,"Mouse","mouseClickCallback"),DM=bf.bind(null,"Mouse","doubleClickCallback");function _M(t,e,n,r="mouse"){const i=r==="touch"?36:6,a=[];return e.forEach(({tool:o,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;const u=o.getHandleNearImagePoint(t,c,n,i);if(u){a.push({tool:o,annotation:c,handle:u});break}}}),a}function i5(t,e){const n=[];for(let r=0;r<e.length;r++){const i=e[r];if(!i){console.warn("undefined tool in filterToolsWithAnnotationsForElement");continue}let a=E1(i.constructor.toolName,t);a?.length&&(typeof i.filterInteractableAnnotationsForElement=="function"&&(a=i.filterInteractableAnnotationsForElement(t,a)),a?.length>0&&n.push({tool:i,annotations:a}))}return n}function Ey(t,e,n,r="mouse"){const i=r==="touch"?36:6,a=[];return e.forEach(({tool:o,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;if(o.isPointNearTool(t,c,n,i,r)){a.push({tool:o,annotation:c});break}}}),a}const{Active:tse}=Kn;function a5(t){const{renderingEngineId:e,viewportId:n,event:r}=t.detail,i=n5(r)||_f.getModifierKey(),a=Qi(n,e);if(!a)return null;const o=Object.keys(a.toolOptions),s=a.getDefaultMousePrimary(),c=t.detail.buttons??r?.buttons??s;for(let u=0;u<o.length;u++){const d=o[u],g=a.toolOptions[d],h=g.bindings.length&&g.bindings.some(m=>m.mouseButton===c&&m.modifierKey===i);if(g.mode===tse&&h)return a.getToolInstance(d)}}function pf(t,e,n){const{renderingEngineId:r,viewportId:i}=t.detail,a=Qi(i,r);if(!a)return[];const o=[],s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const u=s[c],d=a.toolOptions[u],g=n!=null&&d.bindings.length&&d.bindings.some(h=>h.mouseButton===n);if(e.includes(d.mode)&&(!n||g)){const h=a.getToolInstance(u);o.push(h)}}return o}function nse(t,e){const n=new Map,{renderingEngineId:r,viewportId:i}=t.detail,a=Qi(i,r);if(!a)return n;const o=Object.keys(a.toolOptions),s=a.getDefaultMousePrimary(),c=t.detail.event,u=c?.buttons??s,d=n5(c)||_f.getModifierKey();for(let g=0;g<o.length;g++){const h=o[g],m=a.getToolInstance(h),y=m.configuration?.actions??{},v=Object.values(y);if(!v?.length||!e.includes(m.mode))continue;const C=v.find(S=>S.bindings?.length&&S.bindings.some(w=>w.mouseButton===u&&w.modifierKey===d));C&&n.set(m,C)}return n}const{Active:rse,Passive:ise}=Kn;function ase(t){if(ht.isInteractingWithTool)return!1;const e=t.detail,{element:n}=e,r=mt(n),{canvas:i}=e.currentPoints;if(!r)return!1;const a=nse(t,[rse,ise]),o=Array.from(a.keys()),s=i5(n,o),c=Ey(n,s,i);if(c.length>0){const{tool:u,annotation:d}=c[0],g=a.get(u);return(typeof g.method=="string"?u[g.method]:g.method).call(u,t,d),!0}return!1}const{Active:ose,Passive:sse}=Kn;function bM(t){if(ht.isInteractingWithTool)return;const e=a5(t);if(e&&typeof e.preMouseDownCallback=="function"&&e.preMouseDownCallback(t))return;const n=t.detail.event.buttons===1,r=pf(t,[ose],t.detail.event.buttons),i=n?pf(t,[sse]):void 0,a=[...r||[],...i||[]];if(ase(t))return;const s=t.detail,{element:c}=s,u=i5(c,a),d=s.currentPoints.canvas,g=_M(c,u,d,"mouse"),h=!!t.detail.event.shiftKey;if(g.length>0){const{tool:y,annotation:v,handle:C}=Cw(g);Sw(v.annotationUID,h),y.handleSelectedCallback(t,v,C,"Mouse");return}const m=Ey(c,u,d,"mouse");if(m.length>0){const{tool:y,annotation:v}=Cw(m);Sw(v.annotationUID,h),y.toolSelectedCallback(t,v,"Mouse",d);return}e&&typeof e.postMouseDownCallback=="function"&&e.postMouseDownCallback(t)}function Cw(t){if(t.length>1){const e=t.find(n=>{const r=!ff(n.annotation.annotationUID),i=ip(n.annotation.annotationUID);return r&&i});if(e)return e}return t[0]}function Sw(t,e=!1){e?Zp(t)?Vs(t,!1):Vs(t,!0,!0):Vs(t,!0,!1)}function MM(t){if(ht.isInteractingWithTool)return;const e=a5(t);if(e&&e.addNewAnnotation){const n=e.addNewAnnotation(t,"mouse");Vs(n.annotationUID)}}function LM(t){if(ht.isInteractingWithTool)return;const e=a5(t);!e||typeof e.mouseDragCallback!="function"||e.mouseDragCallback(t)}const{Active:cse,Passive:lse}=Kn;function VM(t){if(ht.isInteractingWithTool||ht.isMultiPartToolActive)return;const e=pf(t,[cse,lse]),n=t.detail,{element:r}=n,i=i5(r,e),a=e.filter(s=>!i.some(u=>u.tool.getToolName()===s.getToolName()));let o=!1;for(const{tool:s,annotations:c}of i)typeof s.mouseMoveCallback=="function"&&(o=s.mouseMoveCallback(t,c)||o);a.forEach(s=>{typeof s.mouseMoveCallback=="function"&&s.mouseMoveCallback(t)}),o===!0&&Q1(r)}const IM=bf.bind(null,"Mouse","mouseUpCallback");function AM(t){if(ht.isInteractingWithTool)return;t.detail.buttons=zc.Wheel|(t.detail.event.buttons||0);const e=a5(t);if(e)return e.mouseWheelCallback(t)}const use=function(t){t.addEventListener(Le.MOUSE_CLICK,OM),t.addEventListener(Le.MOUSE_DOWN,bM),t.addEventListener(Le.MOUSE_DOWN_ACTIVATE,MM),t.addEventListener(Le.MOUSE_DOUBLE_CLICK,DM),t.addEventListener(Le.MOUSE_DRAG,LM),t.addEventListener(Le.MOUSE_MOVE,VM),t.addEventListener(Le.MOUSE_UP,IM),t.addEventListener(Le.MOUSE_WHEEL,AM)},fse=function(t){t.removeEventListener(Le.MOUSE_CLICK,OM),t.removeEventListener(Le.MOUSE_DOWN,bM),t.removeEventListener(Le.MOUSE_DOWN_ACTIVATE,MM),t.removeEventListener(Le.MOUSE_DOUBLE_CLICK,DM),t.removeEventListener(Le.MOUSE_DRAG,LM),t.removeEventListener(Le.MOUSE_MOVE,VM),t.removeEventListener(Le.MOUSE_UP,IM),t.removeEventListener(Le.MOUSE_WHEEL,AM)},NM={enable:use,disable:fse},{Active:gse}=Kn;function PM(t){const{renderingEngineId:e,viewportId:n}=t.detail,r=Ite(),i=_f.getModifierKey(),a=Qi(n,e);if(!a)return null;const o=Object.keys(a.toolOptions),s=a.getDefaultMousePrimary();for(let c=0;c<o.length;c++){const u=o[c],d=a.toolOptions[u];if(d.mode!==gse)continue;if(d.bindings.length&&d.bindings.some(h=>h.mouseButton===(r??s)&&h.modifierKey===i))return a.getToolInstance(u)}}function dse(t,e){const n=new Map,{renderingEngineId:r,viewportId:i}=t.detail,a=Qi(i,r);if(!a)return n;const o=Object.keys(a.toolOptions),s=t.detail.key;for(let c=0;c<o.length;c++){const u=o[c],d=a.getToolInstance(u),g=d.configuration?.actions;if(!g)continue;const h=Object.values(g);if(!h?.length||!e.includes(d.mode))continue;const m=h.find(y=>y.bindings?.some(v=>v.key===s));m&&n.set(d,m)}return n}function UM(t){const e=PM(t);if(e){const{renderingEngineId:r,viewportId:i}=t.detail,a=Qi(i,r),o=e.getToolName();Object.keys(a.toolOptions).includes(o)&&a.setViewportsCursorByToolName(o)}const n=dse(t,[Kn.Active]);if(n?.size){const{element:r}=t.detail;for(const[i,a]of[...n.entries()])(typeof a.method=="function"?a.method:i[a.method]).call(i,r,a,t)}}function FM(t){const e=PM(t);if(!e)return;const{renderingEngineId:n,viewportId:r}=t.detail,i=Qi(r,n);Ub();const a=e.getToolName();Object.keys(i.toolOptions).includes(a)&&i.setViewportsCursorByToolName(a)}const hse=function(t){t.addEventListener(Le.KEY_DOWN,UM),t.addEventListener(Le.KEY_UP,FM)},pse=function(t){t.removeEventListener(Le.KEY_DOWN,UM),t.removeEventListener(Le.KEY_UP,FM)},kM={enable:hse,disable:pse},{Active:mse,Passive:vse,Enabled:yse}=Kn,GM=function(t){pf(t,[mse,vse,yse]).forEach(n=>{n.onCameraModified&&n.onCameraModified(t)})},Tse=function(t){t.addEventListener(We.CAMERA_MODIFIED,GM)},Cse=function(t){t.removeEventListener(We.CAMERA_MODIFIED,GM)},BM={enable:Tse,disable:Cse},{Active:Sse,Passive:wse,Enabled:xse}=Kn,$M=function(t){pf(t,[Sse,wse,xse]).forEach(n=>{n.onImageSpacingCalibrated&&n.onImageSpacingCalibrated(t)})},Ese=function(t){t.addEventListener(We.IMAGE_SPACING_CALIBRATED,$M)},Rse=function(t){t.removeEventListener(We.IMAGE_SPACING_CALIBRATED,$M)},WM={enable:Ese,disable:Rse},{Active:Ose}=Kn;function Ry(t){const{renderingEngineId:e,viewportId:n}=t.detail,r=t.detail.event,i=Qi(n,e);if(!i)return null;const a=Object.keys(i.toolOptions),o=Object.keys(r.touches).length,s=n5(r)||_f.getModifierKey(),c=i.getDefaultMousePrimary();for(let u=0;u<a.length;u++){const d=a[u],g=i.toolOptions[d],h=g.bindings.length&&g.bindings.some(m=>(m.numTouchPoints===o||o===1&&m.mouseButton===c)&&m.modifierKey===s);if(g.mode===Ose&&h)return i.getToolInstance(d)}}function ww(t,e,n){const{renderingEngineId:r,viewportId:i}=t.detail,a=Qi(i,r);if(!a)return[];const o=[],s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const u=s[c],d=a.toolOptions[u],g=n!=null&&d.bindings.length&&d.bindings.some(h=>h.numTouchPoints===n);if(e.includes(d.mode)&&(!n||g)){const h=a.getToolInstance(u);o.push(h)}}return o}const{Active:Dse,Passive:_se}=Kn;function zM(t){if(ht.isInteractingWithTool)return;const e=Ry(t);if(e&&typeof e.preTouchStartCallback=="function"&&e.preTouchStartCallback(t))return;const n=Object.keys(t.detail.event.touches).length===1,r=ww(t,[Dse],Object.keys(t.detail.event.touches).length),i=n?ww(t,[_se]):void 0,a=[...r||[],...i||[],e],o=t.detail,{element:s}=o,c=i5(s,a),u=o.currentPoints.canvas,d=_M(s,c,u,"touch"),g=!1;if(d.length>0){const{tool:m,annotation:y,handle:v}=xw(d);Ew(y.annotationUID,g),m.handleSelectedCallback(t,y,v,"Touch");return}const h=Ey(s,c,u,"touch");if(h.length>0){const{tool:m,annotation:y}=xw(h);Ew(y.annotationUID,g),m.toolSelectedCallback(t,y,"Touch",u);return}e&&typeof e.postTouchStartCallback=="function"&&e.postTouchStartCallback(t)}function xw(t){return t.length>1&&t.find(e=>!ff(e.annotation.annotationUID)&&ip(e.annotation.annotationUID))||t[0]}function Ew(t,e=!1){e?Zp(t)?Vs(t,!1):Vs(t,!0,!0):Vs(t,!0,!1)}function HM(t){if(ht.isInteractingWithTool)return;const e=Ry(t);if(e&&e.addNewAnnotation){const n=e.addNewAnnotation(t,"touch");Vs(n.annotationUID)}}function jM(t){if(ht.isInteractingWithTool)return;const e=Ry(t);!e||typeof e.touchDragCallback!="function"||e.touchDragCallback(t)}const qM=bf.bind(null,"Touch","touchEndCallback"),bse=bf.bind(null,"Touch","touchTapCallback"),KM=bf.bind(null,"Touch","touchPressCallback"),Mse=function(t){t.addEventListener(Le.TOUCH_START,zM),t.addEventListener(Le.TOUCH_START_ACTIVATE,HM),t.addEventListener(Le.TOUCH_DRAG,jM),t.addEventListener(Le.TOUCH_END,qM),t.addEventListener(Le.TOUCH_TAP,bse),t.addEventListener(Le.TOUCH_PRESS,KM)},Lse=function(t){t.removeEventListener(Le.TOUCH_START,zM),t.removeEventListener(Le.TOUCH_START_ACTIVATE,HM),t.removeEventListener(Le.TOUCH_DRAG,jM),t.removeEventListener(Le.TOUCH_END,qM),t.removeEventListener(Le.TOUCH_PRESS,KM)},YM={enable:Mse,disable:Lse},Vse=function(){Ye.addEventListener(Le.ANNOTATION_COMPLETED,qc.handleAnnotationCompleted),Ye.addEventListener(Le.ANNOTATION_MODIFIED,qc.handleAnnotationUpdate),Ye.addEventListener(Le.ANNOTATION_REMOVED,qc.handleAnnotationDelete)},Ise=function(){Ye.removeEventListener(Le.ANNOTATION_COMPLETED,qc.handleAnnotationCompleted),Ye.removeEventListener(Le.ANNOTATION_MODIFIED,qc.handleAnnotationUpdate),Ye.removeEventListener(Le.ANNOTATION_REMOVED,qc.handleAnnotationDelete)},XM={enable:Vse,disable:Ise},{Active:Ase,Passive:Nse,Enabled:Pse}=Kn,ZM=function(t){pf(t,[Ase,Nse,Pse]).forEach(n=>{n.onResetCamera&&n.onResetCamera(t)})},Use=function(t){t.addEventListener(We.CAMERA_RESET,ZM)},Fse=function(t){t.removeEventListener(We.CAMERA_RESET,ZM)},QM={enable:Use,disable:Fse};function JM(t){const{element:e,viewportId:n}=t.detail,r=kse(n);Gse(e),Bse(r,e),my.addViewportElement(n,e),pb.enable(e),Nb.enable(e),Vb.enable(e),_f.enable(e),SM.enable(e),RM.enable(e),BM.enable(e),WM.enable(e),QM.enable(e),NM.enable(e),kM.enable(e),YM.enable(e),ht.enabledElements.push(e)}function kse(t){const e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"svg"),r=`svg-layer-${t}`;n.classList.add("svg-layer"),n.setAttribute("id",r),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.position="absolute";const i=document.createElementNS(e,"defs"),a=document.createElementNS(e,"filter"),o=document.createElementNS(e,"feOffset"),s=document.createElementNS(e,"feColorMatrix"),c=document.createElementNS(e,"feBlend");return a.setAttribute("id",`shadow-${r}`),a.setAttribute("filterUnits","userSpaceOnUse"),o.setAttribute("result","offOut"),o.setAttribute("in","SourceGraphic"),o.setAttribute("dx","0.5"),o.setAttribute("dy","0.5"),s.setAttribute("result","matrixOut"),s.setAttribute("in","offOut"),s.setAttribute("in2","matrix"),s.setAttribute("values","0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 1 0"),c.setAttribute("in","SourceGraphic"),c.setAttribute("in2","matrixOut"),c.setAttribute("mode","normal"),a.appendChild(o),a.appendChild(s),a.appendChild(c),i.appendChild(a),n.appendChild(i),n}function Gse(t){const{viewportUid:e,renderingEngineUid:n}=t.dataset,r=`${e}:${n}`;ht.svgNodeCache[r]={}}function Bse(t,e){e.querySelector("div.viewport-element").appendChild(t)}function $se(t,e){const n=[];if(!e&&!t)throw new Error("At least one of renderingEngineId or viewportId should be given");for(let r=0;r<ht.synchronizers.length;r++){const i=ht.synchronizers[r],a=!i.isDisabled(),o=i.hasSourceViewport(e,t),s=i.hasTargetViewport(e,t);a&&(o||s)&&n.push(i)}return n}const Wse="viewport-element";function eL(t){const{element:e,viewportId:n}=t.detail;jse(e),qse(e),my.removeViewportElement(n,e),pb.disable(e),Nb.disable(e),Vb.disable(e),_f.disable(e),SM.disable(e),RM.disable(e),BM.disable(e),WM.disable(e),QM.disable(e),NM.disable(e),kM.disable(e),YM.disable(e),zse(e),Hse(e),Kse(e)}const zse=t=>{const e=mt(t);if(!e)return;$se(e.viewportId,e.renderingEngineId).forEach(r=>{r.remove(e)})},Hse=t=>{const e=mt(t);if(!e)return;const{renderingEngineId:n,viewportId:r}=e,i=Qi(r,n);i&&i.removeViewports(n,r)};function jse(t){const{viewportUid:e,renderingEngineUid:n}=t.dataset,r=`${e}:${n}`;delete ht.svgNodeCache[r]}function qse(t){const e=t.querySelector(`div.${Wse}`),n=e.querySelector("svg");n&&e.removeChild(n)}const Kse=function(t){const e=ht.enabledElements.findIndex(n=>n===t);e>-1&&ht.enabledElements.splice(e,1)};class Yse{constructor(e,n,r,i){this._viewportOptions={},this._onEvent=a=>{if(this._ignoreFiredEvents===!0||!this._targetViewports.length)return;const o=this._eventSource==="element"?mt(a.currentTarget):ti(a.detail?.viewportId);if(!o)return;const{renderingEngineId:s,viewportId:c}=o;this._sourceViewports.find(u=>u.viewportId===c)&&this.fireEvent({renderingEngineId:s,viewportId:c},a)},this._enabled=!0,this._eventName=n,this._eventHandler=r,this._ignoreFiredEvents=!1,this._sourceViewports=[],this._targetViewports=[],this._options=i||{},this._eventSource=this._options.eventSource||"element",this._auxiliaryEvents=this._options.auxiliaryEvents||[],this.id=e}isDisabled(){return!this._enabled||!this._hasSourceElements()}setOptions(e,n={}){this._viewportOptions[e]=n}setEnabled(e){this._enabled=e}getOptions(e){return this._viewportOptions[e]}add(e){this.addTarget(e),this.addSource(e)}addSource(e){if(Vh(this._sourceViewports,e))return;const{renderingEngineId:n,viewportId:r}=e,i=Yc(n).getViewport(r);if(!i){console.warn(`Synchronizer.addSource: No viewport for ${n} ${r}`);return}(this._eventSource==="element"?i.element:Ye).addEventListener(this._eventName,this._onEvent.bind(this)),this._auxiliaryEvents.forEach(({name:o,source:s})=>{(s==="element"?i.element:Ye).addEventListener(o,this._onEvent.bind(this))}),this._updateDisableHandlers(),this._sourceViewports.push(e)}addTarget(e){Vh(this._targetViewports,e)||(this._targetViewports.push(e),this._updateDisableHandlers())}getSourceViewports(){return this._sourceViewports}getTargetViewports(){return this._targetViewports}destroy(){this._sourceViewports.forEach(e=>this.removeSource(e)),this._targetViewports.forEach(e=>this.removeTarget(e))}remove(e){this.removeTarget(e),this.removeSource(e)}removeSource(e){const n=Rw(this._sourceViewports,e);if(n===-1)return;const r=this._eventSource==="element"?this.getViewportElement(e):Ye;this._sourceViewports.splice(n,1),r.removeEventListener(this._eventName,this._eventHandler),this._auxiliaryEvents.forEach(({name:i,source:a})=>{(a==="element"?this.getViewportElement(e):Ye).removeEventListener(i,this._eventHandler)}),this._updateDisableHandlers()}removeTarget(e){const n=Rw(this._targetViewports,e);n!==-1&&(this._targetViewports.splice(n,1),this._updateDisableHandlers())}hasSourceViewport(e,n){return Vh(this._sourceViewports,{renderingEngineId:e,viewportId:n})}hasTargetViewport(e,n){return Vh(this._targetViewports,{renderingEngineId:e,viewportId:n})}fireEvent(e,n){if(this.isDisabled()||this._ignoreFiredEvents)return;this._ignoreFiredEvents=!0;const r=[];try{for(let i=0;i<this._targetViewports.length;i++){const a=this._targetViewports[i];if(e.viewportId===a.viewportId)continue;const s=this._eventHandler(this,e,a,n,this._options);s instanceof Promise&&r.push(s)}}catch(i){console.warn(`Synchronizer, for: ${this._eventName}`,i)}finally{r.length?Promise.allSettled(r).then(()=>{this._ignoreFiredEvents=!1}):this._ignoreFiredEvents=!1}}_hasSourceElements(){return this._sourceViewports.length!==0}_updateDisableHandlers(){const e=Xse(this._sourceViewports,this._targetViewports),n=this.remove.bind(this),r=i=>{n(i.detail.element)};e.forEach(i=>{const a=this.getEventSource(i);a&&(a.removeEventListener(We.ELEMENT_DISABLED,r),a.addEventListener(We.ELEMENT_DISABLED,r))})}getEventSource(e){return this._eventSource==="element"?this.getViewportElement(e):Ye}getViewportElement(e){const{renderingEngineId:n,viewportId:r}=e,i=Yc(n);if(!i)return null;const a=i.getViewport(r);return a?a.element:null}}function Xse(t,e){const n=[],r=t.concat(e);for(let i=0;i<r.length;i++){const a=r[i];n.some(o=>a.renderingEngineId===o.renderingEngineId&&a.viewportId===o.viewportId)||n.push(a)}return n}function Rw(t,e){return t.findIndex(n=>e.renderingEngineId===n.renderingEngineId&&e.viewportId===n.viewportId)}function Vh(t,e){return t.some(n=>n.renderingEngineId===e.renderingEngineId&&n.viewportId===e.viewportId)}function Zse(t,e,n,r){if(ht.synchronizers.some(o=>o.id===t))throw new Error(`Synchronizer with id '${t}' already exists.`);const a=new Yse(t,e,n,r);return ht.synchronizers.push(a),a}function Qse(t){return ht.synchronizers.find(e=>e.id===t)}function Jse(t){const e=ht.synchronizers.findIndex(n=>n.id===t);e>-1&&(ht.synchronizers[e].destroy(),ht.synchronizers.splice(e,1))}const up=function(t){const{viewportId:e}=t.detail;mM(e)};let Ow=!1;function ece(t={}){Ow||(mne(t),tce(),rce(),Ow=!0)}function tce(){nce();const t=We.ELEMENT_ENABLED,e=We.ELEMENT_DISABLED;Ye.addEventListener(t,JM),Ye.addEventListener(e,eL),XM.enable()}function nce(){const t=We.ELEMENT_ENABLED,e=We.ELEMENT_DISABLED;Ye.removeEventListener(t,JM),Ye.removeEventListener(e,eL),XM.disable()}function rce(){ice(),Ye.addEventListener(Le.ANNOTATION_COMPLETED,wM),Ye.addEventListener(Le.ANNOTATION_MODIFIED,xM),Ye.addEventListener(Le.ANNOTATION_SELECTION_CHANGE,lp),Ye.addEventListener(Le.ANNOTATION_SELECTION_CHANGE,lp),Ye.addEventListener(Le.ANNOTATION_REMOVED,Zoe),Ye.addEventListener(Le.SEGMENTATION_MODIFIED,CM),Ye.addEventListener(Le.SEGMENTATION_DATA_MODIFIED,TM),Ye.addEventListener(Le.SEGMENTATION_REPRESENTATION_MODIFIED,up),Ye.addEventListener(Le.SEGMENTATION_REPRESENTATION_ADDED,up)}function ice(){Ye.removeEventListener(Le.ANNOTATION_COMPLETED,wM),Ye.removeEventListener(Le.ANNOTATION_MODIFIED,xM),Ye.removeEventListener(Le.ANNOTATION_SELECTION_CHANGE,lp),Ye.removeEventListener(Le.ANNOTATION_SELECTION_CHANGE,lp),Ye.removeEventListener(Le.SEGMENTATION_MODIFIED,CM),Ye.removeEventListener(Le.SEGMENTATION_DATA_MODIFIED,TM),Ye.removeEventListener(Le.SEGMENTATION_REPRESENTATION_MODIFIED,up),Ye.removeEventListener(Le.SEGMENTATION_REPRESENTATION_ADDED,up)}class jg extends df{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"]}){super(e,n)}touchDragCallback(e){this._dragCallback(e)}mouseDragCallback(e){this._dragCallback(e)}_dragCallback(e){const{element:n,deltaPoints:r}=e.detail,i=mt(n),a=r.world;if(a[0]===0&&a[1]===0&&a[2]===0)return;const o=i.viewport.getCamera(),{focalPoint:s,position:c}=o,u=[c[0]-a[0],c[1]-a[1],c[2]-a[2]],d=[s[0]-a[0],s[1]-a[1],s[2]-a[2]];i.viewport.setCamera({focalPoint:d,position:u}),i.viewport.render()}}jg.toolName="Pan";class qg extends df{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"],configuration:{zoomToCenter:!1,minZoomScale:.001,maxZoomScale:3e3,pinchToZoom:!0,pan:!0,invert:!1}}){super(e,n),this.preMouseDownCallback=r=>{const i=r.detail,{element:a,currentPoints:o}=i,s=o.world,u=mt(a).viewport.getCamera(),{focalPoint:d}=u;this.initialMousePosWorld=s;let g=on(d[0]-s[0],d[1]-s[1],d[2]-s[2]);return g=Sn(Ke(),g),this.dirVec=g,!1},this.preTouchStartCallback=r=>{if(!this.configuration.pinchToZoom)return this.preMouseDownCallback(r)},this._dragParallelProjection=(r,i,a,o=!1)=>{const{element:s,deltaPoints:c}=r.detail,u=o?r.detail.deltaDistance.canvas:c.canvas[1],d=[s.clientWidth,s.clientHeight],{parallelScale:g,focalPoint:h,position:m}=a,y=5/d[1],v=u*y*(this.configuration.invert?-1:1),C=(1-v)*g;let S=h,w=m;if(!this.configuration.zoomToCenter){const I=y1(h,this.initialMousePosWorld);w=Si(Ke(),m,this.dirVec,-I*v),S=Si(Ke(),h,this.dirVec,-I*v)}const x=i.getImageData();let R=[1,1,1],O=C,b=!1;if(x){R=x.spacing;const{dimensions:I}=x,G=I[0]*R[0],j=I[1]*R[1],F=d[0]/d[1],$=i.options?.displayArea,z=$?.imageArea?.[0]??1.1,oe=$?.imageArea?.[1]??1.1,Q=G*z,le=j*oe,X=Q/le;let ie;X>F?ie=Q/F*.5:ie=le*.5;const{minZoomScale:ye,maxZoomScale:ge}=this.configuration,W=ie/ge,ae=ie/ye;C<W?(O=W,b=!0):C>ae&&(O=ae,b=!0)}i.setCamera({parallelScale:O,focalPoint:b?h:S,position:b?m:w})},this._dragPerspectiveProjection=(r,i,a,o=!1)=>{const{element:s,deltaPoints:c}=r.detail,u=o?r.detail.deltaDistance.canvas:c.canvas[1],d=[s.clientWidth,s.clientHeight],{position:g,focalPoint:h,viewPlaneNormal:m}=a,y=_o.distance2BetweenPoints(g,h),v=Math.sqrt(y)/d[1],C=[-m[0],-m[1],-m[2]],S=this.configuration.invert?u/v:u*v;let w=S*C[0];g[0]+=w,h[0]+=w,w=S*C[1],g[1]+=w,h[1]+=w,w=S*C[2],g[2]+=w,h[2]+=w,i.setCamera({position:g,focalPoint:h})},this.initialMousePosWorld=[0,0,0],this.dirVec=[0,0,0],this.configuration.pinchToZoom?this.touchDragCallback=this._pinchCallback.bind(this):this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}mouseWheelCallback(e){this._zoom(e)}_pinchCallback(e){if(e.detail.currentPointsList.length>1){const{element:r,currentPoints:i}=e.detail,a=mt(r),{viewport:o}=a,s=o.getCamera(),c=i.world,{focalPoint:u}=s;this.initialMousePosWorld=c;let d=on(u[0]-c[0],u[1]-c[1],u[2]-c[2]);d=Sn(Ke(),d),this.dirVec=d,s.parallelProjection?this._dragParallelProjection(e,o,s,!0):this._dragPerspectiveProjection(e,o,s,!0),o.render()}this.configuration.pan&&this._panCallback(e)}_dragCallback(e){const{element:n}=e.detail,r=mt(n),{viewport:i}=r,a=i.getCamera();a.parallelProjection?this._dragParallelProjection(e,i,a):this._dragPerspectiveProjection(e,i,a),i.render()}_zoom(e){const{element:n,points:r}=e.detail,i=mt(n),{viewport:a}=i;a.getCamera();const s=e.detail.wheel.direction,c={detail:{element:n,eventName:Le.MOUSE_WHEEL,renderingEngineId:i.renderingEngineId,viewportId:a.id,camera:{},deltaPoints:{page:r.page,client:r.client,world:r.world,canvas:[0,-s*5]},startPoints:r,lastPoints:r,currentPoints:r}};a.type===yn.STACK&&this.preMouseDownCallback(c),this._dragCallback(c)}_panCallback(e){const{element:n,deltaPoints:r}=e.detail,i=mt(n),a=r.world,o=i.viewport.getCamera(),{focalPoint:s,position:c}=o,u=[c[0]-a[0],c[1]-a[1],c[2]-a[2]],d=[s[0]-a[0],s[1]-a[1],s[2]-a[2]];i.viewport.setCamera({focalPoint:d,position:u}),i.viewport.render()}}qg.toolName="Zoom";const Oy="zoomSync";let l1=Qse(Oy),Vl=null;function ace(t){Vl=t}function tL(){return l1||(l1=Zse(Oy,We.CAMERA_MODIFIED,(t,e,n)=>{try{if(!Vl||n.viewportId===e.viewportId)return;const r=Vl.getViewport(e.viewportId),i=Vl.getViewport(n.viewportId);if(!r||!i)return;const a=r.getCamera();i.setCamera(a),Vl.renderViewports([n.viewportId])}catch(r){console.warn("Synchronizer callback error:",r)}})),l1}function oce(t,e,n){const r=tL();if(r&&Vl)try{Vl.getViewport(e)&&(r.addSource({renderingEngineId:t,viewportId:e}),r.addTarget({renderingEngineId:t,viewportId:e}))}catch(i){console.warn("Error adding to sync:",i)}}function Dw(t,e){const n=tL();if(n)try{n.remove({renderingEngineId:t,viewportId:e})}catch(r){console.warn("Error removing from sync:",r)}}function sce(){if(l1)try{Jse(Oy),l1=null}catch(t){console.warn("Error destroying synchronizer:",t)}}const Ih="myRenderingEngine",_w="VIEWER_TOOL_GROUP",cce=({imageId:t,viewportId:e,zoom:n,sync:r,renderingEngine:i,onZoomChange:a,onSyncChange:o,onRemove:s})=>{const c=Ae.useRef(null),[u,d]=Ae.useState(n),[g,h]=Ae.useState(!0),[m,y]=Ae.useState(null),v=Ae.useRef(!0),C=Ae.useRef(!1),S=Ae.useRef(null),w=Ae.useCallback(()=>{try{try{S.current?.remove(),S.current=null}catch{}Dw(Ih,e);const R=`${_w}-${e}`;try{_S(R)}catch{}if(i&&C.current)try{i.disableElement(e),C.current=!1}catch(O){console.warn("Error disabling element:",O)}}catch(R){console.error("Error during cleanup:",R)}},[i,e]);Ae.useEffect(()=>!i||!c.current?void 0:(v.current=!0,h(!0),y(null),(async()=>{try{try{Hg(qg),Hg(jg)}catch{console.debug("Tools already registered")}const O=`${_w}-${e}`;try{_S(O)}catch{}const b=fte(O);try{Hg(qg)}catch{}try{Hg(jg)}catch{}if(b){try{b.addTool(qg.toolName)}catch{}try{b.addTool(jg.toolName)}catch{}}if(!v.current||!c.current)return;if(C.current)try{i.disableElement(e)}catch{console.debug("Element was not enabled or already disabled")}if(i.enableElement({element:c.current,viewportId:e,type:yn.STACK,defaultOptions:{background:[0,0,0]}}),C.current=!0,!v.current){w();return}if(!i.getViewport(e))throw new Error("Failed to get viewport after enabling element");if(await j0(t),!v.current){w();return}const G=i.getViewport(e);if(!G)throw new Error("Viewport became invalid during setup");await G.setStack([t],0),G.setZoom(n),d(n),a(n);try{const j=c.current;if(j){const F=()=>{try{const $=G.getZoom();d(z=>Math.abs(z-$)>.005?$:z),a($)}catch{}};j.addEventListener(We.CAMERA_MODIFIED,F),S.current={remove:()=>{try{j.removeEventListener(We.CAMERA_MODIFIED,F)}catch{}}}}}catch{}if(b){try{b.addViewport(e)}catch{b.addViewport(Ih,e)}try{b.setToolActive(qg.toolName,{bindings:[{mouseButton:zc.Wheel},{mouseButton:zc.Secondary}]})}catch{}try{b.setToolActive(jg.toolName,{bindings:[{mouseButton:zc.Primary}]})}catch{}}i.renderViewports([e]),h(!1),y(null)}catch(O){console.error(`Setup error for viewport ${e}:`,O),y(O instanceof Error?O.message:"Failed to setup viewport"),h(!1),v.current&&w()}})(),()=>{v.current=!1,w()}),[t,e,i,w]),Ae.useEffect(()=>{if(!(!v.current||g))try{r?oce(Ih,e):Dw(Ih,e)}catch(R){console.warn("Error updating sync:",R)}},[r,e,g]);const x=()=>{v.current=!1,s()};return dn.jsxs("div",{style:{border:"1px solid #aaa",padding:8,margin:8},children:[dn.jsxs("div",{ref:c,style:{width:400,height:400,backgroundColor:"black",position:"relative"},onContextMenu:R=>R.preventDefault(),children:[g&&dn.jsx("div",{style:{position:"absolute",top:"50vh",left:"50vw",transform:"translate(-50%, -50%)",color:"white",fontSize:12,pointerEvents:"none"},children:"Loading..."}),m&&dn.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 0, 0, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",color:"red",fontSize:10,padding:4,textAlign:"center",pointerEvents:"none"},children:m}),r&&dn.jsx("div",{style:{position:"absolute",top:8,right:8,backgroundColor:"rgba(54, 60, 56, 0.8)",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"bold",pointerEvents:"none",zIndex:10},children:"SYNC"})]}),dn.jsxs("div",{style:{fontSize:16,marginTop:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[dn.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:10},children:[dn.jsxs("div",{children:["Zoom: ",u.toFixed(2),"x",g&&" (Loading...)"]}),dn.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[dn.jsx("input",{type:"checkbox",checked:r,onChange:R=>o(R.target.checked),disabled:g}),dn.jsx("span",{style:{marginLeft:4},children:"Sync Zoom"})]})]}),dn.jsx("button",{style:{marginTop:4,fontSize:14},onClick:x,disabled:g,children:"Remove"})]})]})},lce="myRenderingEngine",bw="wadouri:https://edu-next-app.s3.ap-southeast-2.amazonaws.com/dicom-image.dcm",nL=1,m2="multiViewerState";function uce(){try{const t=performance.getEntriesByType("navigation");return t&&t.length>0?t[0]?.type==="reload":performance.navigation?.type===1}catch{return!1}}function fce(){try{const t=sessionStorage.getItem(m2);if(t)return JSON.parse(t)}catch{}try{if(uce()){const t=localStorage.getItem(m2);if(t)return sessionStorage.setItem(m2,t),JSON.parse(t)}}catch{}return[{id:"v1",zoom:nL,sync:!1}]}function gce(t){try{sessionStorage.setItem(m2,JSON.stringify(t))}catch(e){console.warn("Failed to save state:",e)}}const dce=()=>{const[t,e]=Ae.useState(!1),[n,r]=Ae.useState([]),[i,a]=Ae.useState(null),o=Ae.useRef(null),s=Ae.useRef(!1);Ae.useEffect(()=>{async function g(){if(!s.current){s.current=!0;try{await OA(),await zJ({maxWebWorkers:navigator.hardwareConcurrency||1,strict:!1}),await ece();const h=new kX(lce);o.current=h,ace(h);try{await j0(bw)}catch(m){console.warn("Failed to pre-load image:",m)}e(!0),a(null)}catch(h){console.error("Initialization failed:",h),a(h instanceof Error?h.message:"Failed to initialize"),e(!1)}finally{s.current=!1}}}return g(),()=>{if(o.current)try{o.current.destroy()}catch(h){console.warn("Error destroying rendering engine:",h)}sce()}},[]),Ae.useEffect(()=>{t&&r(fce())},[t]),Ae.useEffect(()=>{t&&n.length>0&&gce(n)},[n,t]);const c=()=>{const g=`v${Date.now()}`;r(h=>[...h,{id:g,zoom:nL,sync:!1}])},u=g=>{r(h=>h.filter((m,y)=>y!==g))},d=(g,h)=>{r(m=>{const y=m.map((v,C)=>C===g?{...v,...h}:v);if(h.sync===!0&&m[g].sync===!1){const v=o.current;v&&requestAnimationFrame(()=>{try{const C=y.filter((S,w)=>w!==g&&S.sync).map(S=>S.id);if(C.length>0){const S=v.getViewport(C[0]),w=v.getViewport(m[g].id);S&&w&&(w.setCamera(S.getCamera()),v.renderViewports([m[g].id]))}}catch(C){console.warn("Failed to match camera after sync enable:",C)}})}return y})};return i?dn.jsxs("div",{style:{padding:20,color:"red"},children:[dn.jsx("h2",{children:"Initialization Error"}),dn.jsx("p",{children:i}),dn.jsx("button",{onClick:()=>window.location.reload(),children:"Reload Page"})]}):!t||!o.current?dn.jsxs("div",{style:{padding:20},children:[dn.jsx("h2",{children:"Loading DICOM Viewer..."}),dn.jsx("p",{children:"Initializing Cornerstone3D and DICOM loader..."})]}):dn.jsxs("div",{style:{width:"100vw",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",marginTop:50},children:[dn.jsx("h1",{children:"DICOM Viewer"}),dn.jsxs("div",{style:{margin:16},children:[dn.jsx("button",{onClick:c,style:{marginRight:8},children:"Add Viewer"}),dn.jsxs("span",{style:{color:"#666",fontSize:20},children:["Viewers: ",n.length," | Synced: ",n.filter(g=>g.sync).length]})]}),dn.jsx("div",{style:{display:"flex",flexWrap:"wrap",maxWidth:"100vw",justifyContent:"center",alignItems:"flex-start",boxSizing:"border-box",overflowX:"hidden"},children:n.map((g,h)=>dn.jsx(cce,{imageId:bw,viewportId:g.id,zoom:g.zoom,sync:g.sync,renderingEngine:o.current,onZoomChange:m=>d(h,{zoom:m}),onSyncChange:m=>d(h,{sync:m}),onRemove:()=>u(h)},g.id))}),n.length===0&&dn.jsx("div",{style:{padding:20,textAlign:"center",color:"#666",border:"2px dashed #ccc",borderRadius:8,marginTop:16},children:'No viewers yet. Click "Add Viewer" to get started.'})]})},hce=()=>dn.jsx(HI,{basename:"/dicom-reader",children:dn.jsx(wI,{children:dn.jsx(Bw,{path:"/",element:dn.jsx(dce,{})})})});LV.createRoot(document.getElementById("root")).render(dn.jsx(Ae.StrictMode,{children:dn.jsx(hce,{})}));
